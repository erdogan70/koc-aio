// ==UserScript==
// @name           KOC Power Bot
// @version        AIO_20130505.1
// @namespace      mat
// @homepage       http://userscripts.org/scripts/show/162501
// @description    Bot,tools and multi had a threesome, this is their child.
// @include        *.kingdomsofcamelot.com/*main_src.php*
// @include        *.kingdomsofcamelot.com/*platforms/kabam*
// @include        *apps.facebook.com/kingdomsofcamelot/*
// @include        *kabam.com/games/kingdoms-of-camelot/play*
// @include 	   *kabam.com/nl/games/kingdoms-of-camelot/*
// @include        *facebook.com/dialog/feed*
// @icon 	       http://nicodebelder.eu/koc/logo.png

// @grant       GM_getValue
// @grant       unsafeWindow
// @grant       GM_deleteValue
// @grant       GM_getValue
// @grant       GM_setValue
// @grant       GM_listValues
// @grant       GM_addStyle
// @grant       GM_xmlhttpRequest
// @grant       GM_log
// @grant       GM_registerMenuCommand

// ==/UserScript==


//	┌────────────────────────────────────────────────────────────────────────────────────────────────────────┐
//	│   This script can be found at http://userscripts.org/scripts/show/162501								 │
//	│   It is licensed under a Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License:   │
//	│   http://creativecommons.org/licenses/by-nc-sa/3.0 													 │
//	└────────────────────────────────────────────────────────────────────────────────────────────────────────┘

//Fixed weird bug with koc game
if(window.self.location != window.top.location){
   try{
      if(window.self.location.href == window.parent.location.href) return; //If iframe source is same as the parent don't load script  
    } catch (e){
      //logit(inspect(e,2,1));
   }
}	

var Version = 'AIO_20130505.1';

// These switches are for testing, all should be set to false for released version:
var DEBUG_TRACE = false;
var DEBUG_SEARCH = false;
var DISABLE_BULKADD_LIST = false;
var ENABLE_GM_AJAX_TRACE = false;
var SEND_ALERT_AS_WHISPER = false;
// end test switches

if (typeof SOUND_FILES == 'undefined') var SOUND_FILES = new Object();
if (typeof SOUND_FILES.whisper == 'undefined'){
	SOUND_FILES.whisper = new Object();
	SOUND_FILES.whisper.MP3 = 'data:audio/mp3;base64,//uQZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAABPAABG1AAECQ0RERUYHCAgJCcqLS0xNDc6Oj5BRERHS05SUlVYXF9fYmZpbGxvcnZ2eX2Ag4OGio2QkJOXmp2doaOmpqqtsbS0uLq9wMDEx8rNzdDT1tba3ODj4+bp7O/v8vb5+/v8/v8AAAA8TEFNRTMuOThyBK8AAAAAAAAAADQgJAi4TQABzAAARtTuY3WZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//twZAAAAq43Uu0NAAgAAA0goAABFYEzcfmcAAAAADSDAAAAQgAAAAAAAA7v/OI7u8QAEEiVoiJolf3///07u7u+gue7u73/xXLuYicu97u7u+QDQBcF4fvCIKA0ABgBwXh+8ECgoLi4fwTeUwxEAIBmoEAx//9IIHP3MRWV2c6IlMNBGmBWKwAAUAoccJ5kDGwfclxih7OQoGnmcqoo1Et+BAQqARBMEbg1wt9JXfHmFn1N2RwI/z4t5a0uu17dGBbqWnys4U9PPLXp6WLt0ViiOFLBr8WL9uVz9nbwROKxqV0r8TPKfOV++kJafR97dgqCwMSB8M88I4QBq59fyt9z+4fzKHZJe1+Pfzz/9a7/f/Pcvt9//+9XpJU0y/Yu///8ktxt7vkIU0IAAAAOGSiEhNZiQct0G//7cGQJg/OFSt7/YiAIAAANIOAAARKdJ2nMYfHgAAA0gAAABLpe9gyB6lI9U5vCmPGBuY1ompozJspDmxP06CmeptjUnCeMCq5iiZpsm5gizGFlJLSvTqUmYGJmT5FgV5JFQmmMzZI+kkjOF39b+tH/684dNjI+ktZJG6WTxkXi8bV3UAmhACFwLyZIDwofELh0oMFAYqZmlSNOnIZDHYtG6s5SY8+6lpG61HZmIemu3IBa1C7/3pTZ7+pPrnVYkTYq/0D2Llt/ZfQfc+WWbl/4Miz+vzRyuTe/n/TO1D7udfwkyYqA7S/UwUrYnA8kk//9MFyY59fVYrDBiSysM+pLf+WeX11mjAu2Fdo6vJ6JRCo2Y7HPld7WABQQAAAADhuYqYxTTslYtSIjgHiJAJ4U2TPeRudrRbz/+3BkEQH0lUnZ+w+j+AAADSAAAAEP9Sdp7L5v4AAANIAAAAQHKSR+sCfsTDHivY0PDCOUUiVefy7zG/dSTpNWiPP1MvP2J8PbKZ1ljcf5vCbIVO6kfM+n5kTxZHWSxJA0UgdIEIDFkPUEWIaNAyPm76SxWOcMTYsXrIoT075ifUe5cUTRFRdltE6OSDgpxy2WzwzBpv+6AhGIwAAoFNIcmLLXRYjEpxUJFMGiIsYRWEQfduyhSvID/X7MRL3cqxDisiqU70vPrE+/bf+N5VgsLe5Td9ERz2/8XxYU3kYqvITbE1uLZy6Rq5REJAOxxxC6FvJ0pmZiZuWDF8gLdGkit6Wr7rRostBSR1rFgZlSzVy+OWeVv/kAQSAAAAAOAsIYKZiRmQwOCoTU5RliTMzImZzBYanrXoy1//tgZBIA875J2Psvi/AAAA0gAAABDnEnY+y8scAAADSAAAAEwY8Kaj9dA2ldmO6/36SKuJF+t+u//5T+Msr2bMj6YgMPH8LbLJ3mIsXy5fSZe6PTZZcL4fkD2PJAiClqOwwMzxiZTdjJ+07qrt//c0lzmQ9+iRVPf9QAyIwBAABoQ4hWQeBC6yVotHKUXHIEYpET2XyeGpyWT09ST1M3PNsgJN1BYqfNb0qtxomPimv//1koqrmuHNuPyFr/y214F60tfdK3za2L5jRT3FW2oWuKYV95ejyFQ2piNNSn90eqMggYPPIoOQmofdXv9wAlIgAAAJoBoQ5IALgDDCwQBAAaEJpQ//tgZAyA85xJ2HtPW3AAAA0gAAABDcknaewxqaAAADSAAAAEQWEava8GQ3Oo56wvXzZB1JKhwZmsPK4puN48bWYG8a1//8pYk6PhWlWph3LG//61/NRfccTTK01ATQFBRNk2OOTe9dSTy56uaabIO9C//f//+PtVfDYmmbR4u/9ANEIgIBAA4UFLeMEMsDCcxgpS89MOBGBED9YO+FV725bjc1wPl2weuZYcXNFGsyuZ/nS6MAeZjE2RGOOn/mhIF03y81dVpm4DJPHC6bGRdfOuk508Y5wnCMF042f+geT9PWbG51VNRRZHODtd39AAMQAAAAGYAKI6DHCGwBdQwh0najUW//tgZAwC83FJWPsMauAAAA0gAAABDvEnZ+wxr+AAADSAAAAEDrjpBPWEQriWVBLhbxHDr4cpSI0WrblO16eU1IeY7fGFUO8/JUzD+tDTS1GjF8S9I+kxjr86mSoO9SZsec2egmiknuo4XDhOLqZ7b5utD21lz0UTf5t+8AApAAALBKQrDDIXKcnEz9LbdpR1cemtUMKdliCZ50jiarjcQ1N0t7ynGTzqdZq1RYo+9OnsHag4Wz6EiO1Zr7nXTOqV6tQtge/bvqJxwJiIEU0R2mBmTU55iccLab1IkiKpqmv+skTc0bpcf+mkTy8mpCSh4oLP0xAgAAAAAS4lxnBjx5xAgoIU//tgZAmA81JJ2Psra3AAAA0gAAABDmknZ+ylbSAAADSAAAAEDuBQUOAiBMP8B0XUk11aPZeYsIoO1zrU2MSefaW+57LRlRP+A1THe22SPR5aN0NrOF1x4Dzl6dz3nUGBYzI5RJA9qRQSoPUkiNBLW/zkz/1ddiNrkE4Rv/7AJQwAgEAqhrB1rLuECim4gLCoCgSfKdizvdFwpIjEhBipCRvX/M65N8stR61fTkBBOs1Nv1AmamtoPNRTNS3Oah71HKgRKGyFKoRM37Uh4JpxEd67iln/8HvhQ1Gs7X8X+xHOu//k3pC2wwtvNJNiktrvwQBAEwICCLgLKj5TEUl264BVthD8//tgZAsA81pJWPsJa3AAAA0gAAABDtUnX+w88eAAADSAAAAEkKmhUsESeisF0abSSzRdSQuiiVbn/9xfauSxMh///pPSa1kKMGSeC6GVZqQOC6bVMztOmiaBfMAogm54wIJ9Ac6Df+pR40R6vUfl49+swpvnC69O5/PwQNBEAAAAA4IXCzSQBV4KDQXrlQT/jsnIj8SmozXgGCLt+UZNMOFk/c2vrFfiaM5WzBiyxMTf/+EupE7ei08IEq2l3EcexOPvTCELUXN95181jSJ+p/AWrtblbby8/KFuPeeA8cR85vdRWMf1Y1sVBp7IJAlN3vQAQxAEASLKGGgEohDMEMNBS4lI//tgZAqA80VJV/spa3AAAA0gAAABDbknW+wlawAAADSAAAAE6INBock4LcGSOWCoqgec8DX9g94THO1yz4ZueZcIThX//LxKNVdNMsVCXi86idEkJtFX7WSQPIqMXWTV6XWYtRURAmhmXHzE181Wdf/axyl3QOmOb8ACAAgAgA7RiAdocBBEQVBxaQmEHepyjlOSAsgtEBlpXFTSj1gXUXwIylbZcurpsPCVBZ3+4tPj9u5B+jX/5vhwD42vd/8XCTyINCtGh9UkX//mlIM7CZ10//6htjoTr/5NVlK0TUfG506ibWqt8AAwEAEAfImMiXKOCfF1ME7UvgvMpbPiMNCRQVBh//tQZA+A8xFJ1fMJauAAAA0gAAABDE0nX+wlS0AAADSAAAAECggabkdgIGyAgHTMdWiofRdDiwB4Jp+dCpMEHpHh6iVNp51WcGFQSZv+mMy02L6SA+/6d2Uwwr2/zqBt/t9RB1WIKGf5ADGhCgBBPhKYUAqhBibgJTcKgUWCRaza0WgJIz6FJEiMk3uRM2oRRZ7G5b8xwPF2+oNrDB6sJBFzXkJtzScenEJzSP88oJ6TaD5/1WaxyBWHyN/morfyfkkXHtHxCPic2r/XAlQxIv/7YGQDAPMqSdf7CWroAAANIAAAAQxpJVnMJazgAAA0gAAABOQhujbRQU4Vi7Y8WjWIViJTs3rIwMGiUkGUDaBC3neCuSWmp5R/RZ1zIkARZI1bk4exLCVGCaKARYYAu5kbfqMZ391S8gXxfPuXmclf/UqdJMrMW///pdKcHnnGPkoXq3wAEIhAM2Ukji05BRFdI7afg0UqzJj3o23TEssBTjNk7+lAaMz5tNb810JOC+ooO/MBhCYBhrzofy7+cNJ1IQcGeav+pyegM4FERWMU8dGCVp/WfRrHiTST/+n//nSWzjIl+s/hIGEUBmStRiPA56XR3MDBBUOKLjHkOI9PFu78y//7UGQPAPNDRlb7D1PwAAANIAAAAQutJVfsJUsAAAA0gAAABOrLH9tM+fxvarfR9hpzr4zNf/GrJfGt7/8JOoYCgZm9knLyhdK0vfcJozmCF4hzxEf//uSnioAiRHCocwUrb/m8iT/8h//yo0jSk37ADAIA0CQ3RyGoHC9VhAQdyAFYi+tQnfmCwGbQogSVQMq7iSTkNLmlqynk+jhRgeH+3PC+QUihSQVAqFUYjnPQ9FFo805v8opQN7l2jv/kHIzL/+Ub/+YS5E5Qjp3BAEL/+2BkAgDzO0nV+w87eAAADSAAAAEK/SdZ7BmtIAAANIAAAAQjDoQgPDW4yZmMuFV1CEJNoUwPer1Jp+pVmd+3WgWeZkYp/DnzjUvbYn8kYuqMtrX/8s0IgKTixTMHnWDFy+babLASNzB9v9TSgAR6g5NKkP/ObQqz/+Ny39G8IgLuYegAQAT12iAOQmLIJAfGUbiSGQWIQzuIuuMQ+aduAHboDBwsu1GpFxZ7cDz37an0ikgFKa/smsQAlszEeX/+uOA/O/9FaQ8ajhpKf/oNqY5/81/1toMiXrmCR8fUqs/zAGJFKROk7C3CRGEYqJOLQ9UNW4QQat0woR7mw/YfyV119bP/+1BkEoDzGUlXewxS6gAADSAAAAELoSVZ7CVNKAAANIAAAATLMQqa0tRpy86yP4XCPHd+REULQWbkYLAtP/oRANKcxv+UkA/PYjNjxv+jbHI3/QmfPP6cfyommmisPioX0lfigFIaEgAQZQ2kFFvBNKm5mM5YWcUFGXE0LawF1pIfbFLZl51qSPR+c0x1BkfcvdwtP+aSoGJqMweFP/QPcib/PuLViQnUr/4/a5xOrf+7SYkKd+x6EZilRuaNBFW+8AB3NSzTQM4abJBJ4UMZ//tQZAgA8tdJVvsMasoAAA0gAAABCi0lWewk7OgAADSAAAAEYF19qoOKwcobmEKU2HFHK889LlLFcxy0uHSj1NlZ8TUcn9RpD4ZJmjCfnE/+s1djNv9p1DKTrP/+e+dPf+Y7OttHqTukkZFIqLoTG+YA5KpQgAJ8fk1kRzHLmFlURwXGVWlDbTTaGI5ROaUUI2kqiMT1QSDPRFx2aDDP5dQjN3A09P+pySv/OxayjV41/8XNog6//9H/++VLj4qClZ/pAWVFGMggyjnUPyyDLP/7UGQHgPKYSVZ7BitYAAANIAAAAQo5JV3sMOsoAAA0gAAABCO63AGpEol6kjlBN/ABDBY3sLC5ej65SNflmlp7R4Y41K7+WAr2gIDt/4Eaz/6xgvhJ1Fv/DvuUf/6ugkJv/47ILBYdr+AAllVMQmVcPzW6AhAgQCvg2N3iq9ofQhXKCWWWEqV1vH/WOs3glMo56PVkLotvwMobCIUt/5TKN/5QlnvLN/oUfUqOP/5RkR//lsblzRtgWWqQAFASDgAAFjW6gjFtgEYGYITIOSD/+2BkCwDzNUtS+0lrWAAADSAAAAELySlV7CVLKAAANIAAAARSSNb70y50DsoxO256FhBCYWg0HjcrjslYf4LKIE0TYx6yonATMgpJJi3EZN/9SjcuTY9/UTGdsouse7/8czcuj8f/9I9M3+nr3qKzdZRk6ahvEAOpKPYDJvH+5CFoapmekGSirASlV4GyAocLntIFk11l0CGfk9+hOLtA+MHHv8jQFkvRQxKl/9YTR+okm/4/sPKEzx4/+o9fQgIm/bPXJSf1KUJKqhgrnioNmFcWfcIAhVIIQACeP4RBAhZtRqHQwALGhZQrjxibOIthBkrJggQg3qzI8r84bJaiidLXX9b/+0BkGQDyxUtUeyZrqAAADSAAAAEL+S1V7KVLIAAANIAAAARxYdn47C8f/84bTF/9pwu4zuoz/9T6k0j3rV7vqQ//nZqPBEul8pR3kAO6ILRUpnH5lhkAogEdgGZYEWuSQDx2ILDIwRGxNUnIpyTu96byPo9owMKg0Vb1HqAtm6BWLF/+gyLxgX/oF0w+E5zgDBsJAlH/89+RqW/fNpKk7f+WQ4rPHqEROZWe9gWYaG0Ttl4/jf/7UGQFgPK0S1d7CTroAAANIAAAAQo1JVnsJOsgAAA0gAAABOtxS/AQqFLZUZUQmJVAMKC2FxRIu7ZIMViSSK7J39M3DSkVhLjfU44HpKqgeIj/9TMQf7j6qUsD8woJ3/5F6ThWb//K//SkVll46Wr+IApkdaQIncKeLi5x1SHVJD2qpRFWChF8DAhDI2JstdfD7LNlH6XYU3os0oTKF3/UyB3iKd/8ca5b/apuNWPT/xGOoaNh1//46zf++NSw4TUqWpAAEiAOAAACIJgAQBz/+2BkBwDzi0lQ+0xq6gAADSAAAAEMJS1V7DFLYAAANIAAAATHo0/iELKCwTMKIANYH+Gbmh2kKCswsRR/VN9rJXckuoDv9Deds0SgihD6Vt5gP49gDbILucBQBOiNq+pInFiZWn/QIjTSoT4sH0cv/WPp4+cWO8lRzv/+s8b/03qqWWGB8KF33qAQyuvSbWnEdQhZIIimXIOV0RFQgVvJ02hFPB0BQlHGDVHK3cOHJmpq58Ldq3NNLsLH9Sc4GkLewUSFv/EctZ/8/1IyyHf9Szkp5CKoeAqf/n6kp38gzaD8akQsnFyUypvhAGWJXE/SvDGYWsIgA8JK718EzRl5M3ICRW3/+2BkDgDzEUtVewlq2AAADSAAAAENmS1T7KWrYAAANIAAAASGwoykAIILm10iAm9DA5txzHq1lso/1lixUGhFMmhZiCo6letAO7KHw2/0Xrx4FiCf/k5B0TEoCwNl62+d1t/q/PF9F0DzTugAKqwrCn8nEw0EgHU2jKlmKfyoSGdeuRCYBlMUvJRs9Z9ODYzKI0LX8qUlZ11G/9jZIFrEg6ZPCjEnU39MnCMi+wnyD/xoQOnKgJsKw/EsmZt/J95oSA0Gr6+tKgmkxcNa6HmPyMdNHH5Mp5/yAHZHaI223CgkY5kArC6y8nEPlvknUz+QM/MtiEBwJjQ56tbwqZVeyq2f6HP/+1BkFwDzUEpVewodagAADSAAAAEK/SlT7CTs6AAANIAAAAQpWVE7ZfRgvRDzCMIQK4h9fqgMHGiWS/zScsuwiRqeHJv9B47oPCNA+fXgcABhgGAAhOqv8Y/xhAAPQ0KN1gB2aFhAbk411AAVJBjQCdlhfMicIolb8HTtw+hEBUUlR5Vu3tKP5R5nMTlakNmfnsChmgWOf/SPNFL/5H0BSaTYxv42YsiD5Ut+jqZ0Vv/4qIiYei0UjbEAdSdaBPV8NZjjgizyBaNQhKl02pPK//tgZAwA8z1K1HsKRWoAAA0gAAABC5ktVewhTOAAADSAAAAEzD/HzryuX6oO/C/5A1uzyPQo5pRyVWqYhbb+C+IVzWBuBsFOvoQGAHiaTERIZ+cUMnYijRiPGJ2/kM2c4zb+xhpMwyN+ifCeiIgaLNsQkET1gAUaquKmyvGtjpAUGDBUulst4OCKJYsqcx+vFUDBjj+7RJLHmtoi6lkI3VvqomjZkUMRGJv9zRi7CoLBZG+TlfFgnKE7G/6XyYq/7FCxzdfbRtGioWISxcZkpPVbwwBSJC4CSKo1iNFxEULokQmRoqlDwUoCSb3GrVk0Q3rbrRQQttXRV/XX1EFZSWqZ+pYY//tQZBoA8zxLUntJazgAAA0gAAABDFUlRe0lrSAAADSAAAAEjzIuXAtxAXV9FyYlUemP1mL1VjGLXLjf9JGtaazb80pHkpoZGz51tT60TYkll8rNjEvF46kABTEj4BAAY/bAEekczECK4iHAZiM/kvKd+nhiSATjzI3fausZYchRIZeHV5wgFZcY4tM/0jYEfHi61CGJUbNXoZeaZnv8uPzpdLUDOm/6yua1ni8b1t1a+pJ//qnJeHlJKmvAAFQjUwxoTj9p3kB4VHAiVcqCIP/7UGQKgPLUSNN7KVLKAAANIAAAAQrBJUnstLMgAAA0gAAABHkNg0xmRDIWGARHLQv7/fWjQjMP/UKgsjwKVtn6sBaF8XKDMBsYhZ08pQqslX/L74hB0jOt/kHmFP989zlGyf/qJBOFEKa7AAUiQyQCSePiAwKy5HNEC6k8Nlg0wfkty13ncpsH5n6S1lav1ecfSgh78wWRC/0vrCuLj1jFHGe/9XiB/8Rq2Li40s3+PILxjBAd6vNq9XX/+jgKSkiQADIUCIBgDj7bXG5F0Fv/+2BkCADzIUjQ+0lrWgAADSAAAAENJStJ7KWrIAAANIAAAARWEJ4ZKAKMfgyJtJddBGDLQPVFG6jE73GBvexIxTpiIXGg1Sm1aBOBvopLUTBB0f/UkgMYmP/V8TUjqNm70GVHq6k0jFEounrSWg+9FNb//UgfL4cFYAAbGpNqWFcf8VEYYJDSP0SjrsEP4mLLhkncm2AQ+fd0XSgwpFJ3SQNEzVioRZsUTV2Na6jOG6Ho0WTAUwO4y0GTb/Yd5ql/QuzzAZRgmyKbvdsqSNEDiJfPJH//y+cf/p5eNyabTM3qi7MCZEdPBtiuNQmaUg4QOBphwEaYJbUfZUTToTyAarcT82v/+1BkEYDzE0tT+yxq6AAADSAAAAELMS1V7CVKoAAANIAAAARlp3t+212XWnYetgzZc9v8WQcwxSGYZQSoi0FLb6y/WNJefoczTRQWiFeovJJF4zb99lJHav//3/S58mKYuGzT/GAuyo25nzvFzMRQAKlhmO5tERhKkU48BGoqaDxFRW87kh1lbzBiaQi8IhJJ/+gUYs1KAbHC//NIFJxiLTcn5B8QKlf/q/LlS/9DXoaeZ1T6qpxg6YWjIo0N4AB2lm/f1Uw/wqMtqXbMRPao//tQZAmA8uVK1PsJatgAAA0gAAABC3ElUewlS6gAADSAAAAE7I4MmnYBta0KMTHRCPpz2t3eUbR1mL4PXGcXysj6vpqDmidnjhwY4bRovX9aSKRMNvbv9Z5Zfp/5xta2Sb+kb7rb/+eOmx9p0uhuIAOrQsqurfH+lyENVITUsockI2mE67KIGQhx5HAiRJmnNt3+ttefzU50D5tRrod8w0DRS5wVAKTf8oes4hvvyF580K4oj5SBv4rnklTSAnO/zPLf/6lxVJ8dqkuyADRFK//7YGQDAPNlSdF7L1L6AAANIAAAAQ19K0/spaugAAA0gAAABAtkLjVAGKA1gxEBgl2BGCPxAjwF3QKjj/lXcSaApo8ZgukY3vqHPul9Xu9TeCjTB7Iy+Lf//MIV8QpxpoBIShY0+kxBmK5Kjl0fMMJ5IZHg4QHqrG/liQ+pgwON//m//1Ix0RQKmjtnEAMaq/ktj3Fe+luIQ06SVW4VB0uhiRf2JobJimo2Ebismp1GTJk2pCFymUlRUOTMyU31sCuCLZZiJamOmr6ReRSTJE6kmpB84mutKZkEkkqNL8kkT+ak490E86OwudBb/5MbKxLYniCyefqu0wBmSH9ktb4aPNFuYf/7UGQHAPKbStT7DFLoAAANIAAAAQy9K0fsma0gAAA0gAAABNWcXszQZbwq2X5mOBcVHRi9VDnHtTsVfpazeV3Ma7EMYQ/Vy/0PAHGcSBXJf9V5FLtto3yws//jG2x5b//Lf9PKsMi00us2IAZGx5hRp8VaKelTDAIFL0qBbkL7E6FuGIlSCwkJNCTk7LUYuNF4BT+0pMkgKJNPpM/6hHmqsYw4X/6Rk6Y9iC13RTZ0HbUMYlSKcpN+oqTPVID6av1PZlbnD3/Ulyaigiokjar/+2BkAADyzUhSeysragAADSAAAAEL9SVF7KWroAAANIAAAARp0AB0JlsSsC43qJ0i8DEWrkAw0aicUq2n9gWlLdNBQ9ulRZx+jVA7X601iEETVz3f/yiCIRrAOAI//h0eBJw40kyGnFbyCgdFRNhFv7m0cR/2lrRjn//E1ELEgAIZILYaQXG9Q+1x2CEKuQqIbhecftngAiOweXR2Hodm13ZnrFM/nV5xEJRASuW/1RNhsdUP5Jjfr+s+ijM2PUvdFLuMQ3MHoLQ/O3smYn1petqVbJHFoqb/ysoDHeoN1gBma3jO9l4/xxaRxiMrZDoNUlkQ1TxyTByjgYLmlhybU3oTJO7/+1BkE4Dy6EjUewk6ygAADSAAAAELwSlP7LDp4AAANIAAAARocY3XxMxTR/3BUJani4BQN/2MHzzygvNFbMhjN3oIxIojHK2jY46TaDKf+gwhNj3b/yotFEd8xQJ1Vk+audo5mKDmWKnsYZMsELKfRVjArYfQWKAlvK2kp61Mszb+2KPrTj8zoWGdn/Of6sAw7iAo//fjQf800yeb2EwbDRRhqe2jboQmlBMS/+UH0c0w1v/jCMJ3i7AAhTdPE41OGXwOqoSrggp/6hKCsIIp//tQZAwA8vxKUvsjU7gAAA0gAAABDDEhSeylrugAADSAAAAEx5O5pyn5a7CqGgzocwwsOdRxF4AEmFYOiDT/wKQ49RsFAZ/qysYUU5DlOU5jU6EAnlSjHPmI+qZqC7/844qPx+Q//njh0kHYnAAHQ2XYSJPhYjU+ukJFmKvpVEegHDSMOwyJ3ZQ1SXXGk35Wrr46AOI2m/qKRUckkDMJ6aof6hHmOsK0yHTV9SzVSzE+9S19BfVI61/S8wUb5dOHtD6moMxfQdX/zQomDUiSAP/7YGQBgPMTS1D7TGrKAAANIAAAAQwRLVHsLK/gAAA0gAAABDRFNwNJHimtV4yHFlJ06YglFBgonFTqsQaEAkJ1wqf21EJyny/lPOOPxqxWEMSjIN/RGAC/IpFQyRxi9/zLnTZ/1JM+pMhId9FumsynDxDI1R753VRfR/+cPEy6zAlBAXxgEw8NpP67h/50pZwRsrlUUAkCCIWK93JpoAisMLihTFDYpNk26K56o4d+mXKXvtn/VgRCAPyRBcH0hf//lGuDptbHn/OZ9Thok0RFz/h21BQTHf7aIImob/4wOhnQPw3kAZZnf4W5Xj/oUjEyRCCuVSJnklAPLT8QzwrRvPs8/v/7UGQQgPLMS1R7DDp4AAANIAAAAQz9LUHtMQuoAAA0gAAABD7tHWpgXRXX3tE3MYmmzVp/4nQ5ECcCIv/7dE3YpG5hhXqCoaOLUVPoPdDyv8wz5Ug3/8oNSb6jY5lgAzFFaIbC4/SYhYBvKMBICBIEa7EmYWUZpBzUvlBzDu/Wia+JPS1Njr06z+jS4nNJ5v/qQAFpUhOIZ3//wlKUeOVkdzUiHuocQWLN3Wnt/kX/zxKP//GWifjRw7////DBokH+oqCqarEAQkQ8z62+PuP/+2BkBYDzP0lR+ylq6AAADSAAAAELwSVR7CVM4AAANIAAAARLaKZ4qB+iUEWCEcBF5PoQLVpUmQR1anYzDevSfRrI1s8A+LKup2f3YTIJAMslTAYgWsL+hOr+bXkUoUWMnqR9UnoHdGYonzFzE6aJqTLpsgR2/OqbrNWW3/zJi+4bqkEM7z+9tZx/oJgQZfyXnSodHBtys1pxWlWEQud0KGlfGmUKvZXJ+p7zgqhAPTzJ35wUJcZF4GhECnX6tzR71fNfUmMECNGxkWOujnR8pKpo+CoTer/5b//IHIBvDugApkdvpt46CzYBiLQGONFyziWA6CTA5MxgCUV+yxiLqhDOlDL/+0BkEwDyt0lUeBlQaAAADSAAAAEL8SVD7SWrIAAANIAAAATma80LIwG7/5oBg+yoL4Ngtf/oMDX7HyJEaWcRYKBUSeb0ZqubITRcSej/7f/5E5QuEUAAZoySCVB8f4wHa4nam5dLAYaUiOiJEaYKlhQe0Ex0VmL2zSrX6ONSbT/HwRJEOP/xfC+upYbIgxZ/1JGKBOKKSz6bK7tomZRSav68wvnkj36C0+oyNf/6xLCETh5KC//7YGQAgPMDSVH7LFK4AAANIAAAAQpxIUPsmO0oAAA0gAAABKAAY2prBbG+P9Bt0UHSyW0nl1lTlM/mjwJDa909SrWm2j0I3oQzCNmVeFQTShbt6oC6OoqA0ANBYPp8xjjhmTEljWM5F6jwLJPo76Lj5jrDwZiaYpfjJiTnkTf/6FypwTagDCSnWBCFx/oejIIhLDo3cHoitcKdj5diCoachEcnxLHpCEgr5oj08Hhs4KET27/UCD6CZy3+5YQjBx5NkZDf+UGB3qn5WWpH2/1OzU//5QuvSaAAMlQ9BHA+P2yFiDEH9qEJYtMCByd/hGLJNYQR5bULzR/vavabdTr/3ZTxqP/7UGQXAPLvSVD7LFLoAAANIAAAAQy5K0XspaugAAA0gAAABH8p/3/FIa1cIgmh9/mn3KGC0yPcxCxUtJ6BUClHp5kjN/KWopV/+S1J0M//y4fkaLFgAGbIlZkqnH7mGxBipAXcJC2QCIwbK5ECWhBGRsUPU6C5Wvi+tzm5l19M4L41/9QnpLpsRQ/jOj/rMlOsnHzRJ1GZIqZjRFC4hjRIvJoJ/rXTuX5b52tNJJ1oKKP/9jEbzXL5ugzCAGR3jV/5zj/vq+L+iXayOqbBA5H/+2BkCwDzI0rTewlS6AAADSAAAAEMWSNL7KxR4AAANIAAAAQrzQfExQjRohrMZYuakccazNXphDtLD4xLTXWr6gYEUNzhiLASxvr9iMo6Dc9yU046bcidCSIxKMiBx9T7X0Jihf5kzy3zG/yh46KzQ9LhWGBuzMns1qkH/UXShPAVlOhMSBJYlTVYRBE/crwJEZmzWY5VVuyNZNulEXB8aiCubc65riAdiAPNsKjUZs5//ZtNCtP4fL9PjcrBQfN1paxpZLAjtmCP53m9Yvnb/BCxwszVa6AAQlmdhK2+Lt8RIEVidgkhXJAGlksw8RdFABKs+RyLzi5YlmwSAgiHezU8QMP/+0BkF4Dy80jR+ylqygAADSAAAAEMTSFD7LDrYAAANIAAAATSSD/8epfZ0T44Buav8zY1Pk06lo0LV9ZkUjrakbzJq0Grcfi4+pX+s2//zp87watUAApm76ASJ8RCToRkRxEci5ssBD04y0RoS8aBGHoUL6uoa+dsViayudC9farUwX4Gg0bt/1ChfhCJn/6E2Fxg2PH3FRYfH0MTx4NjVZRH6tHUNqWCIWdC2rox7qX//x0Xof/7YGQAAPKtSVD7LyroAAANIAAAAQulJUHspUtgAAA0gAAABFilAFNHaUhIvh6rqmLdQFEVQJ0t8NZKnK7J5kP+ZmyqIrZPvvHOI+taJPj5ri3/KNHJm//zBpNCAN/7NZCW6sit2MGz/60vQgmO/jTCQ5R8f//iJhEqxQABCjLGI2XxTtniVcRADIPB0NCUF7SdWXAihmIZqmFJX1psvakiYjSvpLg6JhUv/0ChPQ8YAiCgEI9P5KezjxtD831Q8TihT+pLI1ao9GZL/KsVLIXPJv/88wgZWqAAVkZHBI5eI7J5SHBF1kPdKoixg7iNA0yYTLogo48iY/giXZHdkP0RbhQgkP/7QGQXAPLJSFF7KVK6AAANIAAAAQuBJUPsmU0gAAA0gAAABKhf/xIbQKYeCb/5cklR4yGGPvZeRl0btznQkQklCUMS39TTWOjFf/8Zh8slXIAqsqyIyOcflDoAFM0BD4aWARBGAVP0u7kMyWNgjBRHQnlnf0Tw2DXW75yoQCsZ/ocLZbi8Xlv/MmIWLWY8pUoWdpQWROJ2UdQn+UIjD2OPGJO3/9//8RxwoyoKswB4R2+Kkl4///tgZAUA8sVIUfsIa0oAAA0gAAABDIUnQ+ylSyAAADSAAAAE2JFABsalklHIDQRzI+O83+rYFgIgFFSe6OHI5rlSsKpZvYVlnv/H1Pokmj/1KnVL2RSfRSfSH03MU02UbaCkCozY2TUkTCH//Wh//kU8ok0AApKrViRK8fmOAlqqYFG6VmSvL6lK1EDY8Z5PBgR7G9yaSJtphTaGtxcFkq3/hQD6hgVAnjft8qRyIfNMKNZDpvkbI75iT0NUseWJpOJRN/yAkoIsTR4SEY//iuN49CkKDN6r5wCXiZ/v+2w6TKpdAjQJ1JAnxRiyAitIXRob7ruA+j73mHBpFEFDmunn5A4K//tQZBcA8y1JU/noFPgAAA0gAAABC20lSew86eAAADSAAAAEhn/f/jAOBE2xAEIGoJ1z/7u0GvO0VI2S3rqCBKKxDSRYq9xcCyJI0wChE//52xhgTKP/YecSHCNWmAQ7S34kkbH43qJWwxrmiqsmEMYA9VOKKuIiWi7ZK2b91e436bixI149v8kwesrTr/jvKBUwZ1+zUq+013IKOR+YIosOoNSY+44/H0J1LDxF/9W7a/6PNYqRCdEFd4l7BLE+P/cMBwAIEpiwDDBJQlVPlv/7UGQMgPLGSFH7KTrKAAANIAAAAQvVI0HspUrgAAA0gAAABANiQFGkD0dqkbm0LeYWRXdTH1A4NiA7/xQTPjg6EQz/R+5hxiGucYc/NdB8JD6HIVneNHOoxUt/8+OGI3/6EFAmkAFZnSMyRrj/GCE30AAOwf8taUSjPg05fFAfEgmGQJBtSLTUWzB9KU1bUXBGMm/0UbhZQ0iApBkTf5rZpg+NNInY+lCBDEgpEl0z/U4WkWUYSxr/zJrnEJD//QakVUigAIZ2XR2QTj8GdL7/+2BkBoDzD0lQey08uAAADSAAAAELnSFH7CVNKAAANIAAAAQM4VYCnHABZ0KrFIt+BZ93tRKmhVS9SbtaqnKZdWiv1WMg9GZ7/TOBWg/oaAEAIMafQ954+chzx4xR0meqM8ChEmWH1/ZW8r/0C6DY41CTn/+rhg8uFYJhUQzfHuS8f71jAhEVi9OWBLBiEpOG+1BlFUoBJCb6F3YReHgl3JIOlvPDYXm/+FALjZUMTA0Pmfn9VZHYw9WMK3eQCaMJYyYfOMPkBAfMcYjb/kT/kH/woCWVCIAARXNHAygeP9noQBFgj9bHRRE/BMEo2yIbQ8KJIB8MMnF25qSar3Ufd0n94tH/+0BkF4DzJUlO+0s66AAADSAAAAEKhSFJ7DCrqAAANIAAAATJSfr+kA8EUZQDQHgzT8n5GjOXIGET2OYs4gDIqHDTiCnSt5cjQcFw0G/5/0HGx4wz/iosWJBOIAQ8u36einH/SsLAAoCpC3aTRLdVuT68SXHSth8t7kKlsY3ZWX5pbszg0vMRzTfoArtQgTb/jhbQOi7iT7p2OUKFbTv35eQww7/H/QUP0P/xjDUIsACGeGkDqP/7UGQEAPJ2SFF7KTs6AAANIAAAAQvNIUHsoVHoAAA0gAAABE4//bCz4ZLuIFukVJ2T6clnTqs2WEgqN4lGnvqLPLn6vxCggL/+KHaUKBCT/5qmHlCJ7o/+sTR8+n3yhjaFP/6MS6Ev+JotJsABmRmkZsm4/elB0HzDDuEgY0wIoSKu9AL7YyqvEJ3LP4LJF96ElX6qP/AsECo5r4XgoI0vgXJH///mZNCxjC9wZwYjQZ0IQuKpByGPMJiRy7NkQlB9////8KwbBSpIpQBWWGn/+2BkAwDy3UDQey8q6AAADSAAAAEMoSNB7LFLYAAANIAAAARKjV4uSBdbQ2mgIVviQUatUBHz6I5liA0SvHGDCiXxBh6f33r798YxrvSaP5v/VAFfcagt/iChwWZ3mxurEnGMHgci6HoMZnKZaComO1owg3xov/LAy8UIAzqzRkyK8NGQZY2OCILKw20OCFIWUIwp0yDB07XrEAz3UvQ7dqlfpWDmtXUOCTr+agjGakQwL/5Gc1BkjEJp5V0MY0xKiGDc44uSHE2TkRx5FeUYS2yLJhLzDLC8i//qK5OtWaAAV1NbQIyuIKeYlGC4AKRMom2VQAw8k6FoqU0mSAwv1YqYL97/+1BkEwDzQklP+y866AAADSAAAAELqSU97RlNIAAANIAAAARm99R8WgZ3n5tbe+pClUrnX/QbkdXFDf6GTyo4VGg6XMnGF2KGlqkATMY4khvNqO8oWE5ePGlTzUehbKkf/8aB4pPN5QAU0VJAIkeNewiBn0ak+ohAEUsgjMQqwNK5nAgTJ69NmlfvXo+a0gdUHg0Egbf+MeqjBv+NiUlGJMeaTmG5i3Oeh4hiNsoXMPo0kI3ohCXj2Ly/oupP//kQ6PzlWJEAVXVbSGouHI62//tgZAYA8ytJT/spWqgAAA0gAAABDG0rO+ylCuAAADSAAAAEImIYMQA1k/RpodsGrNkgPitRc6sNSEKOpWqzs69m+2MoFCSH6Gf//mH+tC3//vpJBRp9JlHuaW2etql7f2n4HeaEh+ZtXllBgHYdbb/m7e867g5N///OR0XFECAGaIpRBRHGtrDGCeGDS6sVC0wBCsP8z4QXJT59V+IKkjP7mWjfO+NfA4P2T3T59gB6rgUcd//6Oqw732N2mSc87QG4Wa/c7HpUZLXjDwMb//yOWQRa4Qz//6kaI4huWDc9e8cAiIqPoo24KBppVg15ACsdd6qqBJgZRm+1BxolXaBS6JUP//tQZBIA8x1KUfsJK9gAAA0gAAABDF0rR+ws8eAAADSAAAAEsgRImGkC0F6QJZOWcaDpVjfH/37wGU0FhEv/IV1I5FciFZSbUC4g+rXQyoHHoUWCQp/mqOMg6YYP/oLqMFmw49UQBURD2h3yYUDKkm2KPE7d1DgnCMrIi9gK0z+4/sxA0TpKlIIHqezXdUxbr+C8xr///S3eblPG/96Z91nVGnEHyujm0Gsn0DmLR4PVoVozl0JpjcwoHdGf/LZQh/kpHdBHZQqQAWNofVuR3v/7YGQEgPMmSVD4GVhKAAANIAAAAQwRJUXsJO0gAAA0gAAABBYF2WViIHFPyIkMq1chDNzjiPGVm6bLaT2ysnRqi7iP0xmivwtP/uD/PveqZx1+ifTYehBNZ55ycTJy5ZFUQZ1X7W+Dyt82vtOm5b/JJj//ULfNz9f/y2Fz51g0LtACDmH9rsco/2Em9Leob0hc5LMc6s/Bx6d84mFhhCIJKKnkbaL+lFWcpjiEEhwvOLEfVgck2U8oULpXoNnPlJ6IppxBShsmboOi0rsWI0LXjkhxOb1dv6PjpH/ypILkFQrVAHaGf6WSWj/lLiHCCZNMOCFFM4YFKB+CENDA4IVHEEHq3//7QGQSAPK2SVH7KTrYAAANIAAAAQrtIUXsLK1oAAA0gAAABJLomPVordLtiskJtZ7fCIk8dHhEGf+1KDU6rE86Z5hY0+jDahvLzdhHf///9SegklhSWasEQdXd90s7eP2z4qiDpEubhKNxnFKL4u8/kfPDM2Ghc4cemiob52KSSNL5/Ck0SW/9An1Dogb/4iocDoswgJMz6/HISjL3DjB2LqIKHQdv///qCaA5YqpIoABURDsY//tQZAOA8o04z3sIE9gAAA0gAAABCkTjSeBhAaAAADSAAAAEhHA/F2wEoUII11hwY1QRaH/VZU7sUlcAUwelmHqskc3uKjxQk2qksDQ06/H/6hofiQzf+5nMAgcyOduRcIMbX5y0I9BwQr/5UjEoZjgDqsvvNrQASpQ3VgBB3/S4VCSIX9yjh19qSK3jfUOjkKpPph+93UsSCASi6bz/9Ad+MBwOh3//8INY02RSoskc+Qozxhr3XuNvMZD08oWFIlyhA2RabVesgD9AApw+gv/7UGQHgPKiOND7DEJIAAANIAAAAQv5BT3ssWtoAAA0gAAABKBR10/HJKvAglfYRXkF40W3XKF8ERgytaKmDxpO4qDCn13/8wA8KciQAxII/H/pA1WcWpRz3NNjLXgYKkk18t8W1dc2MpIgABkRnqcUfAx6MoAoFqSFN0kCHkx2oWQsEMjCAK1i08WLqpVTDOPw5A/ZvaO/oEJF5Qvwz5wYqocTw/mV//+2I4c1tSxkMPNtfkiL0vWyv3uWWcjqoHiYyGf///tPoGmjAGRWf17/+2BkA4DypUHQ+wlTSAAADSAAAAEL9Qc7rLDroAAANIAAAARwUBulG3NmC9x49ZLYektIm5XbhbqwM9kaYSRIlHqoe3SBpempcXBqLjJz7dwuizMVQDZf9N6UezzziSc6mYwJiByMuR/ervsrNb/+I739gRWuQNIfBuUHvShqt5TtyBVUOOEKJObIggqpXG6/vovfZZh2nbm3u9OxzoXGr0Uq636CEiQlRQFRfr3aQnmIPTSJ7MPNJzceJiMxFDvOH5ytQsJzWT3/Y9AgBp/1ACps0gB1h49tsn410cAfEByDqvSf61B1aTOVFTN+5QKTPRIG9R6zlFJEScn66cgYeNrq6Y7/+0BkGYDzD0jRewZDSAAADSAAAAEMRSFF7Czv4AAANIAAAAT9Q8OvXFROlz/HKwbcj0JPIe5Y6dPY4yoiuEUWJ3r8VLH////FFkZYnT///CQCFBVsAszS++kknH+rMw4qLGFygYKTEJZuTqHY5SwVFZGQ6e48kcPpycYw++M+rfh+CarpiI5e+Hh6OzOamhnFy31FvfSqJ559HZTzpketDz2cjnlihE08d+WL//1GIof/5QapCP/7YGQAgPLwSNB7CTraAAANIAAAAQqdJUXsIO9gAAA0gAAABKMAdlhpC5JeP+VSVpqCTFNwiKVOp54A+RHyjYyLoJRlBta4oPcLhqdlGoDTXS/8Tl0coeFiWz5QzYaoeacdLlXcrG7KzQ0apXlSI2NUeGnUwLB//9RqhK//ioXEJAuwAIZmbuqWfD/siEI80tDxsURHAky7FPBUFwHKLgXgec7r7pFlwL2j/Fjxl5JyWi3NA4/OKNp082qH7jiFlJjryjxmNDTPNx0k3QUHf////HgKKE98uAB1Vo/slu4/ZasqjWUHIZYFUKMyEoNi7URgIwGGFoZWW2ZhXPI7psoEwTFRhv/7QGQXgPLDSVH7CDs4AAANIAAAAQoRJ0XsJKugAAA0gAAABMxXP0UBxnLoQ0+t9WfqRjjs+Oj5KNh8s2ivKjV/CIt//+jfUbvMEkqIwXggDq0R8FXnx/osoxFugTHTP02RgCF1kBhkUivuNSjsaoYxfJnU9/l6S0VhLc//Gtzx3+UhjnVhrd7fQLTe+Lh17EH9Q6K///oL/iGFREOsCHAAVEVPEU0sP9Cc58pqVEXWDDFieVK4//tAZAwA8pw5T3spKugAAA0gAAABCjzhO+ykS+AAADSAAAAEAtAKGgGeVl/XlNWGTQI9txjrSB/S+dR30YCPVWE29fRHaRqnFymMg7cVERQPo6tlR8SfggmKf+e1uNEQehAENUWxFocD/7UEYiJtMmSTIEnjBM0I20NGHaujllaq5S2dZQ7+xnXB9gqiYt3//qQJaKAB1Vsog96EBEAREKGNZUPwSsFfp/q0YH/53IuCVQmjAHf/+2BkAgDyv0FQ+wY7qAAADSAAAAEMKQU57KVR4AAANIAAAAR3u1TVcD/rvuCRttXRsTxIVIse7M3FYMgODINARavZ5AQUkEN2ZKCcMFi7W/QQqerEAqLzH2coPmIQLDhgrKTiphJ2N8fEIsnnuq9/UtLFf/+PiW4RAACqjJGWkOB/xMYFQZQ6VyoUhqgmKRKaHHeqSt/pfFLlWlZphvF8vM6esvvJshxKDrd///goRpRSVVHoyu8jGMV5WxWvTthZy0EO/PaMS7bNWdPU7W7ERYeu3/tQMQBiqgmgAFREWyKJXjNgBzSMBqodhoYyEnJaikAQ5EoEqiAOnY7i00eUDjGmtM//+0BkFYDy1kDPeBhYaAAADSAAAAEL0SND7Czx4AAANIAAAARqgkUNWpT/8PH6G8Sov///Wezh9rV56pk3E+1aGI21Zh2kVV2PX1aSX////9Uff6Qq1AIdmf6S23j/nUJbSQEKEK+SiJVpw5P+7ESlb8uVYmeWWFKNsW+F1iec/9QGV0HIM42cMIN98OIlxf/zcJsh5OpR3BWTnzGutwZI2Yv58eQk6F04mL//0If/5UJz6kigAv/7YGQBgPL+SU97KTr4AAANIAAAAQqNJTvssOugAAA0gAAABFNUiuFxTj84mjqa4g4LcVTWsVa2W3AMgplHxkwR4tBOSSEgyc2F2W/CvZZk67pxfKCsUNggfyRSj+VZ0JkKEh0qYxx05WsWPKC0fYXjYh/oRnuFjP/8NN//EIJFmSZAAVGY7UYRONUIQOJCg5MsjUJQUBhJWLB6GqXzqC9YTxK5h/S3TktrYd/OrEDja1f3/EbqePFv5zpKqTGxYeH0b8/KVW6//l0Lf/1B63/8KgmJy1VakABVhWuUbPwi8rA4hZMhEbXTYSswYHJn6JJuKvY0NOUmcR9r4j7tF1LrMK+7Q//7QGQXgPLdSE97L1LoAAANIAAAAQpo+T/sLO8gAAA0gAAABJXK5ZGs8f4M/oMzeOEwmvz16MhHtNNPOYifNxcyIYQnfKNvuP2////9BHBCQsQYArKzOtyK8MgtJlBAm5FwLCHBLl9CMfJJErkUf+Okf+GIGRMQLpf9/T2ZgMiU6Fo3xxNCArIeo6qNxSYaWiycVzs6oqPiMfN+rVThX/isn/8keLQAZlZpKp9wIlTQZBIJGOn8//tQZAkA8t89z/sIVHgAAA0gAAABCfT3Q+ws66AAADSAAAAEkg44wQitea3SU0jpsIX97890hKW4m+ZaLYN5gwmBo4yzyjAFluIoSjlrmSTCi/5WRpY2AlDpk/vGAUGyRU6/75KNXNNEcr/gjGDXLgDo7N61NqB+yyYoN2hgVYKgTzHENCsgsIEvRMpH5NauEXxMVqE922OHvHKdUczrvMC+iHjr/5n1VTTzRohb6hY9ROX/C/KC3PEIf/jpGgiCAGVVf2OR8D/L2hz61GpXlP/7UGQJAPKsOM97KCv4AAANIAAAAQtA4z3sIbHgAAA0gAAABFyIYqQLU4777yHKLyQNyb4w1ShhcnjBSO2+gnBIkpRpF+5yWApYrGLlicbao8safX7wLwMGqrDv0Dav+IvjBfQBB/klmTAFWGX1tWgC9cEQEMAuMqqsEgYaJaFFLbTK9qSVsIGsTn7lCpUkqQH4vWQHVbBkRhp19H+dTyLCkcixA+e0efv/SImsWFxwlivIFxcIgwc7xqMLqQUlw7HqeZUQdoVvi2tQE7LQXgD/+1BkBwDyrzjP+wk66AAADSAAAAELOQk5rBmx4AAANIAAAATml6U5IOXyTITSKM5AyBQiJAggHziP9ebS226rQyckznoP4o/91flVRlKCguyrVT8dbPKJV6nqvqfRJVz5QKk3cEzNkHiOHyF/QElsaKSHAZEr9OeD2VmAWY4QmyMjH633dpp2np4Cv00u/kYKq9r3heFf/loFZ/5///h2QNkGMKfe5yPjbbM1Uc1VW0z+X6pZW9XOIaDepvQima/7JhsEvM1pogCUZWySjN4j//tgZAUA8tJIz3spO0gAAA0gAAABC5UjN6y86eAAADSAAAAEjXhSdCNXQ8dZKpDqjKZMD8JcPM0TSHBwQ+hkmlSE/ckb/57ypZG/8eLciKi3yWRUuearqXoPkS5vx4VnldyXOfR/H28eUCL/4rGQO/8oDgcHxAiUnoDiNH+MFCARtXGmUGiI8d7JzRGpxt26bHDO/i0ebt0bWkMeVw4v77+StTM3/4XXsXLfpqjCdiVT3HWcmfshoVGwhRgNP5puh3hCc3NHQmcxDG8UHGf+gc4IhQBEFm9jiK4/yrBlJZgLkhJZ8aMSfCb6PiwXbXBm+/8TPXB58Vgq+9obfE/YCObc/ZaF//tAZBoA8uFJTvsPOngAAA0gAAABC3kJO+wgseAAADSAAAAElMAYSehwhFiTmzmKnjWaYL6mF+yfKrL1f8v+VLt6tFcb/OKL/6GjxwTQgDQ5pI0mpx/snBKVDmD3B0LBhhJRP3fzpG+izltBqT38W7DfoPy6POU6oAwK49GG1HD8B0OTg8Q7h0jheimr0+maEUn/yYIHYy8QapBT6CZD/h04dDfjA38ze7QgiGh95LHAPhhcBjT/+1BkBwDy3z7QeyxC6AAADSAAAAEKrQFF7CSroAAANIAAAASkwZlmSQlRTMdAoDxCRxAqwPaJJ8zA6zHXZ2KOV33ZZ0UMJI4ar924JaWY8StqyuclySMeMOK4haplv9zRzV7VJ9c2f/4gHQJ/+BT5Clr1bAFOzt+9ZYB7P30fhjaBmIiG0FOxcXgOAwr4pGYmv/SKulv+Zb0sd4jT0tv28KiyKEg6G4ihzOcwsY0TILIU6Lo3VRytiLKdqgpo/gMQxowdQvLjFWvDAXWsje21//tQZAQA8sdBUPsJEvgAAA0gAAABCpUDPewsTagAADSAAAAEQD7BtaSGGpghVdNxtSQzUswa0epZGyRJDnTCQR1KqdlXl7NloaDrTEls2a8a3o1CClcIPqJUjg2F5DssDVA71E9SiBImG0+5+cIN0LQV+FBMs0QCps7/NxpAY6GsE42FggMTLBGDkMmWV4XBcf3FK47Yf5r49n0DupbTssTglA0buim3PPTiSjOrAn/yjjHDC1eBGmIhb8jFwZP4CE1FGAf/qiQaVXzHEIh7f//7YGQDAPLHQdF7CTroAAANIAAAAQs1B0PsME3oAAA0gAAABPXawDcwZXMEXYFeSsRqVeh0W50Ch2YyLID6z5bS0oL7PaUU1/qVyCYHt1d/mhA97FH+eflRopZBujjQ8amEB00g66EH2KMY2g4Tczj5B//kdRMe00ohLREf/azgfkITqByNqHUt1XMqSgv16CAnj9eGdnvmWKPve65B9/hdmdXhFR/52N+XF79DZ39yAhObs7JSaoUpQFpROzWejgQ2dq2THOZuUv/wQFcKIAllWqMAQ0VZpY3d6SwjoYiBcSaFIn+0gGjHqRgDAUJFCBgffc29bRuQaZCJHVvmAeJyC4drZP/7YGQaAPQjPE97CUK6AAANIAAAAQ24szvnsGjoAAA0gAAABGibB0tT2HnBUaehzs/A2hZyHREGWpPA0h1MEk6vUMWKMj28WMNxsJ7nyBMPDw8AAAAAAw8PDw8AAAAAAw8PDw8AAAAAAw8PDw8AAAAAM///SQ7iEQyo1ZIt96nSy1grwMsyRygZoLhCLT2DkcmK1aAqqqzMzMzMqr6qqsx7MzeqqqgKqbMzMzN1VVVUvbnAwTCfr7whvnfFBQUbFd//////////4KCgoMFBQUFRQUFBSQUFBQUCgoKCgwUFBQUqTEFNRTMuOTguMqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqv/7EGQRD/AAAGkAAAAIAAANIAAAAQAAAaQAAAAgAAA0gAAABKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//sQZDMP8AAAaQAAAAgAAA0gAAABAAABpAAAACAAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+xBkVQ/wAABpAAAACAAADSAAAAEAAAGkAAAAIAAANIAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqv/7EGR3D/AAAGkAAAAIAAANIAAAAQAAAaQAAAAgAAA0gAAABKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqQVBFVEFHRVjQBwAAUAAAAAIAAAAAAACgAAAAAAAAAAAOAAAAAAAAAEFydGlzdABTb3VuZEJpYmxlLmNvbQUAAAAAAAAAR2VucmUAT3RoZXJBUEVUQUdFWNAHAABQAAAAAgAAAAAAAIAAAAAAAAAAAFRBRwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFNvdW5kQmlibGUuY29tAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAM';
	SOUND_FILES.whisper.OGG = 'data:audio/ogg;base64,T2dnUwACAAAAAAAAAAAAAAAAAAAAAFwISF0BHgF2b3JiaXMAAAAAAkSsAAD/////AO4CAP////+4AU9nZ1MAAAAAAAAAAAAAAAAAAAEAAAA3gACkEFH//////////////////3EDdm9yYmlzKgAAAFhpcGguT3JnIGxpYlZvcmJpcyBJIDIwMTAwMzI1IChFdmVyeXdoZXJlKQEAAAATAAAAZW5jb2Rlcj1MYXZjNTIuNzMuMgEFdm9yYmlzK0JDVgEACAAAADFMIMWA0JBVAAAQAABgJCkOk2ZJKaWUoSh5mJRISSmllMUwiZiUicUYY4wxxhhjjDHGGGOMIDRkFQAABACAKAmOo+ZJas45ZxgnjnKgOWlOOKcgB4pR4DkJwvUmY26mtKZrbs4pJQgNWQUAAAIAQEghhRRSSCGFFGKIIYYYYoghhxxyyCGnnHIKKqigggoyyCCDTDLppJNOOumoo4466ii00EILLbTSSkwx1VZjrr0GXXxzzjnnnHPOOeecc84JQkNWAQAgAAAEQgYZZBBCCCGFFFKIKaaYcgoyyIDQkFUAACAAgAAAAABHkRRJsRTLsRzN0SRP8ixREzXRM0VTVE1VVVVVdV1XdmXXdnXXdn1ZmIVbuH1ZuIVb2IVd94VhGIZhGIZhGIZh+H3f933f930gNGQVACABAKAjOZbjKaIiGqLiOaIDhIasAgBkAAAEACAJkiIpkqNJpmZqrmmbtmirtm3LsizLsgyEhqwCAAABAAQAAAAAAKBpmqZpmqZpmqZpmqZpmqZpmqZpmmZZlmVZlmVZlmVZlmVZlmVZlmVZlmVZlmVZlmVZlmVZlmVZlmVZQGjIKgBAAgBAx3Ecx3EkRVIkx3IsBwgNWQUAyAAACABAUizFcjRHczTHczzHczxHdETJlEzN9EwPCA1ZBQAAAgAIAAAAAABAMRzFcRzJ0SRPUi3TcjVXcz3Xc03XdV1XVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVYHQkFUAAAQAACGdZpZqgAgzkGEgNGQVAIAAAAAYoQhDDAgNWQUAAAQAAIih5CCa0JrzzTkOmuWgqRSb08GJVJsnuamYm3POOeecbM4Z45xzzinKmcWgmdCac85JDJqloJnQmnPOeRKbB62p0ppzzhnnnA7GGWGcc85p0poHqdlYm3POWdCa5qi5FJtzzomUmye1uVSbc84555xzzjnnnHPOqV6czsE54Zxzzonam2u5CV2cc875ZJzuzQnhnHPOOeecc84555xzzglCQ1YBAEAAAARh2BjGnYIgfY4GYhQhpiGTHnSPDpOgMcgppB6NjkZKqYNQUhknpXSC0JBVAAAgAACEEFJIIYUUUkghhRRSSCGGGGKIIaeccgoqqKSSiirKKLPMMssss8wyy6zDzjrrsMMQQwwxtNJKLDXVVmONteaec645SGultdZaK6WUUkoppSA0ZBUAAAIAQCBkkEEGGYUUUkghhphyyimnoIIKCA1ZBQAAAgAIAAAA8CTPER3RER3RER3RER3RER3P8RxREiVREiXRMi1TMz1VVFVXdm1Zl3Xbt4Vd2HXf133f141fF4ZlWZZlWZZlWZZlWZZlWZZlCUJDVgEAIAAAAEIIIYQUUkghhZRijDHHnINOQgmB0JBVAAAgAIAAAAAAR3EUx5EcyZEkS7IkTdIszfI0T/M00RNFUTRNUxVd0RV10xZlUzZd0zVl01Vl1XZl2bZlW7d9WbZ93/d93/d93/d93/d939d1IDRkFQAgAQCgIzmSIimSIjmO40iSBISGrAIAZAAABACgKI7iOI4jSZIkWZImeZZniZqpmZ7pqaIKhIasAgAAAQAEAAAAAACgaIqnmIqniIrniI4oiZZpiZqquaJsyq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7rukBoyCoAQAIAQEdyJEdyJEVSJEVyJAcIDVkFAMgAAAgAwDEcQ1Ikx7IsTfM0T/M00RM90TM9VXRFFwgNWQUAAAIACAAAAAAAwJAMS7EczdEkUVIt1VI11VItVVQ9VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV1TRN0zSB0JCVAAAZAAACKcWahFCSQU5K7EVpxiAHrQblKYQYk9iL6ZhCyFFQKmQMGeRAydQxhhDzYmOnFELMi/Glc4xBL8a4UkIowQhCQ1YEAFEAAAZJIkkkSfI0okj0JM0jijwRgCR6PI/nSZ7I83geAEkUeR7Pk0SR5/E8AQAAAQ4AAAEWQqEhKwKAOAEAiyR5HknyPJLkeTRNFCGKkqaJIs8zTZ5mikxTVaGqkqaJIs8zTZonmkxTVaGqniiqKlV1XarpumTbtmHLniiqKlV1XabqumzZtiHbAAAAJE9TTZpmmjTNNImiakJVJc0zVZpmmjTNNImiqUJVPVN0XabpukzTdbmuLEOWPdF0XaapukzTdbmuLEOWAQAASJ6nqjTNNGmaaRJFU4VqSp6nqjTNNGmaaRJFVYWpeqbpukzTdZmm63JlWYYte6bpukzTdZmm65JdWYYsAwAA0EzTlomi7BJF12WargvX1UxTtomiKxNF12WargvXFVXVlqmmLVNVWea6sgxZFlVVtpmqbFNVWea6sgxZBgAAAAAAAAAAgKiqtk1VZZlqyjLXlWXIsqiqtk1VZZmpyjLXtWXIsgAAgAEHAIAAE8pAoSErAYAoAACH4liWpokix7EsTRNNjmNZmmaKJEnTPM80oVmeZ5rQNFFUVWiaKKoqAAACAAAKHAAAAmzQlFgcoNCQlQBASACAw3EsS9M8z/NEUTRNk+NYlueJoiiapmmqKsexLM8TRVE0TdNUVZalaZ4niqJomqqqqtA0zxNFUTRNVVVVaJoomqZpqqqqui40TRRN0zRVVVVdF5rmeaJomqrquq4LPE8UTVNVXdd1AQAAAAAAAAAAAAAAAAAAAAAEAAAcOAAABBhBJxlVFmGjCRcegEJDVgQAUQAAgDGIMcWYUQpCKSU0SkEJJZQKQmmppJRJSK211jIpqbXWWiWltJZay6Ck1lprmYTWWmutAACwAwcAsAMLodCQlQBAHgAAgoxSjDnnHDVGKcacc44aoxRjzjlHlVLKOecgpJQqxZxzDlJKGXPOOecopYw555xzlFLnnHPOOUqplM455xylVErnnHOOUiolY845JwAAqMABACDARpHNCUaCCg1ZCQCkAgAYHMeyPM/zTNE0LUnSNFEURdNUVUuSNE0UTVE1VZVlaZoomqaqui5N0zRRNE1VdV2q6nmmqaqu67pUV/RMU1VdV5YBAAAAAAAAAAAAAQDgCQ4AQAU2rI5wUjQWWGjISgAgAwAAMQYhZAxCyBiEFEIIKaUQEgAAMOAAABBgQhkoNGQlAJAKAAAYo5RzzklJpUKIMecglNJShRBjzkEopaWoMcYglJJSa1FjjEEoJaXWomshlJJSSq1F10IoJaXWWotSqlRKaq3FGKVUqZTWWosxSqlzSq3FGGOUUveUWoux1iildDLGGGOtzTnnZIwxxloLAEBocAAAO7BhdYSTorHAQkNWAgB5AAAIQkoxxhhjECGlGGPMMYeQUowxxhhUijHGHGMOQsgYY4wxByFkjDHnnIMQMsYYY85BCJ1zjjHnIITQOceYcxBC55xjzDkIoXOMMeacAACgAgcAgAAbRTYnGAkqNGQlABAOAAAYw5hzjDkGnYQKIecgdA5CKqlUCDkHoXMQSkmpeA46KSGUUkoqxXMQSgmhlJRaKy6GUkoopaTUUpExhFJKKSWl1ooxpoSQUkqptVaMMaGEVFJKKbZijI2lpNRaa60VY2wsJZXWWmutGGOMaym1FmOsxRhjXEuppRhrLMYY43tqLcZYYzHGGJ9baimmXAsAMHlwAIBKsHGGlaSzwtHgQkNWAgC5AQAIQkoxxphjzjnnnHPOSaUYc8455yCEEEIIIZRKMeacc85BByGEEEIoGXPOOQchhBBCCCGEUFLqmHMOQgghhBBCCCGl1DnnIIQQQgghhBBCSqlzzkEIIYQQQgghhJRSCCGEEEIIIYQQQggppZRCCCGEEEIIIZQSUkophRBCCCWEEkoIJaSUUgohhBBCKaWEUkJJKaUUQgillFBKKaGUkFJKKaUQQiillFBKKSWllFJKJZRSSikllFBKSimllEoooZRQSimllJRSSimVUkopJZRSSgkppZRSSqmUUkoppZRSUkoppZRSKaWUUkoppaSUUkoppVJKKaWUEkpJKaWUUkqllFBKKaWUUlJKKaWUSgqllFJKKaUAAKADBwCAACMqLcROM648AkcUMkxAhYasBABSAQAAQiillFJKKTWMUUoppZRSihyklFJKKaWUUkoppZRSSimVUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKAcDdFw6APhM2rI5wUjQWWGjISgAgFQAAMIYxxphyzjmllHPOOQadlEgp5yB0TkopPYQQQgidhJR6ByGEEEIpKfUYQyghlJRS67GGTjoIpbTUaw8hhJRaaqn3HjKoKKWSUu89tVBSainG3ntLJbPSWmu9595LKinG2nrvObeSUkwtFgBgEuEAgLhgw+oIJ0VjgYWGrAIAYgAACEMMQkgppZRSSinGGGOMMcYYY4wxxhhjjDHGGGOMMQEAgAkOAAABVrArs7Rqo7ipk7zog8AndMRmZMilVMzkRNAjNdRiJdihFdzgBWChISsBADIAAMRRrDXGXitiGISSaiwNQYxBibllxijlJObWKaWUk1hTyJRSzFmKJXRMKUYpphJCxpSkGGOMKXTSWs49t1RKCwAAgCAAwECEzAQCBVBgIAMADhASpACAwgJDx3AREJBLyCgwKBwTzkmnDQBAECIzRCJiMUhMqAaKiukAYHGBIR8AMjQ20i4uoMsAF3Rx14EQghCEIBYHUEACDk644Yk3POEGJ+gUlToQAAAAAAAIAHgAAEg2gIhoZuY4Ojw+QEJERkhKTE5QUlQEAAAAAAAQAD4AAJIVICKamTmODo8PkBCREZISkxOUFJUAAEAAAQAAAAAQQAACAgIAAAAAAAEAAAACAk9nZ1MABMBXAQAAAAAAAAAAAAIAAAD4NS408TxMRkVBRUdGcmxjZP9m/2b/bf9w/3//g/+Y/5D/hf94/4X/ff+H/5f/nf+w/6v/tP+v/8T/5v/Z/8L//wr/8v//Cf//Gv//Qv//M///Jv//Jf//Fv//Q///L///RP//Lf//V///RP//XP//QP//Ov//RP//Sf//N///Vf//Qv//Uv//VP//UP//Y///WP//Xv//XP//Z///bP//YP//X///Sf//Uv//X///SP//cf//pf//gP//af//a///Yv//Yf//Zf//g///VP//Sv//Xf//YP//h///jf//P///U///VP//gP//dv//gf//kf//uWbcEKnOCyfhBKgUaIRauf1eNmaCKfCH7uS4xvHvb//+/Pvz729PSznz/N/jr7bFcaGtllqU/OP7/guPeATMBJ0LWyj5xjvMCU7Gh5X4Yj+eMZYm1QDyauvX53C2r8iF/Fz/rwN+c1na/58n4rKM59qRew+HyfWtu7Vl8r/EUe1GLf/3Px6NJZAA5AAxym25SiXYOAXfygEympdylk3Ai0+WpYrIMpk0Y4DQdhMSSy1kiVp6BToEUXStAiFlt3cxA8yRC6gG4WABKTfSfoRsqeQAizgffLWNV855EyzmdNBdbgKlaxfbkV6qw4AsgUpxz0IgdFkx6kEeM9eczpApsh4xDyaZC8GFnxCn+QFIKLOxcy0rL+QEd0nJXpc+cJic3y4l2evSE5ZllVlWUoilMAYcQpLoHDLUMyDYCYLXcJDJUQWDa1RcSbGlQUB7ngEAMEJ2ic4B3AR3EabVkSeGJr2b3y7CtDpmY2jRKLaR6b0gqAEiRAARFhELY0IdgXkczLnEFUG8JoFZqDVO2jWhKxA+sgE8SmoKvEkA9AB3EG3oy7TpDU2ue4A7iDb0pT3pDQ2+yrJmhjKZSVZAkhAkhLBAIkLCxUAcOiPC75gVaY8UQfWRIzzMQDiVCFpzCF6rlAHsAK9wY1kP8yBjMUC1A7zCjeU8zoOvGKAqiyrVMkgp1QEInSABvYXQSDuSk3oNx8GwqCNermNemVFEVAEOHmMEgNFVAgIRLBFpREtl3V4wCs7kEpFGtFTW7QSjM9udFaVMmb0pjDNFSlRXlqXE5HAlQMHhCAQUXI64QIQCxaKiFC0uFBVQJBLyerFEe5kTtopDZX2rvcXOgQOL2pqGI3Bg7xiGaXXCMVNN05x+UkwDMLzfn/xYwQQAjAGLUM9LXMSLz6ZnbxsDFqGel7iIF59tz/6vsrqGiIqCTTXZTjZFRqKMqI5iwAHAUrIUEAqERASUKEWJEKGYOEUEQiETmiYspGkaAEFASBJQouI0IWGaDp3020mLFXtDTFNtAETlegxIqpQBfEVfb4y7tbFPFkoYbV/R1xvjbm3sk4USxr8qK7KsJtO0qdK2IxERooZA8LM6CwBAJABmFhEXCilxmhYVEjEhg6aYpgkBSyEJDBAxEwOOG1ht7e0dszUsDhyo1d6BnYGtvb0JBHLLmYAVW7V8KaH5B3LLmYAVW618KaH53woURYbNqefaKaIsaqklMiiqaihL8mYAQMDn8xgIuExTEAERJyIQoWhxFgQGCZYEIRnaXdyhCACr4dCBxZG9nZ3VYorh0IFDrKYIBhq43ZD6fUif9EkLiSqj0uB2A+bPIX3SJy0kqoxKbyGihrIqEpkht9N17UuiWgYAGqDtM5GpEpDw5qYPBEmURdbMUpqGWjTImfMdAMioTG0AAwAAAAAACHG4jjJ8AY8jJDwBj4gJRERExMRYREREHDTNgmX4HKGQwwJ8FkKAgGICUAQULU5LEiwBEBGIQFKyECAWYBaSBEAocZqiKFGaFhUnEFIOYSnDAjyWCvkCMaFQnGYmAiEBISBWRxZQUawWrIaaDqmj8IGEMkpewPXimCtMZi6OB1wMEK6wWghL+E1kAgAmj2QAiqiaVtTezrA6AlCHagE1MC2ioohhJ2KqqKqBIgyPD0y4MmGYFwfAJEnm05DkwYSQ0+IQCIBryCSPgWOGnVVMe1PUEDEMTIFcj2OYMJlQQUXBtDUcF9PSHX0MAJg8cl1DQoYBkjlec1xEoQMYITQAEFkHODR66iRhLPb7/X6/D76o3cBMmzVHu5KROidbf6J+i9oNzLRZc7QrGalzsvUn6nfYlZCkbl8lopwAOACeW1vARwg85wYBZFQlGA/ABGD2aIDjDYCQNYkNWAAAAAAAAERIBCIsJiJG0xQLwUyLUEICMTEBUyKERURYvoC0JGEZwmcoC4aFNGFCE4oiLAAhLCCAQEAThoDQTACAxcXFxZgSEhAGQEG4HMpliZABnxAAAIhQQBOApoVgAAAAgBCIQCgQFwEtLhSI0ZQoFwylACUQclkhXyjGRBQMQCAOiIEdj+s4yJU5jmsyQxAUQU0xbWwdOqne6dLDIeYxmWQAMmPQmbBadDE6AUAyr8AkV7geF3MQJhmoHbaqohaLKsBpwZETAGACQOYxB1dkh+FjCDU6TCDHKwBDIMAx4ZgHw7BFTKvYm6ZhithbHDrDx2CITqeIYhWwUwTBUFEDxDRs7ByKoQB4AQAAAMChAIZpWDAGTu8KAz44zUu3cvnZL4ro6XQxxA1O89KtXH72iyJ6Ol0McSfa6KyQQVJkiJrFO9VYWSEBdABKAJIoqys2cLDZAJQAmVURRTCMojITQBdlAFmFZDc6TI+iAeYGEIlaqgMmUQ4AAAAAABBCKIQ4WExUTFxcTJQIKZhAJCQgSLCACLmEywMPhEcZwhBmAQEtBM2UkIgwACIwgwiSwEyYGUKAGcxCEFogIgChhaBpFtAEBCJJJCUxgZkEpBSCJIOYAEIYUFDwKUNZQkCzQJRFKHGKgCmaEqcYQiERiAkEAgYlIEIQAJCUgomYaEpAAAYLxMXFRBguR+HzjJ5YACGZB4EcuTIX1wHAHC8+GKHX66kn9hbsTABDFbEBwDyuIR+u60pyvEgSmCPHxYvAccFjjuvIiTCM+vBRhy5DCAOjh8sOsABW00AtmHjMxVzDcQTmOK4XAAAQJioKqJ0hANTp8rAIVzcAEOiCwOj1iISBeT0AAADeV81LsY3x31deSQuzXDbMCvZV81JsY/z3lVfSwiyXDbOCByIFAXO8MlEuTQAMAgBUqJkiQEVmZWUoDafMWmQAtKMUhIiomTUUGUUcaRICUEUIGpvYA9j2iASUBwAAAAAAKIEoLSIiRotRAjEwoQSUEKJiTNGEgjglynwZGZYvxgNYCp4AISwIZQkIAeEQIWEYTAQWkqUQgkBEkqWQkgkAAAkJSCLJUggpaYEYE1EBKNBMCIMWMgsIoUEAgKaZMEVAhBRAExYhYsxgMCihkKZA0aIULU4JBUSUmRYy4OB1HS+OD8zkegyPa/K6jtdcvEJ4JJO8Dl4HGTAkIiyIbDBMcWSAxcRGTDWtjtmCiik2htUxVLoNsDUdWQEFW0cWsVgAEPJKrnkAmUyST48rgUudJJKJIEZ4HTMcMxe5Epx66mlIbzIZksdwZKBzRAEgQq5wDfOaMHNwUjgRGQzQ6eAJIukBOHV6h4qK444bJgAAnifdkE+d+O+5P4aSUjlRbIE+T7ohnzrx33N/DCWlcqLYAv0xc8CR4DxfiKwhAwCvFkwbUAREqi4jI+MEFqKyhhoAoM6DQBIqq8CaEWzvZpNF9RFtigNkewZgMCQAAAAAAAC0KBGlKCaEggiEQjEBzURIEWaBGIsKRSiWy1KGzzAMH4QrZDkCwgAgCiELRJlmgARLgmABIilBCAAAtIiQBgEkWApiBiQDIDzC4Qm4PA6XBYfH5dGEaUKLCsQpQiCgBaApFkCUFhMSQokxgAAElJi4uAhTNIQ0TVMEgIgoRYuLQsi0gBAhREQpoYiQMAAmRJQJAwAArxyvT68Aj9d8OGaO4XpdgeH16aIqIgBgqgOH9o7rYgjwuK4LYTzR6yI7w6iKYdoLgICtfWQAdMaEhcCAqpqmIhiqdgbiwIHVtLMRVFVVMQ3DIQAAiGMCzDFhCB9hAbzL5QofAOCC4UpeB60kAAwXBwBAcWCKAgAAJCyi9mpYTQQAAADM8SEDAP4m3XilDu3/Pe3jJUgyXvF/k268Uoe2/077eEmSjFeMWzWJHQAya6ziZaqsjgSgQwMBDbblNAmkVEMGAnj7cUAYFAhlZRWYpjMZUnWlTMBPACVAdQDOgZRBRFU15QEAAAAAANDi4gIREQEtEAoIsyiPpRyWUMoFSwUcwnJYAQGHUIblcImAQykwYTCzqAQFIgIQgAEw8foZAjALorclAgCghIQpOkXjlwwQQ0JAvPD0EgjEWAhanCIQsAyF0DHV6jBXwPBYkhBCSEGSQGCmmYJAnAgJAAAACBACzARiEAAQg0lCsoQ0RAwTw7Da2NhbbexMHBcHzHEMx3W94LqYmRyTzKcPEimS0+gpoRYodZEwDC6vIzA+fBTUXx0FgMZ3XPCMawYwIlhmnN40zfI/xZBJOywCoIoYMgIAAKIOMO11cgYHpooFxIH68OGa6zIeXAxJDHsFG9MKgIhkAADIh5kjAAAAAAAAPn0ABhEMgE+vuS6OzOvTJ2auvb0JFsOBRQAAfhcdIusl9b8pj2jUFFIkFPLvokNkvaT+N+URjZpCioRC/tkQ1YAAQIpChZfUJMoAJAsgepgEZXXIYBiQGTWmFEeXgAmJ6ULNSCGFECgDmanGIiM5IXBWEQkA7zxFEaqRYMECIfUGACqLhJbBjFkAAAAAAACUS8CBQMhSLiMklOFTLssFIURanCsgDkGGw7KEy6FgAEI4XBABxBgAEYpBlBIFSICYmYQgCAEAAAQkIAgkIipOABDQNC0QMLMImGlRMTGhgAAgQkgCiARLlmDwGcIBj/C4AkoJhxJCi9PiouIQEEDAIpBSAgCYmJhAIAkmMFgwS7CQYoAGEwEBAyAAKJfhsJTPFfD5jLgIgwEIIU5RApqGUJxFiLiYGAAAsJgiCjZgb7VzaKIWU1TVsFUBdSQOuF7D5PiQK5NrDkiuzOPxmkxM096BFUUAwYKqOm5Vh9gBAKYCoKZpZwKAyWQex6fH5Lqg2KqNRRQRewMSOfwAEMZkmGMyGYbjsRcAAMFQi2EAAIZ5TQAAAIKKY4CInZ0jTEGtVgBeBx3g6o7/N/OjM/sS3HKFiBGvDjrA1R3/b+ZHZ/YluOUKESP+lbKsRqAiI0gJMmssxDtVVwUAwJwWwK5hkp0A1GMSgzlBb9sBgwKyQnUk7sgU1UWCLLIDuI3OLAskCKkHAClrLKoLgCiJGAwBAAAAAAAAhACxlJIlS2JJWQEjAGHBgqU8KmQIeAIBpQzlsQzL59ACppkBpgkLKCFFGGABKMIAi4hRhAmhKYZQlICihLSAEjKhRUUIACEIKBrMDICixGkatJAwEaFo0DQTCEFoEVGK0CJMmABMCYUsjwUIw4Iv5DEUUkBCMogBASYiDkLRNEUAgImACUVTlJiIuLiYmIAwGAREVCBKU4QAgIAEAIBISCBJMkBgAkkiKQXiQgiEAkIAAAAitgqIacEwHViIsQAP6ghbtVNVtTq0tThmY5o6BgOAAgDF1nF7JyxixXRlkmuAXC+SAMBxTI4ZHjMZcj0uAIAaJqIWQTBMe3FIAQARPk0AgCG8PgAAwJFPAAAAAKx2gJg2trZ2CGI6bgse58zycZP1H/vzUruGZ0suzpnl4ybrP/bnpXYNz5bcYLGZMgCIKGd65UQpAAxAAKi2gWCATELUiMykBEhlRXXiyayOBGRAqkYk4M5ERQ1lZQQAP5guOclNZHUSCYDOiTJrichAQCWkDiSbCbMGIwUAAAAAAAAWiNIMQgsAgIaokLIM5VAO+DJ8MQjwKQspMRlKCWW5DJcKEhMkg1lASkHEoAhFM2iKiAoBSCmIBViyFBAgAAAgWJAAQMQsiJkhiIRkJkFSMlhKAoQUQkoJwUwEFpJBGIRm0AJRcTEIBGIQiNG0gFCgQYiIQAxEzBBMAAAATAQhpZAEkgwmDEogYBpSMYAQEYEoDQA0i9KUmKhAKACEIqI0YQYAmBYUwzQUMcSRA6sZmEeuXEdyfHjBY7gG5pHr8QoH12sO8oFpMAuRCAMAWAwTVotwhi+SBwnMYxgmj4VVBwAAAEI+Dbku3t4IYyJGrQVdzABArsfrAAAArvA7QEDt7e1V7FEA1FTDYrFVRXEAvuYcxrdNxH/sj2q0qCQO+jXnML5tIv5jflSjRSVx0A+WneQAIFMlwisnygDQ0yAAioqAAYCsrqyCJ6srKhIgEyqjBlmQ4J2prCoJgEhCgxBqIhAPMrIsA1kUNVRnJgB4KyWKmokAhAlxAQBZQ1B+EVFjSSYAAAAAAAAAIiIiKhSHuFCY5QCHSwkHLKgkj4W0jCBLIS0iSRlQPgXDAOBSRkhZwgHhMSwXAAAwBBERM4gFgRlgYpAABBGzIIYQDEhBTEQkJIQgKcDhciAEV0gpuITlMoSAEMQAETMLIUQBAAAAECwkMQsiSSACwFIyM0kCgQkMKYkFBAgAbC0WEVVbG6va2VmtKleYHGHmMQ+YmQzhFYbhA8NUtahpq45ZwGKYYzJcA7wIF9fjejGPIYFc12sAJgAAzLw+XcwMAHVk2AKgoIpdhBOAywW63Sh0AQAAMPm0iIiiagcqiNGNAKBr2CNq62zYGwoAECnUWPROWwDFxFbtrVgBXrYcVOZ3En/Ci3erxpPIFqpsOajMbyt+wot3y8aTyBba2UBlZmRmACBDteSlrLHGAgALIKZVEpCBiLKKwIfjCNcoa8wIAAg1EAkYz5WhopCRkRSGy8iQqVKVEHmBqEiQqUam/CijupSVIQtESN0QMkDUrJkgDCZ0OgAgCQAAAACAgIIlAgIBpXwGlGXAEspIQyghAyEErS0zFJAMSwjLhVAmYIAhIEwJIE6Ji9A0TQgBAIAScAV8LksIQIWUBQUAwoSFQjGhUEjESbAASwIxE4MJ+AJCBYTHgkMBgFgIyQAxMUGyJBZCCCEJIAAgJgBMggSxhIBgkiwECQIJgFgCEhJMgpZSDBAwxTRkEUmhUJRFKRmEEiUMAL5tDFMwrLY2fqkfMexExDMMURPTRmzs1aIiYBpqOrCihsg1ZD68Jo9rBo5XYAAAAIZp44QjUwFAQYyP5GVkxxUGyPWYCUBMK4KoVRE7q0NMwwQAAMDoN0+c4aMUBtDtttYaAFFbRyYKAGChAD62HOLXbvxP+5XdoXPhRYmCJRxbDvFrt/6n/cru0DmLEgVLOFi0OACQ6oJ3qqEsAQCIHaxcg2RQCShrSKAAwj5qrDFBiiCDGotqygSolD9r1lKllFJmCaEDoLIqAy9AAaCCAg6g/BBZLSpDiiSkMQHcACCrakhwoPwiQ00AAAAkAAAAABYIREUElFAAmmnwuYAAuGD44HCFREQg5DgOy+VSeDA0xmFaQLMQlLgQIIVXjAklRgiXQYzFWJQSiFPMIgKahhAiAgJKClg+pQxDhYyAAZcLACCEogViAlpIiwlAsCAwsZSChWQwgSEEAAFIIgZJwUIKISWzHBCWUpYAPCGHy2dZcBguOCxhwGFYBgBFKPFClAAAAAIJIZkhSTILAACYpoUMAAAAACAmCQgWE9BMACYiQlFahBZKLilJgAEAAACIaRgINvZqUcfoEDpEtmJjOm4YqACY0tEpjIkIQHz4HQEWB1hNVUUFEbUH/YnhcR2ZAHAcn65FgA8AnsbMkudf8rTfVt+Qgy/YWlDMViiNmSXPv+Rpv62+oQZfsLWgmK2wswHIsqwBAEIVXjlZDgD4gDkXQKqhMjCoBLLmQKIEkKrKIG9VNasDRMJI4FH+qFmVRWYIQhpEAqoLcIuUFUVCZmVVAAgZEFkNGAxttykIaWyA4AaAImtWgi5R/oiozAoAAJAkAAAAAFAKlsfl8Xlg+AyHYYQAwxAeEYpTRozh8MUkIS0UpACHEsKCCTMgwswCFtK0BFgAAhCCpCAuYwAgACtg+QwREABgI2ZIEpJBSUISASyJhZC0uIiABmFC0SAAACmkAJiIARDDYSh4HAHhEggYUCmFlAIgCCkEg9AUAABgQlNMACYmEEkw4ACzqDhFg4AICUUTIMAQF2ExmgAAAAAAACEppoBpgJlmr1h5irFPTE00SQAAAFaLxcA0xbRxYBr2NvYyXFwvHhMe14QhMGQCyWtji+HA1qEAAOiIyxkKAI/XlTnmSBigomIaVrGYGKriEAAADMx8oAM4AGQAXsbM8ftdxHN+W+1Rgk+nYBwscZYxc/x+FzE6v632SMGnUzAKljgHD1EEiixqCQCkGl6FOgkAjFOfCZCoLCIYRAJRWYaAhhV8UZEACFlOGAKAunJRkwQQaaCEFFmzqkQ8SFlRIQlZVZEAACENLVZCRGQURUZWB0IaC4TUAxEBQVUmiER1FgrKLzMrKwEACESSAAAAAAhSMhhEglkI8FkCLjhUgIgKighQCaEUFSSUS7igYChLKEIRQmhCU5SYQBSSBbEUzCSlZMEglOEzlM8XCrlcIQsAANOEiIkDEIDlQMAglwcCwlFUCrNQoL2aqIFHNAAAuEIuR8jjEkopeAyVLAVIkmQiCZIgYpCQgJCQYCGYGQAAAABACGFxMaYZAAAmKQRBEhhgBgBCxCBgAjAAACDJkqQAsWRJAsQBksCSmIkgmQEiIgCG4wjHcWU+zDw+hMdFGCDH8eGlVKdzGp0F16e5Xo8LAOAzfATEAwCcJIyeAkDUUNQTi/o2uwAAAMBw5TMGAABMO6sIAAcUGAturfXlAxcsAN7GVNB0WTMav1f3PUOOUSFOllwbUyGmy9hn/Fbd9ww5RoU5WWGDBadJAKgKXnkoKScADkAAzg0cDBIZkLJGQH3ySJUVKRCBpKxZUWMWygSE1FmKrE5AmQxHgDJqKaSMkz1bbEUCAIQ0JnAeSEoFqsskJOMJMFKQSVFVQzAY0ZIABCIBAAAAUSEhNCGiIqCFYkQg4AKUclwB6s3z4Z65XO8gUhAFKOWyLIehNChCQ4wwQAS0AASEKaZpJiAsJipgiECMBpgWEaGJUMgVCkF5XAEPDBUCVM74WBRYSIBJSCSnZCmpMQDwBTxCeJQDQjgCliGQEGBiKSAEmAVCWkQgTlFMixJxCGkBwQwAAAAAYBJCUAIhAQgIQ1IkFBVJNJYAE6GYCMBEACLupQYm2SFbzwtSMMTFJShBCgUREwczRA3ToiqOWW1sLaaCPCa5OCZDXoTXh8kKAMN1aSSXXg8AgEn/o84EEzWnBwAAEQwceQYAAAAAAACHPg0AAAAATD7XrDEZaKyDDVOmh2liAAB4RwwEYMCvDljSzgvrAgB+puTV5atcPnrvNkIuapxktgKfKXl1+SqXj967jZCLGieZrcCDBfIEADW88lTJAgAOQAA55wCZ1WUqrBJAGRCqKgElAFGFcHbUGAGAgHIIElAAnCspalaUKQhFdSVKFUAZ1ZUkH2RRWQIZlaoAAEIOZDXATEjG4ZRARFaXifITlVGdEglAJhIAAABM0QRMmBYRE6FYlBJjhAJ8hgUVikhKSwhQSUkZcHmUUg5hKAiEFIuICggNmgZFmAkNiIKZAAIxWhzERCSYhSASkpmZaRaDEIRQFIsIGNYs4Au4QgE4HCGXFQIAGGCWxFKAFYLH4/MIhyvgCgj4RCgpKikhIiFFREEICAAAAAMEtBglSEoQQ0gpwSDJgGQhQBJSMFHK2nwujw8KhsMBYSkBAAAAAAABWC4BlwEAECkhBbNJJskgKSRJEiQAQQKkWGwNrLaIqTYOLCZejwkAQB6HETpPANDCQCcAAAA+soop6ssiFlsLjjt0AqsDVAEAAACZx5UMw8C0sTfFUIvVMAUAIoXPIQAANUyLmjam6nRWKNiVcfYJAOn3Obbqc/Zo8w4+B5jHAX6m5Pkm0fho/k6YM/QzArDx7UzJ802i8dH8nTBn6GcEYOPb2QBKoQoAQhkvqUnNZQKwAI4XEpBVYFgZScoakkjTa1GOAABZQ0UtUZ0VAQivVFlD1kSCqiwok0CVEryAyDISKSoJaXYTKwFCGVFUlEFIUd4J2C4DZGZZUbPIuFBWRFVCRAACmQQAAAAQEIBQIuAJBXwuI8oToXyWASuU4LKSQioQUg7lM4QQApYllCagAAJCUUTAAjGOgFDKpeDw+QzLAySTAEiQFAKSpKAUh8iIEJalQo4AQ8DEAAkGSRIMZgKTEAQJIghmeQwlXIbPZfgCFhQAjy9keTwOSwkHQj4ApsXERGhREAAAAGYhmQkQkgEAAACAiDALyQSGACAFE0uWEAwwSDILqSqIFXt7i0VQqx1W0zTE3hQR1GKxGgIA+fBpruMaqI1hdahiqCCKaWdgi9o6gQgAAAg8SAAmBgAAUEWwcaIfAQCAjwirOa5PLwAAECIAgFoNOxVRxRaL1XEn1IFDFQCw2jr0y4oAAAAyh281EH2EohROYCmRJs2Mu+5rE/6BhQ9ABH6WVLhREuKzf+u99wy55FXyP0sq3CgZ8Tm/9d57hlzyKvmfDQBldQKAWvLKyeoEAAsweUZGgopaMpIDLSxa+CA5W1UNlQCArKAAIK6U1WWFSgHVUeEAnB3aCQ+ioqK6EIgoa8kMACBkQJUygDMAqoMayqAAB3YBrAI2ACHKqpAbJzogkESSAAAAAEBBGQ5h2N61zgWjrcvwwWUon8MRECRCQSkO+HwKwgKUwxCAFhAKTGgCIaGZGCAmSAhBYBAWCMUgLqAJAEKLiopRBDTERQFKICQAAICZKVEwCzmEyyGUBaEcIWF5LJGQFGXEwGUZQYAAklkwSQkSYIABAAAAMBGK0SKEpiFOM6EFECfMkHDJJFgwWAaSAlIKBgAAAAAWLIkACQYAMDGVEAAgJAAgWMgCmvgAQBExISEEAACAgBCwGACACAUUC4ZhCI9PGZYhXEIowkKaEEpIjLAAAkUtqMVqK2I6tDrCCqaaDjHEMEyLrSwTQG+RGuTTh8zBPGYAjO4AAADmcQyXEQGHFAAAtA4AgIg4MqwK4NOHxwsGAAAswAgyZ0eExmHg8pJUrAHqWIADAD6WVPhZohBvwHPMkJY6IWGlxpIKP0sU4g14jhnSUickrNTgAdQso6KQAFAOXjnFOgnAfJEgMqoChqO6KsgoijJhGCArBeHPGqoTAIiyuihDCfDKo6xIAJWcAEeVgCxrKEr4QFRlCURUAwAIaUxiJUBZlJlZVejywRx2AgcQyIwEAAAAYEwSQjJJwcRwEA7LA5fLkWbEJcT4FJKC0tJguJQQlgELJiIIFlIwkxCCASYBCcEkiQEAYBaSBISUDF8IPo9lCSGUw2XA4YILlsPlCRhKAPAFPJYrEIIi4PB5AgoAAAAAEBWlGJLAyUKyIBBACWFZlvBYgBDCgokJAAAAAEBAUcyUiJAAAAAAYAlmIghCQBExAWhaKCbKIhB6ihNxAUUTQqUohLRa1MSKiGGxWO0tqmrxMUzDTsXEtMMwFEVMwLSzqmM2FosBAAAqjsRqYGuHvWEqIqiAnQMMBQBAPzQAABFOdAEdEZB55ZjrOAEAYI7hA0deACR5zIvjw3ENAABMWClArsfrJIBhjvoWWwQAAKBwHH6uoCckxJN5HuWyPSb75yrgBWlApmDr4gP+deS48W3MNwz2PYOvJkpYWtKto6KMjzHfMNj3cIUoYWkJB4txdAmAVEteOeWSBMB8rkyQRU2RYlBlBKgqwQIO+0UFAIiorKoqshJAPZORhUiIqrKav5jgg8iqCCBUZgIAQgaUURURsGEnu+DBEGAVcAAga8RJCzYqqgEAgSSJAAAAAADxitIUizEtFIoBHCIkhLCEz2NEBDiiPEaESvBYwlIWYMGHIBfMQkghJUmCxgg5HCGHQ3kcLpfPAgAIEYpQFEVTtEBEgs8XEXLBUBAOy4dQyBC+kLIMKAgFwEJIFmAQABYCQmihUEALaJZpAnAIhBzKYbiUgsuFQLIgAAAAAAAAMBEkJAEgNE3AIkmJEhAxigFxMRFRMSZgAgAAAAAAmBKISpBHCcPnU8JymNAeT8AXUF5xMRHCYKCM0FHcOhEBAAAAMUyLTMA0W7XYW00Rw8TiuL1pYsUUtYiNGGqYhqqh2IHHvAAAgOOYYaeYjtkYdlgcd4Rp2AkGCAAADCwCHgAAgGI4tIakAAAAAGD47rgex4cAAAAA+gEfvvARvUWLADIcDAockLgzlJMfbHertPXRsqPBUvHHueY57wsq+DIZ3nXk7LZg1H5L7nu6Ag6BLbh1HTm7LRi135L7nq6AA2MLboPFqYsAQGQ5eE2lEACQElElJBbAeS4TyBqLxCobug2VNSAjKwJQBGRGVgnKs9VYWZEAgHLKAOQ8VdaSKYTIGstioGYIUCa4IKorqioiZFFTjYQMiOoCkgvKoMgaZJYVCDEYGxInwEQAojKqauBSRqWKjIhMIRMidokEAAAAC0TEKKGIQChKKBEBhAyXR8CyFCLShMtyhURQUECURxlQAAAJCSmZiFkIMIsKCWHCYEKxUIQSYxJSSIBBUggIBlhMQBEmYqJCMXERJu2wDJGW+biB4TNmCgCAIAiGJCEYATiUxxJQylJCGJbhCAmPFZWQFmBYhhLqJEmQJAmAIEgKCSElSIAYBEIgJsGSNQuWAABGZAguAnFBRAaxJGKCJKKUmAAmhCgjAAAsFBWKioIQowhDshQOhlBCBggWsnXRABlBzKEZItgYTjim2KtpsYrreB1XiAYwC2NaA3gGbzwAANCFn8EjBAAAAACAlSa8cswWFQAAwIGdRQAAAAAAYAB2dhbDRAEAQMJuZn5/9j+ZtRzYTcck/34ms697n7+w6G3XeBLZZfgwPZecp7D3YWs2p6HPmzRwryjA29t/mnUfbl1AVgG+ZeSCcWGf+Vtxns1ZB5AleMvIBePCPvO34tzNWQewhXmwTCflCUCqJK+iUJMAQAiXQKoZCeQ5QGZlSgbNLCJCZlEBKMAEn6isSRUAkEUtZUSNGYBfiKxpgMxwAmxVBAB4I1NFJWSkBBDSWLggyIhCqqUqKWATKyywyjEAoEhVGfZoQRJIFgEAAIBBRCmKFgoIRbNAREyEESQMB4QQSYbDinI5IuDKCFKWBQhhCUMDhBKlBTQRY1ERipYMEiCABTMDEpKYiIklsWDmgRCukAWfZcBwQACAADShRARCUKJCyqEsIYSloBQMK1hKlkQshSAm5sVqbXAIWIBjF2syAAAAYMIUi5RiFFIwgVh0SAIFjzDc0gYoZQSs4xECAABAAAAAQGiwkJlZVEBDgiFJKAdLigQAzKyqFAEhhBi7RESJiIcIAAAA4GFwIzQAqdEcriOghAhNRqan61xxorKomKiHLBQRZUla3DBBUME0bWytDh14BK6ZHNfrynVlWMw07HBoUdPOoY1jNkx0gG63RQAAjbzs1AoAAAAc2BqmAgCAdARgZMBWDYcCAADAASKA5q0QiKFDM/k/6+xm7I4RHSfd0mYw6xEPyTLTUfjc4Fr28MTOk9sqnGYdnmVEYRk2fcZvUbiHsyAywWcZUViGTaPxWxTu4SyIjIKDZU4bRwAQysErJ6oJABbAcSFJoqwhEqtIyKxIyKwA3peoSgCgLGsMhQxAeOWKqASIykx/AS+RWV0VCUUUhNQ5IlKKgloyu4YBRFRUl4XdLnYIJEkkAAAAQIQihBJSRJwJi7IgjzCU8ljK8vnSonzKEDEiw6egHAKGcHggAERAQITMQiLGTIAAQ0giyQSa0OJCCGgGATNzCMMT8AGGy+cCFFwBKQlpDqEAoVw+JQzl8QUsEYLlcxgWoEIBZRgWlBJGyONASoRCBogY0wRgEEJ4AkaIMAdgKMMhAFIwCSElCRIAAIDBkiGkgBBiAjGaYqZpExUTx3BoYDWshtViNQwbwzAN1NZ0ZCrg0BSsECaCiFUwpxqOAyaPD48AADDEFMdVDMNQWggBAAAwsIDj3Q4AAABh5jWPAwuIYVhMqwAAoDodjoEaBvj0CgAAAI8JADNzzevTxeu6riufruv16ROZE3i98uF4kQEQRyEjKACAMMVeHJgAWO0dcwAAAAAowACRcGCHHHKRhctom9N2bKhxm7Fi7RI0PAXsB4o3jJBp4AM+RSQGyqbZqP1Oumegi5YywpZsikjm66Zp1H4n3TPQRS1HlmywYKNrARClyasoViIBALEuMkPUADK5RJCQNcskVxEBGZBRWYDDkABd+KMqSglAisoaioxKCQiflaoLgCgqnQBtu8gAgA8yqiuLIISiIjOIIiQgZEBUJVI4g4iMSiJVlzmvHQMoA0BlFlxSdVSCqCwiAkrHKCYBAAAILSYUY0ILRcXFBLQoyxHg8CgLCikJKVaQy4WMoLgkSyhLQIUUSAiIUESUYloIMREAggXfAgLUG3pWhwBJwSjJLESFQooQCEQFILQITYQQsADh8VmWBQUFIYQQIhQTExOKAgAAgCkWhVCcCAVCQsEVEAJCCGEIIwAI3yjgciiPZQAIeDwIuQxLWRABBEIAAAAQSEG5OV8rlwRizcTMJMFIw3V/CzNlTKyZzW9XEoJcCgMAAMYkmJNZSkgJMEuSgqUgKCYRcUcgFKWFFAgAEAAAKAVHaAbL8pk6mRCSZGcEIlFAzXHKjEyqmjZ2hgAgYohYLDARmgQAQMUKNuZUR1UIALBIAABuAgBgtUtMO3uLxbD3QNUwVUxUD+gtAgDAeRg9POysgxkAAOBcK23Y8BNCg7TQtHm8VitNqOMf/80T/13z59qdsff5ksuA/hpgzpalRrHIpDJjnLrvSpxF9S+ilvM9zZ34MyjJgQwAPjUkw/6R8vEbexSzohWdGpJh/0j5+I09mlkx4g8eiIiyhqjIAADl4FWUFQEArB2L2GGCVWaBCoGoTIL5K0tqCQCIGjJKRQLiJbJGAZKiKGgDeIMyqyWSIIGQRhfWOaQoKstCoaZ5GjQTgoioiHDLosyMQERNYQECJaGHBAAAAIgEM8CAJElYPp/PcFjCiEqIiopxBFkBCYgQyrIUYAnL4hQzITShhIQpgZg4DYaYGAWaQdElwpSQWUBBTJwQGgyGkBKhAUqUAghDKGRoDITlCiJcjpDH4XEJI8MADGVAWEoIqEAADodnFLBgKRXSBYNAEESSIUaLCkUEBADNDAAMwBESHp8Bw1AOEYjTzJSYGAEDAAAQCMSE4oSiQROamEmQECQlgwkCY0Ag5jMMl2cUKcIMwEgSII0kNJGAYpkWuAAAAIAAIlYbUzBMx21s7A0AEMVQGzUMe+wEEUEAAEAFFTEsNg4mxf6IAAAM87o+8KbFkeOGGBY7OwsKAADQ6xhdDwAAAACAYqBiOLIxTVMcCKatqgIFpmm1OjRVFQDAhNcAAABs7U0FANQEVMirnmu71A1fcsnG9IQ30Kh9QhX7kf1UW8+PpI5LDuz7OVdOHXPP39+sZ4uGZj32L3fOVifQyXop5T8tkNhqy9dkAADAOQA+NSTCsqsdL6H6a8PIhGClc2pIhGlX+11C9TeHkQnBiufgQagoSrIiSgCoJK+cYjkCgA0J52TICBW1lEQMmmrIQGSC6UuxEgCAQmZZFQB1n8WesSzgpiyLQkVJphQAQhpC2DFy0ptpJLP2ONtER8DZAagVEgAAMCAhmYiIISAZyhBCKQhXiicUE2WFRETIk2I5DMMylKFUKCJkUYGQaQKAiAFCSIJkKRgswAyEAkp4HJZP+IQLiIjzqYwAJQwBhzLEQSHggghYhsvhMJTA3XH1MMtMMeUuZpJSsY6FhBWEkoICA5IkCSnAUsBYCARMgaaZFtIAAACEIuJIUKgQlJUR0AIQSBAVvRUlkxImBIRWMXaxCKGFHgJaAjBJl0BSYAAgInXpRt6gbp67Y6Q9Y2saiiE4MuxNh4ZDh44cr4sjfHg9Dl4fPvBRyABMGDCKOHDoyAkHtgYi4glqaxgiNmrryLAAAAByzTxyoYQwAAAAarVa/YiJs+nsVAMFq5NmAgAAAID4bdirAjKB1QQAAOTTg08D17G1wxYzUAFbOzExcGArhh0AAOBsb1EAADwxFEBXh+KYI1sRAACggIu3CsPVrs+rlNDmFcgUv2KCgSVPfXyUofp1zby9ydjs1z5kGi8s3g555QFEEL/zJc9LX//v/38fIvqeE+nxicuKg6xlDYA0gPQCwAL+NAS5NIx95q/OexwXEI6ELMlPQ5BLw9hn/uo853YB4YjICufgIYoIFUWhlgBAqAq+BQAA1phfAKSqgNUWiFRDBkUowQYZfKlEkACIqDkzlADhTWKPXQVMJUBIeKMsKiojEIUyWCDkgEpInAGhKCQ1ih6MAQg5AOGEIq3kcEUAgBz1ANQ1YAegBwAAABCQkgVJlgAx4ROWsBwuh4hx+TyWQRkARGhKQAsoMVqMEAgIifC4TGBzmSh+YUTZWFGIAAAzQEAkKMLDbkI4nIDlsYQPCl8ooAGaiDAtSoGAw4hIs4wonwFhwOVQISNkIeQKKBcs4wA3yV6StDuzTLHcNh4KAAAAADSENpQ1M4Qqo9hARFkAoESE1p8TCLlcLjXr0oMpJixwMU0AAAAIQMFofC6PAwKAWbIsQVoQSQKBhMVpAZeVMQMAQBEQbjQSCQTXQ6xC7McoAgEAmBpgg9mdeVM/dYvx9fNyutlSBkNgU3OzjfpkYV8QDTWrFRWJEXOUNxkARjACCBF7q1qxOuFIUdNqOLCqggg2hmlFDXs7300CMAwzfAAABobrw2t0dAEAEYfYKWj6drxeAwAA0MdJYzEALcdxHGGFx3G9axYA6sXrStLiuLG/CeBu4ONbU5XAXk8em2ZPDiL257Rhy1lO0/b8/dH04bVfHrH+LBn5zi6WyOyUNTOmi9/mwCTZ+Y68CgUFKe5j3CUqAF4VxLZ5DL8bRO3nHfpSUERhiVUFsW0eI383iNrPO/SloAjCwjxYZKR2AUi15FUUqjIAQEfY2YBtAqc9JTAqaoyQUVlRCbxvIqtFAACyICqAfGRkAKKGjOoIADC/BDWoMZER6eNIa8fqJubB6JybDAKgLMuKItHZmw9wqyngKPApuKFiAACAgCkWiIsLRGgxSlxAhGIseFxKGcphORxGgOEJSFIxUACE5RJKg4VitAgtDlDi4pSoKKEhi4iJEIqFlAgY4qKUkBYQWlxAUQJKQBnFREDERUG7hGBxoY90wMMxYiHIx5hHUlZ2IQAoiOUEV444UlbyyhWUFjKEEBAegxAByyUMj0+5okRSEzMAAAAIwwFhqCcsK+CBzyM0M800BCUWJSKEKTBNCwEiIuaIujMtoKVCEDGph0kBBjgcDZ5SntSoWGzW2BfKl2ZtC4Nz/3zy0uaz4tOcvTzNP4sG3O52S/U2l5a6Gi/N+gcaGkSuvzFCDdlYsdgbYIgDtYqNYXocASDzmmzlRY7SzKfrlQlcUwAQlelELVZbg1A9gwEAAYC0AwAAIGUvvg3UFNMQNUwFi53FVKymKgAmMgC53jUuoAk7Q8TWoY8AAGBaHagnhppOqhWnJgBidWRVFAIAACAKxy+f3kqbpawDsyXCq0yqmNMAnwNaMHKS+47J6/DpyxqxXIA1XlWvdVmbFVnYvxeo5SLy/rK53tfDspkQHmw7dPAJvu24c/Yc0Qj2mN8nT77LD5gnDVJuDwAVAF7gA54EtPKxop/2WzS/x+l2bBEnAa18qkI/7fdovrcLdTu2mAeLFicAQjl4FZViAQAYyY5A7oSNtIokZFFBkgHsA/gmylUZABCURGQEkLsoAiAqixqKBGyAeQlZFBWJhLcn0cnITWRVKVICduAKAKK6KAAhiqpKLiorAwFZsxJbH7gBqM1lAgAAICzONDNN07SoaLmQ5fI5HHBBqVCMiktRIQTCiLAsIZQFlwFfwDLtBoE4hH5JKCrGhKJpAUCDmbC4mJiQiNHiokQIFtBipJyIi9GEhlAEFIgoBUrA4fA5ApjABaOEDFdAQDELaALCAKG5LCMiBZbLMJRyQSnhgictSKnQmRJKKYGzZJIkWSAlMSUuQmgwAAAgRCDiTgEAAIAQBzDwtGwiUokVxHzGLBXQkNlDIFm7SWWBzDDGGjiYEAJggIBimfKgHQYAAAAAAM4IrjuAxjAM38TXZIuWHC62QTIHAaCkcxumgm7+i9Ym2Int8RGIrMdbTPDvuaOdLQCI1RQcs1gNhBJJMO1MMQUDAEHVwIGN2hmLAKkAAADUog8pXfN4kbkGHhcNrBbDl4jF9MdOPYZIMJlMANDi7NQf34aPYfgyVNXWjwNb3woAYAOADz+jIXAVGuLX9PajQAMAQHE+AECxj68tkdyB5WSzeSUN59lzot/97/3J2THnl1/u/XyP5fJRlcl9qeVJrLxb6gJ6D91U0z02n+F6YhsNuLdpvW9WjQZ3Dg78In0OnkABAD4FxGHapBnN36s5m9PBik4BcZg2KUfz92qO5nQmKzZY0J4DgFRJXjklpQmAHQnnIYCspVLKq1CmqoQMVFQJMgLY0cKXtpNKAUBRWRHVoUoAdxGZRJEoj6jIIwNMAg4mQ+QJIGRAUUNEgAuIqCiLUFbWkN40CIgiKVXjEhGVgIyqrBT3Dm7WAAnFAAAAIEKBUAQCEUJREBMR5XJZbQYUHFEiw4qDx0rzuDKgLAgoYVmKpolQQGgGTYkSIc1SMhOxDgKCSUKAISFYkhASJBTZxwqpUZk4BGAZVoSIiQkoRyhQAADw9zO2z9GT4hCGUh5DBLgKibmVFfB4Yh5LHAWhimWlBHJdwl1A0wAAAIBLXALiFAAQSgYYIGpMzKMmLRGnPRypaCulCWFHSDsAmDAAhpQMgyQCEwsmKdkhGOwAl4RBhRyGxwkx4AhINAEwAFJRdNQJQN5m5vH9dYHYbp6azkZGzn6028DWVAWr42pjg52htqZpmoDFzqHF1hAntMAjkSbHMczrBQDEcAoYflAu4nCFAAAAgGnlemewx9KtAAAWq63DmZomCgAAAADguL5wzHEHhqCQhuBIxWrYqwOroAAAWHq8Hq8EAAAAAB6fcvz212igAAAA0kEmwdp2fN7KYd/xEZlxiGhmZ36useFyt+EfxLCDSy51F/lY4nD+sv4pn6bT7Ma6tCqENvHIq2exLX7Qo68IxP8gcEdZsQFVkc4mnIAB3gQEWT8w34A4tkEQWHA2AUHWD8w3II5jEAQWNFhMSwKAquCVU6wuADBPqzhBURHIAMxfqS4AgMwaiwwZgDj7EwjuIMvqilpAlJEMUEAXuS5AhkhZsyIo6ADKT1bWAABCA0JEqYpLVtWsKQAiVfOB2u3mBgcFAMwsAAAAMChxIYRi4gJxUSEBkWEYHsOjjIAIpKUIGI6MiCiXpSxlWYYwAiEFplNElACERQR8YsENgwp4XAFAHATAYYXiDANCGUrBgQCEx+eBEbKEAYg4xMVEBBShxIRiDCZSEliQZAkhAKIIIQIWl6AIGJQIoQECQlicCIXiEELQAQAAs2AhggYIQ0gDABggAJFkkAMAAMBrfLGQzyixxm8pKhDzTCGdGJKYpK7rWODlLHXe3FUa/zPF2/ZgPv8N3vp+02EEHhDguIkguD5JwrPOL9Vu6qbAFji02iBW095wIGqKnarFYm864UBs1OJAcWA4tZMQ03DgyEAxrKpiWAzEYiOOG6bF3odQLZ+OUxr4dDAtTtjZYDhmEAAAgCIOHNpi+GOl2xEAAADp9fr06VitvkBMTKtDW0s6Zjq0sYhYVQwxTZAwrwwA5PE4VfYCHFosDu1FAQAAYhc9psksDv1ubRIA4F9Jtl5zOe7a5gQHfnloxmjrGC+9WEJmlOv9ShOxqa7FI3Op8ZUfb4J9d/CRK3URNiEs+c5kIbWqS2vFUYpUgdoC2DVXMrl8AD4FxHYaGaP2OyMMoxBqhU0BsZ1G4rsBIzSjkGqFDZacPAUAUqXIKyfrJADzBt3JlaSyLAQooqoCFAlhAeyX0rpCJABQY5ZZM8DtQGc+R0Z11JARWVaVQciBrCQFXgAyEpVpprxV0AKQhagq5UqphiIAUVWQvAVgipEAAAAsIgpRgUCMUBChCREyLI8whCNOJQXERCX5lIIrKMnnUAI5IVxCucAiNFAuJuIuBIsDAtSl7BJgFp07HIoJGAhdzSZgYwwAAAAhFIiQEA4E+BKSHA4IOJTlUQJWY/kEPEIYhlAIBTQNihYIIQpKQAsEhARJEVmSYDAAUC5hBZRHhFTIJQAIKBUKKF8AQgEAAKGTEhIGAAA0zONTDstlOTzrQnQQSDJSglUOlEj93MqyjJpHW4sbhmf441iYpq0vp05Bwd7it4BhOgZqUU/UsKo/olar2pswr9drkuS4krROP8UyCAAAEEoIAAAAzIPH9enDob2aVrGaamNVLCIOQQQAsFocn9HGELAVSu3sMe3sfcocq72OzHB9eOV1TACAuR4fstqaFgAAi6mOLE7YmhYDIGhAQh1zzAl7FQCgIwMyANKH6aHNb97/C2HiOjNqqV9qxKMeGYW1v8SS1QmbhZwvry3vLl0H889+mK+wf3Jd9gxZnpz+ckKp8ulLEbVLuP4WVqZfTFrM5IVB0HMS0oMcXkdUo3hkti4+9YN22pIYf2O2y3HWIdjCPPXDdtxyMf4GdrpNIdjCGyxHOGI7AEI5eEkNNSkDgB0xyxklkjKriqS8piSrMkCEmlQkIhLYZgN8qRRKAECozCplFgD1EkSmJCIPRzFdkEVZS4QyKlUEIY0jjXNAZmZG1jStJCKriwyAQQHIihql9XSYlHh3ZHOSmJAdYAOUyQwAAEAoDgiJqLiApkXFAAHKpYAAZYkMkZSU4gnAMEJKQG1KICCgaYcIWYQur/DL2UtCCAYBrJmlYJIMwVJDSoaQUjD4XJYHyudTloLPYymGUJwWAAAAwDBluBxKKSUMGAamjJnL8BkBy+Px+IQQyhIyWxfg5LhRIAiZoyR0mVUMgFDiQghYTCAqJAQAABAEo0lCSQgdhBRgkBAEgAIAS82WrVwaE4pLuvniMglmcQlRkm5fvzw5c86NlS+8fZ/a7pYmzbgp2sBiqMOGVov1Ghj7v5huGlZF7K1O8XHSHywDoJMTrYaqxV9WVQ5RSRiL1gKIMCQ5Hp+mvGFCAgAAEFPMGRn8T+/IWioqqOoo5lQZp5hqqDlhGSbVTj2Lx3dboZEbANPbi6KmnZ0BAF7XlQDAIDUy1bQaAp6tFTUs5vFQGoZqOR4PCQAA6mIY/jhu6+OWgAoIlQSAO98YWZUW1N+td+Dh6KaRRNubU+YMZXX+S5e7P9E56L+N/lu9aI315CKP3/6atxP7f0kBQfb+fXjVvvYZS/fKcqfYHXMIZv+vvy/7MY8+pHEXX3oEAGwkICUAXvXDVvwI/ZTfg9N22EoIsiRX/bAVP0I/5ffgtBm2EoIsscGCMyMAELUir6IWBQBAYl+z2H2xuwYta4gUIiXSApiviOoCAAg1UaghAlAA1u6A5b1EiKwECXUH3aQ3EXIAlNVFYcW0AHsLwAEVr1EAO8DkBAAAAApCJkKhEKAhSjHSQg7hgsehIhKifHGWzxGlDMOCAmBZwhcl7BAWCMECESmhKXFCmDALAJoJsyQ8mQJFmECUEvE64gIBYbgRhhGIhWyYCBgAIAAzAbNAlBIQstKMJI8lDCwCLqGUQwSUcnhcFmBBAQAAAJSJAgXTZZSIgDZAAEqClAgrBN+xPFbI5UWIkCUGFhelWExIiYiKsSgDAABwhIyrWiN8sdJkGRgAmGGAoX6O67k8HI0brlEr0nRHZ/9vMPF2HvVBezp2+R0WjLzDER3N53bbgMDHAD1OQ8Aiho2/TUx7xbQ3XdM0FQDPqmrYOLRYLKatIUT5t6o4UKxqAABAV4XVScctWmIIFgfaJeaY5DomwytHjmOG6UhHJTEbRa0WUzB1ipGG6dA2DYYBAADQIoadQ/vpTMOhYhqYtvY61WICAAAAPuUAqFgdjCiA2NiC1VSLveOGrWFr+HaodpjXWwIAAKig/ISi4pUWWIvXYZ9/Q06gDhICfZGHXEskUVYq4t1LIFVRv3EukvsSJSVLuUW+5/d377lciVDxd6eZSA7EQbaeHDPF/oB4J5ANRNy6x/ofbgEe9YNh+VhG8Xfec8ZaYyHBEhz1g2H5WEbxd95zxFrjIcHC59mAVCmSFACUg1dOoZIA2JGwG3YYrABGOUAGcGdUViQAgJ0/a6hJdQgAFFFWZigBd4CZXASmN2SoIEIiLSyY1HoBCIGKEiEDgKwh7KZDIuQARNYgrJRRlKTKWioBOx/gQA0AuxuYTQAAgFJQljBUyOXyORyGIyYjymUJQ1jw+FKSIuBwRUVYMYaAACwlrLgAIoSIiohQhMVpQIwSFWUCWiBBMhB4QoKUCMDMoAFRQiiuhChUSjmUZXksAw5JCCICAAAAAAAAE4BAXJQhiseDkANKwDIEfDbMY6iQExJyuCwBoYS0GMUsIISSQYkEjQICgRC0KAUHhHAIBDxRAYfyhBBwuFYiLgAIEbIohJCkAAAgJU8xASUQ92BBQDngUnCjrBk8wmNRAAAQWEJCKFMeEBWnBUzERdgXBQAA4DIW0XFgIYwsiyVwjaMACMMTXVu9mDfzpJ0i5ku3WOL2fHY75BK48vTL/tZtrdJbn/YUtRONY/E5lqNZQLrefuSNAwHU3jGHYjUdYAKAWG0VsVoc2qLTW6xigDaozOAQXjJ4AgAAyFSY63gMx8XemE5txTRtbRBR7cO8IBkOgAACiDpw3DAAD45PCWQAqONWAAAA4AMyUES65zZUHjeMh6nNeZInv6UCOiBsOl5/2HY+U+/NYz0c3rFIu5HFZdS+zsoiKn/qsOl8j1WNrL2PEj1UktOlz2pT5bm0/54f1rxUDoeMC37lk0GMNJ/xKxppOotC1RK7AsogRprP+BWNMp1FwWqJc7D2hAMAlBZ5jeoEABkQlZUBaUnguIQEyupKmSh3lkEWA+hvlEtLEwBQQakE1Hm+kCJqUSFlReaCIZ1BJBkVImuEutaayA4hA2SWlVVqKXMlMjJkRXUEiOodAABrPuBRSQAAQImAogEWEReBuKiYOJ/DCABcAr6EoIyAIB8CYhzwQQkloFyWEJhYEknJAlIIMSaEQIQQigYRgUCyIClICtEESQGTgxXKsByTVooYemJtsGCkuIKiIgzABQUIKI9DeBwxDldMmkMICEiw+5SmhRABDgAERFyMMFiMlkrBTCyJAGYWRBIgQoHvScoJJQ4AAEBJFJ/dJeEkheRWTaGz5/yVoOkwqjkn5FN4TFUttTevr1sfDcZ4HdvKym28T5rNa6MgV9qrIYZpcWSIGIYDrLZYDJEQBKxiZ2dvqAmOOzBtVQR1tEalkAsAAAAg5ODFY1h2hEoAAADwMfELW19WXxYQw6nhy/S3nV8mvn0MFAwf1xRXnWI4UIv4UhvTx8YQ1LfVqcUKoADguAN/RFCLj8VUUQFA7B2jDFWLCQ5dgCE6AACAkBbDEAEwbNQBTkGcAAAAl+qS1JTn16S5et8tmFolUUDDdVPU9b0jd/sbK8v3/EtXP+u+ybtce0nqMOdtzrAqgMAfK8kh+eT7+5PXmXDlccjz/X6LQPP7kHLJYs8A6k1nQ9A8e1A8XB71o0E8JT/n96Y8Z6hHEIQszFE+HPhT8rl/b8rzhHoEQcjCnk1GAogKARDKBV5FsRYJwGJGXEiRNYgMgR0Gq8yCGqSQAPNXZr1CAkBkpciyrAAoASBVKu6EBLKWKLoAlk6ClxAqqiUJGoR1A0pRZFlDFVgsC9Y6JgJDyAEilRNG5nYmwMQF4AAA8AHaRAIAQDgMn8cBwPAFBlMiUlchhEsADkSEXCHL8ImIgIAkYQgllDBCBgIKhIZQyAJxFgppJiEkEUnBkAQIKVEGTVhMQItQIkKaCSFEVJxQBBSYAaGQAyHfwOcKCCHEIOmFUsrX4VCAYSmoIASGKxAwHA4FKAAAAEBsgiSxYBlIE1hICZAop0VBggAFRQtoSukKQNQFgGIQBmEIj0tYLocnoNwwj0MAsFBUKC4kAhZIgFIwACEEGKZdEUUYAJGZErCUARGKmQBgmUWIJIMmlNSDeACUS4ZUFQAAZ8pnjSVraS/edI2QwBQAkITD6Y+tpn3byhs+Jnakz+PiLLLYVn4xn9/l3VG3O1SBNtKCrvzObZzF5vO+3pj1JzpVW3t7K46JYHVo2k9jetMAK6oomBZHdo5M1LSapqoCAACYpmkZHZpKXVH1SwBiKGQhFGK19ZdhNVBbhw7tHTNRNU1HPlrvAQAAAISMvh0BAAAz+fC0hGtNQpIqNOd423B7BW5he/Mb5sM3Omb6wpyOyr5n5mIS90952UWx+/3944/83+8zd/twjzjLOnH78GT936Myo5xcj7OUg9X86N15ep+U0tQpJd/O989Bkv3FB/70w1b6Z+Kn/E4YI9SRg4V9+mEr/TPxU34ntRHqSCjwDxZoIwFItVJeOVWFIgDmXTJYTZIQVSnJSMD71VxZJRIAZVYFNRQFoM7zG4gqkAEmFyXILGohwDkQFdVERpXpDCoqUgIQcgAiK4qofKKGBIAMNdQSCQA7H+AAAJjnhAQAAIQWgUBICVlchBAiIsgwHI4oyyGsNIcnCJZDpKQkOQzlggMqSCiLiDAAIg4WFxMhlCQBod1kGuzGHpSACIs4fFFCOTqPEEJBcBbweCxHAC64fELAciwEg6yUjosFIISAEi6HS8MlCBhKI0IAYLCIUFjm9fRMcRGCIGKhGZKJpAYYTJK5Q0oBaJZCkpEEQJ0MAACAcLgssXBGIaQGAwAAguhCkBRAMTsAZKSmgZthk/IHaHA9b34a8Gajtd0doQ7GMTkZtYDzfLSxWhU1sbNx6EDEMOxRFccciCkgtlZFMNUGdWgxrabpy860x2pgsTFMNU3TU8OnU/XpMZnXh08BAADYqGEa9hbFhgUdAAAAACamTg+Taqpi2jKjgxmnM2VGGcE//qc3wdG0ap3JdDqY05jBkdpaxeHUqYaNY/YGSiQAwcQ6uADHK8AasAYAQAy1tbe3t1ptvLUBDZhjXbhhpQAASAs7F4AEwIaaYvJjUzOTPwP0YWxoZl/jnb/9mfc5h/0lv8iV302uRhwuS5C6Lj/L/i4V7mGU6pU3lSu17llyXzT9u+7lM6oePRO0WBfY7MfpMBmvlpD8ha0BAGgAoMABvvTDeXeq/Sm/99rzlkBg3FIP592p5qf83iv3lgDjrUI7XRsAImtSwUtqrkkRAMw7CAZVQyUoEtiZgC/FkgCAkFFRCmUA6p1BICNDjRLJ2AiLnT3DOiSLJBJnCCkqMimrq8xromMRGoCMGirDxD7AgRqgUA6fy3ADHNR8AHQHAAAAAENcKEaL0pSAWSggAgqAguVwiZDhg0M5LCUMCAGHYUXEaDGAaZoyMQERZ8rlcEMMEVpjHJYlBEJRUYgICQoGAMBYhCd84OnwICZikICCCClPdJ0KxFCs0ClASACAEAwGSxQKAS0QIwIhg6YJYVFK1ENUIC6gjIjRYCIgQgJaRJTyMkUzTViEFtEAU0wYEIoxWFwoQRZhMAjlJS1lhGQNCsQXmFQQL0tQgrRPqEKMdgcArxwT0Fqxw6jnNosaSLXcqg38RZ2kqJsX0uYReDiKxWDQ+fHx34mub4a7ZojFy/X856c5fTrR7/xhMRGLt5eY6ymxj9306+34PTcHpkvnc2U9ni+u1Rp70nqRuT2yUTEMTBvTgeMWO8OhrQ0WxcYxNTBRO1DDDlGLiWFnbyqGaXWgptobVgs2VuuIjWnaql92rlWw2vuoAwAAcerUato6+wXjGQgAAAAE8MewE5gjV6hGjU9RQGwcmaKkI4vVYWQIAKCBAEPVxoHFXm0d4tQMADBAGSQAAMi4No6mE/tJpaQ74VCH+4obcmsrXNGU+/QcNrsAF6U1HCA4n7cSGvYeaJVMKvp3WDou8/8yJ5n8X5nsfZm+NNeTvwnezKgz6DmABGgDgFqBDQ2e1IN5sxvxU35jnm0UEvkn9UDe7OhP+T3bZzuhkMjYH5BKWVYCgKixmldO1DIBONgOYLEN1ho0qyohIgDvK1QLACCrKitTdQggfADZJZA72PGGyKhMAGbhnQUQiUo5rrABCAUACJVk5agxAZAs4ONhhI5u2M40QfME3YEb1EC3kQAAABSEYUGJmceKEPD5QnB4lBIely+kPAGf4QruQDoCJRTQaJOIEdKTAREiSlOA1I0ATjVLzSAriwtoT9qvEDDhKGNRgVBcjBLhMRwh5bAcHp/LgEMIpXwJcSLGYSVlBPgOSinLExIeJUIhRwgKAAAhBKzERMVFCcRECEEChBAIxERECaEIocwXUmI0DebwweFTBiK4lHIEoCAAU6IQE2GqJKAJITqPFQpZGuVyBaACQLRMkmYoAAAGAKAsKzfJEeUxEgrL43IEjvVSAlDAaJuwRm6a+dFFvOpi/eEjYEFiKNHje/vNmi3127kHqlocLYpT/JBXzDFsZzu8hGIwHA0/bUZtTRFT1VSrnTkpehafPvHKdbyOCeRZ2dlisfOFAqZlUqd65frwSt5xTAAAACq2qD8OTD/2QwIAAMG0sbckCACmYlgdOp7geB1w8WmuUcUDNfAcN+0GbByq7Y0UAADsbW0sIoCKaZj4YAQABXxkwB0KQwLgQDqrQXoff59D/Lfur/R0cOPJ16j7lVX2ART7V3zjcs8J+px9npTxGc4vtrg3NL3n9+nG7pfPZXLeEGd+Q2ecAZfgeGEVLg4A3uQTQXxM+o5Q7TlVB7ElbPKJID4mfUeo9h6qM0kLN3ggVNVSUaFSAkC5wKuIahkAANp5hwODqjohESnB/KVcUgQAUs2RlQqAeAkhM5Ioo5r5JSKZFEIwDGRRhQguEFRGZBY1a+YOm1D+lJUBAEIOkBVRXVaVMYbqAxwAtVfBAjCPEQAAABERg8lAQoBSBjyOFliepFBClMvhEHClWQJwQBkKhLgQ7mIQFQGYhUScYhCa3ZiuEActwhAcJMVohA5X6RCrow5cjiSRhJCAAGAI4XMDDqWEx2UIC8pSFy5cBEKQgpxEOAjGE0RE2SOpxPZJiAlsRCyNmQUEUCIQM5iFBAvCPisT0BTE4RIXskRnkgAAAPAAFCVcq6A5sytRE6c1fndDNs1Luz2aAzpG5VlsPkfXx99F1dFbNDg4my+eZHM1S441Oh/vrPnnjjvGEcSKgRM2jsTEUKsCij02gp04ZrExAcOCWmaKDaBq58gJxQBAwDQNACat+J9qAAAAoKbpUNQwRhh9AABATbp4cGhjVVTVYrGaUyanWDBHbC0CqDHKmc84w+D0VEYQNaYY0IAydQJRVQoA6AkmBlsHxmBvMxgiYLWaCoChCgCQwrRpMWmYE2QWACBxDTRKpAFxlwPg4nROzJFk412+UR/B+97LGp9LssB934NPJFHP8zvfUs7Jou93rPrQv+V+/bjohg2PA7/7+V4jRLOXfEuT0Uve14SKgiX7xTzXUrNHsgL1tdsAABsDAAkABR7kIwfdnvgJv7HLkwLWED/EIwbNmcRP+I0dbgqo+l9BCBU1ZIVMGYBUczVvaqyxAgCwmHdok0FU1ZyJErDBgT+rai4TABRZVVCTCOD22bDE/BKozCBSILyDkTvoHJRHKAAA5QhDzltQ3BxQ3wAcAAowrwGMBAAAkEzFzCwhpZJ8gZAAALisgPAInwshly8kDAFhGAZEjAhZnCEmThEaIgIWCiGghCBCmogTAJQIGA7AoxyhRhwhAABaCkkBAQDIlk+aLgrWQAmIByg38KNqlO7HIgCVQFnhi/t0SeBJsYhICRQhwmcqvhhYvpVvJQDAROAI3YUuAe2SAgCUAcrdzY32aAHFJpTocxkxzpNBquzNHL58tLeeR88/Nh+WmIyzJ6/+7At98kkbh5+x4Ov27PO02SJ6Npv5LInMgenFXx0DL9X2P6x3k0EvGpLtkBHWoQW+agtANw5NRB3Y2KoFnWJYDFNN02LYGo6JYRXAajEttjaqpthZHbOxszfX45UBSA4eHwCAcH24fkfSB8ERBQAAAFrjehypRRoE/BsCwzQ7/9NEAFDTbMTOv2UCCBUAAAAUVRub6R3TcQFosDrmmANTbZ2wsVEE01Cx+rY1aMCp+O3bChCAz253ZerM/saAAABs/IFBpYmmI5HXpxCb6X5uNBY6uScqywQkuYeT/LLdp56n+12qSUHKp7s+dBNxfW3OmUt2iV7k+qDn97zf68+4iStuJtl/zteSm15kyfhxFG8fpvvhnZF7RrAHyql/gAUA3tRjWf8x/PGrSiVFODn5N/VoNn6M+PErKmVEODlZyFWYrmsBiKxJFW9qUlYCAJKcd8EMgyqqA0qA+6JOAiCKUBNCCRC+ICCSrGA+B1FVC1IZKOCAMxARFRFEDWXuFlhhFhAaiAhFUVkpN+A8zfMBTgCZ3WSdug47ChwAAKORAAAAAqYIxaIQIwIRFueyAi5DQRmNZbiEDx6XZTksjwVAWCLgilK0gAZNU0ScAiV1JyQ9mYYI8aSFTAQUh+UIhQT8EJ9CyKcsl28xhrSFXD7k4FLCcrlEwApZAYcn4IKCOgIRAaSFlZDETAALAQkiSGJmsIeQoihCi4gLGQTBYA3BEpIEJSJKSkgCpmmapsGEUAL3BAAAAABAGpTG5NpXQ4nYd2QiBdTAHrWEVHpkXKcgMc6tXScf2CmRlc/qqnZ3To7Jk86btg4xQf2n7+uTbZzyL4fhrHBxZL2nGLTZdC3nL/ez4wA2c0t7inrc+COea2JrgmG1mWYoamtriogxybSp6n+KrakmqlgtdqbFMB3am2prazpmRQ3DcMzWJvzhh4VQY3TCzDUTuF4z10VTAABQwyx7dWRxzM7GYqAWw7SAgGlYJx2ZDkdRB6qCWA3Tamtrq2KxVwCv13xvGo/HfHireBogrBQAAEMc2qmJIKWOew4tLYwKcOHbKIAhCYB0T2WUFeikgADyByGISKSy9QCpq7rxs6/XmHfG/FLDkuF9HMdyV+/kz1iH6kOsv/fFU6WbfFR+8Yn+AW+2nqHqKLFIE6WW8yTzAd7UoxkvoZF//BaF0cI/UQgNfE09lnESGvPjt8hM4Vec/VfBnIcMQEaN1bxyiuUIAOZ5WFEzUZZFgPl3wvGKFACEIst0QiYg7hi5Ob8EoYIQkg+JcxApQqghLUDHly0g5IAoM1QXnMnKKhHAIY4IArlp6jIBAADQFIiAYoopimYRcCglLEO4hAjBE7AiLA8iMiyhDAWXgCehBVgMrgMAgK4+7bbSCCJAQAjhRSLMoGjZGrkqdQAhBEQgZBYTBSUQVgjFoChhOEIKhiMkhET5RFSU0AKKmWZKTARsAEkZSEIYHwYAAACgRJYAIRxi7HjQBAAAAADABCzD8km1GhNmNopSQELwzhVxiKkGVgfgyKFjYgF701AnDFzF1tbeYovVxuJHrVYbHKoj0wdcG8MQmTITUcM6TjDUVCasyIQxbWKwYLWIvRhO2ICK2tiaTncRG1+qFsMvwUVFrQ6cTUAATAitRQUAAAzJhw/X6oStofg3RbEXMRyoHSITooZVwOLfRhExLKaomFbTcQdYrGJi2DhmwRBxADI8jtfnyEyOxyNAAgAAv1hCbOwcIoTppMWq4Pd4zQUAgLFuAAAxS7NZWGX/ebEmzRylPT7sdAw245mHkUSm7nZTfq/r72LUs1s+R74lfRb3vlSxPJu4dRbxgq1aThz+rMJ6PJoyLGDucHe45lOUt7vAYtqe7Pk2ImN+nLnpF8wXhXsXZotejtEnZnZf3ME8KOiFJQLH3GDFnb8f/xyAAgD+1KOZVFjxM17RT5j6CEL+TzyaSYXlM17RNwx9BAdjV53oYlMAQk2q0qtQTwIwbNqYdyMnGCxAV4gKQgC8v6ixJkUAQChrziyzAAjvkNa042RyBzZeAhKhKqw7wIWotbIAgNAASWVVwSjnzZMXCQAAhghEwUQgFBUX0EIxAUNZCgaEwwq5rIBwRLg8cFiwhEvA8qmYuCgnYTGKgpDFRMWEhIhSVLmAFg40oSEsAzMlViakaAJApDyj8xyGKyIl48IKcBkWBEKGJ2A5BAwoAxDCUgGPy2NZnpBhWAJKhBKjKc8QUOJERIK00GEximY3STFxIoBUBEwAFwWAAUc9WBEAlNVYjtiS11IjHuYm4iZlEAaDAoWGpwOzAwkAAMByhIxRSB3hSmoaKmBnp1ZT1DBFAAzTCRzzMW0wYTSZRMXwj6liZ3E9XscwAJPJREEFFVWxMQ3Hw5joAwAAAHaYFgdqEcXURMWdMlNbRPwyDDCtpsXeUOG6HgMAZBIRSk2rCQb+NiBFw7fnpL99Way2flnV304aamQAqKhp1XlXD5Fdzgm4Vhs/FlW3AQpwMGcjNk44sAqI1cav6RxaFnQbmr3mJ8zG7h/O23jLHncaWbliPVWiy5gKNW7XuYskgr5Y6XFLaUJPmnkfNrf/5N4nnHM/bHLvYjLxj+U8R7P95OOq+x/xsf3sa5p1nqfU2XPdxMhv5iNxPZdfnjnz/QTtFjX335dvTdiFvp5reTScz0//wzh3n3YnDsv8X7l+N9zCMeLFXFiLy1tZn+llW+pVeR4MMAsA3sSTGVfk8qf9Rks3cRRiTTyZcUUmf9rvlHQriqcQW905TW4LQKrxOK+iUM4AAJvCjgN22IPBEmBEvSKUAAh/RaEEAIjMsiLLmiRAnKcNRxreOYhIJZVVVXECJhAVUpCVGIwuAKEBZKqoLpTXBwVAwQEAMG8AZSQAACxG0QKKhhAiTAnFweUyhAfKoXDRg5swy8Gmb8u8EwIGDAOVCj0MFEslRZgmNMQJBVBu7LhLRQkBGwRJxKiEqGgF8TJDDHSFFwwCKIJ4CY3llZTgMizXWZRqFAsSQmkhERPggGVBWVYhfBaUKyAAYcE6IhWKEoFLhH0aTDxEQACEICGRRAwWEaUAAABg4qClkNBCQ7IQ6JBMBOK0wEsAAAAACUjH5XAY6gRCAovxR2W/jyhBG5m3RfOr1wcfim5zwlDwrNVO9Y5zzONgT0ofTTZELgr21jfm138vdbbUttVsOgxKWggf08ZwaHGdTYvFViwqCIY6PuDfRGcQTgAgoRXUam+nltH6AAAAwOuE648vrFgwHNqoWBxZ1FQBsXFooKKYWWmooXb2+DZ9W7DamU8fYJAChLxeDea4IhsAAABwXa9kcWBICY6LjYBprz68MgAAkJeDJHyZtUsNDRGt7AV/IhMA2cz00dG/dy/rOq/xnfvsoCOx7cI5Ku28PpyjT7/74ubS3/rf5d8bolbPVw91m5Pn11nZUIPHErHQH/1RdNx0Zn/OZysn7x1fTt7puZstnfvjaViR5sIQP64SsEmrzKU7IycAvsRj2VigP/MjS22r1vyXeCwbC6E/87NKZatWfasimQBAZE2qeOXUFAAwz5RbnBgoFBJwX8oSACjVJKJCJWCnyEFHNSQREcR0gYioMQMZMZ+DUCEyyqgx5xXyAJQBkNU1F2GMOwAwcMCrwBtuwDTx1CQo8Dw6CQAAoSgRcUpIQGhxMRaIBUIBh0cIQwlhqIDliRBJET4LvhxcDiUAx17kEUQg5sB0lLLEBkeAepThMwQUNqGgIMV5LN+iBGkKCGUJRClPIfeGUDRKhe/1ivMj5moQspiFkFJCSsiRiARiZGaQlJAMFpJZQVgkLVIOJAAACikAEoSFvLBZF3q0kUo+dbM4Ol7vX9eNEj6+icub3yMUxvB+xylCNt+/y5NPe31E7e4u7BTOWl0F1Ztoyw9y0z55VL43F0tH7W7Of34LMhztIX2prfgS07c/fvuy+hKrI0NRw+LQ1mpCiwqIaXXMRq3YGVgdmDZWKxMeanVMLKYhNhYVOzsx1GKiimFjy/R2hk7RwFTDxtZeVASTAAIA0szM5HGBUJeLAiDqmNHEimmaqmpjUCIXx7A15kjIle1UVc/W1tZUGShDIAFAxGqoxR87q6hV7e0dWdXAkWGsZJAAAAAAAIjp25eImjbTnBFVo6yG1QVkjrrvgsDwOxhrk9DJWoh7KyVRcVTThnydGyHILk3lvSzZn/guvS71q+Zk009jp677/4P/VcWX3+d+brduCnoZzm+t79f5d5ZozZupZ3fesYAm+0UNS3cEiy775tJM9HQfTmJ+yoNpHE62AF7Ew3nfhfguyEmHchSCV8TDed+F+C7ILoe0GHxXMjKQZZmqBIBUY3V4SVXNZQIwHZsEhMNayhVODEQk4L5JtUwAICJTKYC6w5C9mz1ZFIiFc4FEUtZSBI+EBpBqjoLRLQC7D9wHuBVAOagBboWjxmWgBlNRDAAACwhIKQRJkgTB51JQhsvwCCPgMkI+jxUAhAIAYQkBESECUcJwlVicFmMBzSUR5pKnEr+cmaNMcEzvGRn0Te+J48qlxBbnSHmR5ruBhQ0CQigB6+KIgae5GMoVgkJIiYoKHEpU0hFhZpVkh0UhIhAXEWeIiDFT4RUD7SYQI4QIPcQoQaQhpEhijpKhKEsBJ+MC0UqExxA8tQSZ+gSCTZc3Q+C1buTjhZIMXH9iG7jG0nZpwT/H+TPQsvqz9bMd75w08vB91p2JOLdoBhec3yNnsFNz6tPusxm+141RedYe6/CJ+HyP6y05Rjufn7xicbwdnuqnG2ywc4iYUy2mGIZpb2NjqENsrPaGipoKeLzmmg8JySPMXTxOJNCDtc0a0HYXlAFgIMw118EjQIYxAAAAAMSwc7Y4mxYSDFsf1Kp2rk+B65tfchw5rsfj0+Ob1wEQDKjqKPZiY6oavh2CETuV2NHhVM1JEgAAZMAcsNGx9FQmM/o9YWQWuUIiKPKKYLN5frjrj+d/123REaRWIFmVOJ673+WHRbMPxG2cO/Fj87R2n6PhmvJT6+tNRmjqu+Xdi8r18PlJuRdjLpLrGtdHruubJjacXx+m6SQ/efoJGIADGvZIQLMCd6AiAV7EowP6Qv7Jn9lso1w/CCxsEY8O6Av5J39ms4xy/SCwsFdQltSYZVEGEiBrqBKvnKxOADDv0Kah3KECigl4X4qVAABBpSyzANw87zgY80qRICOkmpKQ2mexDKssAUXUWJmxkqioqqoKAI7qAxwFNeoaagcA4N4BNjcQAQAAgEFgJiUAIcBQhs8nlAg4AiGPz6ccAQ6HshQcUBAxVoT2SxSBuLgExZiI02VSYhKiYmYHIyANgBDCSBCeUJwKRUAADkM5MUT5DI8VMJRATCghniIuChAnIgLaQ5SSLAgSgsAsiBmiIinGhKYEdDlNOIk6gavSRVOsGWzcQA0AgMpoZrF4ap83xVEcyaj/FLW/ZflFGgssz1/O+bxt61gssc7XlhdPzaJqQ9Zzk0svN8UmB2x+SYzxXdR1MwKfI7ZmAzxzY7yJug5dfEK1qbfWDBsdxN4UU0xsrY6w2ghqGoa9Q0diiKiNVc0JbA2L1cZi419tDQe2hqOwqgOLMFpHrLY2Di2GzYQAtIqIHQFQ+uaWhgIAKBBMIdRij7wzzqgAAAAgqR1nNRPsDcqYmInt1GnTWU0RCRTrpIhYpxcFsVhNG8tUK2rqTFExbcveMFNFVEdTxcGU0VRx/VtsDFFbCX9sVRGxGgIyDUENEYsTJqYa0xsyAIDFwYSWADBgY7HaSykAAAAAAIAjeIKCnFw3EoIz8QeC7jMb/MGqJj8sqvK+dLwWXux572b3L08+75n/kRc+wTVZyL58LNPTn22cgJjmHu+huqvsXChADTagshYAXsSTef0gf+bvWUhTUsEoW8IinszrR8rP/B2pScooh/hV9jiOhQiQUWM1r5xiLRKAeYcJKLesQBYB86/GiooIACiyDGoQwFsDY74gI7KKIFiAcQGpDBTVlUlIdksmtC6ZXGeiOJyHHC4AtA+wcIMT9eej94jA+dxMzdoBDgCA0YwEADAYIoSCqABiIMxcBlwhj4LlEiFHyGFZVpBlRVlQyjI24YISVBAQQlhEXFTUQ1TI5RoXcaOMaDgKlUMAhsMIWT5DPQsuQ3g8ls/hE8IjYsdlCQEAEELERXwBKNACWkiQBLGQTMYAASEgAiIKFnoJK5DMQkBy4/qtoYKivF7C5WQgFclcPkiQIiSZK3rLor0hRPZF2kdmBuALwPOoAavzpHHGthlZ4/lnc3Rcj3VDRtAax+cOznbye3Z6VNxyX2c0yTeJ1PuH79Ev8eadP/r9egLPGfUxY9ERzRvks8VYE1znidUv5DOsD4atWg0MJ6Y6MA1s/LGxN/AlDmzUw7UFj8G0V8VUU8XWxrQVG+tU6/TTiRqmIXa+TNPOtAEACsV+JkCgFqtvP84eAACoi4mIE2ILjXmpLQAAAERkwmrVKXbqhj638FHiJmIvNtiYqmpvOlAZna1Wi6Eg2Jso0BjqhI0D0wlMUcccM2CwODEJADCjijMAAMAQHi8eF2BkkhlmajNZAAUAAACXBC0ggScA0D+ABnqUJGcgjybu90+qmf6cMzbDjyp3yKzDMhLD8Jr7HLb/vrjOL/e1uM7N3yVzmb82ofVr8ug//uFVeirT8TRwZK/3LiXnXDi7MQUAEnABPrTD+XgXfPLvwWzbWQrGETq0w/l4F3zy78Fo21kF4wj7AVSXEYkACDWp4mWoSUUlAOYFkIMFSKUnBjIDoL6mCgCIGqtriKjIygCEl1lj2EayvABZVhZJZhgmk7KGMhKcAYpEyJpBASwrHJ0AoQFQVlcwpg8AbjDv+GBHUZhMAAAABJTLEEoYASPk8gR8wuUSyoBl+UKBkMOHgEAAUEpAGEoYQjHCMg0wRYtREKVEEszMDALil9PDlvPoTl3i/eLuThwAkny+iICEoBjlUYZLbIaEE4GEEAwARrGoJBG6RCkRcWZmCuI0RbmDErJLBAwajgg5gjCfMhwQDpGQnkyCwI1BDACwikJCdiImEK4QZQZFRGgampRouZiIBMVomRaHA2ZAgjgCyWX5QrMwMnb4Iwm0m3EiCWRCDdDf7fHYdl+ZtO15jN2Wr193lradN4/TtseV7c8tB3+1y47YOrBVLIa9jWlvGk6I1SEi2AoiVqvN9IZhGoadjammnZhWR2KHWgDTqUX8ZbHDXgHAAAAAAGJahtGhnSMttAUAUFHFTi2WckUAFasY9lbEMTOtvD59yodwwKeZt+I1j+SR5HjM49BiGlaL1VAAwBExAADAkAGwVlaZVqJBxkAmCLhteW5yzbx4YfaAetntWOy3NlyGuqDPM13Py0Uxe36X+77S38vlxP362vPEdP7YWk6sh9sTs4JY/26M+Lrw2N9XVzwZF85/7Yl1w9ffO7W+dZM+Ol/m2px7rzlvb1M1F6HlSMWWeqdtULw0wyqckgAipTn/ua3zWwEZAL6zI4abzeXfoBljagFMsm9HRww3m8q/wTDa1hKZVO8VAirLpKoECRnV1bypsaoiEgAsMe+sxaBRXXOgjCDAf9SkhhIAEEVSnQmoByATi/kGqqJSUJ0pAW9DG9qkYBL4J4BQAiAK5aAc9QAAOOCGhc9ODcXbAMxIAADAUpKUAEkpmAifC6EAhHAZfojHo6yAzxFyowEAMNYwwxUQJbSxUEzoTjMt9JkAYiokRgK+kOIwfBGUcih1BggZDmF4igYcLgElFAwYKhCyki/gEmuUQFIqSAIgQAtAU2W+75eJUCgoTy4nXkFRwZxMAp0jSRaRKUFohqgoxQyaZg5FQQSiXCGgKHFRD1HQRhUUTbkEJS8Nwq5a1DiggCoAAFChaiyIqdGvGjCh1SxeB2LqROfv+L5lgNpu3r103V3LR7kuRThH5Li5Wbpbkgvvtp6bXgxbxyliGPDGrR9nxeW444+xcajhe9xOdJpEbZzntT6TrZKgFqsthj2qKPbWmopjpgPs1KKGjYE6Wyx2NqKo68C30aiIaQmw2BoObVOskb1LgPswegQoGF0AAAAAhDm9dQp2Mp3O1FSsYmNnGjPxVKfJdIatyIShdqJmABRyXXPxeAyrAaJ2YrHaDKapbrU0EAAAWChyMTFC5phRkQDz7caTZsIgAyQElmyuCB5y3E9PYIbdnzvD6J//dq4/aCY/84RWdV8tlcslliVcd/KJyuL9TLxPbDbLY/KTF/d2Oft7ns8y+yv119V0zljXOT8vujyTsXiud6s1GSLLn7/x7pwdvRxzcze97lxuCc4CkAF+pBMZeqn8NwjMZ6iZ7eQ92rEMu5T/DJI2n6FmsrP3CqCsqFQWAAg1VPHKibpMAPYAzMMe+AFBqB3A/Mma1JgJgNSuqM5ov1oFUADGHkDM5yRR1hBBSN45IWWGkFVp6GgHiNwTCA2AoqhkTB8AAAcAwAGAGuY1fIgBAAAIKSGZSIClACNgqACEEh6HT3iUQ1ieqLg45YGCQwhXxECICwLKXQAhQDtCjoHIXShhAAGrHT6H8CEmlICCCPx5grzwIAUxAAAAAFAsoMtoKdMEAMCRkDIJ3TmACCQlJADJggBIKYUUUuDGRIQGIwAwERVlEYqSRSVlRxkAAEBC0z1lveIypN0ljn8ybPsjy6l4ua4zanuiJymg9aVdM6vVs8/SbmXkl8U2BjREBteb6GOw373I1+Ip83fhYLbftZt5JMjz/G17s21mjaxvO1QeX+cOb86fswllsTGsVosRarGoYdg6VJzEcMI0ptdR7KafYTDspllVrRgOQQWrk76dxdmXmIJvV8XXLr6dXRcySELEqQ+Az279QgC19SU2ggAKomKxl9hpDDDsfZkmIrYWw9+moRar2tjbGFax86+mndU0rIhpsRqm1dkw0gHiwXVc13zKfOK4jlubAFZeH64kWaAoVod29oaKgA+fPl0XAAAAQHFkhwEAEZMmcC8Mu7FVyIgKSDBe6OMNFQ9vqkcIOh5eTPPe3MHv5zp5HUNTvNZZVnmJDP1cTU4uX/8c3C9DdF4vlvtklY/r3i8NVcHT+y/r+S5ox/OwAL3/PzsmOLm4QFl8jiMGhTsAbEj4C160Y1l3V/6E35szdvjjESGoRTqWNXflJ/zenLHDH48IQV01iIOUQEaNNfLKiWoCgEsVkVIkMF+rBACk6mpQJNBfVAIAZFmWEVkTgDtYjJHAB8wbhGqJQiYSJ5AAUZ1FoczwEoCkQhA+YhKgA0IJACoRMWbyAQ4UADgoABQWAC8CAACEMCXKgKdQBKICsAIioAxLeTyW5TIcSghHREqCwwJcSiDAgIslgSUxMeBEEp5ggAFUMgyHAWI8yuUAAAQlIKQSrBQYBoDFcliWR9gQ4QkIHwCYiAogRtOiRISSEjFRnxaHiIB2aIZQwK4yAlrIhLBYUqrExSzHE8pCwOMFfJ4CjwIhYiwQF2MwAAIAQQCaKZmikQARmImIhWAGoHMMHJYSgBPi8bjiHk4wlQABAACECEWIBIQ0fAAAAFWF7VBsJ4egARlDemyQHWL5rBF1U8NvZbS/OuHbBgfyzXzYyrTTHun/0dg+5VHUt4vv4DA5Jf2esSZ+4R+TKeB08yvPuyBEm8Fr8Et+5dLxZ9EXB2IramOrJmqWiKi94ZiBjdggOBC1GvYOFMPWztaqGFaHdmpj2hqlKuG4rTgGcsArE6CKD9dHeDyYAY7k03UTfEcAAACA8fikYl4XQxjmdb2OOfie0cYEAG3APf3+JnQB0EiWyLSX+lfK5ZsOhA6pJLWAN2MGldLysgZlZ2Bdv/TLacwsafPOVdefNefjSuYaQXl+zovWN7m4/dXIe273duvmQ2JPKM4v34wmfS+rnj83AP+nOC79sf11nId8e0agdYgi8+ofmu9NcqJa82whFHAKCEeloAIetYshrYJ/9u9BCE9tKBCEHaWLIa2Cf/bvQQhvbUgorKumHed5AiCrqtJLaqyxAMAegHnQrK4UogjAAtiP6rIAAKXqilBDVMoEdfY2IhLTjqWLFZxgrW0BJUCmIquq62X1AQAFBwAUHIDa7f5woADAAUABcwQAAAHFlKiYKBEVYzEWI5SwHD6fAAIOh4WAUC6EPJZlAcowQi6lQQlMIBQXEUBUaGCGq1Oh5/O5XIAAoEkSJpyitFBcQGiKw/CEFAxsAwDiYtx4jJGLC0wECIymRAWUQIym6IIQAQFgYDFREVBiEqQoEMoNlFBYlnIAAMkKMalQSpQTAADzcuc9ujr+nnjSLY7bVKDL62ajstbzOCbN1zY/Vj8VdtwMet19kUS1QXeMcHwm9q+p3c58XrdWGFks3ZDn9qjy5XrYtp+btn/3c251LQ92WlV0dfzOkWNszHnqLBekqaJ48x3J0vz69KlZH2t5DLJT1yRe66r6+s62x83Gj5sjBYbFxjAdiiI6HWIjFhtKVewx1MYeq42dv1CrhzhyaMeEGiZi2lqt9rZW3zaGYVgcOjTEsBHVAsRwDIvFTgwAABUADj0AAIDCOk3tTHP6cepga4Ni2KjVdAiKiunAELQVUR9er8cBtHgqeLwohsVQMdS3FYxxitdKK3ExzHw6HgQATGytYmdYPNcrDLmuyfBgogAQriMH4lI/Kj2SfWieAG/4h1FfrwQ3LK8vHJwhk22XaxsVW6fcS+7ZV3LP2a14D/zun8n/PvuS/9wRj7exLIff108safKg6LrUoz8yG+baX/HL/ez8+yz4+n0W8IFfOAD+pPNZUcP8M36RypQSBO6nnc+KGuaf8YuUhpQg8ls1ySkBENU18sopZxEA8zyo6jJQlIAFiP2jrCoSAJIiRI2ZAdQdkPMFoqysIUKCj4EbiCKQZUXgxBwhHGACBqNbQGgAqSYTZ0YxdakBC3eBgw8AbAALCowMAAAgSomBRcXEiJgI0+ICLuXwuFxKqJDlCHhcASErIAoOoQwIWMoQLgd8HgX4LAWlDAAAYEpICcXFwUKwPAHhgUoAAAWfJyR8oZDL4cYoBegSzbRQCC4RAU18gBlcrSozWTIAwhQlSjMXxkwAwFlKIUmyIFECJsYcAhERiHoZciDLxIWlFIqBEAAwAqQQqgEgAKFPMygCAAAABQA+CARu11Up03hzbsYbdMA1qeus5UWhO8X3Tpa332Oqait3n7Zqu8q8mMWsT80OMTmvT2azSaufEUfJc/hNazFsn6rl+lozasXmm2FqC7OwNezSMG0UO4vFsDq02DlUfPvjLxvDYloNi8XDoShYxM7W6uxA25ZWq8Vqa7QjJ0Vt8WOo1Qh0sHeAMQ5THJimxQ4bTBCJUsdQi71TWgEAAM8KAAAAwqSd2hhMVXurWiz+p9laBRtA/U8vxoSoOWXCzmcSAezsmGKIramFoqahVhxYBTXUkQKJNV5PxTOGICfJN49DYWFB0ACX8WsCsL57movpc7JfZUVj7LO7gLZnvR86+u1RoS33+dr96oh8xVJZ8hvXDctvfa7Xa3t8+VbOj/uh4/58IfOzsza1qcNfuWYN2mb2UBVBX/sV1YcfvFvnp9ddPL81v18pTQcANgB+lJMZWeK/J5C7qSUKQr6jnMzIBv97A7kOLSkAe69lWSZQXVaGAEBW1cArp1iOAGCeVwfYqLEMRCXA+yhqkgEAWVWDKGqJGgNQd8livgBZUxkimc8BCVkzwge0lyJUZgEQBaEBEDVWJrp69kFwUACo2QE2ADMSAAAiIQAQNQgSRPgUDI9DKRgOuFwBS1gRyFAuAbiEUApRUZq2EnPBTIOTP9gGE2Usdtp8hCgbQpjL5XEJnAMACiGJSYpGkoQkECD1YDcPEBluLlngDjAYNoVJ1mACiMEgFlKyZBcTEVCOVCAUEQik7mLiBUFIBSYYGATWGIY4AjMNQ4voPHKuseI+WxXtxPup37yc5hLG2147Ca2XxmWH+ZqnuqNNtXnfKKCgGmvi+5wdNv4UzoeefK7bIx776wHZD23srGrr2iNp57hVB9OBY4gpdpgGCDMKOLSYNraG2DnuGRgqpmlx4Gz6Qj0f0xWnvvxYsfhxZNiYhokV0lBgXjOQAFTVVAUmxMYYHcIjJAAAAGCaajqpiGERP6Za1Wp6pp2TrhgihsVqGlZ7UyxW0/SxWsUZC07V9cueASAUVcNJH99WC0o69FTsDERErL5QUOwtBoaPfYHHFfLpw6UBx1vIFQBAJvI4mpA0rbYmAABcHuVbEU5twDEgSt66JY3XZpI6Fca65tdfPctllkdBdKOclf3y+vS4eax8rIhAQiQ5YokXIYOanMu8Y5orv4u1YuvZi3v96tq65M1z6a25pqx/tWQ9KX3dMRLfeU601bve/HeJK12BU3Ym79o1OW0BkczPEuaRAB6V86oupPxTfiOEZA7MVjIq51VZSPmn/EYIwRSYI/4qZ84xC0BGjTXyKtSTAJAm8OZBo1JAAuY/aqiohACIIiuTGgDUeb4gsqgoKomIzHklkMqEI5J3HACRgFLIEoqIWqqrIleAMymeD+D5AB2RAAAwJRQBJRQRFRGICmkwlFDCspSwHHD4PJbhEmmwIBZlGDAMFQpYRMQHTYnTYAoUn2+zLMMTsiyl4ABcPl/AqIDlUqp0CSpgbcpnwAVfCQkhIEmNqmUksKRIBECy6LExxImSDhYnoBRgJgIRUSJCKBEAAAAAkgiSQTHzZaSEkKY5lMFiJCpAZDKxMlT9N7ssEpRwaH6KJa+xUcjGbsex9um4OB58ymOYTKbYmzaObK2KiGGIaDhuTExn2KhD8MwZJ6eo0bS92igz2lqs9k4FtThwKDYWU8GwTxTT3s5itbgKAJXYAaJMmg4MHUwEAAAAYGsjo03Y25Zpg40aYou9VRygYoMppmA1UZww097WtMdODHtRw6G9rdVQVXXgmThuGiqpAKCKmvYzCIExo6KgttNJ21qtgCozTh3EMA1lVBANAAAAfFhnKgKKdepMEMPeCgAAQoUKgBGyG8hvuoFVpRyndlabujp1u/RrRBQcoqC4q0Kt7QG8U5zn+4P50r49/jxr+z/zY6kW28W38f2zq7zwSqy9usHcfm6KNb2v49n3R3bV1Vq+vnJc7nosK4tewawoJ456in6+7XtSc2N3q2m3iauEDkLMV7drtVkGAdw92Q3lMuk0gALelPMhGyr+LpCpTVJA9jXpfCCGEP9OkKlFUkD2raLLICCBqipeUyhnACBISVEVQc5LhoBhtSSpMgIY31lVmYEAzBroedrQ0fHOISMySdXVMT4y2kkAykpVEQBQJGpWCJFV1RkZVgIgalYVid24fEB9AAAcAADjKBIAwCBgMQYlJDQAGCiPshoIY+RCpEiuKAcM5YoRCsqDkBBAEoGFJEgpCUIsxSHCNE0IoSEiLmBJUhCqQaIB4IEvjAh5Jj6fMp5SyrRQRFSMIRAX0ABTFCgwJQGBmFAoIiYOAmIIYqmcBUwzyG5X8GTBxJDaRJCSDCgAQFdbS4YUNmQkSEnMTJzksaTHcr1457FTvVkyLY7qN6HEfwqt1W0hxfpic3PRVnYYd17GZrEhAJ+ul5qjis5ut/N8khcac7zW82c5BEibX9PAgajF1rRRq2LxL6CG+Na02qEOULWdwGprsWDFqk7YiOGE2E/1pRYVSAAwBexHq43FYgDgpkhOExH+8DuA13UcAADA8XgcfK4cT1DxYYi42BtqWsRebR1TxDStDkirYGd4YrGYnqIodiqKxQTMKq4Ax4cMADCfXhcKgITB9eJ4cGofHgXE6i8n8MHEYnFNCAAAcyrYOXDkL0MEQEWFVvhIDg0FWj3ybqmyctfNxqa4v52ZhGZtM1ny7BzTuX6G2HcF2REclPqJax6cc/0+xNl/3d4fLzvBSpHPUY+4rZ376/nP85GuYJ5bjy/nVqN6yE+gi1br5KMP72BdAgiNDjL1q0dlCfaJ7s3cp8yl1goHXrRjof9K/RN/ZXctwRmysq9IJzLmh/jxGd11hLQYKfl+ACoqQgYCyKixZvkqKlkAAEwwL3RgNQE5YQSyAKxNgj+z5gAgQqQgKiWYvX1guEFGdUgyQBALJLEBkSsOAZbJAIMAIFSmlYusMQGg9AEwgB0sO+CeIgAAAApCCV9AmQaX5VkQihh4ASjHwg/ZTXh8IiIqog9QEJZy+VQUlICmwSzqCClJFoWIAJSHG00JaYNM4EjlcmYoACghLPo8FcEAgiICHYBkJhIQk9nDg3ITZQZ4DFcUAgFfwAG4rFBIWB5XwGMZYYQHUC4jIi4gnIQSClEEYUJEDJEXkwALwQAACFgcJVKiCxEADJAKn5muoEsAkGAiEwAVpAxlIeYSFwUTAABAWFSkQhQAAAAAiCKUMOCwYm6eUXyZbyFCOkUBOFBJtwTfiDnXTru7439f1xopRRy2WVI0vMBR7HQFl5AT25dRRt15OQvQmxZVjBvyddJFRW2sTFUVHXRyUmWaWNQhanGKH38Qe9PiY5iGKYmt1QQAeB9+i4ppp6oAAKAG9g7UtJiuib0YYPJ4Xcf1Yfj0gpZ9mAamqCkWU3WqnWG1oNoCMEijKhbHTRF0qrpeAQAEhoG62SRtHBo2JgAgtmT0JFBWfPrmMnstu3HNWyvtGmk3m582f9bLlPuYzCwr/mj5f9rUK0jki01GaaPe5wL91LB4n9R6sav/8/OjMJ/87D4xWDYPrzmcq1Vdnvg80Xxin043Jc5u1TPbUudu1NzuZ5rXGfGb64v1kX44ppZrgcfoh1A277uL6fCUCgBepKOhu6if8nsw04wwoYKwiLpIh8N4UT/ld2YYEWbIBWMR3Y+EjCjUpCRJIKtq4E0NNZcJAEywB0GaB83qAgRgAeyvuhQJgKhUkVKRIAcDcQCmA8FKJOYzQBSFyIq2Zch+AKKyMgBQ1Kws0grTgXhunhYAzwQAAEAElILl8fl8luWxHA5hOASEJTwBYcHhcbkMYSgoC/DA4xBCQ4wWEJoLIqDgJwXQAg8GmCXCkXT1SFhAAyYqZEAgAQAAADBDKE6JcvhEKGBZsIQSgIS54AlZnWtkCctICYAwRdMUgahUIBSpEKdpUAIAEBEWQhEGmBLSoEQZNBFRUU8wwDRTBISiJYUgYyblLEjoURk8IdIT2KiE7DB1Dp4G8FVO82gLfMSFnzOkhUM4MwGAhJO+K5bGygnM+enY9A1OTXXDFnGA2DPpYPopBqCqMikztbXxYXIGcWRj43BCDRXEYi9WVRRzVKug/icxsJ1uElQSYkIpAAAAvEPjmCM7084StrYgKihyXR+OBAAgCiCmoQZY7f3YKoD47QdRwy/M9g4BkDhoMw5Ui5uUoP6mZaSx8XZKUp6m0ub0h17RiamilLQr9rIJt/w3uHAP+tOi7xoV0c990jFvhqrbDhN2rr+tg/Dmjj1s3112+RTjFiy/N+oYbBkBI6dSLwbifk5AU7J99oyKWbNya2OK5o8sQ+Z+bVpu32VwNuZIynwumxIftb7xFj/FC1/5/pUPjT3L7GAOkaXJvJRpOGe16ify572e5w/5/wfTKcVVUwPek6N5eib+ib8I48dYpmCoJ0fz9Ezin/iL1L6Gi4Rg6AeQWZERQIKorjm8iqwCAMIE8zyoygIiAPOXLAkAoCwqS6oS0AFshE2YR+8cIjILEVlVBtEdYI+ALtkBejoAAHZwc1AAwI4bFrgxSgAACgXKYQUs4TE8DuFRAeGAB4ayrJDhCbksh8PhSAtBWcISDoWQEEoIgYDQAppATCy6oxSM4wyXEjvKBJQKyO4QIuTps5QAoApYyueKGjngEYBAghanmQYlJkKJeVlKU+IsShFKRLQEmmJCKACQhZCIQkrRrrFTOSUrSOGVHKkZa+02FVmUSzhU7M47tb60JW1h2rDWdfs7R7ttNtmQj9FY7OS83wBjWLY336Ou2MTODtUUdZs3dR3f7I5mY3FMfm5OxlvECKMGDmBnTkptLC149nsSGRhy+xlrbRhOp2Qk2zDozzxBBscBTFOLVcUUDEdi2JpqZwphGvYOHIm66uzQajEVwGqH+lj9ZacWvwzX9LHYOvuywdlpq48hUj5WmYlpWKmJ3Xc/EzB1qgAAAEKrP/5oGoy9AEYOVlPUnHDcMauJAoAY/u2cWtW0BwEAi9UJR4aKhoFNWAgIJT78Xt+8BgCYDx+OFExFplpGbKwGuFUZAAwAFD/57xkYaMseJtxOyyb288z4ppjX14zrdMPD1ib3B/l9sInZOAhln2sqqG1HXLZnUTy0/c5Noc87e+3LzzmU24fg4zVf7r0vr/ta/Lc+TzZy+HGN5bLoJtN9rJu7XM5v9vqzfYknvdagNTwELr/o/fep62b96SKXeY5BHKKaKV9w9piPyrnnXmgbXEABAL6U81lZGPuTPqKc/kxBLF3SuYwujPmTPrKY/hxTAEuvMhPKyqxUWSQAoaKKV05WAgDzbiAMRy0VUJRJBpsEXiXKCQDbdbMgPM8XEmqKjKwQi4V1DkJZysgai+QN7Jk0UPBrwKPptsmrSRrnsExnh6Z7uRuiMzizm+Bzc1AAbjjgAx8vyfEB6htYADa+T2FkEgAghRBSsiRJAkIqhuFSgYAFS7iEAUu5QikZrgjlcMAwYDgEpaKAgZMp8QoB8fJ0hgwMwUL0gktcSIlRCTBhZhBJHhcsTwUASgmRgxIRFSdCgVCcFmWaYY2QEkUsKUoWhGVKzB1MyUx5CGgaAHXJEkaSIAADgAguHVRuJiVOkKNijtjU6vx2RBf12TaW5rt2vf3Uclc8+dnZtj5PPSt6L0LwPLczn/+4FNo653uJopjy7TX7+fpfuXjdHJFfnwz3vyu/zc8maq1ckisjS3w83r684tOd3uW8cvZm3LYnTcNOvNvJ5r+o+RjbxVnYJh5e+9gUz+dHI+lO6208OfN5u3ltT3+dZvEcwGa+rclRu35CUCnvPO3M42Rc1Og2w8vpi9N8th18B4tY7UT92zlyYBWxsbGbAjb2pji1qOzGD854GAhiVWQm0yb929to+be1mj72dn7sxGr18eydmnZqFdMQTTu/JADAfLg+BRQAZAMqFiZtpyGWGQFHPoZMTqfWGQ17LBN2ij9ihwimI1NRET++bdVmesNqFdfZYueEA9Ti0AIqOGYjGgWAEP59GapGKKBimkzYy6xczPE4nUaT7hPg/P4C7un4a+eyziTEkDzzepR/ffGgA/LE73Mg6M334vV86XPvqD7OTw29/758Mq9P7uXf1/+fqeWyLFm5AG/ujyfsp9uUVk2x3PpWAF5ABaBKAB6Vc7boQvw5v+ndaBBRRVE5Z8suxM/9G3f5bxDJ4lVtOhyQQEZldXhJVUUJgHkeRHVFQAKmX1VRAgCRgokACO+AnHe0CO8GSIgqi4VeACCLKnopgANwE+BQFJ8CNw7A/aaucQDggxPAJBcvDUtnXgPEAAAAQyjGLBSlRT0kIAZwCDECHMKCx+UxQi4HDAcMYRgu4TFCUMG4xgUXbIVlie0AsExelM8nGsB1FISaNIFJ8eVEyLVSSSgoIYGn0VJCCGEFADimbi4Bu4REHADAEFIBYBsgIgEPAeACd0ERAAAkHOA9NaYbPn7bzRHhMHk8UVy3c7vG59xZ7EhPdP3z0tzn+sT1P+onjqbdPJ+Rubw3Sz6fqoz52RJ/7s7r5joXAP0Jhqrq5vjj3A210zw7R3P989dmP6+vr/n+O0dd43WhOYG4KTbOPG51+em7pCfdBN67nE9cN5ulp6PtorEij8PL8ul2vv2FcoW3GtD3IdvKlmwXN91t5obUb6piGqjYOT4TVc801NZQHHPcSVErtlhsHVhtjClWVRt7pxZRw2o1HUyaYlUbG2gbw4G9OVVH12pr9W/bdvixMZ+YT59rEoNsd03ZzuBwAlSzRAxbi+MAQGPlGl84cXKT0IoftSiCjurHL7WYduDAKYZY/VIMxF5lwsa2HTmwwVCLh0URQUy/DAFAxMZvB5iY/mAAAAAgx++rkk46FWcM8ePHsMHw8aOWknCoHMgLEGAJQdOxxSc7g998tuKwTTMvkXdyiaE+cv+5Hl5eXeZsNk+8n/f+wO/m/KbjKDP3b7xFWz3vun/3eLP5PFsGN+7GKnefHZdwgqWwoOBlWYBXcLz5/ysA/pNjOVlY88dnwA2uPzqWk4WVf3zCwUWQrprk2AUgVNXAy1RzUQGAPQG7BQZVWQESsDlYjo+iEgRAFqpCGRXANM/zvEbHhs6pV7QtQFG7bYEiAMqMqgqzN+8AB02oArcDcAPMO0AZAAAOJS4UE+EUgClxcQhYQvh8PuET8FnwuDweGAGfRxgGoIRPSNDMFAS0EbBADJ4eAiEBExaKEVpUhIX8pMBjJHTCAAoOhBJXAQMQSMo0LQF3s57XGAGhQn6IUpZCtIgf2xi/TBQ1ACAQkYVCOiQhAQr25z1oh+t1/WUOA2E6wiAJ1oAn3ZirsS06QA54k6w2CxKjQGP2B4458XPacdM0O90Hw3F97P9E7GUzW9fz9udWnj/HeW2FLngHaBNdnNfW08aisvimb1hMxzCxWh0YJrbYWa1IG6O9YRgOxNZWHcOpYeNsNRyYFtPUAFNtrQ4MAVTF4m8XAQBgvnlcY6BRnWadNBWARa6tkYG85vFZq2c11UlfeBY7w1kMw8YvFGcnLX6Z/jjjL7FVW6tpRbBasBEfv8WhU18WH9NQ18f0x9YEJMYBf+wMq/rjtz+OVEGcOhsOVBVIQE3TVLFYsFcH6WwvdqkWDKs1DdMwBWYlfNGeAPksQHqNLXlIIyEAbD0Ubtq1DGTKQqREZBKwBAsrza8G376d3FzbDu+yhFhl0cP9zm/GsuxrWQ7rg/uqy6tiftiM3jw27LlcuOFdxFYklt7nZz6Gh//Vy0E86bp9g3veZ7/+9Mf9tV7DZVw5716uL/1S5e69dqv1aFl/T3Sy2boYMcR/tPFaiJcGg2yV1IIDfpTTWfdz8cm/9WI3Qs1BQSAn5UzG/VyM8m+92I/wc1AQqFcARc2KLFIGgKis5lVEJQEAHTHPg8oqSIDpz6xZCQFEREJVAvM83QGiZgiRkGA3zHIOAFFLBMEZyqIoQRyOSMoAiKg4ociizgvAAcAHfIDdDezgJgEAAAAACGJiSBCPy3JZwmUoFbIChsdlWEkJQRkeUSg4NqE8ISUQspBpWZRZRFRcyHJDRKALeRRcwmUoX8DdKRSAoSQUEgIhyUeMxwgR1G0oAnAlE4hiSSml6MTMLCBwMRABgIMdWhQFIbSYgNAUAwBIsAwcMBYB7b5Hl9CgBdEAACqF4sciQ5am9s1ziw11sqFeEv3XJXkoQO71hTKVM1T+9Rfn9fUlc26Pa/qa6NC4nHqpJjfnjb28rZ99ofcYY1w/1qauN758pjnHPPoL8vGP1XfCSLHYmaaKIdhaDQwR084xe/xqO02LacvgyBqmE1bUXkUcmVbxsdoMola12BuO2dth2FgdOrQqAl22pqqd6VAtBoYhgprj0+uXK1VwcVsOTMSzt58iggCAmI6MGf0DAGBrTJliWIa2tSDjWWYUbNTWMmFFDccMEQb/oKbFtCLmdArI42ON69LmkVc4YmvjwGIjjuyNBMBjAQAAAIz2LffQr5AAvAYAVKuEub55XYOdTMbPHLeUSzhUKzPX1CsClEcvFS58RK5E1tI5RGbGax/Eeb3MK0mG1+/hNlcOsu69Q9X8M7icnq1v4d7+vnd5ytSf98pifhytr59478/N95UvNtf9/slSUX3aJvhtiYMfk5NLVK4AFoIrKPECxz4LAADek8MD5ZJ25IOZkqEScQxdTw4PlEvakQ9mCoZLRDF0VyDLyjKzqCoLEiArauBVRDUBAAw7zycgIrIGRFkA5ruszopMACZzFtM0HxhsFxIGQFlWEeAFAGR1pqiDZgJkRHWZKyezqgDA9QJwAAAc4AbgAADYwWWUSAAAQABYCGZIlhwQhuELAIYIeCyHD8IRE4rJcLgsQyh4hEeYEopDhKbEBCBMEyLuSHkkECjlKSqkhUCQYAlhnFwAMWIqRgEACAKXGCV1QequAooAEAhYSBMCGszJLFIuFIoI3CiAmQ0AiJhkwgTDGQAAeEiwhBIa5jHWCKu88rqwJkPSFqWa0SIqUM0KEgWpCIK8BuHQqvFpljfRQEn3n3VNbztnNrMetpvTYht4HY4XJ9/SUMm4eKDWn7Ly087ZFuSUelkyQp4/fS341Oqy+dmw2Pnh41hG5PWxNifYOTptz4bNh9Ln3NYT9VKVDd9vjZFtbSwWwIGZpjhUKwYYdkyMGoaYpop/O9Nfhk4TdMLGsDEs05sTLeKYjV2QYmsjrql2DhWrldEUFQOzxDREUQSLOAQQq9ihJAAgnz5cGXh8SLIYgtViFQBsfDmUT78PQxi4PrwJjqxWh2rRSQsijjOKWMOhBVBIMayytoRC4SkE5rEGAGAC3Mq6n10p+5AzzDq0kKeNiNXPrU7vk7JERUFCF9mo9bRjTvwTztnNj3Se4m/0yQ4imGD2uyP7DL93jPYJvWOiNf/yeo39MPEjlegh5EpRdTBfW7L/RUE1lsxY3nST58eXCGL3D16VpzuW2HVP3ipF2g+ACz6kw5n0Nf6Jn8XU9FGSQRvS0Uz8Jv2Jn8UIRZ8VEgftB6hSLUEGICpr5E2NNUcCgGFznldhzjlkBQjA9EfWBACkzJSOAuh5ukSRqFlREBFh3rFJElBEilqKCoAfAIjKLAAqyhqLNA5NBwDA4RYAcMCnSRM3Nwx24zQB4AAoACcSAAAADOVQjlAoEPAolwh4hAWXEsryOQQsF8O7OQE4DGUoBSGUQCigwb6ImMCHiIioOE0zYVqEiEqKFeLi4PEFAgnJABwKQHGFlCFhElB4CjvMCKKN4ha8aOypBAcUgDIhCEo5BEkZDADA4iIi4iiEHhBF6eyIAhId7kgAIAFS6cBjI6yKabYtnSSS1aJ8EUTV6FqLsNrwaYZso1B9SqJkwVU2u2hmq363i3fZ69jT0TmWttUYWtPYdPXC9GlzNDY728rKyuHl5u5tcW6wt9mC26Rd7Zfv/K+9WdqYnsWzP69snjlJNMpodiyxCSVqv09LR5tmoU19K8tzXWRtcu1rqIkNVrXaiK2dWyZO/XHSB0zTx0fUzvW3iafqmGMmpoCJveMWm7IfKaQQwMc2cB3YCdYUz1AGq8V1DEDgcRwKHzDIqgiTx3ePaADAKYnF4wPT8OUHUVs/KioOKVzDgV9uAWhZbAxnxUnTapqm+mNnGGpZ8ZZuUSLaDMewk1RDUdMxARDAVCcRvxsAkFCZcDTVmgDYKwoAQAMcaZELHxZsz+LQkQ8ldBUc875d8OURrJkVsGGBd1rSrbu3lmRdJFhWSpYXUJw77PhFEcQsFV9CjLRMMLnpyRz+SCgvV1EycAD+k6NBfEsxyr9lLW9VPQb7J0eD+JZilH/LWt6qegz2YGG6jgBAoYRXTjmLAJjnQWUVRKQIXMgaAOCtooYMQECGwTjP+7Bs+IC9lAkVVRmEmsmefwTTpaIBzAvAUqCuHT4AH7cD7hqA5QaUAABgENAioswilLgQ7HglXD6HMiIsAzGetAwjyrDSAgSUghLKJaABwwvbugUELN/AA8sa0oQEEgAAjeHyCAMKAFxKQInSQhOwMDxoCsTLIS4iZLqigsWpoIkoAQCAKaaYgIhCJDqVi1LSJFKUUcIyCqQpS5pQIi4vzGyRm81HP8wLMutPzBrQb9CQ9oRfth/dvqhiQfXPj1YDtt7pazTdeBLjzqIfXO+YGrpzc5pP/Fjdns6O5PjY8H1dLHIM3QzkeaCWyBga27k5P3rU2XZrqk3bNFqOLOKV7XQOHDdErDZWO8AwHZk2Jm3npIVA1WJMEQNbf6m9xW3PVmwwHeho2qk4FFMNw6EYgKqpauuXmIaBidVi+u3IsJ0CAARi2ji0OPtj9QEAxILVzjTDEkERtqLRW9Uq4iyIaW9iGn7bWybUaiotFhza+bY4FEx705faCmAVdwLTESStgDEaLkFANAJWh7TJZMoxr3kHHLMxgQIAgAQE0FCjDZLMyairCiYYYMv/jI5m9D9SHQBJnpyGS1n6fcszWD0c3gHZ5xp5RYdYSzVd8vajut11s+l9rSu/P+umujlcN0Vtat3Xe31F92Z5tbvGx+yH4L76pvFVtXdlv3juOMQ75O/mtRx99G/tD+/X9hmY2RGz841mrDyUzdnYmnv8ZEfGAz6Ukxn2EfHHryzE/xG20IGldEgnM/Qj6o9ftSEywhY2cJCvCEBEdWUhBSAqa+SVUywHAPYwYBfAoFQhQxDYZYA/JihLKQIgBVRB4M3zRWSKqCgBvbFp2tRZgIoKgJtPgMY2Uu9fNDTNMA7w4abGcVNT46ZwANQ3Nw4AgIUCNoAyAAAA6SQgGSxJCHAoR0gYMITP5TKEsiojIeRLApRDWA6fkoIQoILLy0QoFoowM+HyZEaKiAtFhI4kowbMDCNIDEKeUYfOUCJSUi0ZAAAA4O63KKJivpKUUBNDiM4I+RwqyuULKcONsazsJFBorRMRE4uKlHz2ghZhrogyCQrgCDRpn5dgQUFQ5Hyu/RqK5pruLhdatPTyVnO2TlOYT+yotGmfWv9lZ3NtFOvBPGbxAjT63Wy2e5+bLF6+n0W+vkezwRhD8f0Sm939OQEZ32M+p24wkmiPa3aal1b+YLx2/IetncybkoZtCFomqT9at4jrtO2RJUbkTYFPLHB0cFz/XuOmrZuneXR+xzjeQdNY0x4/G6ZVrKbVMB03RxE7EFLbdB0YarEdtBWgDVsn/Jr0tRunqn4bZhqWaVqS+GPbDgAAAjw/fpxHj9IQ4HENMyyTavEBi60hpqpD07CY6sCwWieQUMOwdWBvtR0G037SsIrNhKlt2zYWO7WGzVQRw8Zqr0aBgpqUQBlTphiGqYqi06wC4Hg8CnnwumYG3YgF2rxVr8njJAAAAKhUqvT421vI3UUo/GhnR7TZXIM5nGTpb7zLPFp/1t6vec158DWinxJqRS7jn1VrXVgzl9edeLyeXGr5lsO/Pi59tZ68FJtPnl9egR2c9xKg6sm5BAAAu4IPXpSToftJPl6MtCNUJIdgLdLJ0P0kHy9GmhEqUkOor8gkkJVRXSEBIitqkl6FOgDADjnPg6aqgARMn4zKBAAlJTVEOxC9G6ycvGXAWAEMghWmFSA0AFlWVpbGTH0A+gIcANQKDgCAdiIBAAAEgSVDgkFSYPOFHMqAQ4QCSgUChmUEqAyrRcEyHJ7CEkqcxZiI0EyBErIIKMMHY2JNjJBLrZQSSo1mVsgRUlDAUw5SOFPgD8lBOKHEPChRWVRAC8SEBOKioqApZkqcCCAsCAgTFhElhSykCYuIM4i0ohCIiYmXyZFqSJTzkjiGQ+3iJQYbhc1wh/Osh4ijz/fo/w9kffZ1h61Rv9JbaZvxxMbTu2OCdeppgbrx5+fN+Uepn9sdqwcKhTEvULn60/qEt9YSGd1Ofuq+bZsiWtlwiAPBoZU2TYugqqOtjQO1NxVSHYmJQ6RJxLSYto6XQ4dmYTjuyJF18LdhgtVOVfFU1TANRWzbLwxfAlCYpuJ4PI7MNa/X57iGD4/ABECjwWyAkBSYpxDDYmJrOmEMJqZhiqihM9jZ2ThSW6tYTMHrkZCJNeZ1A8Dk+jQPuD4cCovatxMWwwqKWqyumobFKmCKIVYHWKcAuTq/2nOW43Xe7ipK67Tp7P9GVShZL3tSu4vT+9FaTI8iOzmTG+nTuY9btAXSI+0Mt6Rqcb4eNod37Y76LJt++f4Lpgnu+95hGe58mfxnPGcGnuWGf+fVlkJy4lx399y+T97f7FPUcaBou6UrruqEPE24O8iIHzaHOPCUKBJYXJAAvqPDA3EI+/ErGxpKgbyjwwN+CfPxKxsGSt4rkGUpK9UsIwFklNW8ikI5AQDJzPOwokZBlpFgOm1nQBZKpVok0h6A2d0EqRoikjicoK4cRICsiOCVoLKsCgBCA6CyhgqGRuoG4B3ADcCbygAAALMEJDQLC0cL8AnlEbCEFXBZLuVzwOURcUIopRDy+VyICZkpsJiYCCAqpIUkSEECRMwAE3FREaVZnCYAACNJaCK7INkFkaTBzAADAAAw9eREDATujSQRT6rCBzzLCRUR7IAQw+dy2AiFK+aFAAtIl9pAKAAEIFAu5HSRPUPEFzSnBVdRVJUuLf0s+nAiF7GNkj1P/l5nMVvrHC/q7T7N0Tiftbc1XdO0WBQpi70VTLVYHLMx1ap29g5tHKiqjSqiPqaKaTgwTXXC3pGpOLR1JAamZ7FBbF2LYSnTtMWRYW+jgpoWUAxT8Zt5XLken46l6wAi0xvaNiOA2hi2VrsptqaoiBiGY6JTbOyxTLVMTqitdVCT0YIyNHwOXbiOAZj59ErL4nRKBJy6UAoARP0b0+yns670CwAVBlBZUO/Z4VD4QjJltGMQUUCI6PvV2Wo+FQqg6OXxG78u2eZiood3Q8/af3TuFoUC/XuZ67BVR906N2I9rN90zit2dWOtJ74v6xOMu318uerLWnV0/HJO7vPN8sRy7obRu3691/fzn+4z9n/NXLz5yLbzx/Mcl51S3vrP7XVppx+/RqyP3ux6kQ3r2zp7oDPLrK9WvSYz6ucWXPRJSFhpAAHUBADelDOqjqyf+SsK+Ti1hULdlDOqiayf+StLcTsb4dBeIwKyrCqUZWQCoKiBl9RYFgnAkQAGzIOKCmQCLIB9smaNIQCIqCgVWR1VZcK8g5N5RwvzGh1ddFEGgKyhOozOOwDcwFGgrgEcQA03HFAA1Hao4QwAAGJJkgURCQIYHJZDCUMoEXD4hHJ5QobPg4Dl8gBQDjghSrwlAtACISkoJklAypImJUpM4BOICI2tXAEExMwTM6yjfAUAJACSSCFEYxJOSWCAgMYUhJMjaAECi8oESrkAWgItcQlYCYhCtJoQlYVSSSkAMJE0oYCId7Sku1JKUekdisKMlcR4OjRoGziN/ITEt2P0fMOJuosatpRHH78f2UZVPb43LwW2m+/zhFNsQV3nkeEoeGiPN6fhrDfxc9GCa3/BUn/89VsM8zf1fppaFT6+Sy/Vsxja4dsZ37Z5bjvkRa4XbXStUqQ+G2c3UWvYiaoaYmO1mTCnMzFMw4GdA4uqdSbeKIyurZ3h0Ma3OfpyWhgmoThmemrYOXsiVmdccWCjgBiGYYgAaIEKKeLjB9fitwtKJ4CGIf5WX4DhmWZZbbww/OhoEV+miGLjFza4AYCok1ZE8a1YrWDjl4+TCAAAAAD49ttqBQDAQOkyAAAAAwAA2I3PNStD6oAmCLIX/xof3pokNmiAkUiS50Tpx5pck6c/tBSsMEJW7l5/fnfy+S5+Vz7Q+lbyCuf9rVA/D2GHGebTFtGfOpr8srWV9zq6IvWIdbl9XrlzmC1q/6IjzefejLpb647gZzPYZAL3KjW8oRpYVgK+lNNhKlQ++yMovs4K6VJOh6lQ+eyPIPlz2ohWp2NmBAGIspqXVNVYEhA4EiANwxtWcShBikDkfFXUGCICRBAQKhKYfchkaEdivDMAUNSssZKyyGoA4Lz5gAIeYIEPBwCAtwO0VyIBAOJEKGSAEFFaVMgCMcoXsCyHgCFcLsMhQgYCPmEhBAA+oawECQMEZULCzAzQ7KUFJJMIBWVCcVEROQ5ZIBBHQQJRMDOkZMEAiARlCSsgfA5DuOByBJQiLAKahZSY0kwRQBA0CyEUYWakuAfI4cmNGEwvBY0NCUnp4Ty8pMrPzv2W8RQ/0s6OgIUGKpsHf+Ea6UCVAwLvxJhhR6+OTxXy0ne9NVRDVUo3DA3KyUo5jSYq00+VqXtwuFV40bLJv8amGKaBrQOLIwcYanUIbnj9ZnJ8rhxjTMccmuIoBQBG05gOmYYhpjFtioB/bEzTImp1aCP2ak4zBwPF6kdVLGJac9LWVkkEQ21RhxasNoYf64CtaSemFQBAhmGeNY5JLfa+TDtbVZLUUoWnbuSExQmbSTJQUVFIAABAbVXTYgqAKha/HPlISAAYG2MrDNBekD+b1eelOJxJ6y7ry5dOzGbYN8GON9FhE8xhna/hM3G19W3/nxrP5Z0etANeF/R4rYfrfdYqCuaUras3lMIzs+f6aK36dvV8/Yv/ZH3xvvIV0WvcPnedvXH2U7eCc21Efo3xvuEy6jIchr44XhVD9Pnq49yWXE/x+DRndbm/trgkS5eh9Gfbs74svI5flnjohV4iuiAt3hH7gtH9CLNjcEgrpyv1BF8GFwB+pJNW2zQb+Uz+3C5orKwe5aRdN5GPfAZftwuCldUrQGVFjTUUlAgJFDXwyslqAoCFGZgHVVQkBGA6ZgFpFh516MCRCMAJ2AAgIqo5CwDK6uD5AAcAwA4UJ8AfJyNMjWm7DhTcALcBroZmMXFDfYAaKDgAfDc4AFBgGg0AAAAElhCCpRQgCpZSAUshIFwB5TIAEUrzQQAOAyFhYITdHYG4B+3OokgRGirzOCDCCCGUz1KGEhOjRGgiQpW5yUwJmBYRoURpWpTBNCEsnoSwQFwooAiIlBAU4uJeTgCAKgEAIJFgBjui4oQAAAW4ZEWSQaAAyrCREJ9liDC+R40pL+WC0TRj3XzHXNqG3y5+QODvBPVZLICmbs7bqjadINRru2jIokPc9WOY83ZAQ/CzSV1EvK3698p27PR1REbT+RjHt9yiPuY2v9kXquxvtkdD/bnN2Sx//XmIDfXPqqOQUX+xVdDXXXPJix1e+MXJznezmuiTKGRncNTPvbFpmhsbZylpfrfkaMNNcEQ+VZ68kt+mcul0vhhuGp0fw6D5fAT6+TWoIgfbjvrN63G9spPt2mraWuxKxMaRI1uxOnTCVAPE6riYoAJOLSYY/hJnA9A0DavNVH9cQ4axYcq2dDrVPqVqxLCKYzIdpo2tFaudgYAaiuM4de3DNTPD9YHr00GuK2fM58rCATAMA6tp2hsiAACwtECmtViYDkRsbLWtFjvDUDu1V1XHRNF2gA6sWSMDgTMAjDUUPL7b2s3Uf863hp/HkhWLxDTvOQeiz98yfgPiMEps5Ph+Xh9ywTvEI1+s9RFrUcQ97u/fpZ+YjHKQu8TvOg+IaKhj8P+tULjHr2hJ/sIpNQPelHN2KoQdlddQwrt8GtA35XwQI9KovIYS3uUTQL/qTNpYQQDKal45WYsEYCEIMw8rqhIRCcxPFtVJAqBSiZoQYfbmHZPGdAYAqmpWxuztAAfUADgKAOC4awDgAABYABbcsAP4AGUkAACgCi+dQiEJX5SFInyWw+cKQBiWUkoll1AxVkSQYRiWQ0Q4lBLC8AAtAjea8pBdHpKKAAgScIBJSAFBIAjJYKAgBLOkIKWAlMQCERYSEVGKolNUAmUKgMqZWbQgpBCD0yxrWzwtfTFvtinXN6dV8+0ROd+kH7Lb9Qvd1jfd3S7FUXt3T04ebCc2ZGQXZjfzquPY9pTqzUJ3j0/taT7l+Ge/721rfd9bBDXO6PgmQbo5kd/jdiSucSNdbxtSVoxFu75RCP5g5Jz/GFjsdNyocOjyZTiGKoUqhtz4srxwuu7nNJLOcVD+qNY3dc5uf0gQLGJOfjIym3rWGdqA1SKK2osDOwPDYueYnSIChgMDFHBqqKiYVhvDYuvA1mozRcTOajWtVp8RFOxt7UaPBMoUUyQFcxCrjQNbW1srYjEct2BR0xnTRkzUAuqJ2JeYKiY2qvaYVjVVRBGrY74MAwDGl+MV4lDVAabFahHDMAzDNFLEVsKqYlpMh4YFRARIUGGa+G2IgSn+cmRYRDUBQGwcORhETEObwfEhrxeTq+zeMwGijcQg5Q5t9YX4thxVk0lGhcwJ2XjxRyqLoP+21Jff1+KrcftInln34/rwZGv+Zd34ev2co8WddRfbzZN4ej54b5O+LROGd/LpJ4dBHrHZdH4EPjqvidkxrY9hkIXcy4fxsadYz3u8IE/xOka/JZPpuzGoEXh9G3zd/65s+A215aIAKAAelSuW6Cr/tA+ad5kQUbliya7m0z4Y3mXCrNrORiAzAUUVL0MNVWUAsAcCCyQzoMYaEoVMMN2Z1UoZlBHkpmNCzvM0zyuAzRVOJljMkUC4vKnbB/C8CAAAwgIxFgVNE0CUBSxkGCLgsYSFLQRYIiREyOcTUA6hHFCGFiEsKqRYXEg7DEAoSoRCIuJUihUGoUDFGojBiiEEAxAsWACS2JgFk0BERFwoKhSjaHGBEJICAAoAalCWRWhKxN3EhRClZSEJGJgJO72UYYQBQI0UjNFO7WmoLWthtKg6IeK4DSriGIoDq+OK49iZ9gbYqFptUTX8slh9WbF4HWQNQAoKALDaYGunYFp8elwxAImBa0kbq1WQBDXVSRMHdlY1TMTGggAODKXUaiLibLUUpgNfJmKxqCJq+GXa2Rk2vm0tVqyG+gGpeFzHDABw8eXHtLexLdRiCvYWw2JVi4knVos6bqsAAChmOrIxfCmAqNj6drZYvQRwDAAZIikg8Ky2fvnl8spCKdC2nty1P1MwnMrCytKdzJ33+JL8/2rJvLe+/ZFXr0WuL2TRyf3r9mV+0MEdNxxeaoxyyXUpc5MfETqcqBSd4SRxLX/u+3LZy/1XfvVE3wk4qH6Fcn/pbX1D2wXBupB3fBaD+n777drO/7Pb4mul4UaQP62cUfG9INhJW0aZfdt759y/YG65fdtj3RxFV80V7wLe4oXbfO1ZDi95wug6t4yHcRnl/b4FG8sQrYp1/mxaoDX+bHk6VUleZAB+pBN23LR9fLLjdEiFsYzkI52w4+btxyc7TheACmEZSX9ARo1RJiQAZTUvqbGiAMAegF0HdtCoqkFQVEpA/FUXFQKAyBBJDQL0NO44WL0Bk7s0B3YgkiIAVNZSaxH0eD7AgXJ/bj4fDqBWAAc1qAE7QBkAAJThEg6XI2B4QnA4hMPlsUJWyBAELE8o5LBCCAUaj6Eg1GgkHIEEmKIhIAJaQFMAQFEUCwEiM0HBQsKNzDk244NhbhQSgJDL1SXChOMIJaBUyIlYBQzfc6hQUslhKJpiqswREQdYKCYQAgAAACwkdIBFysVodigJUiLGEIgBAAAAAETF0h0AAAtan9Ep/CaObMMvsU6SYHuimvLmW336W19GXn9bHSuPVq+XTt4b4lyHQ6DLe+2AoyOSLwb+nKATsT66pO/GJJ+NHNvXrh7lG5Wt0uL8ZjQMAaLtqX9yUxWdze056/ZGjyPrdVUVi6jgL0MMZz8GGLaOO2Ex7QbFVBMbQ2YQQ4FAJmzUYk5zaGs1VSRRTNMfe0yeLmjMu8ani99kjBM4fo8QQOnxOokcaErcSddrOjRNDBXT90xMHBnpOCbX4worzXXBtNgOatjaWd1Uq5paIgAAtqkguP7Y25mGCgCAslqRvFWoHcdRI6/HBaDwoQAgAAw7i0VUCREUwLRaxd7JyQIAgLPAT0YDwJBwyXuiekrwl8hKjVVsIdL7LL9fxP95x7ye4iF5L/xsAiJU2NTz3iQZE31JvbnOx/G26ebngnaX7iT3f1/J6ei9TZnjS2cTmmBn9wagAB6kY2HclU/30QRTfSI4KMdCvyuj7qNhq0pE/QGiMjJLkJAoauBVFGoSABJmXxLmYYeuKAMlYH5HVpAAaM2B2esdw+58AQCHZLEkRxv4GwAhDfaITMsNOABAYT7d+K5gsM7UtwHrAAA4AADKAAAApRSEw1AwLIcHIeWwPIbLh4AwQi4ID1REKCFNKAjLUC4hEBBKTEQELEYTSkwoJuIJcJZo0KyAqVh3lJIRGdQICFCcWq0sAy6XpSylQleKE4FAKE6IuACFDyWeXr9sKCcKCHQAAAAoELeT5VlRzkoqejPR25JnAPCHCS8BAAAAACCRAEIqYW+WPOLToOaNZYdjy7jePoOYUdftjeqQSyMS0Hk2s/bbZlOV+BvimVdO+fXlmymz4jpxd9+vwdjkML85Gq7ndhI8/IEXVcy2Xcz712r8IdF+Rnsiuk6ymIqtAs11EyDINvBsTU2aMKc3HNmqnRm2YuukiSNDIBFfqMVONU1D7WUCq1Wt0yZQ9Y/MOAVUVcsQ04qIrWOGFFhAUWB6LIiCYvU/Md1UH9spVsN+FBBUXDtFQIwJe3XczsEFRwQ4ruPTMzUEALFY1d5S4xqfC4bjOHJ6DR6vtyoAgACwDkDoTO0GA7qBQqdMP0UB6NKJmVpEptpNCACt0ybKMG2tCgAAAKRQik4HNDTCnJXvLkjTidSibkDUn28MO7N59KFgeSCvuuvSj+09Z2+79jrHuukl45X6JF8lt/cSc6FGlc/Xff7l9wnxqyP9scRv6v4fJ7Pp5tDTLIDj9KxoJU3aAFDJAH6UE6Epmvhpr6z4V8pBscSRToauaOJPe2XNXykHRRKrdGGPQQAiq3kVUU0AIBFmYccwD6sxZEQKSPMjaqgQIgUIhZRqSjDP3gKW+QaArIBJ7JGwQHcw5PrwfR/9SpMyvA/AZ4G7S1JOrsnIAbC4gc3nhgMoANYAFRIAAIBFxCkxUAIxQFzIClkq5DCEUIAFj3HhiEjwxTiEsIwYB5RQREwIBrOYKAER0AAYggDA4qIUgRzIBAcEgFhAMJFXSUiSIElSSiEEoyBAQhJAADBYKcg0AQAAAAPMLEgkYZqWACgkGMRFeRnMYDARdROVFAWSMAETmiqJEUP8DjsvlS/Oq1882O7fQ/3Wjo309HuzfnAsyxRZc54hOdvt6k3TaP2Wa+v6v3rz7ZJs7r99yZMurlZfz9yErdsWXDhk60/IkH/9pbEmzPXHgrThNafe7j2RAS/1Nm9dHfvPG5v/NvPudERAMf+ZALfPE0syy8MimlnSPqeabj/V86fYanZNJexNTFsnxE5FNQGx4I+tNICm2to5tLOvkMT0F357NjaGaRXxY0UsKqL2zqajkJwqCTT4tuCp2GFr4xkDqDClBSwOVUwbbDF8bMW0MUwxxDBsTKvVDjGwtyNR1GprbyNWBzg0BdURQ8RiOC54HGcRJteDpsNGFAAAUMNqtdj745gFEDtbFKu9IfYWAADUoa1hsUyPoj5mCaqmEzPaWCzl0kK9bS7mKfONhOv70MGxjMz89eS2+z3H4oY6i3OJKN6RjNn+n/pbcLR4/ZQV1vHH/R2K+7q3/N5fzpd7FrXuMWmJgtfaofF8lu7cc92aj5nOzP35oBbblHfiLTYA4A4FAKgA3pSrtuhkHx8V/4syLUpNumqLTvYTPir+ZAqKq+wxbZsAyKiBl1TXXCQACwZ2iWVYDZEpMiSY9jnIZVpgMc3eBrkT3prDCfZOoHwyxcpr791Eyn3cdXkkFGAHOAAAlroGZi8iAQAMQCBCiwjdZTdXIyZCuRxBlCUsyxCGwxJCwSccHh8MISwDjU2AEGG5hAsmYAL2ECWUaCEsmMhiNE0pKEAwCyYhicECpkWEQhARARHzFBKAAAABU+xJEaaBACCAiJASIyIiogxCCwWUVIQp0CwUrf1GuNufINr+dr+v3fZq9uuF1NbH/chOvi/Dz17p4Of6Tncpnvg7/8vrg7vpbS7XU7ORKDsvr+94sYSpG7ieJobAPwWDpj+xiLyWNt0fHD6WJ6omtl0xX8Pr0W+ziNFvyU1Lm9VUO9PWFDWwE8OBjROmiWnnX1D/w7SG1GixNQPsEmx1UBXDxrSZUDvDKtawtbM4ZjWtVlFR00Yc+fR6zHEXz8gxc73CsDid3pL2VjsUAEARezszBUyLmQxwzHVc331Qmqaqqonam4aYFkUxHVhMMUQAFd/G8RaSAABATDUNq2na2KnF3r8iVFpmsIqJAvLikAAAAJiGODJMeydsxSpqrtcAAGZ8+OZkxYcBlB7XdQwACBVMc5p1mo/FiQFggE+eLbkXzIGNgrp8+jJc3/zOtVDvj/brOG6GkCdz/6+Drta1p0zUDz4q/1YFs/Ofu9PZ6+X2QT9i8HVVp8fdwzmUv4daX5+mc7g+Nyxrz1rLeuRd1r5v52YXP398ufb5QvYHIu9e2Sg9P/byPTVv/Ol/+8vP4Wwf2GdOMr7HQoIFAB6k8xm5W/kTX5X61Rc8MEsE6WKW7VZ+4quK/vS5IPkDmWqMDEAkkDXyMtSgkgCYLoWKzCAiJQZREUgVgOkjKpMEQKYoikMnQAPsPM3eTEgDR14IEKKqsrIqsgEcAESBW5NjdC/PJsTqYDkAgGL3BPcBANx83mBukQAAEEoJn/KpTQWU8lg+hDpXQLgclguukVIuj8OnfAGf8PgEoKzX1iwhWAgws7MFyQPE7AAPJp1qJlZIrSwVaHzwBdSzLKgV8l1ZjbK4UyICKRhAEpaZtAAAAASES569pYy7JIB7z/u3xxpMuMaAwpg8wdBltDZ/qayB88rjSZnEdoZ9H+7G4lLU2XmfT9PV9RG6hX2qPz03zo2OtPyab/ndfv+uKas8Vh/HlPxt2+fjh2PaOoP0b7P+MBv1fKv716O00sIZnKj63Xpx4htqz/oVpaqjJXKk4Qw72PDNzs2/fDz660/fyy0VubOgk2s7VWzFtMGwIZjeOlNUDasjW1vsHTg0nHZDGBQeY/HNp9dMq9WH6SzTTVoNLNbp2/V6DWeNx4XadfG4Jp6BnUXCNFVFEyt8M98ofbg+PDIft+T4ioyGYfVkZt8ivtWP4su3ipO+3V2rqBr45QeLifg2/DiL52enEb6xOmmCb748XlcARlqqks6WcNwiKpCQma22FtMwDHtVzHW9YAAAwjQnZSbTMBG1gjSAa2s3xS3TfsKRZUYb1QRIABinWUwabQBgeoBw4a3CZEqfoct8mWTphQ/c5EUFPftkMDy915fwro9NeWs63+fK9YL36yc/98urB5wn7/1kjb+SGeIRnrOaWsr7bGuYng7L+PEbANgdZGy8tutA4iTcBV5Uk4Gulin9CpiSKRRRkU3aulo5hd8CJoivmRBlFRVliQSQKnin6qoIJACWeR5QlZkpAyLCO+kAUnBIliA9b96DMzDNG86B1+31PM9zmQAAEEIyCSYQk5Ai+QLCpYQwhGsUwREpBCMUAGaYuQK+ic9SQkREPD2JdxJeHioqSqJUnYglSQmIJqVXvAiqXITQhOIyuowGCSTRaR9gR4mLgBajPUOcEIDhLadpZlrEF7hEBBRFiK0Dw8aBHaKhpmm1tTcVQ5hwIHZ2gkMcw97e1nQkOLCzGKZFrZ6t1d4HsLFYDDEstrXXp9frXSHHl2NrHGTLGtdZ47a1j5UZxoTF1s4cDHummIYYuL5LCz58uLVwXdewToqAiJQxMYz2QrXX62mXqsd3cz1l2I6TqiCGTGBnmqaKYQV7piKKUlOxtdrYjA6tYGtYsJroVIXSUZiUFAdYbbGIWgxDTKvr0+OaIzxexoeZ1Gqr/m1UQUydmMGiaZ1iNU2rOQJYHA/SrFxcl6VqfkeOIzDzuq4Xs8IZporzYHh4Pubk5OhRq+rxeBwJcytrvG5pLcfv8fgdsaxWXndxIZzCd49Tt2H24pvrGu3UVV+3VQdzXdc3tyyj8N2H3/dqddBx0mqdZpoarmXC/8StI8y7ts+1vZVyHPnw4ctTOCq9Xt+8q9KycJ0tTv07h6qtX3587fTxxNi2w7fTmV0X02fnzXfxZXqEs9Ob7dixw3X1ppt2+trpy4RtN97sZje70UBvvstOz0txz7Zsu5mz66ymuXP7Ltu3m4izxbdvm9nZUM/z2bVffjzKsPg+NdWps4HP1jRb+2lWxdnGveVuHQsiGvoYzfaEL6YS6VclBbA8vcTgRfgjfKxzywE+lCugXkOt9lsSCRUM5Sqo18hqv4FQweEIui5tYLrdoUvM86KzxxG8Y4/QdWkPXWKe52mep+7u9uZpriIBAAAtTpu4iDglIkGKZjEBaBExcXEBTQnFRFnIEBXSRExAiECMBiUqJi773hTl6ckJb+GtEKaXmp6aPCixZ3nF+hW7XpSmp6emo3zz2KPLac+Sb1N2UwzF9bHY2k2zqNo4nGF6m0kmplisFqvFxLCdzqGN1dlqaFv82PnlpO0gVhuHu3HMwZQBH9/2dvZ2vgxM/9PsbC2qrtXG1r+tjWf69+PAoYOZOjKVwfT68PpdRaK24danU9WJSf9T/E+2/zMmvEHPNKmHU1aRk7tPP930UydLtiynT1mdrRNmyKR/W0uOwWB7aorFLJn0b7XYOjVrOD2dQzt7p1o9WqwGTZ+w9T1tAjQlfFzJ5sQZMXXaXp1VLX45sLeMG8vJCeu2rYqkcKkxCoteHK/zhEPnwccyqROms+10tob4skTnKl0M9g78slGrnV92VrdXlbmu6Wxv58s50/Xx78dJe9++wqk/jhxz5FDsnPCXPzOba5j+vf6KYxqT63dra6xwHdcpyfG7hVtdNKnFcT2VyFHpuE6lHmq38Hrc4kqX66uq+/raUfor1ZWzdFj9/dvLraFR6bhFElkstVsvmlR5++Ik7PvL7XL/n57a/cqNM3m5Oq7fVUa4X3MLtzDuS73yuI51lP41r6z8Jf04FY9PB9ep+PLpw2d1Qe4rvu3wNTGWmE53bvOxjGFsKZZpFlPqMGHre6fleNiPzrZOd9psnVufTEw5NTkvnd3p22oxq9vwcd4+8XIfK258rFlfu4qtl1XbU5Nz76gmb/R1wufchvnWUydtTp/wJLZv236j1WbnugG9yZ5/an7qD9D6r9zkQfa+/z8TGQnDF1hLsDXrAB50+9j2HwiggWvQ7WPbfyCABq6EMEkiIKCYQAQkAAAEJAAAAAAAfj7JDba1LJl7/sqVYKOCfNKctPKRgXLrxy9P3jwp6i9PAGmhftebCsqlXPIBPvZdAgDA3EkZQAFHPoB8ZIB8AA==';
	SOUND_FILES.whisper.DEFAULT = '<span><object type="application/x-shockwave-flash" data="http://koc.god-like.org/power/swf/pdxminiplayer.swf" width="160" height="20"><param name="wmode" value="transparent" /><param name="movie" value="http://koc.god-like.org/power/swf/pdxminiplayer.swf" /><param name="flashvars" value="mp3=http://koc-power-tools.googlecode.com/svn/trunk/sounds/DoorBell.mp3&amp;autostart=1&amp;showtime=1&amp;volume=100" /></object></span>';
}
if (typeof SOUND_FILES.allianceattack == 'undefined'){
	SOUND_FILES.allianceattack = new Object();
	SOUND_FILES.allianceattack.MP3 = 'data:audio/mp3;base64,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DDjAkinqvrffaHptCYupuacokAazVds3epLqkh+Yl28+////////y/uv////////l21E1GqZ0gqAMaaNW8ObYO/mOFBNYbMcFLWs1RCMaaNSyNy+NQpM4RAQ1S2UMqXc6y+QaA0uOdj3w+6PNDigFGb5pSYygzjTbWVhV2tdl0y/r+w7elUNP9GbNyGn+f6XZwy/z/Q9Ls5TDLsuS/0PU2WWWf/zgsRxKlImaAPawAFlljjj+sqaVRqU0tLS481lTUuOqaVRqm7jWpqaXU2WMpjMal1ruNLS2ebq0tLjzWVNVxNyCgn4Q1UwWCoiGQ8NlQzIgiiEHIqE0aBWOAlmbl83PdPhKHEchSJhDBQLhgWJiEsdKFyh0ZEQhGg+MEYoHxMKREMh4bGCMgUXSTSTg2ZFIWEI0HxgRkArRu3/+MkSEsVOHSiNAJ//BQmmGBn//pgaqoMt/+hCaYYGf/+FA1VQY7/8FCaYYGt/9hA1VQYrVVVF//OCxIsnAY0wCEsSOaaaQNammmiqqocrVVVXTTSJTEFNRTMuOTdVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuOTdVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/84LEswAAA0gAAAAAVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy45N1VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zgsT/AAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk3VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//OCxP8AAANIAAAAAFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuOTdVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/84LE/wAAA0gAAAAAVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy45N1VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zgsT/AAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk3VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//OCxP8AAANIAAAAAFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUQUdzdWJtYXJpbmVfZGl2ZV9ob3JuAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/w==';
	SOUND_FILES.allianceattack.OGG = 'data:audio/ogg;base64,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';
	SOUND_FILES.allianceattack.DEFAULT = '<span><object type="application/x-shockwave-flash" data="http://koc.god-like.org/power/swf/pdxminiplayer.swf" width="160" height="20"><param name="wmode" value="transparent" /><param name="movie" value="http://koc.god-like.org/power/swf/pdxminiplayer.swf" /><param name="flashvars" value="mp3=http://koc-power-tools.googlecode.com/svn/trunk/sounds/AllianceAttack.mp3&amp;autostart=1&amp;showtime=1&amp;volume=100" /></object></span>';
}
if (typeof SOUND_FILES.alert == 'undefined'){
	SOUND_FILES.alert = new Object();
	SOUND_FILES.alert.OGG = 'data:audio/ogg;base64,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';
	SOUND_FILES.alert.DEFAULT = '<span><object type="application/x-shockwave-flash" data="http://koc.god-like.org/power/swf/pdxminiplayer.swf" width="160" height="20"><param name="wmode" value="transparent" /><param name="movie" value="http://koc.god-like.org/power/swf/pdxminiplayer.swf" /><param name="flashvars" value="mp3=http://sfx.god-like.info/alert.mp3&amp;autostart=1&amp;showtime=1&amp;volume=100" /></object></span>';
}
  

var DEFAULT_ALERT_SOUND_URL = 'http://koc-power-bot.googlecode.com/svn/trunk/RedAlert.mp3';
var SWF_PLAYER_URL = 'http://koc-power-bot.googlecode.com/svn/trunk/alarmplayer.swf';

var URL_CASTLE_BUT = "data:image/png;base64,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";
var URL_CASTLE_BUT_SEL = "data:image/png;base64,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";
var URL_PROVINCE_MAP = "data:image/gif;base64,R0lGODlhxgLEAvcAAP%2F%2F%2F%2Ff%2F%2F%2Fv%2F8%2Ff3%2F%2Ff39%2Ff37%2F%2F%2Fpe%2F39%2F%2F%2FnO%2F37%2F%2F%2FlPf%2FnPf%2FlPHv9%2B%2Fv7%2F%2F3lO%2Fv5ubv7%2Ff3lPf3jO%2Fm7%2B%2F3jO%2F0lPfvlObm7%2Bb3jObm5u%2FvjN7m5ubvlObvjN7e5t3whN7e3ubmjObmhNbe1tbb3t7mjN7mhNbmhNbW1t7ehM7W1tTfe9TchM7O1s7OztbWe8XOzsXOxc7We8XWesXFzsXFxc7Oe73FxcXOe8XOc73Oc7XFtb69xdHYAL29vbW9vb3Fc7bGa7XFc7W1vbW1tbXSALW9a6rCY629a6yurq3KALXFAJjCWq21Y6uza6W1Y7W9AJy1Y6Okpa29AJ%2BtY621CJytWq21AJq9AKWwG5ucnJylWpSlWo2oUoylWpytAJSUlHyrSoyUlI%2BcWoycUoyUc4SeUoStAIyMlIyMjIyUUoSMjI2gAYSUUoSUSoSEjHuUSoSEhICEe3OhAHuEhHuMSoSUAHKOQnOMSmKYNHuUAHl7fHOEQmuSAGuEQnOMAHJzc3OEAGt7Omh7Qnt8AGN7Ompralp7Omt7AGNzOlpzOltzMVJ3MmN3AF9rOmFiY2trAEp6AFJrMUpsMSx%2BG1JrGVlbWmdjACh%2FAkprCEpjMUprAEpjKUJjKUJdQkpjCFBRU0hjAEJbOkJjCEJaKUdSRTpaOkJaGTpaKUJSOjpaIUpKSjpSOkJKSjFfBUJKQgB3ADpSITFSMR9eGDFSIQhrCAhrAEBBQzFQGTFSCClSGQBrADFSADFKIRlbBAhjAClKISlKGTg8OQBjAAhdCClKCCBLGAhaAEI6AClCGQBaABtKCCFCIQhSCCFCGSlBBwhSACFCEBlCISFCCCFCAC8xMgBSABlCEAhKCCA5GSE6EANKABk6EAhCCCkxABE7CBA6ECcpKQBCCAFAAAg6CBIwEAA6CBAxCCEhKQgxCB4hIQAxCAIxAAgpCAgpABkZIQApCBkZGQApABAZGQAhCAAhABAQGRAQEAAZAAgQEAgIEAgICAAICAAACAAAACwAAAAAxgLEAgAI%2FgABCBxIsKDBgwBCHAqlhgDChxAhFglEkY8DACkWhnEYsSNBG6xeCCSwJdShFCNLnvTIUuAhOQOnUAw0x%2BELSKG2tOyoQU4oSD9GjjFZQijRnRGLXArF5iKALTPlOLSBcwrSg0qWWhVINdRWAF2%2FXjXIgU%2BoQBoEpph5SKQDn2jHQpwSqiiAH5cuKRmIV6%2FchxouqRH4YmYglA7M8onw16AaiofCCFR6KejkvJb%2FEngc6JBOAmwg6wSQtXLjggTC%2FBQJQEOgUHKcuobt9DRXnBsBEJADeStdSDZsC1RyyLBIhQw5Im%2FYmLhhlBMrXswYKrfwgQ6GyWPFj8%2F1iJf4%2Fq2DJ06DA2vwuMO8%2FsIaP8th%2BLlaVx5A%2FPn1hRMI5C%2FUQFfiyWONAxqIkw4u%2FEhmGwGs6BOKOPj0AIAc%2FLACzzAXUciKPBgKpwQ%2F1nAHiUDD7LMOhwSEQB%2BCYl314TAsYkQeLvvslcKM%2FOxlW3b0hHIPLg085Y88J%2B51iD6s3MMKR8LdiI9IL9BjzTD4BPXCPVNW%2BR0Ah%2FwzIgBsDHliUJfgwwo%2Bl1ynATz4nJjmD%2FgMYw0%2BwcEpJ52NaSBPm%2FSMqCefIxahj5z0sGYbJA6us44GDNLDyj6H6OaKo5BeZ4OUrvwzWAr40LMOPYEAMAU%2FuIizDkq28eHpOvi8R4B2%2F9x5l9123TUWyKqtBhfeeOWdlx4%2F631XRD%2BSsbJObVsSRIA1oTjQwEVK9KNTqcj%2BFQY9ewa17DCk9WPVlN2OdloIVKIpkAPpQNLAs0%2F1s9eUTP5VQjqh2tAdAeLg0m4R%2BOq7hbvCHSJOCACEIk8Eegay7kVquJpvYyURoAE9aVJogwPrsDIhPxdnLFwIXgEQCD8oHbJOCM9KLE%2BadXB8HYP6yCNSIPikoGeaNNu88ndK4KNPpABcUl7KnEZ6SM3C2aDPFgQ4cBEk9GhQNABQS40P0HL1sM8Uz16k9RRNX3SJPFLrE6ptL5gNViAh2AvT2A64HTTZwo2dVh1WFcFPEf4pA8BKOgTIvaDTL6wT6bDFrkMA4n6nU%2B1OYb8AT6jLNstutNOK83hjDQcViD6GJjtQCBxewjYAfLh8NKqnvURhUKSnuQI%2BaO38Au1Js1JEOv4BMDsul%2FCR1upzp7WjQ0TwM0YIV4PFjxrMRyr4aQ0wBkCpgZt5SWxB00OwsZvvpAEc9%2Bhk9%2FXiEHA%2Btd%2F1AONF80EC3F3AhnudGutA8mTjF1ljDYOOA4D%2F4vUXDaQrf7oZhjjkJ5JoSeZfOjrNFvYRikvkRk66yder%2FtevxoSBghYMgH0cZEHdgAtjGrPNFp6nhtxAcGMveKHFbNOAfCmBD8GZEJouoRMHPOxmW%2F4SWFrY8B6R1axzIgPdoTSXkNKdrmXBId53Uhec1ElIdASBE7Pi5IDPzYwfodOMfYo4tRJczYyR4tSXTuMQjPVOCfsYRijwgQsCQOIeRdEf62wTAmss6gX78A4g%2BfCCWsVAbd%2BRQz9gskJchIKCBAjFogpGt8bI4R%2FDSAv4%2FLYoY2kSHsbj4zqWBgAfruNBhWKc3gaDNnpMIQz7U6BDqCWnICkwSLa5xDBU5Kd18G48KZiCt0QlLeF8jhUICgS%2BuLWt8zBzgH85EjJrJU0E8aGDNeSWbdRgIlzQo44NKwIA1NCPH4yBH0AY595sUyApzWkvZQrFMJ7nAHj4RwMeY%2F8PPhTEh31UEYxURJ3LGqO00WhxjhjyYhLDeJqABhSL2LnYOP1RBD4oMRD7YKi1yIiPERWNeR7t6HcwcMpzSZQP%2FejB0fKID7vwcU7iVFqoYhBIQNYLkcJR5CXaaAOHHAKMlwAlJUMpFw38QBxL2iT4PMlJ6y1oLVUKwAsIprRDAEF5AFglDXGBi55U6VXpA4ACsyMOW4b1NFPAhxJCAI9LOIAAU6VfHaJlFWGKK0%2BsmU8fn4khcG2LgDsJgUgIgItjCVY3hQ3Bw3yozdOowR%2BhEqYS4iNOcv6AsuoU52kMeLIGgOuwnrWGijS2phQas5IOBSMUUefP1k2ylBJ97A3%2BL6rE74ShH%2BmUIkRLSbCs%2BmMKDQsO1HornPgEBYiArIMDbBfIkZaUtwKZgj9mKxJJErWA2kknANBIvzBooHk%2FeN79%2BLFGB3xAIGko59EIxj65HJZq%2BNAAJOiGwfmmRU6AvYoDYnCRQl5TA0G6WSFhIswWjaWQ9ICHPOhBjx9Isn%2Fc2iS4bBOKfpyIHmhKkUOiF17J3FazmzWeHrGHQvQ1LZ9FFbH3NGC8S9CjBBisZ%2B%2FQ6g%2FJFDIM0dpLP4MJsH5qFCnLsoZAHkQg4xmrj%2FoKwT3WyEZmDeScQVmvcbmEtL%2F4ME3n6m0R%2FLGF%2BEjojsRNGj%2FQAs3dPmUfYXDAT1%2F%2B0IPuFGgY%2BZXLlK%2BXjhCQU5y4qPOdnds7NehjCg4oUwiiBT0UNyaS%2FDiEDX6QgiBrIKD%2Be%2FRAT1MEfIijCD%2F4AQH4gI8iOGBDGvjXFlKws7%2B42AZ9TN9tpxClEa261WI%2BRE9%2BSzpIOGBUasBYV%2FXITjXIAQ5zPEQIKFQEG%2BCO2MY%2B22mUIAc58IFDSjD2IRxw2y3oKRQaMFiY%2FyLJqQ7wcz3QG0zALe7G%2FC0Fih1GA0KRDnSLA85Hs8GHWHmaEjhKA3dOgT4goQHs6Zvf7W2dPoqg2CXhQrQp8JiLeXzXxnCK3vYis5AjroEyyyVtCnqKPtK8ZnsJD15bsmPM8GH%2FYNH1Wx%2Bj9I76Rh5B4ajhH5Ypgjzk4SCHyJzmoYjzWK4tEHK1CR8wWXfM5JGZxoRXH%2Frgxz8ilVZ57AMSDmn603W%2BE1z0o1X9iFoKIMQqyTgAF51aRw7lYoN04GPBVuk3Pu6xDpGone0%2FBvIh9gEPCl4Eo6xixUVg6XRl368fKOkjPiwd%2BDkRfksO6JNuICEeB2UoZvoI1ml%2BMPOZi3PrgxctRiCED83%2F5ebygEdQQC%2F6zQ8%2Bk%2FeD%2FE6TuCcFfW5PDf9LCuYU%2BqBM4R4zFztYPkXH8F2lCP%2BIoMj3ZJXhk3zZwR%2FIyVOum0uwXHQEUIIaxm7mUgI3M9FXQwySVQIl%2FoTyBWMA9EDAL%2F7vLG7sGgDu2G89hrgjZdBKiL8SWBMDNSiBSfW%2F%2F3WAIH8l8Ks1W5AG6%2FdKe%2BReXcY6DnCA2KGAwmJ%2FTPIDalB%2BANADagBi35ECSiAbXUZcoRYG27YgRcAai%2BOAfFGBW5ICYRAGrPMBYWBto9OC1zUWKKiCAzGDrBMCMLglFKh%2Fk6EGRVcEPrglHcg6L9CCxIWCW%2BB7V6EB3qcs0jd22Ud97tWE2HF9AxGF1ZeFWriFXNiFXviFYBiGYjiGZFiGZniGaJiGariGbNiGbviGcBiHcjiHdIhFXQSGKSB5XKgG7rdbwvOFd%2FiFU9Bye9iHEPWHXvgC%2F%2FTWhfEHhnz4hY8GhoMGhjYghVsYCEoIUZiohRpgWl1oA1jmhUABhqwQg1nYiY6YcV04il%2FICh%2BYhUXAZHu4iFzIil0YAp7IhT8gi1uoBrSohQySiVhUigsyBZERPqj4hVQBhrbYhdgGiLnYi6rIhYdQdFwYCq9YfT%2BANV2YgmBYjV8IMmC4jWDojV4YjK1oikiROtagD6tnEMnohcv4hc14jepoZp%2BWit9ojVuIjV9Ijl9ojl4Ijl4ojv%2FIjVwokFyIjl5IjHkiDzk3MpbYGtGohfMoivyohc%2Fohfn4hS20j2Doj14IkF4YBmogAAIwkBlZfQY5kgi5hQq5hQzZhf8O%2BRfhBROYcxAdmYi8qIWKRor3uFs72Y3TuIWHcEVeuJFdSJJE%2BY1IyYXZBoYqVY5FqYWsgEs0GZQeoQQ1llX1UwJFEJZhOQXDIANmeZZomZZquZZsuZZb8AltGZdyOZcywEN0eZd4KQOPwAN52ZdtyQOt4JeCqZaBwAeDeZhmSQhbgJiHeQpFwJiCGQaXAJmCaQZmQJl%2BaUGYmZdKcAqbmZeS%2BZl4SRGieZetwJelKZewoJUdwZWSUW5FcAiyOZvdoA62eZu4mZu6uZu8uZvecAvu0JvCOZzD6Q7A4A3EmZzKiZtMYAzBuZzQ2ZvlwAvRWZ276Q7I4AzPaZ3cGQ%2F%2FYAAK8cCd4qkOvFAO48md2UAM23meyxkPgAAI4cme0Gmc2SCf0Tmd9gmd8UAKbRCf%2BUmc7uAM2vmfykmdBJqczSCMEXGT3VKVABAM6oAOEjqhFFqhFnqhGGqh3mALGdqhHvqh6AAM2QCiJEqiERoFxhChJbqiGVoOt8CiMIqhxeAMMVqjE%2BqdmuAONmqjt1AOO1qj2QAMPxqj7gmfQwqjInqkLOqiSrqi7qAJYBAPTVqixVAMU1qiPXqlH6oOCTouELlpk0YQCdAMKqqlHbqhZvqhSZqmHYqiZcqmFcqkcCqjNDqnFuoOYJCjdmqhWbqnFBqkfkqhRSqlgSqha1qo%2F3JaqE8KBjpaqOggoI4qoX0aqFyqoBExMu34jgUxpm%2Fqp2gaqYdaqG7qqIlaqDMaqXiqp446qYEKqI46qKA6oqT6oo66qI1aqJAaqay6p5W6IFsACbmGEJwaqZ%2FqqKEaqKOKqLTqqKdaq3l6q4G6q3vqqoUKq8Yqq8qKqlAKrX6aq6vqo4Xaq1k4rI5arIV6rH6arIFaqoHarIr6rLoKroVKrYFqreeKreu6rIFqq5HqrYUqrXMqrtVHroVqroGKrnuqrn7Krn7qrvsKr98aqfTqp%2FZ6sPi6sPrqp%2FzqqP4arfLqpwJrZgQbqAbrpwhrpwq7pwy7pw6rsRD7rx%2Frp%2F8Tu6cVa7IXq7IZu6cbi6t1GrHh2qXjSqbEyqGxGqnokLJ2urJ22rI6%2B7IeK7FC%2BqrvSaj3GqlKC6c7G6gd66cAC6chu1sj66lEe61Gi7RzerVwyrR2mqrcuqddC6cza6c1u6cnC6dom6ZZ2609C7OO%2BrUQFbZ7WrJ0e7MJm6KzarRqO6dsG69QG6lza6d1y6Z3a6Z5u6db67Yxa6d%2Bi0WAa6eCC7mEi7KGm62RmrhY67Rcm7l2Grdz%2BrhzGrlpOrlaWrl2erl2%2BrZpurmi07lz%2BrmvG7pzarZ2m7Msu7cuq6p866isC6euC6ewa6aye6W0O6e2O6e4a6a6myy8C6f%2Fvuu8wAunwiu5xLu0xtu0yPu0yhu11Tq1RXu4tbqt%2FVq%2BmNu3QDuwQluuY1u1kRq%2BsTu%2Bc2q6bLq4Pjuv6luv7Eu27quo8Mux8nu7quu19Suy91uw%2BWuxZTu6%2BYq4DXy655u6jSu1RorApKvAjBq%2FRnu9Wpq9W7K9bNq9bPq8Zsq%2F0Ou%2FabvBAYy685u%2BjnvA%2BjvC%2B7rAPHvCD8ymKvwdLJymLpymMKylMqyl0XulAIy3OOzAH7y%2BIdzDGfy%2BJczAQky%2FlnoaR2ymSWymS3ylTXylTzylUUy5U2y9Q8ymy8umzfvC39u%2F2rrFQcy44RoMCaCFYaylY6ylZTylZzyl%2F2ncpGs8u20MpyispXGcpnOsxHU8w3fctrVrw2zayFOqDnzsxxNMshVssxfcqUlLw2yayNK7yJn8xmn6yGYayWQ8yU5sypQLxFqLyWmqyU3KyV%2FcGH98pYF8pYPcpIXcpIespKg8pQKcvAS8w1dswQn8w3h8y138s738F788pcE8pcOspMWspMd8pMncpMuMvs0MwlQLzT6ssbast9VMqREMtp8stkbbzUf6zUcazkM6zkpazh6sw%2Bjcvuuss%2B1subhsprqspEV8HdncpNvcpPY8pPg8pPr8o%2Fx8pP6cw%2BdsxeksytHMztPsznoMz9csFw2tpA%2BtpBH9oxP9oxW9o%2F8XPaQZTcUAzdECncUkbMnUe9BamtBHutDCcdJHmtJHutI72tI7%2BtI2GtM%2FOtNuXMUG%2FMwePdBrW9CX%2FM4gG89%2FO8%2BBG8qDO8of3bA8rcyqnMusbKaurKWwLMiyjMa0PLtWvdNYzatazblc7bleDbpgTdXki6pljdBn7cgFTLE8rM44Lc06DafVy8iBvcnBUNJjIdRDStRDatQ2itQ2qtQ1ytQ76tSMDdWELdVfHdZVHdIGPdeaW9e7e9e9m9e%2Fu9eH3a5jTc5%2F3dONPaVpfaVrLcxtbchvLb1xrdiz3aQ%2BPaRAbRuS%2FaOU%2FaOWXaOYXaOaHaOcbaOevcqgTbOFPdX%2FsU3Qpn3VI53VkH0Vyb2jy72jzR2jzx2j0Q2j012j1W3W1y232T3afI21wc2mi23d1uzJpIzX9dzbhIzBGKvBft3BGt2qg43doq3XpK24952m%2BQ3f%2Bx20%2Fd3a%2Fw3bA166w43RtX2lxT2kuT2lu83NAA7Ov63MD26mEQ7YXszfQ3vh%2ByvgOEvgzmrgNL3RUd3R9L3dpZ3Y%2BL3hR%2FrhO8rJfUzhL37TyCrjpUzj72rjT13TOY7kM67FPg7hQD6kQm6jxw3GrM29ru29GD7lzHrlnd3hU5rlNhriTTriEF3i%2BXzi5JziWrritt3iRo6%2FMO6o6Q2j682i7R2j783iUB7a%2FzrO4PUdwHJ%2BpXTu4bet0J0MZAQQ6QTBKA8x3jZa3jZ63jC650sK54hM5tRt5sTd6Eqq5krK5irt5hTt6Rid6FO66GdO6sat2g8BY%2F4jDlYBMgJigWLa5S385XQc5kuu4QVe5YKO44Qu5cOe0yb83XR9zR%2FiSK4AT%2FjABtaQDqZo6TWK6TWq6SzK6Sva5yv65zAa6HU%2B6Ape6K%2Fd4Pbd3XLt7Kl9zXJAD40mEEAkWQdBAL6OxMAuycJ%2BtqwuzqDu3qKupGgOpAku3wu%2B7oeOt67epLA%2B6nbeEmUiDuJwTWnjHeE1GGHjNAQCoeUQ8iI%2F8iRf8iZ%2F8iSPDtnAoSjf8v8u7%2FLoYAsj%2BvI0X%2FMi35zqYPM67%2FI9uvM%2BX%2FLoUKXo8PNEH%2FLqkKc5X%2FREfwveoPQ%2Fr%2FIs7%2FQ7zw7vyQ5Sv%2FMxP%2FNXb%2FO%2FufU6rw5QmvRe%2F%2FJBb6VjX%2FM9f%2FYuv%2BW6IU9hAAnE4l%2FOMweiwgp2f%2Fe2wAu3sPd83%2Fd%2B%2F%2FeAH%2Fh%2FHwuxIPiGf%2FiIfwuEn%2FiMz%2Fh6bwSZoPeNP%2FmCzwuFT%2FmYD%2FiLn%2Fmcv%2Fe8kAWSIPmdn%2FmbP%2FqYX%2FqmP%2Fm8QAd0IPqp3%2Fio%2F%2FqJH%2Fuyf%2Fi8IAlZ4Pq1f%2Fi0v%2FuCHwu67%2FuAzwuVUOSQU0oZUwP6oPH1E%2BnOLzEQKrH9HstGi%2FPsnrb%2BVtq3SK%2Br3hDfc0r1gMAOyt67Af%2BjYA8GFY79kQoOBw%2BjvLwTDRBtGeSKikdXB6HtMcrtMertKwruJQoQ5W6hI1jQ4EGECRUmLOZs4UOIEd2B0eQu4kWMBW%2BVy9gRYjZgHkUmjAcIULyRKQsCy6ZSpUCXKd1pAmMxpkhnDm%2BK3Lizo7pmDgAMJVrUKAAH4tL9UMNPDQBc64qEkhfiKIAEzdT57OjNFteOLMFmjGJs61iIMNFGbLgW4sSKbh%2F2lKsQZF2FJU%2FiTSiW70G1fwvOrCnYYE7DBukaBir06mMARcThuwepAYAa1vTJC%2FM469nEXhOvbDkaXVnQggMnbjv%2BGq7NxIsN3x2tF%2BVov4lXCyYM2zBi07L%2FNoYM2YGNFEWPW%2FWs1bRo07kTox69W3DrxK%2BDcxxNO7Ht6KV1D3RN07dg4KOF8yVe3P17op%2Bffw1v%2BrTZ6uRHYzesXT33xLwzDDzcxDPMOr56My292AAUrD34ImwuNcGgK9A%2B6sazjz%2FeKDrvr%2FX4ElAwAhOTTjX9%2BjNvQZ3%2BGw1CCWOMz7nRLDTRQMMyPDBFwzj8y78GTRvxrxINO%2FEvBPFScDQGDQuxLhhljFG%2BGum70DQdUdywxf483E7IkGoz6bYbTUuyriUTa1KwJ%2BWKUsoIqQzNyjKxxE9D03xM0EsXuwvzuzH%2F68vPtDR%2F49JJB4cLCk4p5TTMRiNxFCxLl9RxJx5M4%2FmQoDPr0vOgS%2BM5K1QKMwISUTBNKxIjUlM6kq9O3SoUvUPZTJS9RRmdksY57XuVL0plEiaPKq64goxN1Ck1Vrc%2BLUgdO6qoohR3uumiWGFKvejUtTKFrc2EtF2oVYOGfNatVSPqpgxsxYXo17qYRWvWkdTJVFN3CVozIXJvEq7fsd7UtThHb1L2YIQRRscbYtzJN9yY4D1I4ZuCFckdQ0RAYGOOg1jlPHnRcpYgdWYwwIA%2F4nlGAgMQkOVhhbgdqxs3yCBjkbPANcjSbjJSxxCbJ0nNXHTcCSecbgP1uZsN%2Flr2BOa%2BJIWVxx9XVMnSWuKwmYw%2BglF2oX13ppmMM7CBOiLZfra5lLM9EnjgCblyp48cgrD77rtzICOcJGgIIluMlK0lYqkRcmeTHHK4YieLO3LnD44RkCDyE55JLeSxRkZHnRw2JkTlDRBQoJa2DZJZ7k02NkCEbrbSmWSagzCH1SNOLoNMdIZU1pAZAB8r3YfU6UZjBNgeyS%2Bo81X%2BLOu%2BXqh0fq2uFx03Jo%2Fcgi7CETfsZ6WxoOVUoFco7RxOTnmtt%2BE%2BqmCX4rmi5cgjNyCHcDzY2JNNEVInmCNmIHxbQ5xsBuJDSOMClwrriaBrmzgCx64AG3WwgxfuoGBq%2Fi7lMAo6zF6islQGSYYpCGIKNBS8hk4ueMFndQ4Bn3tG6EZHwNP5xB1ViNwiLPI6ddSiBQZogamcsDE34G5EwmugBHwHFuA9b3gbM97OPPisJwLDGyhpnahMV0EK9sxhOxNVFVNjL%2BF1g4KBuVQ4uhGOCnJReJYiYNGkNxIacsx6CDBAFfLHPZJhw34ICN9OyGc%2B3HElfeorCvtUEo8uiE4BCuCYAhjAyCCEo2kIwF9E1LGJ7%2FnPJRIbjCE2NsCK3UkmUNiYCGoxDzYGoWUt6FnRuoEIMTzBDZvQHkHCsYg%2FEEIYf4DCH7CxiT%2F48hmEgEIZNrG5ZwRzESTzRDCb%2FohLPdDCYZuwwxN6SYnNbU6FLHQh6UYSQ4O1MHJBcB2ALAVC0MxjEp%2Bk4BU1tUWCuOOHCAgiydxBjmWksWjC2JgFnmFFJCotcEssngUXkYQncAFpm%2FPEE56QPXQQgxZu0IEJgtAFWdhEHWdwaCkmkYQT5MANrSPZM8gQhBMEIQ7P0KgwTnqCExwhDtjgRTw3UYUZnKAFUEBELZFJ0Zi6wXLffGNH4pEHjt1gEbX4wwk4RgkIXvAa1wAVFjGlx42lQlP4mhgFuQpFDaqDF%2B2A58%2B60IWnQRGdlcoVIQnGq3DWQq6TsF4f5FoLYZgDEXowhOU26DAOAnQei%2Fgkpuxp%2F5OvHrZolloGOaK6FX1i7JNtNIgBLSlOes5jMKWYpTBItokWxG8GtXCYMBjQshmobhNJaBkZRAA%2FBNhRGAowgBGVpUoDkDOHdGQALcyRhPgh4Aja45znQCc6b16MT2iJRx82xkjJka4nypJFH6T1B09sTh2pSCQCTGCItG5lE8SapU%2FlCUSUqAMbk%2FBCE8qwiFw4LBh5YIDk%2BrAIswV0L0sjXhPj6QmOUQsd8ajCyZJAQT3sUY5u2ErJWqYC2nJMB0hzxyqcGjkTpMJhviAebFlQid0tgI6whUKDa6GC%2BKkguY4r6kAvPIRwiGoetbDAxrpgE3c8YxFkqEI0tyi8Rf4YYhPPsAOypLHHVKTCDV1YBElJFo5JxKELhhCGRmthCEPU4pZN%2BMIkfOqJRSzCd%2B4QBiKuZYhg5O8ig3QrVuBqMGXFIxjWmwQqlRWOOHihDFUWxlkJgY0%2BJEFvGf3ZEDbmgS64QXvhIAROZ8CFPEjjLOoIhyGgMIM9K6IJXRDa5roR6BlUgRC1lCwCQBkTy0JEHbmw3iZ808EGI5BjClYBn2tMOXTMs5S35qM7grAxQ6hsjx6QRjwIsbEdcKPAhw7dxmxY3BUe94XfXC5aUouAMlz7dhuhdBUmd7KNQSHGUICtAY7gsFoYOnIt0HDR5hnEHIaWjoc2xDz6ANusUv%2BWJAJdM0H9SzIdbOx2wrvwJOIhawRsIAgKDja0E34EeSPAhuFQoQeOAINPxjiOOciDa%2BmIhHhgQ2PY6wMp6TgJo11bBUe48Ax8aqoWb4uwTISNO%2FLQ2Qb%2FgXgbk0AXtFsLOopA3h4QhsYUcO2NtUDAOUR6wvuwFQKfLAgB59hwlVU%2BlN0mDwpGgAXi0EY2u9WQBquF9WwIu0l64uB0bAHWN7aBUsyDtRwzwAbMqELYtsCv3fi16jzwWgMMXBjyBncOLFfqU7sk1Q85XD%2BPqL%2B%2BV0AP3VhEjesYD2HcWgKE6EMe5M7zRYRDFnu0gz0gF1t7pI5jm%2Fg8AvRwDShYQAL%2BhjhaA2Mrqm1Ke8WOq7bcAIwABtSiDBs7QTd4UY7HtUwCiWOkAbpgD3LT%2FQjxkEbEeW1KS707Ht1AseQqYD27%2FwHffNQ3QpKoEOH1l0LGTjoa14mAFqARuKau8jPmH39oe0AW83iGCTZW%2BpkzJXtABxrYGJTru6%2Bzh1Q4gjNoBHdIBeILH3twgypwg1qIh5lTgWewh2e4NlfzCHq5iOYiPif7oC1yh2PjOV6rAsGZIzq6gm5QMAVoNvgzm26QNwagwTy4lDjqpzkiBIehupR5HI6xAF5DuXppqza7irGLiRwyO40iKLWDQI5pAaQLgnmoAhHjuR56H8mZgRloPjv%2FEJW5g7%2BmKwP%2BG7ocCJ06uhRPMrXyuw%2FKKjULeLydKbuNQQRiUId5SEEPwIZnuDU0xKD5mz57mScumIfMQ4ATQIfu2pg4QAeN2QBacIhuWAV0eIZN6LsqwD3jEqdpU664YK4r2JggcAdZMDtiQD6TKz17IAQLwLQcGj5GnAStKkXJibRJ2KMhOEQgUkARkAAVoAVbGD3JWYVkmpzNm4QS3InzCxd%2FoxB1EIZmKwV7iKMu4L9mWwSUcAdfsB5qUSEo0Cx3sL08uEZTrIVSkAVcPAN7sD1GTII%2F8IV22MNFTLoq6Ct7sJc4cgJZKIVaiCMyCCSJiDmJoEVyeh5q%2FKRU%2F3gGXEQAg8NDBFCBReACT4jBpEuFbiAE6zlHN9gYFdDIPmCk4iMwjiGDZ6gEFgg3URHC7SOeKhAGYWAtA9AkkQg7QmrCSpHIs%2FM04plCjjmDzemuHBAe54I%2FmVQHN5iBDViEebCH7kqCGbMeO7CUPtjCMrAHpGJEYZgHY5SAU3rDxFOJxXseifxAg0Ajh6HCDaCpzVnE0QlEYMOx%2BauneOACG%2FPEBUiFgPOAGjsC1TuCEnrALsgBXrs9aOMm5IKh3tsJ9SIeQrCHeOi7IDg%2BdzC5DTiCPEiFKrMIdWKnaiGeOEClz4yuedA%2BdMCGYPAFb6iERSCeRbAHYZgcfyLIm%2F94Rv2JRsMxuTJAB6eSAK2iwjo8C%2B7bmJRRoTEsGiHYmHPsu%2BBCgCCIB0yKHwnYARBTBzIIrg0gg24wyec0ACiwTcYzyLeYv1Mcl9MTAWHQFG7YgY1xgnjAQwlgPYfBKgSoN3t5go05N6qrJ3TwQHScyM0hhjNgSXUQQnv4PdahoGCogjw4piR0jCVkwjfziSd0tij8ybVLOEmLhzcUAWwYrMmCrBzrhlTog2tLAnughFIiLnSQt6ycvyt4hlqwv43pA3sQyzgsS%2FSbzRslE3eYhBbogk5Qh1U4NLdUB1Cs0VszBLpErwHDxS7QlI%2BMLfupAlI6gVacKjv4Nvjrvk7%2FTEzdY8xRBItSk4A8MISD4rlKQL6Z4xgGaAFFs5SZ6yElrbFpIzgDtAftU5ZJqIIWYBmOMbhv7Do7dEZ%2BsyTdBJX3m4H3K8oKY6Th9LTu%2BxwVclLlZE576DsPUAGYaoEWUIESc4da4IKd%2ByTtmoQhoEE6coMA3QBPPQEVUAETKAM1ixnyfIh4sAOQbMY4s5c42JgkuI1r0IPJwkN%2FajD7XAXIOsoJuzARmNUW2MYABSVi8AIDRdCtVIFaspd2itAJjRu0uFCJy9D72dA%2FVJZVUMb1nDmbRIdFQKl5E1Z7CFZGJLV3e4e%2BW6RFUh0uyNHJCiV9O9CNoQExOpjaWR3R%2F%2BO5Vagpd%2FAEdpVLBECEJ6UnlHCfvDTSydkARsIynpMcWbgGWqixBbBAdaDFMM29JSXTW00Jgn3OjWkCdigaQug%2B6RuwOkWmbmowdOg%2BSuBT9OqGBjqZ5bs1QqXNQ73NRFU1glqFecigNAqH0JIAjEOAPnAYgiIEVIoHT9hCDbtUi3CH5USAc8TFJKA0dEiFGkWaZxCGTsAGT4gDFSqeTFTHZ5iEMpC3GcBYBCixo5GrM7qYXF2IeDg92xqMMgiCPlhPez0wgijWY0VaZUUyyHrDZ4VZbAtQJ7CIa81W47SHAp3Ibn0nl1XCcJ2ROAwXnjRXSkJXs1k1pMVAVN0cWv9EAIujOhWt0hOopXjQT3pSB3mTgA0YXg%2Fwy6zUUYF1CRTsGGEIB2yo3U4kKCSwhWrpuwFaRLAclbq8WCm9DaQLvlqor4JFB8i13W6QTNtL2U%2FcWWorUwtFOJg9AbO5FGHgrByYI9bL2TvdGEpIr4VEgE0AWnrK0ZYRAT0AsWs7WkNN3YPAzYkhqAedBAmW4FIYMHt9O8Bxh%2Fk7gVLohlpQIRjQHrDNVLK1h5mzALXrhhmwABXoqxOYnEmwB3ugsY1hKtkzgQ20h6OcAXeYuQ3Yv2dQAQtogT9oWcMZXPSTSHgrmmewnzqq1xFFB24Qg43JAVKV3M2xzw%2BMhyqVne7%2Fi4NU8ARP2IRS4EzvHMiIwta%2BbcnPfT%2FWUZZnKANC6ISFchvTPV03Y%2BCJWV3Y0VAqTNcLrUPZhcMcqzEJ%2BIPz5VUEUNH32wCWqhb%2Fy9z5K4NweAZsqIVgeAYxQl5UEyWXNbmuawEFE4HDu2AWkFcDxDxDTi4NhlK%2BnVIL5hj%2FCYcLQ4A4iIdrqIQH2M9F8F3EVFn2FUUjBsHu8oAyOOZj7sEmg4IcEAFPyIcZIx5EMOGk%2B5priyRRwUUQjYd3C1AyaIdlCIY9ikhlVAZ1mB39Ek%2F0I6jnHCByFS6NQjgJ8ADrsQBXgzZMFVvmRIlrk4AgCF7Smj8LCAKQQlUaZkS7%2F2m2MQyHa1O47tuA3dsWJEY%2FeIyDnhEGdZO40ty8S1mFDBC4qYQ%2Fc5hcYeVDbIBRe5i%2FcbQHvhuCPcvCjUHjzl3jl%2F2DeVhXYJuHeRC%2FhGvGwLnj09XJq%2BFjnzzXP35dZF3PN2SlZygF2gyGfbS9Yf3fI3gG%2FuGYrKzSGTjfZ2gBEQiCVJgHTlY8T54eUI4cERCwzcFL1eG5r5vGCGPlhL2dASswA7iC9JIF1cHrGYIf0sqJ2lGduqMj%2F3GwrFuZlnmZ9h1m%2FrIxycwU4DXF%2F3ywNC0Ddh1kf04CdEhBU0sCpLMDCurm7jJgPYg4g7tHHdCBiI4JBxYbVpUfUFIHeP%2FsyaJBBK5DABEwuM0xGQMAwqLBrTHcLsIr4GfDhr4DN0YEsR7eI%2BROAuIKBsLrJyQEwYkOl2CIZNxmyqq7MxVSgCA4gj0i5StGgKLMIwUTqe5jgLB%2BUyjoA%2FdMuGeAaQSQaTUOz5pGib6zgCM4AuuxI3DF40KqUMck6vQzaiRtQUOVTo4xgRkIhluT07k9sHgoA%2FjZABdEw2BoNlGVN0f20IDt5DjcikUYgllVAUyrsmdRB0pIAhSY1SeoJHWQBiytgqHanJKDgrNDQSiAAkwVni7Y8WQ5nB3vTXRoiG6oAmklg1r4cRpXyh3Hn27gAiiISZY10wDaGLQkiHg4A7%2F%2FroUOm9cyUJZ7rDsxql3YqoJ4okkMp0Hla1VRKUCO6SOuaO20XARCwDI8xzJCmASCmAdafGODkKgbhwI3QHGCmARCIASv2ZxNSHRvMsodLyZDFx5DwNId%2F7OaYuI8iPQqWKZJS6ZIt0DGBpXq5pdaqOXIMbwGG7zgsgCU262anDTvkRwPwLeqXGu64zmUiwdycz6UIIYuOBn7xrqUmcaIk%2BUat2MJBfA8Rh%2Bgo6OeFJ60WzsDsABJg3UEqDKRU50N6IbQPRkeCrrWCQeTOxkd6LvbcQdE6ADB7jobwpiTaYEdLWuVcJijobBScRhbOBp4iidNmRgRepaAH4yB%2FyuC%2F2iIOwsHc8Cgfy%2Bagb%2BgNgKnbwq0JPC5iRGGJxCCJHBKYaiCExABkD%2BCTtucRfBqEbC6S3oCEwD5IMCZBsuDJNh4CvKEGQD5GciDj0oCBtuuZhaB3tHjAVtaiYBaorcI4bm2GzsIKQqVxCoafXL6fj%2BntVIrbwkMqQehrvKWiC91fnmGM%2FDqERABjitB4bGDmhcBFJAC0kImJ0iCMIedKqj4VUgCmzeESUOHPOj5k%2F9AdfiDmPdtXjCEmH86pYz5ZNknLlABkB%2FSZFd2Zkdd9CGyOIiDFTMHPBADO8iWZ5j8PkAa9bKDOMiD1tmuJ7CbLrCcPLCbI%2FiDZJr8Z0AHMf8arzgwBHSII98m1cQ1%2FbXPocmn%2FeQVJOdRiHLgheC%2FDp0ofjRpTCd8oq7iBXZosGrpBum3FNMxo1aKpzBqnVfTp63oBmagXlgjGdg%2FI6AP%2Bv2SoZOyWbUmDTOhmgTh%2BnAxGunXImm0COkvhmvwjaePpwoKIzQCCHQCBbpD1%2B2guoICE7pTJ%2FAWQ4foIg5MGO5guIYDN3LsWLGZAwAiR5IsafIkSgAJmkn06PKlx3gyWwokRyyeQ3UyFQqUGa9iw4QOg7pr6G7msxY5jniyZ69bCwQINikUqk5oxZ0wt26MYowm17Bcy90Sa1ZsMWdn1750B0YTT7ZyH5bbePWqx7v%2BHfWGVZcN2Eu8c2HGAwTo5%2BCO7oIYkIqgClh0wLIlnku2slx3msDETcw3MDpnatcKzlva5a26fT%2FPVQcyJezYJ1dGxszVmy3bLtV189B4gxs7M6RuEFZbt0uvx5F3vMwc7ejnW93Clc41tfWtf7MTNoxYtzs3M2bkyBMu8mTuL52rV7y5c3uBouN7xE7%2FY0jZ%2BmPTvr8Rt3ru9OGYAY1JhQd88Snnn0DsMZgWgwS9lWB79jG4XYSFHfZcSxp1lF6EDt6nGWcRhhYdgxbe51p%2B%2B7loUn8RAqieOps8cQKOJxyhhzcmorMggyLeB2GE1FGonor3Ycight%2F5B2KQZRX%2B%2BZ6J85mYZHwsvrglSTEyOGOA7hx0kDvEUGYikP4JSR%2BRDBp5pWoXApahdyZCqaaUblIZoZURYtmellxy6aV%2FYAKq153%2BpXnfmvG16d%2Bbfsbp35L%2BNWnnmVGaSOKR3PWZ4qT0BSroi4TeZ%2BiTmTK4KH2NtvfoiBPCaWKl910aYaKt5gnpngx%2B6t%2BfNL5GaqksmYjqfbnSx2p8rqoHK32RgkrrnEzWiauqjO46Yq%2F%2B%2FXpfsNyNSqx%2BptKHLH3KKvhViNsOiWKs1UlKrYm3Mqiues5mx2mV8IIbapbDkluusTLmhqmPzLanb3bQxictsADHVyt99qZqIsPS8cunv%2FT%2BhZvduCgVEUoIIhEQRih8aGAyyiqjZG586MaHr3oK5%2Bsumx23B%2FG%2F9NK5IbYY47xzt%2Fd967HEwraIkg3p4JOCSHXwg8s9rhAAAB9T48PK1TAW%2FOXBQaPJrqYmOryzrPNGSHF8Fiebra6bFk3f0fF9bF3IJalBDz3yQO3AOqwAoAY%2FPwAuuByFz%2FZ1oWHfC%2FeyZOPp49kBpj3t2tVaeu3jQstdIsc%2B3i1d3iSFIschTwPwwj6BAABEP2GksA8fABTBTxgnBdBMp9l5o%2FmTPY7du3QZS1e35aAQL93o0rHdntvpQr7w0AGCArqvOle4qcAnhcSH6j%2FwIwcANoxvPvn%2B4pP%2Fwhbttx8GLaLJPz%2F99dt%2F%2F%2F3FxII%2F%2F%2F3770ws0vK%2FARKQCb8gIAL9t78EMtB%2BtrBFAyMov2xkQRLZkKAEA4jBCOpvgw3MBh3ocEEPJlCDJERgB09IwGxIIgsjVOH%2FHghDAi5whv6jRQJkAz6oqQ8APeAHHNAHgB7%2BQA5GNCIfioGMYjCxiU58IhSjKEUoAiOAU7wiFrMYC2BksYtedKIRMvHFMWqRjGaU4i1uccY1NtEZFVwGG9loxTie0RZzpOMYnRFCZ%2BDRjLGwRR%2F9GMgxLqOFfBykF9OIyC%2FecZFTRAYOdai6F%2BjDdUXoxxZSUEnbYRIlvDsW8JIlvAj%2BeWV5z6meepDHHbcob1aZqxfngue5Il3PlMxRJXdQua%2FuoWSHAHCAOIbhgEDw4wUECOYw9%2FGCxS2HOzJrD824YzPuGO85lVvl5SLmM2sBrXPt%2BpwtkYPL7DSPOaUrSSD6ATUAhAEf69gHJEQSBn28M57MPJbjLja2Zlqnmsy55r6y2bNX%2FsxJb5ulnrDnLe0hKWni4uVJXjCFFv2gDlPo2hDncNGXMe5U%2BTzoPr9pNoYGVF6YkxMsu6nPsiU0nLoZp3XKiZxzDsxr%2FLTOM9UTzexMMzv%2BRA5ArcMzpG1zcyoFKUt5pVCjkZScDgUZRGt6T4P5aKfW6Wk%2Fddmwpmr%2FTKBEJSg3DSo9hCrVpbaBKfOeireoSrUkMGtPTrljVelgtXhatU5Qu2pSbYLVqGKd2fRuBs5%2BiU6tpGNrW0fyVvXENTtzfU5dn%2FNT3eT1OUO1m2GdF8q2xRKpk5vSUunG1bRGiKaJVUlHz%2FXRsYY0qf6pLHMuW6HMPud56okeYMnKrdDGB62npO1MEXvaxTpztblt7WcjBFvkyLahRbVVZ1nr2mjNrbej%2FW1phZtY4vrOuNAMbM0kpy3KXZe5XsXscysW3eNO92HVbY9vmSNT3Zh2u6mNmXd1Cl5pijduI93UeWebXs4eVbrJLSthXemf%2BraVuzjNr1z3y9P%2BNuuu%2FtJZLngC7Ny%2BQrfA7D3wbs2KmfgiZ762YbBUHSydxlrnscyJLHMmaxsM26a5uQQucmzLHdx%2BV7fU5S18y1tiHJ9Yuw2%2BL1wh7FgJX5XC1CMvgPc6UJQWFGEibWmC1bZgI6cYyYxVcouZTFcnC%2Fa%2FRdLwjQcMvfX2%2BMoIDp2CV8Tlmqr4OSyWjouRA2PkyBgzNMaMjZ2q5tuyWb8%2Bdi%2BQUylk3ZgYMyims5eLW1UxQ5bM1LSwNRcNaDQLmsPq9XCb20u0RHtK05hpdGUePbA6M%2BfOz8mzbvasmz5X5s%2BVCXRMiWwbHWeHx4Z2c4izfFI5L%2B20bo10dyedMEv7FNP%2F%2FjR1YnBNWk8T%2BK%2BhBvGPRVwZEjNa16me86qR%2FWBlI3e8ZnYTp3M96B0XOsKHHrW2E8Nt26DaM%2BAmF6uR42rmwNo2srYNrRNj62ine9pUDquVRR2g9yq6sNkttrEVK%2B4VgxnPlH4xs7MK5TNL%2BasH92vCsY3oeA9m3qf2tr0hHnHU3pTi5CZlxu26cXR3HL3UXjOof63wVTK81A5nkKrxPXE7V%2FzVF9dzzCXrbKBCezDSxu7NCZ1zdwM728Lm65ZVHvF862bfyOk3Zv6NmYAPZuBOLzjUP95ha%2Btc5PC%2B%2BpSJvXKb4vPlq0p6jJdO2abP5enyRXlieG0dX1N95%2Fvq%2Fnl2TF6Zeg8m6MTium28rhuwV0bslSH7XMzed7T%2Ffd29bveS371wUiee73NhfGvu%2Ffiht7ro%2FD56rPHOZ73P2PRs8fuQPT940IdZ9DwnvXUUnxjUy8XxpII8ZiRvG8onxvKJwbxcNJ8Zzuc%2B6uyeeuirPnK4e1zuc%2B8S6%2FXt%2Bq%2FD3t%2BynzXt%2FWz7teC%2B27qXDuGzb3ihIj74618L8dlifEEhvzLKxwzzDYbzDQb0sYX03R71uZ%2F1fR729Z72vR2caZn3fZ9I9F9i%2FF9lBOBcDKBlpF%2Bt3Z9ZtB%2B9Ad5gCB788Z7F%2Bd7hAd%2FxgKBZ5B9pqN7xhV%2FXjd%2FklV%2FYnR%2FA%2F3mgwLlgWIjgyb3fc8SfA86fxtRfC%2F5c1lGgxLUc0dmdoujg2PFg2fkgVwDh4pHgXJjgEKKg0akg%2FbHgcwjfYMDgWezfoNBg5Nng8uFg5Unh5VFh5lnhdCTgCAohcxBhCj7g6JHcXJDh6Wmh%2Fskg%2F6lh8rEhALph88Hh88lh9NEhTGDh8AkiW3BhHnrh64HhEYrhLUEiTJihWaDhlljgYGBgYmigXHCgXBTgWhwg%2B9lhEC7g7jXgHhqhZSHhGHriS4CiWIhisThh60HhfagiW7DiWbjiWUhiGVLiWlgicujhF%2FLh7%2FmhXACiXPBiXxgZAYQARhGANzZA12yj1rFc3f%2BFXBQCI%2FrNHKTAYhbi4TNiIvlp4i1yojjpImowYygaGR%2F4jUjYgDWIgziswxQAQArgAj2IgxJwFDrWoDBGzkJOoTrGCzWyBTaGhTPqBjRmojSu4ESuhTVSJD72onA5AB%2FoAz2s0xbwQyhAQij8AACEgjyEwTCsw8rQHVWZ4zAyIgE6ogHao2Kw4yS6I0bC4w3KY2zhYicq4QSeBExaw0mKxCGsQwg0gEiEwD3E0xT0Q0KaBAGwxF18JViGpViOJVl6AzGQJVqmpVqqAzF4w1q%2BJVyqg3LEJV2OZTnwQl3mZViKhl72pU6AASjghF%2FmJS%2BUw2DmZTac5WHSZZMsJl3%2FmoljxuVdRiZcxsP1CCZlqiVfZuZaFiZnqqVwqcEL%2BBIA4AI%2BpMM68AEBmE8dDBE%2FqAEAEIAGzOZshkAtUANu5qZu7iZv9qZv9uYvZMJvDidxFic1ZMIvGKdyLic1MIEuMCd0%2FiYzCGd0Vudu%2FkJyWqd2doMVOIJ2fmcmMMN3Wucv2MJ4Vmc33MEddMN5RqctZGd7Lud0xid0OoIVsCd9Kid25udyhid%2FGmctjONI%2BFIDsAIrTAEkYJIQic8cAMAUGCiEhoIVMAGFVqiFXiiGZqiGaqgRbKiHfiiIMkGHhiiJligT%2BICJpuiHjqiKtqiFGgGLumiLRoEP%2BEAUyKiM%2F8Yojqqoju4oidKojfoojwppi%2FYokXookN7okZIojC5piRqpk2poAUjSOo2EBshDKCwoP7CB9wSDj2QDIlaGLSjiYDCBMZgIOPBkKxaDiajDWzzkqYEDrYRp4xkGnIopmcpFmrbpZtypwLHplchphOij6jjAFtjAL8EDyeDDIThoPwykTX7JZn2YqPyITloGL%2FjIR55FPABmR55FYQqlbWRkPIZIpoIW2%2FmciYQq0BlZIOgD1GgAPIhDERDTFpSmQOKCPJRMpDZOQ66Ln3ZgREYLUC6jqGIGqRblRobhp5rFpp5FRW4Fg8nBOqxTEVgDPsiDaq7OMLgTpPaqR%2F1qe%2F8Q41oYo1kgYwgWayAea2UkaxsaJXMhZT0qpaho49I4QArUpMnka0qQ4lyY4mCgIluQ61mYK3REWbOKRbRqx6RKXarKn9v1IffZ3BIyITnepNjAXLCuopoeo09yhDKuqyyeIC1Goy0eJT2%2B1MdyxMIGBiGm4cbKBcDOhcCuBcGahcGGBbqKRcheY0iKxUWOKlG%2B67JuYsKGxbO%2B4M9yhS%2B6iL%2FKLJ0GbJ6m4qVy7LA%2BjLr6LLsmhrsmIryCh7yqLL0GjIDaV8yyxczKRc2exc2KRc5yxc7%2BYNaC5NYORtdm4NSWa8fybNie1cpuRMvuxsuOoiH6X9TSbN7abNUW497%2FHizHHe11LC1XBC2yDq3XFu08Qu5WJK3CSi5MNO1%2BPC3aHq7aJi7bLq7eXi3a1JyAjWwXlqxGnmy8pqzfji2gDO4vlmPG3t3ZFmzj6uzfSgjrbpjafdrDFmHETuPEtm7FMqHorkXassXamkXbhsXbbkXcXuHc4p%2FnwgTltqvl4u3X1ljfjljw0sXDWezFgo24hlfv4uzvwu359izduu4lwm6pyi7Y0q752q7SqO%2FznkX0rsX0ikX1jkX8Yu%2F8bi%2B0du9LfC%2FXhu8pmq7bJnBblO%2B2nS86BG5e4K7TFu4Fkq70UrABo67vqq7lDG%2Ba2e874q%2By6i%2F58m8G%2B%2B9Dle2R%2F72vWQzwWRRwWBzwVlwvTGRvHapwpxVvteFkhQ1WBA5bvdpwl%2BGwWOiwWfAwV%2FgwTADxSwhxJDKw0tbtXNztBI8voGGwvGkwB%2B%2BFB4cuCJeiCBMwCfewCcMvCmMTEasbCw%2BlCxMtDI%2BxDJcxDYNMMOSQxQZwDrfxDr9xFcdxBc9xSWnuJzqwS0Cw3Uqw1IrxrZFxyZkxJO9FMDgxpEFxWEixWFDxVljxelhwFi9wHRscpTTs9R1vLSYvRy4v8S7l9xFyFBvyFCNyKSuy9aKyS2hxW3Bx53qxXIBxJWMuyjryS3BuWJwxR4AuwYDybejyKPMyTJiyS2BxMKsyM9%2BjMf%2BzBTIjriVHGyb%2FoSan7yCv8b9ac1iQcjb7MgIzslAR8zNvckdI8hdTMjkr8%2Bx%2Bs0c4c%2BSqs%2FOyM9S2L39R8xUDs0cIs0vQL%2FeG81qMc%2BmWs9OdczWmc6t6crgpNEyI8jtj80tos0dwc0N7c5wpiSszICybrCwzKy2vcPNSIC6HsjtzBTyPtDz%2FMEN3hEN7BEQ3sERzKj9XtD%2FvL0B3hEBvBTTbRRpPs%2B56k8Ye9d4hbErThz4fc1GPsEX3HUazxVI%2Fcml1MgAb9Ogi9IR59Db3NEf89E%2Buctq1ckq1dOy%2BtNHGdBHb8tzVdDWjdZOpdUmz9Ua4Ncja80DfsdDm8eX%2F7vEl93Em%2F%2FFacbTQAbZHgDROi3Ry7PRC07NeJTXL4jNHZLU4b7Ubd3VmfLVHavRM37JZQ%2B9Nb0VOZzZlc4RJ%2BzRKS6BKzzUSPxloefZGhPUugjZ%2BlPVsc4RlwzZmewRJN4dgDwRhb0RQdzFiV65iiy9V87FvDwRwg%2FNGE3dUrxTvXrf6WTVuY%2FVKzyJd569dZy5e2%2FFq73VrC%2FBrw0RsK7dmnzJnW5ZhM7VwD4RoTzRpH7Jp3x5qn8V210d%2FT0QgezfGSnV4M%2FYHkjcTm7du7665YdkSY51erxxfb8Vx03dyd8Ry03ZzC8RzD0R0F%2FN0g291h7F4m7NjozNkH5Zk%2F69ecf%2FHfL9EfYv4fa91fsfWfov1ikdwiyczhF90jGf0jHPIgq%2FzjQ%2FEh%2Bt4iHPEiG9Ebbf1bU%2F4xJw3yab3C6%2F3Mrc3KzcxbGgAH7jCJbgkADSAHLjCIfAqm7s5r4Kravn1mD05Olz5YGe5hud2lVm4f2F49iy5OSEWAZhmKIgDPSBq1rCCPOACVRKTo%2BMCRoEfnqNDlLvEjlN5jwf2j5sXXHfekE9ykffzkXt1koO1am%2B4SKRAarqmHBzO4BQO4ITCrKv5sV16pnvEpndFpzP3p2dYqFefEeOcl%2BsxmP%2BzmMc1maeEA1yNEmDS7NTOD8TOtNsO7pxEV2a3QPxOVf%2BN0t1xu55r9wK3UnlveYU7%2BIVDSi0tu6hDipGlAEBqgBChj5aSjxJcgr7vuy3wwgP9O8AHvMAPPMEP%2FC38UcEnvMIvfCzcwsI%2FPMQDfBgBQ8RXvMIjvMVnvMDHAsZrvMcTQwURg8ePvB2R%2FMhzvMlrPDGEkMinvMU3vMtnfMfH%2FMITQwu1PM0%2FPMrnPMTPPM8TPDBUgiCnRAo4pUuKT2v%2BEBvcOwBowAs8%2FdPjwDF4A9VXvdVfPdZnvdZnvTPcwtZ%2FPdiHvTfcgjOIvdmfvTc4J9qv%2FdZnQyywPdxjPRPFPd17wzmAgSTUPd3HQjboPdw7gy34Pdufwx7swTkI%2Ftr%2BQxDio73bLz7aSwIYHL7ji%2F3cT77Y873lh%2F0uDP1JhIA1rIOaa5IlSfsmRfutcmV85zCXx%2FI5vrgfn5m5a3l7%2FDdRl7pRn%2Fppp3pqE3pwjSMBsAI%2FBEIPFEEJANMwaMCrGlMwacAh6MMy0Tl%2B2Xml4fm4mzifx52fIxygJ3Fvuzuxszq264M%2B8MM%2FuM4UZOs%2BNCoAbAH6qz%2F0J5n0Yxz1lzg6nLjwcvsGJzg60L5ZUDRXAwQ6gQMJFjR4EGHBcrcSNnT40J0mMO4eVrQ40Jmzixsf3irHEaRBdc0cADB58mQIJUVYKklh0oYaJQROxpyJEmWCZupC9hzozZZPocD%2Bsgn1GcUYT6McFy4NWUyj043uwGiiKPWiR6wXswHbajEeIEDxvlYkWvZhU7QNI05c2zDj24Za5YokiRNvXr17TepUWrcgUMAHzw4uiPSvYbWGB0JlPJCq1ccC6T7uOhld2LGYCz9ezLjt1cdxMVc2PLIkX9WrT%2FrFLJhzUcyIJ39m7HhyZNGMTRu%2BPFkz2cmdGdseHBoz6cm9AaNm%2FZyv68mwh8ueTNszQ8y4H%2Bsu%2FXHy78fBY2M2Dhj5ZOWPmdd1Dh0%2BTumPqT8mzhh7ce2TuYOuutuw9uoSjzHyqjNvP9AkAnCw9XgDj7H34ptwPsbqY%2Bw%2Bw%2FJTLMHbouruv%2B%2F%2FMCPQMAPts04%2FzNIb7UP2IDztrgkp3Om1oMqbLanaOjSsP8O8W%2B5F37wCTizhTkRQxQWTa%2FHBySSUEboKDbvQsAwH23Cw8wDr8bgQgRxxyPGKvDG7JN1Sj8kAg2wuRiijpHE6Gw%2FEMbGN1HEHT3fqbEhLoe7UU6A%2F%2F%2BISJEEt%2BtFFMDEzca0%2F8eTJyrrOM7SsFRlzUE0n23STNSkHo3KwSOvC8tBuPNkEVWEATWtHo9TBBtVS0FHnGVRrUYpQO4NJdc%2BDEH1LnWCFFVAuEgdj9Ks7a0XVE2ncIQZFDkVaNhW0LG1UWJ4w7SnbiohtdFNOVfP0InfiOTeebh2CTZ1z%2F3stS1S5SHUoWEJUQABfBDaoQph3CeqzJ3c2wfeEcOKJwwAEkrgq13KPwDcPI9nyslF3nikF41KE4WVNwIwFDFms1AnHDRHyRUCELmzxBsmC3PkD3xz89elatLpJBeNu0Nk2JFlynpmyjuV6Utzo4ASpG0P%2BWPqPVGqpJZhgGxJMnVSWpgRop%2BKll0GL5m1InS5OPlmEVLr%2Bt1WhBCbYYDcMMGBhgRq2SJ0gIJY4oV%2BT7aYMk%2FPdAIljsv7q47pCdkqdboYYO18UBNfRIHcIwVeHwTmq%2Bat48sg3Dnd45iicFvCd5GyCvkWL6KL1IvehqhlXAAELqujGX8HicduAI%2F5Kx2rrvEnuHKSvEXLHjXxTtiOHfGcI5y9BlVpI2EBXnfVRke6UWqC1ESg4HkNMMKELhp3JE%2FtApb5%2BoGD1rPvuivT%2B6mHGEVDhGculKlyuw5dSJ4l8W3DjDKLDVxUS4zyCRI965Ttg9Q5SDl5MDx2So5z9yqWkoenAf%2Bb43EZCN7rdBU1TqVGd0SiYvlTID18GEALzEGI73OkOML07iDo2MQMDXAFvFRGeSISxAXwF4RnuEhsCDEC6WalDGJNYRC3qp46FYEMYwpiVLyZxqzthYxKbwMZu3BGOVSyxG1fRXsES5wtfPGMg1%2FhFLRaxiWeEQzTPEEb9qCjFCIYjFf6TCGL8IuY%2Bin3FHYvI1w7skAe74St8C1zfAc8HqOihL32P%2Bstl1KfAtehPbQNDpMHi0Y1DIsAXPOEJGycRjC0OBIpSpNUkSkE7Rj6DEpMQBhxdho1KLEKKYpwcAipXKQuuxR2pgF2%2BJnGNqCAwfeVTHwQ7iAAjRhKCHkEgJFEXrhHihXX0OiG%2BoOAGN3TBbwgwxFXudC48CcYdhghCENwgSkeaq3nxgCD6KOUyYpADgtR75%2FTscYWEdcEeJdxhQeJhB3xZIBjk7MYM2CmLO9ViBxbAlwQ68IVulIMYVbCABf5wBAkgQAJOeIYdTIAvEYwze4uYwUcl0AJCUGSMBv6zw0ahQBF1xAEEH41dCxahp260wAItiINELUCJeCyiBR%2Fd1wzaB5E%2FbuV2MUMXOoLwNhVABh3CQNUbRdONZ9QPG55Ao1fHuolaZA8dy%2BKqQLJBDHdI41SrCGMJOYJJmkEBXy1gYQRX0QIkxKF%2B7pjESicqgj5krwsb%2FYMTJDo%2FrGVPGFDwwEFzMAml8MQOJ4CdBXLQ0wjuspeA%2FCVa4sGFsT3BmOggq84IIo2vmuOOWhVrBAXSzGfeSRpbxd4twvHVMIZDFp6YazVFeM28ZBNs20SAJ%2BwRj3nUwocIqAJMTZWHOExCFt4gxqyekYpU5GJkODMbNgyRh2pRpBR2wP%2FlVbqBsVvVghB%2FsGIkn9GIOBhCFrMK1MVKUb9aLG2%2BteifwpxGwYESxB1OmOABaZcuJJ6AcQbogjqIMWAinuxeCZvoKu5kCPnZAU%2Ba5J7bFIYnDzNOAqVwRzfCSUQPdIMSKERAH50qGdIaFGWbyMw8StGEL9ghUJPIQXQ30AJDiDIJHRBBHCC8gU2UoQMeyANTJWCHeVBiyPgq8h944o1KPGGyIDVBGVx5yTGVRYBdwJs57hksTzR2bC%2BNRxUOqmEt90sdtSgp44CnjiugmHQS5CVdITLaZD3DZAqowmYrcQ139MECG9ABZAzRgQ3MgHaEACq%2BPFBZntgWpqtIgt%2F%2BNjAEs6GDF5TYQAe6UMOPioDMhKaXNY3bmqPZSbmbuEo8MIiAmgbyXvlagBAq0a7iKSwe2PChCv6wZ1%2Bn4pMbWESwagG7HMRBpxJIQv1mZQ47hBkBC5hBJ8iiOXyVwQnZLsPIIHyyuF3kwJCJXxnw9hd3IMwAPJ3EE35IYQUjct%2FG%2B0MedPqHeTwjulWYxBAlIIx4iLht%2BEoCWWzo60kYot1x6GS7ERCEIVzBHUxFmSEWsYN80dgh75NKIE82AzdsIhzEaAdMO6HTsZGOfWOrxZ8RMExnpsLmJ9M1M1CQL5sfAbZm3sxWEhdszxbkLO5IQsKOsIhF9Brkc84XFBb%2Bni9DkKXXHjgDIUQugVQ8PF9emAReEbC8eIBW1mwx9FYELQJhtFsMjvaFTnU9q0MC9MRjk4AnuihAnKeixRMdZ6o5rQA7G6AMHwxJ6mrdl1tfxHX4Yq5zZeG3KjwXzvkyQE2jimxsTJYBKB7bBp7hjlqkPuhETIKwoGDnfFmgE%2BbaHEgZZ9kW507yBIn3rLrRbjfkMH3CWIQdVtHcSZgUG8T4t%2B7soUkELKK58auCPfrww3nYwx4D%2FkP12Vb6uKVCD2JQhz2kji%2BNFx9fuhtZLXSK%2FXkII8won5iN18J2DDdhFWzqCBJmBgzBXgZITz5JB3RAd%2BiMYJIA0waQlwz%2BUIA%2BT5NaQGP6APYcSumQz0%2Foz4MMojBqwRDiABuaa%2FdkRus6rl3UQeQIwR5KYaIoYR7iIRxEDgrswQGhYBmaK3kQoBPsAe586UxQ5wcBigzwBQQ0gn8GKF1AUAIcquKGQGnajd5sq5OCzQPKwA60UBiIIcYOKg80La%2FCoSwor%2FKQKyEyDwGOoAu4oAqi6%2FrsAccwsBaGaMQkLtnCTASqaHHwZQdkwRB0ahKeS6c2wBBWwf9KYR4ECV%2BEwBMmod30ytwGSBYWIbrIwB0Q4Qd14A8sayOGz%2B%2FwBeRcZlXcYR58gRCqgLD05RikD1%2BOTx2C4aMsoF%2FiIQmlyx5Mq%2B3%2FuuAKuuAHn4D8tifiSiwznKES7AAKVGCY3q%2FdPOuoCMaV3OGQ9C9vnorpuiGxGMcCjEgW%2FqALngH8cvEJEhBflidxVvAEgggb0OG%2FukAY7GEeyiD%2B5uH5UKYPoiaL7KgDD81vXsqeZIPz8mAZh0kFHZAMyEIdeg0Gj01mBCIeYGZ%2BwqHXdKAJuKALBCgPhHDBRKsIkwUEEaAUYnAB8KUR8OQeReAZ5uEM%2Bg0dSiEPuiAc5NEBr9Dw7OHEBq8GhcFvygAM8wX77MERPQAb4g4h0LDW1PAolSvCnGBWwoGNcmEewkEi89D0wswNwE8ibZEsgq0QQ3IR5kFPRK4Mwu%2BH%2F%2B4pHlahsSbBHnavBSJoHthOzexhiAAq%2BIQvR8Di3x6SIMawibABCj4qYQ7xFf9NFkHQFttliLZviIjobRImd4bRKhcmmETnbXgPAZxR82DKEWfgsqrRA10GG0UGFYPhD5bxZPQqguJBGAyBFXWqpnLODhRyBXFIv1CRBKsgqepxFVJvolqg1fSrH9GMFI0kcdxAD5iB2h7mMhvrIBFJIX8QBhdTOARLy2oh0RxTwySMIweNCO8SJOKBHrdHGKRBGIJt9kZGgI4MBvAFGl3vD66gFW1ydHQw%2FnZtiITgJxHAA5pom0SgzESG1tLw8uiGKfNFAWCNhdzMDbKs%2FI5t4v9OD190rRJPgHZsyxBjh9vEE1%2BcIB5ecBmKghpjsS1%2FiCLiYYhUkOfULHjysiIK6qASKnt8IfUsABHoMmE2oNU2AXY2oDBj8Qlr8RYXcxfP0Q3KoAy8yQ0WAe2I0fzi4Rn2bAbyYBWOTTMRoO9Ybnum8Q%2BtcXhG0ynCARtKwRMMZsU2QQjyxaiewaMuzDdj85D%2BQDhWkN4CpRbiJ2F8U3e8QQxir%2BMCNHPOjOnYTq%2BUIh7u0QQCsKrmxw2sJmbaxQFZVB2k0x4c0lC7b3ueIdh2QAyQVEkLcQg9EjztBP5AagNONdtu5WA6tBOkkdpygAEuU6fo05nsge2ODyKP7QT%2FGA8BVFMdZBBlABVxBjQpC7Qi2NANlGgRUsFZRMmTHBNlHlQPJRQBUqFddi8IggVDEXNDjw0KXBBfFCFEM8MwS5QFI%2BjEPDMeVjQ0E0IU80ynciCIbDB%2Blgsd2o0t7SEMfRQWEeAwhVQxB8gexvMIwA8n%2F0CsYsr85kGTiBL8%2Fm02S7Xv1GEVdIoGk63dvNRXwNRVnkGAmHRWoLSx%2FsAd0rRXyWAThghO8aUP5hQhhcMcek0FumASCNYdxmEZhAF55HDGRnUj7CpgHNHXOMljtQwbEDMe7SEOHnUFJZVSNckCGNEGfzAH%2F80LenAelqYUDCZU6W7unEJLZYzekMiH%2F0QgfhIycdqz7dzAE46NVtmS7aYLIsczCPZTBczwV01KWPeHWI1LKWdIuTxBLBcpe6qAAOXrHidzD%2FHFWisxW9VzdDK04XgCFzv0Q%2FGFEMYVHUTODsw1W9H1HNuFXVuUgojHf66gDEQOAZ4gcfyGDG5GgIiyX%2F81doZ0gDLUX4NhESTgbcYP4hYWaicBG%2F6gsY5PYkXjB09gWT9JYyOHY42imTBNnq6MEJ%2BBpWoB%2FMZzZRGgZSHyZWeFFmPHF%2BwhH5a2Dd2BEvQAZQ%2BOEkTu3coCaLnFwmagC7qA4%2BJgHlYhX%2F6gGyYhup4TAZwWcztJgFQgDwyhXtnyxCxAD3Q2X%2F9SYR66FiswZ39MtshUAINbILosFFJPJgqDBVhZD%2FzY7m3tQSJV8lwWCpHsFm%2BBFUCNcob69pr%2BViRyrWvA9fryQSil9SoZ91r7DXKdCXfdoAZLNSvZbgZsgRzs4R6Xy3N5Ip1Cd10RKaA4QhQDpTFPxgBmILAMt%2FGMbhcqjIjGttpAakjfpgrkaTx7Ll9yAI5%2Bl8QidM8UgGeDYMX8JveyZxNiT6eaVzT5L3OOrVfjYBG4YIO7QRhGNhw2Yc%2B2t3sz43vhlWXDoRPQcxcTRgVKAYoOCVdJS1Cz8ZPGBgm8gSd%2BMFr9x2AiNToxF08owU8zU2oWFTMRwAnaRSL50mv%2FP1IqJBkBuCwcflkdhLan3METTuZz8xakJqEbFiHMEhILg8E5Se6QJGAVWHhWXHhvXUWGR4iGC4IN%2B04kRC4IBDHY7vZJqbVxsVVbDQ93JeAKDMHkQKoWHq4kEYAFvECjfigz1Bl02y5gt6cL2ikUXZRu1KELT0Z2uC1xLMwCuuAIPKADDCGjOqADQGwWRcADTqBfiIeiE0kd3ADcJGAImsgTPMAD3M4OKHq6BMvZZuAPTuCk32gGTLoU7G0RnK2bIJpk%2FQiQmY4iZYwQ4sEcRE4BOK5XI%2BiQHnkFE7K2VNeodcAddgEE8sUDdMoCOGw4z1AbwQ1l1sAWigKJVFcE%2F9xgpstmHsiAos9AACHaswQmB2zOpcgpsuCsoWknnaLsCGDYV77WKFa1dpunG4LtcTfX62yqVCXgqUfGK%2FEEUxmnD9yBV%2B%2F2mjktm%2F1km1Wnmw%2FIhn2lDGzvZGShUt%2FmCJItutL5bR43HCCsiHD3wvIFxCIIx8ZGBVQ1D04big3hbTwzkLYThuCNoMvFVFBlE1SledDhVIa7i74KG26hG1yLtdABG6ShHQVitSBjWcwKe8JBGqSBtXqLu7OHFhoBVcKoud8IurfbDBGMWkbmGaQhvWvMZ%2B3kGaqAqxEABVBKHTxBgPgzDlTAAjzg7I5AscQosSzADcgpFZxtrIFKBP%2BCgRwq4QbGZgaeyZOXDnUsRrjd6FlkI3GEu%2FXK2wyb%2B7upG72xahWEO4wWaBfEG7uVQrtHXFTLIhxyYKNKkSBuZ6NEQFUhLajKjKXz5QQyywLoZ3M3KksNYb97FaVSbaOWZ1ZSYaNUoLJ9Ain91lhbpxZmQMutdYbCoQyqWgJUwBC4YAZYICz%2FQMsjz5O0%2FFY2UcsnTB3MAQJnwBPiAQQ3wA6SSgJMYKcDZROGwAIkQAJE4Aq4LZDeHIoHawa%2BNXGgINAlIJF8W9YcJZ%2Byp3qEBXoUCJmOqIDIx5uVqXyQwdEcCXs2HZouy35UjjSfYRJafRI8wRbYIX36t9VV5av%2FnkFnbv25Vcu31NvVW%2B%2BrZqmtzKEUXH1r4%2FtnP%2FnCPb0zHEWUSl3TLUmfKh0dHIiBkkmv91qXpULXD6IYaEGOuvvWXYbVW91Zgj3Xv%2Bq9uygSs4iW0IG3xr225D1ZLrtoMrtQLCYYgmGuvCFMPrAW3XvfTwnB3KESaCEYWo%2BCgkUYgmGWrPi3AQNg3mJugOl5dzlP8IRjFInUUb1O1AWaOh4dKMnTDUfZQyVasiRt5IKCXcXUBcIZHK2ApN3ZOd18Pj7j%2F0Kaoj3b7aK4Ks%2FWeh5sEMjfEQdpQb4giMEbqP1Ypf0hrtgpJn4tKt5aLh4tTgct8Oct4hdeUl7iV%2F4t%2Flr%2BLTboLbC%2B3n8e6AEA350CVAqljCfXIWSoLKB%2BKaQeLai%2BUqy%2BLMyecP69RE4%2BhrxeUsAemPhaLsh%2BLfheQNEe6Nd%2BKdqeI%2FLMAyxgBLitIeT%2BK%2BjeKOy%2BLPAekPT%2BKxQfK7Q%2BqzFE8OWC83MZ2Y0C8a9eaIDF3sXF8Y0C8jnCHOj98k9fXiJ%2B8DEDHTyf7kB%2FK0T%2Ffvz%2BWAC%2FLjAfK1J%2Fgg1%2F7NNkMIifbxmfQIX%2BImo%2F8p1eBHX%2FLTRfKJgfK4B%2FgoUfK6R%2FKUi%2Fwtt1LZRfKsAfbJ1%2FLVp%2F718fXKi%2FWK3fIrB%2F%2Fbl%2FLbzfJwCi3C10BAsaPIgwocKExZwt%2FnwIMaI7MJrcRbyIseCtchk7QswGzKPIhPEAAYo3MmVBYNlUqhToMqU7TWAsxhTpzOFNkRt3dlTXzAGAoUSLGj2KNCmABM3U%2BezozdbTjiynZoxizKlViDC3RmzoFeLEimEf9iyrECRahSVPrk1Y9e3BrnILzqxZ12DOvAbP5gUqVCmACC9KFNWAWAOBoQ5eaFDKVCvfqHxXtqyMDqvkunT5gq081iZfv3nVVm6LsnJcvp3r3hWddy9m0nIBC56SDt%2B9Q4ttrJMnD98UADas4YO3JWlkzJQxr%2BaruXLrup%2F5hp7NsbJpvqidX2Y9EDRN2HVlV6b91nbSEPesFTnU%2F294GH2H%2BASyQQDXOiWs5IVAulxlzan2HXRZSRdeZdXldd152fG1XV7dEYjZdG%2B9hpl5oz1Yl3pIhRBIEQC8wM8cAByyTgqPAVACPocAMEV8SBHQFHMheYdZZgeCl6OGroEBCnlyofdWhHVNyNdznCXI4HgZ6uRgZR4Kxgc%2FIuKiDzz4QEKADfzUAcAP%2FLABgAYpnHnmC8eU402bbr4JZ5xyzhmnMxvRiWeeeQrkjJ5%2B%2FvkmE7qwCWiheMZiaKJyllNMMYQqCuk5FD0KqaKxZFNppc7YQmmmgJ6zByDneJpoObb0Saqh2fCSqqHl0DRqq38y6qisgCJqq5%2Fl7JKAYP9DhcHPJQQQcAkkQPDRzxheyhFmiTCGAm20tvBiS7XWXottttpum20ssXALbrji2uLtuOaea4sRmVCLbrva3vKtu%2FJiW%2B689hKThSTs2itvLLfwO2%2B9ALdLDB10EDOwuwInbC68DKPLiyRZIPywuQtXHK6%2FGIvLSyW9CgZsKIER5QA8oXgJpphqzFijgDdSiFl0PD6J2URBYoe\
ZkXIhmZeSclm4FoaV%2BVgXkWhNedQU%2B4SyWJlyiKiBPJewBwkAW%2FSjBIAtTyYVjjHvmBfQay34I1lRaveyhCallmSBS9bs5NBQbihlUEqFsM4%2BrlwSyhQOpIMcJPxkHYo8agyzzor%2BRgXIdY4%2ByyVz2EzmRbZcDdKNNmY81%2FX4WmKXJTRfRA%2FJYW12J6WEONasns7KNuAijzhjDJVCf%2B4pt3VeA7adY%2BRvY1b5hRQJ%2BZbRaOn81uZydY7W52GFHtvceRkfFtJFDYt900NpMPL22h%2FFuO5dw1yZ7z9PTp30lg%2BPc%2Banre31zNbFLbr6pNfdva%2F6CxZ%2BXbv37La6mO8tzgtL8ILGvrNBKG1Hgh%2F5JAc3vMgtR9TzivX2h8Gi9E8u%2F%2BNcACEHtt8pyH4INBvmFqg5B%2FIOQREk3lpGV7zSped0GayhBnPnv%2FGtsHwhPF%2BODoiWy01PhkVi4M5UCMAKoe9C9Iv%2FHgWJeDQa2tCGG3xLB5f3wbcM0HNLfAsQQZfAE5bGiMlDogeV2EKate8vUpxiBqu4liu%2BhXlo2WLzujg2EgYxjEPMGRnXorw5ZvGOaZzgGjvURjfuD45okeNa6FgWO5algF754vP4WDQoHu%2BPaAnkIwc5STyCronl0SNaKriVCyqSfzjkoA6T%2BLXN%2BBB4prykCfvoPu6YEYtoFI8E6%2FdE%2FK2yhowsiyPRAsmwSDIslNyKJb0ixEz6MYVueaAIm%2FRLJx7SdPkbJitl6UrHgTKSPSSgKMvyzK1E8365VFs1dwhBX7oQLTBcCyqtokpvgq%2BVVnzlGWPJQlrWDJPsROH7%2Ft4JS%2Flhc55lqecpNVm9ROpTa%2BDspzh7V04u%2FrCW0CRoDKd5ULYlNJ7zy2Ypg8mXfE6UKMUMyzHLkkyvLNMrzbRKOq2yzo%2B2s4EI%2FadCXUNKuTi0LPecikpXuhR%2BxtGfvAToT9M30FtKc6dH7GlTn8pEkwqVo14p6lOOutKWeuWlYYnpVma6lZpO5aZTyak9IRoW5AFyl4LsZUkZGpahhsWrPgHrRMW6FbJ6xaxWQatV1PoUtj7FrQ8FqS6tWteA3lWNCkRkN5F6w4ou9aJOJalnuIpTj77Vse4UqU89C1StvkWvXYVrKiWK2aEA1iqC3Qphp2LYqSDWJ4r1CWOJ%2Furarci1k3T9pF0XSlkxcjO2uNNsI5kaWR46l5nnNCBo2yraxlK1jJA1rmSRa8jKLpe5%2B5yuS6HrXel%2Bl3LXXWx2gUtanpr2qqi1XFBX296n8HUnftXnbKdSW6vc9im5fcpud9Lbnfx2r8G1ynDL4klkjpOm1VXnfV%2BYX5%2Fs9yb99eZ%2FnxLgqQzYJwX2yYFvkuCbLLi18a3qfKNb36zi1Sus3cqGY9LhYX7YJyF%2Byoh3UuKdnDgmKY7Jim3c4Kk8OCwRhumE01phnF6YnhneyY1dkuNV7ngnPfbJj28S5JsM2SVFdsmRrXJllyzZK00u65MPG%2BW2TrmhVb5JmlOS%2F2VFbvkmXd7Jl2MS5piMWSVlVsmZp3LnlKx5K20e7Jt1G%2BfFzjmvdY5JokWSZzfuOSZ9vsmfXRJolww6JYWWyXsZ3GLuvji9MQ7apGlcaZdc2iOZnuKmXdLpmHxaJaF%2BSaQTG2tTS7WgY6TmqiV83NTOeCs1RnOS%2Bwrb2N5aJbl2ya5T0uuUjHokpR7JofX7bJ8s2iqNtu2jDfxrBb%2Ba2cFOyax%2FEm3MTjsl1VbJtUeS7ZFsWyTdFsm3NRzunYx7KuUW8LlNnG4Vr9sqzUZ0wHEcb6TOeyT1Tsm9RZJvkezbI%2F32yL%2Bt%2FPCYDPwpBRfxwYWccCMvfCoNB7cwybs4pf4%2Bl7PqxaoX2%2B3vU7N4u3PtLrLXa1%2FVYhilbLwscycukoqP5OIeybhHNt6Rjnfk43YOuZo5CeHi%2FtzmQVz5U1oO8JfDnKUyNyZ6t24g80J5o1FdtrNT3fNjOznZQXc7y3HOE6vjOeJhLft5aZ52oMtF6hmhuqX1rmisM1nrcxe8q4VOZaJbduyZZc7ZG1%2FzVuex7duUy8h9UnIfn1zMKTez130CdpCLnfJI94jSRcL0jji9I1DPCOExYnhZI34kn99J6L08ekGX3tCn30nqq776o4TgEMO4RAoYw4fmPx8ADgiE9JtrecDnZfYZqT1Gbn%2BR3Kvk3R3p%2FU1%2B7%2Bfgi%2F56%2BDIp%2Fk2Of%2FjkXw8X94DEOqzxmEDs4xLrGIZQDrF%2F8OB%2FFJV98RN4XIcW4CcROodkcEdcPod5mjdKkEdnkjdeSIEBkDAcctAPL%2BAA6xAKABAG%2FfADJROCI0gEBCggl%2BdmGKV2cMZ2oMGAb8dzDyh3Leh4XUeBlGaBM2R0RfEDw4ALjbEPfNAsYeACRQgARcAPs3MUNOIO6iCFU0iFVWiFV4iFVegO3kAMUZiFXwiGX%2BgOxOANXhiGZ4iG6hAF1GCGaeiGWMgLbyiHV%2BgOOdGGcyiH8QAk8YCHfagOvFAOfjiHW9iFgpiHa2OIbziGZZiIblgOcdiIaRgPoAAGfP4YiWdYh85wh5eYhZDIiWDoDhGnAeLADysjJsyyLMvSLMwyBdECLZdgBVQgi7NIi7Voi7eIi7i4BLnIi73oi1Swi78ojMNIBT7ABMSIjLwYjMnIjLS4BMvYjMxoBT5gBNFojdVojc34jNnYjD7gA7HIjcgIjeE4jONIjr5oBN94juVojuuYi%2B3ojrdoBQWgPyEgB%2FugBCjTLGqgiqdYJmiSJqigCwNJkAVpkAeJkAmJkK%2BQCQrpkA8JkbqQCa8QkRVpkbrABKBwkRvpkA3JkR9pkJngkSAJksZABZjwDSmpkivJki3pki%2FpktAAkzNJkzVpkzeJkyt5B21gDCRJkv8T6ZMgyZBB%2BZHGkAhW0JNEuZEiqZQcOZJNWZGo8IMO8AOPEQL4EAhXGQhL2A9bUAL6sJVK0JUss4mfqIVcWJZmOYWLmJZqKYVr2JZu6YluaYWZGJdmqYfJ8A97yZd96Zd%2FCZiBKZiDSZiFaZiHiZiFGQknQZd0SIZ3%2BYmP2JhXOImVOJlaaIeXWYVzqZnuoA0%2FmAL6MDVy4A9hQACrUwKHgA8vcJrWEAKQgA8uoIKNY4Dbl1GEJFAyqJeJyZu96Zu%2FCZy%2FuZg36Gh0J2PJhUtFJxh1gA%2F0sDRCoQT0gA9gORRTIJ3UOZvio30CdJuhFIPWAQa7GZzjSZ7laZ6DOZz%2FtTlLkxVeyuWDvmIDW1AE2vMCW%2FADRVGf94l9K7idIPSCkPadDBKe50mgBWqgvZme1rSe4AVMnbcWtUZFfjdWLFicnXVN7DVQ4nmgG8qhHJqg8HShdYecU6WclCdbEhpYFGpuLpiDCYh3UzegHSqjM2qeHzpSIXqc7Zmck2eiSfWfAKaiBseiCIhOL1p4MUqjSaqkiWmjp4Wjj2d3X2ekGUF%2BGAGhxISitBWkJjekElikGbqkYSqmgtmk9PWkOhilqDelGFGlF3Glb5SlQNqfWtSd1BWgP6KhY6qnYVqmMHamE5imxremF9GmEfGmGNR6ULGlotelf%2Fqlurmnkcqn%2FxCIg0QKTe4XE%2FCne%2FJHXomaEa%2FnEbF3FXVKYXe6Pnkqqam6oX3Kao56qTsIaz34oHz3V3EKYosKfI26oBgKqarqq6tKqRVqqRYGq%2Bwmq1H0g%2FJmqzyGq%2Bmnq%2BZkqsKDqr9KrePJqmjnqsQaqO83qBFRqBBxqIu0rFzWrJ6mfqBGqmuXm%2BA5rdXqrggarCvaos%2BDqS6hqeO3e7RGq%2F41rnxWrrp2rryWrjC4rgLaru%2BKsIZ5rRGYrVJWrAzXrRDxrQ8RrvrjqRgBqlQRsNg2sABasHiasCHLmwtbqV76qtuaqRFrFvkKb8kqcf3Kaf9qbRuLbx2LbtGKQAcrsjvbl%2F8kK6wmq60jSmwXyHowi2sya280i3E2i3A4u0c6y7M867PyOqwOi7L2qrILMbELoQ7B8DEmerEXkbEZIaoYwX0Y4X0XoYBigaRR67Y9G69COq8nK7Q69RfB4LJ996O3OqdrcbYXkbZfkbUJMRFQ%2B7YJO7VyW7Vy9rB3d6xlUbG%2BErYRMbYYUbYX8bcREbgQsbYPUbiHC7r%2FkLhcOrdBq6MkyqNga7TUhrQWp7RNx7Qo57RgZLihW62jy6ila7V1O1opta8etrr01rpL97qyF7ukN7uXVLu2%2B6u4m6u6y7hXqxL36m4smxGR%2B00FqKD%2BCb1rNbgI8bnMG7XO66zd61v%2F9Tq934sQW6sQ2AsZwUtxwwt7xTuqeyu7H3uq4ju%2BcUu6iytpjSuljxtReVur9kuufVtHxyt8ydtRy6u%2Fkkq%2B5mqcUMq72lWiqmvA%2ForA5JTB68fA6tS2D4ywEQywE4ymFQxfKYW3Peqj2gui3NnBvvbBoeXAIqynJDyzJgyoKIxqvkvA%2FBrDrLvByqTAHoy%2F0mrDIYvDSavD9ArAairAFvS7Oga%2FSSe%2FoUq%2FZlvEMnzEOZvEiMu%2Fueu%2F5%2FvEghrFr%2FXDwBvEwjvEMrXF2sZ%2BpKa%2BBhG%2BX%2ByuS%2By6TUy3pzu079mjkwsRlXsRlxsRmcsVccxtc2wXIWzHvorHxKvH%2F6bboOLlxxjswjcKw%2BbLW4pMEHXcyM0bxs87xupWxtx6xvg0xVpWxa53xRr7rBrVxU%2F7ybcbyuU7ygpXyil7ykbltSwMyA8hyBFByBBhyA%2BxuQ%2FRuQvhybOcqo88v5G8u3xst6lbtGscv218Vm%2Bsb4jMb5yMDsvMzJHqzFgMzdHLwzt3wdV8yU6aybeMYt4MzuF8w7UswZqMy9KbEtQ7EuybEF37terMn%2BrJve5MZPDMyPI8puPsyvascrmMtbv8Vb0sGEUgB1PQNA6gBBk9Bf8RJhX9PZUX0NtLp9b8dNzMcQZdwwgNrMRJtUAbzZPsnrOarIHAD%2BsgmovBhPzAD%2F%2F%2FkBxboA95UzXZmUPYXFjarHEmHXUordIQTM8lzNCm59DpC9HQ9oMaYA2H4ACHwA8vAABycA9KEAM9wD3iMAwaoH9cXV7rbKbt7NI2pdRLvacKTbZZrLlIjXvom8%2FejA78jBAq5QAE4ACXAA%2F%2FwX9bsAWP8QLUWQRjiRTNgM8Up3hl5Q0Y9dgl3SNvDdcJ3dTWNtlPbWiUWNkeoc88UTMR5wDWwA9hAACnqQ%2FigA%2FiUAL9yA%2BoGAa1XdtqQAvIkBO7zdu97du%2FDdy%2FXQyxENzFbdzH7QyxAAzIzdzN7QxL8ArOLd3BPdwNMd3Xzdu3cAvYzd05kQUpndnnGQl00N3%2F3K3c5X3dw43e1y0x6z3d2u3ezl3d8d3ctPDPSOEAWxAK4sCaW%2BA3SrAP9zHbq0gctn3buU3fzK3eCY7c583gxw3dD27cCy7hwQ3fFR7c3x3eCU3eGA7cDu7hvU3hIc7b7U3ivX3hJ54T863iOWHfghEYKcAPW0kUDbAOrJDYRrjYqt3YoQ0VkT1Ync1DPo62do0Row2j4L3h5CnXlivkbb1YoH3ONlbaP%2FgC4gAHS8gPfKABw2CEL%2BAiH8gKAKAG%2FKCfMUfSrEzUuGXUlh3LtLvkk8rSigvlZEzkR67XfH0Q%2BeQArqAP%2FZEOKUAAocAPrCAO8MDVNI0L9OAKH32i%2F2muqGtOYG1Oe0autpgd5zTa5INM14dcSDC9o0R7FBEgB6FwCNPnAKV%2BCGhNAGkQCoGgOGiu1n7K1g3r1mCa6Um66cLc6cZs6WKB1yOB5B2h5wbhvvtJmyLtt5Tefb%2FOuZie6x266xAxzAtxzAoBPSfloMjqy6sc6QI90p5NaNAe7SsN7rjJnqCOuqIOc7%2B8EMFM7b3%2BEMVs7c6OzORe7gY67Q9R7Qpx7YQb7DiR59ZrpamsZ97%2Bqa0816%2BM7p%2BF6%2FnuoZvNxOLubQEv2gPPqUeH8Bir8JYr7wthyFZoEJIphSpBhQQxhff%2B8BB%2FoHJdhQsRUyePDim%2FzZ%2BuTZQs0%2F%2FdDukJL%2Bkkxux20Q21IPS18AxRSBCmIvTCoBLCIPTdoA7hMPThsBBkow7kUfXYpeQsf5jjbBFDXwvdYPQIkUzqgA1C%2FwxOEQxCL%2FVHbfN7LvNub8DDTrElv9cE76YGr2njWvXuwPcGDO8PQQzkcOeY%2B%2FNO0QctIAGJLwEeUAVnP%2FOVwAALcATbqg45sAALYAjx8AwbwAASUAuaVR3qEA%2B14AZOP%2FOj%2FwdYr%2FXmjmPqQAgzoPgS0AJxYPoHkUzucAWX7wbxEA4tsAASsAmB%2Bu%2Fge19RKAzHHwxnDxvhIAzJL%2FD9HPY%2BIQ3BEAzdUPcZL222WvXPMAndPwnCEP1i2%2FH%2F%2FSwZ3aAHjTAJa2%2BbO%2B8OXYAA7w%2F%2F738CwiCFlfD%2BQkD5M%2FD%2Bmf8MFoAAACGhljp0BQ0WLOasoLpubjZIkKaOoR0LMAgexJhR40F3YJL9AxlS5EiSJU2eRJlS5UqWLVVGAhRv40yN6sogwJkT5wxhFw0Cy0azoDsnOMvEC6cC5yR3QjWWu%2BVU6lSD7jSBaXpQ4qQgFiR83RBkUVZ3hr4e8TnVmUKM7sIRepaWas0gX8feKjdX70Z1zRwAABxY8GDChQ0DSNBMLk2CcUTotAClJ1VvtvbudSesSiqJtXBKiHtZNLooxhaPVlcqZwsybnTk7OJOXSWcQppK5CsxrboZ%2FjgNxXtmAYHA3bgTDk2F0wM2dfEWGUCQA%2Fdojh5dXseeXfv27TBlUncXJ%2BcGKFxM5Eyym5i36Rh1u4NiFGmLpbLbL7yvGyq66bjv4z9tLquw0iqcKnRCsAyC4ukDpyACnGmtjDbJAYGBqMOoNwTuygtDvfr66zARRyQsMQjdCycJBHMSYZWsnKrMQ6HU%2BWMDAzqRrRYGELAgNBmnKu1Evdz5AycVwpknHnWOgM6DbmarbR50aqkFnRetROeZUlLpBkv%2BNPwtuOEu5M8dbEqpxZxr2EpNAQQ8ECYcdQjZKZxwfuzoI%2B725LNPP1Pyjjp1hNkAJx2CiSeebo7IqRSC%2FyTqphJPugnnSome4dKe%2BBA4Khz6ENgkHmG4lM2gbk496NRuoAoH1SlraZVSjFTFcMAr3ekiJwl04GIGN%2Btj0MHiAlTHnTW1ElOCXOTSzan%2FNByLl%2F8%2BFNI9v0jElkQTp3LnitXi6KNCnHIwRyt37NPKG2LKfLS%2FUhc6d7Fi4zVInXA8wKkUJXXkMa5iT5uXWXenzSjIH9GJJw%2FlNmlunlSqqIIMOWlD4IhJZvhqBkIuUmcSHfBVQAQdKHkUTOCEI85KT5J4TIIWmqBFNi4eQyDkJLro4DMTdJDTwzz%2FBDpoobELdLTwcNpAGLJq8WCGLgZSpxaWaxahhT8ucqeUI%2F4KNaGMIOTz1KitETiBjCfVeaYFE1TwRaJSTDAhB2yI%2BQPuPJKQwIIWTjBhBuasrNuEIGq96kV1PMkpiIGUnEQ4A2ZAuEEEHhyKISrl9KnYcGqphBYv1QkG5SrrdaebWnxBOC07rRw0GC%2FRgXYeW1Y52yA777R99YJWR7vK2zNHR%2FeFrs22%2BMK2dVYWCXCCoptE1fEWJ4b529wQQ1Lp6aJndqkEHWGuD%2BcZX3y5s5bry3xmkUWUJv2ZTQzZRBj%2BgpeF5vWj3tECbMIpxRCo6x3UIiaRPYMIY3z8MV8punEljRgMT5vICQNyEAdPoMMe87gNxUQgAejkZCzu2MTyEP5EHN745mRjKtYihIOgGTwjHjnoIAIex6ScGEAEPauVdYa2Qx728B9FE407huAgBspPSWg7wYoQYIgcFQonMeTUfGpYwyPw5xnLU8BAQIgTEcwtDk3KiQ6cyBQrMQoBsQFP4QwSj1y9SRjfQcc83GCCI0gsWJN71CaCYAIFSEAFRyjFbbrRhRYsTwQ56EOlFsHHmp2gBbIoliyqoAIGWGAGZYiIlRahAhX8YRI5sIAFcmCIi2ioD2VAAQNEAIXQQI%2BTTLRXEDjpiXjUogUqqEIePCCBGbTAl5u4TTBmoIJHcox4xkMmYJAnFHeQgYuZtGIOnvCHuLjDExjLiQW6cP%2B2I%2BTNITjpAxm%2BYoduOqgWdqCZBeLwKGxwAV%2BfmUEq5hFCXW3gGfzagB0%2BJQEo9AxtT1ihBIaQi9vUxQKTeIIIW0BKmjjwR%2Bo4EIJYQ1D%2BUAwBIrBDHJyYBNnsADpB6AM6ceIGJZksWbXIjBNFEIcuiPAI7siDuCQQhDLYQUMbOEIVcJdDPfnQpz%2FlDhAvo46vIYCk7qlKF6DTAjHgQVxJUJIZJeCGmOakU59iQBX6oCKcLOKExLEmTk4wNztkMwge8MSmqiCbZxQqZUZT4%2B4%2BVYXv6MZe7pDJHR%2BUNRFCJhVuKSqCumCPP0DRAKWYRyneqROeNKewCFAKFD3RFA3%2BOW41EXHH1wxgByWFI4kIoEQtkSbCE%2FTGAHS1kuRO8KThhSiZyFwmTTKLk5cWCK%2BdcaJODHAUoq6oFG2UoU5ymxNguqMKUDRSNzaB3Hvu6Ik1jI06pKEhnaggezvAiQWgqCwIOVRG9urCCnXigbFAaTibsIc9FIaAGRCkE3GAgjTSG1G6lnCJX62FHMXqi3nMwyz5skct3OQkd8xjEeM6F550CFQGN3glQv0QNmjWBzhmJDV26EIqrtGOA1cMOO8kRH%2Bf8c6rMi9R6HgqfouFOLKRNSeGmIf8JsFFbMTDEOPyWVzR9k4mFqQbzwCyNIAcDr1KJAjQmUEcykCzMtj%2Fo8Mz2EQlmpBd9%2BXATQrIgeIkrJwyVEGEPItHkcTqhjI4kQsyoe4MxAAFEcbGHULASR46qxRQ1dK57O1ah1dbLDgjIA5wBNFrkxnbmajjNQjg7EyaaQADjGwTXH1pbw11hRygI6IIIEMnuMAiQhhihWWYRy20i4A8vE%2BE2Asv89xgOueeAH5DREALzBGPMkDHBITwmAyhIJvAVuG9CwAnAw%2FiXRkVuBZ3O09O9kwxJxXrxtFZUKgX0QVsIuAKJTXhSd0hLjdIyUpFjYM9UjFgzD5bOgf7mYPVve6RQHgu9oLBSCtspXe5wx7PmIQYduBEFaCDxfZcUFGiGDYEkPGO%2Fv0%2B6YrF6uI3nc1en5rEPMyY6DQSiD%2BqwclkrUSGDnjA4x7YgCfsITnKTYIMSXhGejeNacLuZBO0uEYfFjEpdyTrjfEo60XlGQ9CiHASLR9OKdIbvfbatwXdIMY8bkK2BfZZzvaic6j4hYD0ALkbNJvEh4cDyXodU9DZInRN2grOeWNEGJP4gzDsMScjVaqoLSCy8yIqnVCLMA%2FpbSNH%2BbcIQtgDOBrSFzo%2Bm4q1T90QFyzF8iQQp89OIh%2F2EIZwRLDAokonUUU96kaIjaHNpYLIpZsErDc0D4rB3dnj6kw5ofOra9s3TKLbNk4QkZV4CNwN4ib36aGN7gWz2%2FcN%2Fna3gIpa24PAD3PdgILjYniEebadIPABG8Sb4g5K4KQFWRKdwltMjJzrwCe0xkkVulEoC0ym4lkB3Qp7HI%2FjIgi9JF%2FQvScRByE4kQz2mHFOKqADN%2BRXIpFHIUkDtYKIB1hrMjGDHCt5NsixLzKIh1tQh1TYEQWQJ6ebM%2Bmxs646IuPCiSuwh2fzPq3wuq%2FTFsWYCg05iraoN3dIBTtIgs9CABOgPBPjD%2FbDiS5QkoSLBzfAiSdoinmQhkXgAjFqlNKhmcnCHx7JHjFhgGAQBixKAiiAgoTCiVSIh6LCQSvhqsxrINN4qG7QgeX5A5lojqsbKdKjrekzN4IQFxW4%2FoJF2JTWMynY0xBC%2BA53MKPbG7c3KTfU472e%2Br1A9Kngowpc4SLWshLPiLVNmAel4hEkQIRncwJ7gKCLYq142JQSK7jp6zCEy76w2r6cIz4EWh4VkBy0yDGLs5fPSkF3mCMVGAHiGjlh%2BadCYbSccEB1AC5d4QL%2BAEASOjQ7JMBMBDrKcYcn%2B5Kucge8MEMEQCwLhDoM5Je3codOEKsUwYkxFEHXIsESrBYrgbUguBJzKIO088UhukUnWq3ZIrXvsMEzUpJfXBweRAAfVIc8UL6vyBcjzLgcyR9%2F%2BcVguKInYrQYssKi0kZ32MKyM4jNQw1xObp4MLYV%2BgM0RADb%2F1BABFuFAXuGebCHNpLDbBMdTDSUYhGVd0IEhxkw5ymLcZFIBQNEQZTJoSFEbmExa0MYpIA1gcCGMVqGdlAEnEiCuluKeVAHc%2FgUTewCo7SHiLKNZAmGAsu%2FseK%2BNNSK15CAdyIjwrE4%2FuAqFWCt1UkO6ZnFyQEssaoCQ6DHXIyHTbiCQtIJO5RHiRAXbbSSJzCKYnw%2BZLSvo4DAsXPGeYDGpJDGHQG4g6jDx0ia3RjBbjyMsNMIV1SOZyALjDuoeXgCW3ODVJjKGWxHAowoHByU7NvBHpwHa6StRVAGMwqkZkRCfumR%2F0MZJ8SimooDO8iD3KRMhJQJhZS3mXBI0f9ImJyYATvYBDegs%2FJrB4rByJaMDhb8jElAh06gGdGcwzGJh%2FxDACighEXQkBHABhZ0kw0QIOcUgUkwhJ0Cj96byfb8k5qcCnXYlMnBTeq6gnkQEwTog2WghXiLNTkpKhXYhGe4NE2UAEIQBorIRuCwv25IBQ2hSlG8FTphkb%2FhyhehPvSYtURxB8kBlbIMgnhYhezKr4%2BUj1qYBDtAKVrQAzqrghhDGWFIkk2RDrx6Bpr5A73UpJ1IRjziBQNDGhfqsz4wymaUOsP0EYQRj4tyk12zFm50zMc0QWdZBecaghqLB2kQFwaohfEDsA8UK8%2BUM9C8wXgkTXp8AntYOub%2FkxI6%2B6tmJDx3gE2ARBlfaMZFeDxhoKpNeBLe1MLf1DwvfChzEALkygk3kA3mVEPUG7HP%2BBTmkY3rfACouTSdkIDyGlFlQ4ex5CIcWs%2BYdM9QDaqYwBCGED2Jyp4%2B4yXxmrwtyiad6BQ6y67LMrLx%2BJWLYrhRtCKaQYC1Kra4Wggzio44UMtDI0uSi4extABPSA06G6wkWCphcIZiMCMygNGa%2BYNFcJ%2BcqAJP8ISi8oCOFDNj5EvqKgNboASaSQ921IFnwAbgOlIEOMyFCB2dGIsnjVJv5JalizUouAI6MwAcBMwycB%2BaOQG3izN3DE0zRaHSrEc1tb5a0AwPUhSa%2F4ECO2iufpHNMWlE6BCBRVgFJrGh8PRT3zQqhiyI4BQNtKmC4bqodaqos1DDr%2FC%2BY1whA9iAMtglFWCOMJQARPiwvPkfndUJFJg96gms8kMHMzKAI%2FlGZmJPUZVaoiHVUu2GKxCv4WClR7GlJ5KASfoKZi2LxcoBcZoqpIABCRiBbxqXYHgUT4BBC0BOPyKrr%2BAojGCjnNC4VLQUYaAuJTqCjiQ5M4lFHvlbHYgHShChDUCBd7IAlCLMIqxUnfgDvBKzEDxGHrUvnMiAX5GAQJJMpBkuqRvPJC0jZUPEroPSfC2RKXUW6FEiAwiCs4GCDsraHrlCRhtThDmugI1HLP9anDNgtKHEuOEYNRnqFOoygAH6DIAE3syQVZ2ApdcwAAr7UwPgwoIR1IP5v0WwHkPQ1qwoB1s4nWcwlfGRH1%2BMREPoCQOCFe8ZnycJh2DwhWDYqZrzXvgphmuol27I31SgHvQ8n2KL2qk14Aer2lLNjPw1BEjKHGzwXj1wEfGpBWwYiu8BXzsZn0wyoJ4IBuuZBE%2BVLu%2B9nw4uB17ohvExXwBSOutTz%2FNzj4bg1c%2FQgUWQiDATlrK42Q3ogkIRgTdahE%2FpoBYgo9DdR3QoM504AUJoChzGox1lrx4lpPFgYv7ABmOlOjOSuuWZ16HoMEwru0BjXSl92vnJg0e9KLP%2FeZRFYZE8OAITOM95gAK4qWIrKQO4QVS0URsVcFuYgpvosoN3WgAomCMTeAJNopkFiB%2B%2BaQF%2FSZu16eNaqIucUIEeU4cngJse6xa46QNha8jtPZgyORd6KYgTbhYAyZxRbheOOeVTJp1RRga2gBdSnpd38ZkCPuBcNgn4%2FJBRtuVXXgZv4A9XrmW7YuVHUWX3SGb9gEBX9h58%2BzSUxQxgrRfgWIQ%2FwGb%2F%2BZx7ktih8AVs%2FgNfkNNakIUnAb0%2FwAM8WIQFqhdKwOZFuJNi%2BZ53Zmf%2BkAYqSV%2FLOZ2C8AVyDgds0ANsjsp6CYdr%2FgNmfQZZ6FJ7oZL3xY94KN693cYx%2FybjIXHQUsBoabBlgkgFjKbMWLmTcGAGWygX2zmVnaKV3TnpC8ZoqElptGnpgrAFZugSU3GVYa4FjCYVk5YVle7pQC3jH9mPUJ6K4yBqp0g3XVbqk%2BDlo0YHoHBqoRhq9wiC3OriC%2BULvOJQgWmP5nieYU5lY7mGX7YSDjWXrdYKYm5lu%2BKFdlCSjNDqVQagtMCGZxCGQ6u0mmhMilYm16UKYwaYtTYIdbGwYUnrtO6Prj5lYsgGw0bs%2F4BsIVHZqJ7qqN4Io7bsyMTlpV7qpj5qqM7sp4iKjGC%2FDpKAHsMTag5tg5CQ1c4IvCg2XcqtOsZXvm7doP6RGHFtjADt3f%2F%2BZNz2kMr2bcz27aTm7OMGCc8m6t72beFeiGnrgs0EbtlSbddubd8uCNj2mUmIIScotL3ma8gMbd3G7qcOivImDVB2bed2beLebeNGbs5W7lBm7t1m7xr86lC2FfS%2BbuzW7lKtBYhJS0%2BtbdsWDPHObPLG7vre7cl26vsObfd2bfiOb6We74Nh8NWGcMve7%2FLub9%2F%2B71JNlJf87tW1bQS3bAX37QxfbQc%2F6g23bAlfbQqv8Fy%2B8B9h8cyGcafucOz%2B8N0OcdcWYwMPDBSPahXf7RzPbBcn6h13ahkPbRqvcQO%2BcRlRcsoebezucd%2F%2BcdcO8tUeciJHDL%2FebSR37Sv%2Fj2omD2UnP2ooz2wpn3KprXIPQfMXz%2FLiru7V7vLV%2FvLQDnMiN3KnNvPVrvOjVvODYXOidnMO3%2Bw4D9U5x5BCX%2FM7f%2B88D%2B09D%2B0%2Bz%2Bw%2FN%2FBAP%2BpBD21JD%2BVDF2pK3%2B1Fj2o4d3T3hHTqEPVSR%2B8t321Mz2xNt2xOP3Eyd21Qz%2BxX%2FxFSl5FED2VU5%2FFGX%2FWZbPXR8PXgNvUZt%2FTMpnXLtvWoxnXCSIEUCAwHeAENEAxt53bD8HSi5nXLXnYPAXZmR290IPajVvVjl8lkF41ypw5hT%2B2u5HJZ9u8O8e1qF4wXkAdWAAwbsAZ8gIctCPiBL3hw1%2FXVHveolnfqOHcM%2F6H3H1l3om53dw9EeL%2BMhxeNiedb%2FsZ3ENf33eZ3wCAAVugHgAcAXFgHJWAFeQiBlW%2F5l4%2F520bvhndqjheNiJ%2F3Zl%2FtitdvY8f439P4vdD5vfB4rPbwkAfykRdy8A4MNZAHeAD4EMAHSAAAJeiHKdAAfDgEAJiCrT%2BehR9vy0Dvo98Lnh%2BNpMcQoP%2FDoZ%2FaotcLtJ8Ltocre591pvdypwdzqAeAF6CHMBgGgLcBfuADAPgBflCDF%2BCHOkB8fmCDwnAAt715sy9vup8Lte94n49wvY9yoYf7dZP7ucD8qbD7lX32GC%2BGdJ92pwYdEwcMB8CFSwCAwX98OQCAwpcD3f5%2F%2FDkAe1YA%2FuC3BV64heI3%2FuNH%2FuRX%2FuVP%2FliIBeaH%2FuiX%2Fltw%2Fum3%2Fuu%2FBSPIBOLH%2Fu5f%2Fuf3%2FvBH%2FuoX%2F%2FLnhSwA1dAXxEigA%2B4v%2F%2FAn%2F%2Ff3%2FviXf%2BznBUnIAvev%2F%2Bun%2F%2F23foCIdWsgwYIGDyJMeJBXpQQAHkKEGIZfoDDprE2xwY8PgB%2F81LzgV6fjRwAENKBEGSJYuZYuX8KMKXOmzGy2aOLMqbOcrWw7fwItx8RY0KI0vd0yqhQmuGLFwC2Nqg5Msn9Wr2LNqnUr165ev4INK3Ys2EiA2EVdCq5n2qVI2ypVpwmMOrhFmz61W%2FSWN71BjzmIKJjPPXn06P7hG5ZCHiQAU%2Fop0YCv8RbIgh8SaKYOHefOnj%2BDDi0atDdbo0%2BjTo0OWDbVrl%2Bji2JsM%2Bzaocvdsq0bdDFnu3%2Bjc0eVLPHixo8jR242HvDdrJvrxg3dtru57qbXduYbO%2Byk3F2raxb48kMHIc6LG6YBQCh6aoatW9%2F%2Bfbr1lxNo%2Fu66tH7Xz%2FunJhttAIomHYGn9XbgaMJVlZyDD0IY4VfLKSjafxV%2BZiCGnlUHxnUbeqYdiJ95NyI64Y1HXkShNAZACKzIY00RD5UAo4wq4jfgiPyZyNmFJgrYo4YmJtgjgxIimaSSxVHY448gDglihx%2BaKGKP6JQ4IooqCkYAAf8RafAlmGKSl%2BOVPDrZ2pVBmhgliEWaeOSSc9JZ5z9Nmvjkhm5iOOWVVvaYJYhbclmooffl1yOaearZI5sj8okhnCPKaaellyaH54h6Yhipgn72CKiJgm5I6KGnFmqmoqZdySmGj0KZ25WTSjkcprfiKpamILqqoKcHglrldoGW06OpqCIrmKomLrppo0DOJqSsPdK6YaW5YpvtVbtu2OuBvxIY7Iiijkgqhscmm%2B6yO7Ka5pWxRdvmtEQOS6mt2uKbK7cYeksguACKCyK5IJpbIbrpIrsuiM3y%2BuyIsO4574jV9nlvvhdbum%2BF%2FQL4b38BbzjwhgUreDDCpyq8IcP%2F3ToMIsSdSvxmvbU2iLHNdGqsIMf9eawfyBiKjCHJB5p8sqEpY7gyvy1v%2BHKFPetHcYXX3ly1hDkfuLN%2BUHP3c4VBVzg0gUUbzSXSFSq9MdOvxgtpzBtK%2FanFVtPtINYEav0d19h5rSDYCooNINlll5kos%2B0y%2Bq7Tvr4t6czWzl235EwCwpy70l7Z94F%2FHxh4f4MTrqzh7L6b93eLf9t4hXEDG%2Fnkr4d1N4CmY7f3dJoTyDmBnusHeugQna1g2jqvXSHq%2FqquIOvhug6781zJ3h%2Ft09kOHe4A6g4g79%2F5%2FjsAwR84fNbFK3h8x8kfuDzAzT%2Ff%2FraVt0o%2B8plb9%2Bfj%2FiMXa2L3v4NPoPh4y49A5uMZ%2Bgikvo%2Bxz33ti55%2Bpged6jXnev3JXn%2B2x539ha5%2FAPrf7AIIoAFurYAAOqDPEqhA5zHwOw5sDgSBI0H9UFA%2FFsQOBgmnwf5wUHoe7A8I9SbC%2FpDwO1Q7oQJTyJ0VAqeFv3nhd2L4nRlOp4Zlu6F%2BctjAHeqnh9xR4m%2BC2DUTEnFyRsQOEn%2FDRd0wkTtO5A4UoSNFo1HxO1ZUIRZP17ZYvcuLfANjGOs2xumUcTdnpE79QnU%2FoeVPS%2BLx3qHiyJ05HrGO3NFi7X4YtUPKrWZ9dN8foRPI6Fiya4UU1rva2Jw3nsyR2IEkGSWJHUpS%2Fy%2BU3NHj7fi4yap1sjmftM0ga5NG7KwRO6YEDioRpsrpsBKQrpwOLB8oS%2BzQ0nq2vKXNcgmcXdaml7D55XSCOZ1h%2FqaY6hrdwhDnLMXdMWJ5xGTrNElN2FnzN9iEjTZfw03oeBM64NyNOJN1TOgk05PLhE4zWfjM6UQzgtN8Z77i6ZyBJvGgERzluNjZuUQOapGMTBU5VWbOhqFTR%2BqclUXX506GSs6hupnna%2Brpmns2J5%2FN2adu%2BpmwjibtoywLKeZImrmFojRbKrUNS13jUtXAFDgyBQ5NbWNTVP2zOQHVJUSBU9CIrvOnJw2q1YZam6Kq5qipSepvlvqbptbmqf4owynadLo0nsorq0YCKldx5VXYgDU1YkUNWXdj1t2gFTZqbSRbhedWtcHVbXKNE13riqm7viavqNnrafqqm7%2FqJrCvGezRChu%2BwxIvsXj06Vy36liMQdY%2FVRWkRF1IUYGVVHsYLZVGN4ojz%2FoPtOMT7UipFdsSmva0DYXf5eJqpNeG7LcynO25amtbRInUo6Vb7W6uasbWAiehLmyscOuUWtVI9jSUXRBygabcJzLXYM59bkSiCpypXpO6urEuaxdrr%2BB2V6jETVxP41Ter52Xjekt2XrZ%2BxD3%2Fga%2B8pSvbegLSvvSLL%2B43O85%2B0up%2F%2FotwMIcMNEKbGAE70bBD%2F7lLcwgDDn8StiuFAaphaWE4c1p%2BJscHpuH2Qti3Yh4pQyujYN5id0uxlihKE7xY1e80xZb68W5C%2FJMZyy4Gj%2F3xrbJMVF3DJseZ%2FPHu9HuErlLZCR9NzXhHc14RWNZ22DWNpoFD5Qh4oBQHIJGkLgEnX8AAAcEYhiXSMFto5vT6ZL4aVrWDZd3M8Qv68vIb0Vyn5SMPSYz1cmfa%2FND%2BPAPVjzkMesQxzqmAIBD6OMS8BhGitqL2w3qFoCBZpyJKzZkRHtX0Yhl9NQcPUFIn1XSvaP0D%2B6BD0wDgA%2FyCIGXAKABeYQCAGHoBxEK5%2Be2AnpN6SwxaRn7aljPKcyoGf9zgQbtS1vDENeA1TX32uwAa1zCGsAOBbJDoQQA2GAfHCkCP8ZAngBMIx763je%2F%2B%2B3vfwP83%2BcgRsALbvCDx4MY40A4wxsejyhQw%2BESDzg7eDHxi%2FfbHde4hjsw7vF6eBnbdhNEPTyOcXcsY%2BEmvzg7CL7yidcDFGAo%2BcsdrnGO11zivGBHzh0%2BjVJfJhDi0MAwME0Aa6wDEtbQRxE0IgeSPP0Hcpj61Odwh6tjPeta3zrXu971NqDB62IfO9nvgIY2lD3tar%2BDD9C%2B9rd7Pexwn7vW0SB3utN9D20vBN%2F77ve%2FAz7wgh884Qtv%2BMMjPvGGxwIT9oB3vJ%2F98ZCX%2FNz%2F9wAGHzie8m%2B3u%2BbhfvfOp70NBeASEfAxhhBYAxfrCcF6UnCPSzgd6gB4wRZqb3tBJCL3ut8973vv%2B9%2F73g90AD7xi2%2F8RPjBD8dfPvMTgfnmQ5%2F4w48%2B9Xmf%2FOpjPxGOYEIbHOH974M%2F%2FOIfP%2FnH74fyoz%2F96vf%2B%2Bdfv%2FvdjwQqOyH71r09%2F6k%2F%2F%2Fs13RBuYMH%2F9N5%2F9ASDz5d8AHp8gjJ6KBMI%2FGAZikFoKrIcDrEMopAA%2BBAIAKEE%2FbAF5ZEY8uMMHgmAIiuAIkmAJjuDAmWAKquAKuoPCseALvqAHQpwHwmANmmDF2WAOluDG6WAPgiDIkUI9%2BKAP7twQ9uA4%2FxCDEepgPQACySlhDqbcE9ogDkohDMbczFUhDPJgFrKgOhQhF6pgPGgD0EWEDYTBGV6EEpSAPLCCBkwBP8jB0VlDCUACPriAs51JqnXQqqVOq00NGGgClZQLuX1HNgDDlcQDIMhaaNHap4BbE4lbZhEiDVHaQ6TeQ7ABPsjDrwXGFCCGPlwgHq5KtDnKtAmaH8pNIF7JmrmGISKiIloOfxmXf3mI%2FZTSJEZRJcLbC0AE7RUBmdCenfVZHpIitDxbH1abvagisVyJK%2FZIIi7ibjUisDyiGkWimuGiG%2Bki%2F5waDumhDvHh%2FCRjrSzjqGQjdDijiUBjLFbYLF5YLRrSLf8ayzZmUDdW0TdeUTieDyq2TjkOYjMe4jPCYvxcSZmFxpllxzXWBiumBmdx1DF%2BVjE%2BjCmy2jhCjj8SzDk2RzqOyDoS5DSGSzUCk0J2h0aGEz3akD3KET7SkT4SED8yD0biD0C%2BYjSqGkgCjEh2E0m%2BBkOihkOajUo%2BEktGkkuGEEyuj0wiEk0KpE3uIU5%2BjE7iE0%2B6hk%2BeBlAO4yh%2BZClC5D5aZMUoZdiY5G9wJIh4ZHEp1nHBIymt4ljWFEpOkVCuElG2klH6EFIiUFgCjlvqRlluyFnKYlrSoiDCljzqD1zCkVwiE10qk11ukbfVRqGhESAS5kz2iF9iCGC2o2D%2FvmNlmpdhKhIZfphiAhRjCpRjVhJelpBeXhRTquNAouVoDaYttuU8iqaNkaZUmSZVoWYsqaYQUWZtXmZAvqZTgiNU%2BoxUxhRVqoZVjgZWiuLhSKTLUCQy%2BtZPsebu8KVtYGaFaCaLuaOLrWVFgWZG3WaU5eZ77WZ89aYz%2FeYXZadsuWZHwmZgymZn0iYzHuZ52paU1QaVfZWVvQaW0RNkwoZkUkdw6qeJdKeCfOeRhWeSjWdhCmdoGhh0EeNWGiNyXhJ2eqZYzqdZ1udm3qd4fmiGlWepBINDXKipdSWqTWfTVKc4XudcxWcFbWdtNOiBPOiiRWijTWhypei5rGiL%2F7pohsYmdb7oUX7lH97ocoXoX44oeHKmieanOdqmkQJPeibYei5YexrUe%2B7Rk6JXlGbmlEJolUroicLYkKoXf26Uf8IGgOKVgLoGgbaUgb4GgvqSgmLpcNYkO1Jpia7plf7jfmrpgXFpiHnpiEnbkt5lk6Yim2qnmXonmvqomgIppT6amxIYnDKSnL4GnUaWnaoGnhqVnroGn26Tnx4qgxInfRpnPnKoKAXpZ1aoeSbq9ywqjjWqjoEpVklqP3Iqjlqqg2LqrP1ord0qgHlqh4Gq94jqfvxqlQXrdYlpLZGpgB0rjyYrIy6rIzYriuYqbUUrN0LqSsYo26Rrag5rTP8WK5QCalMKapoS6qYaakZmaaJOq2qQqmpda329a1LGa5nOa3HWa6beK7MWrDU%2BK42daz2261yuq%2FHMqFfWKGNt64Z1K4H0qLJqKsPmq2VaKL%2F26pRVa4AG7IMNbF42LMcerKwmLMgurLi%2B7E4%2B7JNFbEpO7GJWbPlc7Eu27GrerD7lKGzsqMd%2BqzSGKzWOa5uWa3PtbFz2bGn%2B7IGgalipqmqwqj25qr7GrIjOakvWKt8op1IxZ2o4p2hAJ4ZqZZLKaNUKa8YqY9E2WccCyMeCa8ja7MguJaKarNyq59UKUNAyKd2So91GGt72h94yLd86reKWVdqixtqGhjoUaeD%2FIql9KmnZQhPlLsjXkuyIJG3eLu1NNm1IPu2S5eyksaiW9mtq%2FCt4mWqAGG6kIu5FSu64Ma5%2BOC7qQq7q7u5lge5oWC5otK3oCG6XEu4H3e5jZqs0bayM9e53%2FO5Tpm5Orm6nRu2b7mrsosbsilntokbW6tXWpkbXvpTo%2Fi2sBqqG1mzk%2Bi2I6k%2FmqogDKMEU5G8IPITUTQGZ%2BC%2BZKO%2FmkmjnZu8IFe9Bsi%2F9ui%2B9wm9v4Wc8du%2BnFgq98QM%2F%2FMMGboE%2BrMM%2BtMgGd3CLuK10PnDcei5CJTBoCMf0Gm31csf1HucBJ%2Bf23lrr7hp%2FqgE%2BKMEL2IAGNIA1qEcg8MML%2FxBAemhAIOwDL44w6ZQwu54wdKgvUi3wXrowdsAwrcqwEJ3t5NpwufEnJKxD7bWeBQJAEWhgCYBiGWsgB57sf8ZqAZtwFkPiT4HC8GJjFU%2FHFZOtHJstDYdbF18QlB2dPogDPohDCmjESPQAP7BB7HnE02nAC0iyJOPAMXjDJWNyJmvyJnNyJ3OyM%2FCFJ4vyKJPyLTgDKaNyKmcyE%2BiCKrvyKGdDLLzyLHcyMBQDLeMyJp8DGEhCLvtyLGSDL%2BOyM9iCMNPyOezBHpyDMc%2ByLZwyM7tyLEPzK0sCGCzzNKeyU2CzKgPzNqMyYHAJAWzBFDhAEezDIcSe0zkyHGIgnf%2B58yXYAi%2FYwjzTcz3b8z3jcz7f8y3Egj778z8DtC0IREATdEHbghFkAjAY9ELrcz8z9EPbcyw4NERDNDFkgSQQA0VT9ERrNEPzAkd3dEETAx3QQUaH9EIP9EmjtEobNDFIQhaYNEsHtETLdEGDdE3nMzA0xKk4QDqwwgvoA0cQQT%2BEQQrImxqHARvbsRuXjjeg01Ln6bukWavW8QQrSOk27ulib%2FACjMxB9WtMdXdkDpSFwDBwxAvgwyFIIKapAT%2F8wFoDABu4dXQyMdw6MR9%2Froda9YFgte9qdQxzdVT68Rzvtc6GcyjwAyuIAzzwIh%2FwAy7QAy58iWPjwj24ggD%2Fb%2BnyMmrz8tDzumvuguVXV%2BXRvkZfW%2B9fY3Fgz7Boq0ZY9yRpq8bgOAAbwJkSE0AYhEIg2AcBjEFu28cSlxNnZ5Fn%2B%2BbQAicL323YSunYFuUTu9ZgO2xhT9rUJqZm%2B6pw25F1Z1n0KhRyL65ynylz16VzL9EW%2B1UKg8bxfkbyHunbcm4cq3aH2ihrqy1sq4ZpvzBq73F82yp9o4Zrj%2Fa%2Bwm4bz2nK1unK%2Bhh3b5d35xoeQ4ceNzdeW495Ey8gUyJ1pxKBj6qBlyqCb7dxw6d%2Fn4Z6fwZ%2BW7F%2BRzh%2F97GIjwaAN6d9%2FyRiZrh2%2FyeHA%2ByjkjeQ6fWCku4bL%2FfM7m38%2Fwrv%2FFIx4A44jRc4dk8ScbsniI8pi4sGiXuGiecxio%2B3hE8UdI%2BkhecihhuThlOrkr8Sk4epk2srlIeGlHcGlT%2B4lTdmjqMRhaMZepMIjF%2BljH85km%2B4mDMTmc8tvez4nzYwwjZxRc6mBPO4uX4vmPurjdOuh7MtCf6LOnwgkkfxWE1xa4L3pYo3eFR6aHDbbaBvZcl5QnK5Nnr5OOl5mBc60K56Z6hDOCzCEwyBEAzBEfwBNvDCT5ZBEARBKdD4pfNVphPIF36gvrnDq0%2B5j4c3kAPHFfg6sINGqIOGQaqwnI8gRP4VpSf7awu4kYpqsofDuKNDPEQXgI57ODw6jv9%2FzDPkAALAe7wjwAnoQVeqAAIYwCIstbBXFrH3DjYgQRIIfBJAQR78wSJgg4izeXNA%2BGvce75XJrVnyKiTl5YjrzpsQhcMfBcA%2B7OZlTtMgsDHAaSq%2BYnguarTEDoQQhCoQMvngB0k%2FGfkmDssQstDwYtK%2FGeYrzo8wwzIuwdIgLwvgrO3ALxPwr7TeWesMJp7hjoIQ9DLe7ybwCY4O3AsPHA0vGsUPQIc%2FbQ%2FizpAJNg35MV3xpCAvbJzyBbHOhREPbxXwTP4mVnFgx0YgAEEQbyWPHtndhR1wxG0PQK0wCYI4swTArznAM6T72nsvBDEexKkwjPUQhx4ALyLgDD%2BbEbHJXuyM8fWd33H6RtnIHtwaL5IqYO5U%2Fo1bIfn64jqHzfTw%2FozWMDfw7sFCD6AXP1vZL1qcH7Etwalo4MwwH23w%2Fp1CEM4JPvZc8bZg%2F0zhMNmUDrPBz86SMfzP4MwdIPvDzk%2FhUMS%2FLy8B4FoyL0dwPsR4L2dP%2BfJ%2B1OvqkM3BEG8W4AOTD68e4Dld4Y3AIPYXyXyckjhI8DhrzdAoBM4EFi2gQLVHVQ4MOFChw8FRjHWEGLFh%2Bo8IdBYxZ07dermTZKgsUy8bnHI5AnGJYcbYTM0TvJIiEyZMsK6uSHTB92iKjrIlKLorlacJDnIVLr28Q8ZMpMaqqP5lKL%2BRavo3IHR5O5q16vqnlkgWcqToSojEajoRlFdvI%2FxuDKM51Zdx7h1PcJFlw2YV78W4wECFO9v1xYx4x4s6C5YmRkWRATpEy5qODs5LLQgUytIjip1L%2BcwBGVDi0Um4%2BTw4CHIInTlbqmzrNrCiSCGPha%2B6k4TmMSF49nRiGCIJ2ybcgwndBeuu2vXfqPD27aqu7l1684TjuBIYuvTFcam6%2FZgW712yetG2MwBAPfv4ceXP58%2BgATNqqp3tx1BFWFgy9DIgCvicoccW7oJp6OoFqwrHAU%2F4mqtAgnRKIeoCEtwQYGAIWdBjyZkqMEMO1IvoolMfCieODSyIJjqjrD%2BUB1pLDAgs%2BFKgQmBSezpQ8Au1BEGAQNOiNEAjRbIgyt3FhFrOAagCCceKAwwYIaEwNpgSEOiSzGrrVIsDCwnDbGno3kMGW6RAmux44gj3JhEOumEcSPOVKo4whDKwvEpiDJc4ytM3QIbbFCHDtuxyw47EWG44Y6gTLYYBbRSASvbquJIJw34A50gHtUoiXJ4QYfSUMnI71CseuuyK3W6OUFU7OKRxlEJuljSlz6SCKIJMUrxTpg%2FnjjCDlkS%2B8POVf7485k8NOpOOnUmcSOILgjpJjF1eClqCDg9yU2dWuzc06wk8nhGVa%2FUYa%2B%2Bd%2BGd7751%2FYJVBVE9ks4dIRD%2BMOEzrDyRggURWjBWUlne7KOWKlqYgYwE%2B8ghskUScqdCBC7EqpYuJIYhiTKw%2BYgWJI5wQhg7dIjMU%2BlqeTOPbsiY4YQnoDJRInpNdCcJGRWKxw2NTggHGw9CncGcRDfxxMlI3RHGSQREmAGtE9ZyWiMRYFBAozjmKUUjCWqpaxGg11oVK61cNXuhMTVaDiF0EuVIujKejlZddyapcgZHEbAAG2l0CPUIZohRu6tCCTMcbsQWIoYWWfvOczgo2vpjuB04Hu7CeK4YboMTPOjGx8ihcBIPYrxGwIM%2BfBouFZxzblW%2FSXD0jhBCagkHq0m0fFSCP5Y0hOjhJHCjoRb%2BjkzUAEIs5y5fKIr2hKuEvKgbgSsmXOTIDUAdTgSh1Gu3vXjJh3feMDEaTiaGgimlbLzRejQIBTfRyIMNjtQoiCCqHI5Li2WkjlXw7VE5wIY7KqG1tAxpOGXoSP0Q0ALk5Q8BwFPPzQynjsAhAAqJGwiTvlaLbgxPBZ2YBMUSVYbeReojVsPYM9yRJgQoIBXzIINGhqAtkUAtZBuMA1yeoJEuePBQX0qb4hASlrZ5B3oImAFWRtc3AuagG%2FGA4HAMwJHuSaAFThJCX5BYEcQhMVHrU8gyxGA%2FT8zDHSzSSCfckRzuoGMe6JDj5jqHgA2kohulCMe9EFAme9DOicD%2BuJgKPEFHO8RhEt1AIm98ox8ZUq06%2BQLL8Ag2PKoRxUkiUIEC14QOHRHvWdHqSIA0ogJM3g2VeuSbASgHwuGcAHIISALsKiK%2B8u2SPufzEgQ3oK7yiGtoGqGBE7qHgFpYkXi9UiACTpCE3umgLRe7kDlmkDwnCAEtp6kEA4bTAifwzQLCYOZwgpAEJz3xgihSmwY10kGFAFCPOBleHMzElcMoAC0woAydnHQadRRTAatQh47iIA1hPENHpbDHdi7UjVsFS21GDONFlIgAtwmEcxq50jOGlwSc%2FAEtebDHFWeQijysghL2E4on%2BFaJI4ZxjIorY5eIwQKS1PEjPkT%2FB9%2FgiI54NA%2BPGnGCW%2BKRipEoIA%2BLWIQhtJQBW6TiUTMjxDPmgUv9yI5QqMzYRTbRAg%2FMQFu0qIAeYbgzBARBGuoYHTtHaYdN%2FHA7R4jHM3pHiIF2Lw%2FzqAVauvAMbPwsJvMYWzwdWQWyadUhuuTlY9%2Fjy5xtJ2j0AssVgrADYNgjHnKcxDyuWKZwQK4Fz7AHtHgYD2sOtAudMa09KPWHeHxTf%2BEYJFpScU4EkMEdPdJIMBm7EAy%2Bs3tfHYjPgCa04ZlxcY%2FaQNgAigCwfQSkM5QFNnonAe1KQIGEiIcwtCQBX2TEiYqz6EXXltGNClWxTsSb%2FWAIkvbewB1X%2FKx1%2FtoLhW48IxztjcNMkVhTw920cTTQCJcE4g4nbO2nGgFfDGXUUQQMESstxSIFESDTLoSqb10IIyQBDJF4tNe4DDHxfvsYhwxoJJGQW8R%2BhXGrF%2BnIrh0JTrRCArRnPKMbzQvCPNzYgmm5g1JQsMdhxduRTixWN46F7GMlqx%2FKlo0hbJnLMSpBiCr0rg8nTW5dKFUSdchCa8FUbQDjMY9u1GIRXTCBRrhgD9oG0i0EXcU5FVALj9SizMIszHDNhty%2B%2Fac83btSMRHwuoEk6lFCwJLVJPCiS1oXuzO0wKUtsIEKWOCHRNZIHlDpBiIWEW3oTa%2BT1ivhGQj6q%2B%2BFJjog%2FijeigVRuhuwNVquMGpTC1Uwuj4UgRWS0wMnTmcM5htF4yHDok6YMPX9mg50kAMd7C8HlYDLJKBAwAOHuDAg1k%2FzRNDWgzyIPGCJQxC0RMFJBAMtmbY1KN2hIy4k7sbcsYcbJWDrDayz2NejtxthIEu11AWClGyyu54MZfyEydnWZQs2aoEVOlXhzf3TyB%2B8DE3KeBoBdnALn9F6ZoxRtwuftPiE5QxOBGzCI3id4Z0hKIK1CLDPwVUIoFflDvIiwAkjat5u5yGN4SlaIIkyTe%2FWFCSxRJq6RCsoOgC5CGwIQxmVoAWPsXLYGdzLAtCtaKl3zRD1bmuDRvZqQ9yx%2F%2BRXQ1AF%2F3QHrRmw3e1SOOzH7TUZY8LZuczFHcTgFwez6g6Jtg0dkOuCmeJBqWVTWB3BEEs54fKMSdQCG7wQRioWIUJPxAFyR7C5V7ytG1lKYBWJiUcXWtAFoTyD0SpAwooR4IlaEE%2Fu2l0TQuld13trJO61D51az5B7jbRAHVpPcMGp%2FBcnJ7x8UW7yKtBiCA%2FGgwwLyEEewAJICwzBDjrCeME3TimPj6vPIs%2BYDo4kAR24YQhCTLl0%2F5Oll5%2BzsjRH6%2BcHgnOzJfMJ7jsZWjxAGNxB6DSC6JprEezhhiKIMiBN0qqLhuahiW7JHmTBA4okbOxFfvBvN8Cu7tgmkP%2ByCiQ8AS0IwR5kqO0SYh4I60rYzu1o7QqeIReEQRZqgRZsoe4OQsDUJlGw5Q980AcXgRj0AEnKoBZSof1CLo8koAxKob1GTsLoTpREZS0UkAZsIY8MqCOaKFfMi6vExOX87S2EgWgMIAnsgbBaYBPM4RpQQI%2BkAdEM4RmCoRZKoRawTkdCSah072JmQBiCQRhWQRaCQV3OLiHiYcE46Mg0AgaOj8nEBOGYr%2FkWblB0pLSQKhjIcAfeoXlYQKbsYYO%2B78s4bvxAzsysKR4I6XvUwR64wP1oSwLiz%2BUKiv5mbhVqTjf071Aab3iuJn7obEaGjiLK6Lv4hmsasOlmKLf%2FrmgHuACQVCBkhKqVAonb%2FuK8PDCj7EAOg4EQIEcEYOivhOgjBmhrMg4FoSiVTCscdKAFdgARqDHQ7s6mOExARMAWsuFUVO7TPGIM5%2FEJ84juZAmaWkCB4oAYlMZ%2BcgCQFKULI0k%2FWlGIcCIVYOBrKGEekJAM7MEeKAGcJCBY5KgL5sEeSuEEZqAKQgYP46Le7KoWOHITMpIMVCAH%2BkC39EodDCH6FBEBGBErkG8DpQMSIzFenE%2F0ZMiJFgHzGA0BNwwBdoAY6mGHKijjKmsUP678rGkemqft%2FIpvDu8VY1FLZrEn7Q%2B4cNGdMkgWRulRREAPsIRGjsQAT6BK1iQe%2F%2Fog%2FYRBSDTCF6irRhKtLgiLgfpFFqJCqexH3AzHGsPuA%2BWOeNxROpywYZzkGc%2FJHMGCbzQjmWQKBzkqHgesH9PCFryhG6DAFz1ASTgqFeQIY5Zyc9orCtXBDsSif5aQVPBmePrHAoznkbxQTLohNSXgBPIRCqxDATfADeKAgHikKIWADGTFAHLAHKQQAfJQJT2CUjagC5JgJJaHK7pHAWZAajTiBqrosHay4QzuEccnKIVyEtFHGn3xMyBMI3bACZ6my8APzDSCFK3SQuIhdZyoCnixKznyK%2BdPLG3x%2FsrSJ3ejGwgBCqBt2vLgGEpFILrBDuzEz9ChD%2BwEA0%2FCTv88oUPdABor9EIrhhKe4EG9gBZ%2B46CM6h39AjF3LUh8US0RIXHAIpmGwwRYDm%2BqRAT%2BqcI4ZTjwYBk0czMNRXFSYROUdEmXtBTs8SNSwULd4A9gCCFk4RmEwRM8YRN6wqM%2BohaU1OsSrE3sxA2CBTawYljK9A8E8MN28ws3SHBmrhZs0wAUYMUMwOPQoYkAUwT0DG7kMiXjoEqCYB%2BVJ3%2BAhE50KlRy4G60xwBUoBENIHR8cvnUsz6GssnUwQ2sRwKqQFLCoYmqRAJgwgCC4Jx8tC6EoEp%2BaMy%2B5hmGSm8%2BYimrRAECx0rQIYE0wgGdRBmvZuaoqm8w1C9y0Wym4yP%2F6gJNP%2Bg6DsI60sM8yGPvmpVZE8wj6uIanAEh3AG00IISXBT0OjAxu0EMvsApzJUMrmpFzWERguA7W6JKx8Up4kB3PghPvnMGaGYcwEgzddBY7eJf7aIgEGLv8iXBhMACPOAIpMEe1KG95AY8FAJayUNZ64JgFXQ33lRMwoEQhuBej8A1ogJhvvMIGqESnKIme6Jdv7MM%2FMwOnEIwEWITThZLnqEMcuA7dQBlpcMW8EBlc8AOyiZeycAOECIY5JVe0fNS1%2FNiF4Io4qAKrqAKyuB1KiMPpKAJphYbnEpOnmFrEcITnIpDnWoRGNCpuPQjzKIKuqAT%2BsSpusEWEMFt%2FwWibaUOLLYWOgdqbJH2L4oVvZS1SIshW8clCbZs%2BH70MMO17niBHfbOYh3CWiPEyvQiYiG3IwSlSPs17AS2ItzBDfLnBJxglPLQL%2F4WB0MvRbADWesiYpHVOaAjPbBCdQsWK6h1YCdXX2RXIRZXdiV3W%2FjORCxVaeUjU4HXWWtXW8mBGOjCLvSlRLR1dpm3eb2DYLGiRDrEeavVkqJXem3GLOuudHEwcKUjGC5FTb4VXMGkSG%2BhHIp0L%2FYVBzN31zYXIgYqNSnICdQDfMPudHHQGbK1fde3SINXeOGDeNHLG26wfedXM%2Fv2ovQ37MQXVvYmanDjomA07AK4SC%2BXX%2F85EwcX%2BCL6BAre5AiqgBLmpDAe2NT4t%2B78t33RIYNxcIAJ2D0M%2BKIQ2IU%2FuO4aOIxS2NTEl0K7wZHO90UTF4PZV4Pft%2B7i19RyuLEAFntR%2BBbad4XDroUB%2BIhjGChnuIDZEwdvWIENon13GIl6GL1%2BeFqYtisueNdgGAc3GH47uO6a2NTK2E0bUjOtWH2x2AO1eItpuIvr7ouLdI5NbYwVp47D6IxNt4jZeI%2Fr7o2VOI41N4w1E5EZcojDJI81s40Ts4%2F9uIbDSJA1k5DRy5ANx5IVR5Hrbo1NjZPDDpLDbonRi5R5WIqLlIp3TZNx0JVNTYZnGJSRSJQ9mJIZ2Hv%2Fww6VDUeV95eRW9mRXzmJY1mS5ZeYv9eWNROXTU2X646X0cuXH6sB3gWYFUeY5ZiaddiYdw2Z1UaZd42V0Yub0QuWd02WL4qWydiaTTdjc%2Fl%2F9ViAPfk9UoAVXAEXcKEIACCgCbqgAUADIEEcXMEGegmQw46cJ9mFTVlt1Nls2FmFmfmdnXnX5NnU6DmM7PmQ8XmV9Tmb%2BXmTP7qb%2F9k9poAfrGEYrEEJAGALZJqmbRoS8CEQxMEa0pOL01g3KHqaLRqd6fik626j0cudLwqeLyqk0WukkaikT1mp2zml0Uubjdifg1o%2BAkEeQgA%2BAmEdNOA9NEAeLuGm%2B8Ggh1ei%2F3etqJnYnMPuos0mo1eFqS24o5%2B6peMZmudZmue6ffF6ULB5q1d6l%2F06jLyZFehhGIYhDNzDsSFbsm2AH%2FgAAICAH9SAPpoBk1PEGwBbfr3hqEE7f7F6n6cYDEDhtNUDqsNIqi%2BKqhUHGEq7SAub4UDhjvs3sbd5il%2BaAHDBGviAFfhhCgiApvnAFfhBCS5bDgDgB%2FhhDgCgCA7hurHbFoBhu7m7u737u8E7vMHbFmJBvM37vNEbGGLhFtK7vd0bGIwgE4rhvelbvMu7vvHbu2PhvvM7v5chCyRhvvs7v2NBuwccv2%2BBvw%2F8vZeBDuhgGRa8vtc7wumbvCn8vYtBEv%2ByAMIvvL33u8PdW8FB3LxpIQHexQHaI61DAQBQHAA%2BQK2fO7r5AbpLoAhs3MaVgBayYcd5vMd9%2FMeBPMiB3BluQciN%2FMiRPBtuoRiSvMmdPBuY4BWefMqF3Bligcqx%2FMe3O8u5PBvGAcC9ocuzPBacQcyxvBjs0cynfBz2YA%2FGQc2n3BaYHM6d3Mrp3Mm9QcPf%2FM6TfMv5PMnJ%2FM%2BRvMTrowF%2BoARYfB1YgQAOPdFDIQXw4RAAQAn6YQrmgwA%2Bu31FG4dvu0glwrWj2IW5mqNb%2B4rbV7ZpSrBnma6Teop3G9QLY9Sb%2BZZfmgPkYRheIAw4O61xfQw4O7nFwQYuAR%2F%2FUkBe4NrU5HrVj3qo%2FyK3w0SvP4yvwwi2kQjVA0zV65nV%2FTa1m1qrL0rWPdqr32UL5AEf8OES2oPczR3dq3sd9AEfOtvYmf0vkj3blx23ud2MfbudpR2JqF1xrF1xaNtwrBqj892OYf0vwL2vxf1dQqAIIPo9Hj4G4EMDiuAFMPXYDziBB1nbSxmpt92Fof2R%2Bl1x%2Ft1wAt5wBl5tCv6uD143eZuF972RG96PhVrTOX6UPf6i7HpVnD1FRt68St5wTl5tUl5tVt5sWt7nX%2F6S23fhp32xkcibhVecDafeSXrnw6jnD%2BXnTSToETd9WfrUR3uqsT3rCbvpD9Pbwwjq%2Fv1d6hWH6pXW6tUG66ta65GI6wfF69UD7L9O7BWb7Ns36Vdl6bte7SuK7ZHI7U0e7jPopQmY7s3G7msb7xVH78OE73XD783GqaNe8DH37O8%2B7adY8RWH8Yne8d8J8qte420454f53isZ8dd55pt66NWm6M3m6OHxSHWe9G%2FZ9A0H9XNf9Y2V9efe9UMZ9stZ9nFQ8wuD83MO981G91eF91eF8A%2FF8Pee9nNO%2BNWG%2BKvf%2BFdF7i9V8leF8gne8g0H81ME%2Bv9C%2BkkN8LeZ%2FK%2B%2F7Gdb9Csf%2BK8Z%2FM0GIJw5Q0ewoMGDCBMqTHir3MKHECGqa%2BYAgMWLGDNq3MgRQIJm%2FuoiihxZ0JstkigjAsuWsqXCKMZCupyJrtwtmjiLDcTp0h0YTe54umwotGU2YEVTxgMEKF5SlCufkrQpdaQ7TWCCVo0ocKtIol4XTqzYsaxZjR9lhlVocu3DqG5fxoyLkCpdhDrvHvQJVK9BsH7RHQ1McGlTwujgBrYb%2BGpWxF0RA9Y79qzls2kRt0WsODBMtXoZB85LmK%2FWwJP1DiZs2CnhzqFvlsZ62m9kwqnpVr7Me2Nmwptfs0T8mbBov6Qb%2F6ytNzfd1YFbcx6%2BWHZj2pB34nYYeHfv7xZ%2FBw4eGLbe4tURo0vu17Rk7oGh%2B5UuHPHxu46Z372NGj5liuAF%2FiieX%2BT5Zd5d6Pl1313s6eXedojJpxd95VGnoHXtYUcYf34555Z3AfI2oF4F6nUgXQnGpl6D%2BC33XoRIscaUaxXah6GDGgbGYXP%2B3QViiJaNeFeJd50YV4p3LUgXi3Q92B%2BMiFFooIUqzvbYhto92R2AQIoIkmYnTaceknQpGReTcTnZYY93SXiXlCZSmeSN%2BOVoW5ZrEvZjl2UJSReRdBnpFplxmekWmm6pySOUMh5Wn3F0NmmnXjve5eFae%2FLJkZ9xARqXoGsR6pahayG6lqKWsvlcjNHNKCakiOWXnXqXhpWppmh9CVyYjxIm6lqkhmVqWKjSVWtYbtIFZ5Fy%2FpYZaZqT7ofnoluShWufuo7Ha43EzZUeYsN6VWxcx3qVbFzLBtpsoc8mGi1dlRqr6odcXtsRp2556haoYf0aVrBehbvVuG6Vu9W5bqX76bqjtnvqu3HFS%2B68mNZrr2%2FZErjtlGN6e%2BGK0zbpIoSEIbyWwvsyDKzDxELslsQFU2yrxRdnhO9a%2Bq7Fr1f%2BegXwVgJXRfBaBldlclgo66zyvyyL6%2FJaMBMts1e31nxzWDmHtfNWPW%2F1c1VBSzV0WEVLdbRXSWu9tM9ND%2Fx0WFGTPfVWVV98tVdZe7V1VV1X9bVUYT81tldlP3X2VmnrvbbXbQv9tldxEz53VXXbe%2FdW%2F3lvtbdUfUv191OBJzX4VoUndXhViWu%2BuN%2BNi%2F34VpGTPrlUlV97eVWZV7X5U50%2F9XlSoRc1elWlF3W6VKnrvrrnrQv%2BelWxEz%2F7U7XjertUuUu1e1K9J%2FV7UcELNbxUxQt1%2FFPJa7%2B8782L%2FrxU0ZM%2FfVLVa3r9U9k%2FtX1R3Rf1vVDh48n4nlI%2BnpwvKenT3%2Fq81z7hve8p8SPg%2FIpSPz7dLyn5S8r%2BhNI%2FofyPJwHEyQCTUkCcHLAoCdTgAv3XQPE9MCkRJOEEhVLBLl2wKBksygZ50kGefDAnIUvTyLQUH1bNx1W9%2BpiV9AOvIE5MTzSr2UVuKJQcCmWHOOkhTv5%2BSJMQ0mSERSkhTU4olBTqcIUebKEAX1iUGIZxhjypIZCoyBMr8gSLNNEiTbg4Ey%2FOBIxCEeNMyMgTM14RjT5UowjZKBQ3BhKOOJFjiOiIEzviBI8z0eNM%2BOgSP%2FZkiHkqmREnhERufes6V9KRE2MGRWtJESOUpIklaYJJl2jSJZxsiSdbAkieCNIlhMSJIe%2BIyC0q8ouM5IkjfQlJmlTuBXXgwwouooRAhMFa1dyCK2GZMRJtLE4dA82cQBYrUFKriFEqJcdgtcRZvahaZSkCPdYhD3m8AABh2Ic49HEJAuBTn%2Fz0Z67EOaRvMiuc7CTMLlPSS5z80iijfJM6wf6Z0Ayl8k60auZMqkaAYVjDAS%2FAhRIIIA5cOIAP%2FLABSU2KUhtgjKB%2FMqi6EHrK0aySWOZMFaNa5ShTKhGVTIzYTeXWyo6kAB%2BHsEERKvICfQQCAEXoxxZS4FSo9iMMGyFAM%2BKhjq569atgDatYxwpWd4yDGO4gq1rXulZ3EGMcaWWrXOfa1ShQg6t0zetY08oLvfpVrO64xjXi%2BtfC1gMMoMBrYQvLi3IQdrF5NStaIfvXegBCEPWgrF%2FdClfNRrYcvHisZ9kaD1CAIbOjnWtgB5tauvZVtK0VazymsU2M2AAf4hDHPYahARvwQw4A6AE%2F4OBb4P7gtwAIwQ%2BWu%2F%2FcIlgCFNCNrnSnS93qWre6mpDEdbfL3e6CQhLa9a54x%2BsDR4z3vNzNribQy97qgre98I0uKZgACFLEN76SWO992%2Fve%2FbKXFGAAg339i97%2BEni82T3weUmxhygMWMHeNTCE05vfCXvXEgXoiA30YY0QAGEfciguAIor4uMCVwmQSHGKDxHgFrv4xTCOsYxnDIYs0PjGOKaxjXPM4x6DwQdW8LGQdTzkIsM4Czs2spJ9wAQlOznJTh4ykqNsZB%2F4gMpFnjKWhQzlLeeYCVf2co%2B1LOYcd7nMM9ZChjnyAnxAAgAkvQRVnxrVMKRgH3ywKlY1EoCtuuPPgA60oAdN6EL%2BD%2FocaDW0ohfN6Lcy%2BtGQ%2FnM83GHXSUf60oZmR2gxzWlCC7bToAb0YUlRj1CHmhfsMDWox7EMVXfasph1NaeXAVdZX5odibY1pOth2lLrGtKf%2FjWkUS1sRsdDG7W9iAOs8dGjHsIB63AFAeSQUmizYtopfSmY1FPLltyyJblMyUJR0lCaPDQlwaTJMC9ZzD0e84%2FJxMkyHapRl9RtC%2FpMBzzuSe1h4OPaAKgDP%2FwdCoHarJsF5Xa78%2BixKil0qAPLqbx2esSerrOmOLoopSAuu6LGExKBuCectwAJOWjAIgQguck3hfCYKpymP7VpOftCMnQ2ikYXj3nGg%2Foyjkv%2Fz%2BOv5CZMOyXThcHc4TIvjcSfKMp0WpyiGK%2BTxqWVUaAHPTwtJ%2FrLuzX0lZFT6TQnol%2FSPZN103LhuHx3T%2BJNk3mbu94tkaSAsp6voqfs6OMEl88Ft3RWNv3mr4q6pKbexKrD8%2BpTpDvO7K40vDvr68o\
JeyhtzlOcQ13nUuc51PYuQatfPZYzmeVMup2Sb6ck3CgZN0nKPZNzo4TsLjH76NEObrXzku0zcXvr4Z4SuYMH9C4RvUtIjxLTowT1JFG9VfouNYqT8ukHrejO3Vnz%2FyRbisBvifBbQnySGH8qttcl54XHfKL%2BvfKBx%2FzgNQ%2B38b%2FR80HPfkq2n5Luj%2BT7%2FiNB%2FkiULxLWD4X36BZRyjJR0Sd40EJ4QmV4fuF73yF%2FKEF%2FUEF73tZwefdwM8d%2BkuN8EgV9MyV9mUd9YucjUfRKDkgSEEgS9icS%2BCcS%2BicS%2FBcR%2FtcSrkcSsNcSsjd8Enh84UduuOcSuvd%2F8EeCioc1jKc2jscukNce5ZeB51dxlleA6neAGAg77vdIQYh9Q4g3Rag4R9gwSeggS9hxTfh8T9iBBuguCNhzCmh9iJd4Xbd4W%2BcrFPh4eneB70R5Tph%2BSDd9WLKGInh9VpOFmLOFqtOFXleHYDeFPzeGG1iGRueB6weCk0cZwZAAbYh1b0iEcegZc4iEiBh5iig%2F%2Fxo4gBz4iGf4MGm4eX6oG5V4iR4hiLhDiMpjiEzzhS0ieec0dgKILgRohlGIhqEIQVXITHoSDIBoN7CIPbKoPrTINrYoMrioU4xIio54d5AohZKYi3%2FoiiU4Eic4EikYESsYES0YES8IETGYEjM4EjWoFL1oir%2BIisEIQ8NIb1cYiJmohZvoF%2BMIEeUIEef4EOmIEusoEu2IEjfIfTkIfrHSgy3xgzIIgCTBgL3RjSLxjSIRjhDRjw%2Fxjw8RkAsxkCRRkBFxkCSRkPW3kPm3g6vnkCkBkeookSNBkV6Sj4O4j%2BfRiV74iUoYjRM3jbxYitZ4ii2Tiu23inFBk5dhkf8RgZEqoZL3p5OHaIGJeIe66HTV2HjXCIzZKI0LOIJYaJOxiJMIIpW1yJNg6JNMh4dkqIcVaFHz2Eb1%2BHb3iIxiqYxkiSJm6YxoeYtxaYVAmTDvOJTxWJR%2FqUxzuXvFeIyWk4z4s4wK1IyM84xCpJZ%2Bx5aN6JZ0CFRd%2BZNfyZi245gYBJkqJJmsQ5mJEoaLiJnUqJmeyJl9aJXbeIlMCRFOCREa%2BRAcuRAeuRAgqRAiORIkCREmORIoGYE20pBGCTmJCYSH14a1%2BRC3%2BRZQqYJ7OZl9CY2HaY%2BBeTKDqZVE6TTLSYVISS%2BgaT2iiUOkeUamyTyoeSqqKYrdiTTfaYT%2FWymPnbmWbEib6VlF63lI7ck%2B74lTltl884k29cmF92mY%2BXmZ%2Bwmd%2FVlH%2F0lMAcpAAyou8dl5B4o4CVqICyqe29l2zRmRxWiJ%2FHmXj5mXR3Kdp5mdlRmiirmhqNOhs%2FihbjOe0DOiMVmXjYmio6mig8Ki7umiqVmg5seaQZmV9hmeNwqjPqijBCmTIqGUQRKhlTSh7FahLHShEWekTIikgimU4FmYINqgBrqArVgWBGADKoVyIfCmJUAWGvADKXAvVipLWHp2WppGXCo0GSpDo5ikrrmTsKlK5VkxxxgCuIAP%2BsAKFfED8oAP%2BMAPWwAAP5AO%2BkAPezZQ2zaoQeqj%2F3xKpPDppWIIpt4ppktKpk1qpkf6oBtxCfRQBGGAD5U6q3ygBnLwAh0lDj8QCvRQAtq2K0AaKkI6k2J1EB%2FUVX00EMqalk5KojKKPDTKjDbqODgKP1A6klIaEVXDAfLwZhoQAhUBCevwAsAKAM4GAErQD1MQrNoyrP1SrCLRDfRar%2FSKDpNGEP8TDvQaDj5YDP3ak8%2B6o9GKPtMamdXqOtcqjIc6M4B4W7gwDOvAB%2F40DPsQqaHgACWGXATQsR6rAcEAquaTp7OnHkwgrxABDkEgAifQsi1rAjRQBZ0QEt%2BjDlAgAiJgCKB6DXqAs0cgsvb2E0DrUN4QqG7BDkzBDv%2BeijUsOZNYMbRdVAyIAQ7DKRZgGVz4sA5TMAeUSgCHkFRy0A9ssLFzAABTwApom7a2wAu30LZu%2B7ZwG7dyO7dxGwuxQLd4m7d6ewt2u7d%2B67dsawSZwLZ%2Fi7e8YAsogACKu7iMqwe80LeF27a8sAMIYABiQLiFGwt6YAAGwAK8gLmRG7m8kAWSALqhe7p8e7eou7qQu7qnywt0QAem67p%2F27q0m7mqe7uFywuSkAWzq7t5a7vAu7ex8LvDK7e8UAkmuhFNdQkAAG2hgBHQ61t5BgT8oAZw5gDaq70gqw7l8L3gG77iO77kW77iKxgnYb7qu77riw62wBLsG7%2FyC77%2FJ%2Bu986u%2B6gAOLaC4FoCzOKsAiusBz2AT4etV5vtVQaC4eMAO49tVBezADsGzPmu%2FD0zB94u%2FQnvBGky%2Bt1C0G%2FzBDpEN6QvCG4y0gMDAJKzB7gu%2FKXy%2F6OANN9HCF6wOTyvDLlwMUmvD90sUOhy%2F6mCMHaEB0fa88AAJGhAI7aoB8nAJGkAPb7YF%2FaAEWXWnoUeyOLinD7G%2FCHAF5tCvhiABijsJ6iAbaSUNz4ANf3YQ6uAO2PAM4TAPCYwAfeAUf7bG6PAMz%2BBV7tANz9ANWuEMxWAO4eCv6LDGaRUUeGzHovOn71ewCHSwpZmwzrOw9NiwVHO1AHAI%2FHAIl8AP%2F0rQAOIgD2oQCvtQBAAQCvjAB9YgDifHqcK6tPEKtQihxV0wD12VVicQxmPcVYuQBB6wASLwBKVwGu5QC0kgAhswA4sQx30wD6sQBEEQB6kQBBvgAUkgDOFQBiewASqQBwRxDY0AzV2wxnkAzaUwCTlQzUcwzItMqqt5lYCXRHv4gbFZfbPJEQ5wCOkgDmNgES%2FACutgDZWaXJewDsPwAywny8FnxQqJxQtBy%2BowyN1ACGAsAb6gDn1VBYyruBLQByGhDqkgAotrAAgAxnJsD5uguBsgASStuC2QA5y7uHkQWJtrADOgDvFQBSSdA5W7uBsgDAqNDsH5FdtakrsYpv9KqqBMaq0DixIwGaU8%2BrwGZxEOMNXPGwB2GtTzx9Ap6dAKocXcrAIqINIl%2FQfuAFp%2FsLgtUAW5rLibEBQzwL9VUAUbsLh9gNKLawFQcAQA7NJVoMUtYA48q7g5gNNX4NNVIASLGwfPOtQRUbULUZwicZwoWJ3%2B2LT955JOna3CWdQPQaWYQcULDa88g7IQocUbrbgiMAlnbQttDQVv%2FAxxjQA54A6pYNKLMA%2FzsAkLoLh3ndKKawj24A48jQAm8Ax4jQAW8AzcoAeEbdj86wnz4A5xDAWNzciAaar0iapKrapMzapf6qqfJ9rax9XIyXVSocUncAQ74AEeYNIIkNv%2FlcC%2FtRAU8QDcy70ILl3IBDHbv63SeewOSaC4UMBVtQDGG8Dczk3b0I0AQWDfbkDg1%2B3O8qndCMrdHrrUCtvUJPHU2hrV6KnVD2jele3VCUHL9qAO0oANtTDbMFAO840AItANHy0MFlDSwqDfCHDTBEHdvp3cJxAOazzgCBAHBo7gCv7c8XDYCNAFThEPZSDh5Efh9vZVBVEuVl7IXhV3koWVsIydhYpRsqkbmNyjnSrPOSni6EDLTtFV89AHKo0NMe4B2FDjNy4BOa64PF7IzAzkNC7gimvk6nDgCJDgza3kTO7k%2BBrlCGDdU87hBuEO4bAKqVDpz5BW6HAs6vAM%2F5UO1OogDJ2Oop%2BeCp5QCV5OP1tOnTaS6vRsqGOelGUemmrujSQOjpa9kaadxYr7BcP9Z%2FPA6Bsg5329CbY8D2ld6N0wCQF86eqADR7w48B9An9O5IJO6Ia%2B4IW95Iqr6FAu5eKD3dy6CDPAAIvrAV1w6cfiDoaguGUQD9re5EltEPHQBdse79KK4QQxyISMEJteC7UgDLg5HGs86wpRDrbg77Ww79hIGWu8I6me5QkB8Y%2Ft2VZ7nvZjpYYMaBKfENO5EEZiyASPf1osBItgCIawCFxg0jkADrYw2y2wCcIwCWRd4M9Q1whQBd2ADfQO7Yor7UMe6Ede6EnO4O%2FO7f%2BM7ujfTuUzGeGpbdyp0FjouO4I0O5Fb%2B%2BFcQWcywVW%2F8gY%2Fukz0AIzkMcI0e03r3lRIel%2FUAsEXxe2INIMkAprjxCyohfCEAzB0CDdYPcAf8d2%2FwwL8Qx23w0f%2FpyIR0cqPgmIPwmUIAx47MfSWesZuS6fPgmLAPd8k%2BsP3fSMuwiaRgnwDd8iANTusPMyTtY8jwA%2BD%2BhFHvTXjuj1vujeLkDgHpJwrtJV4AazveO2AB%2B3DBrqzu7unuiKVRAQr8dlIAIecAa1MfAE0az3Hu%2BDDsB4TlBQzrlIrxAroQ6bENelEPcGYfA2b%2FmR2CSTIAHmLwbXEOmLYP45sOjmr%2FX%2BCSHg5p8H9g7ZER%2FrIV52hNDS%2FLsBFgAQKv64Q1fQoEFvtg4uZNjQ4cODwLI5dIfIAIIZEDU%2BjGJM3UaQBlUgIFmypAdC6srdUrdopMkcqT4WvFLSwIkjCAzksbeJpIhu6twdMWDATTx1tUhKeMZNz8UZ6uJVKdolHrp4ZYo6IRgSojswmrp61ajumQiSOYLFu9qFpAE97NAJ7VbKkzR1M90ZIlmGbU0EXdxJe9bNYLdnhQ8%2Fk4buWTBaCgsSrLUJm7twicORBRkPEKCrG5NKQGBB2MyD7txYsMBlbF7YBSV280Ay1diCsRfmNci7oe6C5Wy12LBhFWrYqHcD9%2Br%2BThMY3JzJuoNSEsQv1O4WkYSB1S2CKqEXugtC0o54jbfKSWd%2FUF0zBwDkz6df3%2F59%2FAASNFNONt4fkwJEwI7%2BEJKsPQQloggRklpAkCOPHmSok0kqtLDCTZ4haCV03OnGEDJCXCSc19SZJMQ4nhGmwtOewTC3VCr05aNuLDTHGVoq9GQuWSqs5aOkKjxOwsnCik5CdwBEQAJZQlMHGxVyIKOScj5y4wSSPEjCF4L26usvksgQRgQPZgjKHS466EAwdaRpwQMRnnGjAw%2FKIEgdT3IgTQQyzlCTkCMf9Aw0kEYr7bSGpAkmmGdy8zCVUmQh0R2JlEELgU3CMWeycIL%2BKQUv1MLpphsS0alFUtzykqaUYEpFRzhhFt1sLnWEKaWURlP1sJRaSCzwq%2BcCJXI3YSwwCZGxtCMpo3i%2BC485d5JgrQ%2F0aC2Ql%2FVy821Yh96LLz9ww7Vvv187I2QpKK64IgjSlsxlprzckTeh3ngTCkjf7u1N3gLj3XYyYryZi1%2BD3KFkhhmuUE4od8oFqSOH2ZN3YoobDu4WR9mKx%2BLxNI7XYoZfI3gyedEpxpmRGUZuZCLBEovbgqZalqFnpMIWneoCPOFHLxHwKx7AulCnBZI8weylFkjcDoEW1OGCJC423qTdktqlFmasPqu221pIM61Ad%2BwwwQQyGu6GCxX%2BFFiyhS6eWaYREdRGAM5NGv6jBWNFSGJI7UQQwQ5CZpBAghYM6codYaBAy4IW8phLuBlM2FmoTXTYgKQNZjAE3me4WFwFN8KJeLxgsXYoHjsCDCK7pZn97gp7upEFm22fqaUWbPY1VZaglLNF07xs99V09%2BAT93hxyW0vnnMR2KCbedhqHoE%2FrvKwFkMMqeUYYgyyvRZ0hFmkV2FqmRGdUrSnVXxKNEztmVIISaUb8cLxpRJaPPTEkBln6uZ2YRQsHKsghCc0NDqHQIx4GuHQAjVyMgd%2BxUhYc4cTSCKY3RTkFuzgy5LKYIjyIOAIUungz4JmjzKQxA32KAUDllL%2Fi3kA5gz2%2BI5V0BFCD%2FThDzkoydVgNqit%2FaZrhypQVooChaskQUAGOEIxGnERmywChQKygEx6hhYoImABk2hYMIgWIMEI53IISEU8PGEsARnOLDMQ0BNEFxLnQCeCuQkHG0VIGgn8aDKt8w5JqhCHtIkACrW40xVa0AJAzSUccZiBBRRggiPcZi7CYIEKoCCMJIiAASooQ1Ac6C3khRI%2FymMP8zBXs7nQhiR5QIohVNAuCXhADJNJggQs0IXaLMAQOojlJEIogScIowtoFMHmDOKG2jSIEDCSwAKS0IdLSaAKotPO4HIwmU7kQG4b6MIbOaPAOTKkgeFkCATJOZ4J%2FsIsHC%2Fxi0PUkxOf5cMe5sBSHudRQjAFxh6eIIkOwmaSzRGNAamg4QXnMUQESHEe0jABSXzILSAWaohfY0hWSAKFeZSiQZ6ohR3kVolVDKFdOjiCLFLRLij8AZ46wEoHEaACO7hhjM8KYQv6UIZ2TaIdtkhmKuaRszLUohQhXJ07AHOCPKyGJAOBY%2Bnm6A6fLEkWX2xnh%2FjYLJIYK4si4Fl5DHCeJ%2B1AQBLoQ8NqobYNeCCLBqiCsIgESlHGdT6klI4pnQe9eMxjakvtiYCWKi94mqQUbFSABLLovADlUSgpFJAdGpaKrArIDfLiozvOKKAkmAOBCwHnOS%2Fm2YWY%2FxO0HUont9QRwraOp2G8wAaWEACFMsT2JZOwBz6BZtBuLO4ZSpRbFYbougvaY2kn8ORQHBpEBEVUNBNF1EIs%2Blp7TIIkAglGSyaRClt4wxyXWkX0qnBRe9hjaLa5Z5aCMQ97AKYK8zip84SRj3ykDjw77Wk8dHBRSiDmD6wyy%2BUkkAr4ShcBq2uqHJ%2BaMyHMgwwkIe5HlIWRPi4rDl1o1wiNOyCkKHFJSSiDay2winggFAFXsIMdN4BK4sFVrnGlK2fsKoEyxGHCY1RALeLhhIsEYROb4CECkgDYkhwBCkdAhx0lEIdOaBgBIliEIZLZh4OikQydwOmh4gHZBi1iEv4vyYFQ%2BFhkkhxhE4QY4yLcmsAIjXacoxUtaF125rp%2BFyMLM8QipMHaSxWlKG8hRG2%2FdNvAbEzOeRhJEHg4AzeQ5AxsqaE9GISAG8wkHolGwEOHpdyyMLeIjMWoL6hGuC4YjRjZyC1JSkGQHg8hpiVepZ8R0GWsMDYH7hCwCGQcB8C0ABw8JS8ZsriBIOThGRvjp%2FPcIGMyoBXFGokjnCVklmRKEaFmturMsLrkZ8xjHvK1wFrgaYeDyo2V8XjGF50Q4naRIR72aG%2BNNysdFa84lC32z%2FT8SoaPrMgOz7CHOxh7BCC%2FOi%2BGsWMS0EuJkig0hDyJA0mCEF57yPkP7P5dik%2Ft0TwaeHlZliWJCcIR3g5CwdmcTTNo1wzaNnv2zRTMQ1aD0RWz7EkP4LhUErrAhS6EqAuLKK%2FP8mkVWi%2BLNHZIoQWwtACZXLsLws0S7ToET0sTCdMQMRRFnctppOQBjSYJQnZLjYBTf10ne9YJ7DoI6werQB1KGvueDbABbPCajO54RghN0gEoF7vtUGTKZps9x%2F9gThjmqCNJhODgqzrrKv0t2jy%2BbQ8lqeCN8ehDg9Dh6SWdmvGKXWC85X08envFrgLygBt481g7DOEEcgP4hY8yFzBTb2MClkB1T%2BtQewiBwVDgvR27QPG5nensGsdIzzzAeyiEUPLfLP%2B5Z9XBC4%2B5R2NIMV3Kz7lymKkD8yKkXxJLogd19NgO8nRHHhaBKtsGDSliJ6PeEdBgpR%2B0XRM%2F6BijLqGpP6TqzT3Ic0WuDnuQkxwYI50QA3L4ulNbp2WpAt5TlyowhJ5DOwFrmg7aAOSrgiuoAjLYtZ6SClqDgrQpiRPTqNKAAgbEwCroAk%2FaiL%2Bbox6TgBM4ARVAI8V6MOAascVDQMczD3toOB87nKWRAGEQBq%2Bpmc3ToxQzns%2BbN%2F5YnuY5sj%2Fogz4wIJgTBh7aMzRqvW8TDzsys6BjGtG5vUqbh%2Ft6Cz3TiRy4sizBi57pMhvsmb3TiROYFa%2ForOubhCZwQC7%2FmoxJwMAMnIR3CwnrIyfsgxnVKIkZIIM4KMMBs4V2oDQLWIRn8EF7Sr8Lsh45e7%2FMIMDUUrqrKEMYswPXqjTkWh6tkagijJ7pcwf%2FC7FFsAOee4ZNCKEdOEDuih54IoN8iB5DmARfIJHh65AJNBEGA0B7qIVF%2BBTh6MBJQIROMhWtKxrMM43wEh8D2hSQaMHOKwWq8Su%2FsMEIu4IcvBRP2MEB6UGHk7Th6hSvOY0jDESy8LwlBJfQCwm7eh5V5JiCCKEcyANZoDQtNA8uJAkvnMAwDCEoC6EjyAM7sIM86APzcwcs8wA2HL437KATaEiHhEhDkA47JCcjeguuoCUo%2FzKAOChF9hjEcCpE01IHwBAQFRAGbCm3qimJsomHDlI3mQm0aiOJH1MHsSKJPYyHp0GAqFGHVNg6knAhUsSa%2FOMaPLqCEJlKMoBATqOhixCB%2BemGnGkCW1QhRBCG5tmARfiQpfAEV5NAy5OGZOIC2%2FmiJzgHuUuFcBCBouACbKgLY1GA2yjDIxCGZxCCi8gBOmQ2p1ogNFkKD1jMxUSjE5CGeEi8BukGVtyrPIqHx6M9GJKXnAkCd9C0d%2Bw8JZzH5GnCUhrLZeuNZ9hLXwivfwu48zCILpQXg8wLhLQHSksCiJMxSZTINRQKi2wdqFrD8JoENzAEWfDI5gNJSvuJ3v95hmQSSKxRyacqrexDhzi4lKXYEndQD3cIhh7LKnzrEERgjclyh2GyADuZJBGYFnmJA9ZogeIiA9b4AoLYJ8uxgL8pw%2FsTlFNcrm40CSaaoteaB2FIJgnYABqsBG9whyGwiUlAhy9yHrUxgCRoqWVxMAGTvCQpCQuApVJgh7mcBx90ng1olyQQCkqApa3bw2w8TNOBtjDpBmmQhm0oBj0oiT6TzIsqHzu6pgs7D2y4lBmYhFJYMJKAQNB8Bv9CwhgdTdKkR9OsK9Tsl9VUoWdYhEsJSAyTTYKkzQY5SIeaB1lol6BqHgMgBOCjSOBMC%2BKLinCAgTArBUowgSOCR3T%2F%2BMhwmrQAMZrhNInYdBSK%2BQ2KWRh3uIZrGNTrs04KwoYL%2BZGPUA%2FYKwUL4T%2FEUAx0uFTD8J7E2NRLdbqCQIzIaBPkTAVG6YbcWyWUrKv%2FzLQTHRxYhVUowM3BaSt3KIXw%2FIlFWIZsqKaSmLhaeNCqqQLa2YvB0QENHZwZ2Iwkic6X4iLhOIHBkSRkCpAhQKW%2BMQkPYKoCGzmJcanbgI1rKIYfBcdry6p22SJ5EdbzgMMAgYK8WNK9dFKskccoHZcpdbE%2FuIi%2BcwhGJMAlox%2FdM0nx%2BKKCnC4x3YmN6YLD8skOwbINqMgMfbDuoLUARQATSM2HWc49bU6B5FNADQ3E%2F7GDJLA5T9iWvEiFMyjZMlgFkEmFP8ADSpiEJ6gCQFzUl%2FmkQjUISRVUfdQWeGEO4EgO91CHbCAGuhujJzAMT7gUSvBWe2xVjQiHWFkUq7XamlEURpkM9MmeXtQQBUHK7JmERsmLTvBamfCfRQmgUF3bgsnSsb2MV7GFqp0Vumuy7EkF2JsMF8me3pwOGK1X3RuwhXCGa0idwooRa0NSMpjQDTCcp1NVq5rQ0uimeCWNDXBH6FwSes0%2BKL3X%2B6jHbFwEyYEBjc0NX7A7gcgBGSyFqRgbbkUHIRgbLoKqsQmCMISCsVGjRWqorFLBeI1BM%2FGysUlRWhsbIhPGFpAbCf%2FQAZdVTjzFP0qTVhGyzSVxrUCVqQB5AlRSh27IxKUog7kISQ8gDQOANUJk1HPq2dHKBmCYCyUTgRBcMrxwSqkti%2BTIX3z5l5CxGAUZGJbZ2XrhX%2F4V4JUQWgF2jwTu1gi6nVpITWdwhv%2B5HWmY4GCYi%2B8RFUP4gz8QhrEonwfWixrhYEPw4JkIh0q4nVkJBwcuzHr9XNCtD9EFCVEZFapDh1VIhflxh2ywBVJBhxouzBrGxkz94YII4twgNx02VX3sBltgBoMwh1GZFSk24g4JhyUGn%2BjNU44FPEobAqI5MWyojRYIoXaVryWJTtzNiyuAIgsgQMEAWZtgJZyFWpj%2FYV%2FQct%2B5wAa7g6IW2IQthoinJKf%2FVTOMGa0OCdx6ZQ50iGBr2V%2BgjZeNWRgEZoufRQdeIOBALhQYjuG5yld4%2B5duiQ1vIAbk6BdKpuTlYGR1GLWifeWiZWSy0FMvvqic2QQBqwILGhADRaMkqIVuYCwEyIN50LsuAMyc%2Ba95aM4g8AQ7qK46RmR0wGPP0mNF8oQ4cANtngTKJJ5BDqdCNrlDHi1tBC1HlmZqJid79WT9AOVzohdpDmfQouUIAtkqUJJsJglC2GU7gLyfuAypeIJ%2BUjA35Q07KgPcFLxJVjn1Jad0JidrHphV3GRBvt9zkudzOrnrU2RyOmdEfug5%2F1pnT57hCIJnRMboc6JnBwJZKJCFBUAAHeChPNKwfpYvgIuZDpqBCvqSmMnNhH4pb2LonB0tkJ6jiAatb54jlA4njSZEjg4njybqbAEtkY5hknYgkx6tpQ4nlV4gkHUCdMASBVAbFUAHmrYHmwbCjQOq0ABZ3ZzeFRRqO%2BaWoo6go%2FaspI6grY6gpl7Jp56jqAatuhbNb2FnGXZncspq0NrrCOpqb%2FZpJUMAJzDHfm45CPuIZV6WnTwCkRXWWaW0jEBklvSswV6guz6nvHYgxl6gvn6qv46gwCbtqXa%2BTmbnq14gxfas1V4gxzYdt7YHy%2Barb5uHVRA3oViFZEJoJf%2BJRNpsF0P4aSQS7YYOp9ImntMGSYsm5IlA5NaOoHL2rNhe39k%2Bp6oG3dsmnty%2B6O1G5N52ytzMqJIYKMyUzsHFiCAYoxPI2i9iAB3gpbQIB5ae65aZ7jmqbtO57j3NbnBeb3GW5u8%2Bp%2FB26PFW59oeacQOp%2FTWbmnmYoquK61gonj4ujmMhyAoipP0XrsTwbrpkFWg3GX5ESOyUAFHEgKPIAPHGgQHPAVXagb3rO52oAfvaGfY8Bs3rQq36gufowxf8A1vb0NsBCSAgj7ICzvgvTzIizzgvT1Uh3D4gyBQARVIxFx4DWywgxwAc0QrrkWoAiTAgxl%2FkNEWb2nO8Xr%2F3nG97vGMHmc3e20HinDqnvBwKu97PW%2FTWXIeb%2FIuDmno0wtLngy2WBkuZ9b%2BEAog3gzqcxREdfAad6Ai5xY6X2k7V208J6cfR0w%2BXyA%2FL3BAD%2BkjN%2B8kL%2BkD0epRJycnh5lSXyDq9O5NX6BOH5ZP9%2BpQX6DdNp1bN50gh%2BohR%2BdVjyCRdoAfePZnTwH5eIEt%2BAH6oHZrH6VXx%2BpYX%2BxZ5%2BpE52s9R7lkJ%2BddJ55eJ5Jf9%2BZgJ55hx5pip6BTJ55Ut%2FFl%2F6QK%2FwF%2F4Ad%2BwId%2BOAQAUIJ7uAd9CAT5mIKBL3ht73D2MPQ7R3SG54x4n85yd7NzN510l5B19%2B12N513%2F7f1cd9oAxuteuf0eyfs%2FNAAJVCCIggFerABArAGawiBQ9CHF4j5mYcEfHiB0N123O523f72Oap1bpl4mMl1IL94rMn4B9l4%2ByWUkxZ6BzL6YTl2wK54wT75JCzs%2FAgBeJADAEgBfAD4IuiHLQgBfDB4JTD7%2ByCAZnjzB%2FGG941ngZHmjoD79qD6YSl54gELUMD79mB6BHH6H%2Bp4rPn4og95QgSFkTdnrCdtB291ALgEcYiPHuCHOQCAy1cDG%2BAHsP8BzweAF5gC0if9LaCFCE591V991m9913f9YoiF15992q99Z4iFk7F93d99JniFbNh94Kd92Q9%2B4m99W7CF4v9P%2FtTPhiyQhN9X%2FuQffugv%2FmLghekv%2FmygAzp4%2FusHfl7I%2Fe4HfukPf9vPBknIAu4n%2F9o%2FfvXf%2FfFv%2F9fPBlpIgHARezWQD9AH%2B86Xg%2F0HgPwHCAA%2F%2BBAkGKgYsmIKFzJs6PAhRIfAYkWsaPFisVi2MHLsWMxIJo8iK1IcabIhr1snVxZblkXSMpYnYwGTadJWSZsel9GhE1OnR41APU4c2nGZpCw%2FjV7kxYspx5xQIyKjlQAA1qxaAajBlwJrDH58BPIL80IsgCL8xmzN2swdurhy59Kta%2FduXW%2FA8PLt6xcdMG9%2FBxNGF8UY3MKK795a7LiuM2ePJ6NzBwZUYsr%2Bi2%2BV0%2Bw4217PiuMBAhRPtOLAqAuXa7x6sDtQYDK%2F7hu59mDXuPm6a%2Bag7VZW1ghg1QAvFIAw%2FX44kIdcORDgCZqp293Xmy3rfYFl0873cHXvdVuLv1tMcnm6ljXRTo%2BOs%2Fu5oOPLJW2aflzu%2BNGRx%2B9O02z73bYffPSp4xtwWTmwDnJZHbLPJesM89sh%2BlwCz4TSUbcfdvsB1t1%2B4OHXH37n7bdee%2BkVSN98%2BNl3Gn76jahbfP8FiN%2BA%2BK3o3oG%2FJQiAA5BsoZUDfAxzyVdAGolkgtOFR1%2BH%2B8mIn4j0kUifif6BwR6BneHXIn0vSgmilTS6Z2OK5eVI347p9fj%2BI5xxavhkfFHGSCZ9VcZ3ZXxZ0odil%2FuBGZ%2BYd%2B7HZ3poCoiejl7G96ackcbpJIfZjemhnu4hmp6fNW6Zpnhtpjeoe4XSN%2BWeZiYKIKjerRmfqOJBKimtbVGKn52n4hlfpultWl6nZ34a6JehhVkajLoeqmp5iuLIKJuO8ohgrdVmdSuUlhoaojF0%2BsossNAKy2WjghpLKLKXzngiq4t6GKt3s1pbK7Z1aqsst96W96t4wSY6bLnF7mdqfKhqCq53ztL3qnvwaifvvJLW616uBe%2FqXq%2F7Iuydv80CHK25A6e7bZns3riwuA1L6ya1EdM6cXoVu2cwxt2uu1%2FH4gH%2FGjCL55Y6Mr4l%2B9fus%2B%2BuXB7ELk%2B6Ia73WoypzUKXmLLH5IIssItAP33zn0SjbDR%2BSSv9I8zlyZwezellLB6%2FHFOt88ewHl0eqekRPPPFGpvcqnYMqzh3vC2PvbS%2BZjuNN9SFe9e2djknHLfKIWd9H8mp7u0usY8KPjjZTGfrYdrlrb34xo2%2F%2FbjVckt%2BLOVBWz70yfH5XZ7D1onN%2BVZli3d2eaGLN7p2jFvnuHY7X92zyK1vLXWNXst%2Bune173Y77td6bi%2FoeYse9etTnwj536ujqzziXDcfu3uzhwr4w5tXn%2Fv1FB%2BOtva%2Fc3%2Bwh8RbZ7zqWLOe7PK6dz6%2BWUd9%2FtFjn%2B3c9z7rKc47vBOP77wDPOsIbzf62w3%2FIue%2F8QGwfMw7k%2FPSBz3tSA831Huf7hw4v97VT4L3%2B1b%2BRohB8NEOgdapW3nuRr9lXa5omZuWjxZoq%2FjFbIUQbKF2JribCuLmgrjJYPg2%2BDPy7dB8IERfegxIQhuaUIFCTKF2HuidCCbxhXrDmQyfSMP1iW%2BKHaziB1eFRTWlETclrM0JqwdG64hRO2S0jhJxw8TaOLE2UKxhG%2B2mNQ8K8IoE3I0WrXPH1%2BQRd3vcTR%2Bt88fdBLI2g3xNIV9zSDZKUZFUZCEPYfdI3ERyN5NcTSU5d0ncZHI3m8RNJ1%2FzydWEcjWj%2FjxgInO4SDg2Uo6rrE0r7chFPHpxgbOsTS1xc8va5HI1u0RNL1Hzyy0GUzw6RKUVjYk5ngFRiHOqVPYSF05O1VGUawRmKYV5yiOmsmtzFE8ya%2FNK1MRycM98TTRrM83XVBM11xRNNkWzTUkuszY49OYwwRnHZoUwi%2B18zT5F08%2Bx%2FXM1AX3NQFdTUNEc1DMJ9cxCXdnQ1zzUO9%2Bk5zp1VlE6gs1AzUQhEQ2XznzFtF8X1eY7uRlPiM5zjEhcYukwOFN8%2FhQ1GfXMRpXWUdR8dDUhRc1IPVNSzZxUMylVZjddGlGYTlSm93RVU0XzVM1E1WVTFU1VUXNV0WRVM1ul%2F0xXKfNVfa50NS3VzkuNWs8BjvN45TQn%2FBoYRiMKlqdl9en3UqdB5E3ujRItJkXP2re0ematlGlrxN7qmbiKZq6eqStl7jqZvE5mrxjtK2r%2Bap3A%2BvGogkzqE5eK1ppqLoiIxYpoNUNaz5hWM6idjGofw9rHuHY1nqWMbHdDW03a1pO4NaRuN8vbw%2F4WuDndHWNrq87Hui2yx3xtWAE71saSd3%2FZLSBnNfPcx4B2XsGlzHA1U1zKHPcxyXXMch3TXKfCVjTRxc10bVldXV5XlO%2BFZHwpM1%2FH1Nda951Mfimz38n01zH%2FXUyAFzNgtRbYMweuTYKluWBrNtiXD2ZlhP4nM%2BHFVLhaF35Mhiez4cd0eDEfVkyIFTPizpZYMyd%2BTYoFumKDtlibL0ZmjB8zY8VQLwWXuPKVh5QCSFw5FD8AUiCOlKQhKpaP4aXueDEbLvP%2B0D1HXk2SQbpkkjZZoU9%2BTT7Ra1PfbsUG4vjzOv4xlin0Ix3iWIcSAFChCGWIzOhUF5XMyLY6IzTKIg4qQ9M72%2FWKt6fFu%2FNq8uzcIk%2FmhAQggANYkSE%2ByCMExAGABpyTnH4UATgE%2BK4KdxrpMt82hmwmp5t9ZkrLklXNCQM1akRN4LDdFCtT0MeXARAK57Ai0TZAi1rSACQNcJvbJWjGPNwh7nGTu9zmPje6zf7tDV6ku93ufrc7iOENeNO73u5gAjXiYe99o1sdvFAHvwNe7mVEQ%2BAGd0c9wCAKfR884LwoR8MDzg1iRJzf9ShNPSq%2Bb2JwQ%2BP2Lge7yw1wj587HqIAQ8ZJDu9rXMPjI3%2B3v1%2B%2Bb5nbex7NJoA1GoTzdEBiGPoowrXlQBahT4EVRj%2B6OVrxiVGM4hNOf%2FonVHGKpbei6U5XRSumDnWot0IVXof6Kbw%2BC1pInelWP8UpRuF1prci62k3%2Byfargq1Nx3rbm97062uClrM4utPP4Xcrb71q6tdFVdvO%2BLRXnWnmz3sWtjE1AUP9a%2BPAu1PH0XXB%2F90rPud8VI%2FBS3ezv50xqfd61NPvNnr3vXCO73tis%2F60q9OC7Ib%2FvKAX7zmo856qiP%2B7mlfutlb0QZGKF3ym5%2F7JyzP%2BMznnvOdVzvaQz%2F30S%2B99Gu3u%2BibDvi5h731d8%2B83sfe%2Berjnfpb97rfMd97xf8%2B9a0YxCCKr%2Fm1Jx%2F5S8e68Tff9eejfe99F331Md31uV7qJR%2FedV%2FUud3tUV%2Fl0R7UVR4BNh%2F6ed76bV%2FeBd8gaIH8DR7dUZ3VqR3uceD%2B1V71hR0lUELZUd%2FbDaDbwZ36CeDhfR%2FcJZ%2F0bd3t%2FZ7mFR7ygWDvQeAHsl2zqUWiYUUIaAAAlAA9XELQDR1waAArdNeP2AAkQP5hghxCtFHhVoSCEWIhkTwhF2qFGoTBF2qFFY5hVmihGQrEIaRhcohhGpahGYZAg5ihDYxFGm7BkKQhK%2FAZFrLCFv7IIcDDFhJAChjhgoRCCuBDIACAEvRDHm5FqrGhFLIhJFzhGKKhGUZiGoYhG8KhGWLiGP7AGqZhGLihGXriF8ohG4oiG4aBGrDhHurhH9raMOBCVoSAPLBCCEwBP8gBzlnDlnlFE3ohHU5hGlYiG4LiF2qiGXLiG1riF4ZCCKQhK5KiKY4hKnKhKlLjKJphKaYhAcSiGfohnDSHMWJFV8gDPsSiEtADPuiDHbaFE0riOY4hMqahMnIhM46hM%2F%2BeIjRyoTRyYyte4xdmIxZuoxlWozcSJBaGIx9SITn%2BCAHYwJhhxQtsQRG8GgCkwBb8Y1bMYxpO4jF6JBXmIxbu4xf2IzaSJBQGZEJ24xh%2B4zOmIUKGIkx%2BoUyOoUPKIhZqACxI4iVQIkt2V0SOoQbY4ia%2B4kjC4jSaYRHUY0oqpRne4xiGADGGIlRyoRpI5RcSAC48JBTCwix2lw2woQOUZRq%2BwFhyoQ1o5BiiZRw2JR2uJRa2ZRo6wAuwYQjI5Ri%2BAFh210Tq5RSs4lD%2BFly%2BpVv%2BlgbYAF8C5l7u5atpwA80JucwZlZM5GFiZmIOTgj0wKsRwF5qgKsR4Q98wPv%2FnKUNBNFEroBWTGRevk8K%2FEAJKMhjjiYAhMAP0KW1pEAPzGIJ5KZW%2FKZuRsxZviYRhqaPFKcQEcBkZkUKpKZW8OZfusxz3uJjJidFnmZtOid0cud0SooDbCeQPOYfvkB34o5mfmQPzKZ6ViTn4KZcimZoZoV5bmbEgGZt%2Bshi8qVkUma1NEBthsBv4GcRRmZzCtEPpIM%2ByANDmpMS3AM%2BvGOiFcE6LOgjco4S9CJWOEAovGMo%2FAaHeuh31ooD4MI6%2BMgWRGiEftkUyIM%2BIBruvIA1RKg15KUT6gM%2BXMJv3GiONgDnEEAgRCg9CB1XqOg95OUWuOg6RIfLAGmEikOt%2FyUHPeiDOERbGExpleLOD4hDhB4CcWgAl%2BIDPyxiCPgcPnjp%2B8iBP7ihHNwDlaKlHLyjONTA%2B4TAOgzHRq5DhGpoClgDjsbj4ByCiqbDb%2FDBOwIjVhiqPiCq0kCCiorDbzjqk%2F5GkOrDMLiny4QALkQoOfqZPtCDUnoqqFaPGqijPAymtEWopZ6ao%2BoDLpjm4BTBPkSoOo7FD1SoPOThrVqo0mQoreLDHDCiO0poWuDqhf7oMFQpK7QaFRoqH6iBHKTAL%2F6AiQ4niY4BPWhocpTFFvDDK4ZBWYArVyrNC%2BACP0AqVhyCPMgBtApoOgzDDyTriEbKpirBFOADcsgBP%2F9sgRo4IgDoK7%2F6a6z%2BAyTYQCjoQ15GiBywgRxwWy5u6TDYp6T8QD%2FwgZ8Nw206B8RmrJeJQ8RyDi6kQw8EQj8k2g%2FoAyRAa60JqhLwAT9EaWVmqxi%2BQI7e6hPS7CXY7PtcQj%2FgqRLowyGoQR182SXQQxEcAj8cZpMOgzVAqxpMJD8cQhEkIQBcm9RSbZNawzBA6xicmtZyLXOOaRHgQ1ZGzCXggxKk6JCY6A%2Bc7VewrdtyTg%2FsQ8EOQ8Q6gDjgArSKYYbOwbMt4uCkgByw66ZmZLL%2BwLJqAAEc7rL6p6QILuHiw5fVAT48a7ROa7XCpiICAKENYXeFAjA2ZViMxRb%2F0BrnbIGF4AORhsKJEoA4PCHrOgABpMNVugze2i26AgAuXGpT%2FgA%2FaBsbJO3gEEAY5KHW6q44AIk8BCUuiAOqLS%2FnvAAfTGPp1towsEIJbGEjDmYgIKzLSCZxMC3n9sNgCmoIbK%2BiCePgvEBeToE%2FJFoY4EMRJAnOYWwiAu7gNECy4oMYKketXYI8OEDpRgcAw%2BrgJKk44Gmc%2FkCSLMgThgWRjk2sHUIKQABW6GtZssI6EAAGA4AGz2uC4GIgpICPiDAJJ%2Bo%2B5KUr5K7SxFpQimZ43sMUFoEjaoAMp4XAjk2QknARbqTqnnD6TiPTSuy8aMA6jEUK6MMidm4JKPH4%2F3pupq7D6oauRe4D6Zpu9fguG6SFt0Kh6%2BKDOkICAdAw3%2FZDg1qLDdjAC%2BiD0C0unlqDNTjAELsxEdMKASiBA0TIb2CAnqqjlxLaYG6BP6Aq7qgFH9QvADRA3jrA8eItUqInLghirIFx5c5arfUrzEZMCgyDPNRa8H4ZBqcBP4DyKFcPHyQhcUACP6jjpRoHcsTaHI4NH4jDvYqhy8YAAHRvCvDBPpRlIKQw56SAPKgB6BJHKKwyPrxqCNxwIpattfiuPNwDgwKAo36Fo4aAoFozPrDnvAABMsPDkHizOoIzNd%2FDNBat49YKze7uEQNADVhx1fbiC8DztQGqy0wb6%2F%2FiQvsiM4yGgiB68DpYa7VAAqECgDe%2FolqEwbUhdBePzSWgK85RshgnNCPmMOfQ8Cv6bgQjVpAEgg2QLEaacUWf8bzMcxvDcfjG8RADANOCcKTELqxdgsUeQskCMgAIMiEPzg%2FIgzVogCLbousOQwTkbSJrbR3XCgFcQlncZijIgRSOMrjWWhpgscsYbDvr65cFbw%2BoQSmzwXKYst3mpRzk7L1eAizD2nFwzg8YbQrsw5AEAj%2FkJS9Lr%2FfCtdLOSzjCrjUkasFuwT4cQgmQ7UbSgzNXi8FugQ1sagg46mwKaglAwj1oM6bSCuIiNid3ZihYdqsB8DRe8%2BDYAD6swxT%2FAOzoxjMfnMVY2AA8D84xQ4ISJPAYh8IU%2FIA1BLQGG%2BG0CTStJCKRqkVG%2Fy7FMvQWK80K4INSdnQdOiIZczFJz4tG43BzL5AGEDbFlvGxkus%2BEOkcGzUuDEf9HnWtwHR0KiL6li4UK81Oi8NXIDLeukIDNDJR%2FyjPbjRWBF31AsAnc44c9IMNgGt06OsLKAcRAEAdCG%2F1nLVWNG8KMEjGBuXYeCU8yIGgssIPdHD3loCF44NxukyGXoIc1PbTagXTCvMUJuJNHvD77nA5a0A2UzM9pHOtmLdWhIE%2FHC0%2BnLM86LacrHFQzu4lrPEiXhsbJPEi9oC2OrT3Bu%2BG77cN%2F1yIEbrCieIOG6iv78IBFyM2P2zxcisN5XLzR1L371b0dStNYE%2Bh%2F0JhCARCrZl4YC8iVxemOmc3VgCwBjhAWtO5nccya0d5CpThtdXBWQgdH3jv%2Bt7pmGkwAdjwFCK6Bgg25yCtVL7AIeQlEJhxdaevl1dLEVzCbIbBPxQBDQ8JJNCDBoS6i8M4eAYtkKwDLnCwUra0%2BKL28JooPMiDO8JB50rbibpvorGujsfJFsDDOtQ6PlhDCdSBGAa1IwtEP4xrxBytEY7BcoDrlzUvAfRrtbOwtShBIBghthdBt%2BM3f3N1Wa60BLP6qps19HZucwSlTQ%2BOy4LyPqQAtxcqP%2F%2BswKB%2FhTU88uC4wsf68Boqx2SeqSWPze7eopoDfJtzBT%2F0wAKFAj3UQQK7dMQYxzqoASvgg8O7wrpOfPXEQD8QaYer8mCOPD%2Fk9J7%2FRgrcgzikAS7QwwssrhSzOnjLSTj2gziEgiusYbdy2cveND%2F4fCZzOD%2BsIyvggg2swKKOgTXAg4D%2BmRzImsv4Li7IwTqIQ50ncB3cwwtrPdf%2FKC7Ao1KL4THzAdIKnb4GQsZvuO3WuVr4op0Og6FOYQhgyNz%2FaLc1r%2BLiQnarshjCNR%2FggjxM9rb%2FAyuowZ02QArQAy647CIufuOPqdJMwT%2BEAuJHLOVbvoQQwDoDPu7A9SH%2BkDwAnC0f1LYRkr7pRy89WIPVt7qnX0KpPqEN6EMoQDru2LmDA0AAsMKQejzvy4HHf688nKMRX3zGfxnHA38cL1AIPDTS1yUr5O0QpkAovC7bj00K4MIjMr01sMEAYEUawDEb1DytBMKHYsUPrDAuROkLVD8ico4T4oL8D8MUcjAcu6H9W0N004oa4IIrAAQuXMN%2BACiCSxyrHgAA2GAl7lIIhhMpVrQ4ccowcaFeMLThCqLEhiAjXjR5kmEISOKsqSEAQMMhlnJeNggkbtgUlDtNpsClhOEPhJA0MAQytChPpRMDXUq5suUAAA5kDgO6lOcWjZdSMFSi8ZADr2CtxWK9GGZrVwBoIZYYKy5QWbMmHQSyZm0MQw0rcRWEydfvXJMHIXYloMaaOEgitYrj81LwRQ2swlAMcUmcKxspMWuOTJEDri0UHYr7ybBEqIQdP%2B%2FUALn13NcVZ8dW6iDpRNy2lQbgAFsvb6Ua5OotLvwigdwMlSNvTvH5xOjIYR4nTvs4dejLAUzXjh289t3bK3pvPV43d%2FTUr1OsPfG9c%2FXzv5uMDxP49%2Fu1AwIAOw%3D%3D";
var provMapCoords = {imgWidth:710, imgHeight:708, mapWidth:670, mapHeight:670, leftMargin:31, topMargin:19};  
var CHAT_BG_IMAGE = "data:image/gif;base64,R0lGODlhagHQAvcAAP%2F%2F5v%2F%2F1v%2F33v%2F31vf35v%2F3zvf33v%2F3xff31vf3zv%2Fv3u%2F33v%2Fv1v%2Fvzvfv1vfvzvfvxffvvffmzu%2Fmvebmvffere%2Feve%2Fete%2Fere%2Fepebevebeteberd7evd7ete%2FWpebWtd7Wtd7Wrd7WpdbWrd7Ord7OpdbOrdbOpdbFpc7FtdbFnM7FnMXFrc7FlM69rc69nM69lM69jMW9nMW9lMW9jL29nL29lM61jMW1nMW1lMW1jL21nMW1hL21lL21jMWtlLW1lL2tnL2tlL2thL2te7WthL2le72lc7WlhL2la7Wle7Wlc7Wla62le62lc7Wce7Wcc62chLWca6WcjK2cc6WchK2ca62cY6Wcc6Wca6WUhK2Ua6WUa6WUY5yUY5yMa5yMY5yMWpSMa5SMY5SMWoyMY5SEa5SEY4SEe4yEY4yEWoyEUpx7Uox7Wox7UoR7WoR7UoRzUntzY4RzSntzUntzSnNzSntrSmtrY3NrSmtjOhlrzmNaSjpjhBljxRljvRljtRlarRlapRlSnBlSlBlKjBlKhBlKexlCexlCcxlCa0o6CCE6Uhk6Yxk6WkopAEIpADopABAxQjEpEDEpCCEpMRkpMTohADEhACkhCDEZACkZACEZCCEZACEQABkQABkIABAIABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAagHQAgAI%2FgB1NGgAB02XJUaWKFziZEmShRAVOplIcSIUKA4fLsG4EUqVj1kqNpQosmJEJ1VGSvx4saXLlwxLTvxYReFHmSgnkqRJkabPn0CrvGypE2fFlEZLCl3I8SJEKCirZJmKNGlJIxRJjoza0CREq0eVBq0KNqdIpFo7ehQ61OVYLTSnZoGbUUoSJ0yeNJlR4EGdOGsCC37jRvAaN4gDI37DuDHjOI3dOHYcR46cyZgzI94cmfMby6BBZ34Tp7Tp0ocZFx79GPNp03LsjLZcGjRk1ZJZE278%2Bvbj3qZVH0482rQdO8DjbEZ8OnHwNaU9q9ZNOvnpzryTvzEcuLRr4MWt%2Fgev%2FpoOHdPm0zOWszkOm%2Fc3HjxY42QGChQmRNw%2FQaL%2FiRP7%2FYeCCAT%2BR6B%2B9yUYoIAKmuCgCSVEWMKDD5aAH4UOXkghCvz15yEJCoYoIgoT3gehCSRieKKEEkIogoQj3pcChx7%2Bx99%2FH%2F7H4o4RoohCCjNyaOOCAIb4YX8xJriCggDqGGGRIloo4oYaVgjjiBnGmGWSCdqIoopbhljhg1yWaeYKQJZwwoEjjHBDAgmoYcQGfRVg550DFJCnnQP0ead88tkJ56AJCEoonAUMpOiddiraAKOQRsrooZQOmqiji17qqKaLYurpp54WUGilk3IKaqiMNuAnpIiuKiqi%2F68W2uhAktYKKa13nqorpolemmukj9p6a6278kqqsH8%2B8CcEyhZwwAGMPgCBnQI1sIYRIDQAQbGbcmqqow%2BAGm64npKL6bjncituA%2BiiO1C77MYL77i5BtuXueqCqum37ALq77%2F%2B5vvuv%2F0GPLDBBhfbLr6KAkxwwacCKnC6706M67f1OhtBBBAcwOwADjgwA7tygJGEDjrkoPLKKvuwsg8w5wCzD0MMMXMOKKO8MhApsywzD0AHLfTQQc88NMxBDwHE0kwD4fPLM0dtdNRAU0200DPXXDPNWnettNc8s8yz1DPPYHYOVZNt9NE%2B6KB0z27rvDLKRa9dddBo86C21f5D5%2B3D1XjnMMPKgO8NeN12H6643joA0TXPTXstueQ%2FDPFDD5gXofkPlQuRgwQSwOGGGmecAcbpqIOxhRVWSCEF663DLrsVW9Re%2B%2By45667FVTsrvvrwPsu%2FPC2F7867Lfvfjztt9vOfPLD0%2F588dFXb73yy%2Bee%2FfXcd8%2B98eCHD%2F4ZcMxRRx1zwHHGEkQwQQcj8O%2FRRx8vMOBAHX2Iov%2F%2B%2FPfv%2F%2F8ADKAAB0jAAhrwgAhMoAIXyMAGOvCBEIygAxmhhyUUgQ3wy%2BALDKCAOeRPgiAMoQhHSMISmvCEKEzh%2Fxixhh6IIYOMaIEBDOBBFdrwhjjMoQ53yEMJsrAK7%2F6DXwsIQIAa9vCISEyiEpfIRAMyogtV2AP8XkBEIzbxiljMoha3%2BMA9ZGENU1RABz%2FIxTKa8YxoZCIZjBDGMYLijXCMoxznSMc62vGOeMyjHvfIxz768Y%2BADKQgB0nIQhrykG%2FcQxQZ8QIxehCRkIykJCdJyUpa8pKYzCQoGMGFNjByho%2FUpChHScpSmvKUqBRkF7gQQ0f2IZWwjKUsZ0nLWuIxCzuIIQdDacte%2BvKXwAwmIHGpSzcK85jITKYyY0nMFrhymdCMpjSnWchmPpOa2MymNrNpTWNu85vgDGcvs9CDVnpTnOhMpzozmQUimNODnYinPOdJz3ra8574zP%2BnPvfJz376858ADahAB0rQghr0oAhNqDzJ%2Bc4%2BKPShEI2oRCdK0Ypa9KIYjWc34ZnRjnr0oyANqUhHStCNOpSkKE2pSlfK0pbmk6HOHKNLZ0rTmtr0piUtZyNlitOe%2BvSnQE0pQ3fK0aAa9ahITWpBh%2BpKpTr1qVCFKlN5GtWqWvWqM4UpKE%2BK1a569asZbacuachVsJr1rGgtqTtlSFZNuPWtcI2rXOdK17ra9a54zate98rXvvr1r4ANrGAHS9jCGvatYmWrBw%2FL2MY69rGQjaxkJ0vZyro1C0Uo5mIty9nOevazoA2taAOLWc32YbSoTa1qV8va1t61CkdoqGv%2BZ0vb2tr2toGFrWxxy9ve%2Bva3qdUtUU8L3OIa97jIHaxwXZnc5jr3uc9d7hihS93qWre20t3sdbfL3e5aVrcx9SAlxkve8pr3vOhNr3rXy972uve98I2vfOdL3%2Fra9774za9%2B90veKhQBEuHVA38HTOACG%2FjACE6wghfM4PFC4QgAdqSAG0zhClv4whjOsIbt%2B%2BAIj3HDIA6xiEdM4hKztwpIgIQKXNmISbj4xTCOsYxnTOMa2%2FjGOM6xjnfM4x77%2BMdADrKQh0zkIhf5EpagxBVSTNQ88OHJUI6ylKdM5Spb%2BcpYzrKWt8zlLnv5y2AOs5jHTOYym%2FnMUH5Cilv%2BsIAF5CEPf4iznOdM5zrb%2Bc54zrOe98znPvv5z4AOtKAHTehCG%2FrQiE60nO0CCRsgwM1%2BAISkJ03pSlv60pjOtKY3zelOe%2FrToA61qEdN6lKb%2BtSoTrWqJ22FJEBiBgPoYKRXTeta2%2FrWuM61rnfN614DwgpLgAQMBCDrQBj72MhOtrKXzexmO%2FvZ0I62tKdN7Wpb%2B9rYzra2t83tbnv72A2BxE7T4AdBmPvc6E63utfN7na7%2B93wjre8503vetv73vjOt773ze9%2B%2B%2FvcRoiCh8n974Ib%2FOAIT7jCF87whjvc3EaA8LjzMIiKW%2FziGM%2B4xjfO8Y57%2FOMgD7nIR07%2F8pKb%2FOQoT7nKV87ylls8CRIXYxryQIia2%2FzmOM%2B5znfO8577%2FOdAD7rQh070ohv96EhPutKXzvSm2zzi4pY5zZ1O9apb%2FepYz7rWt871rhPCCEyWeiHGTvaym%2F3saE%2B72tfO9ra7%2Fe1wj7vc5073utv97njPu973TnawR10BMzeE4AdP%2BMIb%2FvCIT7ziF8%2F4xjv%2B8ZCPvOQnT%2FnKW%2F7ymM%2B85gcP9Q12MA%2BbD73oR0%2F60pv%2B9KhPveoFnxAAgzIPh4i97GdP%2B9rb%2Fva4z73ud8%2F73vv%2B98APvvCHT%2FziG%2F%2F4yE%2B%2B7I3ABNfTMA%2BIiL70p0%2F96lv%2F%2BtjPvva3z%2F3u%2Fnv%2F%2B%2BAPv%2FjHT%2F7ym%2F%2F86E%2B%2F9Jn%2F9znkIRHwj7%2F850%2F%2F%2Btv%2F%2FvjPv%2F73z%2F%2F%2B%2B%2F%2F%2FABiAAjiABFiABniACBh%2FftdICOB%2BivCAEBiBEjiBFFiBFniBGJiBGriBHNiBHviBIBiCIjiCJFiCJniCEAhzABYy7rcILviCMBiDMjiDNFiDNniDOJiDOriDPNiDPviDQBiEQjiERFiERviCKtgCDtCAeXCETviEUBiFUjiFVFiFVniFLpgEUKBibeZ%2BjvCFYBiGYjiGZFiGZniGaJiGariGbNiGbviGcBiHcjiHdFiHdniHYPgDUBAJKvB6j%2FCHgBiIgjiIhFiIhniIiJiI%2F4q4iIzYiI74iJAYiZI4iZRYiZZ4iYAoBcHGAyEDB1SgAgAQiqI4iqRYiqZ4iqiYiqq4iqzYiq74irAYi7I4i7RYi7Z4i7iIix1gA1kQASk2AwLQAHjQBSeQi8Z4jMiYjMq4jMzYjM74jKi4i13wASmWAwMgjGggAtC4jdzYjd74jeAYjrlIAjfgBRmgBJDgA9qCB2WgjeL4jvAYj%2FI4j%2FTIiiJQA1iQAVMACT8gLXZABu5YjwI5kARZkAZJixsQA1dQAQLnAwnwAHZQBiNwkBRZkRZ5kfOYkAspcDdQABAQkROJkSI5kiRZkre4ATRwBR8gcDXgkSBpkjAZkzI5k%2F%2F3yAUfsI80wAASgAfZOJM%2B%2BZNAWZAj0ANecJOvNgA72ZNBuZRM2ZTcOJRFuY868AAMwJMo4JRYmZVaeYscIAMqmWJTWZVkcJVbWZZmeZameAEKuZKQMJXCOJZoGZdyqZVqqZINuS14AJdzuZd86ZMXgAM2KXA7gJdlQJZ9eZiIiZEbsAM2mWKD%2BZaGmZiSOZkCuZhXgAGOuS3%2FGJmU2ZmeCY4b4JUVkJkNsJmfeZqouY0XIJoC9wN98Y8BmZqyOZu5CAIxEJjp%2BJpKSZu82ZuxaJt2mZsPgAdrEJu%2BeZzIaYq2iZs%2B0BfEaZzJGZ3IqZFs2ZzDWZzSmZ3JqZEY0JD%2Fzomd2hmevAmc3RkJ1mkHagCd4rmenUmeU2Ce8mEHu8me9EmZ7mme7FIHYxAC9dmfk8kBMeAF5amOfrGf%2Fnmgh9mVRRkF%2BFmg%2FImgECqXobmgkfAD%2BUkGDxqhGlqWCrqSFXqhGbqhIuqUAEqhBKqfITqiKgqUtimgDHqiBrqiMvqTLZoBL5qfMTqjOgqTCUmhNCAfepCjOzqkIjmhHvqjDxCkKUqkTHqQG1ADPgqkQtqkVEqQTxqlSTqlVbqlGQmlRxoueKClXDqm4nil1BgJPyqMYkqmbNqNZsoEaAqma9qmdOqMZsqgaaqkdbqn3Gik7%2BkD8lEHGMqnhGqnNaCS%2F3AKqH7RjoXaqMr4pJeZqIHKqI5aqbm4mpEKn4uqnpbaqa%2BIqQM6qZzqqaSqiqD6oqJaqqrqihdwqB6qqHVAqas6q6jYqpkKq7JKq7o6ipCKmXGapAC5q8IqipD6AXCKpHoQrMMqrMV6rECqrMuqq72KBL%2Bal6MarZ36pFXgq0iKB19wrdhaqdNard8arrRqmRjgrMJYrua6qugKpyOzruDaroTKATuAqJFQLYLqAfSqqnV5k%2Fk6ELHKr%2F1KqnWZrgHbAPtasAarkAirr2RAsAxrqdwJpxArsRPrqKGZqRebsZYKqhYrsBHrsZW6mlpgrAm7sCTbqKtZlCFbmuy6sv%2BEOgEKmQEvawcxK7N7SrOXSa3Vogc5q7N0agEOC5bycQfQKrRDW7Rt%2BazzqrRMSrQ927TASgJQW6dS66tTWbVXS6c8251Um6xP27U6%2BrUNKaVWS7ZkSp4phqxzqrZDSp4Cl6ZhuqRwy6Ry%2B6t6erdbmrdua7d8u6PciafSsreB26SDG6cQYLiHS6TcSa0zIKWA27gr%2Brjm6ZxqMLmUO6IJ2ZiXO5yZu7mOe5u%2Bap14ELqiK7gxoAUIa7qom7ozapusm6jscrqaC7sQ2qKtW7uvi7sq2qMoS6C267syCry0C7q3S7z9abyaKqjJq7z0Camj2ZYgCr2ce6ijGbB%2BMaj%2F1ruh4yoQftG73Yug38su6Pm846ud5QuR4pu%2B%2FWmrZwq%2BddC%2B7kuftqq11Vu%2FB2oBh4qZ1Mu%2B6Ku%2F0xkDWOC%2F4Hu%2BAuyfPWrA5ku%2FCay%2BAUqN%2F4vADxy9AcrAAFzBFlzAYLmODqzB26mQ0ysQEDC8ICyeGjnC67gGAXzCqZmQHBy23OvC2QnD3PqsLUzDn2nDbRsujKvDAxzDefq2QCybC9zDDfDDRdybwEutQ5zDSyyZTay3MxzFTHzBPQysUGzFh5nCEAarVczFsjkB9zi1YLzFYjyXE8AB%2FUutZ5zGvLmxpRuoYQzHp3mwbkzHaGzHaInHzVvHfNyZfvzGgYya%2F3Kcx9u7x4W8lZYbuUmKBsW4yJ%2FJtvkqpSUgyZNctNVKxJg8l8CZAZAruZ3cnjUbylmqyKPMlJ%2FsxOFiB5ycyme5ynFammCAyrDMogQMyrPsyrZ8yz5pm%2FnIysJYy76MmBqZAU0QCY6sxMUcl5%2BczMsMyM0cy7mczG47ttPclC36AdYspdiczUsJAl4KzU4Lzp4cwaycpd9szjQawd08zL3MziIpuyi7tc4rz2gpzldgs9p7z%2Fhslvp8pCIbz%2F9ckeIcmGiavwWtlQHtxAq90FhJyfJrBgQN0QWZuDSQnxRt0VkJAl5ZnjTQF3Ww0RztlPpcno7MyyVt0hHMoCn9yv8rTZK669LxCdMxPc%2BkS9MQadM3fZHLidI1XdE9HY%2FbbMrMPNQmOcXLzNNI7aTorMyi3NQzCcM2qrdMLdVWGsHOOpxXjdUCuc3kPJzE7NUwCdZQLdZCTdbdaNaRC89qbZJmTbdj%2FdYjuc3vKddpTdfPaNezXLd6XdcBqo%2Bfi6J%2FjdPm%2BKci3dWFHY4g4AKHPdiKvdjfuAErkI%2BI7aCSbZGUbdmf%2B495ndnISNn7fNevKc2gTY%2BiLdjN%2BZGmfdrymNqJWtqf7dq4uAEscKv%2B%2BMG0DY8aoMnn2dq7LY4akJKlm9izHdy0ONw9C9nHjdyyqAH9G9uJ7Nz1CN24Pd3UPY%2F%2Fyl3cmJ3d8tjby92cDSAHY6AB3i2PX%2BvGieLX5w2PNLut6p3Ekd3eufjecyzfzU3fqmjfeYzf%2Bi2O%2FA2f%2Fv3f4Njb8C3gR03gzjjc2xrbA67g3bjdDs7eEM6Nyo2yIY3dFb6Ntm2OxyrSwL3hx6gBLCCg8GrcIr6NJG7iaAri%2BZ3iALDiCJvh%2FgzjzagBMODhv1rjNr6MOK7jNB7iPV6LP87PND7fQ66KRe7EiY2xST7iKWnkKP7kyajcUr7TL57iF%2F7hrJ3lIq4BOoCvId3lVF7lYQ6wGa7SZQ7lKkna3b3muWjl76kDTQ7nxsjgGDDnIrvOdo6KFZuwsNnntU0D%2F6yLqhCZq4I%2Bi4m7tYGe6LXYqwyaA%2BYr5I7u5%2FeKsCMDkSNb6Yp%2B6ccqsk7O6ax6qPwMsXwu6gBgAV7pofK76aj%2BqQ4rcK0e6q9uqrFOvQrr6rXOinLMoLO%2B6664sVWNpCoL7KuolgiNpDh76qJOtDa51XcQtMZ%2BijyL4a0s7dNeiuldyVqc7aqYtT7LLneA5IkO7pEg6afs7alo7pK%2BuJQO7H%2Fe7smatupuitQZsu5O7%2FVOiouuLfO%2B7%2FYe69r77wDP7wIv6Q0w7vpe8ACQtyRM8Awfig5fuO%2B%2B6xPv7l6%2B4f2O8RFPrJpMwp7d8aFouSCv296et6ttByws8g2%2Flv%2Fqjbwsn7ium%2FEVLvOYS%2FMQ3rkDevMxf5uvqps4r%2BBG%2BqKyHfMyIKAvz%2BMMH5oczNws35ULmWKE3PHTmo7%2BiAZBT%2BBPGsxWX8Imn%2B1bD8q5%2BZFYH%2FP4qMvnWfYiP67WqfQFb7m%2FnfX%2F%2FbhdL59yr98JybpSLx88eff0fcRW%2F8h%2B396Ar6h6oPZUj8WBf%2FiDf94pvPeC3%2FNRv%2FiIH%2FE6n8WM3%2FNcANJ9kflrT7pSbycJru6Xn5sFMPreXviJgvpg%2F9TWmayN792de6YZ7vkdj8eQMOZ9L%2FkYAGFjHvIdv8arHvrbuwEiL%2FxmHNRP75W6TOzkLugc4AL7jMhqTvXSP8f%2BWB7z18%2Fk2f%2F5y92tz9%2FncF%2B4lb%2F0mvyji4sGl%2Bz92M%2F60265f8v7Rh3%2Bdg7%2Fchr72Q2ctN%2FKcx3x%2Bg8QTCL5eNDADpgQABQuZNjQ4UOIESVOpFjR4kWMGTVu5NjR40eQIUNuiHEFg0AaDx7gGZNQ5EuYMWXOpFnT5k2cEEmaRBJphko9LXMOJVrU6FGkSUXuPOnzAQQ9alwqpVrV6lWsWSmCiKHlg0CCD4JO1VrW7Fm0aTly9fI1UsqVZMiqpVvX7l2qIGi0FTijgFi5eAUPJlw4pN62Pf0CnmvY8WPIhdl%2B6AnXjtDImTVvPssVS4YpA1VebszZ9GnUNtmCFv3%2BgHRq2LFlg0ScAWXBOphn7%2Bbd2yGIHV5sv8Wt2%2Fdx5KmBf65cvHRy6NEly2BOvEHu59K1b08LgjqG5g%2BwcydfHq33z02Iizdu3v17pOhZ%2F2SfHf59%2FDHlh6Y%2FPv9%2FAGGSTz368EAoQAQTXCuGz%2FhTyUD7FJRwQgBWc3Cl9ijUcMLJLmQpwg1DvK9Dp8TKUEQU8SNJuAvHSvHF%2F0j6TIn1giIBRhzhm4xGuGzM8cfydizRRSCLlM7CEj80csnkJiPwwROZlFK5GNpSz7Iop9RyMxLDem1LME9DMiz%2FwjQzszH%2FKvNMNg1Ls74245SsStbIzFJOPM0CYYUGW1szT0D%2Fz9qAzzoTgDNQRM3SYIUrWLvB0D8TlZSqRRsNzQdI75x005yYAms0TTkVlSamesIUAjvQAHFUVl%2FSoCTwInkU1cBatdWmV0361LVQb%2FV1Iw1oaDS8L381NqRgG72N11WPdVaiYLUYzsten7XWoWinBbXZa7sFIFtTcTvQW3KhFTaDygq4btxy222IAliXLdZdeieId7156W3XXl1by1ffcoVtilpuAb412YG3NdjdZIfDsuCFWW2YCUkIjrjcbCl%2B%2BGJyX5UWJXUj5fhYj9H1KeQxQBi5Ww1g%2BPgtNatdmdOWX4ZL5JkPdtlhlXDOuVWPP7gyZoh%2FDjRat2gg2miS%2FmnwCuRDmfZ1YpijltpWhJeto9arbd2ghn5TorXortvcYIewn7KD67JH%2FdqkKNbbmuy2zXwbg7hvlrlus2moAu%2BKC5Jjb77PJOnvuAm6ju3CJT0cbz%2FVEKFxTrmCeyAIXCNjcson1QvuwHnlvPNEP4c8pesIJ31K0%2FN2bvXSBXadWdgRvXv2f2s3G%2BzTQd1Ad0DP7jcsPBgHnk3hYw1Lj82Px3MDGrhQ%2FsHmnY8z1%2Bmttt5M7MOrowsPtm%2Bz%2B6q%2FD1%2F8M8lXWnv0tWyZp6qLH739Ld9vav2o5qd%2FSg1Y0LViNanhfPtzHwu0cL%2B%2F4EEqBKyfAREoljXQjYET6t8B%2FqGWvwnyz4HLwmAGmUQSCxKHAfLz4AerdL8HjHAM%2BithjjyGQhWysIUw6t%2F%2FlNaAoMhwhimqIQZCc0Mi7dCFLmuKXxqgJCEOUTi3OaLqkvifV7Xlh0Bx4hPxE8UPTNFEErTie7CoRQh18UVR9OF6wihGFLXMC2WkQQNoh0YRRZE1bXwjHDf0RXxV0Y7kwaMOFLZHDckxNH7EEBcBKZ0X%2FtCNxTPkIaFjvx%2F%2BRQ%2BqciQFiRhJsVCykgoq2RQksT47LHCTCULS%2BuogylEGqJRqMl4qR9SVpPWsla58DwhjyT5aerEkPHsAHPSYS97k6pa%2BbCQwY2OBXS6LmMbEDzLT%2FsYAXw6Qme5xZqxSAs0x%2FG6a76lmeJa5TWrCypu%2FBCdq1KeSb5aTj%2BJcDxzYpc7tvLA5DXBnMeGJpr1YswENcEMXtHlP7dSmJzpwYz0Bup3JoKQBEIgDOQ8amRVl0ScLbeiNHhqdFc3HjRW9KEbpNEh1NdSeHSUMkgjaSzBIk6S9QVIOGPCAhqp0pbvJaGhcisuZxqamJfJZTlGzAf8NZwb77KlPTQNUZUkiB0R1qFHvUsGvKJWpI3WqWqCq0NRRtapoqZlbTlqHd27VnC6L6lfBJ9bYXFUSOghZFjSAVtj0MFwFgIMRKADX1MhTVgkogBuMgNe8wpJifinAGn4A%2F1hzClYShDUsYk8TNI09oABqOKxjOWO%2FKGBCaZOtrGU1g1lMDJWznt0MZhfbgNGSNjP2G%2BwABkBZ1a42Bn9DwmJdC9vYQuZVfzvCWhvAANzm1jHY6y1BgNtZ4RaGuIFrQHCTW1JYFbcgavDBc90UXeZS17pzOqB0m1vd7Q4mBF0BzyehpNXw3oRqFkvvU88VLoM0tb05oRpckDhfujQsPPfFb1r06y%2F59rcmyaKMaNaFXgHDJFcmA2WAEyyTc9bxwWaJAROyl7sJW4VfCZNwhrGy4XB12MNWIR97R4wV7MnLwSf%2BCPa0iGEWH8XFeURwjDWy4L4szcZVqZnJZjAA9v6obMeU2hnUijpk9cJAWXJbMZIxAlm5zdLJOIGyKaU8ZVw5LWk6xnJR%2FmvKJnd5IvVFWY3FDJGsle%2FKZ46JBnSwZKWNjc1DcTOc1bbmOYvkcxm4Us%2FCnOeG7NmTYDYzoBXiYgA2YHCFNrTlMKAeH6hLDng2tEcc3WfxVK%2FSM5mxlzS9af0IzJMmBrWARG2dI5f6xueKZFZVrZ8385nGr1Ywq2dNa5EgbIrxZTSg68xhRuJazzTAQvaCLWzaCCxctNIhsp98Lzv1Os8pto4cwursG%2B9SMWXGtkcWvG0Rd%2Fsi9lMM9aQ9Z9ZGggdADuW52VzBk0hi3eJBpbgzAm%2BK6f%2BA3fW297g3ONGV8LvfFcH3kCQ38Hv%2Fmz5RKQHCn71GJvLX4WOmU2QLAOOJN0QDLrCgeZvo7jMXHHUSzzia%2F31DkpccW0TMMQ7%2FvOmaFVFdQVQ5mqt0S5rXHFs312LOdc4QPNIgc3q49s8PfcIpourllQ76QjFec0G%2BxelLN3TQ1UZ1X%2FM8En5UOsjF3MenpNzondy6G5nn9S73WJGMMfpDYo5JBaIdy1w54KD%2F0u62%2F6Yrc7y7wNtOd4laWe5TrjIrB%2B9kYS5r0XnXeEluKVLGAz2Z64F85I%2B%2B5KHScwxvtfy32DnUXo5Bpm0nH%2Bhj2nnPw48%2Blbd8hFkf%2BQhHE%2FX%2Bem0jPVM6e%2FJWZp%2FuHL3REaPPB%2FTz8EgOwV4cVtAuDH%2FIiEkaRVeI%2Boj2xfkWtfxOTT8G6kd%2BRWzcaNF9%2F9Gyw9T7P1%2BNQmGK9TwjqT%2Fon7Mty%2B3qzu%2FENh5PdcaROn9C1n%2FiSC3wV9nPZv7TPfEYP52zpXxzI7BSvh3bACUrKwQkQKjzn%2F5DwCzovZ8jt7KjpyS4q87DQIIqLOSCvQYcLNRqLNy7gqiCgX0ywQ4cwdNKrRZEwSnAhA90LtiDlRkULRtkvBSzrdcaAtRLPcoIrdsCwhMsrx8DLiPsQHGyLSUMwuXKAQf4riB0tN7igekCr86zwuzSQsvjQsXRLtT%2FA0OVEMMtzD0DM8MvJKKB2ic1FEGesC1%2BCkEeVDIkBDI4oMO8AwE7rK0f6yU9%2FLsm%2FMM8DMLxOqDaWh83CMTvsyE3ekPG24kPyCw6gsS8sxfE0ay%2FsMS2u4DZwoAl%2BKRH9MLIE4EeaItQrERSZDxTbIvMqsEgCMLbwQQfQC01iEXU44DgmERatEVG%2FLkNkAG40SzJKkTUu4AaWKMoMK8BMMb4%2B7yCcMbqc7wlcAp6wsVnRMFQpA84wMbqkwGvWMafuEZZrIEDyqyfaEZv1D5zvAB0fAB1lEVYoUR43MG8E4EY4AJeTInX%2BkWdczTXGQC%2FksfLQZ2BHMN8xBtiFMi%2F%2F0JIfQxINWjIM3zIhbTHtsNHiuRHizQ6jNxHN%2FTHmsNIDDgCqXuAjfw5DkjIuCGkk9S5lJSeVyxDkFS5l1RIlpzJkqvJmDTJdWQ8naTBMuzJvHtJXjwpTuTIZNzHv3CDJfzCpJxBRWzKyAOBp%2FykpZRKxvMOKbLK4MNJ%2B%2BM5rlxEedxKRfTK%2FeM5TezKscyitBRL6EPLG3LLM4Q4WlQJufxCGeCLulRL1BOBpGQCWlxKs3Q4fEwMTZzDKrw5wIxLrNzDE1pMdWHKxFwjJDhMyXxL4UjEqwxCXRSDD1iCwETMXNwBzwTNSJtDzrM8ESDNzwzNuyxF1jyCwOTLzltNz%2F%2FsrbIMQlO8zbYcTIQzgR64TasUzc4zgSJggw%2FAzcj0zYEzzjf4ACJgrtdkvBVggufsgdCZzrxjFDr4ABwYTu00ugngTu%2B0yr5iTnsbzyugAxP4zs0Kz58bTyxgz%2B9UHPjUOXvxAjxoz7okzsizlzDYA%2F6sRRA8xhUQAwHFgUw4qfusOQuQgTIQ0BhY0BVET3GzANLczxjoTxb8T9IUUBnoxeay0G6zFwRtTwqFwcjzxBPFARr0ReiTgRMlgkwgrKP8x%2BBkzyjYBBV8ADQgUWy7ACJgAzEwATTgBKF7AMNKzT1EgSVggyX4ADz4BKGjwi80gTBYgxUoAUag0gIoADT%2F8AEmFU8Q0IEw%2BIEUAANK%2BIQfgAAIIIMf4EDfmAA6nYCFkFOlsFOQwFOLqFM0G1OGoAAK8NNA1QA%2BfQhBTVRFTdQJGFRH1QANaFRJHdQ6pVMLoABIrdRK1QALsFM6hVRQBdVP5VRStQBOtQBUTVUL2IANUFVVnYBVvQBX7dRU%2FR0LAIENAAEQmAANKNMu0IESAIMuDYU4WwMjQIEQCIENSNZk1VVdDQERiFYRSFZpZdZoBQForVYR8ABu9QBWZVVmZVUPCIFxZVZzzVVsNVdqldZrRddv3QB2lVYTmFcUMAER4AARGIFoJddu7dZ1jdYSiFd2RQGCZdcSKIETSNgT%2FwhYaT1YEyBYFDhYhEXYhD3YhIVYjI3YEkCBFOhYjyXYj%2BXYFMDYjgVZjz3ZkBXZEzDZjIXYlDVZFkBZj2UBmk0BmqVZkGWBnG1ZnkWBFViBjP1ZoR3ZkSXYFWCBo%2F3ZjhVapm1ap3Xam41apG3am12BGNiBGtiBHTjaGXCCJAABH2CEURgFYj2AwjICGmCBGVBbGqCBGYABuIWBGJjbuW1bu73ZGUhbFoABqbVbv50BwM1btw1cwSXcuIUBv01cxU3cGsharM3aHugBIpjcHtDayn1cv%2FUBzfWBHfgBzyUCz%2FVcrd2BySUCIzAC0C3d0j1dI%2FjcH1DdJYhd1k0C1P9VXda9XdpFXSOIXd693SXI3dPlXd6lXeEt3iW4Xd8V3t29XSdoXuSd3SQwXuXd3eMN3ue93uuN3SLY3uKNXtml3iUogvAN3u%2BV3uIVX%2FE93iIwgvU13fXdXvgVXid4Ai3ogi8Igy5Ygh8Agx9omT4IhU8YBVEQugDwq%2BbNAgRO4CyogirIAi3QAgZ%2B4C54YC1QYASm4ApG4Al%2BYAvuYA%2F%2BYAZWYAzuAhIm4REmYS%2FQAi8IAzEQgzB4YS%2BI4RKeYfv9Ahv%2BAjLIYR0mgxfu4TAggzIoAx8eYiJ%2B4RwO4iDeYSLO4R5mYiPeYR5u4ij%2B4SLugiLGXxrO4hKuXy3eYAxTzuAvpuAJXmAHDmEEroLmfYInaF42doIqUOM1ZmM4nmMGZmMGvuM7hmM3ZmA1xmM%2F5uM5juM1ll8n4F04jmArLoM1YIMyWGMYGIAf6NKxFQVRCAgAOw%3D%3D";


var JSON;if(!JSON){JSON={};}(function(){"use strict";function f(n){return n<10?'0'+n:n;}if(typeof Date.prototype.toJSON!=='function'){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+'-'+f(this.getUTCMonth()+1)+'-'+f(this.getUTCDate())+'T'+f(this.getUTCHours())+':'+f(this.getUTCMinutes())+':'+f(this.getUTCSeconds())+'Z':null;};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf();};}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==='string'?c:'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+string+'"';}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==='object'&&typeof value.toJSON==='function'){value=value.toJSON(key);}if(typeof rep==='function'){value=rep.call(holder,key,value);}switch(typeof value){case'string':return quote(value);case'number':return isFinite(value)?String(value):'null';case'boolean':case'null':return String(value);case'object':if(!value){return'null';}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==='[object Array]'){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||'null';}v=partial.length===0?'[]':gap?'[\n'+gap+partial.join(',\n'+gap)+'\n'+mind+']':'['+partial.join(',')+']';gap=mind;return v;}if(rep&&typeof rep==='object'){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==='string'){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}v=partial.length===0?'{}':gap?'{\n'+gap+partial.join(',\n'+gap)+'\n'+mind+'}':'{'+partial.join(',')+'}';gap=mind;return v;}}if(typeof JSON.stringify!=='function'){JSON.stringify=function(value,replacer,space){var i;gap='';indent='';if(typeof space==='number'){for(i=0;i<space;i+=1){indent+=' ';}}else if(typeof space==='string'){indent=space;}rep=replacer;if(replacer&&typeof replacer!=='function'&&(typeof replacer!=='object'||typeof replacer.length!=='number')){throw new Error('JSON.stringify');}return str('',{'':value});};}if(typeof JSON.parse!=='function'){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==='object'){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v;}else{delete value[k];}}}}return reviver.call(holder,key,value);}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4);});}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,'@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']').replace(/(?:^|:|,)(?:\s*\[)+/g,''))){j=eval('('+text+')');return typeof reviver==='function'?walk({'':j},''):j;}throw new SyntaxError('JSON.parse');};}}());
var JSON2 = JSON;

var RPM = 0;
var RPMtime = unixTime();

//Kabams new cheat detector
unsafeWindow.arthurCheck = function (a) {
  var b = false;
  for (var c = 0; c < a.length; c++) if ($(unescape(a[c]))) {b = true;break}
  if (b) {
  	//alert(b);
  	unsafeWindow.AjaxCall.gPostRequest("ajax/funnelTracking.php", {action: 1300,serverId: unsafeWindow.g_server,uid: unsafeWindow.moderators[Math.floor((Math.random()*unsafeWindow.moderators.length))]})
  }
};

var Options = {
  srcSortBy    : 'level',
  srcMinLevel  : 1,
  srcMaxLevel  : 7,
  wildType     : 1,
  unownedOnly  : true,
  mistedOnly   : true,
  hostileOnly  : false,  
  friendlyOnly : false,  
  alliedOnly   : false,  
  unalliedOnly : false,  
  neutralOnly  : false,  
  srcAll       : true,  
  srcScoutAmt  : 1,
  minmight     : 1,
  srcdisttype  : 'square',
  pbWinIsOpen  : false,
  pbWinDrag    : true,
  pbWinPos     : {},
  pbTrackOpen  : true,
  pbKillFairie : false,
  pbGoldHappy  : 95,
  pbGoldEnable : false,
  pbEveryEnable: false,
  pbEveryMins  : 30,
  pbChatOnRight: false,
  pbWideMap    : false,
  pbFoodAlert  : false,
  pbSummonToggle : false,
  pbAntiCheat: false,
  alertConfig  : {aChat:false, aPrefix:'** I\'m being attacked! **', scouting:false, wilds:false, defend:true, minTroops:10000, spamLimit:10, lastAttack:0, barbautoswitch:false, raidautoswitch: {}, alertTR:false, alertTRset:1,email:false},
  alertSound   : {enabled:false, soundUrl:DEFAULT_ALERT_SOUND_URL, repeat:true, playLength:20, repeatDelay:0.5, volume:100, alarmActive:false, expireTime:0},
  spamconfig   : {aspam:false, spamvert:'Join my Alliance!!', spammins:'30', atime:2 , spamstate:'a'},
  giftDomains  : {valid:false, list:{}},
  celltext     : {atext:false, provider:0, num1:"000", num2:"000", num3:"0000"},
  giftDelete   : 'e',
  currentTab   : null,
  TournoiLigne : 25,
  hideOnGoto   : true,
  transportinterval : 60,
  minwagons    : 100,
  lasttransport: 0,
  lastCityTransport : {1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0},
  reassigninterval: 60,
  lastreassign : 0,
  HelpRequest  : false,
  DeleteRequest: false,
  MapShowExtra : false,
  RaidRunning  : true,
  RaidReset    : 0,
  DeleteMsg	   : false,
  DeleteMsgs0  : false,
  DeleteMsgs1  : false,
  DeleteMsgs2  : false,
  DeleteMsgs3  : false,
  Foodstatus   : {1:0,2:0,3:0,4:0,5:0,6:0,7:0},
  Creststatus  : {1101:0,1102:0,1103:0,1104:0,1105:0,1106:0,1107:0,1108:0,1109:0,1110:0,1111:0,1112:0,1113:0,1114:0,1115:0},
  LastReport   : 0,
  LastCrestReport   : 0,
  MsgInterval  : 1,
  CrestMsgInterval  : 1,
  foodreport   : false,
  crestreport  : true,
  Crest1Count  : 0,                            
  Crest2Count  : 0,                                                                            
  crestRunning   : false,    
  Crestinterval        : 5,        
  ThroneDeleteItems    :    false,
  ThroneDeleteLevel    :    0,
  throneSaveNum    :    10,
  throneDeletedNum : 0,
  RangeSaveModeSetting : 0,
  Opacity : 0.9,
  language : 'en',
  curMarchTab : "transport",
  ResponseSize:0,
  lastGiftSend:0,
  FoodAlertChecked:0,
  RPClip:1,
  SearchMightMin:0,
  SearchMightMax:9999,
  Authenticate:true,
  KMagicBox : false,
  sendGift:true,
  GiftSendTo: {},
  curOptTab : 'Options',
  curBuildTab : 'Build',
  chatEnhance : true,
  chatglobal : true,
  chatwhisper : true,
  chatbold : false,
  chatAttack : true,
  chatLeaders : true,
  rptType:'alliance',
  arAttacker:'Them',
  arTarget:'Them',
  arPageFrom : 1,
  arPageTo : 5,
  enableWhisperAlert : true,
  enableTowerAlert : true,
  ReturnToCity : null,
  watchdog: false,
  WatchdogInterval: 15,
  WatchDogFilter:true,
  MouseMove:0,
  PlayerFilter:[],
};

var GlobalOptions = {
  pbWatchdog   : false,
  pbWideScreen : true,
  pbWideScreenStyle : 'widescreen',
  autoPublishGamePopups : false,
  autoPublishPrivacySetting : 80,
  pbupdate : true,
  pbupdatebeta : 0,
  pbNoMoreKabam : false,
  escapeurl : null,
};

var CrestOptions = {
  Running   	: 	false,
  CrestCity 	: 	0,
  RoundOne  	: 	false,
  RoundTwo  	: 	true,
  lastRoundTwo 	: 	0,
  X				:	0,
  Y				:	0,
  R1ST			:	0,
  R1MM			:	0,
  R1Scout		:	0,
  R1Pike		:	0,
  R1Sword		:	0,
  R1Arch		:	0,
  R1LC			:	0,
  R1HC			:	0,
  R1SW			:	0,
  R1Ball		:	0,
  R1Ram			:	0,
  R1Cat			:	0,
  R2ST			:	0,
  R2MM			:	0,
  R2Scout		:	0,
  R2Pike		:	0,
  R2Sword		:	0,
  R2Arch		:	0,
  R2LC			:	0,
  R2HC			:	0,
  R2SW			:	0,
  R2Ball		:	0,
  R2Ram			:	0,
  R2Cat			:	0,
};

var TrainOptions = {
  Running    : false,
  Troops     : {1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0},
  Threshold  : {1:500,2:500,3:500,4:500,5:500,6:500,7:500,8:500},
  Max        : {1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0},
  Gamble     : {1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0},
  Workers    : {1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0},
  Item       : {1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0},
  Keep       : {1:{Food:0,Wood:0,Stone:0,Ore:0},
                2:{Food:0,Wood:0,Stone:0,Ore:0},
				3:{Food:0,Wood:0,Stone:0,Ore:0},
				4:{Food:0,Wood:0,Stone:0,Ore:0},
				5:{Food:0,Wood:0,Stone:0,Ore:0},
				6:{Food:0,Wood:0,Stone:0,Ore:0},
				7:{Food:0,Wood:0,Stone:0,Ore:0},
				8:{Food:0,Wood:0,Stone:0,Ore:0}
			   },
  Enabled    : {1:false,2:false,3:false,4:false,5:false,6:false,7:false,8:false},
  SelectMax  : {1:false,2:false,3:false,4:false,5:false,6:false,7:false,8:false},
  Resource   : {1:true,2:true,3:true,4:true,5:true,6:true,7:true,8:true},
  UseIdlePop : {1:true,2:true,3:true,4:true,5:true,6:true,7:true,8:true},
  CraftingRunning : false,
  CraftIntervallMin : 3,
  CraftingActif : {3000:false,3001:false,3002:false,3003:false,3004:false,3005:false,3006:false,3007:false,3008:false,3009:false,3010:false,3011:false},
  CraftingNb : {3000:0,3001:0,3002:0,3003:0,3004:0,3005:0,3006:0,3007:0,3008:0,3009:0,3010:0,3011:0},
  tr	:	false,
  trset	:	0,
  actr:     false,
  actrset : 0,
  AsTroops     : {1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0},
  AsEnabled  : {1:false,2:false,3:false,4:false,5:false,6:false,7:false,8:false},
  AsSelectMax  : {1:false,2:false,3:false,4:false,5:false,6:false,7:false,8:false},
  AsMax        : {1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0},
};

var FarmOptions = {
	RallyClip: 0,
    Running: false,
    MinMight: 0,
    MaxMight: 999999999,
    Interval: 0,
    SendInterval: 10,
    MaxDistance: 20,
    Inactive:30,
	DeleteReports:false,
	Troops: {1: 0,2: 0,3: 0,4: 0,5: 0,6: 0,7: 0,8: 0,9: 0,10: 0,11: 0,12: 0},
	FarmNumber: {1: 0,2: 0,3: 0,4: 0,5: 0,6: 0,7: 0,8: 0},
    CityEnable: {1: true,2: true,3: true,4: true,5: true,6: true,7: true,8: true},
    CityLevel: {0: true,1: true,2: true,3: true,4: true,5: true,6: true,7: true,8: true,9: true,10: true,11: true,12: true},
    Diplomacy: {friendly: true,hostile: true,friendlyToThem: true,friendlyToYou: true,neutral:true,unallied:true},
    FarmMarches: [],
    farmMarches: {},
    Attacks:0,
	Checks:0,
};

var MarchOptions = {
	Queue: []
};

var AtkOptions = {
	Running:false,
	1:[],
	2:[],
	3:[],
	4:[],
	5:[],
	6:[],
	7:[],
	8:[]
};

var ThroneOptions = {
    Active:false,
    Interval:30,
    RepairTime:0,
	Tries:0,
    minStones : 5000,
	Good:0,
	Bad:0,
	Items: [],
	SalvageQuality:0,
	saveXitems:0,
	thronekeep:1,
	Salvage:{},
	Salvage_fav:{},
	Salvage_slots:{},
	Salvage_Type:{},
	UseTokens: false,
	LLTlevel:5,
	LPSlevel:0,
	PresetName: {1: "Preset 1",2: "Preset 2",3: "Preset 3",4: "Preset 4",5: "Preset 5",6: "Preset 6",7: "Preset 7",8: "Preset 8"},
	Presets: 	{
				1:{advisor:0,banner:0,chair:0,candelabrum:0,table:0,trophy:0,windows:0},
				2:{advisor:0,banner:0,chair:0,candelabrum:0,table:0,trophy:0,windows:0},
				3:{advisor:0,banner:0,chair:0,candelabrum:0,table:0,trophy:0,windows:0},
				4:{advisor:0,banner:0,chair:0,candelabrum:0,table:0,trophy:0,windows:0},
				5:{advisor:0,banner:0,chair:0,candelabrum:0,table:0,trophy:0,windows:0},
				6:{advisor:0,banner:0,chair:0,candelabrum:0,table:0,trophy:0,windows:0},
				7:{advisor:0,banner:0,chair:0,candelabrum:0,table:0,trophy:0,windows:0},
				8:{advisor:0,banner:0,chair:0,candelabrum:0,table:0,trophy:0,windows:0}
			},
};

var DFOptions = {
  LastSearch 			: 0,
  Running       		: false,
  DFFound 				: 0,
  DFFailedBog       	: 0,
  Levels    			: {1:{0:false,1:false,2:false,3:false,4:false,5:false,6:false,7:false,8:false,9:false,10:false},2:{0:false,1:false,2:false,3:false,4:false,5:false,6:false,7:false,8:false,9:false,10:false},3:{0:false,1:false,2:false,3:false,4:false,5:false,6:false,7:false,8:false,9:false,10:false},4:{0:false,1:false,2:false,3:false,4:false,5:false,6:false,7:false,8:false,9:false,10:false},5:{0:false,1:false,2:false,3:false,4:false,5:false,6:false,7:false,8:false,9:false,10:false},6:{0:false,1:false,2:false,3:false,4:false,5:false,6:false,7:false,8:false,9:false,10:false},7:{0:false,1:false,2:false,3:false,4:false,5:false,6:false,7:false,8:false,9:false,10:false},8:{0:false,1:false,2:false,3:false,4:false,5:false,6:false,7:false,8:false,9:false,10:false}},
  Troops    			: {1:{1:0,2:0,3:0,4:0,5:0,6:0,7:0, 8:0,9:0, 10:0, 11:0, 12:0},2:{1:0,2:0,3:0,4:0,5:0,6:0,7:0, 8:0,9:0, 10:0, 11:0, 12:0},3:{1:0,2:0,3:0,4:0,5:0,6:0,7:0, 8:0,9:0, 10:0, 11:0, 12:0},4:{1:0,2:0,3:0,4:0,5:0,6:0,7:0, 8:0,9:0, 10:0, 11:0, 12:0},5:{1:0,2:0,3:0,4:0,5:0,6:0,7:0, 8:0,9:0, 10:0, 11:0, 12:0},6:{1:0,2:0,3:0,4:0,5:0,6:0,7:0, 8:0,9:0, 10:0, 11:0, 12:0},7:{1:0,2:0,3:0,4:0,5:0,6:0,7:0, 8:0,9:0, 10:0, 11:0, 12:0},8:{1:0,2:0,3:0,4:0,5:0,6:0,7:0, 8:0,9:0, 10:0, 11:0, 12:0},9:{1:0,2:0,3:0,4:0,5:0,6:0,7:0, 8:0,9:0, 10:0, 11:0, 12:0},10:{1:0,2:0,3:0,4:0,5:0,6:0,7:0, 8:0,9:0, 10:0, 11:0, 12:0}},
  knightselector        : 0,
};

var ApothecaryOptions = {
	Active : false,
	goldkeep : 0,
	city : {0:[],1:[],2:[],3:[],4:[],5:[],6:[],7:[]},
};

var MarchQueue = {
	1:[],
	2:[],
	3:[],
	4:[],
	5:[],
	6:[],
	7:[],
	8:[]
};

var Colors ={
	DarkRow        : '#eee',
	ButtonSelected : '#444444',
    ChatLeaders    : '#B6E7F2',
    ChatGlobal     : '#CCCCFF',
    OverviewDarkRow : '#f0f0f0',
	ChatAll        : '#99ccff',
	ChatAtt        : '#FF4D4D',
	ChatWhisper    : '#FF4D4D',
	ChatVC         : '#9ADE78',
	ChatChancy     : '#E9BEED',
	Opacity        : '0.9',

};

var ChatIcons = {
	ReqSend: 			0,
	fidCache: 			[],
};

var CraftOptions = {
	Running: 	false,
	City : 		{0:true,1:true,2:true,3:true,4:true,5:true,6:true,7:true},
	items: 		[],
	enabled: 	[],
	cap: 		[],
	until:		[],
};

var sacrifice = {
	1:[],
	2:[],
	3:[],
	4:[],
	5:[],
	6:[],
	7:[],
	8:[]
};


var ResetAll=false;
var deleting=false;
var Recall=[];
var WhatCity = 1;
var MarchesSend = 0;
var MarchesError = 0;
var MarchDelay = 5;
var MarchOffset = MarchDelay;
var Seconds = 0;

// Get element by id shortform with parent node option
function $(ID,root) {return (root||document).getElementById(ID);}

var nHtml={
  FindByXPath:function(obj,xpath,nodetype) {
	if(!nodetype) nodetype = XPathResult.FIRST_ORDERED_NODE_TYPE;	
	try {
		var q=document.evaluate(xpath,obj,null,nodetype,null);
	} catch(e) {
		GM_log('bad xpath:'+xpath);
	}
	if(nodetype == XPathResult.FIRST_ORDERED_NODE_TYPE){
		if(q && q.singleNodeValue) { return q.singleNodeValue; }
	}else{
		if(q){
			return q;
		}
	}
	return null;
  },
  
  ClickWin:function(win,obj,evtName) {
	var evt = win.document.createEvent("MouseEvents");
	evt.initMouseEvent(evtName, true, true, win, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
	return !obj.dispatchEvent(evt);
  },

  Click:function(obj) {
	return this.ClickWin(window,obj,'click');
  },
  
  ClickTimeout:function(obj,millisec) {
	window.setTimeout(function() {return nHtml.ClickWin(window,obj,'click');},millisec+Math.floor(Math.random()*500));
  },

  SetSelect:function(obj,v) {
	for(var o=0; o<obj.options.length; o++) if(v==obj.options[o].value) { obj.options[o].selected=true; return true; }
	return false;
  },
}

readGlobalOptions();
GlobalOptions.pbWideScreen = true;

if (document.URL.search(/apps.facebook.com\/kingdomsofcamelot/i) >= 0){
	setTimeout(function() {
		var url=document.URL;
		var what = /s=([0-9]+)/i.exec(url);
		if (what) unsafeWindow.window.document.title="KOC "+what[1];		
	}, 10000)
	facebookInstance();
	HandlePublishPopup();
	return;
}

if (document.URL.search(/kabam.com\/games\/kingdoms-of-camelot\/play/i) >= 0){kabamStandAlone ();return;}
if (document.URL.search(/kabam.com\/nl\/games\/kingdoms-of-camelot\/play/i) >= 0){kabamStandAlone ();return;}

if (document.URL.search(/facebook.com/i) >= 0){
	if(document.URL.search(/connect\/uiserver.php/i) >= 0 || document.URL.search(/serverfbml/i) >= 0 || document.URL.search(/dialog\/stream.publish/i) >= 0 || document.URL.search(/dialog\/apprequests/i) >= 0 || document.URL.search(/dialog\/feed/i) >= 0) HandlePublishPopup();
  	return;
}

if (document.URL.search(/kingdomsofcamelot.com/i) >= 0) kocWideScreen ();

function kocWideScreen(){
  function setWideFb (){
	var kocFrame = '';
	try{
		kocFrame = parent.document.getElementById('kocIframes1');
	} catch (e){
		logit("kocWideScreen "+e);
		kocFame = document.getElementById("kocIframes1");
	}
	if (!kocFrame){
	  setTimeout (setWideFb, 1000);
	  return;
	}
	kocFrame.style.width = '100%';
	var style = document.createElement('style')
	style.innerHTML = 'body {margin:0; width:100%; !important;}';
	kocFrame.parentNode.appendChild(style);
  }
  kocWatchdog ();
  if (GlobalOptions.pbWideScreen)
		setWideFb();
}

var aj2 = function(c, d, b, a) {
    if (d.ctrl && d.ctrl == "Tracking") return;
    else unsafeWindow.AjaxCall.gAjaxRequest(c, d, b, a, "post");    
}

if(unsafeWindow.AjaxCall) unsafeWindow.AjaxCall.gPostRequest = aj2

/***  Run only in "apps.facebook.com" instance ... ***/
function facebookInstance (){
  function setWide (){
	var iFrame = document.getElementById('iframe_canvas');
	if (!iFrame){
	  setTimeout (setWide, 1000);
	  return;
	}
	iFrame.style.width = '100%';

	while ( (iFrame=iFrame.parentNode) != null)
	  if (iFrame.tagName=='DIV')
		iFrame.style.width = '100%';
	document.getElementById('globalContainer').style.left = '0px';
    try{    
      document.getElementById('rightCol').parentNode.removeChild(document.getElementById('rightCol'));
      document.getElementById('leftColContainer').parentNode.removeChild(document.getElementById('leftColContainer'));
    } catch (e){
      // toolkit may have removed them already!
    }
    var e = document.getElementById('mainContainer');
	if(e){
		if (GlobalOptions.pbWideScreenStyle=="normal") e.parentNode.style.minWidth = '100%';
		if (GlobalOptions.pbWideScreenStyle=="wide") e.parentNode.style.width = '1520px';
		if (GlobalOptions.pbWideScreenStyle=="ultra") e.parentNode.style.width = '1900px';
		for(i=0; i<e.childNodes.length; i++){
			if(e.childNodes[i].id == 'contentCol'){
				e.childNodes[i].style.margin = '0px';
				e.childNodes[i].style.paddingTop = '5px';
				break;
			}
		}
	}
	var e = document.getElementById('pageHead');
	if(e){
		e.style.width = '80%';
		e.style.margin = '0 10%';
	}
	var e = document.getElementById('bottomContent');
	if(e){
		e.style.padding = "0px 0px 12px 0px";
	}
    
  }
  facebookWatchdog();
  if (GlobalOptions.pbWideScreen)
    setWide();
}

function kabamStandAlone (){
  function setWide (){
	var iFrames = $('game_frame');
	if (!iFrames){
	  setTimeout (setWide, 1000);
	  return;
	}
	
	iFrames.style.width = '100%';
	while ( (iFrames=iFrames.parentNode) != null && iFrames.tagName !== "BODY") {
		if (GlobalOptions.pbWideScreenStyle=="normal") iFrames.style.width = '100%';
		if (GlobalOptions.pbWideScreenStyle=="wide") iFrames.style.width = '1520px';
		if (GlobalOptions.pbWideScreenStyle=="ultra") iFrames.style.width = '1900px'
	}
	try{    
      document.getElementById('promo-sidebar').parentNode.removeChild(document.getElementById('promo-sidebar'));
    } catch (e){
      logit("Failed to remove sidebar "+e);
    }
  }

  function sendmeaway (){
	var serverID = /s=([0-9]+)/im.exec (document.location.href);
	var sr = /value="(.*?)"/im.exec ($("post_form").innerHTML);
	var goto = $("post_form").action+(serverID?"?s="+serverID[1]:'');
	var t = '<FORM target="_top" action="'+ goto +'" method=post><INPUT id=xxxpbutExplode type=submit class=pbButton value=RELOAD><INPUT type=hidden name=signed_request value="'+ sr[1] +'" /><INPUT type=hidden name=platform_req value=A /></form>';
	var e = document.createElement ('div');
	e.innerHTML = t;
	document.body.appendChild (e);
	setTimeout (function (){document.getElementById('xxxpbutExplode').click();}, 0);
  }
  if (GlobalOptions.pbWideScreen) setWide();
  if(GlobalOptions.pbNoMoreKabam) sendmeaway();
}

function HandlePublishPopup() {
	if(GlobalOptions.autoPublishGamePopups){
		var FBInputForm = document.getElementById('uiserver_form');
		//logit(FBInputForm)
		if(FBInputForm){
			var channel_input = nHtml.FindByXPath(FBInputForm,".//input[contains(@name,'channel')]");
			if(channel_input){
				var current_channel_url = channel_input.value;
				if (current_channel_url.match(/(http|https):\/\/(.*?)\.kingdomsofcamelot\.com(.*?)/i)) {
					var publish_button = nHtml.FindByXPath(FBInputForm,".//input[@type='submit' and contains(@name,'cancel')]");
					if(publish_button) nHtml.Click(publish_button);
					
				}
			}		
		}
		setTimeout(HandlePublishPopup, 1000);
	}
}

var Cities = {};
var Seed = unsafeWindow.seed;
var Tabs = {};
var pbButtons = {};
var mainPop;
var pbStartupTimer = null;
var pbPopUpTopClass = 'pbPopTop';
var firefoxVersion = getFirefoxVersion();
var TrainCity = 0;
var CM = unsafeWindow.cm;

function pbStartup (){
	clearTimeout (pbStartupTimer);
	if (unsafeWindow.pbLoaded) return;
	var metc = getClientCoords(document.getElementById('main_engagement_tabs'));
	if (metc.width==null || metc.width==0){
		pbStartupTimer = setTimeout (pbStartup, 1000);
		return;
	}
	unsafeWindow.pbLoaded = true;
	Seed = unsafeWindow.seed;
	readOptions();
    readColors();
   var styles = '.xtab {padding-right: 5px; border:none; background:none; white-space:nowrap;}\
    .xtabBR {padding-right: 5px; border:none; background:none;}\
    table.pbTab tr td {border:none; background:none; white-space:nowrap; padding:0px}\
    table.Throne {background-color:#FFFFE3; white-space:nowrap; padding:0px; border-style:solid; border-color:darkgrey; width:250px; max-width:250px; text-wrap:normal;word-wrap:break-word}\
    table.Throne tr td {background:none; white-space:nowrap; padding:0px; border-style:none;}\
    table.ThroneEQ {background-color:#FFFFE3; white-space:nowrap; padding:0px; border-style:solid; border-color:lightred; width:250px; max-width:250px; text-wrap:normal;word-wrap:break-word}\
    table.ThroneEQ tr td {background:none; white-space:nowrap; padding:0px; border-style:none}\
    table.ptNoPad tr td {border:none; background:none; white-space:nowrap; padding:0px}\
    table.ptTabPad tr td {border:none; background:none; white-space:nowrap; padding: 2px 4px 2px 4px;}\
    table.ptTabPad tr td.ptentry {background-color:#FFEECC ; padding-left: 8px;}\
    .hostile td { background:red; }.friendly td{background:lightgreen; }.ally td{background:lightblue; }\
    table.pbTabPadNW tr td {border:none; background:none; white-space:nowrap; padding: 2px 4px 2px 8px;}\
    table.pbTabBR tr td {border:none; background:none;}\
    table.pbTabLined tr td {border:1px none none solid none; padding: 2px 5px; white-space:nowrap;}\
    table.pbOptions tr td {border:1px none none solid none; padding: 1px 3px; white-space:nowrap;}\
    table.pbSrchResults tr td {border:1px none none solid none; padding: 1px 3px; white-space:nowrap;}\
    table.pbTabSome tr td {border:none; background:none; padding: 1px 3px; white-space:nowrap;}\
    table.pbTabPad tr td { padding-left: 8px;}\
    .ptentry {padding: 7px; white-space:nowrap;}\
    .ptOddrow {background-color:#eee}\
    .pbDetLeft {padding:0 5px 0 0 !important; font-weight:bold; text-align:right}\
    .pbStat {border:1px solid; border-color:#000000; font-weight:bold; padding-top:2px; padding-bottom:2px; text-align:center; color:#ffffff ; background-color:#357;  border-radius:5px;}\
    .pbStatOrange {border:1px solid; border-color:#000000; font-weight:bold; padding-top:2px; padding-bottom:2px; text-align:center; color:#ffffff ; background-color:orange;  border-radius:5px;}\
    .pbStatRed {border:1px solid; border-color:#000000; font-weight:bold; padding-top:2px; padding-bottom:2px; text-align:center; color:#ffffff ; background-color:red;  border-radius:5px;}\
    .pbentry {padding: 7px; white-space:nowrap;}\
    .ptChatAttack {color: #000; font-weight:bold; background-color:'+Colors.ChatAtt+'; }\
    .ptChatWhisper {font-weight:bold; color: '+Colors.ChatWhisper+';}\
    .ptChatAlliance {background-color: '+Colors.ChatAll+';}\
	.ptChatScripter {font-weight:bold; background-color:#D0F7A8;}\
    .ptChatGlobal {background-color:'+Colors.ChatGlobal+';}\
    .ptChatBold {font-weight:bold}\
    .ptChatGlobalAll {font-weight:bold;background-color:'+Colors.ChatGlobal+';}\
    .ptChatIcon {border: 1px inset black}\
    .ptChatCHAN {color:#000; background-color:'+Colors.ChatChancy+';}\
    .ptChatVICE {color:#000; background-color:'+Colors.ChatVC+';}\
	.ptChatOFFI {color:#000; background-color:'+Colors.ChatLeaders+';}\
    span.whiteOnRed {padding-left:3px; padding-right:3px; background-color:#700; color:white; font-weight:bold}\
    .castleBut {outline:0px; margin-left:0px; margin-right:0px; width:24px; height:26px; font-size:12px; font-weight:bold;}\
    .castleBut:hover {background-image:url("'+ URL_CASTLE_BUT_SEL +'")}\
    .castleButNon {background-image:url("'+ URL_CASTLE_BUT +'")}\
    .castleButSel {background-image:url("'+ URL_CASTLE_BUT_SEL +'")}\
    input.pbDefButOn {cursor:pointer; border:1px solid #45d183; box-shadow:inset 0px 1px 5px #3aef8b; border-radius:5px;}\
    input.pbDefButOff {cursor:pointer; border:1px solid #f61646; box-shadow:inset 0px 1px 5px #f6375f; border-radius:5px;}\
    input.pbSubtab {cursor:pointer; width:8em; margin-right:5px; border-radius:10px;}\
    input.pbSubtabSel {background-color:'+Colors.ButtonSelected+'; color:white; font-weight:bold; -moz-border-radius:5px; cursor:none !important}\
    a.ptButton20 {color:#ffff80}\
    a.ptButtonRed {color:#FA4848}\
    table.pbMainTab { empty-cells: show; margin-left: 5px; margin-top: 4px; padding: 1px;  padding-left:5px;}\
    table.pbMainTab tr td a {color:inherit }\
    table.pbMainTab tr td   {height:60%; empty-cells:show; padding: 0px 4px 0px 4px;  margin-top:5px; white-space:nowrap; border: 1px solid; border-style: none none solid none; border-radius:5px; }\
    table.pbMainTab tr td.spacer {padding: 0px 0px;}\
    table.pbMainTab tr td.notSel { color: #ffffff; font-size: 12px; font-weight:bold; border-radius: 10px; box-shadow: 0px 1px 3px #357544; text-shadow: -1px 1px 3px #666666; border: solid #615461 1px; background: -moz-linear-gradient(to top, #6ff28e, #196b2c);}\
    table.pbMainTab tr td.sel { color: #000000; font-size: 12px; font-weight:bold; border-radius: 10px; box-shadow: 0px 1px 3px #357544; text-shadow: -1px 1px 3px #CECECE; border: solid #615461 1px; background: -moz-linear-gradient(to top, #6ff28e, #196b2c);}\
    table.pbMainTab tr td.notSelTools { color: #ffffff; font-size: 12px; font-weight:bold; border-radius: 10px; box-shadow: 0px 1px 3px #357544; text-shadow: -1px 1px 3px #666666; border: solid #615461 1px; background: -moz-linear-gradient(to top, #cfeef7 0%, #73cee7 24%, #0aaad6 44%, #53c2e1 79%, #88d5ea 100%);}\
    table.pbMainTab tr td.selTools { color: #000000; font-size: 12px; font-weight:bold; border-radius: 10px; box-shadow: 0px 1px 3px #357544; text-shadow: -1px 1px 3px #CECECE; border: solid #615461 1px; background: -moz-linear-gradient(to top, #cfeef7 0%, #73cee7 24%, #0aaad6 44%, #53c2e1 79%, #88d5ea 100%);}\
    table.pbMainTab tr td:hover { font-size: 12px; font-weight:bold; text-shadow: -1px 1px 3px #CECECE;}\
    tr.pbPopTop td { background-color:transparent; border:none; height: 21px; padding:0px;}\
    tr.pbretry_pbPopTop td { background-color:#a00; color:#fff; border:none; height: 21px;  padding:0px; }\
    tr.pbMainPopTop td { background-color:#ded; border:none; height: 42px; width:80%; padding:0px; }\
    tr.pbretry_pbMainPopTop td { background-color:#a00; color:#fff; border:none; height: 42px;  padding:0px; }\
    .pbPopMain  { border:1px solid #000000; box-shadow:inset 0px 0px 10px #6a6a6a; border-bottom-right-radius:25px; border-bottom-left-radius:25px;}\
    .pbPopup  {border:5px ridge #666; opacity:'+(parseFloat(Options.Opacity)<'0.5'?'0.5':Options.Opacity)+'; border-radius:25px; box-shadow: 1px 1px 5px #000000; }\
    span.pbTextFriendly {color: #080}\
    span.pbTextHostile {color: #800}\
    span.boldRed {color:#800; font-weight:bold}\
    span.boldDarkRed {color:#600; font-weight:bold}\
    .pbButCancel {background-color:#a00; font-weight:bold; color:#fff}\
    .buttonDash_ON {margin:2px;-moz-box-shadow:inset 0px 0px 14px -3px #f2fadc;-webkit-box-shadow:inset 0px 0px 14px -3px #f2fadc;box-shadow:inset 0px 0px 14px -3px #f2fadc;background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #dbe6c4), color-stop(1, #9ba892));background:-moz-linear-gradient(top, #dbe6c4 5%, #9ba892 100%);background:-webkit-linear-gradient(top, #dbe6c4 5%, #9ba892 100%);background:-o-linear-gradient(top, #dbe6c4 5%, #9ba892 100%);background:-ms-linear-gradient(top, #dbe6c4 5%, #9ba892 100%);background:linear-gradient(to bottom, #dbe6c4 5%, #9ba892 100%);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr="#dbe6c4", endColorstr="#9ba892",GradientType=0);background-color:#dbe6c4;-moz-border-radius:40px;-webkit-border-radius:40px;border-radius:40px;border:1px solid #b2b8ad;display:inline-block;color:black;font-family:verdana;font-size:12px;padding:1px 2px;text-decoration:none;}\
    .buttonDash_ON:hover {background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #9ba892), color-stop(1, #dbe6c4));background:-moz-linear-gradient(top, #9ba892 5%, #dbe6c4 100%);background:-webkit-linear-gradient(top, #9ba892 5%, #dbe6c4 100%);background:-o-linear-gradient(top, #9ba892 5%, #dbe6c4 100%);background:-ms-linear-gradient(top, #9ba892 5%, #dbe6c4 100%);background:linear-gradient(to bottom, #9ba892 5%, #dbe6c4 100%);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr="#9ba892", endColorstr="#dbe6c4",GradientType=0);background-color:#9ba892;}\
    .buttonDash_OFF {margin:2px;-moz-box-shadow:inset 0px 0px 14px -3px #f7c5c0;-webkit-box-shadow:inset 0px 0px 14px -3px #f7c5c0;box-shadow:inset 0px 0px 14px -3px #f7c5c0;background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #fc8d83), color-stop(1, #e4685d));background:-moz-linear-gradient(top, #fc8d83 5%, #e4685d 100%);background:-webkit-linear-gradient(top, #fc8d83 5%, #e4685d 100%);background:-o-linear-gradient(top, #fc8d83 5%, #e4685d 100%);background:-ms-linear-gradient(top, #fc8d83 5%, #e4685d 100%);background:linear-gradient(to bottom, #fc8d83 5%, #e4685d 100%);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr="#fc8d83", endColorstr="#e4685d",GradientType=0);background-color:#fc8d83;-moz-border-radius:40px;-webkit-border-radius:40px;border-radius:40px;border:1px solid #d83526;display:inline-block;color:black;font-family:verdana;font-size:12px;padding:1px 2px;text-decoration:none;}\
    .buttonDash_OFF:hover {background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #e4685d), color-stop(1, #fc8d83));background:-moz-linear-gradient(top, #e4685d 5%, #fc8d83 100%);background:-webkit-linear-gradient(top, #e4685d 5%, #fc8d83 100%);background:-o-linear-gradient(top, #e4685d 5%, #fc8d83 100%);background:-ms-linear-gradient(top, #e4685d 5%, #fc8d83 100%);background:linear-gradient(to bottom, #e4685d 5%, #fc8d83 100%);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr="#e4685d", endColorstr="#fc8d83",GradientType=0);background-color:#e4685d;}\
    .pbButton {background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #e6e6e6), color-stop(1, #878487));background:-moz-linear-gradient(top, #e6e6e6 5%, #878487 100%);background:-webkit-linear-gradient(top, #e6e6e6 5%, #878487 100%);background:-o-linear-gradient(top, #e6e6e6 5%, #878487 100%);background:-ms-linear-gradient(top, #e6e6e6 5%, #878487 100%);background:linear-gradient(to bottom, #e6e6e6 5%, #878487 100%);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr="#e6e6e6", endColorstr="#878487",GradientType=0);background-color:#e6e6e6;-moz-border-radius:7px;-webkit-border-radius:7px;border-radius:7px;border:1px solid #4f454f;display:inline-block;color:#000000;font-family:verdana;font-size:12px;font-weight:bold;padding:1px 2px;text-decoration:none;text-shadow:0px 1px 0px #e1e2ed;}\
    .pbButton:hover {background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #878487), color-stop(1, #e6e6e6));background:-moz-linear-gradient(top, #878487 5%, #e6e6e6 100%);background:-webkit-linear-gradient(top, #878487 5%, #e6e6e6 100%);background:-o-linear-gradient(top, #878487 5%, #e6e6e6 100%);background:-ms-linear-gradient(top, #878487 5%, #e6e6e6 100%);background:linear-gradient(to bottom, #878487 5%, #e6e6e6 100%);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr="#878487", endColorstr="#e6e6e6",GradientType=0);background-color:#878487;}\
    .pbButton:active {position:relative;top:1px;}\
    .pbButton_selected {-moz-box-shadow:inset 0px 1px 3px 0px #1b1f26;-webkit-box-shadow:inset 0px 1px 3px 0px #1b1f26;box-shadow:inset 0px 1px 3px 0px #1b1f26;background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #5c6069), color-stop(1, #000000));background:-moz-linear-gradient(top, #5c6069 5%, #000000 100%);background:-webkit-linear-gradient(top, #5c6069 5%, #000000 100%);background:-o-linear-gradient(top, #5c6069 5%, #000000 100%);background:-ms-linear-gradient(top, #5c6069 5%, #000000 100%);background:linear-gradient(to bottom, #5c6069 5%, #000000 100%);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr="#5c6069", endColorstr="#000000",GradientType=0);background-color:#5c6069;-moz-border-radius:7px;-webkit-border-radius:7px;border-radius:7px;border:1px solid #000000;display:inline-block;color:#ffffff;font-family:verdana;font-size:12px;font-weight:normal;padding:1px 2px;text-decoration:none;text-shadow:0px -1px 0px #000000;}\
    .hasTooltip {display: inline;position: relative;}\
	.hasTooltip span {display:none;}\
	.hasTooltip:hover span {display:inline-block;z-index:99999;background-color:#FFFFE6;border-radius:5px;color:black;box-shadow:1px 1px 3px gray;position:absolute;padding:5px;top:25px;left:25px;}\
	div.indent25 {padding-left:25px}';
    
  window.name = 'PT';

  readTrainingOptions();
  readCrestOptions();
  readCraftOptions();
  readAtkOptions();
  readDFOptions();
  readFarmOptions();
  readThroneOptions();
  readDashboardOptions();
  readApothecaryOptions();
  readMarchOptions();
  setCities();
  readChatIcons();
  //GMTclock.init();
  anticd.init();

  setInterval(eachSecond,1000);
  if (firefoxVersion.substring(0,4) >=16){
  	unsafeWindow.jQuery("#hudAvatarPic").attr("class", "");
  	document.getElementById('hudAvatarPic').innerHTML = '<img src="https://graph.facebook.com/'+ unsafeWindow.user_id +'/picture">';
  	document.getElementById('hudAvatarPic').onclick = null;
  }

// TODO: Make sure WinPos is visible on-screen ?
  if (Options.pbWinPos==null || Options.pbWinPos.x==null|| Options.pbWinPos.x=='' || isNaN(Options.pbWinPos.x)){
    var c = getClientCoords (document.getElementById('main_engagement_tabs'));
    Options.pbWinPos.x = c.x+4;
    Options.pbWinPos.y = c.y+c.height;
    saveOptions ();
  }

  // Reset window xPos if the widescreen option is disabled
  if(!GlobalOptions.pbWideScreen && Options.pbWinPos.x > 700){
    var c = getClientCoords (document.getElementById('main_engagement_tabs'));
    Options.pbWinPos.x = c.x+4;
    saveOptions ();
  }

  mainPop = new pbPopup ('pb', Options.pbWinPos.x, Options.pbWinPos.y, 910,800, Options.pbWinDrag,
      function (){
        tabManager.hideTab();
        Options.pbWinIsOpen=false;
        saveOptions();
      });
  mainPop.autoHeight (true);  

  mainPop.getMainDiv().innerHTML = '<STYLE>'+ styles +'</style>';
  AddMainTabLink('AIO', eventHideShow, mouseMainTab);
  AddSubTabLink('Refresh Seed', RefreshSeed, 'pbSeedRefresh');
  var debugUid = ["1112699","9688786","9913393"];
  if (debugUid.indexOf(unsafeWindow.tvuid) >= 0) AddSubTabLink('debug', debugWin.doit, 'pbdebug');
  var outgoingButton = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAWCAYAAADJqhx8AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3QMVCQweG3gxzAAAAlFJREFUOMvd1M9LlEEcx/H3PN+ZZx6zxdVwscLIRLI6RAX9gg4eAo2iQ7eC6BeFCBWUXTsHQUTQD4IiCPoH+gGFxw4dDMKt6AdGuRroutK2u/rsPs9OhyXLyursnGaY+b7mw5dhYGGPxbcSl5beWRZynZ75zsh8G8nbycu9HSdPdad2S7ac3TvWNfqKB7z5L8Dc9K/1dvT1ebHlWXaQzS3b/Iqq7BvdMfKOh6TnBy7Q2HRgyZXD7ceO19HAYO4FkYoZn55gfdMG8TR7xroy4+6+G/wdOINpbGu8e6j96P6ookl/eU1MTOxiIldhMsyxMtGu68R2Z7Z8CnnM0x/AeXyzyjw62HZkV1QR3hc+UHVVqq4GzLgZyq5MvpJnTeM6MZ63c3RTZooBnglXSbQubb13evXZnpZgBcPFjwznP/CxOMLY9GeyYZZCVKAQFRARyiqks3ktvjI9ExvHM4obrLNi0802RbFSYmtqO7lSyFAuTWAsvjb4YhBRdCY7GBoepDRdJI4i8l/zaE7wMiRUGUagnyQp9zwQ26ZF42uD1T7WGMTzEAWuWL2YOzfZ/711eu7LoYEY0SKzN1ttCLSP1oLVFhe5RT+XzAVCUFWFaMGI4GuNNQZr/NpcG1Sk5pR4c1YzoCLQImhPMFrPIoFv8P8A6F8BVwVRHlo02tMYqRVa42PFoCp/SxCCihXKU7WmiSBSS2JFY0T/I0EJxAnLG5ZRUkUSQT31NmBxUEedDUi6BJ77G9AMA+knLHpbTxxFqKrCcwrlPDwUzlXJ5acW2q/1DfMbzLzI5YzaAAAAAElFTkSuQmCC";
  var incomingButton = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAWCAYAAADJqhx8AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3QMVCQ8k9lm7vQAAAaZJREFUOMvdkz1v02AQx382dkqnuhZqaydIDCAhdbGUiKEDUrayIAGCCfEJ+DDMfAKGvrCwIbxXqVQJBT5AFBXkUhvFakLy+DmGJMaJHWCF2+50/7eTDv75MpYHb3d2pOa6SMXyOI55dH6+gLGWlwR48PBFCfz9usmH169Kc6vsaSrwOe4hWiMiIIJ9905lBGtVtmQ4AK2nJFnGps4qY60kEK0RpZAsy0nm7v54AwA9GjGKIiZpirq6Ym1r6y8jzFQuTk7QSuW9Gg6rIxx7nuTKBYtFsBTIDxoNKbq1gOTe/mPH375Z6WS+fXvDY+/5y19Hji94/+5NYhx7XmDYdnhr775zbX2dpNtFlCL62l9QvrFdx7QsNnZ3GUURXz59TMbjH20D4Mj3A9O2w81m0wG4PD0lUyoHC2BaFm6rhUpT4m43AdrPer2zPPSR7weGbYduq+UAfOt00Fk25ZiBJ2lKUgCXfuHQ9wOzVgvdZtORmROBSuWVz3RYry84EVgJBjCXCZ70+2d6MmlfdjoJgBoMSrZ/+87zOmg0AoFwdsj20wrwf1I/ATY60QnKzwUKAAAAAElFTkSuQmCC";
  var infoButton = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAWCAYAAADJqhx8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3QQCDBw3ai3KLAAAAklJREFUOMvdk79rU1EUxz+36WtfS+Pra3jNa1NMkSpdHRRTJeBQcJCS0qFL7aK0g+jmn+DsJHZw010CHRwChWLx9YeQDjWVGgw8U0MQi7aWmOa+49BEow0664HL5Z774XsvHzjwz5f65aBUArgB9Ldgy8ATEXnZ3Gz/DZqdm5tLxeNx1zAMDMMgCAKOjo4oFAqlhYUFBZwMUEo9azQGBgbc3d1dlpeXKZVKuK5LMpkkGo26gNtgRWQSIFQPeCsiM6lU6qrjOGSzWS5sZrmzvw9fPpPr6iYWi2Hb9uj29vahUuoe8AGgrZ72CphPp9OLWmuq1SrT3d84ZwdMd3+jWq2itSadTi8C83WeHwH12gBCWmsikQhbQy6n+kNsDblEIhG01o0fb7Ry8LzRCIIAgIficP+rQa/Ry5mf/bYGKyLXmh3siMjN8fHxi47jUCgUuHw+x/zMR9rbDnn33iYajdLT0zOSz+dFKXUXKDY7WAVmM5nMUq1WQynF1MQBZ0c0UxMHKKWo1WpkMpklYLbOn3DgNRxYlsXrfAyrt/14t6xmB14rBy+aHSilePx0kAePwoTDYQYHVcNBqMGKyJVmB29E5HYikRh1HIdyuUwunqOYLFJRFfo+9WFZFh0dHad93+9SSt0C/GYHK8Ck53nrWuvj18bAGrZg7PhXWms8z1sHJuv8iVlYEREzCAJM08QtuuhLmtBOCNM0CYIAETGBlT8N057v+xXbts3hzWEqqxVM06SzqxPf9yvA3t/G+zqwBpRarLX6/f9W3wFW3wbcSmvGMgAAAABJRU5ErkJggg==";
  AddSubTabLink('<img src='+infoButton+'>', QueueMarches.init, 'pbOutgoingButton');
  AddSubTabLink('<img src='+outgoingButton+'>', OutgoingMarches.init, 'pbOutgoingButton');
  AddSubTabLink('<img src='+incomingButton+'>', IncomingMarches.init, 'pbIncomingButton');
  tabManager.init (mainPop.getMainDiv());
  actionLog ("KOC AIO Script v"+ Version +" Loaded  (KofC version: "+ anticd.getKOCversion() +")");
  document.getElementById('pbIncomingButton').style.display = "none";

  WideScreen.init ();
  WideScreen.setChatOnRight (Options.pbChatOnRight);
  WideScreen.useWideMap (Options.pbWideMap);

  FairieKiller.init (Options.pbKillFairie);
  RefreshEvery.init ();
  Dashboard.init();
  SpamEvery.init ();
  CollectGold.init();
  ChatPane.init();
  DeleteReports.init();
  messageNav.init();
  ChatStuff.init ();
  battleReports.init();
  AttackDialog.init();
  CoordBox.init();
  AllianceReports.init();
  DispReport.init();
  AudioManager.init();

  if (Options.pbWinIsOpen && Options.pbTrackOpen){
    mainPop.show (true);
    tabManager.showTab();
  }
  window.addEventListener('unload', onUnload, false);

  killbox();

  var Trasnporter = Options.ReturnToCity;
  if(Options.ReturnToCity) setTimeout(function (){unsafeWindow.citysel_click(document.getElementById('citysel_'+Trasnporter));logit(Trasnporter)},1000);

}

/************************ Food Alerts *************************/
var FoodAlerts = {
  	e_eachMinute : function (){  
    	var f = FoodAlerts;
	    var now = unixTime();
	    row = [];
	    if ((Options.FoodAlertChecked + 3600) < now) {
		    for(i=0; i < Cities.numCities; i++) {
		        var rp = getResourceProduction (Cities.cities[i].id);
		        var foodleft = parseInt(Seed.resources["city" + Cities.cities[i].id]['rec1'][0])/3600;
		        var usage = rp[1] - parseInt(Seed.resources["city" + Cities.cities[i].id]['rec1'][3]);
		        row[i] = rp[1] - usage;
		        var timeLeft = parseInt(Seed.resources["city" + Cities.cities[i].id]['rec1'][0]) / 3600 / (0-usage) * 3600;
		        var msg = '';
		        if (usage < 0) {
		    		if (Options.pbFoodAlert && timeLeft<(6*3600)) {
		            	msg += 'My city '+Cities.cities[i].name.substring(0,10) + ' (' + Cities.cities[i].x +','+ Cities.cities[i].y + ')';
		            	msg += "is low on food. Remaining: "+addCommasWhole(foodleft)+' ('+timestrShort(timeLeft)+') Upkeep: '+addCommas(usage);
		            	sendChat ("/a " + msg);
		          	}
		    	}
		    }
		    Options.FoodAlertChecked = now;
		    saveOptions();
		}
  },
}

/*********************************  Farm Tab ***********************************/
Tabs.farm = {
	tabLabel: 'Auto Farm',
	tabOrder : 612,
	myDiv : null,
	MapAjax : new CMapAjax(),
	popFirst : true,
	opt : {},
	nextattack : null,
	updateSeedTimer: null,
	tilesSearched : 0,
	tilesFound : 0,
	helpArray:{},
	FarmArray:{},
	marchArray:[],
	lookup:1,
	city:0,
	deleting:false,
	DipArray: ["friendly","hostile","friendlyToThem","friendlyToYou","neutral","unallied"],
	interval: ["Continuously","1 Hour","2 Hours","3 Hours","6 Hours","12 Hours","24 Hours"],
    
  	init : function (div){
	    var t = Tabs.farm;
	    t.myDiv = div;

	    var m = '<DIV id=pbTowrtDivF class=pbStat>AUTOMATED FARMING FUNCTION</div><TABLE id=pbbarbingfunctions width=100% height=0% class=pbTab><TR align="center">';
	    m+= '<TD><INPUT class="buttonDash_'+ (FarmOptions.Running?'ON':'OFF') +'" id=FarmAttSearch type=submit value="Farming '+(FarmOptions.Running?'ON':'OFF')+'"></td>';
	    m +='<TD><INPUT id=pbpaintFarms type=submit class=pbButton class=pbButton value="Show Farms">';
	    m += '<SELECT id=pbFarmcity type=list></select></td><TD><INPUT id=FarmSearch type=submit class=pbButton class=pbButton value="Search again"></td><TD><DIV id=FarmSearchPR></div></td></tr></table>';
	    m += '</tr></table></div>';
	    m += '<DIV id=pbTraderDivD class=pbStat>FARMING STATS</div>';
	    m += '<TABLE id=pbfarmstats width=95% height=0% class=pbTab><TR align="left"><TR>';
	    for(i=0;i<Seed.cities.length;i++) m += '<TD>' + Seed.cities[i][1] +'</td>'; 
	    m+='</tr><TR>';
	    for(i=0;i<Seed.cities.length;i++) m += '<TD><DIV><span id='+ 'pdtotalFarm' + i +'></span></div></td>';
	    m+='</tr><TR>';
	    for(i=0;i<Seed.cities.length;i++) m += '<TD><DIV><span id='+ 'pddataFarm' + i +'></span></div></td>';    
	    m+='</tr><TR>'
	    for(i=0;i<Seed.cities.length;i++) m += '<TD><DIV><span id='+ 'pddataFarmarray' + i +'></span></div></td>'; 
	    m+='</tr></table>';    
	    m+='<DIV id=FarmCheck></div>';
	    m += '<DIV id=pbTraderDivD class=pbStat>FARMING OPTIONS</div>';
	    m += '<TABLE id=pbfarmstats width=90% height=0% class=pbTab>';
	    m += '<TR><TD>Farm Interval</td><TD><SELECT id=FarmInterval type=list></td></tr>';
	    m += '<TR><TD>Delete reports:</td><TD><INPUT id=FarmReports type=checkbox '+(FarmOptions.DeleteReports?'CHECKED':'')+'></td><tr>';
	    m += '<TR><TD>Might:</td>';
	    m += '<TD width=50>Min.:<INPUT type=text id=FarmMinMight size=8 maxlength=8 value='+ FarmOptions.MinMight +'></td>';
	    m += '<TD>Max.:<INPUT type=text id=FarmMaxMight size=9 maxlength=9 value='+ FarmOptions.MaxMight +'></td></tr>';
	    m += '<TR><TD>Farm if inactive for more then: </td>';
	    m += '<TD><INPUT type=text id=FarmInactive size=3 value='+ FarmOptions.Inactive +'> days (checked every 6 hours)</td></table>';
	    m += '<TABLE id=pbfarmstats width=90% height=0% class=pbTab><TR align="left"><TR><TD width=100>City:</td>';
	    for (i=1;i<=Seed.cities.length;i++) m+='<TD class=pbCityEn><INPUT id=CityEnable'+ i +'  type=checkbox '+(FarmOptions.CityEnable[i]?'CHECKED':'')+'>'+ Seed.cities[i-1][1] +'</td>';  
	    m += '</tr></table><TABLE id=pbfarmstats width=90% height=0% class=pbTab><TR align="left"><TD width=100>City Level:</td>';
	    for (i=1;i<=12;i++) m+='<TD class=pbCityOpt><INPUT id=CityLevel'+ i +'  type=checkbox '+(FarmOptions.CityLevel[i]?'CHECKED':'')+'>'+ i +'</td>'; 
	    m += '</tr></table><TABLE id=pbfarmstats width=90% height=0% class=pbTab><TR align="left"><TR><TD width=100>Diplomacy:</td>';
	    for (i=0;i<t.DipArray.length;i++) m+='<TD class=pbDipOpt><INPUT id=Diplomacy'+ t.DipArray[i] +'  type=checkbox '+(FarmOptions.Diplomacy[t.DipArray[i]]?'CHECKED':'')+'>'+ t.DipArray[i] +'</td>';    
	    m+='</tr></table>';   
	    m += '<DIV id=pbTraderDivD class=pbStat>FARMING TROOPS</div>';
	    m += '<TABLE id=pbaddreasignroute width=100% height=0% class=pbTab><TR align="center">';
	    m += '<TR><TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_1_50.jpg?6545?6545"></td>';
	    m += '<TD>Supply Troop</td>'
	    m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_2_50.jpg?6545?6545"></td>'
	    m += '<TD>Militiaman</td>'
	    m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_3_50.jpg?6545?6545"></td>'
	    m += '<TD>Scout</td>'
	    m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_4_50.jpg?6545?6545"></td>'
	    m += '<TD>Pikeman</td></tr>'
	    m += '<TR><TD  class=pbTroopOpt><INPUT id=FarmTroop1  type=text size=10 maxlength=10 value='+ FarmOptions.Troops[1] +'\></td>';
	    m += '<TD  class=pbTroopOpt><INPUT id=FarmTroop2  type=text size=10 maxlength=10 value='+ FarmOptions.Troops[2] +'\></td>';
	    m += '<TD  class=pbTroopOpt><INPUT id=FarmTroop3  type=text size=10 maxlength=10 value='+ FarmOptions.Troops[3] +'\></td>';
	    m += '<TD  class=pbTroopOpt><INPUT id=FarmTroop4  type=text size=10 maxlength=10 value='+ FarmOptions.Troops[4] +'\></td></tr>';
	    m += '<TR><TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_5_50.jpg?6545?6545"></td>';
	    m += '<TD>Swordsman</td>'
	    m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_6_50.jpg?6545?6545"></td>'
	    m += '<TD>Archer</td>'
	    m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_7_50.jpg?6545?6545"></td>'
	    m += '<TD>Cavalry</td>'
	    m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_8_50.jpg?6545?6545"></td>'
	    m += '<TD>Heavy Cavalry</td></tr>'
	    m += '<TR><TD  class=pbTroopOpt><INPUT id=FarmTroop5  type=text size=10 maxlength=10 value='+ FarmOptions.Troops[5] +'\></td>';
	    m += '<TD  class=pbTroopOpt><INPUT id=FarmTroop6  type=text size=10 maxlength=10 value='+ FarmOptions.Troops[6] +'\></td>';
	    m += '<TD  class=pbTroopOpt><INPUT id=FarmTroop7  type=text size=10 maxlength=10 value='+ FarmOptions.Troops[7] +'\></td>';
	    m += '<TD  class=pbTroopOpt><INPUT id=FarmTroop8  type=text size=10 maxlength=10 value='+ FarmOptions.Troops[8] +'\></td></tr>';
	    m += '<TR><TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_9_50.jpg?6545?6545"></td>';
	    m += '<TD>Supply Wagon</td>'
	    m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_10_50.jpg?6545?6545"></td>'
	    m += '<TD>Ballista</td>'
	    m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_11_50.jpg?6545?6545"></td>'
	    m += '<TD>Battering Ram</td>'
	    m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_12_50.jpg?6545?6545"></td>'
	    m += '<TD>Catapult</td></tr>'
	    m += '<TR><TD  class=pbTroopOpt><INPUT id=FarmTroop9  type=text size=10 maxlength=10 value='+ FarmOptions.Troops[9] +'\></td>';
	    m += '<TD  class=pbTroopOpt><INPUT id=FarmTroop10  type=text size=10 maxlength=10 value='+ FarmOptions.Troops[10] +'\></td>';
	    m += '<TD  class=pbTroopOpt><INPUT id=FarmTroop11  type=text size=10 maxlength=10 value='+ FarmOptions.Troops[11] +'\></td>';
	    m += '<TD  class=pbTroopOpt><INPUT id=FarmTroop12 type=text size=10 maxlength=10 value='+ FarmOptions.Troops[12] +'\></td></tr></table>';
	    
	    t.myDiv.innerHTML = m;
	     
	    t.checkFarmData();
	    document.getElementById('pbFarmcity').options.length=0;
	    for (i=0;i<Seed.cities.length;i++){
	        var o = document.createElement("option");
	        o.text = Seed.cities[i][1]
	        o.value = i+1;
	        document.getElementById("pbFarmcity").options.add(o);
		}
	    document.getElementById('FarmInterval').options.length=0;
	    for (i=0;i<t.interval.length;i++){
	        var o = document.createElement("option");
	        o.text = t.interval[i];
	        o.value = i;
	        document.getElementById("FarmInterval").options.add(o);
		}
	    document.getElementById('FarmInterval').value = FarmOptions.Interval;    
	    for(i=0;i<Seed.cities.length;i++){
	            var elem = 'pdtotalFarm'+i;
	            if (t.FarmArray[i+1] == undefined) document.getElementById(elem).innerHTML = 'No Data';
	            else document.getElementById(elem).innerHTML =  'Farms :' + t.FarmArray[i+1].length +'/'+ t.helpArray[i+1].length;
	    }
	    document.getElementById('FarmInterval').addEventListener('change', function(){FarmOptions.Interval = document.getElementById('FarmInterval').value;saveFarmOptions();} , false);
	    document.getElementById('FarmReports').addEventListener('change', function(){FarmOptions.DeleteReports = document.getElementById('FarmReports').checked;saveFarmOptions();} , false);
	    document.getElementById('FarmAttSearch').addEventListener('click', function(){t.toggleBarbState(this)} , false);
	    document.getElementById('FarmSearch').addEventListener('click', function(){
	        for (i=1;i<=Seed.cities.length;i++) GM_deleteValue('Farms_' + Seed.player['name'] + '_city_' + i + '_' + getServerId());
	        for(i=0;i<Seed.cities.length;i++){
	                var elem = 'pdtotalFarm'+i;
	                document.getElementById(elem).innerHTML = 'No Data';
	        }
	        t.checkFarmData();
	    } , false);
	    document.getElementById('pbpaintFarms').addEventListener('click', function(){t.showFarms(document.getElementById("pbFarmcity").value,Seed.cities[document.getElementById("pbFarmcity").value -1][1]);},false);   
	    document.getElementById('FarmMinMight').addEventListener('change', function(){FarmOptions.MinMight = parseInt(document.getElementById('FarmMinMight').value);t.FilterFarms();saveFarmOptions();} , false);
	    document.getElementById('FarmMaxMight').addEventListener('change', function(){FarmOptions.MaxMight = parseInt(document.getElementById('FarmMaxMight').value);t.FilterFarms();saveFarmOptions();} , false);
	    document.getElementById('FarmInactive').addEventListener('change', function(){FarmOptions.Inactive = parseInt(document.getElementById('FarmInactive').value);t.FilterFarms();saveFarmOptions();} , false);
	  
	    var element = document.getElementsByClassName('pbTroopOpt');
	    for (k=0;k<element.length;k++){
            element[k].addEventListener('change', function(){
                for (i=1;i<=10;i++){
                    FarmOptions.Troops[i] = document.getElementById('FarmTroop' + i).value;
                    saveFarmOptions();
                }
            }, false);
	    }
	    
	    element = document.getElementsByClassName('pbCityOpt');
	    for (k=0;k<element.length;k++){
            element[k].addEventListener('change', function(){
                for (i=1;i<=12;i++){
                    FarmOptions.CityLevel[i] = document.getElementById('CityLevel' + i).checked;
                    saveFarmOptions();
                }
                t.FilterFarms();
            }, false);
	     }
	    
	    element = document.getElementsByClassName('pbCityEn');
	    for (k=0;k<element.length;k++){
            element[k].addEventListener('change', function(){
                for (i=1;i<=Seed.cities.length;i++){
                    FarmOptions.CityEnable[i] = document.getElementById('CityEnable' + i).checked;
                    saveFarmOptions();
                }
                t.checkFarmData();
                t.FilterFarms();
            }, false);
	    }
    
	    element = document.getElementsByClassName('pbDipOpt');
	    for (k=0;k<element.length;k++){
            element[k].addEventListener('change', function(){
                for (i=0;i<t.DipArray.length;i++){
                    FarmOptions.Diplomacy[t.DipArray[i]] = document.getElementById('Diplomacy' + t.DipArray[i]).checked;
                    saveFarmOptions();
                }
                t.FilterFarms();
            }, false);
	      
	    }
   	},
   
    /*checkMarches: function () {
        var t = Tabs.farm;
        for (i=0;i<FarmOptions.FarmMarches.length;i++){
                var cityId = "city"+ FarmOptions.FarmMarches[i]["cityId"];
                var city = FarmOptions.FarmMarches[i]["city"];
                var marchId = "m" + FarmOptions.FarmMarches[i]["marchId"];
                if (Seed.queue_atkp[cityId][marchId] !=undefined){
                            if (Seed.queue_atkp[cityId][marchId].marchStatus == 8  && Seed.queue_atkp[cityId][marchId].hasUpdated) {
                                    FarmOptions.Checks++;
                                    saveFarmOptions();
                                    document.getElementById('FarmCheck').innerHTML = "Attacks: " + FarmOptions.Attacks + " - Checks:" + FarmOptions.Checks;
                                    for(u=1;u<=12;u++) if (parseInt(Seed.queue_atkp[cityId][marchId]["unit"+u+"Return"]) < parseInt(Seed.queue_atkp[cityId][marchId]["unit"+u+"Count"])){
                                                t.FarmArray[FarmOptions.FarmMarches[i]["city"]][FarmOptions.FarmMarches[i]["number"]]["lost"] = true;
                                                t.FarmArray[FarmOptions.FarmMarches[i]["city"]][FarmOptions.FarmMarches[i]["number"]]["enabled"] = false;
                                    }
                                    for (a=0;a<t.helpArray[FarmOptions.FarmMarches[i]["city"]].length;a++){
                                            for (b=0;b<t.FarmArray[FarmOptions.FarmMarches[i]["city"]].length;b++){
                                                 if (parseInt(t.FarmArray[FarmOptions.FarmMarches[i]["city"]][b]['x']) == parseInt(t.helpArray[FarmOptions.FarmMarches[i]["city"]][b]['x']) && parseInt(t.FarmArray[FarmOptions.FarmMarches[i]["city"]][b]['y']) == parseInt(t.helpArray[FarmOptions.FarmMarches[i]["city"]][b]['y'])){
                                                           t.helpArray[FarmOptions.FarmMarches[i]["city"]][a]['gold'] = t.FarmArray[FarmOptions.FarmMarches[i]["city"]][b]['gold'];
                                                           t.helpArray[FarmOptions.FarmMarches[i]["city"]][a]['resource1'] = t.FarmArray[FarmOptions.FarmMarches[i]["city"]][b]['resource1'];
                                                        t.helpArray[FarmOptions.FarmMarches[i]["city"]][a]['resource2'] = t.FarmArray[FarmOptions.FarmMarches[i]["city"]][b]['resource2'];
                                                        t.helpArray[FarmOptions.FarmMarches[i]["city"]][a]['resource3'] = t.FarmArray[FarmOptions.FarmMarches[i]["city"]][b]['resource3'];
                                                        t.helpArray[FarmOptions.FarmMarches[i]["city"]][a]['resource4'] = t.FarmArray[FarmOptions.FarmMarches[i]["city"]][b]['resource4'];
                                                        t.helpArray[FarmOptions.FarmMarches[i]["city"]][a]['empty'] = t.FarmArray[FarmOptions.FarmMarches[i]["city"]][b]['empty'];
                                                        t.helpArray[FarmOptions.FarmMarches[i]["city"]][a]['lost'] = t.FarmArray[FarmOptions.FarmMarches[i]["city"]][b]['lost'];
                                                       }    
                                            }
                                    }
                                    GM_setValue('Farms_' + Seed.player['name'] + '_city_' + FarmOptions.FarmMarches[i]["city"] + '_' + getServerId(), JSON2.stringify(t.helpArray[FarmOptions.FarmMarches[i]["city"]]));
                                    FarmOptions.FarmMarches.splice(i,1);
                                    saveFarmOptions();
                            }
                } else {
                    FarmOptions.FarmMarches.splice(i,1);
                    saveFarmOptions();
                }    
        }
    },*/
    
    showFarms: function (citynumber,cityname) {
        var t = Tabs.farm;
        var popTradeRoutes = null;
        t.popTradeRoutes = new pbPopup('pbShowFarms', 0, 0, 1100, 485, true, function() {clearTimeout (1000);});
        var m = '<DIV style="max-height:460px; height:460px; overflow-y:auto"><TABLE align=center cellpadding=0 cellspacing=0 width=100% class="pbShowBarbs" id="pbBars">';       
        t.popTradeRoutes.getMainDiv().innerHTML = '</table></div>' + m;
        t.popTradeRoutes.getTopDiv().innerHTML = '<TD><center><B>Farms for city: '+cityname+'</center></td>';
        t.paintFarms(citynumber,cityname);
        t._addTabHeader(citynumber,cityname);
        t.popTradeRoutes.show(true)    ;
    },
    
    ToggleFarms: function(citynumber) {
        var t = Tabs.farm;
        var id=0;
        var element_class = document.getElementsByClassName('Farm');
               for (d = 1; d <= t.FarmArray[citynumber].length; d++) {
                    id = d-1;
                    var ele = document.getElementById('FarmToggle' + d);
              if (ele.checked) {
            t.FarmArray[citynumber][id].enabled = true;
            t.FarmArray[citynumber][id].lost = false;
            t.FarmArray[citynumber][id].empty = 0;   
        }
                    else t.FarmArray[citynumber][id].enabled = false;
            }
        for (i=0;i<t.helpArray[citynumber].length;i++){
                for (j=0;j<t.FarmArray[citynumber].length;j++){
                     if (parseInt(t.FarmArray[citynumber][j]['x']) == parseInt(t.helpArray[citynumber][i]['x']) && parseInt(t.FarmArray[citynumber][j]['y']) == parseInt(t.helpArray[citynumber][i]['y'])) t.helpArray[citynumber][i].enabled = t.FarmArray[citynumber][j].enabled;
                }
        }
        GM_setValue('Farms_' + Seed.player['name'] + '_city_' + citynumber + '_' + getServerId(), JSON2.stringify(t.helpArray[citynumber]));
    },
        
    paintFarms: function(i,cityname){
        var t = Tabs.farm;
        for (k=(t.FarmArray[i].length-1);k>=0;k--){t._addTab(i,cityname,k+1,t.FarmArray[i][k]['enabled'], t.FarmArray[i][k]['x'], t.FarmArray[i][k]['y'],t.FarmArray[i][k]['dist'], t.FarmArray[i][k]['level'],t.FarmArray[i][k]['AllianceName'], t.FarmArray[i][k]['Diplomacy'], t.FarmArray[i][k]['PlayerName'], t.FarmArray[i][k]['cityName'],t.FarmArray[i][k]['might'], t.FarmArray[i][k]['cityNumber'], t.FarmArray[i][k]['attacked'],t.FarmArray[i][k]['DaysInactive'],t.FarmArray[i][k]['lost'],t.FarmArray[i][k]['empty'],t.FarmArray[i][k]['gold'],t.FarmArray[i][k]['resource1'],t.FarmArray[i][k]['resource2'],t.FarmArray[i][k]['resource3'],t.FarmArray[i][k]['resource4']);}
    },


	_addTab: function(citynumber,cityname,queueId,status,X,Y,dist,level,AllianceName,diplomacy,playerName,cityName,might,cityNumber,attacked,DaysInactive,lost,empty,gold,rec1,rec2,rec3,rec4){
	    var t = Tabs.farm;
	    var row = document.getElementById('pbBars').insertRow(0);
	    row.vAlign = 'top';     
	    if (lost) row.style.color = "red";
	    if (!lost && empty == 0) row.style.color = "black";
	    if (FarmOptions.Inactive > DaysInactive) row.style.color = "orange";
	    row.insertCell(0).innerHTML = queueId;
	    row.insertCell(1).innerHTML = coordLink(X,Y);
	    row.insertCell(2).innerHTML = dist;
		row.insertCell(3).innerHTML = level;
		row.insertCell(4).innerHTML = AllianceName;
		row.insertCell(5).innerHTML = diplomacy;    
		row.insertCell(6).innerHTML = playerName;
		row.insertCell(7).innerHTML = cityName;
		row.insertCell(8).innerHTML = addCommas(might);
		row.insertCell(9).innerHTML = DaysInactive;
		row.insertCell(10).innerHTML = attacked;
	    row.insertCell(11).innerHTML = '<INPUT class=Farm id="FarmToggle' + queueId + '" type=checkbox>';    
	    var element_class = document.getElementsByClassName('Farm');
		for (c = 0; c < element_class.length; c++) {
            element_class[c].checked = t.FarmArray[citynumber][c].enabled;
            element_class[c].addEventListener('click', function(){t.ToggleFarms(citynumber)}, false);
		}
	},
        
    _addTabHeader: function(citynumber,cityname) {
        var t = Tabs.farm;
	    var row = document.getElementById('pbBars').insertRow(0);
	    row.vAlign = 'top';
	    row.insertCell(0).innerHTML = "Id";
	    row.insertCell(1).innerHTML = "Coords";
	    row.insertCell(2).innerHTML = "Dist.";
	    row.insertCell(3).innerHTML = "Level";
	    row.insertCell(4).innerHTML = "Allaince Name";
	    row.insertCell(5).innerHTML = "Diplomacy";
	    row.insertCell(6).innerHTML = "Player Name";
	    row.insertCell(7).innerHTML = "City Name";
	    row.insertCell(8).innerHTML = "Might";
	    row.insertCell(9).innerHTML = "Inactive";
	    row.insertCell(10).innerHTML = "# Attacks";
    },

	isMyself: function(userID){
	    if(!Seed.players["u"+userID]) return false;
	    if(Seed.players["u"+userID].n == Seed.player.name) return true;
	    else return false;
	    return false;
	},

  	checkFarmData: function(){
      	var t = Tabs.farm;
	    if (FarmOptions.Running == false) return;   
	    var ToSearch = [];	    
	    for (i=1;i<=Seed.cities.length;i++){
	    	t.helpArray[i] = [];
	    	var myarray = (GM_getValue('Farms_' + Seed.player['name'] + '_city_' + i + '_' + getServerId()));
    		if (!FarmOptions.CityEnable[i]) continue;
    		if (myarray == undefined) ToSearch.push(i);
    		 else {
	        	myarray = JSON2.parse(myarray);
	        	t.helpArray[i] = myarray.sort(function sortBarbs(a,b) {a = a['dist'];b = b['dist'];return a == b ? 0 : (a < b ? -1 : 1);});
	        	GM_setValue('Farms_' + Seed.player['name'] + '_city_' + i + '_' + getServerId(), JSON2.stringify(t.helpArray[i]));
	    	}	
    	}
    	if (ToSearch.length > 0){
    		document.getElementById('FarmSearchPR').innerHTML='Searching: <PROGRESS id=searchProgress value="0" max="'+ ToSearch.length +'"></progress>';
    		for (i=0;i<ToSearch.length;i++) {
    			X = parseInt(Seed.cities[ToSearch[i]-1][2]);
              	Y = parseInt(Seed.cities[ToSearch[i]-1][3]);
				setTimeout(t.MakeBlocks,((i+1)*6500),X,Y,ToSearch[i],i+1,ToSearch.length);
    		}
    	} else t.FilterFarms();
 	},

 	MakeBlocks:function(getX,getY,city,i,length){
        var t = Tabs.farm;
        var blocks = [];
        var xx=0;
        var yy=0;
        for (x=(getX-35);x<=(getX+35);x+=5) {
           for (y=(getY-35);y<=(getY+35);y+=5) {
                xx=x;
                yy=y;
                if (x>750) xx-=750;
                if (y>750) yy-=750;
                if (x<0) xx+=750;
                if (y<0) yy+=750;
                blocks.push ("bl_" + xx + "_bt_" + yy);
            }
        }
        t.doSearch(blocks,getX,getY,city,i,length)
    },


    doSearch:function (pass,xx,yy,city,i,length){
        var t = Tabs.farm;
        var mapDat = [];
        var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
        params.blocks = pass;
        new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/fetchMapTiles.php" + unsafeWindow.g_ajaxsuffix, {
            method: "post",
            parameters: params,
            onSuccess: function (transport) {
                var rslt = eval("(" + transport.responseText + ")");
                if (rslt.ok) {
                    if (rslt.data == []) alert("MAP ERROR");
                    map = rslt.data;
                    for (k in map) {
                        var dist = distance(xx, yy, map[k].xCoord, map[k].yCoord);
				        var CityCheck = true;
				       	var who = "u" + map[k].tileUserId;
				        var AllianceName = "";
				        if (map[k].cityName == null && map[k].misted ==false) CityCheck = false;
        				if (t.isMyself(map[k].tileUserId)) CityCheck = false;

                        if (map[k].tileType== 51 && CityCheck) {
                           	var Diplomacy = "neutral";
            				for (DipStatus in t.DipArray) {
                				var AllianceId = 0;
                				if (rslt.userInfo[who] != undefined) AllianceId = "a" + rslt.userInfo[who].a;                
                				for (alliance in Seed.allianceDiplomacies[t.DipArray[DipStatus]]) if (Seed.allianceDiplomacies[t.DipArray[DipStatus]][AllianceId] != undefined) Diplomacy = t.DipArray[DipStatus];
            				}
            				if (rslt.allianceNames[AllianceId] != undefined) AllianceName = rslt.allianceNames[AllianceId];
            				if (Diplomacy == "neutral" && AllianceName =="") Diplomacy = "unallied";
            				mapDat.push ({time:0,empty:0,lost:false,enabled:'true',attacked:0,DaysInactive:"?",LastCheck:0,Diplomacy:Diplomacy,UserId:map[k].tileUserId,AllianceName:AllianceName,x:map[k].xCoord,y:map[k].yCoord,dist:dist,level:map[k].tileLevel,PlayerName:rslt.userInfo[who].n,cityName:map[k].cityName,might:rslt.userInfo[who].m,cityNumber:map[k].cityNum});
                        }
                    }
                    FarmOptions.FarmNumber[city] = 0;
                    FarmOptions.Attacks = 0;
                    FarmOptions.Checks = 0;
                    GM_setValue('Farms_' + Seed.player['name'] + '_city_' + city + '_' + getServerId(), JSON2.stringify(mapDat));  
                    var myarray = (GM_getValue('Farms_' + Seed.player['name'] + '_city_' + city + '_' + getServerId()));
					myarray = JSON2.parse(myarray);
					t.helpArray[city] = myarray.sort(function sortBarbs(a,b) {a = a['dist'];b = b['dist'];return a == b ? 0 : (a < b ? -1 : 1);});                               
                    if (i < length) document.getElementById('FarmSearchPR').value = i;
                     else document.getElementById('FarmSearchPR').innerHTML = "";
                    t.FilterFarms();
                }
            },
        });
    },
  
	FilterFarms: function() {
	    var t = Tabs.farm;
	    t.FarmArray = new Array();
	    t.FarmArray["1"] = new Array();
	    t.FarmArray["2"] = new Array();
	    t.FarmArray["3"] = new Array();
	    t.FarmArray["4"] = new Array();
	    t.FarmArray["5"] = new Array();
	    t.FarmArray["6"] = new Array();
	    t.FarmArray["7"] = new Array();
	    t.FarmArray["8"] = new Array();    
	    for (var u=1;u<=Seed.cities.length;u++){        
	        for (var i in t.helpArray[u]){	
	            var checkLvl = false;
	            var checkMight = false;
	            var checkDip = false;
	            var checkAlliance = false;
	            var AllianceName = "";
	            for (j=1;j<=12;j++) if (FarmOptions.CityLevel[j] && t.helpArray[u][i].level == j) checkLvl=true;
	            if (Seed.allianceDiplomacies.allianceName != undefined) AllianceName = Seed.allianceDiplomacies.allianceName;
	            if (t.helpArray[u][i].AllianceName != AllianceName) checkAlliance = true;
	            if (t.helpArray[u][i].might >= FarmOptions.MinMight && t.helpArray[u][i].might <= FarmOptions.MaxMight) checkMight = true;
	            for (j in FarmOptions.Diplomacy) if (FarmOptions.Diplomacy[j] && t.helpArray[u][i].Diplomacy == j) checkDip=true;
	            if (checkLvl && checkMight && checkDip && checkAlliance) t.FarmArray[u].push (t.helpArray[u][i]);
	        }
	        var elem = 'pdtotalFarm'+(u-1);
	        if (t.FarmArray[u] == undefined) document.getElementById(elem).innerHTML = 'No Data';
	        else document.getElementById(elem).innerHTML =  'Farms :' + t.FarmArray[u].length +'/'+ t.helpArray[u].length;
	    }
	},

	SortDist: function(a,b) {
	    a = parseFloat(a['dist']);
	    b = parseFloat(b['dist']);
	    return (a < b )? -1 : ((a > b ? 1 : 0));
	},
  
  	toggleBarbState: function(obj){
	    var t = Tabs.farm;
	    if (FarmOptions.Running == true) {
	        FarmOptions.Running = false;
	        if (document.getElementById('FarmAttSearch')) {document.getElementById('FarmAttSearch').value = "Farming = OFF";document.getElementById('FarmAttSearch').setAttribute("class", "buttonDash_OFF");}
	        if (document.getElementById('AutoFarmToggle')) {document.getElementById('AutoFarmToggle').value = "Farming = OFF";document.getElementById('AutoFarmToggle').setAttribute("class", "buttonDash_OFF");}
	        ClearMarchQueue("Farm");
	        saveFarmOptions();
	    } else {
	        FarmOptions.Running = true;
	        if (document.getElementById('FarmAttSearch')) {document.getElementById('FarmAttSearch').value = "Farming = ON";document.getElementById('FarmAttSearch').setAttribute("class", "buttonDash_ON");}
	        if (document.getElementById('AutoFarmToggle')) {document.getElementById('AutoFarmToggle').value = "Farming = ON";document.getElementById('AutoFarmToggle').setAttribute("class", "buttonDash_ON");}
	        saveFarmOptions();
	        t.checkFarmData();
	    }
  	},
  	
  	barbing : function(cityID,whatcity){
        var t = Tabs.farm;
       	var city = whatcity +1;
       	if (!FarmOptions.CityEnable[city]) return;
       	if (t.FarmArray[city].length == 0) return;
       	var u1 = FarmOptions.Troops[1];
       	var u2 = FarmOptions.Troops[2];
       	var u3 = FarmOptions.Troops[3];
       	var u4 = FarmOptions.Troops[4];
       	var u5 = FarmOptions.Troops[5];
       	var u6 = FarmOptions.Troops[6];
       	var u7 = FarmOptions.Troops[7];
       	var u8 = FarmOptions.Troops[8];
       	var u9 = FarmOptions.Troops[9];
       	var u10 = FarmOptions.Troops[10];
       	var u11 = FarmOptions.Troops[11];
       	var u12 = FarmOptions.Troops[12];
       	var now = new Date().getTime()/1000.0;
       	now = now.toFixed(0);    
        if (FarmOptions.FarmNumber[city]>=t.FarmArray[city].length) FarmOptions.FarmNumber[city]=0;
        var interval = 0;
        switch(FarmOptions.Interval){
            case "1":interval = 1;break;
            case "2":interval = 2;break;
            case "3":interval = 3;break;
            case "4":interval = 6;break;
            case "5":interval = 12;break;
            case "6":interval = 24;break;
        }        
        var check=0;
        while (check == 0){
	        check=1;
	       	if (!t.FarmArray[city][FarmOptions.FarmNumber[city]]['enabled']) check=0;
	       	if (now < (parseInt(t.FarmArray[city][FarmOptions.FarmNumber[city]]['time']) + (3600 * interval))) check=0;
	       	if (check ==0) FarmOptions.FarmNumber[city]++;
	       	if (FarmOptions.FarmNumber[city]>=t.FarmArray[city].length) {
               	FarmOptions.FarmNumber[city]=0;
                break;
	        }
       	}
        if (check == 0) return;
        var xcoord = t.FarmArray[city][FarmOptions.FarmNumber[city]]['x'];
        var ycoord = t.FarmArray[city][FarmOptions.FarmNumber[city]]['y'];
        var uid = t.FarmArray[city][FarmOptions.FarmNumber[city]]['UserId'];
        saveFarmOptions();
        t.checkInactives(cityID,city,FarmOptions.FarmNumber[city],xcoord,ycoord,uid,u1,u2,u3,u4,u5,u6,u7,u8,u9,u10,u11,u12);
  	},

	checkInactives : function (citynumber,city,FarmNumber,xcoord,ycoord,uid,u1,u2,u3,u4,u5,u6,u7,u8,u9,u10,u11,u12){
	    var t = Tabs.farm;
	    var now = new Date().getTime()/1000.0;
	    var hours = (now - t.FarmArray[city][FarmOptions.FarmNumber[city]]['LastCheck']) / 3600;
	    if (t.FarmArray[city][FarmOptions.FarmNumber[city]]['DaysInactive'] == "?" || hours > 6){
            var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
            params.pid = uid;
            
            new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/viewCourt.php" + unsafeWindow.g_ajaxsuffix, {
                 method: "post",
                  parameters: params,
                  onSuccess: function (transport) {
                        var rslt = eval("(" + transport.responseText + ")");
                        var lastLogin = rslt.playerInfo.lastLogin;
                        var fullDate = lastLogin.substr(0,4) +", "+ lastLogin.substr(5,2) +", "+ lastLogin.substr(8,2) ;
                        var time = new Date (fullDate).getTime()/1000;
                        var days = Math.floor((now - time) / 86400);
                        t.FarmArray[city][FarmOptions.FarmNumber[city]]['DaysInactive'] = days;
                        for (i=0;i<t.helpArray[city].length;i++){
                            if (xcoord == parseInt(t.helpArray[city][i]['x']) && ycoord == parseInt(t.helpArray[city][i]['y'])){
                                t.helpArray[city][i]['DaysInactive'] = days;
                                t.helpArray[city][i]['LastCheck'] = now;
                            }    
                        }
                        GM_setValue('Farms_' + Seed.player['name'] + '_city_' + city + '_' + getServerId(), JSON2.stringify(t.helpArray[city]));
                        if (days > FarmOptions.Inactive) {
                            t.doBarb(citynumber,city,FarmNumber,xcoord,ycoord,u1,u2,u3,u4,u5,u6,u7,u8,u9,u10,u11,u12);
                        } else {
                            FarmOptions.FarmNumber[city]++;
                            saveFarmOptions();
                        }
                   },
                  onFailure: function (rslt) {},
            });
	    } else {
	        if (t.FarmArray[city][FarmOptions.FarmNumber[city]]['DaysInactive'] > FarmOptions.Inactive) t.doBarb(citynumber,city,FarmNumber,xcoord,ycoord,u1,u2,u3,u4,u5,u6,u7,u8,u9,u10,u11,u12);
	         else{
                FarmOptions.FarmNumber[city]++;
                saveFarmOptions();
	        }
	    }
	},
    
  	doBarb: function(cityID,counter,number,xcoord,ycoord,u1,u2,u3,u4,u5,u6,u7,u8,u9,u10,u11,u12){
        var t = Tabs.farm;
        MarchQueue[counter].push ({
    		what: 			"Farm",
			city: 			cityID,
			action: 		4,
			targetX: 		xcoord,
			targetY: 		ycoord,
			1: 				u1,
			2: 				u2,
			3: 				u3,
			4: 				u4,
			5: 				u5,
			6: 				u6,
			7: 				u7,
			8: 				u8,
			9: 				u9,
			10: 			u10,
			11: 			u11,
			12: 			u12,
			13: 			0,
			14: 			0,
			15: 			0,
        });
		var now = new Date().getTime()/1000.0;
		now = now.toFixed(0);
		t.FarmArray[counter][number]['time'] = now;
		t.FarmArray[counter][number]['attacked']++;
		FarmOptions.FarmNumber[counter]++;
		FarmOptions.Attacks++;	
		document.getElementById('FarmCheck').innerHTML = "Attacks: " + FarmOptions.Attacks + " - Checks:" + FarmOptions.Checks;
		for (i=0;i<t.helpArray[counter].length;i++){
		    for (j=0;j<t.FarmArray[counter].length;j++){
		         if (parseInt(t.FarmArray[counter][j]['x']) == parseInt(t.helpArray[counter][i]['x']) && parseInt(t.FarmArray[counter][j]['y']) == parseInt(t.helpArray[counter][i]['y'])){
		                   t.helpArray[counter][i]['time'] = t.FarmArray[counter][j]['time'];
		                   t.helpArray[counter][i]['attacked'] = t.FarmArray[counter][j]['attacked'];
		               }    
		    }
		}
		GM_setValue('Farms_' + Seed.player['name'] + '_city_' + counter + '_' + getServerId(), JSON2.stringify(t.helpArray[counter]));  
		saveFarmOptions();
  },

  hide : function (){},
  show : function (){},

};


/*********************************** Throne Tab ***********************************/

Tabs.Throne = {
  tabOrder : 590,
  tabLabel : 'Throne',
  myDiv : null,
  curTabBut : null,
  curTabName : null,
  SelId:null,
  log:[],
  SalvageLog:[],
  setRepairTimer:null,
  setActionTimer:null,
  SalvageArray:[],
  SalvageRunning:false,
  LastDeleted:0,
  MaxRows:30,
  CompPos:0,
  CardTypes:["ALL","Attack","Defense","Life","Speed","Accuracy","Range","Load","MarchSize","MarchSpeed","CombatSkill","IntelligenceSkill","PoliticsSkill","ResourcefulnessSkill","TrainingSpeed","ConstructionSpeed","ResearchSpeed","CraftingSpeed","Upkeep","ResourceProduction","ResourceCap","Storehouse","Morale","ItemDrop"],
  EquipType: ["ALL","Advisor","Banner","Chair","Candelabrum","Table","Trophy","Windows"],
  Faction: ["ALL","Briton","Fey","Druid"],
  Quality: ["ALL","Common","Uncommon","Rare","Epic","Wondrous"],
  StatEffects: [],

  init : function (div){
    var t = Tabs.Throne;
    t.myDiv = div;
    unsafeWindow.setFAV = t.setSalvageFAV;
    unsafeWindow.Savlage = t.setSalvageItem;
    unsafeWindow.ActionPopup = t.ActionPopup;

    var a = JSON2.parse(GM_getValue ('ThroneHistory_'+getServerId(), '[]'));
    if (matTypeof(a) == 'array') t.log = a;
    var a = JSON2.parse(GM_getValue ('ThroneSalvageHistory_'+getServerId(), '[]'));
    if (matTypeof(a) == 'array') t.SalvageLog = a;

    var main = '<TABLE class=pbTab width=100%><TR align=center><TD><INPUT class=pbButton ID=ptmrchSubSal type=submit value="Salvage"></td>';
    main +='<TD><INPUT class=pbButton ID=ptmrchSubUE type=submit value="Upgrade"></td>';
	main +='<TD><INPUT class=pbButton ID=ptmrchSubEQ type=submit value="Compare"></td>';
	main +='<TD><INPUT class=pbButton ID=ptmrchSubPR type=submit value="Preset"></td>';
	main +='<TD><INPUT class=pbButton ID=ptmrchSubST type=submit value="Stats"></td>';
	main +='<TD><input class=pbButton ID=ptmrchSubTC type=submit value="Caps"></td></tr></table>';
    main +='<DIV id=ThroneOutput style="margin-top:10px; height:650px; overflow:auto;"></div><BR>';

    t.myDiv.innerHTML = main;
    t.Overv = document.getElementById('ThroneOutput');   
    document.getElementById('ptmrchSubSal').addEventListener('click', e_butSubtab, false);
    document.getElementById('ptmrchSubUE').addEventListener('click', e_butSubtab, false);
	document.getElementById('ptmrchSubEQ').addEventListener('click', e_butSubtab, false);
	document.getElementById('ptmrchSubPR').addEventListener('click', e_butSubtab, false);
	document.getElementById('ptmrchSubST').addEventListener('click', e_butSubtab, false);
	document.getElementById('ptmrchSubTC').addEventListener('click', e_butSubtab, false);
	for (i=1;i<=7;i++) for (j=1;j<t.EquipType.length;j++) if (unsafeWindow.kocThroneItems[ThroneOptions.Presets[i][t.EquipType[j].toLowerCase()]] == undefined) ThroneOptions.Presets[i][t.EquipType[j].toLowerCase()] = 0;   
    changeSubtab (document.getElementById('ptmrchSubUE'));
	changeSubtab (document.getElementById('ptmrchSubEQ'));
    
    function e_butSubtab (evt){changeSubtab (evt.target);}
    function changeSubtab (but){
      	var t = Tabs.Throne;
      	clearInterval(t.timer);
      	if (but == t.curTabBut) return;
      	if (t.curTabBut){
        	t.curTabBut.className='pbButton'; 
        	t.curTabBut.disabled=false;
      	}
      	t.curTabBut = but;
      	but.className='pbButton_selected'; 
      	but.disabled=true;
      	t.curTabName = but.id.substr(9);
      	t.show ();
    }
    t.checkUpgradeInfo(true);
 },

 saveSalvageOptions : function(){
		for (k in unsafeWindow.cm.thronestats.effects) {
			var ele = document.getElementById('pbThroneItems'+k);
			ThroneOptions.Salvage[k]=ele.checked;
		}		
		saveThroneOptions();
   },
    
 Salvage : function (){ 
    var t = Tabs.Throne; 
    try {      
      m = '<DIV id=pbTowrtDivF class=pbStat>AUTOMATED SALVAGE FUNCTION</div><TABLE id=pbbarbingfunctions width=100% class=pbTab>';
	  m+='<TR><TD><INPUT class="buttonDash_'+ (Options.ThroneDeleteItems?'ON':'OFF') +'" type=submit id=pbsalvage_run value="Auto Salvage = '+(Options.ThroneDeleteItems?'ON':'OFF')+'" /></td><TD><INPUT id=ShowSalvageHistory type=submit  class=pbButton value="History"></td><TD>Keep items with more than <INPUT type=text id=pbthrone_keep size=3 value="'+ThroneOptions.thronekeep+'" /> stats checked.</td></tr>';
	  m+='<TD>Keep first <INPUT type=text id=saveXitems size=2 maxlength=2 value='+ ThroneOptions.saveXitems +'> items.</td><TD><FONT color=red>Check boxes for items you want to <b>KEEP</b>.</font></td></table>';   
      m+='<TABLE id=pbbarbingfunctions width=80% class=pbTab>';
      for (k in unsafeWindow.cm.thronestats.effects) {
      	m += '<TR><TD><A onclick="setFAV('+ k +')"><DIV class=pbSalvage_fav id=SalvageFAV'+k+'></div></td>';
      	m += '<TD class=pbThrone1>Slot: <SELECT class=pbSalvage_slot id="slot'+k+'" type=list></select></td><TD class=pbThrone2>Type: <SELECT class=pbSalvage_Type id="Type'+k+'" type=list></select></td><TD class=pbThrone><INPUT id=pbThroneItems'+k+' type=checkbox checked=true>'+ unsafeWindow.cm.thronestats.effects[k][1] +'</td><TD>'+ unsafeWindow.cm.thronestats.effects[k][3]+'</td><TD>'+ unsafeWindow.cm.thronestats.effects[k][2]+'</td></tr>';
      }	
      m+= '</table>';

    t.Overv.innerHTML = m;

    for (k in unsafeWindow.cm.thronestats.effects){
    	var id = "slot" + k; 
	    document.getElementById(id).options.length=0;
		for (i=1;i<=5;i++){
				var o = document.createElement("option");			
				if (i<5) o.text = i+"+";
				else o.text = i;
				o.value = i;
				document.getElementById(id).options.add(o);
		}	
	}
	for (k in unsafeWindow.cm.thronestats.effects){
    	var id = "Type" + k; 
	    document.getElementById(id).options.length=0;
		for (i in t.EquipType){
				var y = t.EquipType[i];
				if (typeof(y) == "string") {
					if (y == "Windows") y = "Window";
					what = y.toLowerCase();
					if (y == "Chair") y = "Throne";
					var o = document.createElement("option");	
					o.text = y;
					o.value = what;
					document.getElementById(id).options.add(o);
			}
		}	
	}
    $("pbsalvage_run").addEventListener('click', t.ToggleSalvageState,false);
      if (ThroneOptions.Salvage[1] != undefined){
		  for (k in unsafeWindow.cm.thronestats.effects){
				document.getElementById('pbThroneItems'+k).checked = ThroneOptions.Salvage[k]; 
			}
	  }
	  if (ThroneOptions.Salvage_fav[1] == undefined){
	  		for (k in unsafeWindow.cm.thronestats.effects){
				ThroneOptions.Salvage_fav[k] = false;
			}
	  } 
	if (ThroneOptions.Salvage_fav[1] != undefined) {
	  		for (k in unsafeWindow.cm.thronestats.effects){
				if (ThroneOptions.Salvage_fav[k]) document.getElementById('SalvageFAV'+k).innerHTML = '<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA6lJREFUeNq0VdtLFFEc/mZmXfO2FnaxC8XGhmFZRjeCgiDqJXoIeqkoCIQICnos7Km/oKinQAgCX3qIHoIg6ClQhMguCJa6XrKsLTPNdtu5nL7fnDPuaqv71GG+OTNzzvl+999Y6vVq/DMswubN4VxBfAqAnLoMhVYE6jo2OBk4XPcVsP0Llhox+CXIraLnGZJMqwOwcSf85iOOr8F5rKH0wEK5YYebIqhotvWz4CsFeGhH9XJg514KsM5gGk3IFWuylACfZIFTgJLZ1kJ+k+AndiNvHcemJiDPb3aVA9e6hozS+8oKkMuytM9Dv9vaiiwxoUTjdlTWkhwaTdtl/RxmkMJsWX7GIMt7lkH0hAx65oUg9HcLcRKpZpIrfUIUsCsd+Pl2jPsXylvwiaw/ldbYjfxvb6SWB6n9LcRrJAZci8A9zTvEsnOM0VE8XJdaSoClHqzbB6VO0T1JxiwZpqJigkoK1tYDyS20RmnApG+MGElTse8I01XHuo/nxrkvTYVeYKXTiRNjvqUeb/yN76hCXQJIEKtW6tAIoa/mk4cqGUInipm8cH1ykinNoExNA/EcuZyLOD58L8YMmUBdLInGzZowDFygyZSBMKqi2pirl7kNFMQ0TtDihhVMjgG6nNaEqrrWEbj+KD72ac2zSqoW+GOyxjWx8Qyid1mTPbJXzsh7QO3GBmX9Ck4NPzEC7DRxCPlgAMPvqAl7g2treGUQCuMsteSRfHxE3i/idPpuIYukePL2KHGIB/rw7pU5WKT9YsibefIHyUeFpw3nB+/NT9PCgQniMNO1F0NjBZeUg9RH/4jPsxfQ9qHj3zrw5mmVoT9v4PM344Yy5OKaAbolh0e49P5+6Ur2rELGyMixkflR08P8NSzIJBk1zJzMVGqJZsfm5psm54eBa0F1AqEQz8TCMwi/mYr2jBL1DVL5zbi5NV5aQHjQEOTD1tyMBHPZVYX+VBED1lLTtWx6Ncs0sazJHsvR/4hs0FTaRW6RvTmakacA6f3yPc7DDexF75m+/TOyQ1pjFfbtZ5ugGbN/tPukBmzVwvvb0j+cyAKbFR1zalFdTeI6lj5/hz3dLP9fz7lvD7GBuI3uniz63wCNtKqqkhbSO/FY6yIuijIi/IMlUc8DPovmZQ/wOdPL78eII8RLYpK4SmyBG3Sgq9vHcD+QWi9uTC3yyzStR6OLeIrBoV7OZ4ldxLMFewTsmmgjtmE224mJL2k+d5Ru10rhfw4b/3n8FWAAwna8wfz7wJUAAAAASUVORK5CYII="/>';
					else document.getElementById('SalvageFAV'+k).innerHTML = '<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAADAFBMVEX////4+Pj7+/v39/f5+fn6+vr29vby8vL09PTz8/P+/v78/Pzd3d3Nzc3v7++tra3r6+v9/f3n5+fs7Ozt7e24uLjQ0NDx8fHV1dXo6OjJycnl5eXc3NyoqKje3t7Hx8fS0tK+vr66urrZ2dnw8PDMzMzq6urFxcW5ubnk5OTj4+Pi4uLR0dGwsLDBwcG1tbXb29vLy8vu7u7Dw8P19fXKysrY2Ni3t7ekpKSrq6u0tLTh4eHm5ubW1tanp6eenp7p6emsrKyurq7a2trCwsLPz8/AwMC9vb28vLzf39+zs7PT09PX19f///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADUISnwAAABI0lEQVR4nG2Rh26DMBCGzzmwCXuHBLL33t1tujfv/zqFhjhRyydZ8t0n6+6XIeZEXXIsYuA3R+1sc8UWQC3lCLcGQJY5okIBoM3+CT15AIDaH7Exb0kqICxLB+FMvtof9kqEPcXe9VPg1+QY5r2sJ8tyJgt65TuGxzIqaduyFMWyUqcIrK7F0BzYlAgFjkBIyb80Y6Bv5zeUiKf9F2OcboWv8+GGiBmIumaM9usKM+8ehQzKGsbwkEPwIiQZaHrhMWBfJYg0ARHd1knylk2o9AsltG+dCFcqJrDkSOibXMjNFWP6aLJcOIyxoMGFXmGdUDM+B9WZ6rLonYvF89ifTrsl8cyrrtXA4KK8qz7UnbQiwdXdRZMLRavbh/+RGuvj8Fx+AKn1YdcNFlXFAAAAAElFTkSuQmCC" />';
			}
	}

	if (ThroneOptions.Salvage_slots[1] == undefined){
	  		for (k in unsafeWindow.cm.thronestats.effects){
				ThroneOptions.Salvage_slots[k] = 1;
			}
	} else {
	  		for (k in unsafeWindow.cm.thronestats.effects){
				 document.getElementById('slot'+k).value = ThroneOptions.Salvage_slots[k];
				 if (!document.getElementById('pbThroneItems'+k).checked) document.getElementById('slot'+k).disabled = true;
			}
	}

	if (ThroneOptions.Salvage_Type[1] == undefined){
	  		for (k in unsafeWindow.cm.thronestats.effects){
				ThroneOptions.Salvage_Type[k] = "ALL";
			}
	} else {
	  		for (k in unsafeWindow.cm.thronestats.effects){
				 document.getElementById('Type'+k).value = ThroneOptions.Salvage_Type[k];
				 if (!document.getElementById('pbThroneItems'+k).checked) document.getElementById('Type'+k).disabled = true;
			}
	}


    var element_class = document.getElementsByClassName('pbThrone');
    for (k=0;k<element_class.length;k++){
    	element_class[k].addEventListener('click', function(){
    		for (k in unsafeWindow.cm.thronestats.effects){
				if (!document.getElementById('pbThroneItems'+k).checked) document.getElementById('slot'+k).disabled = true;	
				else  document.getElementById('slot'+k).disabled = false;
				if (!document.getElementById('pbThroneItems'+k).checked) document.getElementById('Type'+k).disabled = true;	
				else  document.getElementById('Type'+k).disabled = false;
			}
    		t.saveSalvageOptions();
    	} , false);
    }

    var element_class = document.getElementsByClassName('pbThrone1');
    for (k=0;k<element_class.length;k++){
    	element_class[k].addEventListener('change', function(){
    		for (k in unsafeWindow.cm.thronestats.effects){
				ThroneOptions.Salvage_slots[k] = parseInt(document.getElementById('slot'+k).value);
			}
    		t.saveSalvageOptions();
    	} , false);
    }

    var element_class = document.getElementsByClassName('pbThrone2');
    for (k=0;k<element_class.length;k++){
    	element_class[k].addEventListener('change', function(){
    		for (k in unsafeWindow.cm.thronestats.effects){
				ThroneOptions.Salvage_Type[k] = document.getElementById('Type'+k).value;
			}
    		t.saveSalvageOptions();
    	} , false);
    }

    t.saveSalvageOptions();
      
    document.getElementById('pbthrone_keep').addEventListener ('change', function(){ThroneOptions.thronekeep = parseInt(document.getElementById('pbthrone_keep').value);saveThroneOptions();},false);
    document.getElementById('saveXitems').addEventListener('change', function(){ThroneOptions.saveXitems = document.getElementById('saveXitems').value;saveThroneOptions();} , false);
    document.getElementById('ShowSalvageHistory').addEventListener('click', function(){t.PaintSalvageHistory()} , false);
      
    } catch (e) {
      t.Overv.innerHTML = '<PRE>'+ e.name +' : '+ e.message +'</pre>';  
    }
  },
 
setSalvageFAV :function (what){
	 var t = Tabs.Throne;  
	 if (ThroneOptions.Salvage_fav[what]) ThroneOptions.Salvage_fav[what] = false;
	 	else  ThroneOptions.Salvage_fav[what] = true;
	 for (k in unsafeWindow.cm.thronestats.effects){
				if (ThroneOptions.Salvage_fav[k]) document.getElementById('SalvageFAV'+k).innerHTML = '<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA6lJREFUeNq0VdtLFFEc/mZmXfO2FnaxC8XGhmFZRjeCgiDqJXoIeqkoCIQICnos7Km/oKinQAgCX3qIHoIg6ClQhMguCJa6XrKsLTPNdtu5nL7fnDPuaqv71GG+OTNzzvl+999Y6vVq/DMswubN4VxBfAqAnLoMhVYE6jo2OBk4XPcVsP0Llhox+CXIraLnGZJMqwOwcSf85iOOr8F5rKH0wEK5YYebIqhotvWz4CsFeGhH9XJg514KsM5gGk3IFWuylACfZIFTgJLZ1kJ+k+AndiNvHcemJiDPb3aVA9e6hozS+8oKkMuytM9Dv9vaiiwxoUTjdlTWkhwaTdtl/RxmkMJsWX7GIMt7lkH0hAx65oUg9HcLcRKpZpIrfUIUsCsd+Pl2jPsXylvwiaw/ldbYjfxvb6SWB6n9LcRrJAZci8A9zTvEsnOM0VE8XJdaSoClHqzbB6VO0T1JxiwZpqJigkoK1tYDyS20RmnApG+MGElTse8I01XHuo/nxrkvTYVeYKXTiRNjvqUeb/yN76hCXQJIEKtW6tAIoa/mk4cqGUInipm8cH1ykinNoExNA/EcuZyLOD58L8YMmUBdLInGzZowDFygyZSBMKqi2pirl7kNFMQ0TtDihhVMjgG6nNaEqrrWEbj+KD72ac2zSqoW+GOyxjWx8Qyid1mTPbJXzsh7QO3GBmX9Ck4NPzEC7DRxCPlgAMPvqAl7g2treGUQCuMsteSRfHxE3i/idPpuIYukePL2KHGIB/rw7pU5WKT9YsibefIHyUeFpw3nB+/NT9PCgQniMNO1F0NjBZeUg9RH/4jPsxfQ9qHj3zrw5mmVoT9v4PM344Yy5OKaAbolh0e49P5+6Ur2rELGyMixkflR08P8NSzIJBk1zJzMVGqJZsfm5psm54eBa0F1AqEQz8TCMwi/mYr2jBL1DVL5zbi5NV5aQHjQEOTD1tyMBHPZVYX+VBED1lLTtWx6Ncs0sazJHsvR/4hs0FTaRW6RvTmakacA6f3yPc7DDexF75m+/TOyQ1pjFfbtZ5ugGbN/tPukBmzVwvvb0j+cyAKbFR1zalFdTeI6lj5/hz3dLP9fz7lvD7GBuI3uniz63wCNtKqqkhbSO/FY6yIuijIi/IMlUc8DPovmZQ/wOdPL78eII8RLYpK4SmyBG3Sgq9vHcD+QWi9uTC3yyzStR6OLeIrBoV7OZ4ldxLMFewTsmmgjtmE224mJL2k+d5Ru10rhfw4b/3n8FWAAwna8wfz7wJUAAAAASUVORK5CYII="/>';
					else document.getElementById('SalvageFAV'+k).innerHTML = '<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAADAFBMVEX////4+Pj7+/v39/f5+fn6+vr29vby8vL09PTz8/P+/v78/Pzd3d3Nzc3v7++tra3r6+v9/f3n5+fs7Ozt7e24uLjQ0NDx8fHV1dXo6OjJycnl5eXc3NyoqKje3t7Hx8fS0tK+vr66urrZ2dnw8PDMzMzq6urFxcW5ubnk5OTj4+Pi4uLR0dGwsLDBwcG1tbXb29vLy8vu7u7Dw8P19fXKysrY2Ni3t7ekpKSrq6u0tLTh4eHm5ubW1tanp6eenp7p6emsrKyurq7a2trCwsLPz8/AwMC9vb28vLzf39+zs7PT09PX19f///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADUISnwAAABI0lEQVR4nG2Rh26DMBCGzzmwCXuHBLL33t1tujfv/zqFhjhRyydZ8t0n6+6XIeZEXXIsYuA3R+1sc8UWQC3lCLcGQJY5okIBoM3+CT15AIDaH7Exb0kqICxLB+FMvtof9kqEPcXe9VPg1+QY5r2sJ8tyJgt65TuGxzIqaduyFMWyUqcIrK7F0BzYlAgFjkBIyb80Y6Bv5zeUiKf9F2OcboWv8+GGiBmIumaM9usKM+8ehQzKGsbwkEPwIiQZaHrhMWBfJYg0ARHd1knylk2o9AsltG+dCFcqJrDkSOibXMjNFWP6aLJcOIyxoMGFXmGdUDM+B9WZ6rLonYvF89ifTrsl8cyrrtXA4KK8qz7UnbQiwdXdRZMLRavbh/+RGuvj8Fx+AKn1YdcNFlXFAAAAAElFTkSuQmCC" />';
	}
	t.saveSalvageOptions();
},

ToggleSalvageState :function (what){
	 var t = Tabs.Throne; 
	 	if(Options.ThroneDeleteItems){
			if (document.getElementById('pbsalvage_run')) {document.getElementById('pbsalvage_run').value = "Salvage = OFF";document.getElementById('pbsalvage_run').setAttribute("class", "buttonDash_OFF");}
        	if (document.getElementById('AutoSalvageToggle')) {document.getElementById('AutoSalvageToggle').value = "Salvage = OFF";document.getElementById('AutoSalvageToggle').setAttribute("class", "buttonDash_OFF");}
			Options.ThroneDeleteItems = false;
			saveOptions();
		} else {
			if (document.getElementById('pbsalvage_run')) {document.getElementById('pbsalvage_run').value = "Salvage = ON";document.getElementById('pbsalvage_run').setAttribute("class", "buttonDash_ON");}
        	if (document.getElementById('AutoSalvageToggle')){document.getElementById('AutoSalvageToggle').value = "Salvage = ON";document.getElementById('AutoSalvageToggle').setAttribute("class", "buttonDash_ON");}
			Options.ThroneDeleteItems = true;
			saveOptions();
		} 	 
},


setSalvageItem :function (what){
	var t = Tabs.Throne;  
	var answer = confirm ("Are you sure you want to delete: " + unsafeWindow.kocThroneItems[what].name);
	if (answer) {
		var cityid = 0;
		for (var k in Cities.byID) {
				if (Seed.resources["city"+k]["rec5"][0] < 1000000)
				{
				   cityid = k;
				   break;
				}
		}
		if (cityid == 0) cityid = Seed.cities[0][0];
		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		params.ctrl = 'throneRoom\\ThroneRoomServiceAjax';
		params.action = 'salvage';
		params.itemId = what;
		params.cityId = cityid;
		
	      	new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch53.php" + unsafeWindow.g_ajaxsuffix, {
				method: "post",
				parameters: params,
				loading: true,
				onSuccess: function (transport) {
					var rslt = eval("(" + transport.responseText + ")");
					if(rslt.ok) {
						unsafeWindow.kocThroneItems[params.itemId].salvage();
						t.FillEquipCheckboxes();
					}
				},
				onFailure: function () {
						return;
				},
			});
	}
},


Upgrade_Enhance :function (){
    var t = Tabs.Throne;  
    try {      
      var m = '<DIV id=pbTowrtDivF class=pbStat>AUTOMATED UPGRADE/ENHANCE/REPAIR FUNCTION</div><TABLE id=pbbarbingfunctions width=100% height=0% class=pbTab><TR align="center">';
	  m +='<TD><INPUT class="buttonDash_'+ (ThroneOptions.Active?'ON':'OFF') +'" id=Enable type=submit value="'+translate("Queue")+' = '+ (ThroneOptions.Active?'ON':'OFF')+'"></td>'
      m+= '<TD><INPUT id=ShowHistory type=submit class=pbButton value="History"></td>';
      m+= '</table><DIV id=pbTowrtDivF class=pbStat>OPTIONS</div>';
	  m+= '<BR><INPUT id=pbUseTokens type=checkbox '+ (ThroneOptions.UseTokens?'CHECKED ':'') +'/>&nbsp;Use Tokens/Stones when available, from and above -> Quality: ';
	  m+= '<SELECT id="pbLPSlevel">';
	  for (var i=0;i<t.Quality.length-1;i++)  m+='<OPTION value='+i+' >'+t.Quality[i]+'</option>';
	  m+= '</select> - Level: <SELECT id="pbLLTlevel">';	
	  for (var i=1;i<=10;i++)  m+='<OPTION value='+i+' >'+i+'</option>';
	  m+= '</select><BR>To add cards to queue: Go to compare, click the card title and select action...';
	  m+= '<BR><BR><TABLE class=pbTab align=center><TD><INPUT id=allEnhance type=submit class=pbButton value="Enhance All Cards One Level"></td><TD><INPUT id=allUpgrade type=submit class=pbButton value="Upgrade All Cards One Level"></td></table>';
	  m+= '<DIV id=pbTowrtDivF class=pbStat>STATUS</div>';
	  m+= '<br/><DIV id=ShowStatus></div></p>';
	  m+= '<DIV id=ShowTries></div><br/>';
	  m+= '<DIV id=ShowStones></div><br/>';
      m+= '<DIV id=pbTowrtDivF class=pbStat>QUEUE</div>';
	  m+= '<br/><DIV id=ShowQueueDiv></div>';
	  t.Overv.innerHTML = m;
      
	document.getElementById('allEnhance').addEventListener ('click', function (){
		var counter=0;
		for (k in unsafeWindow.kocThroneItems) {
			counter++;
			ActiveItems = parseInt(Seed.throne.rowNum)*5;
			if (counter > ActiveItems) break;
			y = unsafeWindow.kocThroneItems[k];
			if (y.quality <=4) t.addToQueue(y.id,"Enhance");	
		}		
	},false);
	document.getElementById('allUpgrade').addEventListener ('click', function (){
		var counter=0;
		for (k in unsafeWindow.kocThroneItems) {
			counter++;
			ActiveItems = parseInt(Seed.throne.rowNum)*5;
			if (counter > ActiveItems) break;
			y = unsafeWindow.kocThroneItems[k];
			if (y.level <=9) t.addToQueue(y.id,"Upgrade");	
		}		
	},false);

	document.getElementById('pbLLTlevel').value = ThroneOptions.LLTlevel;
	document.getElementById('pbLPSlevel').value = ThroneOptions.LPSlevel;
  	document.getElementById('pbUseTokens').addEventListener('change', function(){ThroneOptions.UseTokens = document.getElementById('pbUseTokens').checked;saveThroneOptions();} , false);
  	document.getElementById('pbLLTlevel').addEventListener('change', function(){ThroneOptions.LLTlevel = document.getElementById('pbLLTlevel').value;saveThroneOptions();} , false);
  	document.getElementById('pbLPSlevel').addEventListener('change', function(){ThroneOptions.LPSlevel = document.getElementById('pbLPSlevel').value;saveThroneOptions();} , false);
  	document.getElementById('Enable').addEventListener('click', function(){t.toggleThroneState()} , false);
  	document.getElementById('ShowHistory').addEventListener('click', function(){t.PaintHistory()} , false);
  
	if (ThroneOptions.Items.length ==0) t.UpdateShowStatus("No items in queue!!");
	else {
      if (ThroneOptions.Active && Seed.queue_throne.end == undefined) t.UpdateShowStatus("Waiting for timer...");
      if (ThroneOptions.Active && Seed.queue_throne.end != undefined) t.setRepairTimer = setInterval (t.repairTimerUpdate,1000);
      if (!ThroneOptions.Active && Seed.queue_throne.end != undefined) t.setRepairTimer = setInterval (t.repairTimerUpdate,1000); 
      if (!ThroneOptions.Active && Seed.queue_throne.end == undefined) t.UpdateShowStatus("Auto Upgrade/Enhance/Repair is OFF.");
    } 
        
	if (ThroneOptions.Tries > 0) t.UpdateShowTries("Tries: " + ThroneOptions.Tries + "<br />Good requests: " + ThroneOptions.Good + "   Bad requests: " + ThroneOptions.Bad);
		else t.UpdateShowTries("Tries: --");
   	
	if (ThroneOptions.Items.length>0) {t.paintStones();t.PaintQueue();}
    
  } catch (e) {
      t.Overv.innerHTML = '<PRE>'+ e.name +' : '+ e.message +'</pre>';  
    }
  t.timer = setInterval(t.paintStones,2500);
},

UpdateShowStatus : function (msg){
	if (document.getElementById('ShowStatus') != null) document.getElementById('ShowStatus').innerHTML = msg;
	if (document.getElementById('UpgradeStatus') != null) document.getElementById('UpgradeStatus').innerHTML = msg;

},

UpdateShowTries: function (msg){
	if (document.getElementById('ShowTries') != null) document.getElementById('ShowTries').innerHTML = msg;
	if (document.getElementById('TriesStatus') != null) document.getElementById('TriesStatus').innerHTML = msg;

},

Compare :function (){
    var t = Tabs.Throne;  
    var amount = 0;
    var AdvisorCount =0;
    var BannerCount = 0;
    var ChairCount = 0;
    var TableCount = 0;
    var TrophyCount = 0;
    var WindowCount = 0;
    var counter = 0;
    ActiveItems = parseInt(Seed.throne.rowNum)*5;

    for (k in unsafeWindow.kocThroneItems){
		counter++;
		if (counter > ActiveItems) break;
		z = unsafeWindow.kocThroneItems[k];
		if (z.type=="advisor") AdvisorCount++;
		if (z.type=="banner") BannerCount++;
		if (z.type=="chair") ChairCount++;
		if (z.type=="trophy") TrophyCount++;
		if (z.type=="table") TableCount++;
		if (z.type=="window") WindowCount++;
	}	

    try {   
     var m = '<DIV id=pbTowrtDivF class=pbStat>Compare Throne Items</div><br><TABLE id=pbCompareStats width=100% height=0% class=pbTab>';

     m+='<TD>Advisor: ' + AdvisorCount + '</td><TD>Banner: ' + BannerCount+ '</td><TD>Throne :' + ChairCount+ '</td><TD>Table: '+ TableCount+'</td><TD>Trophy: ' + TrophyCount + '</td><TD>Window: ' + WindowCount + '</td></table><br>';

     m+= '<DIV id=pbThroneMain class=pbStat>Compare Throne Items</div><br>';
     m+='<TABLE id=pbCompareStats width=100% height=0% class=pbTab><TD>Card Type: <SELECT id=type type=list></select></td><TD>Card quality: <SELECT id=CardQuality type=list></select></td><TD>Effect: <SELECT id=effect type=list></select></td></tr><TR><TD>Keyword: <INPUT type=text id=keyword size=10></td><TD><INPUT id=isEquipped type=checkbox unchecked=true> Equipped</td></tr></table>';

     m+='<br><TABLE id=pbbarbingfunctions width=100% height=0% class=pbTab><TR>';

     for (i=1;i<=ActiveItems;i++){
     	 m+='<TD><DIV id=DIV'+ i +'></div></td>';
     	 if (i%3==0) m+='</tr><TR></tr><TR>';
     }

     m+="</tr></table>"

    t.Overv.innerHTML = m;

	document.getElementById("type").options.length=0;
	for (k in t.EquipType){
		var y = t.EquipType[k];
		if (typeof(y) == "string") {
			if (y == "Windows") y = "Window";
			what = y.toLowerCase();
			if (y == "Chair") y = "Throne";
			var o = document.createElement("option");			
			o.text = y;
			o.value = what;
			document.getElementById("type").options.add(o);
		}		
	}	
	document.getElementById("CardQuality").options.length=0;
	for (i=0;i<=t.Quality.length;i++){
		var y = t.Quality[i];
		if (typeof(y) == "string") {
			var o = document.createElement("option");			
			o.text = y;
			o.value = i;
			document.getElementById("CardQuality").options.add(o);
		}		
	}	
	document.getElementById("effect").options.length=0;
	var o = document.createElement("option");			
	o.text = "ALL";
	o.value = "ALL";
	document.getElementById("effect").options.add(o);
	for (k in unsafeWindow.cm.thronestats.effects){
		var y = unsafeWindow.cm.thronestats.effects[k][1];
		if (typeof(y) == "string") {
			var o = document.createElement("option");			
			o.text = unsafeWindow.cm.thronestats.effects[k][1];
			o.value = k;
			document.getElementById("effect").options.add(o);
		}		
	}	

	document.getElementById("type").addEventListener ('change', t.FillEquipCheckboxes,false);
	document.getElementById("CardQuality").addEventListener ('change', t.FillEquipCheckboxes,false);
	document.getElementById("effect").addEventListener ('change', t.FillEquipCheckboxes,false);
	document.getElementById("keyword").addEventListener ('change', t.FillEquipCheckboxes,false);
	document.getElementById('keyword').addEventListener('keyup', t.FillEquipCheckboxes, false)
    document.getElementById("isEquipped").addEventListener ('change', t.FillEquipCheckboxes,false);  

	t.FillEquipCheckboxes();
    } catch (e) {
      t.Overv.innerHTML = '<PRE>'+ e.name +' : '+ e.message +'</pre>';  
    }
},

Preset :function (){
    var t = Tabs.Throne; 
    var what="";
    try {   
     	var m = '<DIV id=pbTowrtDivF class=pbStat>PRESETS</div><DIV id=PresetCont></div>';     	
    	t.Overv.innerHTML = m;
    	t.PaintPresets();	
    } catch (e) {
     	t.Overv.innerHTML = '<PRE>'+ e.name +' : '+ e.message +'</pre>';  
    }
},

Stats : function (){
    var t = Tabs.Throne; 
    var what="";
    try {   
     	var m = '<DIV id=pbTowrtDivF class=pbStat>STATS</div><TABLE id=pbCompareStats width=100% height=0% class=pbTab><BR>';     	
    	
    	for (k in unsafeWindow.cm.thronestats.effects) t.StatEffects[k] = 0;
    	for (k in unsafeWindow.kocThroneItems){
    		 y = unsafeWindow.kocThroneItems[k];
	    	 for (i=1;i<=5;i++) {
				   id = y["effects"]["slot"+i]["id"];
				   tier = parseInt(y["effects"]["slot"+i]["tier"]);
				   level = y["level"];
				   p = unsafeWindow.cm.thronestats.tiers[id][tier];
				   Current = p.base + ((level * level + level) * p.growth * 0.5);
				   if (y.isEquipped && i<=y["quality"]) t.StatEffects[id] += Current
			}
		}
		for (k=1;k<t.StatEffects.length;k++) if (t.StatEffects[k] != 0) m+='<TR><TD width="100px"></td><TD width="75px"><FONT color=black size=3><B>' + t.StatEffects[k] + "%</b></font></td><TD><FONT color=black size=3><B>" + unsafeWindow.cm.thronestats["effects"][k]["1"] + '</b></font></td></tr>';
		m +='</table>';
    	t.Overv.innerHTML = m;    	

    } catch (e) {
     	t.Overv.innerHTML = '<PRE>'+ e.name +' : '+ e.message +'</pre>';  
    }
},

Caps : function (){
	var t = Tabs.Throne;	
	m =  '<DIV class=pbStat><b>Throne Room Caps</b></div><BR><BR><TABLE border=2px align=center>';
    m += '<TR><TD width="150px"><B>Throne Card Effect</b></td><TD width="50px"><B>Buff</b></td><TD><B>Debuff</b></td><TD style="border:0;width:50px"></td><TD width="150px"><B>Throne Rooms Effect</b></td><TD width="50px"><B>Buff</b></td><TD width="50px"><B>Debuff</b></td></tr><TR>';
    var counter =0;
    for (k in unsafeWindow.cm.thronestats.boosts){
    	counter++
    	var boost = unsafeWindow.cm.thronestats.boosts[k]
    	m += '<TD>'+ boost.BoostName + '</td><TD>'+ boost.Max +'<SPAN id=maxPerc_'+k+'></div></td><TD>' + boost.Min + '<SPAN id=minPerc_'+k+'></div>';

    	if (counter % 2 == 0){
    		m += '<TR>';
    	}else {
    		m += '</td><TD style="border:0">';
    	}
    }
		t.Overv.innerHTML = m;
    for (k in unsafeWindow.cm.thronestats.boosts){
    	var boost = unsafeWindow.cm.thronestats.boosts[k]
    	if (boost.CapType == "percent"){
	   		document.getElementById('maxPerc_'+k).innerHTML = '%'
    		if (boost.Min != "none"){
    			document.getElementById('minPerc_'+k).innerHTML = '%'
    		}
    	}
    }
},


PaintPresets : function (){
    var t = Tabs.Throne;
    var m= '<TABLE id=pbCompareStats width=100% height=100% class=pbTab>';
     	
     	for (i=1;i<=8;i++) {
     		m+='<TR><TD>&nbsp</td></tr><TR><TD rowspan=7><a class="button20" id=Button'+i+'><span>'+i+'</span></a><INPUT type=text id=PresetName'+i+' size=20 value="'+ ThroneOptions.PresetName[i] +'"</td>';
     		for (j=1;j<t.EquipType.length;j++) {
     			what1 = t.EquipType[j];     			
     			id1 = ThroneOptions.Presets[i][what1.toLowerCase()];
     			if (what1 == "Chair") what1 = "Throne";
     			if (what1 == "Windows") what1 = "Window";
     			if (unsafeWindow.kocThroneItems[id1] != undefined) name1 = unsafeWindow.kocThroneItems[id1].name
     				else name1 = "";     			
     			if (j%2>0) m+='<TR>';
     			if (unsafeWindow.kocThroneItems[id1] != undefined && unsafeWindow.kocThroneItems[id1].isEquipped) m+='<TD>' + what1 + ': <B>' + name1 + '</b></td>';
     				else  m+='<TD>' + what1 + ': ' + name1 + '</td>';
     			if (j%2==0) m+='</tr>';
     		}
     		m+='</tr><TR><TD>&nbsp</td></tr>';
     	}
     	document.getElementById('PresetCont').innerHTML = m;

     	for (i=1;i<=8;i++) {
    		document.getElementById('PresetName'+i).addEventListener('change',function (){
    			for (j=1;j<=8;j++) ThroneOptions.PresetName[j] = document.getElementById('PresetName'+j).value;
    			saveThroneOptions();
    		},false);
    		document.getElementById('Button'+i).addEventListener('click',function (){
    			var what = this.id.substr(6);
    			t.EquipPreset(what);
    		},false);
    	}
},

EquipPreset : function (what){
    var t = Tabs.Throne;   
    var counter= 0;
    for (d=1;d<=7;d++) {
    	var type = t.EquipType[d].toLowerCase();
    	id = ThroneOptions.Presets[what][type];    	
    	if (unsafeWindow.kocThroneItems[id] != undefined && !unsafeWindow.kocThroneItems[id].isEquipped) {
    		counter++;
    		setTimeout(t.doEquip,(5250*(counter-1)),id,"Preset");
    	}
    }
	var msg="";
	if (document.getElementById("PresetCont") != undefined) document.getElementById("PresetCont").innerHTML= msg;
	if (document.getElementById("ShowTrPresets") != undefined) document.getElementById("ShowTrPresets").innerHTML= msg;
	time = Math.round(counter * 5.25);
	Tabs.AutoTrain.changeTime = time;
	for (c=0;c<=time;c++){
		msg = '<DIV align="center"><FONT size="10"><B>Time left is : ' + (time - c) + '</b></font></div>';
		setTimeout(t.TimeLeft,c*1000,msg);

	}  	    
	if (document.getElementById("PresetCont") != undefined) setTimeout(t.PaintPresets,time*1000);
	if (document.getElementById("ShowTrPresets") != undefined) {
		if (GlobalOptions.pbWideScreenStyle=="wide" || GlobalOptions.pbWideScreenStyle=="ultra") setTimeout(Dashboard.ShowTrPresets,time*1000);
		else setTimeout(Dashboard.ShowTrPresetsMini,time*1000);
	}
},

EquipKabamPreset : function (what){
    var t = Tabs.Throne;   
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.ctrl = 'throneRoom\\ThroneRoomServiceAjax';
    params.action = 'setPreset';
    params.presetId = what;
    new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch53.php" + unsafeWindow.g_ajaxsuffix, {
        method: "post",
        parameters: params,
        loading: true,
        onSuccess: function (transport) {
            var rslt = eval("(" + transport.responseText + ")");
            if(rslt.ok){
				for (i=1;i<=Seed.throne.slotNum;i++) {
					if (params.presetId==i && document.getElementById(''+i)) document.getElementById('KabamPreset_'+i).setAttribute("class", "pbButton_selected");
					 else if (document.getElementById('KabamPreset_'+i)) document.getElementById('KabamPreset_'+i).setAttribute("class", "button");
					if (document.getElementById('KabamPreset_Chat_'+i) && params.presetId==i) document.getElementById('KabamPreset_Chat_'+i).setAttribute("class", "pbButton_selected");
					 else if (document.getElementById('KabamPreset_Chat_'+i)) document.getElementById('KabamPreset_Chat_'+i).setAttribute("class", "pbButton");

				} 
				if(document.getElementById('throneInventoryPreset'+params.presetId))
                  button = document.getElementById('throneInventoryPreset'+params.presetId);
               	else
                  button = '<li id="throneInventoryPreset' + params.presetId + '" class="selected">'+params.presetId+'</li>';
				unsafeWindow.cm.ThroneView.clickActivePreset(button);	
				if (GlobalOptions.pbWideScreenStyle=="wide" || GlobalOptions.pbWideScreenStyle=="ultra") Dashboard.ShowTrPresets();
			 	 else Dashboard.ShowTrPresetsMini();
            }
            else alert("Failed to change throne room...\nTry Again!");
        },
        onFailure: function () {alert("Failed to change throne room...\nTry Again!");},
    });
},

togOpt : function (checkboxId, optionName, callOnChange){
    var t = Tabs.Throne;
    var checkbox = document.getElementById(checkboxId);
    if (Options[optionName])
      checkbox.checked = true;
    checkbox.addEventListener ('change', eventHandler, false);
    function eventHandler (){
      Options[optionName] = this.checked;
      saveOptions();
      if (callOnChange)
        callOnChange (this.checked);
    }
},

changeOpt : function (valueId, optionName, callOnChange){
    var t = Tabs.Throne;
    var e = document.getElementById(valueId);
    e.value = Options[optionName];
    e.addEventListener ('change', eventHandler, false);
    function eventHandler (){
      Options[optionName] = this.value;
      saveOptions();
      if (callOnChange)
        callOnChange (this.value);
    }
},
  
toggleThroneState: function(){
	var t = Tabs.Throne;
	if (ThroneOptions.Active == true) {
		    ThroneOptions.Active = false;
		    document.getElementById('Enable').value = "Queue = OFF";
		    saveThroneOptions();
            clearTimeout(t.setActionTimer);
            if (Seed.queue_throne.end == undefined) t.UpdateShowStatus("Auto Upgrade/Enhance/Repair is OFF.");
	} else {
		    ThroneOptions.Active = true;
		    document.getElementById('Enable').value = "Queue = ON";
		    saveThroneOptions();
            t.UpdateShowStatus("Waiting for timer...");
	}
},

_addTab: function(id,name,qualityfrom,qualityto,levelfrom,levelto,action,active,cost){
	 	var t = Tabs.Throne;
	    var a="";
	    var b=""; 
	    switch (qualityfrom) {
        		case 0:a = unsafeWindow.g_js_strings.throneRoom.simple;break;
        		case 1:a = unsafeWindow.g_js_strings.throneRoom.common;break;
        		case 2:a = unsafeWindow.g_js_strings.throneRoom.uncommon;break;
       			case 3:a = unsafeWindow.g_js_strings.throneRoom.rare;break;
        		case 4:a = unsafeWindow.g_js_strings.throneRoom.epic;break;
        		case 5:a = unsafeWindow.g_js_strings.throneRoom.wondrous;break;
        		default:a = unsafeWindow.g_js_strings.throneRoom.simple;break;
        }
        switch (qualityto) {
        		case 0:b = unsafeWindow.g_js_strings.throneRoom.simple;break;
        		case 1:b = unsafeWindow.g_js_strings.throneRoom.common;break;
        		case 2:b = unsafeWindow.g_js_strings.throneRoom.uncommon;break;
       			case 3:b = unsafeWindow.g_js_strings.throneRoom.rare;break;
       			case 4:b = unsafeWindow.g_js_strings.throneRoom.epic;break;
        		case 5:b = unsafeWindow.g_js_strings.throneRoom.wondrous;break;
        		default:b = unsafeWindow.g_js_strings.throneRoom.simple;break;
        }
	     if (document.getElementById('ShowQueue') != null) {
	     	 var row = document.getElementById('ShowQueue').insertRow(0);
		     row.vAlign = 'top';
		     row.style.color = "black";	
		     if (active) row.style.color = "green";	 
		     row.insertCell(0).innerHTML = id+1;
			 row.insertCell(1).innerHTML = name;
		     if (action == "Enhance") {
					row.insertCell(2).innerHTML = a + " -> " + b;
		   	 		row.insertCell(3).innerHTML = levelfrom;
		     }
		     if (action == "Upgrade") {
					row.insertCell(2).innerHTML = a;
		   	 		row.insertCell(3).innerHTML = levelfrom + " -> " + levelto;
		     }
		     row.insertCell(4).innerHTML = action;
			 row.insertCell(5).innerHTML = cost;
		     row.insertCell(6).innerHTML = '<a class="button20" id="queueDelete_' + id + '"><span>Delete</span></a>';
		 }
         if (document.getElementById('queueDelete_' + id) != null) {
         	document.getElementById('queueDelete_' + id).addEventListener('click', function(){
	            if (ThroneOptions.Items[id].active ==true) ThroneOptions.Tries=0;
				if (ThroneOptions.Items.length ==0 && ThroneOptions.Active) t.UpdateShowStatus("No items in queue!!");
				if (!ThroneOptions.Active) t.UpdateShowStatus("Auto Upgrade/Enhance/Repair is OFF.");
				ThroneOptions.Items.splice (id,1);
				saveThroneOptions();
				t.checkUpgradeInfo(false);
	      		t.PaintQueue();
        	}, false);
        }
},
	
_addTabHeader: function() {
	if (document.getElementById('ShowQueue') != null) {
		 var t = Tabs.Throne;
	     var row = document.getElementById('ShowQueue').insertRow(0);
	     row.vAlign = 'top';
	     row.style.color = "black";
	     row.insertCell(0).innerHTML = "Id";
	     row.insertCell(1).innerHTML = "Name";
	     row.insertCell(2).innerHTML = "Quality";
	     row.insertCell(3).innerHTML = "Level";
	     row.insertCell(4).innerHTML = "Action";
		 row.insertCell(5).innerHTML = "Cost";
	     row.insertCell(6).innerHTML = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
	}
},


FillEquipCheckboxes: function(){
	var t = Tabs.Throne;
	var qualityCheck=false;
	var typeCheck=false;
	var effectCheck=false;
	var keywordCheck=false; 
	var equippedCheck = false; 
	ActiveItems = parseInt(Seed.throne.rowNum)*5;
	for(i=1;i<=ActiveItems;i++) document.getElementById("DIV"+i).innerHTML="";
	counter = 0;
	t.CompPos=0;
	for (k in unsafeWindow.kocThroneItems){
		counter++;
		if (counter > ActiveItems) break;
		z = unsafeWindow.kocThroneItems[k];
		qualityCheck=false;
		typeCheck=false;
		effectCheck=false;
		keywordCheck=false;
		equippedCheck = false; 
		y = z.effects;
		if (z.type==document.getElementById("type").value || "all" == document.getElementById("type").value) typeCheck=true;
		if (z.quality >= document.getElementById("CardQuality").value || 0 == document.getElementById("CardQuality").value) qualityCheck = true;
		if (document.getElementById("isEquipped").checked && z.isEquipped) equippedCheck = true;
		if (!document.getElementById("isEquipped").checked) equippedCheck = true;

		for (i=1;i<=5;i++){
				if (y['slot'+i].id == document.getElementById("effect").value || "ALL" == document.getElementById("effect").value) effectCheck = true;
				var str = String(unsafeWindow.cm.thronestats['effects'][y['slot'+i].id][1]);
				if (str.search(new RegExp(String(document.getElementById("keyword").value), "i")) != -1 || document.getElementById("keyword").value=="") keywordCheck=true;
		}

		if (typeCheck && qualityCheck && effectCheck && keywordCheck && equippedCheck){
			t.CompPos++;
			t.paintEquipInfo(z.id,t.CompPos);
		}
	}	
},

doPreset : function (preset){
	var t = Tabs.Throne;
	var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
	params.ctrl = 'throneRoom\\ThroneRoomServiceAjax';
	params.action = 'setPreset';
	params.presetId = preset;
	
				
  	new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch53.php" + unsafeWindow.g_ajaxsuffix, {
		method: "post",
		parameters: params,
		loading: true,
		onSuccess: function (transport) {
			var rslt = eval("(" + transport.responseText + ")");
				if(rslt.ok){
					button = '<li id="throneInventoryPreset' + preset + '" class="active">'+preset+'</li>';
					unsafeWindow.cm.ThroneView.clickActivePreset(button);
					t.FillEquipCheckboxes();
			   } 
		},
		onFailure: function () {
		   return;
		},
	});
		
},

paintEquipInfo : function (z,what){
		var t = Tabs.Throne;
		var m="";
		var color = "black";
		if (typeof(unsafeWindow.kocThroneItems[z]) == 'object') var y = unsafeWindow.kocThroneItems[z];
		else return;
		  var id =0;
		  var tier=0;
		  var Current=0;
		  var icon = 'https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/throne/icons/30/' + y.faction + '/' + y.faction + '_'+ y.type +'_normal_1_'+ y.quality+'.png';
		  if (y.isEquipped) m='<TABLE width=80% height=0% align="center" class=ThroneEQ style="background: transparent url('+icon +') bottom right no-repeat; background-color:#FFFFE3;">';
		  else m='<TABLE width=80% height=0% align="center" class=Throne style="background: transparent url('+icon +') bottom right no-repeat; background-color:#FFFFE3;">';
		  switch(parseInt(y["quality"])){
			case 1:color="grey";break;
			case 2:color="white";break;
			case 3:color="green";break;
			case 4:color="blue";break;
			case 5:color="purple";break;
			default:break;
		  }

   		 m+='<TR><TD style="background-color:#D5C795"><A onclick="ActionPopup('+ y.id +')"><FONT color='+ color +'><B>' + y.name + '</b></font></td>';
		  m+= '<TD><A onclick="Savlage('+ y.id +')"><img src="data:image/png;base64,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"/></td></tr>';
		  for (i=1;i<=5;i++) {
			   id = y["effects"]["slot"+i]["id"];
			   tier = parseInt(y["effects"]["slot"+i]["tier"]);
			   level = y["level"];
			   p = unsafeWindow.cm.thronestats.tiers[id][tier];
			   Current = p.base + ((level * level + level) * p.growth * 0.5);
			   var quality = parseInt(y["quality"]);
				if (i<=quality) m+='<TR><TD><FONT color=black>' + Math.round(Current*100)/100 + "% " + unsafeWindow.cm.thronestats["effects"][id]["1"] + '</font></td></tr>';
				else m+='<TR><TD><FONT color=grey>' + Math.round(Current*100)/100 + "% " + unsafeWindow.cm.thronestats["effects"][id]["1"] + '</font></td></tr>';
		}
		m+="</table>"
		document.getElementById('DIV'+what).innerHTML = m;
},

ActionPopup : function(id) {
	var t = Tabs.Throne;
    var action="";
    var m = '<DIV id=pbTowrtDivF class=pbStat>Add to Enhance/Upgrade queue</div><BR><TABLE id=pbCompareStats width=100% height=0% class=pbTab>'; 
  	m+= '<TR ><TD><input id=RadioEnhance type="radio" name="actions" value="Enhance">Enhance '+ unsafeWindow.kocThroneItems[id].name +' to: <SELECT id=EnhaceItems type=list></select></td></tr>';
  	m+= '<TR><TD><input id=RadioUpgrade type="radio" name="actions" value="Upgrade">Upgrade '+ unsafeWindow.kocThroneItems[id].name +' to level: <SELECT id=UpgradeItems type=list></select></td></tr>';
  	m+= '<TR><TD align=center><INPUT id=AaddToQueue type=submit class=pbButton value="Add to queue"></td></tr></table><BR>';
  	m+= '<DIV id=pbTowrtDivF class=pbStat>Add to preset</div><BR>';
  	m+= '<DIV>Preset: <SELECT id=PresetNames type=list></select><INPUT id=AddPreset type=submit class=pbButton value="Add"></div><BR>';

  	m+= '<DIV id=pbTowrtDivF class=pbStat>Action</div><BR>';
  	m+= '<DIV align=center><INPUT id=Equip type=submit class=pbButton value="Equip item"><INPUT id=PostToChat type=submit class=pbButton value="Post to chat"></div><BR>';
  
     var pop = new pbPopup ('ActionPopup', 0, 0, 425, 300, true);
     pop.centerMe (mainPop.getMainDiv());  
     pop.getMainDiv().innerHTML = m;
     pop.getTopDiv().innerHTML = '<CENTER><B>AIO Script Throne Card Action</b></center>';
     
    
     pop.show (true);

    document.getElementById('EnhaceItems').options.length=0;
    var QualityCheck = parseInt(unsafeWindow.kocThroneItems[id].quality) +1;
	for (i=QualityCheck;i<=5;i++){
		var o = document.createElement("option");
		o.text = t.Quality[i];
		o.value = i;
		document.getElementById("EnhaceItems").options.add(o);
	}
	document.getElementById('EnhaceItems').value = 5;

	document.getElementById('UpgradeItems').options.length=0;
    var LevelCheck = 1 + parseInt(unsafeWindow.kocThroneItems[id].level);
	for (i=LevelCheck;i<=10;i++){
		var o = document.createElement("option");
		o.text = i;
		o.value = i;
		document.getElementById("UpgradeItems").options.add(o);
	}

	document.getElementById('PresetNames').options.length=0;
	for (i=1;i<=8;i++){
		var o = document.createElement("option");
		o.text = ThroneOptions.PresetName[i];
		o.value = i;
		document.getElementById("PresetNames").options.add(o);
	}
	
	document.getElementById("AaddToQueue").addEventListener ('click', function (){
		if (document.getElementById("RadioEnhance").checked) action = "Enhance";
		if (document.getElementById("RadioUpgrade").checked) action = "Upgrade";
		if (action != "") {
			if (action == "Enhance") var diff = parseInt(document.getElementById('EnhaceItems').value) - parseInt(unsafeWindow.kocThroneItems[id].quality);
			if (action == "Upgrade") var diff = parseInt(document.getElementById('UpgradeItems').value) -  parseInt(unsafeWindow.kocThroneItems[id].level);
			for (ii=0;ii<diff;ii++) ThroneOptions.Items.push ({id:parseInt(id),action:action,name:unsafeWindow.kocThroneItems[id]["name"],qualityfrom:0,qualityto:0,levelfrom:0,levelto:0,cost:0,active:false});
	    	saveThroneOptions();
	    	t.checkUpgradeInfo(false);
	    	pop.show(false);
		}    	
	},false);

	document.getElementById("Equip").addEventListener ('click', function (){
			t.doEquip(parseInt(id),"Compare");
	    	pop.show(false);
	},false);	

	document.getElementById("PostToChat").addEventListener ('click', function (){
			t.PostToChat(parseInt(id));
	    	pop.show(false);
	},false);

	document.getElementById("AddPreset").addEventListener ('click', function (){
			t.AddToPreset(parseInt(id));
	    	pop.show(false);
	},false);
     
},

TimeLeft : function(msg) {
	var t = Tabs.Throne;
	if (document.getElementById('DIV2') != undefined) document.getElementById('DIV2').innerHTML = msg;
	if (document.getElementById('PresetCont') != undefined) document.getElementById('PresetCont').innerHTML = msg;
	if (document.getElementById('ShowTrPresets') != undefined) document.getElementById('ShowTrPresets').innerHTML = msg;
},

PostToChat : function(id) {
	var t = Tabs.Throne;
	item = unsafeWindow.kocThroneItems[id];
	var msg = ":::. " + item.name + " | ";
	for (i=1;i<=5;i++) {
		id = item["effects"]["slot"+i]["id"];
		tier = parseInt(item["effects"]["slot"+i]["tier"]);
		level = item["level"];
		p = unsafeWindow.cm.thronestats.tiers[id][tier];
		Current = p.base + ((level * level + level) * p.growth * 0.5);
		var quality = parseInt(y["quality"]);
		msg += ' | ' + Math.round(Current*100)/100 + "% " + unsafeWindow.cm.thronestats["effects"][id]["1"];
    }
	sendChat ("/a "+  msg);
},

AddToPreset : function(id) {
	var t = Tabs.Throne;
	if (typeof(unsafeWindow.kocThroneItems[id]) == 'object') {
				var y = unsafeWindow.kocThroneItems[id];
		} else return;
	var type = y.type;
	if (type == "window") type = "windows";
	ThroneOptions.Presets[document.getElementById('PresetNames').value][type] = y.id;	
	saveThroneOptions();
},


PaintHistory : function() {
	var t = Tabs.Throne;
	var popHistory = null;
	popHistory = new pbPopup('pbShowHistory', 0, 0, 1100, 500, true, function() {clearTimeout (1000);});
	var m = '<DIV style="max-height:460px; height:460px; overflow-y:auto"><TABLE align=center cellpadding=0 cellspacing=0 width=100% class="pbShowBarbs" id="pbBars">';       
	popHistory.getMainDiv().innerHTML = '</table></div>' + m;
	popHistory.getTopDiv().innerHTML = '<TD><B>Succesfull Upgrade/Enhance list:</td>';
	for (i=0;i<t.log.length;i++){
		var row = document.getElementById('pbBars').insertRow(0);
		row.vAlign = 'top';
		row.style.color = "black";
		row.insertCell(0).innerHTML = t.log[i].time;
		row.insertCell(1).innerHTML = t.log[i].name;
		row.insertCell(2).innerHTML = t.log[i].action;
		row.insertCell(3).innerHTML = t.log[i].tries;
		row.insertCell(4).innerHTML = t.log[i].good;
		row.insertCell(5).innerHTML = t.log[i].bad;
	}
	var row = document.getElementById('pbBars').insertRow(0);
	row.vAlign = 'top';
	row.style.color = "black";
	row.insertCell(0).innerHTML = "Time";
	row.insertCell(1).innerHTML = "Name";
    row.insertCell(2).innerHTML = "Action";
    row.insertCell(3).innerHTML = "Tries";
    row.insertCell(4).innerHTML = "Good Req.";
	row.insertCell(5).innerHTML = "Bad Req.";
	popHistory.show(true);
},


PaintSalvageHistory : function() {
	var t = Tabs.Throne;
	var popHistory = null;
	popHistory = new pbPopup('pbSalvageShowHistory', 0, 0, 1300, 500, true, function() {clearTimeout (1000);});
	var m = '<DIV style="max-height:460px; height:460px; overflow-y:auto"><TABLE align=center cellpadding=0 cellspacing=0 width=100% class="pbShowBarbs" id="pbBars">';       
	popHistory.getMainDiv().innerHTML = '</table></div>' + m;
	popHistory.getTopDiv().innerHTML = '<TD><B>Throne room Salvage list:</td>';

	for (i=0;i<t.SalvageLog.length;i++){
		var row = document.getElementById('pbBars').insertRow(0);
		row.vAlign = 'top';
		row.style.color = "black";
		row.insertCell(0).innerHTML = t.SalvageLog[i].time;
		row.insertCell(1).innerHTML = t.SalvageLog[i].stones;
		row.insertCell(2).innerHTML = t.SalvageLog[i].item;
		
		cell = row.insertCell(3)
		if (unsafeWindow.cm.thronestats.effects[t.SalvageLog[i].slot1] != undefined) {
			cell.innerHTML = unsafeWindow.cm.thronestats.effects[t.SalvageLog[i].slot1][1];
			if (ThroneOptions.Salvage[t.SalvageLog[i].slot1]) cell.style.color = "red";
			if (ThroneOptions.Salvage_fav[t.SalvageLog[i].slot1]) cell.style.color = "yellow";
			
			cell = row.insertCell(4)
			cell.innerHTML = unsafeWindow.cm.thronestats.effects[t.SalvageLog[i].slot2][1];
			if (ThroneOptions.Salvage[t.SalvageLog[i].slot2]) cell.style.color = "red";
			if (ThroneOptions.Salvage_fav[t.SalvageLog[i].slot2]) cell.style.color = "yellow";

			cell = row.insertCell(5)
			cell.innerHTML = unsafeWindow.cm.thronestats.effects[t.SalvageLog[i].slot3][1];
			if (ThroneOptions.Salvage[t.SalvageLog[i].slot3]) cell.style.color = "red";
			if (ThroneOptions.Salvage_fav[t.SalvageLog[i].slot3]) cell.style.color = "yellow";

			cell = row.insertCell(6)
			cell.innerHTML = unsafeWindow.cm.thronestats.effects[t.SalvageLog[i].slot4][1];
			if (ThroneOptions.Salvage[t.SalvageLog[i].slot4]) cell.style.color = "red";
			if (ThroneOptions.Salvage_fav[t.SalvageLog[i].slot4]) cell.style.color = "yellow";

			cell = row.insertCell(7)
			cell.innerHTML = unsafeWindow.cm.thronestats.effects[t.SalvageLog[i].slot5][1];
			if (ThroneOptions.Salvage[t.SalvageLog[i].slot5]) cell.style.color = "red";
			if (ThroneOptions.Salvage_fav[t.SalvageLog[i].slot5]) cell.style.color = "yellow";

		}	
	}
	var row = document.getElementById('pbBars').insertRow(0);
	row.vAlign = 'top';
	row.style.color = "black";
	row.insertCell(0).innerHTML = "Time";
	row.insertCell(1).innerHTML = "Aetherstones";
	row.insertCell(2).innerHTML = "Item";
	row.insertCell(3).innerHTML = "Slot1";
	row.insertCell(4).innerHTML = "Slot2";
	row.insertCell(5).innerHTML = "Slot3";
	row.insertCell(6).innerHTML = "Slot4";
	row.insertCell(7).innerHTML = "Slot5";

	popHistory.show(true)	;
},

 	addToQueue : function (id,action){
		var t= Tabs.Throne;
	 	ThroneOptions.Items.push ({id:id,action:action,name:unsafeWindow.kocThroneItems[id]["name"],qualityfrom:0,qualityto:0,levelfrom:0,levelto:0,cost:0,active:false});
	    saveThroneOptions();
        t.checkUpgradeInfo(false);
	    t.PaintQueue();
		if (ThroneOptions.Active) t.UpdateShowStatus("Starting Next Queue item...");
		 else t.UpdateShowStatus("Auto Upgrade/Enhance/Repair is OFF."); 
  },

  checkUpgradeInfo : function (firstRun){
	var t= Tabs.Throne;
    var countUpgrade = 0;
	var countEnhance = 0;
    var levelfrom = 0;
	var levelto =0;
	var qualityfrom = 0;
	var qualityto = 0;
	if (ThroneOptions.Items.length == 0) return;
    for (k=0;k<ThroneOptions.Items.length;k++){
		countUpgrade = 0;
		countEnhance = 0;
		if (unsafeWindow.kocThroneItems[ThroneOptions.Items[k]["id"]] != undefined) {
				if (k>0) for (l=0;l<k;l++) {
		          	if (ThroneOptions.Items[l]["id"] == ThroneOptions.Items[k]["id"] && ThroneOptions.Items[l]["action"] == "Upgrade") {countUpgrade++;}
					if (ThroneOptions.Items[l]["id"] == ThroneOptions.Items[k]["id"] && ThroneOptions.Items[l]["action"] == "Enhance") {countEnhance++;}
		      	}
				if (ThroneOptions.Items[k]["action"] == "Upgrade") {
					ThroneOptions.Items[k]["levelfrom"] = parseInt(unsafeWindow.kocThroneItems[ThroneOptions.Items[k]["id"]]["level"]) + countUpgrade;
					ThroneOptions.Items[k]["levelto"] = parseInt(ThroneOptions.Items[k]["levelfrom"]) +1;
						ThroneOptions.Items[k]["qualityfrom"] = parseInt(unsafeWindow.kocThroneItems[ThroneOptions.Items[k]["id"]]["quality"]) + countEnhance;
					if (ThroneOptions.Items[k]["levelto"]>10 && !firstRun) {logit("You can't upgrade higher then level 10!");ThroneOptions.Items.splice (k,1);return;}
				}
				if (ThroneOptions.Items[k]["action"] == "Enhance") {
					ThroneOptions.Items[k]["qualityfrom"] = parseInt(unsafeWindow.kocThroneItems[ThroneOptions.Items[k]["id"]]["quality"]) + countEnhance;
					ThroneOptions.Items[k]["qualityto"] = parseInt(ThroneOptions.Items[k]["qualityfrom"]) +1;
					 ThroneOptions.Items[k]["levelfrom"] = parseInt(unsafeWindow.kocThroneItems[ThroneOptions.Items[k]["id"]]["level"]) + countUpgrade;
					if (ThroneOptions.Items[k]["qualityto"]>5 && !firstRun) {logit("You can't upgrade higher then quality 5!");ThroneOptions.Items.splice (k,1);return;}
				}
				if (ThroneOptions.Items[k]["action"] == "Enhance") var lvl = parseInt(ThroneOptions.Items[k]["qualityfrom"]) +1;
				if (ThroneOptions.Items[k]["action"] == "Upgrade") var lvl = parseInt(ThroneOptions.Items[k]["levelfrom"]) +1;
				costAction = ThroneOptions.Items[k]["action"].toLowerCase();
				if (unsafeWindow.cm.thronestats[costAction][lvl] != undefined) ThroneOptions.Items[k]["cost"] = unsafeWindow.cm.thronestats[costAction][lvl].Stones;
				else ThroneOptions.Items.splice (k,1);
		} else ThroneOptions.Items.splice (k,1);
    }
    saveThroneOptions();
  },
    
    
	PaintQueue : function (){
		var t= Tabs.Throne;
		if (document.getElementById('ShowQueueDiv') != null) document.getElementById('ShowQueueDiv').innerHTML = '<TABLE id=ShowQueue class=pbStat align="center" width=90%></table>';
		for (k=(ThroneOptions.Items.length-1);k>=0;k--){
			if (typeof(unsafeWindow.kocThroneItems[ThroneOptions.Items[k]["id"]]) == 'object') t._addTab(k,ThroneOptions.Items[k]["name"],ThroneOptions.Items[k]["qualityfrom"],ThroneOptions.Items[k]["qualityto"],ThroneOptions.Items[k]["levelfrom"],ThroneOptions.Items[k]["levelto"],ThroneOptions.Items[k]["action"],ThroneOptions.Items[k]["active"],ThroneOptions.Items[k]["cost"]);
			else ThroneOptions.Items.splice (k,1);
		}
		t._addTabHeader();
  },
  
  doAction : function (){
        var t= Tabs.Throne;
        var now = new Date().getTime()/1000.0;
        if (!ThroneOptions.Active) return;
		if (ThroneOptions.Items.length ==0) {t.UpdateShowStatus("No items in queue!!");return;}
        ThroneOptions.Items["0"]["active"] = true;
        t.PaintQueue();
        if (unsafeWindow.kocThroneItems[ThroneOptions.Items["0"]["id"]].isBroken == true && Seed.queue_throne.end == undefined){
		          unsafeWindow.kocThroneItems[ThroneOptions.Items["0"]["id"]].isBroken = false;
		          unsafeWindow.kocThroneItems[ThroneOptions.Items["0"]["id"]].brokenType = "";
          		  setTimeout(t.doRepair,5000);
			    return;
        } 
        if (unsafeWindow.kocThroneItems[ThroneOptions.Items["0"]["id"]].isBroken == false && Seed.queue_throne.end == undefined){
			t.UpdateShowStatus("Doing " + ThroneOptions.Items["0"]["action"] + "...");
            if (ThroneOptions.Items["0"]["action"] == "Upgrade") setTimeout(t.doUpgrade,5000);
            if (ThroneOptions.Items["0"]["action"] == "Enhance") setTimeout(t.doEnhance,5000);
        }
  },
  
  
  doEnhance : function() {
		var t = Tabs.Throne;
		if (typeof(unsafeWindow.kocThroneItems[ThroneOptions.Items["0"]["id"]]) == 'object') var y = unsafeWindow.kocThroneItems[ThroneOptions.Items["0"]["id"]];
		 else return;
		var cityid = 0;
		for (var k in Cities.byID) if (parseInt(Seed.resources["city"+k]["rec5"][0]) > parseInt((ThroneOptions.Items["0"]["cost"]))) cityid = k;	
		if(cityid == 0){t.UpdateShowStatus("Not enough aetherstone to enhance!!");return;}
		var buffItem = 0; 
        if(ThroneOptions.UseTokens && y.quality >= ThroneOptions.LPSlevel) {
         	if(parseInt(unsafeWindow.seed.items['i20002'])>0) buffItem = 20002; //protection stone           	
         	if(parseInt(unsafeWindow.seed.items['i20001'])>0) buffItem = 20001;//lesser protection stone            
         	if(buffItem) unsafeWindow.cm.InventoryView.removeItemFromInventory(buffItem);
     	}
		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		params.ctrl = 'throneRoom\\ThroneRoomServiceAjax';
		params.action = 'upgradeQuality';
		params.throneRoomItemId = ThroneOptions.Items["0"]["id"];
		params.buffItemId = buffItem;
		params.payment = "aetherstone";
		params.cityId = cityid;
		
      	new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch53.php" + unsafeWindow.g_ajaxsuffix, {
			method: "post",
			parameters: params,
			loading: true,
			onSuccess: function (transport) {
				var rslt = eval("(" + transport.responseText + ")");
				if(rslt.ok){
					if (params.buffItemId > 0) actionLog('Used Stone on :' +unsafeWindow.kocThroneItems[ThroneOptions.Items["0"]["id"]].name+ '(Quality: '+ y.quality + ')');
				    if (rslt.gems > 0)
				    {
					    t.UpdateShowStatus('Upgrader accidentally spent gems!  Turning upgrader off!!');
					    ThroneOptions.Active = false;
					    saveThroneData();
				    }
					Seed.resources["city" + cityid]["rec5"][0] -= rslt.aetherstones;
				  	y.level = rslt.item.level;
	        		y.quality = rslt.item.quality
					y.status = rslt.item.status;
					if (rslt.success)
					{					
					   y.name = y.createName();
					   t.addToLog(ThroneOptions.Items["0"]["id"],ThroneOptions.Items["0"]["action"],ThroneOptions.Tries,ThroneOptions.Good,ThroneOptions.Bad);
					   ThroneOptions.Tries = 0;
					   ThroneOptions.Good = 0;
					   ThroneOptions.Bad = 0;
					   saveThroneOptions();
					   t.UpdateShowTries("Tries: --");
             		   ThroneOptions.Items.splice (0,1);
				    }
				    else
				    {
				       if (rslt.error_code==256) unsafeWindow.seed.throne.inventory[params.throneRoomItemId].status =3;
					   y.isBroken = true;
					   y.brokenType = "quality";
					   y.name = y.createName();
					   ThroneOptions.Tries++;
					   t.UpdateShowStatus('Enhance failed :( <br />Item: ' + unsafeWindow.kocThroneItems[ThroneOptions.Items["0"]["id"]].name +"<br />Waiting for repair...");
					   t.UpdateShowTries("Tries: " + ThroneOptions.Tries + "<br />Good requests: " + ThroneOptions.Good + "   Bad requests: " + ThroneOptions.Bad);
				    }
				    unsafeWindow.cm.ThroneView.renderInventory(unsafeWindow.kocThroneItems);
            
            		t.checkUpgradeInfo(false);
	          		t.PaintQueue();
					ThroneOptions.Good++;
					saveThroneOptions();
				} else {
					ThroneOptions.Bad++;
					saveThroneOptions();
				}
				return;	
			},
			onFailure: function () {
			   return;
			},
		});
	},
	   
	doUpgrade : function() {
		var t = Tabs.Throne;
		if (typeof(unsafeWindow.kocThroneItems[ThroneOptions.Items["0"]["id"]]) == 'object') var y = unsafeWindow.kocThroneItems[ThroneOptions.Items["0"]["id"]];
		 else return;
		var cityid = 0;
		for (var k in Cities.byID) if (parseInt(Seed.resources["city"+k]["rec5"][0]) > parseInt((ThroneOptions.Items["0"]["cost"]))) cityid = k;
		if(cityid == 0){t.UpdateShowStatus("Not enough aetherstone to enhance!!");return;}
		var buffItem = 0;
        if(ThroneOptions.UseTokens && y.level >= ThroneOptions.LLTlevel) {
         	if(parseInt(unsafeWindow.seed.items['i20006'])>0) buffItem = 20006;//lucky token    
         	if(parseInt(unsafeWindow.seed.items['i20005'])>0) buffItem = 20005;//lesser lucky token       
         	if(buffItem) unsafeWindow.cm.InventoryView.removeItemFromInventory(buffItem);
      	}
		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		params.ctrl = 'throneRoom\\ThroneRoomServiceAjax';
		params.action = 'upgradeLevel';
		params.throneRoomItemId = ThroneOptions.Items["0"]["id"];
		params.buffItemId = buffItem;
		params.payment = "aetherstone";
		params.cityId = cityid;
		
      	new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch53.php" + unsafeWindow.g_ajaxsuffix, {
			method: "post",
			parameters: params,
			loading: true,
			onSuccess: function (transport) {
				var rslt = eval("(" + transport.responseText + ")");
				if(rslt.ok){
					if (params.buffItemId > 0) actionLog('Used Token on :' +unsafeWindow.kocThroneItems[ThroneOptions.Items["0"]["id"]].name+ '(Level: '+ y.level + ')');
				    if (rslt.gems > 0)
				    {
					    t.UpdateShowStatus('Upgrader accidentally spent gems!  Turning upgrader off!!');
					    ThroneOptions.Active = false;
					    saveThroneData();
				    }
					Seed.resources["city" +cityid]["rec5"][0] -= rslt.aetherstones;
					if (rslt.success)
					{
					   y.level = rslt.item.level;
					   y.quality = rslt.item.quality;
					   y.name = y.createName();
					   t.addToLog(ThroneOptions.Items["0"]["id"],ThroneOptions.Items["0"]["action"],ThroneOptions.Tries,ThroneOptions.Good,ThroneOptions.Bad);
					   ThroneOptions.Tries = 0;
					   ThroneOptions.Good = 0;
					   ThroneOptions.Bad = 0;
					   saveThroneOptions();
					   t.UpdateShowTries("Tries: --");
             		   ThroneOptions.Items.splice (0,1);
				    }
				    else
				    {
					   y.isBroken = true;
					   y.brokenType = "level";
					   y.status = rslt.item.status;
                       y.name = y.createName();
					   ThroneOptions.Tries++;
					   saveThroneOptions();
					   t.UpdateShowStatus('Upgrade failed :( <br />Item: ' + unsafeWindow.kocThroneItems[ThroneOptions.Items["0"]["id"]].name +"<br />Waiting for repair...");
					   t.UpdateShowTries("Tries: " + ThroneOptions.Tries + "<br />Good requests: " + ThroneOptions.Good + "   Bad requests: " + ThroneOptions.Bad);
				    }
				    unsafeWindow.cm.ThroneView.renderInventory(unsafeWindow.kocThroneItems);
				
						t.checkUpgradeInfo(false);
		          		t.PaintQueue();
						ThroneOptions.Good++;
						saveThroneOptions();
				} else {
					ThroneOptions.Bad++;
					saveThroneOptions();
				}
			    return;
			},
			onFailure: function () {
			   return;
			},
		});   
	},
		
	 doRepair : function() {
		var t = Tabs.Throne;
		var cityid = 0;
		for (var k in Cities.byID) if (parseInt(Seed.resources["city"+k]["rec5"][0]) > 10000) cityid = k;
		if(cityid == 0){
		   t.UpdateShowStatus("Not enough aetherstone to repair !");
		   return;	
		}
		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		params.ctrl = 'throneRoom\\ThroneRoomServiceAjax';
		params.action = 'timeRepair';
		params.throneRoomItemId = ThroneOptions.Items["0"]["id"];
		params.cityId = cityid;
					
		
      	new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch53.php" + unsafeWindow.g_ajaxsuffix, {
			method: "post",
			parameters: params,
			loading: true,
			onSuccess: function (transport) {
				var rslt = eval("(" + transport.responseText + ")");
					if(rslt.ok){
              				ThroneOptions.RepairEnd = rslt.eta; 
              				var now = new Date().getTime()/1000.0;
              				t.setRepairTimer = setInterval (t.repairTimerUpdate,1000); 
				 	 		Seed.queue_throne.itemId= ThroneOptions.Items["0"]["id"];
		             		Seed.queue_throne.start=unixTime();
					 		Seed.queue_throne.end= rslt.eta;
					 		t.repairId = ThroneOptions.Items["0"]["id"];
					 		t.repairEnd = rslt.eta;
					 		unsafeWindow.cm.ThroneView.renderInventory(unsafeWindow.kocThroneItems);
					 		var x = rslt.eta - unixTime();
							ThroneOptions.Good++;
							saveThroneOptions();
				   } else {	
				   		ThroneOptions.Good++;
						saveThroneOptions();
				   }		
				   return;
			},
			onFailure: function () {
			   return;
			},
		});
	},


	doEquip : function(n,tab) {
		var t = Tabs.Throne;
		if (typeof(unsafeWindow.kocThroneItems[n]) == 'object') {
				var y = unsafeWindow.kocThroneItems[n];
		} else return;
		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		params.ctrl = 'throneRoom\\ThroneRoomServiceAjax';
		params.action = 'equipItem';
		params.itemId = y.id;
		params.presetId = Seed.throne.activeSlot;
		
      	new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch53.php" + unsafeWindow.g_ajaxsuffix, {
			method: "post",
			parameters: params,
			loading: true,
			onSuccess: function (transport) {
				var rslt = eval("(" + transport.responseText + ")");
					if(rslt.ok){
							unsafeWindow.cm.ThroneView.clickItemEquip(y);
							if (tab == "Compare") {
								var msg="";
					    		for(i=1;i<=ActiveItems;i++) document.getElementById("DIV"+i).innerHTML="";
					    		for (counter=0;counter<=5;counter++){
					    			msg = '<DIV align="center"><FONT size="20"><B>Time left is : ' + (5 - counter) + '</b></font></div>';
									setTimeout(t.TimeLeft,counter*1000,msg);
								}    	    
					    		setTimeout(t.FillEquipCheckboxes,5000);
					    		if (document.getElementById("ShowTrPresets") != undefined) {
					    			if (GlobalOptions.pbWideScreenStyle=="wide" || GlobalOptions.pbWideScreenStyle=="ultra") setTimeout(Dashboard.ShowTrPresets,5000);
									else setTimeout(Dashboard.ShowTrPresetsMini,5000);
								}
							}
					} 
			},
			onFailure: function () {
			   return;
			},
		});
	},
  
  repairTimerUpdate :function (){
		var t = Tabs.Throne;
        if (ThroneOptions.Items.length == 0) return;
		var now = new Date().getTime()/1000.0;
        var diff = 0;
		if (Seed.queue_throne.end == undefined) return;
		else diff = Seed.queue_throne.end - now;
        if (diff <0){
            clearTimeout(t.setRepairTimer);
            if (ThroneOptions.Active) t.UpdateShowStatus("Waiting for timer...");
            else t.UpdateShowStatus("Auto Upgrade/Enhance/Repair is OFF.");
            unsafeWindow.kocThroneItems[Seed.queue_throne.itemId].isBroken = false;
            Seed.queue_throne = "";
            return;
        } else {
              t.UpdateShowStatus("Repairing on: " + unsafeWindow.kocThroneItems[ThroneOptions.Items["0"]["id"]].name + "<br/>Time left: " + timestr(diff)+ " ("+ timestr(Seed.queue_throne.end - Seed.queue_throne.start) + ")");
        	  t.UpdateShowTries("Tries: " + ThroneOptions.Tries + "<br />Good requests: " + ThroneOptions.Good + "   Bad requests: " + ThroneOptions.Bad);
		}
  
  },


paintStones : function (){
	var t = Tabs.Throne;
	m="<TABLE width=90% height=0% class=pbTab><TR><TD>Aetherstones: </td>";
	for (i=0;i<Seed.cities.length;i++) m+='<TD>' + Seed.cities[i]["1"] + '</td>';
	m+="</tr><TR><TD></td>"
	for (i=0;i<Seed.cities.length;i++) m+='<TD>' + addCommas(Seed.resources["city"+Seed.cities[i]["0"]]["rec5"][0]) + '</td>';
	m+="</tr></table>"
	if (document.getElementById('ShowStones') != null) document.getElementById('ShowStones').innerHTML = m;	
},

addToLog : function (id,action,tries,good,bad){
	var t = Tabs.Throne;
	var now = new Date();
	var time = now.getDate() +"/"+ (now.getMonth()+1) +"/"+ now.getFullYear() +"  "+ now.getUTCHours() + ":" + now.getMinutes();
	var name = unsafeWindow.kocThroneItems[id]["name"];
	t.log.push ({time:time,name:name,action:action,tries:tries,good:good,bad:bad});
	if (t.log.length > 50) t.log.splice(0,1);
	GM_setValue ('ThroneHistory_'+getServerId(), JSON2.stringify(t.log));
},


addToSalvageLog : function (item,slot1,slot2,slot3,slot4,slot5,stones){
	var t = Tabs.Throne;
	var now = new Date();
	var time =  FullDateTime(now);
	t.SalvageLog.push ({time:time,stones:stones,item:item,slot1:slot1,slot2:slot2,slot3:slot3,slot4:slot4,slot5:slot5,stones:stones});
	if (t.SalvageLog.length > 100) t.SalvageLog.splice(0,1);
	GM_setValue ('ThroneSalvageHistory_'+getServerId(), JSON2.stringify(t.SalvageLog));
},


salvageCheck : function (){
	var t = Tabs.Throne;
	var type ="";
	var NotUpgrading = true;
	var NotFavorite = true;
	var number = 0;
	var count=0;
	var NotYathzee = true;
	var Not4ofAKind = true;
	var NotFullHouse = true;
	var TypeCheck = false;
	if(!Options.ThroneDeleteItems) return;
	if (t.SalvageRunning == true) return;
	t.SalvageRunning = true;
 	for (m in unsafeWindow.kocThroneItems) {
		y = unsafeWindow.kocThroneItems[m];
		type = "";
		NotUpgrading = true;
		NotFavorite = true;
		NotYathzee = true;
		Not4ofAKind = true;
		NotFullHouse = true;	
		number = 0;
		count++;	
		if (typeof(y.id) == 'number') {
			for (k in ThroneOptions.Items) {if (ThroneOptions.Items[k]["id"] == y.id) NotUpgrading = false;}
			if (count<=(parseInt(Seed.throne.rowNum)*5) && count>ThroneOptions.saveXitems) {

					for (i=1;i<=5;i++){
							TypeCheck = false;
							if (y.type == ThroneOptions.Salvage_Type[y.effects["slot"+i].id] || "all" == ThroneOptions.Salvage_Type[y.effects["slot"+i].id] || "ALL" == ThroneOptions.Salvage_Type[y.effects["slot"+i].id]) TypeCheck = true;
							if (ThroneOptions.Salvage[y.effects["slot"+i].id] && i>=ThroneOptions.Salvage_slots[y.effects["slot"+i].id] && TypeCheck) {number++;}
							if (ThroneOptions.Salvage_fav[y.effects["slot"+i].id] && i>=ThroneOptions.Salvage_slots[y.effects["slot"+i].id] && TypeCheck) {NotFavorite= false;}			
					}
					if(ThroneOptions.thronekeep < 1) ThroneOptions.thronekeep = 1;
					if (y.effects["slot1"].id == y.effects["slot2"].id && y.effects["slot2"].id == y.effects["slot3"].id && y.effects["slot3"].id== y.effects["slot4"].id && y.effects["slot4"].id== y.effects["slot5"].id) NotYathzee = false;
					if (y.effects["slot2"].id == y.effects["slot3"].id && y.effects["slot3"].id== y.effects["slot4"].id && y.effects["slot4"].id == y.effects["slot5"].id) Not4ofAKind = false;
					if (y.effects["slot1"].id == y.effects["slot2"].id && y.effects["slot3"].id == y.effects["slot4"].id && y.effects["slot4"].id == y.effects["slot5"].id) NotFullHouse = false;

					if (number < ThroneOptions.thronekeep && NotYathzee && Not4ofAKind && NotFullHouse && NotUpgrading && NotFavorite && !y.isEquipped && !y.isBroken && t.LastDeleted != y.id) {
						if (y.level == 0) t.SalvageArray.push(y.id);
					}					 
			}
		}
	}
	if (t.SalvageArray.length == 0) t.SalvageRunning = false;
},	

doSalvage : function(){
		var t = Tabs.Throne;	
		var cityid = 0;
		var Aetherstones = [];
        for (var k in Cities.byID) {
			Aetherstones.push({city:k,astones: Seed.resources["city"+k]["rec5"][0]});
		}
		Aetherstones.sort(t.AstoneCompare);
		cityid = Aetherstones[0].city;
		if (cityid == 0) cityid = Seed.cities[0][0];
		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		params.ctrl = 'throneRoom\\ThroneRoomServiceAjax';
		params.action = 'salvage';
		params.itemId = t.SalvageArray[0];
		params.cityId = cityid;
		
      	new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch53.php" + unsafeWindow.g_ajaxsuffix, {
			method: "post",
			parameters: params,
			loading: true,
			onSuccess: function (transport) {
				var rslt = eval("(" + transport.responseText + ")");
				if(rslt.ok){
					y =  unsafeWindow.kocThroneItems[params.itemId];
					z = unsafeWindow.cm.thronestats.effects;
					t.addToSalvageLog(y.name,y.effects["slot1"].id,y.effects["slot2"].id,y.effects["slot3"].id,y.effects["slot4"].id,y.effects["slot5"].id,rslt.aetherstones);
					unsafeWindow.kocThroneItems[params.itemId].salvage();
				}
				else {
					t.addToSalvageLog(0,0,0,0,0,0,0);
				}
			},
			onFailure: function () {
					return;
			},
		});
		t.SalvageArray.splice(0,1);
		t.LastDeleted = params.itemId;
		if (t.SalvageArray.length == 0) t.SalvageRunning = false;
},

AstoneCompare: function (a, b) {
	  if (a.astones > b.astones) return 1;
	  else if (a.astones < b.astones) return -1;
	  return 0;
},


hide : function (){
	var t = Tabs.Throne;
	clearInterval(t.timer);
},

show : function (){
    var t = Tabs.Throne;
    if (t.curTabName == 'Sal') 
    	t.Salvage();
    else if (t.curTabName == 'UE')
    	t.Upgrade_Enhance();
	else if (t.curTabName == 'EQ')
    	t.Compare();
	else if  (t.curTabName == 'PR')
		t.Preset();
	else if  (t.curTabName == 'ST')
		t.Stats();
	else if  (t.curTabName == 'TC')
		t.Caps();
  },
}



/*************************** Tower Alert Tab ***************************
Tabs.TowerAlert={
	tabLabel: 'Tower',
	myDiv: null,
}*/


/****************************  Tower Tab  ******************************/
Tabs.tower = {
  tabOrder: 11,
  tabLabel: 'Tower',
  myDiv: null,
  generateIncomingFunc : null,
  fixTargetEnabled : false,
  secondTimer : null,
  soundPlaying : false,
  defMode : {},  
  soundRepeatTimer : null,
  soundStopTimer : null,
  towerMarches: [],
  
  init: function(div){
    var t = Tabs.tower;
    t.myDiv = div;
    if (GM_getValue ('towerMarches_'+getServerId()) != null) GM_deleteValue ('towerMarches_'+getServerId());   // remove deprecated data if it exists
 
    var m = '<DIV class=pbStat>TOWER ALERTS</div><TABLE class=pbTab><TR align=center>';

    for (var i=0; i<Cities.cities.length; i++) m += '<TD width=95><SPAN id=pbtacity_'+ i +'>' + Cities.cities[i].name + '</span></td>';
    m += '</tr><TR align=center>';
    for (var cityId in Cities.byID) m += '<TD><INPUT type=submit class=pbButton id=pbtabut_'+ cityId +' value=""></td>';
    m += '</tr><TR align=center>';
    for (var cityId in Cities.byID) m += '<TD><CENTER><INPUT id=pbattackqueue_' + cityId + ' type=submit class=pbButton value="A 0 | S 0"></center></td>';
    m += '</tr></table><BR><DIV><CENTER><INPUT id=pbSoundStop type=submit class=pbButton value="'+translate("Stop Sound Alert")+'"></center></div><DIV id=pbSwfPlayer></div>';
    m += '<BR><DIV class=pbStat>SETUP</div>';
	m += '<BR><DIV id=EmailFrame></div>';       
    m += '<BR><TABLE class=pbTab>';
    m += '<TR><TD><INPUT id=pbalertemail type=checkbox '+ (Options.alertConfig.email?'CHECKED ':'') +'/></td><TD>Send E-Mail on incoming attack (Authenticate app!!)"'
    m += '<TR><TD>&nbsp</td></tr><TR><td align=center>-</td><TD align=left>Minimum # of troops to trigger tower options: <INPUT id=pbalertTroops type=text size=7 value="'+ Options.alertConfig.minTroops +'" \> <span style="color:#800; font-weight:bold"><sup>*NEW! Controls All Tower Options</sup></span></td></tr>';
    m += '<TR><TD><INPUT id=pbalertEnable type=checkbox '+ (Options.alertConfig.aChat?'CHECKED ':'') +'/></td><TD>'+translate("Automatically post incoming attacks to alliance chat")+'.</td></tr>\
        <TR><TD></td><TD><TABLE cellpadding=0 cellspacing=0>\
            <TR><TD align=right>'+translate("Message Prefix")+': &nbsp; </td><TD><INPUT id=pbalertPrefix type=text size=60 maxlength=120 value="'+ Options.alertConfig.aPrefix +'" \></td></tr>\
            <TR><TD align=right>'+translate("Alert on scouting")+': &nbsp; </td><TD><INPUT id=pbalertScout type=checkbox '+ (Options.alertConfig.scouting?'CHECKED ':'') +'/></td></tr>\
            <TR><TD align=right>'+translate("Alert on wild attack")+': &nbsp; </td><TD><INPUT id=pbalertWild type=checkbox '+ (Options.alertConfig.wilds?'CHECKED ':'') +'/></td></tr>\
            <TR><TD align=right>'+translate("Display defend status")+': &nbsp; </td><TD><INPUT id=pbalertDefend type=checkbox '+ (Options.alertConfig.defend?'CHECKED ':'') +'/></td></tr>\
            </table></td></tr>\
        <TR><TD align=right><INPUT id=pbalertraid type=checkbox '+ (Options.alertConfig.raid?'CHECKED':'') +'/></td><TD>'+translate("Stop raids on impending")+'.</td></tr>\
    <TR><TD align=right><INPUT id=pbalertTR type=checkbox '+ (Options.alertConfig.alertTR?'CHECKED ':'') +'/></td><TD> '+translate("Toggle to TR set ")+' <INPUT id=pbalertTRset type=text size=2 maxlength=1 value="'+ Options.alertConfig.alertTRset +'"> '+translate("on impending")+'</td></tr>\
        <TR><TD><BR></td></tr>\
        <TR><TD><INPUT id=pbSoundEnable type=checkbox '+ (Options.alertSound.enabled?'CHECKED ':'') +'/></td><TD>'+translate("Play sound on incoming attack/scout")+'</td></tr>\
        <TR><TD></td><TD><DIV id=pbLoadingSwf>'+translate("Loading SWF player")+'</div><DIV style="display:none" id=pbSoundOpts><TABLE cellpadding=0 cellspacing=0>\
            <TR><TD align=right>'+translate("Sound file")+': &nbsp; </td><TD><INPUT id=pbsoundFile type=text size=40 maxlength=1000 value="'+ Options.alertSound.soundUrl +'" \>\
             &nbsp; </td><TD><INPUT id=pbSoundLoad type=submit class=pbButton value='+translate("Load")+' ><INPUT id=pbSoundDefault type=submit class=pbButton value='+translate("Default")+' ></td></tr>\
            <TR><TD align=right>'+translate("Volume")+': &nbsp; </td><TD><TABLE cellpadding=0 cellspacing=0 class=pbTab><TR valign=middle><TD><SPAN id=pbVolSlider></span></td><TD width=15></td><TD align=right id=pbVolOut>0</td></td></table></td><TD align=center><SPAN id=pbLoadStat>xx</span></td></tr>\
            <TR><TD align=right><INPUT id=pbSoundRepeat type=checkbox '+ (Options.alertSound.repeat?'CHECKED ':'') +'/></td><TD> '+translate("Repeat every")+' <INPUT id=pbSoundEvery type=text size=2 maxlength=5 value="'+ Options.alertSound.repeatDelay +'"> '+translate("minutes")+'</td></tr>\
            <TR><TD></td><TD>Play for <INPUT id=pbSoundLength type=text size=3 maxlength=5 value="'+ Options.alertSound.playLength +'"> '+translate("seconds")+'</td></tr>\
            <TR><TD></td><TD><INPUT type=submit class=pbButton value="'+translate("Play Now")+'" id=pbPlayNow></td></tr></table></div></td></tr>\
        </table><BR>';
      t.myDiv.innerHTML = m;


    t.mss = new CmatSimpleSound(SWF_PLAYER_URL, null, {height:0, width:0}, t.e_swfLoaded, 'debug=n');
    t.mss.swfPlayComplete = t.e_soundFinished;
    t.mss.swfLoadComplete = t.e_soundFileLoaded;
    unsafeWindow.matSimpleSound01 = t.mss;   // let swf find it

    t.volSlider = new SliderBar (document.getElementById('pbVolSlider'), 200, 21, 0);
    t.volSlider.setChangeListener(t.e_volChanged);
    document.getElementById('pbPlayNow').addEventListener ('click', function (){t.playSound(false)}, false);
    document.getElementById('pbSoundStop').addEventListener ('click', t.stopSoundAlerts, false);
    document.getElementById('pbSoundRepeat').addEventListener ('change', function (e){Options.alertSound.repeat = e.target.checked}, false);
    document.getElementById('pbSoundEvery').addEventListener ('change', function (e){Options.alertSound.repeatDelay = e.target.value}, false);
    document.getElementById('pbSoundLength').addEventListener ('change', function (e){Options.alertSound.playLength = e.target.value}, false);
    document.getElementById('pbSoundEnable').addEventListener ('change', function (e){Options.alertSound.enabled = e.target.checked}, false);
    document.getElementById('pbSoundStop').disabled = true;
    document.getElementById('pbalertemail').addEventListener ('change', t.e_alertOptChanged, false);
    document.getElementById('pbalertEnable').addEventListener ('change', t.e_alertOptChanged, false);
    document.getElementById('pbalertPrefix').addEventListener ('change', t.e_alertOptChanged, false);
    document.getElementById('pbalertScout').addEventListener ('change', t.e_alertOptChanged, false);
    document.getElementById('pbalertWild').addEventListener ('change', t.e_alertOptChanged, false);
    document.getElementById('pbalertDefend').addEventListener ('change', t.e_alertOptChanged, false);
    document.getElementById('pbalertTroops').addEventListener ('change', t.e_alertOptChanged, false);
    document.getElementById('pbalertraid').addEventListener ('change', t.e_alertOptChanged, false);
    document.getElementById('pbalertTR').addEventListener ('change', t.e_alertOptChanged, false);
    document.getElementById('pbalertTRset').addEventListener ('change', t.e_alertOptChanged, false);
    document.getElementById('pbsoundFile').addEventListener ('change', function (){
        Options.alertSound.soundUrl = document.getElementById('pbsoundFile').value;
        t.loadUrl (Options.alertSound.soundUrl);
      }, false);
    document.getElementById('pbSoundDefault').addEventListener ('click', function (){
        document.getElementById('pbsoundFile').value = DEFAULT_ALERT_SOUND_URL;
        Options.alertSound.soundUrl = DEFAULT_ALERT_SOUND_URL;
        t.loadUrl (DEFAULT_ALERT_SOUND_URL);
      }, false);

    for (var cityId in Cities.byID){
        var but = document.getElementById ('pbtabut_'+ cityId);
        addListener (but, cityId);
        t.defMode[cityId] =  parseInt(Seed.citystats["city" + cityId].gate);
        t.displayDefMode (cityId);
      var btnNameT = 'pbattackqueue_' + cityId;
      addTowerEventListener(cityId, btnNameT);
      }
    function addListener (but, i){
      but.addEventListener ('click', function (){t.butToggleDefMode(i)}, false);
    }
    function addTowerEventListener(cityId, name){
        document.getElementById(name).addEventListener('click', function(){
            t.showTowerIncoming(cityId);
        }, false);
    }    
  },      

  show : function (){},
  hide : function (){},
 
  loadUrl : function (url){
    var t = Tabs.tower;
    t.mss.load (1, url, true);
    document.getElementById('pbLoadStat').innerHTML = 'Loading';
  },

  e_swfLoaded : function (){
    var t = Tabs.tower;
    document.getElementById('pbLoadingSwf').style.display = 'none';
    document.getElementById('pbSoundOpts').style.display = 'inline';
    t.volSlider.setValue (Options.alertSound.volume/100);
    setTimeout (function (){
    	t.mss.setVolume (1, Options.alertSound.volume);
    	 t.loadUrl (Options.alertSound.soundUrl);
    }, 500);
    if (Options.alertSound.alarmActive && Options.alertSound.expireTime>unixTime())   
      t.soundTheAlert();
  },
  
  e_alertOptChanged : function (){
    var t = Tabs.tower;
    Options.alertConfig.email = document.getElementById('pbalertemail').checked;
    Options.alertConfig.aChat = document.getElementById('pbalertEnable').checked;
    Options.alertConfig.aPrefix=document.getElementById('pbalertPrefix').value;      
    Options.alertConfig.scouting=document.getElementById('pbalertScout').checked;      
    Options.alertConfig.wilds=document.getElementById('pbalertWild').checked;
    Options.alertConfig.defend=document.getElementById('pbalertDefend').checked;
    Options.alertConfig.raid=document.getElementById('pbalertraid').checked;
    Options.alertConfig.alertTR=document.getElementById('pbalertTR').checked;
    var trset = parseInt(document.getElementById('pbalertTRset').value);
    Options.alertConfig.alertTRset = trset;
    var mt = parseInt(document.getElementById('pbalertTroops').value);
    if (mt<1 || mt>120000){
      document.getElementById('pbalertTroops').value = Options.alertConfig.minTroops;
      document.getElementById('pbalerterr').innerHTML = '<font color=#600000><B>'+translate("INVALID")+'</b></font>';
      setTimeout (function (){document.getElementById('pbalerterr').innerHTML =''}, 2000);
      return;
    }
    Options.alertConfig.minTroops = mt;
    saveOptions();
  },
  
  e_volChanged : function (val){
    var t = Tabs.tower;
    document.getElementById('pbVolOut').innerHTML = parseInt(val*100);
    Options.alertSound.volume = parseInt(val*100);
    t.mss.setVolume (1, Options.alertSound.volume);
  },
  
  butToggleDefMode : function (cityId){
    var t = Tabs.tower;
    var mode = 1;
    if (Seed.citystats["city" + cityId].gate != 0) mode = 0;
    t.ajaxSetDefMode (cityId, mode, function (newMode){
        t.defMode[cityId] = newMode;
        t.displayDefMode (cityId);
      });
  },
      
  displayDefMode : function (cityId){
    var t = Tabs.tower;
    var but = document.getElementById('pbtabut_'+ cityId);
    if (t.defMode[cityId]){
      but.className = 'pbDefButOn';
      but.value = 'Def = ON';  
    } else {
      but.className = 'pbDefButOff';
      but.value = 'Def = OFF';  
    }  
  },
    
  eachSecond : function (){
    var t = Tabs.tower;
    for (var cityId in Cities.byID){
      if (Seed.citystats["city" + cityId].gate != t.defMode[cityId]){     // user changed def mode
        t.defMode[cityId] = Seed.citystats["city"+ cityId].gate;
        t.displayDefMode (cityId);
      }
      Options.alertConfig.raidautoswitch[cityId] = false;
    }
      var now = unixTime();
    var incomming = false;
    if (matTypeof(Seed.queue_atkinc) != 'array'){
      for (var k in Seed.queue_atkinc){   // check each incoming march
        var m = Seed.queue_atkinc[k];
        if ((m.marchType==3 || m.marchType==4) && parseIntNan(m.arrivalTime)>now){
          if (m.departureTime > Options.alertConfig.lastAttack){
            Options.alertConfig.lastAttack = m.departureTime;  
            t.newIncoming (m);
            Recall.push({marchId:k,arrivalTime:m.arrivalTime});
          }
          incomming = true;
          if (Options.alertConfig.raid){
            Options.alertConfig.raidautoswitch[m.toCityId] = true;
          }
        }
      }
    }
    if (Options.alertSound.alarmActive && (now > Options.alertSound.expireTime))
      t.stopSoundAlerts();

        t.towerMarches = [];
        for (var i = 0; i < Cities.cities.length; i++) {
            var cId = Cities.cities[i].id;
            t['attackCount_' + cId] = 0;
            t['scoutCount_' + cId] = 0;
        }
        if (matTypeof(Seed.queue_atkinc) != 'array') {
            for (var k in Seed.queue_atkinc) {
                var m = Seed.queue_atkinc[k];
                if ((m.marchType == 3 || m.marchType == 4) && parseIntNan(m.arrivalTime) > now) {
                    t.handleTowerData(m);

                }
            }
        }
        for (var i = 0; i < Cities.cities.length; i++) {
            var cId = Cities.cities[i].id;
            document.getElementById('pbattackqueue_' + cId).value = 'A ' + t['attackCount_' + cId] + ' | S ' + t['scoutCount_' + cId];
        }    
  },   
  
  e_soundFinished : function (chan){ // called by SWF when sound finishes playing
    var t = Tabs.tower;
    if (chan != 1) return;
    if (!Options.alertSound.alarmActive) document.getElementById('pbSoundStop').disabled = true;
  },

  e_soundFileLoaded : function (chan, isError){ // called by SWF when sound file finishes loading
    if (chan != 1) return;
    if (isError) document.getElementById('pbLoadStat').innerHTML = translate("Error")+"!";
     else document.getElementById('pbLoadStat').innerHTML = translate("Loaded");
  },  
  
  playSound : function (doRepeats){
    var t = Tabs.tower;
    document.getElementById('pbSoundStop').disabled = false;
    clearTimeout (t.soundStopTimer);
    clearTimeout (t.soundRepeatTimer);
    t.mss.play (1, 0);
    t.soundStopTimer = setTimeout (function(){t.mss.stop(1); t.e_soundFinished(1)}, Options.alertSound.playLength*1000);
    if (doRepeats && Options.alertSound.repeat) t.soundRepeatTimer = setTimeout (function (){t.playSound(true)}, Options.alertSound.repeatDelay*60000);
     else Options.alertSound.alarmActive = false;
  },
        
  soundTheAlert : function (){
    var t = Tabs.tower;
    Options.alertSound.alarmActive = true;
    t.playSound(true);
  },
     
  stopSoundAlerts : function (){
    var t = Tabs.tower;
    t.mss.stop (1);
    clearTimeout (t.soundStopTimer);
    clearTimeout (t.soundRepeatTimer);
    document.getElementById('pbSoundStop').disabled = true;
    Options.alertSound.alarmActive = false;
    Options.alertSound.expireTime = 0;
  },

  newIncoming : function (m){
    var t = Tabs.tower;
    var totTroops = 0;
    for (k in m.unts) totTroops += m.unts[k];
    if (totTroops < Options.alertConfig.minTroops) return;  
    t.towerPreset (m);
  },

  towerPreset : function (m){
    var t = Tabs.tower;
    if (Options.alertConfig.alertTR){
	    var currentset = Seed.throne.activeSlot
	    if (Options.alertConfig.alertTRset != currentset){
	        var preset = Options.alertConfig.alertTRset
	        Tabs.Throne.EquipKabamPreset(preset);
	    }
    }  
    t.postToChat (m);
  },    
  
  sendalert : function (m){
    var t = Tabs.tower;
    var now = unixTime();
    if (Options.alertSound.enabled){
      t.soundTheAlert(m);
      if (m.arrivalTime > Options.alertSound.expireTime)
        Options.alertSound.expireTime = m.arrivalTime;
    }
    if (Options.alertConfig.raid){
        Tabs.Raid.StopCityRaids(m.toCityId);
        Options.alertConfig.raidautoswitch[m.toCityId] = true;
    }  
  },


  ajaxSetDefMode : function (cityId, state, notify){
        var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
        params.cid = cityId;
        params.state = state;
        
        new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/gate.php" + unsafeWindow.g_ajaxsuffix, {
            method: "post",
            parameters: params,
            onSuccess: function (rslt) {
                if (rslt.ok) {
                    Seed.citystats["city" + cityId].gate = state;
                    notify (state);
                }
            },
            onFailure: function () {
            }
        })
  },
  
  onUnload : function (){},

  postToChat : function (m){
    var t = Tabs.tower;
    if (DEBUG_TRACE) logit ("checkTower(): INCOMING at "+ unixTime()  +": \n"+ inspect (m, 8, 1));
    if (m.marchType == null) return; // bogus march (returning scouts)
    var target, atkType, who;
    if (m.marchType == 3){
      if (!Options.alertConfig.scouting) return;
      atkType = translate('SCOUT');
    } else if (m.marchType == 4){
      atkType = translate("ATTACK");
    } else {
      return;
    }
    var city = Cities.byID[m.toCityId];
    if ( city.tileId == m.toTileId )
      target = translate('city at')+' ('+ city.x +','+ city.y + ')';
    else {
      if (!Options.alertConfig.wilds) return;
      target = translate('wilderness');
      for (k in Seed.wilderness['city'+m.toCityId]){
        if (Seed.wilderness['city'+m.toCityId][k].tileId == m.toTileId){
          target += ' at ('+ Seed.wilderness['city'+m.toCityId][k].xCoord +','+ Seed.wilderness['city'+m.toCityId][k].yCoord + ')';
          break;
        }
      }
    }
    if (Seed.players['u'+m.pid])
      who = Seed.players['u'+m.pid].n;
    else if (m.players && m.players['u'+m.pid])
      who = m.players['u'+m.pid].n;
    else
      who = translate('Unknown');
  
    if (m.fromXCoord)
      who += ' at ('+ m.fromXCoord +','+ m.fromYCoord + ')';
    who += ' ('+getDiplomacy(m.aid)+')';
    
    var msg = '..:. | ' + Options.alertConfig.aPrefix +' || ';
    var email = "";
    
    if(m.marchStatus == 9) msg += 'The '+ atkType +' on my '+ target +' by '+ who +' has been recalled.';
     else {
     	msg += atkType +' on ' + target +' || 	By: '+ who +' || Troops (arriving in ' + unsafeWindow.timestr(parseInt(m.arrivalTime - unixTime())) +') || ';
		email += '<FONT color="red"><B>'+ atkType +'</font></b><BR>';
		email += '<BR>Taget: ' + city.name + ' ('+ city.x +','+ city.y + ')';
		email += '<BR>Attacker: ' + who;
		email += '<BR>ETA: ' + FullDateTime(m.arrivalTime);
		email += '<BR><BR><U>Troops:</u>';
	}    

    for (k in m.unts){
      var uid = parseInt(k.substr (1));
      msg += m.unts[k] +' '+ unsafeWindow.unitcost['unt'+uid][0] +', ';
      email += '<BR>'+m.unts[k]+ ' '+ unsafeWindow.unitcost['unt'+uid][0];
    }
    msg = msg.slice (0, -2);
    msg += '.';
    if ( city.tileId == m.toTileId ){
      var emb = getCityBuilding(m.toCityId, 8);
      if (emb.count == 0) msg += translate(" || My embassy has not been constructed in this kingdom.  Do not attempt to reinforce.");
      else {
        var availSlots = 0;
        for (k in Seed.queue_atkinc) if (Seed.queue_atkinc[k].marchType==2 && Seed.queue_atkinc[k].toCityId==m.toCityId && Cities.byID[Seed.queue_atkinc[k].fromCityId]==null) availSlots++;
        }
        msg += ' || Encamped: '+ availSlots +'/'+ emb.maxLevel;
        if (t.defMode[m.toCityId] == 0 && Options.alertConfig.defend==true) msg+= ' || My troops are HIDING!';
        if (t.defMode[m.toCityId] == 1 && Options.alertConfig.defend==true) msg+= ' || My troops are DEFENDING!';
        msg+= ' || My technology levels are: Fl Lv' + parseInt(Seed.tech.tch13) + ', HP Lv'+ parseInt(Seed.tech.tch15) + ', PE Lv'+ parseInt(Seed.tech.tch8) + ', MA Lv'+ parseInt(Seed.tech.tch9) + ', MM Lv'+ parseInt(Seed.tech.tch11) + ', AH Lv'+ parseInt(Seed.tech.tch12);

	    msg+= ' || TRC: ' + m.pid;
	    msg+= ' || March id: ' + m.mid;
    }    
    t.sendalert(m);
    if (!Options.alertConfig.aChat) return;
    if (SEND_ALERT_AS_WHISPER) sendChat ("/"+ Seed.player.name +' '+ msg); // Whisper to myself
    else sendChat ("/a "+  msg); // Alliance chat
    if (Options.alertConfig.email) t.sendToMail(email);    
  },

  	sendToMail: function(msg){
  		var t = Tabs.tower;
  		var content = '<BODY><HTML>' + msg + '</html></body>';
  		var data = {};
    	data.Subject ='Tower Alert ('+getServerId()+')';
    	data.Message = content; 
    	GM_xmlhttpRequest({
        	method: 'POST',
        	url: 'http://nicodebelder.eu/koc/mail.php',
        	headers: {'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',},
        	data: implodeUrlArgs(data),
        	onload: function (response) {logit(response.toSource());},
    	});
  	},

      handleTowerData: function(m){
        var t = Tabs.tower;
        var now = unixTime();
        var target, atkType, who, attackermight, allianceId, allianceName, diplomacy;
        var city = Cities.byID[m.toCityId];
        
        if (DEBUG_TRACE) logit("checkTower(): INCOMING at " + unixTime() + ": \n" + inspect(m, 8, 1));
        //ATKTYPE
        if (m.marchType == 3) {
            atkType = 'scouted';
            t['scoutCount_' + m.toCityId]++;
        }
        else
            if (m.marchType == 4) {
                atkType = 'attacked';
                t['attackCount_' + m.toCityId]++;
            }
            else {
                return;
            }
        //TARGET
        if (city.tileId == m.toTileId)
            target = 'City at ' + city.x + ',' + city.y;
        else {
            target = 'Wilderness';
            for (k in Seed.wilderness['city' + m.toCityId]) {
                if (Seed.wilderness['city' + m.toCityId][k].tileId == m.toTileId) {
                    target += ' at ' + Seed.wilderness['city' + m.toCityId][k].xCoord + ',' + Seed.wilderness['city' + m.toCityId][k].yCoord;
                    break;
                }
            }
        }
        //CITYNAME
        var cityName = Cities.byID[m.toCityId].name;
        
        //TROOPS
        var units = [];
        for (i = 0; i < 15; i++)
            units[i] = 0;
        for (k in m.unts) {
            var uid = parseInt(k.substr(1));
            if (unsafeWindow.unitcost['unt' + uid][0] == 'Supply Troop') units[1] = m.unts[k];
            if (unsafeWindow.unitcost['unt' + uid][0] == 'Militiaman') units[2] = m.unts[k];
            if (unsafeWindow.unitcost['unt' + uid][0] == 'Scout') units[3] = m.unts[k];
            if (unsafeWindow.unitcost['unt' + uid][0] == 'Pikeman') units[4] = m.unts[k];
            if (unsafeWindow.unitcost['unt' + uid][0] == 'Swordsman') units[5] = m.unts[k];
            if (unsafeWindow.unitcost['unt' + uid][0] == 'Archer') units[6] = m.unts[k];
            if (unsafeWindow.unitcost['unt' + uid][0] == 'Cavalry') units[7] = m.unts[k];
            if (unsafeWindow.unitcost['unt' + uid][0] == 'Heavy Cavalry') units[8] = m.unts[k];
            if (unsafeWindow.unitcost['unt' + uid][0] == 'Supply Wagon') units[9] = m.unts[k];
            if (unsafeWindow.unitcost['unt' + uid][0] == 'Ballista') units[10] = m.unts[k];
            if (unsafeWindow.unitcost['unt' + uid][0] == 'Battering Ram') units[11] = m.unts[k];
            if (unsafeWindow.unitcost['unt' + uid][0] == 'Catapult') units[12] = m.unts[k];
            if (unsafeWindow.unitcost['unt' + uid][0] == 'Bloodthorn') units[13] = m.unts[k];
            if (unsafeWindow.unitcost['unt' + uid][0] == 'Executioner') units[14] = m.unts[k];
            if (unsafeWindow.unitcost['unt' + uid][0] == 'Siege Wall') units[15] = m.unts[k];
        }
        //ATTACKERS INFORMATION
        if (Seed.players['u' + m.pid]) {
            who = Seed.players['u' + m.pid].n;
            attackermight = Seed.players['u' + m.pid].m;
            allianceId = Seed.players['u' + m.pid].a;
            allianceName = Seed.allianceNames[allianceId];
            diplomacy = getDiplomacy(allianceId);
        }
        else
            if (m.players && m.players['u' + m.pid]) {
                who = m.players['u' + m.pid].n;
                attackermight = parseInt(m.players['u' + m.pid].m);
                allianceId = 'a' + m.players['u' + m.pid].a;
                allianceName = Seed.allianceNames[allianceId];
                diplomacy = getDiplomacy(allianceId);
            }
            else {
                who = 'n.A.';
                attackermight = 'n.A.';
                allianceId = 'n.A.';
                allianceName = 'n.A.';
                diplomacy = 'n.A.';
            }
        //SOURCE
        if (m.fromXCoord) var source = m.fromXCoord + ',' + m.fromYCoord;
        else var source = 'n.A.';
       
        var arrivingDatetime = new Date();
        arrivingDatetime.setTime(m.arrivalTime * 1000);
        var count = t.towerMarches.length + 1;
        t.towerMarches[count] = {
            added: now,
            cityId: m.toCityId,
            target: target,
            arrival: parseIntNan(m.arrivalTime),
            atkType: atkType,
            who: who,
            attackermight: attackermight,
            allianceName: allianceName,
            diplomacy: diplomacy,
            rtime: unsafeWindow.timestr(parseInt(m.arrivalTime - unixTime())),
            arrivingDatetime: arrivingDatetime,
            source:source,
            units: units,
        };
    },
    showTowerIncoming: function(cityId){
        var t = Tabs.tower;
        var popTowerIncoming = null;
        var cityName = Tabs.build.getCityNameById(cityId);
        
        if (t.popTowerIncoming == null) {
            t.popTowerIncoming = new pbPopup('pbtower_' + cityId, 0, 0, 820, 500, true, function() {clearTimeout (t.timer);});
        }
        t.popTowerIncoming.show(false);
        var m = '<DIV style="max-height:460px; height:460px; overflow-y:auto"><TABLE align=center cellpadding=0 cellspacing=0 width=100% class="pbTabPad" id="pbCityTowerContent">';
        t.popTowerIncoming.getMainDiv().innerHTML = '</table></div>' + m;
        t.popTowerIncoming.getTopDiv().innerHTML = '<TD width="200px"><B>'+translate("Tower Report of")+' ' + cityName + '</b></td></td>';
        t.addCityData2Pop(cityId);
        t.popTowerIncoming.show(true);
        clearTimeout (t.timer);
        t.timer = setTimeout (function() {t.showTowerIncoming(cityId)}, 5000);        
    },
    addCityData2Pop: function(cityId){
        var t = Tabs.tower;
        var rownum = 0;
        var names = ['Supply', 'Mil', 'Scout', 'Pike', 'Sword', 'Archer', 'Cav', 'Heavy', 'Wagon', 'Balli', 'Ram', 'Cat'];
        enc = {};
        numSlots = 0;
        var row = document.getElementById('pbCityTowerContent').innerHTML = "";
        if (matTypeof(Seed.queue_atkinc) != 'array') {
            for (k in Seed.queue_atkinc) {
                march = Seed.queue_atkinc[k];
                if (march.marchType == 2) {
                    ++numSlots;
                    city = march.toCityId;
                    from = march.fromPlayerId;
                    if (!enc[city])
                        enc[city] = {};
                    if (!enc[city][from])
                        enc[city][from] = [];
                    k = [];
                    k[0] = parseInt(march.knightCombat);
                    for (i = 1; i < 13; i++) {
                        if (Options.encRemaining)
                            k[i] = parseInt(march['unit' + i + 'Return']);
                        else
                            k[i] = parseInt(march['unit' + i + 'Count']);
                    }
                    k[14] = parseInt(march.marchStatus);
                    var now = unixTime();
                    k[15] = parseInt(march.destinationUnixTime) - now;
                    enc[city][from].push(k);
                }
            }
        }
        var s1 = '';
        var s2 = '';
        var s3 = '';
        var tot = [];
        var atk = [];
        for (i = 0; i < 13; i++) {
            tot[i] = 0;
            atk[i] = 0;
        }

            s1 += '<STYLE> .tot{background:#f0e0f8;} .city{background:#ffffaa;} .attack{background:#FF9999;} .own{background:#66FF66;}</style>';
            s1 += '<TABLE cellspacing=0 width=100%><TR align=right><TD align=center width=16%></td>';
            
            for (k = 0; k < names.length; k++)
                s1 += '<TD width=7%><B>' + names[k] + '</b></td>';
            s1 += '</tr>';
            dest = cityId;
            if (enc[dest]) {
                for (p in enc[dest]) {
                    try {
                        player = Seed.players['u' + p].n;
                    }
                    catch (err) {
                        player = '???';
                    }
                    for (m = 0; m < enc[dest][p].length; m++) {
                        status = '';
                        if (enc[dest][p][m][14] == 1) {
                            status = ' (' + timestr(enc[dest][p][m][15]) + ')';    
                            if (enc[dest][p][m][15] < 0)
                                status = ' (enc)';    
                            else
                                 status = ' (' + timestr(enc[dest][p][m][15]) + ')';    
                        }
                        if (enc[dest][p][m][14] == 2) {
                            status = ' (enc)';    
                        }

                        s1 += '<TR align=right><TD align=left class="city">' + player + status +'</td>'
                        for (i = 1; i < 13; i++) {
                            num = enc[dest][p][m][i];
                            s1 += '<TD class="city">' + num + '</td>';
                            tot[i] += num;
                        }
                    }
                }
            } else {
                s1 += '<TR align=right><TD align=left class="city"><B>'+translate("Reinforcment")+':</b></td>'
                for (i = 1; i < 13; i++) {
                    s1 += '<TD class="city">0</td>';
                }
                
            }
            s1 += '<TR align=right><TD colspan=14><BR></tr>';
            s1 += '<TR align=right><TD class="own" align=left><B>'+translate("Own Troops")+':</b></td>';
            //OWNTROOPS
            var ownTroops = "";
            for (r = 1; r < 13; r++) {
                cityString = 'city' + cityId;
                num = parseInt(Seed.units[cityString]['unt' + r]);
                s1 += '<TD class="own">' + num + '</td>';
                tot[r] += num;
            }
            s1 += '<TD class="city"></td><TR><TD colspan=14><BR></td></tr><TR align=right><TD class="tot" align=left><B>'+translate("Defenders")+':</b></td>';
            for (i = 1; i < 13; i++)
                s1 += '<TD class="tot">' + tot[i] + '</td>';      
            s3 += '</tr></table>';
        
        s3 += '<TD class="city"></td><TR><TD colspan=14><BR></td></tr><TR align=right><TD class="tot" align=left><B>'+translate("Incoming Attacks")+':</b></td>';
        
        var names = ['Supply', 'Mil', 'Scout', 'Pike', 'Sword', 'Archer', 'Cav', 'Heavy', 'Wagon', 'Balli', 'Ram', 'Cat'];
        if (t.towerMarches.length > 0) {
            for (k in t.towerMarches) {
                if (typeof t.towerMarches[k].atkType != 'undefined') {
                    if (t.towerMarches[k].cityId == cityId) {
                        s3 += '<TABLE cellspacing=0 width=100%><TR>';
                        
                        if (t.towerMarches[k].atkType == 'attacked') {
                            s3 += '<TD rowspan=2 width=5%><B><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_4_30.jpg?6545"></b></td>';
                        }
                        else
                            if (t.towerMarches[k].atkType == 'scouted') {
                                s3 += '<TD rowspan=2 width=5%><B><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_3_30.jpg?6545"></b></td>';
                            }
                        s3 += '<TD width=15%><B>'+translate("Location")+'</b></td>';
                        s3 += '<TD width=15%><B>'+translate("Name")+'</b></td>';
                        s3 += '<TD width=10%><B>'+translate("Source")+': </b></td><TD width=10%>' + t.towerMarches[k].source + '</td>';
                        s3 += '<TD width=10%><B>'+translate("Might")+': </b></td><TD width=10%>' + t.towerMarches[k].attackermight + '</td>';
                        s3 += '<TD width=10%><B>'+translate("Alliance")+': </b></td><TD width=10%>' + t.towerMarches[k].allianceName + '</td>';
                        s3 += '<TD width=10%><B>'+translate("State")+': </b></td><TD width=10%>' + t.towerMarches[k].diplomacy + '</td></tr>';
                        s3 += '<TR><TD width=10%  >' + t.towerMarches[k].target + '</td>';
                        s3 += '<TD  >' + t.towerMarches[k].who + '</td>';
                        s3 += '<TD><B>'+translate("Remaining")+': </b></td><TD width=10%>' + t.towerMarches[k].rtime + '</td>';
                        s3 += '<TD><B>'+translate("Arrival")+': </b></td><TD  colspan=5 width=10%>' + t.towerMarches[k].arrivingDatetime + '</td></tr>';
                        s3 += '</tr></table>';
                        s3 += '<TABLE cellspacing=0 width=100%><TR align=right><TD align=left width=16%></td>';
                        for (n = 0; n < names.length; n++)
                            s3 += '<TD width=7%><B>' + names[n] + '</b></td>';
                        s3 += '</tr><TR align=right><TD class="attack" align=left><B>Units:</td>';
                        for (u = 1; u < 13; u++) {
                            num = t.towerMarches[k].units[u];
                            s3 += '<TD class="attack">' + num + '</td>';
                            atk[u] += parseInt(num);
                        }
                        s3 += '</tr></table>';
                    }
                }
                
            }
        }
        s2 += '<TR><TD colspan=14><BR></td></tr><TR align=right><TD class="attack" align=left><B>'+translate("Attackers")+':</b></td>';
        for (a = 1; a < 13; a++) s2 += '<TD class="attack" width=7%>' + atk[a] + '</td>';
        var html = s1 + s2 + s3;
        document.getElementById('pbCityTowerContent').innerHTML = html;

    },
}

/****************************  Build Implementation  ******************************
 TODO:
     visu directly in the game of build queue elements
     <span class="leveltag" style="left:60px;">10</span>
     more todos within the code
 */

Tabs.build = {
    tabOrder: 20,
    tabLabel: 'Build',
    myDiv: null,
    timer: null,
    buildTab: null,
    koc_buildslot: null,
    currentBuildMode: null,
    buildStates: [],
    loaded_bQ: [],
    lbQ: [],
    where: 'City',
    curTabName: 'Build',
    buildMode:false,
    buildPop: null,
    popupCity: null,

    init: function(div){
        var t = Tabs.build;
        t.myDiv = div;
        t.koc_buildslot = unsafeWindow.buildslot; //save original koc function
        t.currentBuildMode = "build";
        t.buildStates = {
            running: 'OFF',
            help: false,
        };
        t.readBuildStates();
        
        for (var i = 0; i < Cities.cities.length; i++) {
            t["bQ_" + Cities.cities[i].id] = JSON2.parse(GM_getValue('bQ_' + getServerId() + '_' + Cities.cities[i].id, '[]'));
            if (typeof t["bQ_" + Cities.cities[i].id] == 'undefined' || (t["bQ_" + Cities.cities[i].id]) == "") {
                t["bQ_" + Cities.cities[i].id] = [];
            }
        }
        
        t.cont = div;
        var m = '<DIV id=pbBuildDivF class=pbStat>'+translate("BUILD FUNCTIONS")+'</div><TABLE id=pbbuildfunctions width=100% height=0% class=pbTab><TR>';
        m+= '<TD><INPUT class="buttonDash_'+ ((t.buildStates.running=='OFF')?'OFF':'ON') +'" id=pbBuildRunning type=submit class=pbButton value="'+translate("Auto Build")+' = '+ t.buildStates.running+'"></td>';	
        m += '<TD><INPUT id=pbBuildMode type=submit class="buttonDash_'+ (t.buildMode?'ON':'OFF') +'"  value="Build Mode = '+(t.buildMode?'ON':'OFF')+'"></td>';
        m += '<TD>'+translate("Build Type")+': <SELECT id="pbBuildType">\
                <OPTION value=build>'+translate("level up")+'</option>\
                <OPTION value=max>'+translate("level max")+'</option>\
                <OPTION value=destruct>'+translate("deconstruct")+'</option>\
                </select></td>';
        m += '<TD><INPUT id=pbHelpRequest type=checkbox '+ (t.buildStates.help?' CHECKED':'') +'\></td><TD>'+translate("Ask for help")+'?</td></tr><TR><TD></tr></table>';
        m+=' <INPUT id=pbAddToQueue type=submit class=pbButton value="Upgrade">&nbsp&nbsp<B>all&nbsp&nbsp';
        m += '<SELECT id="pbSelectType"><OPTION value=13>Barracks</option><OPTION value=5>Cottages</option><OPTION value=4>Mines</option><OPTION value=3>Quarry\'s</option><<OPTION value=999>Guardian</option></select>';
        m += '&nbsp1&nbsp level in city:&nbsp&nbsp<span id=pbCityAddLevel></b></span></td>'
        m += '<DIV id=pbBuildDivQ class=pbStat>'+translate("BUILD QUEUES")+'</div><TABLE id=pbbuildqueues width=100% height=0% class=pbentry><TR>';
        for (var i = 0; i < Cities.cities.length; i++) m += '<TD colspan=2><CENTER><B>' + Cities.cities[i].name + '</b></center></td>';
        m += '</tr><TR>';
        for (var i = 0; i < Cities.cities.length; i++) m += '<TD colspan=2><CENTER><INPUT id=pbbuild_' + Cities.cities[i].id + ' type=submit class=pbButton value="'+translate("Show")+'"></center></td>';
        m += '</tr><TR>';
        for (var i = 0; i < Cities.cities.length; i++) m += '<TD colspan=2><CENTER><INPUT id=pbCancelAll_' + Cities.cities[i].id + ' type=submit class=pbButton value="'+translate("Cancel All")+'"></center></td>';
        m += '</tr><TR>';
        
        for (var i = 0; i < Cities.cities.length; i++) {
            m += '<TD>Qc:</td><TD id=pbbuildcount_' + Cities.cities[i].id + '>' + t["bQ_" + Cities.cities[i].id].length + '</td>';
        }
        m += '</tr><TR>';
        for (var i = 0; i < Cities.cities.length; i++) {
            t['totalTime_' + Cities.cities[i].id] = 0;
            cbQ = t["bQ_" + Cities.cities[i].id];
            if (typeof cbQ != 'undefined') {
                for (var j = 0; j < cbQ.length; j++) t['totalTime_' + Cities.cities[i].id] = parseInt(t['totalTime_' + Cities.cities[i].id]) + parseInt(cbQ[j].buildingTime);
                timestring = timestr(t['totalTime_' + Cities.cities[i].id]);
            }
            m += '<TD>Tt:</td><TD id=pbbuildtotal_' + Cities.cities[i].id + '>' + timestring + '</td>';
        }
        m += '</tr></table><SPAN class=boldRed id=pbbuildError></span>';
        m += '<DIV id=pbBuildDivQ class=pbStat>STARTUP</div>';
        m +='<BR><DIV>Set Build mode ON, click on a empty spot and queue a building.</div><BR>';
        m += '<DIV id=pbBuildDivQ class=pbStat>FULL AUTO BUILD</div>';
        m +='<BR><DIV>Set Auto Build to AUTO. Full auto build will automatically upgrade the lowest building in each city.</div><BR><BR>';
        
        t.cont.innerHTML = m;
        t.Addcity = new CdispCityPicker ('pbBuildCity', document.getElementById('pbCityAddLevel'), true, null, 0);
        for (var i = 0; i < Cities.cities.length; i++) {
            var cityId = Cities.cities[i].id;
            var btnName = 'pbbuild_' + cityId;
            addQueueEventListener(cityId, btnName);
            var btn2Name = 'pbCancelAll_' + cityId;
            CancelAllEventListener(cityId, btn2Name);
            t.showBuildQueue(cityId, false);
        }
        document.getElementById('pbBuildType').addEventListener('change', function(){t.setBuildMode(this.value);}, false);
        document.getElementById('pbBuildRunning').addEventListener('click', function(){t.toggleStateRunning(this);}, false);
        document.getElementById('pbBuildMode').addEventListener('click', function(){t.toggleStateMode(this);}, false);
        document.getElementById('pbHelpRequest').addEventListener ('change', function (){t.buildStates.help = (document.getElementById('pbHelpRequest').checked);t.saveBuildStates();}, false);     
        document.getElementById('pbAddToQueue').addEventListener ('click', function (){t.LevelUp();}, false);   
        window.addEventListener('unload', t.onUnload, false);     
        function addQueueEventListener(cityId, name){document.getElementById(name).addEventListener('click', function(){t.showBuildQueue(cityId, true);}, false);}     
        function CancelAllEventListener(cityId, name){
            document.getElementById(name).addEventListener('click', function(){
                for (var i=0;i<t["bQ_" + cityId].length;i++) if (t["bQ_" + cityId][i].buildingLevel==0) ClearStartUpQueue(cityId,t["bQ_" + cityId][i]);
                t["bQ_" + cityId] = [];
                t['totalTime_' + cityId] = 0;
                document.getElementById('pbbuildcount_' + cityId).innerHTML = 0;
                document.getElementById('pbbuildtotal_' + cityId).innerHTML = timestr(0);
            }, false);
        }
	    
    },
    LevelUp: function () {
        var t = Tabs.build;
        var cityBuildings = Seed.buildings["city" + t.Addcity.city.id];
        
        for (k in cityBuildings){
        	var id = parseInt(document.getElementById('pbSelectType').value);
        	if (id == 999 && cityBuildings['pos500'] != undefined) id = cityBuildings['pos500'][0]; 
        	if (cityBuildings[k][0] == id){
        		var cityId = t.Addcity.city.id;
        		var buildingMode = "build";
        		var buildingPos = parseInt(cityBuildings[k][2]);
        		var buildingType = parseInt(cityBuildings[k][0]);
        		var buildingAttempts = parseInt(0); 
        		var buildingLevel = parseInt(cityBuildings[k][1]);
        		var result = t.calculateQueueValues(cityId, buildingLevel, buildingType, buildingMode);
				var buildingMult = result[0];
				var buildingTime = result[1];
				var buildingId = parseInt(cityBuildings[k][3]);	
        		for (l in t["bQ_" + cityId]){
        			if (t["bQ_" + cityId][l].buildingId == buildingId) buildingLevel = parseInt((t["bQ_" + cityId][l].buildingLevel +1));
				} 
				if (buildingLevel > 0 && buildingLevel <9) t.addQueueItem(cityId, buildingPos, buildingType, buildingId, buildingTime, buildingLevel, buildingAttempts, buildingMult, buildingMode);
        	}

        }
    }, 
    setBuildMode: function (type) {
        var t = Tabs.build;
        t.currentBuildMode = type;
    },    
    e_autoBuild: function(){
      var t = Tabs.build;
        document.getElementById('pbbuildError').innerHTML = '';
      if (t.buildStates.running == 'ON') {
          var now = unixTime();
          var counter= 0;
          for (var i = 0; i < Cities.cities.length; i++) {
              var cityId = Cities.cities[i].id;
              var isBusy = false;
              var qcon = Seed.queue_con["city" + cityId];
              if (matTypeof(qcon)=='array' && qcon.length>0) {
                if (parseInt(qcon[0][4]) > now)
                  isBusy = true;
                else
                  qcon.shift();   // remove expired build from queue        
              }              
              if (isBusy) {
              } else {
                 if (t["bQ_" + cityId].length > 0) { // something to do?
                      var bQi = t["bQ_" + cityId][0];   //take first queue item to build
                      counter++;
                      setTimeout(t.doOne,(counter*2500),bQi);
                 }
              }           
            }
          }
    },  
    doOne : function (bQi){
        var t = Tabs.build;
        var currentcityid = parseInt(bQi.cityId);
        var cityName = t.getCityNameById(currentcityid);
        var time = parseInt(bQi.buildingTime);
        var mult = parseInt(bQi.buildingMult);
        var attempt = parseInt(bQi.buildingAttempt);
		var bypasscheck = false;        
        var mode = bQi.buildingMode;
        var citpos = parseInt(bQi.buildingPos);
        
        if ((Seed.buildings['city' + currentcityid]["pos" + citpos] == undefined)) {
        	bypasscheck = true;
        	if (currentcityid == unsafeWindow.currentcityid) document.getElementById('slot_'+ citpos).className="blank";
        }

			
			if(!bypasscheck) {
				var l_bdgid = parseInt(bQi.buildingType); //JUST FOR CHECK
				var bdgid = parseInt(Seed.buildings['city' + currentcityid]["pos" + citpos][0]);
				//  var bdgid = 13; //FOR DEBUG
				var l_curlvl = parseInt(bQi.buildingLevel); //JUST FOR CHECK
				var curlvl = parseIntNan(Seed.buildings['city' + currentcityid]["pos" + citpos][1]);
				//  var curlvl = 8; //FOR DEBUG
				var l_bid = parseInt(bQi.buildingId); //JUST FOR CHECK
				var bid = parseInt(Seed.buildings["city" + currentcityid]["pos" + citpos][3]);
				//  var bid = 1523749; //FOR DEBUG        
				if (curlvl > 8 && mode == 'build') {
					t.cancelQueueElement(0, currentcityid, time, false);
					actionLog(translate("Queue item deleted: Building level equals 9 or higher!!!"));
					return;
				};
				if (isNaN(curlvl)) {
					t.cancelQueueElement(0, currentcityid, time, false);
					actionLog(translate("Found no correct value for current building!!!!"));
					return;
				}
				if (l_bdgid != bdgid) {
					t.cancelQueueElement(0, currentcityid, time, false);
					actionLog(translate("Building Type does not match!!!!"));
					return;
				}
				if (l_bid != bid) {
					t.cancelQueueElement(0, currentcityid, time, false);
					actionLog(translate("Building ID does not match!!!!"));
					return;
				}
				if (l_curlvl < curlvl) {
						t.cancelQueueElement(0, currentcityid, time, false);
						actionLog(translate("Queue item deleted: Building level is equal or higher!!!"));
						return;
				}
				if (l_curlvl > curlvl && mode == 'build') {
						t.requeueQueueElement(bQi);
						return;
				}
			} else {
				var l_bdgid = parseInt(bQi.buildingType); //JUST FOR CHECK
				var bdgid = l_bdgid;
				//  var bdgid = 13; //FOR DEBUG			
				var l_curlvl = parseInt(bQi.buildingLevel); //JUST FOR CHECK
				var curlvl = l_curlvl;
				//  var curlvl = 8; //FOR DEBUG
				var l_bid = parseInt(bQi.buildingId); //JUST FOR CHECK
				var bid = l_bid;
			}

            if (mode == 'destruct') {
                var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
                params.cid = currentcityid;
                params.bid = "";
                params.pos = citpos;
                params.lv = curlvl - 1;
                if (curlvl >= 1) {
                    params.bid = bid;
                }
                params.type = bdgid;
                
                new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/destruct.php" + unsafeWindow.g_ajaxsuffix, {
                    method: "post",
                    parameters: params,
                    onSuccess: function(transport){
                    	var rslt = eval("(" + transport.responseText + ")");
                        if (rslt.ok) {
                            actionLog("Destructing " + unsafeWindow.buildingcost['bdg' + bdgid][0] + " at " + cityName);
                            Seed.queue_con["city" + currentcityid].push([bdgid, 0, parseInt(rslt.buildingId), unsafeWindow.unixtime(), unsafeWindow.unixtime() + rslt.timeNeeded, 0, rslt.timeNeeded, citpos]);
                            if (params.cid == unsafeWindow.currentcityid) unsafeWindow.update_bdg();
                            if (document.getElementById('pbHelpRequest').checked == true) t.bot_gethelp(params.bid, currentcityid);
                            t.cancelQueueElement(0, currentcityid, time, false);
                        } else {
                            var errmsg = unsafeWindow.printLocalError(rslt.error_code || null, rslt.msg || null, rslt.feedback || null);
                            t.requeueQueueElement(bQi);
                            document.getElementById('pbbuildError').innerHTML = errmsg;
                            logit("Destruct error: " + errmsg);
                        }
                    },
                    onFailure: function(){
                        document.getElementById('pbbuildError').innerHTML = translate("Connection Error while destructing! Please try later again");
                    }
                })
            }
            if (mode == 'build') {
                var invalid = false;
                var chk = unsafeWindow.checkreq("bdg", bdgid, curlvl); //check if all requirements are met
                for (var c = 0; c < chk[3].length; c++) {
                    if (chk[3][c] == 0) {
                        invalid = true;
                    }
                }
                if (invalid == false) {                            
                    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
                    params.cid = currentcityid;
                    params.bid = "";
                    params.pos = citpos;
                    params.lv = curlvl + 1;
                    if (params.lv > 9){ //make sure that no level 10+ is built
                        t.cancelQueueElement(0, currentcityid, time, false);
                        actionLog(translate("Queue item deleted: Tryed to build level 10+ building! Please report if this happens!!!"));
                        return;
                    }
                    params.bid = ((params.lv>1)?bid:"");
                    params.type = bdgid;
                    params.permission=0;
                    
                    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/construct.php" + unsafeWindow.g_ajaxsuffix, {
                        method: "post",
                        parameters: params,
                        onSuccess: function(rslt){
                            if (rslt.ok) {
                                actionLog(translate("Building")+" " + unsafeWindow.buildingcost['bdg' + bdgid][0] + " Level " + params.lv + " at " + cityName);                                
                                Seed.resources["city" + currentcityid].rec1[0] -= parseInt(unsafeWindow.buildingcost["bdg" + bdgid][1]) * mult * 3600;
                                Seed.resources["city" + currentcityid].rec2[0] -= parseInt(unsafeWindow.buildingcost["bdg" + bdgid][2]) * mult * 3600;
                                Seed.resources["city" + currentcityid].rec3[0] -= parseInt(unsafeWindow.buildingcost["bdg" + bdgid][3]) * mult * 3600;
                                Seed.resources["city" + currentcityid].rec4[0] -= parseInt(unsafeWindow.buildingcost["bdg" + bdgid][4]) * mult * 3600;
                                Seed.citystats["city" + currentcityid].gold[0] -= parseInt(unsafeWindow.buildingcost["bdg" + bdgid][5]) * mult;
                                Seed.queue_con["city" + currentcityid].push([bdgid, curlvl + 1, parseInt(rslt.buildingId), unsafeWindow.unixtime(),  unsafeWindow.unixtime() + time, 0, time, citpos]);                        
                                if (curlvl == 0) unsafeWindow.seed.buildings["city" + currentcityid]["pos" + citpos] = [bdgid, 0, citpos, rslt.buildingId];
                                if (currentcityid == unsafeWindow.currentcityid) {
                                	unsafeWindow.modal_build_show_state();
									unsafeWindow.Modal.hideModalAll();
                                    unsafeWindow.update_bdg();
                    				unsafeWindow.queue_changetab_building();
                    			}
                                if (document.getElementById('pbHelpRequest').checked == true && time > 59) t.bot_gethelp(params.bid, currentcityid);
                                t.cancelQueueElement(0, currentcityid, time, false);
                            } else {
                                var errmsg = unsafeWindow.printLocalError(rslt.error_code || null, rslt.msg || null, rslt.feedback || null);
                                if (rslt.error_code == 103 || rslt.error_code == 2) { // building has already the target level => just  delete
                                    t.cancelQueueElement(0, currentcityid, time, false);
                                    actionLog(translate("Queue item deleted: Building at this Level already exists or build process already started!"));
                                } else {
                                    t.requeueQueueElement(bQi);
                                    document.getElementById('pbbuildError').innerHTML = Cities.byID[currentcityid].name +': '+ errmsg + translate(" Item was requeued. Check for retry count.");
                                }
                                logit("Construct error: "+errmsg);
                            }
                    	},
                        onFailure: function(){
                            document.getElementById('pbbuildError').innerHTML = translate("Connection Error while building! Please try later again");
                        }
                    });
                } else {
                    t.requeueQueueElement(bQi); // requeue item if check is invalid
                }
            }
    },
    test: function(){
    	for (var h = 0; h < unsafeWindow.seed.queue_con["city" + unsafeWindow.currentcityid].length; h++) {
        var n = unsafeWindow.seed.queue_con["city" + unsafeWindow.currentcityid][h];
        var e = unsafeWindow.document.getElementById("slot_" + n[7]);
	        if (e != null) {
	            var f = n[1];
	            var c = n[2];
	            e.innerHTML = "";
	            e.className = ("inprocess");
	            var b = document.createElement("span");
	            b.className = "backgroundContainer";
	            b.innerHTML = "<span class='leveltag'>" + f + "</span><span class='currentlybuilding'></span>";
	            e.appendChild(b);
	            var p = document.createElement("span");
	            p.className = "speedupButton";
	            p.innerHTML = "<a class='inlineButton20Red' name='" + c + "' onclick='cm.BuildingSpeedupController.buildingClick(event)'><span>" + unsafeWindow.g_js_strings.commonstr.speedup + "</span></a>";
	            e.appendChild(p)
	        }
    	}
    },
    requeueQueueElement: function (bQi) {
        var t = Tabs.build;
        var cityId = bQi.cityId;
        var buildingPos = parseInt(bQi.buildingPos);
        var buildingId = parseInt(bQi.buildingId);
        var buildingLevel = parseInt(bQi.buildingLevel);
        var buildingType = parseInt(bQi.buildingType);
        var buildingTime = parseInt(bQi.buildingTime);
        var buildingMult = parseInt(bQi.buildingMult);
        var buildingAttempts = parseInt(bQi.buildingAttempts);
        var buildingMode = bQi.buildingMode;
        t.addQueueItem(cityId, buildingPos, buildingType, buildingId, buildingTime, buildingLevel, buildingAttempts + 1, buildingMult, buildingMode); // requeue item
        t.cancelQueueElement(0, cityId, buildingTime, false); // delete Queue Item
    },
    show: function(){       
    },
    bot_buildslot: function(c, a){
        var t = Tabs.build;
        var cityId = t.getCurrentCityId();
        var buildingPos   = c.id.split("_")[1];
        var buildingType  = parseInt(Seed.buildings['city' + cityId]["pos" + buildingPos][0]);
        var buildingLevel = parseInt(Seed.buildings['city' + cityId]["pos" + buildingPos][1]);
        var buildingId    = parseInt(Seed.buildings['city' + cityId]["pos" + buildingPos][3]);
        if (DEBUG_TRACE) logit("Pos: " + buildingPos + " Type: " + buildingType + " Level: " + buildingLevel + " Id: " + buildingId);
          var buildingAttempts = 0;
        var loaded_bQ = t["bQ_" + cityId];
        if (typeof Seed.queue_con['city' + cityId][0] != 'undefined') {
            var current_construction_pos = Seed.queue_con['city' + cityId][0][2];
        } else {
            var current_construction_pos = "";
        }
        if (loaded_bQ.length == 0 && current_construction_pos != "" ) { //check anyway if there is currently build in progess for this specific building
            if (current_construction_pos != 'NaN' && current_construction_pos == buildingId) {
                buildingLevel += 1;
            }
        } else {
            if (current_construction_pos != "" && current_construction_pos == buildingId) {
                buildingLevel += 1;
            }
            for (var i = 0; i < loaded_bQ.length; i++) { // check if there are already queue items for this building or the building is currently building
                var loadedCity = loaded_bQ[i].cityId;
                var loadedSlot = loaded_bQ[i].buildingPos;
                if (loadedSlot == buildingPos && loadedCity == cityId) {
                    buildingLevel += 1;
                }
                if (loaded_bQ[i].buildingMode == 'destruct' && loadedSlot == buildingPos && loadedCity == cityId) { // check if destrcution is already in queue
                    t.modalmessage(translate("Destruction already in Queue!"));
                    return;
                }
            }
        }
        if (t.currentBuildMode == "build") {
            if (buildingLevel >= 9) {
                t.modalmessage(translate('Due to building requirements (DI), buildings above level 9\nshould be manualy built.'));
                return;
            }
            var buildingMode = "build";
            var result = t.calculateQueueValues(cityId, buildingLevel, buildingType, buildingMode);
            var buildingMult = result[0];
            var buildingTime = result[1];
            var queueId = loaded_bQ.length;
            t.addQueueItem(cityId, buildingPos, buildingType, buildingId, buildingTime, buildingLevel, buildingAttempts, buildingMult, buildingMode);
            t._addTab(queueId, cityId, buildingType, buildingTime, buildingLevel, buildingAttempts, buildingMode);
        }
        if (t.currentBuildMode == "max") {
            var buildingMode = "build";
            for (var bL = buildingLevel; bL <9; bL++) {
                var queueId = loaded_bQ.length;
                var result = t.calculateQueueValues(cityId, bL, buildingType, buildingMode);
                var buildingMult = result[0];
                var buildingTime = result[1];
                queueId = queueId ;
                t.addQueueItem(cityId, buildingPos, buildingType, buildingId, buildingTime, bL, buildingAttempts, buildingMult, buildingMode);
                t._addTab(queueId, cityId, buildingType, buildingTime, bL, buildingAttempts, buildingMode);
            }
        }
        if (t.currentBuildMode == "destruct") {
            var buildingMode = "destruct";
            var result = t.calculateQueueValues(cityId, buildingLevel, buildingType, buildingMode);
            var buildingMult = result[0];
            var buildingTime = result[1];
            var queueId = loaded_bQ.length;
            t.addQueueItem(cityId, buildingPos, buildingType, buildingId, buildingTime, buildingLevel, buildingAttempts, buildingMult, buildingMode);
            t._addTab(queueId, cityId, buildingType, buildingTime, buildingLevel, buildingAttempts, buildingMode);
        }

    },
    calculateQueueValues: function (cityId, buildingLevel, buildingType, buildingMode) {
        var t = Tabs.build;
        var now = unixTime();
        var constructionBoost = unsafeWindow.cm.ThroneController.effectBonus(78);        
        if (buildingMode == 'build') {
            var buildingMult = Math.pow(2, buildingLevel);
        }
        if (buildingMode == 'destruct') {
            var buildingMult = Math.pow(2, buildingLevel - 2);
        }
                
        var knights = Seed.knights["city" + cityId];
        if (knights) {
            var polKniId = parseInt(Seed.leaders['city' + cityId].politicsKnightId);
            if (polKniId) {
                var polValue = parseInt(Seed.knights['city' + cityId]['knt' + polKniId].politics);
                var polBoost = parseInt(Seed.knights['city' + cityId]['knt' + polKniId].politicsBoostExpireUnixtime);
                if ((polBoost - now) > 0) {
                    polValue = parseInt(polValue * 1.25);
                }
            } else {
                polValue = 0;
            }
        } else {
            polValue = 0;
        }
        
        var buildingTime = unsafeWindow.buildingcost["bdg" + buildingType][7] * buildingMult;
        if (parseInt(buildingType) < 6 && parseInt(buildingType) > 0 && buildingMult == 1) buildingTime = 15;
        if (buildingMode == 'build') {
            buildingTime = parseInt(buildingTime / (1 + 0.005 * polValue + 0.1 * parseInt(Seed.tech.tch16)));
            if (constructionBoost>0)buildingTime = Math.round(buildingTime / (1 + (constructionBoost / 100)));
        }
        if (buildingMode == 'destruct') {
            buildingTime = buildingTime / (1 + 0.005 * polValue + 0.1 * parseInt(Seed.tech.tch16));
            if (buildingTime % 1 > 0) buildingTime = parseInt(buildingTime);
        }
        
        var result = new Array(buildingMult, buildingTime);
        return result;
    },
    bot_buildguardian: function(c, a){
        var t = Tabs.build;
        var cityId = t.getCurrentCityId();
        var buildingType  = 50;
        for(i=0; i < Cities.numCities; i++){
            if(Seed.guardian[i].cityId == cityId){
                var buildingLevel = Seed.guardian[i].level;
                break;
            }
        }
        var buildingId    = parseInt(Seed.buildings['city' + cityId]["pos" + buildingPos][3]);
        if (DEBUG_TRACE) logit("Pos: " + buildingPos + " Type: " + buildingType + " Level: " + buildingLevel + " Id: " + buildingId);
          var buildingAttempts = 0;
        var loaded_bQ = t["bQ_" + cityId];
        if (typeof Seed.queue_con['city' + cityId][0] != 'undefined') {
            var current_construction_pos = Seed.queue_con['city' + cityId][0][2];
        } else {
            var current_construction_pos = "";
        }
        if (loaded_bQ.length == 0 && current_construction_pos != "" ) { //check anyway if there is currently build in progess for this specific building
            if (current_construction_pos != 'NaN' && current_construction_pos == buildingId) {
                buildingLevel += 1;
            }
        } else {
            if (current_construction_pos != "" && current_construction_pos == buildingId) {
                buildingLevel += 1;
            }
            for (var i = 0; i < loaded_bQ.length; i++) { // check if there are already queue items for this building or the building is currently building
                var loadedCity = loaded_bQ[i].cityId;
                var loadedSlot = loaded_bQ[i].buildingPos;
                if (loadedSlot == buildingPos && loadedCity == cityId) {
                    buildingLevel += 1;
                }
                if (loaded_bQ[i].buildingMode == 'destruct' && loadedSlot == buildingPos && loadedCity == cityId) { // check if destrcution is already in queue
                    t.modalmessage(translate("Destruction already in Queue!"));
                    return;
                }
            }
        }
        if (t.currentBuildMode == "build") {
            if (buildingLevel >= 9) {
                t.modalmessage(translate('Due to building requirements (DI), buildings above level 9\nshould be manualy built.'));
                return;
            }
            var buildingMode = "build";
            var result = t.calculateQueueValues(cityId, buildingLevel, buildingType, buildingMode);
            var buildingMult = result[0];
            var buildingTime = result[1];
            var queueId = loaded_bQ.length;
            t.addQueueItem(cityId, buildingPos, buildingType, buildingId, buildingTime, buildingLevel, buildingAttempts, buildingMult, buildingMode);
            t._addTab(queueId, cityId, buildingType, buildingTime, buildingLevel, buildingAttempts, buildingMode);
        }
        if (t.currentBuildMode == "max") {
            var buildingMode = "build";
            for (var bL = buildingLevel; bL <9; bL++) {
                var queueId = loaded_bQ.length;
                var result = t.calculateQueueValues(cityId, bL, buildingType, buildingMode);
                var buildingMult = result[0];
                var buildingTime = result[1];
                queueId = queueId ;
                t.addQueueItem(cityId, buildingPos, buildingType, buildingId, buildingTime, bL, buildingAttempts, buildingMult, buildingMode);
                t._addTab(queueId, cityId, buildingType, buildingTime, bL, buildingAttempts, buildingMode);
            }
        }
        if (t.currentBuildMode == "destruct") {
            var buildingMode = "destruct";
            var result = t.calculateQueueValues(cityId, buildingLevel, buildingType, buildingMode);
            var buildingMult = result[0];
            var buildingTime = result[1];
            var queueId = loaded_bQ.length;
            t.addQueueItem(cityId, buildingPos, buildingType, buildingId, buildingTime, buildingLevel, buildingAttempts, buildingMult, buildingMode);
            t._addTab(queueId, cityId, buildingType, buildingTime, buildingLevel, buildingAttempts, buildingMode);
        }

    },
    calculateQueueValues: function (cityId, buildingLevel, buildingType, buildingMode) {
        var t = Tabs.build;
        var now = unixTime();
        if (buildingMode == 'build') {
            var buildingMult = Math.pow(2, buildingLevel);
        }
        if (buildingMode == 'destruct') {
            var buildingMult = Math.pow(2, buildingLevel - 2);
        }
                
        var knights = Seed.knights["city" + cityId];
        if (knights) {
            var polKniId = parseInt(Seed.leaders['city' + cityId].politicsKnightId);
            if (polKniId) {
                var polValue = parseInt(Seed.knights['city' + cityId]['knt' + polKniId].politics);
                var polBoost = parseInt(Seed.knights['city' + cityId]['knt' + polKniId].politicsBoostExpireUnixtime);
                if ((polBoost - now) > 0) {
                    polValue = parseInt(polValue * 1.25);
                }
            } else {
                polValue = 0;
            }
        } else {
            polValue = 0;
        }
        var buildingTime = unsafeWindow.buildingcost["bdg" + buildingType][7] * buildingMult;
        if (parseInt(buildingType) < 6 && parseInt(buildingType) > 0 && buildingMult == 1) {
            buildingTime = 15;
        }
        if (buildingMode == 'build') {
            buildingTime = parseInt(buildingTime / (1 + 0.005 * polValue + 0.1 * parseInt(Seed.tech.tch16)));
        }
        if (buildingMode == 'destruct') {
            buildingTime = buildingTime / (1 + 0.005 * polValue + 0.1 * parseInt(Seed.tech.tch16));
            if (buildingTime % 1 > 0) {
                buildingTime = parseInt(buildingTime);
            }
        }
        
        var result = new Array(buildingMult, buildingTime);
        return result;
    },
    bot_gethelp: function (f, currentcityid) {
        var t = Tabs.build;
        var city = t.getCityNameById(currentcityid);
      var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
      params.bid = f;
      params.ctrl = 'AskForHelp';
      params.action = 'getHelpData';
      
      new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
          method: "post",
          parameters: params,
          onSuccess: function (rslt) {
            unsafeWindow.handleHelpCallback (rslt.data);
          },
          onFailure: function (rslt) {
            t.bot_gethelp (f, currentcityid);
            return;
          },
          });

      var a = Seed.queue_con["city" + currentcityid];
      var e = 0;
      var d = 0;
      for (var c = 0; c < a.length; c++) {
        if (parseInt(a[c][2]) == parseInt(f)) {
          e = parseInt(a[c][0]);
          d = parseInt(a[c][1]);
          break
        }
      }
      var b = new Array();
      b.push(["REPLACE_LeVeLbUiLdInG", d]);
      b.push(["REPLACE_BuIlDiNgNaMe", unsafeWindow.buildingcost["bdg" + e][0]]);
      b.push(["REPLACE_LeVeLiD", d]);
      b.push(["REPLACE_AsSeTiD", f]);
      var g = function(h, i) {
        unsafeWindow.continuation_95(h, i);
        if (!h) {
          var j = d > 1 ? unsafeWindow.cm.SpeedUpType.upgrade : unsafeWindow.cm.SpeedUpType.build;
          unsafeWindow.cm.ClientSideCookieManager.setCookie(j, false)
        }
      };
      unsafeWindow.common_postToProfile("95", unsafeWindow.Object.cloneFeed(unsafeWindow.template_data_95), unsafeWindow.Object.cloneFeed(unsafeWindow.actionlink_data_95), g, b)
    },
    addQueueItem: function (cityId, buildingPos, buildingType, buildingId, buildingTime, buildingLevel, buildingAttempts, buildingMult, buildingMode) {
    var t = Tabs.build;
        var lbQ = t["bQ_" + cityId];
        lbQ.push({
            cityId:             cityId,
            buildingPos:        buildingPos,
            buildingType:         buildingType,
            buildingId:         buildingId,
            buildingTime:         buildingTime,
            buildingLevel:         buildingLevel,
            buildingAttempts:     buildingAttempts,
            buildingMult:         buildingMult,
            buildingMode:         buildingMode
        });
        t.modifyTotalTime(cityId, 'increase', buildingTime); //adjust total Time
        //Paint Dashboard Build mode status icon
        // green button -> document.getElementById('buildStatus').innerHTML = '<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAVNJREFUeNrUk09OwkAUh9+gUKpAFIuIfxJilLIlMd6gaw+Ax/AY7r2AnMFFb2DcC5gYYlBotYKttEwp83zjQtFIN6x8yZfJ9PfypZM3wxARFqkELFgLC5ZnN+yyQF9YjrR12hpEiegRJghoQIQunj7PF1DlQOB5dadi6Nt6cSWlKiPu8+ZTq9bu3tUoPyPc+UcQWK9sHRh6oVIOXF91XpzE2AtUXTss72tlQ+axR4AQjb313aJlWSCEAM75J3JS2dVMUebUdREjECWcojLwBiCZRJOvKB2mFZnH/wEXvb7b5zbaKmR+No6jMZd5/Bg5mt3HByupJQE24Js8gD/0LJnHC0zecNuO6d06HcGmAWRBTCEK/NZbh9+PTJn/FrDZq8wYS0GeVeE4cQIldkT6TZq/DT28gWtxBa/YpP73OMESLWuE8seli4gh9YdzBf/zMX0IMACs96WetcYlTQAAAABJRU5ErkJggg=="/>';	 
        if (document.getElementById('buildStatus')) document.getElementById('buildStatus').innerHTML = '<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAVlJREFUeNrUU0FOg0AU/VMbCA1tjI0iLmx1U9OQNk2MN2DtAeoxPIZ7L2DP4IIbGDdNF9oNITXBlISWgi0OhcGPRNMQYcPKSV7I5z0e//2ZIXEcQ5lVgZKrtEF1t3ggJHnRQNchlipCRrwjNAYwCgHcm0zkasawgcK7s15PPe/3JV4U+U/Po/p4PNAnkwHytwg3NwJ+PDxVFPVEUdq26wqmaVYWniccd7ttudNRWdpZfgcBtt1stSTDMIAxBpTSbyQ7VRdFKUhj3RcZyEEU8SvbBm+5hHC7/eVorcYH6UzyO6A4MMc0aWxZgpgRhr5PaTrQ/G1EgfY2m80POQ6aWP/gAOGs1/OELzRAdjR1HO3FdQ3CmF9P5hpF/nSzMXRKtYTPGpDdo0wI4fBvF1cA1xj2Et2PcPIW9v38BPC4AHhF/UeRwR4+9hH8H4cuTJKgPsg1+J+X6UuAAQAG85S2YfuhcwAAAABJRU5ErkJggg=="/>';
        if (document.getElementById('buildStatus')) setTimeout (function() {document.getElementById('buildStatus').innerHTML = '<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAWJJREFUeNrUU79PwkAUvv5IG6iAg8HEMIlxNLBCNxkkYah/gP6NmAChiYQUupjA4uCicbKJBQ0E24OWtvjdgCHGdmHyJV/efffuvrx37x232WzIPsaTPW1vAXGXaJpGRFGUOY67AD0FMsAX8IpSH4Mg8JrNZrwATI6i6KrRaGjVarWWTqePXde1TdO873Q67GYX8GIFwjAs1ev160qlckMp5QG2XQC/Xa1WnK7r7+APsQLr9fq8XC7XbNvmWXd832d7BFnxxWKxhnUvUQAXcqg/7zgOcRyKjIKfmCRJeRZPfETP89zJ5HO6XIYngiAThq1R6k5ZPLGNOPBsGMYglcpEsqyQLSRJicbj8YDFEzOwLGvUat21KfVFVb1Us9nc0WIx/xgOe2a/323PZrPRbwFud5RRvyQIwpmiKCX4AvgB4g6684Z2PsG/MJ4kIMAdsnn4Y+jYi85x3o8V+J+f6VuAAQDR57f+eJX9fgAAAABJRU5ErkJggg=="/>';}, 1000);  

    },
    modalmessage: function(message){
        var t = Tabs.build;
        var timeout = 10000;
        var content = translate("autoclose after 10sec")+"...<br><br>"
        content += message;
        unsafeWindow.Modal.showAlert(content);
        window.setTimeout('unsafeWindow.Modal.hideModal();', timeout);
    },
    modifyTotalTime: function (cityId, type, buildingTime) {
        var t = Tabs.build;
        var element = document.getElementById('pbbuildcount_' + cityId);
        var currentCount = parseInt(element.innerHTML);
        if (type == "increase") {
            t['totalTime_' + cityId] = t['totalTime_' + cityId] + buildingTime;
            var currentCount = currentCount + 1;
        }
        if (type == "decrease") {
            t['totalTime_' + cityId] = t['totalTime_' + cityId] - buildingTime;
            var currentCount = currentCount - 1;
        }
        element.innerHTML = currentCount;
        document.getElementById('pbbuildtotal_' + cityId).innerHTML = timestr(t['totalTime_' + cityId]);
    },
    hide: function(){
        var t = Tabs.build;
        clearTimeout(t.HelpTimer);
    },
    onUnload: function(){
        var t = Tabs.build;
        for (var i = 0; i < Cities.cities.length; i++) {
            if (!ResetAll) GM_setValue('bQ_' + getServerId() + '_' + Cities.cities[i].id, JSON2.stringify((t["bQ_" + Cities.cities[i].id])));
        }
        t.saveBuildStates();
    },
    _addTab: function(queueId, cityId, buildingType, buildingTime, buildingLevel, buildingAttempts, buildingMode){
        var t = Tabs.build;
        var row = document.getElementById('pbCityQueueContent').insertRow(0);
        row.vAlign = 'top';
        row.insertCell(0).innerHTML = queueId;
        if (buildingMode == "destruct") {
            row.insertCell(1).innerHTML = '<img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/bonus_att.png">';
        }
        else {
            row.insertCell(1).innerHTML = '<img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/bonus_prod.png">';
        }
        row.insertCell(2).innerHTML = unsafeWindow.buildingcost['bdg' + buildingType][0];
        row.insertCell(3).innerHTML = timestr(buildingTime);
        if (buildingMode == "destruct") {
            row.insertCell(4).innerHTML = 0;
        } else {
            row.insertCell(4).innerHTML = buildingLevel + 1; // => target Level
        }
        row.insertCell(5).innerHTML = buildingAttempts;
        row.insertCell(6).innerHTML = '<a class="button20" id="queuecancel_' + queueId + '"><span>Cancel</span></a>';
        document.getElementById('queuecancel_' + queueId).addEventListener('click', function(){
            t.cancelQueueElement(queueId, cityId, buildingTime, true);
        }, false);
    },
    cancelQueueElement: function(queueId, cityId, buildingTime, showQueue){
        var t = Tabs.build;
        var queueId = parseInt(queueId);
		if (t["bQ_" + cityId][queueId].buildingLevel==0) ClearStartUpQueue(cityId,t["bQ_" + cityId][queueId]);
        t["bQ_" + cityId].splice(queueId, 1);
        t.modifyTotalTime(cityId, 'decrease', buildingTime); //adjust total Time        
        if (showQueue == true) t.showBuildQueue(cityId, false);     
    },
    showBuildQueue: function(cityId, focus){
        var t = Tabs.build;
        clearTimeout (t.timer);
        var popBuildQueue = null;
        var cityName = t.getCityNameById(cityId);
        if (t.popBuildQueue == null) {
            t.popBuildQueue = new pbPopup('pbbuild_' + cityId, 0, 0, 350, 500, true, function() {clearTimeout (t.timer);});
        }
        var m = '<DIV style="max-height:460px; height:460px; overflow-y:auto"><TABLE align=center cellpadding=0 cellspacing=0 width=100% class="pbTabPad" id="pbCityQueueContent">';       
        t.popBuildQueue.getMainDiv().innerHTML = '</table></div>' + m;
        t.popBuildQueue.getTopDiv().innerHTML = '<TD width="200px"><B>'+translate("Build Queue of")+' ' + cityName + '</b></td><TD><INPUT id=pbOptimizeByTime type=submit class=pbButton value="'+translate("Optimize by Time")+'"></td>';
        t.paintBuildQueue(cityId);
        if (focus)
          t.popBuildQueue.show(true);
        document.getElementById('pbOptimizeByTime').addEventListener('click', function(){t.clearBuildQueue();t.paintBuildQueue(cityId, true);}, false);
        t.timer = setTimeout (function() {t.showBuildQueue(cityId, false)}, 45000);  
    },
    paintBuildQueue: function(cityId, optimize){
        var t = Tabs.build;
        var lbQ = t["bQ_" + cityId];
        if (optimize == true) {
            lbQ.sort(function(a,b){return a.buildingTime - b.buildingTime});
        }
        t["bQ_" + cityId] = lbQ;
        for (var i = 0; i < lbQ.length; i++) {
            var queueId = i;
            t._addTab(queueId, lbQ[i].cityId, lbQ[i].buildingType, lbQ[i].buildingTime, lbQ[i].buildingLevel, lbQ[i].buildingAttempts, lbQ[i].buildingMode);
        }
    },
    clearBuildQueue: function() {
        var t = Tabs.build;
        var table = document.getElementById('pbCityQueueContent');
        var rows = table.rows;
        while(rows.length)
            table.deleteRow(rows.length-1);
    },
    getCurrentCityId: function(){ // TODO maybe move as global function to the core application
        if (!unsafeWindow.currentcityid) return null;
        return unsafeWindow.currentcityid;
    },
    saveBuildStates: function(){
        var t = Tabs.build;
        var serverID = getServerId();
        GM_setValue('buildStates_' + serverID, JSON2.stringify(t.buildStates));
    },
    readBuildStates: function(){
        var t = Tabs.build;
        var serverID = getServerId();
        s = GM_getValue('buildStates_' + serverID);
        if (s != null) {
            states = JSON2.parse(s);
            for (k in states)
                t.buildStates[k] = states[k];
        }
        if (t.buildStates.running==true) t.buildStates.running = 'ON';
        if (t.buildStates.running==false) t.buildStates.running = 'OFF';
    },
    toggleStateRunning: function(obj){
        var t = Tabs.build;
        if (t.buildStates.running == 'OFF') {
            t.buildStates.running = 'ON';
            t.saveBuildStates();
            if (document.getElementById('pbBuildRunning')) {document.getElementById('pbBuildRunning').value = "Auto Build = ON";document.getElementById('pbBuildRunning').setAttribute("class", "buttonDash_ON");}
        	if (document.getElementById('BuildToggle')) {document.getElementById('BuildToggle').value = "Auto Build = ON";document.getElementById('BuildToggle').setAttribute("class", "buttonDash_ON");}
        } else if (t.buildStates.running == 'ON') {
            t.buildStates.running = 'AUTO';
            t.saveBuildStates();
            if (document.getElementById('pbBuildRunning')) {document.getElementById('pbBuildRunning').value = "Auto Build = AUTO";document.getElementById('pbBuildRunning').setAttribute("class", "buttonDash_ON");}
        	if (document.getElementById('BuildToggle')) {document.getElementById('BuildToggle').value = "Auto Build = AUTO";document.getElementById('BuildToggle').setAttribute("class", "buttonDash_ON");}
        } else if (t.buildStates.running == 'AUTO') {
            t.buildStates.running = 'OFF';
            t.saveBuildStates();
            if (document.getElementById('pbBuildRunning')) {document.getElementById('pbBuildRunning').value = "Auto Build = OFF";document.getElementById('pbBuildRunning').setAttribute("class", "buttonDash_OFF");}
        	if (document.getElementById('BuildToggle')) {document.getElementById('BuildToggle').value = "Auto Build = OFF";document.getElementById('BuildToggle').setAttribute("class", "buttonDash_OFF");}
        }
    },
    toggleStateMode: function(obj){
        var t = Tabs.build;
        if (obj.value == translate('Build Mode = OFF')) {
            unsafeWindow.buildslot = t.startupTest; // overwrite original koc function
            var guardian = document.getElementById('citymap').getElementsByClassName('bldg_guardian_0');
            if(guardian.length >0) guardian[0].addEventListener('click', t.bot_buildguardian, false);
            if (document.getElementById('pbBuildMode')) {document.getElementById('pbBuildMode').value = "Build Mode = ON";document.getElementById('pbBuildMode').setAttribute("class", "buttonDash_ON");}
        	if (document.getElementById('BuildModeToggle')) {document.getElementById('BuildModeToggle').value = "Build Mode = ON";document.getElementById('BuildModeToggle').setAttribute("class", "buttonDash_ON");}
        	t.buildMode = true;
        }
        else {
            unsafeWindow.buildslot = t.koc_buildslot; // restore original koc function
            var guardian = document.getElementById('citymap').getElementsByClassName('bldg_guardian_0');
            if(guardian.length >0) guardian[0].removeEventListener('click', t.bot_buildguardian, false);
            if (document.getElementById('pbBuildMode')) {document.getElementById('pbBuildMode').value = "Build Mode = OFF";document.getElementById('pbBuildMode').setAttribute("class", "buttonDash_OFF");}
        	if (document.getElementById('BuildModeToggle')) {document.getElementById('BuildModeToggle').value = "Build Mode = OFF";document.getElementById('BuildModeToggle').setAttribute("class", "buttonDash_OFF");}
        	t.buildMode = false;
        }
    },
    getCityNameById: function (cityId) {
    	return Cities.byID[cityId].name;      
    },
    FullAuto: function(){
    	var t = Tabs.build;
    	var Queue = {1:[],2:[],3:[],4:[],5:[],6:[],7:[],8:[]};
    	var counter=0;
    	for (var i=0;i<Seed.cities.length;i++){
    		if (Seed.queue_con['city'+Seed.cities[i][0]].length==0){
    			for (var y in Seed.buildings['city'+Seed.cities[i][0]]) if (Seed.buildings['city'+Seed.cities[i][0]][y][1]>=1 && Seed.buildings['city'+Seed.cities[i][0]][y][1]<9) Queue[i+1].push({
    				cid: 		parseInt(Seed.cities[i][0]),
    				bid: 		parseInt(Seed.buildings['city'+Seed.cities[i][0]][y][3]),
    				pos: 		parseInt(Seed.buildings['city'+Seed.cities[i][0]][y][2]),
    				lvl: 		parseInt(Seed.buildings['city'+Seed.cities[i][0]][y][1]),
    				type: 		parseInt(Seed.buildings['city'+Seed.cities[i][0]][y][0])
    			})
    		}
    	}
    	for (var i=1;i<=Seed.cities.length;i++){
    		if (Queue[i].length>0){
    			var helpArray = Queue[i];
    			helpArray = helpArray.sort(function sort(a,b) {a = a['lvl'];b = b['lvl'];return a == b ? 0 : (a < b ? -1 : 1);});
    			for (var y=0;y<helpArray.length;y++){
    				var chk = checkreq(Seed.cities[i-1][0],"bdg",helpArray[y].type,helpArray[y].lvl+1);
	    			var met = true;
	                for (var c=0;c<chk[3].length;c++) if (chk[3][c] == 0) met = false;
	                if (met) if (helpArray[y].type !=50) {
	                	counter++;
	                	setTimeout(t.BuildReq,(5000*counter),helpArray[y]);
	                	break;
	                }
	           	}
    		}
    	}
    },
    BuildReq: function(what){
    	var t = Tabs.build;
    	var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
        params.cid = what.cid;
        params.bid = what.bid;
        params.pos = what.pos;
        params.lv = what.lvl + 1;

        if (what.lvl > 9){
            actionLog("Queue item deleted: Tryed to build level 10+ building! Please report if this happens!!!");
            return;
        }
        params.type = what.type;
        params.permission = 0;
        var cityName = t.getCityNameById(params.cid);
   		new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/construct.php" + unsafeWindow.g_ajaxsuffix, {
      		method: "post",
      		parameters: params,
      		onSuccess: function (transport) {
      			var rslt = eval("(" + transport.responseText + ")");
        		if (rslt.ok) {
        			var g = Math.pow(2, what.lvl);
					Seed.resources["city" + params.cid].rec1[0] -= parseInt(unsafeWindow.buildingcost["bdg" + params.type][1]) * g * 3600;
                    Seed.resources["city" + params.cid].rec2[0] -= parseInt(unsafeWindow.buildingcost["bdg" + params.type][2]) * g * 3600;
                    Seed.resources["city" + params.cid].rec3[0] -= parseInt(unsafeWindow.buildingcost["bdg" + params.type][3]) * g * 3600;
                    Seed.resources["city" + params.cid].rec4[0] -= parseInt(unsafeWindow.buildingcost["bdg" + params.type][4]) * g * 3600;
                    Seed.citystats["city" + params.cid].gold[0] -= parseInt(unsafeWindow.buildingcost["bdg" + params.type][5]) * g;
                    Seed.queue_con["city" + params.cid].push([params.type, params.lv, parseInt(rslt.buildingId), unsafeWindow.unixtime(),  unsafeWindow.unixtime() + rslt.timeNeeded, 0, rslt.timeNeeded, params.pos]);
                    if (params.cid == unsafeWindow.currentcityid) unsafeWindow.update_bdg();
                	unsafeWindow.Modal.hideModalAll();
    				unsafeWindow.queue_changetab_building();
    				unsafeWindow.modal_build_show_state();
                    if(rslt.updateSeed) unsafeWindow.update_seed(rslt.updateSeed);    
                    t.bot_gethelp(params.bid, params.cid);
                    actionLog("Building: "+ unsafeWindow.buildingcost['bdg' + params.type][0] + " Level " + params.lv + " at " + cityName); 
        		}
        		else actionLog('Build Error at: ' + cityName + '('+rslt.error_code+')');
      		},
    	});
    },
    startupTest:function(c,a){
    	var t = Tabs.build;
    	var buildingPos   = c.id.split("_")[1];
    	if (Seed.buildings['city'+unsafeWindow.currentcityid]['pos'+buildingPos]!=undefined) {t.bot_buildslot(c,a);return;}
        var baseurl = 'https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/';
    	var prestige = ((Seed.cityData.city[unsafeWindow.currentcityid].prestigeInfo!="")?Seed.cityData.city[unsafeWindow.currentcityid].prestigeInfo.prestigeType:0);
        if (prestige==0) {
        	var BuildingArray={1:"farm_26",2:"sawmill_26",3:"quarry_26",4:"mine_26",5:"cottage_lvl1_26",6:"tavern_lvl1_26",7:"knights_hall_lvl1_gen_26",8:"embassy_lvl1_gen_26",9:"store_house_lvl1_26",10:"market_lvl1_26",11:"alchemy_lvl1_26",12:"rally_point_lvl1_gen_26",13:"barracks_lvl1_gen_26",14:"watch_tower_lvl1_gen_26",15:"blacksmith_lvl1_26",16:"workshop_lvl1_26",17:"stable_lvl1_26",18:"rest_stop_lvl1_26",20:"fey_spire_lvl1",21:"apothecary_lvl1"};
        	var cityurl = "building_icons/";
        } else {
        	if (Seed.cityData.city[unsafeWindow.currentcityid].prestigeInfo.prestigeType==1){
				var cityurl = "DruidBuildingIcons/"
        		var BuildingArray={5:"build_cottage",7:"build_knightshall",8:"build_embassy",10:"build_market",11:"build_alchemy",12:"build_rally",13:"build_barracks",14:"build_watchtower",20:"build_spire",22:"build_apothecary",23:"build_barracks"};
        	} else {
				var cityurl ="";
				if (Seed.cityData.city[unsafeWindow.currentcityid].prestigeInfo.prestigeType==2) var BuildingArray={5:"build_fey_cottage",7:"build_fey_knightshall",8:"build_fey_embassy",10:"build_fey_market",11:"build_fey_alchemy",12:"build_fey_rallypoint",13:"build_fey_barracks",14:"build_fey_watchtower",20:"build_fey_spire",21:"build_fey_apothecary",24:"build_barracks",25:"build_altar"};
				if (Seed.cityData.city[unsafeWindow.currentcityid].prestigeInfo.prestigeType==3) var BuildingArray={5:"build_briton_cottage",7:"build_briton_knightshall",8:"build_briton_embassy",10:"build_briton_market",11:"build_briton_alchemy",12:"build_briton_rallypoint",13:"build_briton_barracks",14:"build_briton_watchtower",21:"build_briton_apothecary",26:"build_barracks",27:"build_workshop"};
        	}
        }     
        var element_class = document.getElementsByClassName('buttonv2 nav h20 sel');
        var where = element_class[0].id.substr(10);     
        var m= "<TABLE class=pbTab><TR>";
        for (var i=1;i<=Seed.cities.length;i++) if (Seed.cities[i-1][0] == unsafeWindow.currentcityid) var cityNumber = i;
        var painted=[];
        var counter=0;
        if (where=='city'){        	
        	if (buildingPos==1) {
        		m+='<TD style="vertical-align:bottom;align:center"><img style="vertical-align:bottom;margin: 0 auto;" src="'+baseurl+cityurl+'walls_lvl1_26.png?4568"><BR><INPUT style="width:90px" id="bid_19" type=submit class=pbButton value="'+unsafeWindow.buildingcost['bdg19'][0]+'"></td>';
        		painted.push(19);
        	} else {
	        	for (var i=5;i<=21;i++) {
	        		var check = t.checkBuilding(unsafeWindow.currentcityid,i);
	        		if (BuildingArray[i] && check) {
		        		if (i!=21) m+='<TD style="vertical-align:bottom;align:center"><img style="vertical-align:bottom;margin: 0 auto;" src="'+baseurl+cityurl+BuildingArray[i]+'.png?4568"><BR><INPUT style="width:90px" id="bid_'+i+'" type=submit class=pbButton value="'+unsafeWindow.buildingcost['bdg'+i][0]+'"></td>';
		        		 else {
		        		 	var normal = ((prestige==0)?"Apothecary/":"")
		        		 	m+='<TD style="vertical-align:bottom;align:center"><img style="vertical-align:bottom;margin: 0 auto;" src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/'+normal + BuildingArray[i]+'.png?4568"><BR><INPUT style="width:90px" id="bid_'+i+'" type=submit class=pbButton value="'+unsafeWindow.buildingcost['bdg'+i][0]+'"></td>';
		        		}
		        		painted.push(i);
		        		counter++;
		        		if (counter%7==0) m+='</tr><TR>';        	
	        		}
	        	}
	        }
        }
        if (where=='field'){
        	if (prestige==0) {
        		for (var i=1;i<=4;i++){
        			m+='<TD style="vertical-align:bottom;align:center"><img style="vertical-align:bottom;margin: 0 auto;" src="'+baseurl+cityurl+BuildingArray[i]+'.png?4568"><BR><INPUT style="width:90px" id="bid_'+i+'" type=submit class=pbButton value="'+unsafeWindow.buildingcost['bdg'+i][0]+'"></td>';
	        		painted.push(i);
	        	}
	    	} else {
	        	if (Seed.cityData.city[unsafeWindow.currentcityid].prestigeInfo.prestigeType==1){
	        		for (var i=22;i<=23;i++){
        				m+='<TD style="vertical-align:bottom;align:center"><img style="vertical-align:bottom;margin: 0 auto;" src="'+baseurl+cityurl+BuildingArray[i]+'.png?4568"><BR><INPUT style="width:90px" id="bid_'+i+'" type=submit class=pbButton value="'+unsafeWindow.buildingcost['bdg'+i][0]+'"></td>';
	        			painted.push(i);
	        		}
	        	} 
	        	if (Seed.cityData.city[unsafeWindow.currentcityid].prestigeInfo.prestigeType==2){
	        		for (var i=24;i<=25;i++){
        				m+='<TD style="vertical-align:bottom;align:center"><img style="vertical-align:bottom;margin: 0 auto;" src="'+baseurl+cityurl+BuildingArray[i]+'.png?4568"><BR><INPUT style="width:90px" id="bid_'+i+'" type=submit class=pbButton value="'+unsafeWindow.buildingcost['bdg'+i][0]+'"></td>';
	        			painted.push(i);
	        		}
	        	} 
	        	if (Seed.cityData.city[unsafeWindow.currentcityid].prestigeInfo.prestigeType==3){
	        		for (var i=26;i<=27;i++){
        				m+='<TD style="vertical-align:bottom;align:center"><img style="vertical-align:bottom;margin: 0 auto;" src="'+baseurl+cityurl+BuildingArray[i]+'.png?4568"><BR><INPUT style="width:90px" id="bid_'+i+'" type=submit class=pbButton value="'+unsafeWindow.buildingcost['bdg'+i][0]+'"></td>';
	        			painted.push(i);
	        		}
	        	} 
        	}     
        }
        m+='</tr></table><BR>';
		t.buildPop = new pbPopup ('Build_Popup', 5, 170, 740, 700, true);
		t.buildPop.getMainDiv().innerHTML = m;
		t.buildPop.getTopDiv().innerHTML = '<CENTER><B>Startup Build Queue</b></center>';
		t.buildPop.show (true);
		if (painted.length <=7) document.getElementById('Build_Popup_outer').style.height="185px";
        if (painted.length >7 && painted.length <=14) document.getElementById('Build_Popup_outer').style.height="328px";
        if (painted.length >14) document.getElementById('Build_Popup_outer').style.height="471px";
		t.popupCity = unsafeWindow.currentcityid;
		for (var y=0;y<painted.length;y++) document.getElementById('bid_'+painted[y]).addEventListener('click', function(){t.Lvl1ToQueue(buildingPos,this.id)}, false);
    },
    checkBuilding:function(cid,bid){
    	var notBuild=true;
    	if (bid==5 || bid==13) return true;
    	for (var y in Seed.buildings['city'+cid]) if (Seed.buildings['city'+cid][y][0]==bid) notBuild=false;
    	for (var i=0;i<Tabs.build["bQ_" + cid].length;i++) if (Tabs.build["bQ_" + cid][i].buildingId==bid) notBuild=false;
    	return notBuild;
    },
    Lvl1ToQueue:function(pos,id){
    	var t = Tabs.build;
 		var result = t.calculateQueueValues(unsafeWindow.currentcityid, 0, id.substr(4), "build");
		var buildingMult = result[0];
		var buildingTime = result[1];
		document.getElementById('slot_'+pos).className="inprocess";
		document.getElementById('slot_'+pos).onclick=null;
		t.addQueueItem(unsafeWindow.currentcityid, pos, id.substr(4), id.substr(4), buildingTime, 0, 0, buildingMult, "build");
		t.buildPop.show (false);
    },
}

function checkreq(currentcityid, L, A, n, E) {
    var z;
    if(E === 2) z = unsafeWindow.techcost2;
     else z = unsafeWindow.techcost;
    var F = n;
    if(L == "tch" && A != 17) F = Math.min(n, 11);
    var x = Math.pow(2, (F - 1));
    var l = new Array();
    for(var G = 0; G < 5; G++) l[G] = new Array();
    var u = new Array();
    if(L == "tch") var D = z["tch" + A][8];
     else {
        if(L == "bdg") var D = unsafeWindow.buildingcost["bdg" + A][8]
         else {
            if(L == "unt") var D = unsafeWindow.unitcost["unt" + A][8]
             else if(L == "frt") var D = unsafeWindow.fortcost["frt" + A][8] 
        }
    } if(L == "bdg" && parseInt(n) > 10 && (parseInt(A) === 19 || parseInt(A) === 12 || parseInt(A) === 16 || parseInt(A) === 15 || parseInt(A) === 17 || parseInt(A) === 11 || parseInt(A) === 18 || parseInt(A) === 8 || parseInt(A) === 9 || parseInt(A) === 1 || parseInt(A) === 2 || parseInt(A) === 3 || parseInt(A) === 4)) {
        var y = unsafeWindow.getBuildingLevel(0);
        l[0].push(unsafeWindow.g_js_strings.commonstr.construction);
        l[1].push(unsafeWindow.g_js_strings.commonstr.lv + n + " " + unsafeWindow.buildingcost.bdg0[0]);
        l[2].push(unsafeWindow.g_js_strings.commonstr.lv + y + " " + unsafeWindow.buildingcost.bdg0[0]);
        if(y >= parseInt(n)) l[3].push(1);
         else l[3].push(0);
    }
    if(D.length == null) {
        var e = Object.keys(D);
        var J = new Array();
        var v = Object.keys(Seed.buildings["city" + currentcityid]);
        for(var G = 0; G < v.length; G++) {
            var p = Seed.buildings["city" + currentcityid][v[G]];
            if(J["b" + p[0]] == null) J["b" + p[0]] = parseInt(p[1])
             else J["b" + p[0]] = (p[1] > J["b" + p[0]]) ? p[1] : J["b" + p[0]]
        }
        for(var G = 0; G < e.length; G++) {
            l[0].push(unsafeWindow.g_js_strings.commonstr.construction);
            var K = e[G].split("b")[1];
            var d = 0;
            var s = (parseInt(J[e[G]]) > 0) ? (parseInt(J[e[G]])) : 0;
            var g = unsafeWindow.buildingcost["bdg" + K][0];
            if(parseInt(D[e[G]][0]) == 1) {
                d = parseInt(D[e[G]][1])
            } else {
                d = Math.min(unsafeWindow.buildingmaxlvl[K], n + parseInt(D[e[G]][1]))
            } if(L == "tch") {
                var t = [9, 15, 16, 17],
                    H = [5, 9, 12, 14];
                if(H.indexOf(parseInt(A)) != -1 && t.indexOf(parseInt(K)) != -1 && parseInt(n) == 11) {
                    d--
                } else {
                    if(parseInt(K) == 11) d = Math.max(d, n);
                }
            }
            l[1].push(unsafeWindow.g_js_strings.commonstr.lv + d + " " + g);
            l[2].push(unsafeWindow.g_js_strings.commonstr.lv + s + " " + g);
            if(s < d) l[3].push(0);
             else l[3].push(1);  
            l[4].push(null)
        }
    }
    var I = new Array();
    if(L == "tch") var a = z["tch" + A][9]
     else {
        if(L == "bdg") {
            var a = unsafeWindow.buildingcost["bdg" + A][9]
        } else {
            if(L == "unt") var a = unsafeWindow.unitcost["unt" + A][9]
             else if(L == "frt") var a = unsafeWindow.fortcost["frt" + A][9]
        }
    }
    var j = Object.keys(a);
    if(a.length == null) {
        for(var G = 0; G < j.length; G++) {
            l[0].push(unsafeWindow.g_js_strings.commonstr.research);
            var o = j[G].split("t")[1];
            var c = 0;
            var r = parseInt(Seed.tech["tch" + o]);
            var B = z["tch" + o][0];
            if(parseInt(a[j[G]][0]) == 1) {
                c = parseInt(a[j[G]][1])
            } else {
                c = n + parseInt(a[j[G]][1])
            } if(L == "bdg" && unsafeWindow.getBuildingLevel(A) === 10 && parseInt(A, 10) !== 18) {
                c = 10
            }
            l[1].push(unsafeWindow.g_js_strings.commonstr.lv + c + " " + B);
            l[2].push(unsafeWindow.g_js_strings.commonstr.lv + r + " " + B);
            if(r < c) l[3].push(0)
             else l[3].push(1)
            l[4].push(null)
        }
    }
    if(L == "tch") {
        var w = parseInt(z["tch" + A][5]) * x
    } else {
        if(L == "bdg") {
            var w = parseInt(unsafeWindow.buildingcost["bdg" + A][5]) * x;
        } else {
            if(L == "unt") var w = parseInt(unsafeWindow.unitcost["unt" + A][5]) * x;
             else if(L == "frt") var w = parseInt(unsafeWindow.fortcost["frt" + A][5]) * x;
        }
    } if(w > 0) {
        l[0].push(unsafeWindow.resourceinfo.rec0);
        var k = parseInt(Seed.citystats["city" + currentcityid].gold[0]);
        l[1].push(w);
        l[2].push(k);
        if(k < w) l[3].push(0)
         else l[3].push(1)   
        l[4].push(null)
    }
    for(var G = 1; G < 5; G++) {
        if(L == "tch") {
            var m = parseInt(z["tch" + A][G]) * x * 3600
        } else {
            if(L == "bdg") {
                var m = parseInt(unsafeWindow.buildingcost["bdg" + A][G]) * x * 3600
            } else {
                if(L == "unt") {
                    var h = unsafeWindow.cm.BlessingSystemModel.applyBlessing(unsafeWindow.cm.BlessingSystemModel.getBlessing().MORE_WITH_LESS, currentcityid, {unitid: A});
                    var m = Math.ceil(parseInt(unsafeWindow.unitcost["unt" + A][G]) * h) * x * 3600
                } else {
                    if(L == "frt") var m = parseInt(unsafeWindow.fortcost["frt" + A][G]) * x * 3600
                }
            }
        } if(m > 0) {
            l[0].push(unsafeWindow.resourceinfo["rec" + G]);
            var f = parseInt(Seed.resources["city" + currentcityid]["rec" + G][0]);
            l[1].push(parseInt(parseInt(m) / 3600));
            l[2].push(parseInt(parseInt(f) / 3600));
            if(f < m) l[3].push(0)
             else l[3].push(1)
            switch(G) {
                case 1:
                    l[4].push("Food");
                    break;
                case 2:
                    l[4].push("Wood");
                    break;
                case 3:
                    l[4].push("Stone");
                    break;
                case 4:
                    l[4].push("Ore");
                    break
            }
        }
    }
    if(L == "tch") {
        var b = parseInt(z["tch" + A][6]) * x
    } else {
        if(L == "bdg") {
            var b = parseInt(unsafeWindow.buildingcost["bdg" + A][6]) * x
        } else {
            if(L == "unt") {
                var q = unsafeWindow.cm.BlessingSystemModel.applyBlessing(unsafeWindow.cm.BlessingSystemModel.getBlessing().MORE_WITH_LESS, currentcityid, {
                    unitid: A
                });
                var b = Math.ceil(parseInt(unsafeWindow.unitcost["unt" + A][6]) * q) * x
            } else {
                if(L == "frt") {
                    var b = parseInt(unsafeWindow.fortcost["frt" + A][6]) * x
                }
            }
        }
    } if(b > 0) {
        l[0].push(unsafeWindow.g_js_strings.commonstr.population);
        var C = parseInt(Seed.citystats["city" + currentcityid].pop[0]) - parseInt(Seed.citystats["city" + currentcityid].pop[3]);
        l[1].push(b);
        l[2].push(C);
        if(C < b) l[3].push(0)
         else l[3].push(1)
        l[4].push("Population")
    }
    return l
}

function PaintStartUpQueue(cityId){
	for (var y=1;y<=32;y++) if (document.getElementById('slot_'+y)) document.getElementById('slot_'+y).onclick= function(){unsafeWindow.buildslot(this,unsafeWindow.event);return false;}; 
	for (var y=100;y<=139;y++) if (document.getElementById('slot_'+y)) document.getElementById('slot_'+y).onclick= function(){unsafeWindow.buildslot(this,unsafeWindow.event);return false;}; 
    for (var i=0;i<Tabs.build["bQ_" + cityId].length;i++){
    	if (Tabs.build["bQ_" + cityId][i].buildingLevel==0) {
    		document.getElementById('slot_'+Tabs.build["bQ_" + cityId][i].buildingPos).className="inprocess";
			document.getElementById('slot_'+Tabs.build["bQ_" + cityId][i].buildingPos).onclick=null;
    	} 
    }
}

function ClearStartUpQueue(cityId,item){
    	document.getElementById('slot_'+item.buildingPos).className="blank";
		document.getElementById('slot_'+item.buildingPos).onclick= function(){unsafeWindow.buildslot(this,unsafeWindow.event);return false;};    
}

/****************************  Transport Implementation  *******************************/
Tabs.transport = {
    tabOrder: 101,
    tabLabel: 'Transport',
    myDiv: null,
    timer: null,
    traderState: [],
    lTR: [],
    tradeRoutes: [],
    checkdotradetimeout: null,
    count: 0,
    check: false,
    rallypointlevel:0,
    init: function (div) {
        var t = Tabs.transport;
        t.myDiv = div;
        t.traderState = {running: false,};
        t.readTraderState();
        t.readTradeRoutes();
        var m = '<DIV id=pbTowrtDivF class=pbStat>' + translate("AUTOMATED TRANSPORT FUNCTION") + '</div><TABLE id=pbtraderfunctions width=100% height=0% class=pbTab><TR align="center">';
        m +='<TD><INPUT class="buttonDash_'+ (t.traderState.Running?'ON':'OFF') +'" id=pbTraderState type=submit value="'+translate("Transport")+' = '+ (t.traderState.Running?'ON':'OFF')+'"></td>';
        m += '<TD><INPUT id=pbShowRoutes type=submit class=pbButton value="' + translate("Show Routes") + '"></td>';
        m += '</tr></table></div>';
        m += '<DIV id=pbTraderDivDRoute class=pbStat>' + translate("TRADE ROUTE OPTIONS") + '</div>';
        m += '<TABLE id=pbtraderfunctions width=100% height=0% class=pbTab><TR align="center"><TR align="left">';
        m += '<TD colspan=4>' + translate("Check transport every:") + ' <INPUT id=pbtransportinterval type=text size=2 value="' + Options.transportinterval + '"\> ' + translate("minutes") + '</td></tr></table>';
        m += '<TD colspan=4>' + translate("Do not send transport out if less than") + ' <INPUT id=pbminwagons type=text size=2 value="' + Options.minwagons + '"\> ' + translate("troops are needed. (Needless transports are skipped this way)") + '</td></tr></table>';
        m += '<DIV style="margin-top:10px;margin-bottom:5px;">' + translate("If the \"trade\" amount is 0 then it will transport the max amount above \"keep\". Gold only if there is space left...") + '</div></table>';
        m += '<DIV id=pbTraderDivDRoute class=pbStat>' + translate("TRANSPORTS") + '</div>';
        m += '<TABLE id=pbaddtraderoute width=95% height=0% class=pbTab><TR align="left">';
        m += '<TR align="left"><TD>' + translate("From City:") + '</td> <TD width=310px><DIV style="margin-bottom:10px;"><span id=ptrescity></span></div></td></tr>';
        m += '<TR align="left">';
        m += '<TD>' + translate("To City:") + '</td> <TD width=310px><DIV style="margin-bottom:10px;"><span id=ptcityTo></span></div></td>';
        m += '<TD>' + translate("OR") + '</td>';
        m += '<TD>X:<INPUT id=ptcityX type=text size=3\></td>';
        m += '<TD>Y:<INPUT id=ptcityY type=text size=3\></td></tr>';
        m += '<TABLE id=pbaddtraderoute height=0% class=pbTab><TR align="left">';
        m += '<TD width=75px>TroopType:</td><TD width=150px><SELECT id="TransportTroop">';
        for (y in unsafeWindow.unitcost) m += '<option value="' + y + '">' + unsafeWindow.unitcost[y][0] + '</option>';
        m += '</select></td><TD width=75px>' + translate("Troops Available:") + '&nbsp;</td><TD id=TroopAmount align=left width=75px></td>';
        m += '<TD width=75px>' + translate("Global Carry Amount:") + '&nbsp;</td><TD id=CarryAmount align=left width=75px></td>';
        m += '<TR><TD >' + translate("Troops:") + ' </td><TD><INPUT id=TroopsToSend type=text size=6 maxlength=6 value="0">&nbsp;&nbsp;<INPUT id=MaxTroops type=submit class=pbButton value="Max"></td>';
        m += '<TD width=50px><INPUT id=FillInMax type=submit class=pbButton value="<----"></td>';
        m += '<TD id=Calc colspan=3></td></tr>';
        m += '<TABLE id=pbaddtraderoute height=0% class=pbTab><TR align="center">';
        m += '<TD width=5%><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/food_30.png"></td>';
        m += '<TD id=TransRec1 align=right width=110px></td>';
        m += '<TD id=HaveRec1 align=right width=110px></td>';
        m += '<TD width=55px align=right><INPUT id=pbshipFood type=checkbox unchecked=true\></td>';
        m += '<TD width=180px  align=left>' + translate("Keep:") + ' <INPUT id=pbtargetamountFood type=text size=11 maxlength=20 value="0" disabled=true\></td>';
        m += '<TD width=100px>' + translate("Trade:") + ' <INPUT id=pbtradeamountFood type=text size=11 maxlength=20 value="0"\></td>';
        m += '<TD width=50px><INPUT id=MaxFood type=submit class=pbButton value="Max"></td></tr>';
        m += '<TR align="center">';
        m += '<TD width=5%><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/wood_30.png"></td>';
        m += '<TD id=TransRec2 align=right width=110px></td>';
        m += '<TD id=HaveRec2 align=right width=110px></td>';
        m += '<TD width=55px align=right><INPUT id=pbshipWood type=checkbox unchecked=true\></td>';
        m += '<TD width=180px align=left>' + translate("Keep:") + ' <INPUT id=pbtargetamountWood type=text size=11 maxlength=20 value="0" disabled=true\></td>';
        m += '<TD width=100px>' + translate("Trade:") + ' <INPUT id=pbtradeamountWood type=text size=11 maxlength=20 value="0"\></td>';
        m += '<TD width=50px><INPUT id=MaxWood type=submit class=pbButton value="Max"></td></tr>';
        m += '<TR align="center">';
        m += '<TD width=5%><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/stone_30.png"></td>';
        m += '<TD id=TransRec3 align=right width=110px></td>';
        m += '<TD id=HaveRec3 align=right width=110px></td>';
        m += '<TD width=55px align=right><INPUT id=pbshipStone type=checkbox unchecked=true\></td>';
        m += '<TD width=180px align=left>' + translate("Keep:") + ' <INPUT id=pbtargetamountStone type=text size=11 maxlength=20 value="0" disabled=true\></td>';
        m += '<TD width=100px>' + translate("Trade:") + ' <INPUT id=pbtradeamountStone type=text size=11 maxlength=20 value="0"\></td>';
        m += '<TD width=50px><INPUT id=MaxStone type=submit class=pbButton value="Max"></td></tr>';
        m += '<TR align="center">';
        m += '<TD width=5%><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/iron_30.png"></td>';
        m += '<TD id=TransRec4 align=right width=110px></td>';
        m += '<TD id=HaveRec4 align=right width=110px></td>';
        m += '<TD width=55px align=right><INPUT id=pbshipOre type=checkbox unchecked=true\></td>';
        m += '<TD width=180px align=left>' + translate("Keep:") + ' <INPUT id=pbtargetamountOre type=text size=11 maxlength=20 value="0" disabled=true\></td>';
        m += '<TD width=100px>' + translate("Trade:") + ' <INPUT id=pbtradeamountOre type=text size=11 maxlength=20 value="0"\></td>';
        m += '<TD width=50px><INPUT id=MaxOre type=submit class=pbButton value="Max"></td></tr>';
        m += '<TR align="center">';
        m += '<TD width=5%><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/aetherstone_30.png"></td>';
        m += '<TD id=TransRec5 align=right width=110px></td>';
        m += '<TD id=HaveRec5 align=right width=110px></td>';
        m += '<TD width=55px align=right><INPUT id=pbshipAstone type=checkbox unchecked=true\></td>';
        m += '<TD width=180px align=left>' + translate("Keep:") + ' <INPUT id=pbtargetamountAstone type=text size=11 maxlength=20 value="0" disabled=true\></td>';
        m += '<TD width=100px>' + translate("Trade:") + ' <INPUT id=pbtradeamountAstone type=text size=11 maxlength=20 value="0"\></td>';
        m += '<TD width=50px><INPUT id=MaxAstone type=submit class=pbButton value="Max"></td></tr>';
        m += '<TR align="center">';
        m += '<TD width=5%><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/gold_30.png"></td>';
        m += '<TD id=TransGold align=right width=110px></td>';
        m += '<TD id=HaveGold align=right width=110px></td>';
        m += '<TD width=55px align=right><INPUT id=pbshipGold type=checkbox unchecked=true\></td>';
        m += '<TD width=180px align=left>' + translate("Keep:") + ' <INPUT id=pbtargetamountGold type=text size=11 maxlength=20 value="0" disabled=true\></td>';
        m += '<TD width=100px>' + translate("Trade:") + ' <INPUT id=pbtradeamountGold type=text size=11 maxlength=20 value="0"\></td>';
        m += '<TD width=50px><INPUT id=MaxGold type=submit class=pbButton value="Max"></td></tr>';
        m += '</table>';
        m += '<DIV style="text-align:center; margin-top:15px"><INPUT id=pbSaveRoute type=submit class=pbButton value="' + translate("Add Route") + '"><INPUT id=pbManualSend type=submit class=pbButton value="' + translate("Manual Transport") + '"><INPUT id=pbTransportToMarch type=submit class=pbButton value="' + translate("Add to march tab") + '"></div>';
        m += '<DIV id=errorSpace></div>';
        m +='<BR><DIV id=TransportInfo></div>';

        t.myDiv.innerHTML = m;
        document.getElementById('TransportTroop').value = 'unt9';
        t.tcp = new CdispCityPicker('pttrader', document.getElementById('ptrescity'), true, t.updateResources, 0);
        t.tcpto = new CdispCityPicker('pttraderTo', document.getElementById('ptcityTo'), true, t.clickCitySelect);
        t.tcpto.bindToXYboxes(document.getElementById('ptcityX'), document.getElementById('ptcityY'));
        document.getElementById('TransportTroop').addEventListener('change', function () {t.updateTroops();}, false);
        document.getElementById('pbTraderState').addEventListener('click', function () {t.toggleTraderState(this);}, false);
        document.getElementById('pbSaveRoute').addEventListener('click', function () {t.addTradeRoute();}, false);
        document.getElementById('pbManualSend').addEventListener('click', function () {t.ManualTransport();}, false);
        document.getElementById('pbTransportToMarch').addEventListener('click', function () {t.GetCoords();}, false);
        document.getElementById('pbShowRoutes').addEventListener('click', function () {t.showTradeRoutes();}, false);
        document.getElementById('FillInMax').addEventListener('click', function () {document.getElementById('TroopsToSend').value = t.TroopsNeeded;}, false);
        document.getElementById('MaxTroops').addEventListener('click', function () {
            var rallypointlevel = t.getRallypoint('city' + t.tcp.city.id);
            var max = rallypointlevel * 10000;
            var TR = unsafeWindow.cm.ThroneController.effectBonus(66);
    		if (TR > 150) TR=150;
			if (Seed.cityData.city[t.tcp.city.id].isPrestigeCity) {
	    		switch(parseInt(Seed.cityData.city[t.tcp.city.id].prestigeInfo.prestigeLevel)){
	    			case 1: max = Math.round(max * 1.50);break;
	    			case 2: max = Math.round(max * 1.60);break;
	    			case 3: max = Math.round(max * 1.65);break;
    			}
    		}
    		max+=Math.round(max * (TR / 100));
    		if (t.Troops < max) max = t.Troops;
            document.getElementById('TroopsToSend').value = max; 
        }, false);
       
        
        document.getElementById('MaxFood').addEventListener('click', function () {
            t.Food = 0;
 			var input = t.MaxClicked();
            document.getElementById('pbtradeamountFood').value = (parseInt(input) <= parseIntCommas(document.getElementById('TransRec1').innerHTML)) ? input : parseIntCommas(document.getElementById('TransRec1').innerHTML);
        }, false);
        document.getElementById('MaxWood').addEventListener('click', function () {
            t.Wood = 0;
            var input = t.MaxClicked();
            document.getElementById('pbtradeamountWood').value = (parseInt(input) <= parseIntCommas(document.getElementById('TransRec2').innerHTML)) ? input : parseIntCommas(document.getElementById('TransRec2').innerHTML);
        }, false);
        document.getElementById('MaxStone').addEventListener('click', function () {
            t.Stone = 0;
            var input = t.MaxClicked();
            document.getElementById('pbtradeamountStone').value = (parseInt(input) <= parseIntCommas(document.getElementById('TransRec3').innerHTML)) ? input : parseIntCommas(document.getElementById('TransRec3').innerHTML);
        }, false);
        document.getElementById('MaxOre').addEventListener('click', function () {
            t.Ore = 0;
            var input = t.MaxClicked();
            document.getElementById('pbtradeamountOre').value = (parseInt(input) <= parseIntCommas(document.getElementById('TransRec4').innerHTML)) ? input : parseIntCommas(document.getElementById('TransRec4').innerHTML);
        }, false);
        document.getElementById('MaxGold').addEventListener('click', function () {
            t.Gold = 0;
            var input = t.MaxClicked();
            document.getElementById('pbtradeamountGold').value = (parseInt(input) <= parseIntCommas(document.getElementById('TransGold').innerHTML)) ? input : parseIntCommas(document.getElementById('TransGold').innerHTML);
        }, false);
        document.getElementById('MaxAstone').addEventListener('click', function () {
            t.Astone = 0;
            var input = t.MaxClicked();
            document.getElementById('pbtradeamountAstone').value = (parseInt(input) <= parseIntCommas(document.getElementById('TransRec5').innerHTML)) ? input : parseIntCommas(document.getElementById('TransRec5').innerHTML);
        }, false);
        document.getElementById('pbtransportinterval').addEventListener('keyup', function () {
            if (isNaN(document.getElementById('pbtransportinterval').value)) document.getElementById('pbtransportinterval').value = 60;
            Options.transportinterval = document.getElementById('pbtransportinterval').value;
            saveOptions();
        }, false);
        document.getElementById('pbtargetamountFood').addEventListener('change', function () {if (isNaNCommas(document.getElementById('pbtargetamountFood').value)) document.getElementById('pbtargetamountFood').value = 0;}, false);
        document.getElementById('pbtargetamountWood').addEventListener('change', function () {if (isNaNCommas(document.getElementById('pbtargetamountWood').value)) document.getElementById('pbtargetamountWood').value = 0;}, false);
        document.getElementById('pbtargetamountStone').addEventListener('change', function () {if (isNaNCommas(document.getElementById('pbtargetamountStone').value)) document.getElementById('pbtargetamountStone').value = 0;}, false);
        document.getElementById('pbtargetamountOre').addEventListener('change', function () {if (isNaNCommas(document.getElementById('pbtargetamountOre').value)) document.getElementById('pbtargetamountOre').value = 0;}, false);
        document.getElementById('pbtargetamountAstone').addEventListener('change', function () {if (isNaNCommas(document.getElementById('pbtargetamountAstone').value)) document.getElementById('pbtargetamountAstone').value = 0;}, false);
        document.getElementById('pbtargetamountGold').addEventListener('change', function () {if (isNaNCommas(document.getElementById('pbtargetamountGold').value)) document.getElementById('pbtargetamountGold').value = 0;}, false);
        document.getElementById('pbtradeamountFood').addEventListener('change', function () {if (isNaNCommas(document.getElementById('pbtradeamountFood').value)) document.getElementById('pbtradeamountFood').value = 0;}, false);
        document.getElementById('pbtradeamountWood').addEventListener('change', function () {if (isNaNCommas(document.getElementById('pbtradeamountWood').value)) document.getElementById('pbtradeamountWood').value = 0;}, false);
        document.getElementById('pbtradeamountStone').addEventListener('change', function () {if (isNaNCommas(document.getElementById('pbtradeamountStone').value)) document.getElementById('pbtradeamountStone').value = 0;}, false);
        document.getElementById('pbtradeamountOre').addEventListener('change', function () {if (isNaNCommas(document.getElementById('pbtradeamountOre').value)) document.getElementById('pbtradeamountOre').value = 0;}, false);
        document.getElementById('pbtradeamountAstone').addEventListener('change', function () {if (isNaNCommas(document.getElementById('pbtradeamountAstone').value)) document.getElementById('pbtradeamountAstone').value = 0;}, false);
        document.getElementById('pbtradeamountGold').addEventListener('change', function () {if (isNaNCommas(document.getElementById('pbtradeamountGold').value)) document.getElementById('pbtradeamountGold').value = 0;}, false);
        document.getElementById('pbminwagons').addEventListener('keyup', function () {
        	if (isNaN(document.getElementById('pbminwagons').value)) document.getElementById('pbminwagons').value = 100;
            Options.minwagons = parseInt(document.getElementById('pbminwagons').value);
            saveOptions();
        }, false)
        document.getElementById('pbshipFood').addEventListener('click', function () {
            if (document.getElementById('pbshipFood').checked == false) document.getElementById('pbtargetamountFood').disabled = true;
             else document.getElementById('pbtargetamountFood').disabled = false;
        }, false);
        document.getElementById('pbshipWood').addEventListener('click', function () {
            if (document.getElementById('pbshipWood').checked == false) document.getElementById('pbtargetamountWood').disabled = true;
            else document.getElementById('pbtargetamountWood').disabled = false;
        }, false);
        document.getElementById('pbshipStone').addEventListener('click', function () {
            if (document.getElementById('pbshipStone').checked == false) document.getElementById('pbtargetamountStone').disabled = true;
            else document.getElementById('pbtargetamountStone').disabled = false;
        }, false);
        document.getElementById('pbshipOre').addEventListener('click', function () {
            if (document.getElementById('pbshipOre').checked == false) document.getElementById('pbtargetamountOre').disabled = true;
             else document.getElementById('pbtargetamountOre').disabled = false;
        }, false);
        document.getElementById('pbshipAstone').addEventListener('click', function () {
            if (document.getElementById('pbshipAstone').checked == false) document.getElementById('pbtargetamountAstone').disabled = true;
             else document.getElementById('pbtargetamountAstone').disabled = false;
        }, false);
        document.getElementById('pbshipGold').addEventListener('click', function () {
            if (document.getElementById('pbshipGold').checked == false) document.getElementById('pbtargetamountGold').disabled = true;
             else document.getElementById('pbtargetamountGold').disabled = false;
        }, false);
        window.addEventListener('unload', t.onUnload, false);
    },

    MaxClicked: function(){
    	var t = Tabs.transport;
    	var unit_number = document.getElementById('TroopsToSend').value;
        var unitid = document.getElementById('TransportTroop').value;
        unitid = unitid.substr(3);	
        var MaxLoad = getMaxLoad(unitid,unit_number);
		var input = MaxLoad - (t.Food + t.Wood + t.Stone + t.Ore + t.Gold + t.Astone);
		return input;
    },

     GetCoords : function (){
	    var t= Tabs.transport;
	    var targetName = "";
	    var targetCityName = "";
	    var total=0;
	    var units = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
	    targetX = parseInt(document.getElementById ('ptcityX').value);
	    targetY = parseInt(document.getElementById ('ptcityY').value);
	    if (targetX =="" && targetY=="") {alert("Please enter coords...");return;}
	    var what = document.getElementById('TransportTroop').value;
	    what = what.substr(3);
	    if (parseInt(document.getElementById('TroopsToSend')) == 0) {alert("You got to send a least one troop...");return;}
	    units[what] = parseInt(document.getElementById('TroopsToSend').value);	

	    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    	params.blocks = "bl_" + targetX + "_bt_" + targetY;
	    new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/fetchMapTiles.php" + unsafeWindow.g_ajaxsuffix, {
      		method: "post",
      		parameters: params,
      		onSuccess: function (transport) {
      			var rslt = eval("(" + transport.responseText + ")");
        		if (rslt.ok) {
        			if (rslt.data["l_"+targetX+"_t_"+targetY].tileType == 51) {
        				userId = rslt.data["l_"+targetX+"_t_"+targetY].tileUserId;
        				if (userId != null) targetName = rslt.userInfo["u" + userId]["n"];
        				targetCityName = rslt.data["l_"+targetX+"_t_"+targetY].cityName;
        			}
        			MarchOptions.Queue.push ({
        				city: 			t.tcp.city.id,
        				action: 		1,
        				targetX: 		targetX,
        				targetY: 		targetY,
        				tileType: 		rslt.data["l_"+targetX+"_t_"+targetY].tileType,
        				tileLevel: 		rslt.data["l_"+targetX+"_t_"+targetY].tileLevel,
        				targetCityName: targetCityName,
        				targetName: 	targetName,
        				cityNumber: 	rslt.data["l_"+targetX+"_t_"+targetY].cityNum,
        				1: 				units[1],
        				2: 				units[2],
        				3: 				units[3],
        				4: 				units[4],
        				5: 				units[5],
        				6: 				units[6],
        				7: 				units[7],
        				8: 				units[8],
        				9: 				units[9],
        				10: 			units[10],
        				11: 			units[11],
        				12: 			units[12],
        				13: 			units[13],
        				14: 			units[14],
        				15: 			units[15],
        				r1: 			parseInt(document.getElementById ('pbtradeamountFood').value),
        				r2: 			parseInt(document.getElementById ('pbtradeamountWood').value),
        				r3: 			parseInt(document.getElementById ('pbtradeamountStone').value),
        				r4: 			parseInt(document.getElementById ('pbtradeamountOre').value),
        				r5: 			parseInt(document.getElementById ('pbtradeamountAstone').value),
        				gold: 			parseInt(document.getElementById ('pbtradeamountGold').value)
        			});
					saveMarchOptions();
					document.getElementById('TroopsToSend').value = 0;
					document.getElementById ('pbtradeamountFood').value == 0;
				    document.getElementById ('pbtradeamountWood').value == 0;
				    document.getElementById ('pbtradeamountStone').value == 0;
				    document.getElementById ('pbtradeamountOre').value == 0;
				    document.getElementById ('pbtradeamountAstone').value == 0;
				    document.getElementById ('pbtradeamountGold').value == 0;
					Dashboard.ShowMarches();
        		}
      		},
    	});
		
	},

  
    updateResources: function () {
        var t = Tabs.transport;
        var ToCity = null;
        for (var i = 1; i <= 5; i++)
        if (i == 5) document.getElementById('TransRec' + i).innerHTML = addCommas(parseInt(Seed.resources["city" + t.tcp.city.id]['rec' + i][0]));
        else document.getElementById('TransRec' + i).innerHTML = addCommas(parseInt(Seed.resources["city" + t.tcp.city.id]['rec' + i][0] / 3600));
        document.getElementById('TransGold').innerHTML = addCommas(parseInt(Seed.citystats["city" + t.tcp.city.id]['gold'][0]));
        for (ii in Seed.cities) if (Seed.cities[ii][2] == document.getElementById('ptcityX').value && Seed.cities[ii][3] == document.getElementById('ptcityY').value) ToCity = Seed.cities[ii][0];
        for (var i = 1; i <= 5; i++) if (ToCity != null) if (i == 5) document.getElementById('HaveRec' + i).innerHTML = addCommas(parseInt(Seed.resources["city" + ToCity]['rec' + i][0]));
        else document.getElementById('HaveRec' + i).innerHTML = addCommas(parseInt(Seed.resources["city" + ToCity]['rec' + i][0] / 3600));
        else document.getElementById('HaveRec' + i).innerHTML = "----";
        if (ToCity != null) document.getElementById('HaveGold').innerHTML = addCommas(parseInt(Seed.citystats["city" + ToCity]['gold'][0]));
        else document.getElementById('HaveGold').innerHTML = "----";
    },
    updateTroops: function (city) {
        var t = Tabs.transport;
        var fontcolor = 'black';
        t.Food = parseIntCommas(document.getElementById('pbtradeamountFood').value);
        t.Wood = parseIntCommas(document.getElementById('pbtradeamountWood').value);
        t.Stone = parseIntCommas(document.getElementById('pbtradeamountStone').value);
        t.Ore = parseIntCommas(document.getElementById('pbtradeamountOre').value);
        t.Gold = parseIntCommas(document.getElementById('pbtradeamountGold').value);
        t.Astone = parseIntCommas(document.getElementById('pbtradeamountAstone').value)*5;
        var unit = document.getElementById('TransportTroop').value;
        t.Troops = parseInt(Seed.units['city' + t.tcp.city.id][unit]);
        var unit_number = parseInt(document.getElementById('TroopsToSend').value);
        var unitid = document.getElementById('TransportTroop').value;
        unitid = unitid.substr(3);
        var LoadUnit = getMaxLoad(unitid,1);
        var GlobalMaxLoad = t.Troops * LoadUnit;
        t.MaxLoad = getMaxLoad(unitid,unit_number);
        t.TroopsNeeded = (t.Food + t.Wood + t.Stone + t.Ore + t.Gold + t.Astone) / LoadUnit;
        t.TroopsNeeded = t.TroopsNeeded.toFixed(0);
        if (t.TroopsNeeded < ((t.Food + t.Wood + t.Stone + t.Ore + t.Gold + t.Astone) / LoadUnit)) t.TroopsNeeded++;
        if (t.TroopsNeeded > t.Troops) fontcolor = 'red';
        if (t.Troops > 0) document.getElementById('TroopAmount').innerHTML = '<FONT color=' + fontcolor + '>' + addCommas(t.Troops) + '</font>';
        else document.getElementById('TroopAmount').innerHTML = 0;
        if (GlobalMaxLoad > 0) document.getElementById('CarryAmount').innerHTML = addCommas(GlobalMaxLoad);
        else document.getElementById('CarryAmount').innerHTML = 0;
        document.getElementById('Calc').innerHTML = '' + translate("Resources:") + ' ' + addCommas(t.Food + t.Wood + t.Stone + t.Ore + t.Gold + t.Astone) + ' / ' + addCommas(t.MaxLoad) + '&nbsp;&nbsp;(' + translate("Troops Needed:") + ' <FONT color=' + fontcolor + '>' + addCommas(t.TroopsNeeded) + '</font> )';
    },
    getRallypoint: function(cityId){
      var t = Tabs.transport;
      for (var o in Seed.buildings[cityId]){
        var buildingType = parseInt(Seed.buildings[cityId][o][0]);
        var buildingLevel = parseInt(Seed.buildings[cityId][o][1]);
        if (buildingType == 12) var rallypointlevel=parseInt(buildingLevel);
       }
     	if(rallypointlevel == 11) rallypointlevel = 15;
     	if(rallypointlevel == 12) rallypointlevel = 20;
     	return rallypointlevel;      
 	},

    delTradeRoutes: function () {Tabs.transport.tradeRoutes = [];},

    checkcoords: function (obj) {
        var t = Tabs.transport;
        if (obj.id == 'pbok') {
            t.check = true;
            t.addTradeRoute();
        }
        return;
    },
    addTradeRoute: function () {
        var valid = true;
        var t = Tabs.transport;
        var city = t.tcp.city.id;
        if (document.getElementById('ptcityX').value == 0 && document.getElementById('ptcityY').value == 0 && !t.check) {
            new CdialogConfirm('<SPAN class=boldRed>' + translate("You are about to set a route to location 0,0!") + '</span>', t.checkcoords, unsafeWindow.modal_attack_check, mainPop.getMainDiv);
            return;
        }
        var ship_Food = document.getElementById('pbshipFood').checked;
        var ship_Wood = document.getElementById('pbshipWood').checked;
        var ship_Stone = document.getElementById('pbshipStone').checked;
        var ship_Ore = document.getElementById('pbshipOre').checked;
        var ship_Astone = document.getElementById('pbshipAstone').checked;
        var ship_Gold = document.getElementById('pbshipGold').checked;
        var target_Food = parseIntCommas(document.getElementById('pbtargetamountFood').value);
        var target_Wood = parseIntCommas(document.getElementById('pbtargetamountWood').value);
        var target_Stone = parseIntCommas(document.getElementById('pbtargetamountStone').value);
        var target_Ore = parseIntCommas(document.getElementById('pbtargetamountOre').value);
        var target_Astone = parseIntCommas(document.getElementById('pbtargetamountAstone').value);
        var target_Gold = parseIntCommas(document.getElementById('pbtargetamountGold').value);
        var trade_Food = parseIntCommas(document.getElementById('pbtradeamountFood').value);
        var trade_Wood = parseIntCommas(document.getElementById('pbtradeamountWood').value);
        var trade_Stone = parseIntCommas(document.getElementById('pbtradeamountStone').value);
        var trade_Ore = parseIntCommas(document.getElementById('pbtradeamountOre').value);
        var trade_Astone = parseIntCommas(document.getElementById('pbtradeamountAstone').value);
        var trade_Gold = parseIntCommas(document.getElementById('pbtradeamountGold').value);
        var target_x = document.getElementById('ptcityX').value;
        var target_y = document.getElementById('ptcityY').value;
        var target_city = 0;
        var TroopType = document.getElementById('TransportTroop').value;
        var route_state = true;
        if (t.tcpto.city) if (t.tcpto.city.x == target_x && t.tcpto.city.y == target_y) target_city = t.tcpto.city.id;
        if (valid == true) {
            var lTR = t.tradeRoutes;
            lTR.push({
                city: city,
                ship_Food: ship_Food,
                target_Food: target_Food,
                trade_Food: trade_Food,
                ship_Wood: ship_Wood,
                target_Wood: target_Wood,
                trade_Wood: trade_Wood,
                ship_Stone: ship_Stone,
                target_Stone: target_Stone,
                trade_Stone: trade_Stone,
                ship_Ore: ship_Ore,
                target_Ore: target_Ore,
                trade_Ore: trade_Ore,
                ship_Astone: ship_Astone,
                target_Astone: target_Astone,
                trade_Astone: trade_Astone,
                ship_Gold: ship_Gold,
                target_Gold: target_Gold,
                trade_Gold: trade_Gold,
                target_x: target_x,
                target_y: target_y,
                target_city: target_city,
                TroopType: TroopType,
                route_state: "true"
            });
        }
        document.getElementById('pbTraderDivDRoute').style.background = '#99FF99';
        setTimeout(function () {(document.getElementById('pbTraderDivDRoute').style.background = '');}, 1000);
    },
    showTradeRoutes: function () {
        var t = Tabs.transport;
        var popTradeRoutes = null;
        t.popTradeRoutes = new pbPopup('pbShowTrade', 0, 0, 750, 485, true, function () {clearTimeout(1000);});
        var m = '<DIV style="max-height:460px; height:460px; overflow-y:auto"><TABLE align=center cellpadding=0 cellspacing=0 width=100% class="pbTab" id="pbRoutesQueue">';
        t.popTradeRoutes.getMainDiv().innerHTML = '</table></div>' + m;
        t.popTradeRoutes.getTopDiv().innerHTML = '<TD><CENTER><B>' + translate("Transport routes") + '</b></center></td>';
        t.paintTradeRoutes();
        t.popTradeRoutes.show(true);
    },
    paintTradeRoutes: function () {
        var t = Tabs.transport;
        var r = t.tradeRoutes;
        var cityname;
        var m = '<TABLE id=paintRoutes class=pbTab>';
        for (var i = 0; i < (r.length); i++) {
            var queueId = i;
            var cityname = (Cities.byID[r[queueId].city] ? Cities.byID[r[queueId].city].name : "null");
            var citynameTo = null, TO, status, unit;
            if (typeof r[queueId].target_city != 'undefined' && parseInt(r[queueId].target_city) > 0) citynameTo = Cities.byID[r[queueId].target_city].name;
            if (citynameTo == null) TO = r[i].target_x + ',' + r[i].target_y;
            else TO = citynameTo;
            if (r[i].route_state) status = '<FONT color=green>' + translate("Enabled") + '</font>';
            else status = '<FONT color=red>' + translate("Disabled") + '</font>';
            if (r[i].TroopType == undefined) unit = 'unt9';
            else unit = r[i].TroopType;
            m += '<TR><TD TD width=12px>&nbsp;&nbsp;</td></tr>';
            m += '<TR><TD width=20px>' + (i + 1) + '</td><TD width=175px>' + translate("From:") + '&nbsp;&nbsp;' + cityname + '</TD><TD width=175px>' + translate("To:") + '&nbsp;&nbsp;' + TO + '</td><TD width=175px>' + status + '</td>';
            m += '<TD width=60px><A onclick="traceEdit(' + queueId + ')">' + translate("Edit") + '</a></td><TD width=60px><A onclick="traceDelete(' + queueId + ')">Delete</a></td></tr>';
            m += '<TR><TD></td><TD>Troops:&nbsp;&nbsp;' + unsafeWindow.unitcost[unit][0] + '</td></tr>';
            if (r[i].ship_Food) m += '<TR><TD></td><TD align=center><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/food_30.png"></td><TD>' + translate("Target:") + ' ' + addCommas(r[i].target_Food) + '</td><TD>' + translate("Trade:") + ' ' + addCommas(r[i].trade_Food) + '</td>';
            if (r[i].ship_Wood) m += '<TR><TD></td><TD align=center><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/wood_30.png"></td><TD>' + translate("Target:") + ' ' + addCommas(r[i].target_Wood) + '</td><TD>' + translate("Trade:") + ' ' + addCommas(r[i].trade_Wood) + '</td>';
            if (r[i].ship_Stone) m += '<TR><TD></td><TD align=center><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/stone_30.png"></td><TD>' + translate("Target:") + ' ' + addCommas(r[i].target_Stone) + '</td><TD>' + translate("Trade:") + ' ' + addCommas(r[i].trade_Stone) + '</td>';
            if (r[i].ship_Ore) m += '<TR><TD></td><TD align=center><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/iron_30.png"></td><TD>' + translate("Target:") + ' ' + addCommas(r[i].target_Ore) + '</td><TD>' + translate("Trade:") + ' ' + addCommas(r[i].trade_Ore) + '</td>';
            if (r[i].ship_Astone) m += '<TR><TD></td><TD align=center><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/aetherstone_30.png"></td><TD>' + translate("Target:") + ' ' + addCommas(r[i].target_Astone) + '</td><TD>' + translate("Trade:") + ' ' + addCommas(r[i].trade_Astone) + '</td>';
            if (r[i].ship_Gold) m += '<TR><TD></td><TD align=center><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/gold_30.png"></td><TD>' + translate("Target:") + ' ' + addCommas(r[i].target_Gold) + '</td><TD>' + translate("Trade:") + ' ' + addCommas(r[i].trade_Gold) + '</td>';
        }
        m += '</table>';
        document.getElementById('pbRoutesQueue').innerHTML = m;
        unsafeWindow.traceEdit = t.editQueueElement;
        unsafeWindow.traceDelete = t.cancelQueueElement;
    },
    cancelQueueElement: function (queueId) {
        var t = Tabs.transport;
        var queueId = parseInt(queueId);
        t.tradeRoutes.splice(queueId, 1);
        t.showTradeRoutes();
    },
    editQueueElement: function (queueId) {
        var t = Tabs.transport;
        var r = t.tradeRoutes;
        var queueId = parseInt(queueId);
        var cityname = Cities.byID[r[queueId].city].name;
        var citynameTo, TO;
        if (typeof r[queueId].target_city != 'undefined' || parseInt(r[queueId].target_city) > 0) if (Cities.byID[r[queueId].target_city]) citynameTo = Cities.byID[r[queueId].target_city].name;
        var Types = ['food', 'wood', 'stone', 'iron', 'aetherstone', 'gold'];
        if (citynameTo == null) TO = r[queueId].target_x + ',' + r[queueId].target_y;
        else TO = citynameTo;
        var n = '<TABLE id=editRoutes class=pbTab>';
        n += '<TD>' + translate("From:") + '&nbsp;' + cityname + '</td><TD>' + translate("To:") + '&nbsp;' + TO + '</td>';
        n += '<TD><INPUT id=TradeStatus type=checkbox>&nbsp;Enable Route</td>';
        n += '<TD width=150px>' + translate("Troop Type:") + '<SELECT id="pbbTransportTroop">';
        for (y in unsafeWindow.unitcost) n += '<option value="' + y + '">' + unsafeWindow.unitcost[y][0] + '</option>';
        n += '</select></td></table><BR><TABLE  id=editRoutes class=pbTab>';
        for (var i = 0; i < Types.length; i++) {
            var icon = Types[i];
            n += '<TR><TD width=50px align=center><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/' + icon + '_30.png"></td>';
            n += '<TD width=50px align=center><INPUT id=pbbship' + icon + ' type=checkbox></td>';
            n += '<TD width=125px>' + translate("Keep:") + ' <INPUT id=pbbtargetamount' + icon + ' type=text size=11 maxlength=11 value="0"></td>';
            n += '<TD width=125px>' + translate("Trade:") + ' <INPUT id=pbbtradeamount' + icon + ' type=text size=11 maxlength=11 value="0"\></td></tr>';
        }
        n += '</table><BR><TABLE id=editRoutes class=pbTab><TR><TD><a class="button20" id="Cancel"><span>' + translate("Cancel") + '</span></a></td>';
        n += '<TD><a class="button20" id="Save"><span>' + translate("Save") + '</span></a></td></tr>';
        n += '</table>';
        document.getElementById('pbRoutesQueue')
            .innerHTML = n;
        document.getElementById('TradeStatus')
            .checked = r[queueId].route_state;
        if (r[queueId].TroopType == undefined) var unit = 'unt9';
        else var unit = r[queueId].TroopType;
        document.getElementById('pbbTransportTroop').value = unit;
        document.getElementById('pbbshipfood').checked = r[queueId].ship_Food;
        document.getElementById('pbbshipwood').checked = r[queueId].ship_Wood;
        document.getElementById('pbbshipstone').checked = r[queueId].ship_Stone;
        document.getElementById('pbbshipiron').checked = r[queueId].ship_Ore;
        document.getElementById('pbbshipaetherstone').checked = r[queueId].ship_Astone;
        document.getElementById('pbbshipgold').checked = r[queueId].ship_Gold;
        document.getElementById('pbbtargetamountfood').value = r[queueId].target_Food;
        document.getElementById('pbbtargetamountwood').value = r[queueId].target_Wood;
        document.getElementById('pbbtargetamountstone').value = r[queueId].target_Stone;
        document.getElementById('pbbtargetamountiron').value = r[queueId].target_Ore;
        document.getElementById('pbbtargetamountaetherstone').value = r[queueId].target_Astone;
        document.getElementById('pbbtargetamountgold').value = r[queueId].target_Gold;
        document.getElementById('pbbtradeamountfood').value = r[queueId].trade_Food;
        document.getElementById('pbbtradeamountwood').value = r[queueId].trade_Wood;
        document.getElementById('pbbtradeamountstone').value = r[queueId].trade_Stone;
        document.getElementById('pbbtradeamountiron').value = r[queueId].trade_Ore;
        document.getElementById('pbbtradeamountaetherstone').value = r[queueId].trade_Astone;
        document.getElementById('pbbtradeamountgold').value = r[queueId].trade_Gold;
        document.getElementById('Cancel').addEventListener('click', function () {t.showTradeRoutes();}, false);
        document.getElementById('Save').addEventListener('click', function () {
            r[queueId].route_state = document.getElementById('TradeStatus')
                .checked;
            r[queueId].TroopType = document.getElementById('pbbTransportTroop')
                .value;
            r[queueId].ship_Food = (document.getElementById('pbbshipfood')
                .checked);
            r[queueId].ship_Wood = (document.getElementById('pbbshipwood')
                .checked);
            r[queueId].ship_Stone = (document.getElementById('pbbshipstone')
                .checked);
            r[queueId].ship_Ore = (document.getElementById('pbbshipiron')
                .checked);
            r[queueId].ship_Astone = (document.getElementById('pbbshipaetherstone')
                .checked);
            r[queueId].ship_Gold = (document.getElementById('pbbshipgold')
                .checked);
            r[queueId].target_Food = parseIntCommas(document.getElementById('pbbtargetamountfood')
                .value);
            r[queueId].target_Wood = parseIntCommas(document.getElementById('pbbtargetamountwood')
                .value);
            r[queueId].target_Stone = parseIntCommas(document.getElementById('pbbtargetamountstone')
                .value);
            r[queueId].target_Ore = parseIntCommas(document.getElementById('pbbtargetamountiron')
                .value);
            r[queueId].target_Astone = parseIntCommas(document.getElementById('pbbtargetamountaetherstone')
                .value);
            r[queueId].target_Gold = parseIntCommas(document.getElementById('pbbtargetamountgold')
                .value);
            r[queueId].trade_Food = parseIntCommas(document.getElementById('pbbtradeamountfood')
                .value);
            r[queueId].trade_Wood = parseIntCommas(document.getElementById('pbbtradeamountwood')
                .value);
            r[queueId].trade_Stone = parseIntCommas(document.getElementById('pbbtradeamountstone')
                .value);
            r[queueId].trade_Ore = parseIntCommas(document.getElementById('pbbtradeamountiron')
                .value);
            r[queueId].trade_Astone = parseIntCommas(document.getElementById('pbbtradeamountaetherstone')
                .value);
            r[queueId].trade_Gold = parseIntCommas(document.getElementById('pbbtradeamountgold')
                .value);
            t.showTradeRoutes();
        }, false);
    },
    saveTradeRoutes: function () {
        var t = Tabs.transport;
        var serverID = getServerId();
        GM_setValue('tradeRoutes_' + serverID, JSON2.stringify(t.tradeRoutes));
    },
    readTradeRoutes: function () {
        var t = Tabs.transport;
        var serverID = getServerId();
        s = GM_getValue('tradeRoutes_' + serverID);
        if (s != null) {
            route = JSON2.parse(s);
            for (k in route)
            t.tradeRoutes[k] = route[k];
        }
        try {
            t.checkcitymoved();
        } catch (e) {
            //Do nothing
        }
    },
    checkcitymoved: function () {
        var t = Tabs.transport;
        for (var i = 0; i < t.tradeRoutes.length; i++) {
            if (typeof t.tradeRoutes[i].target_city == 'undefined' || parseIntNan(t.tradeRoutes[i].target_city) == 0 || Cities.byID[t.tradeRoutes[i].target_city] == 'undefined') continue;
            if (t.tradeRoutes[i].target_x != Cities.byID[t.tradeRoutes[i].target_city].x) t.tradeRoutes[i].target_x = Cities.byID[t.tradeRoutes[i].target_city].x;
            if (t.tradeRoutes[i].target_y != Cities.byID[t.tradeRoutes[i].target_city].y) t.tradeRoutes[i].target_y = Cities.byID[t.tradeRoutes[i].target_city].y;
        }
    },
    saveTraderState: function () {
        var t = Tabs.transport;
        var serverID = getServerId();
        GM_setValue('traderState_' + serverID, JSON2.stringify(t.traderState));
    },
    readTraderState: function () {
        var t = Tabs.transport;
        var serverID = getServerId();
        s = GM_getValue('traderState_' + serverID);
        if (s != null) {
            state = JSON2.parse(s);
            for (k in state)
            t.traderState[k] = state[k];
        }
    },
    toggleTraderState: function (obj) {
        var t = Tabs.transport;
        if (t.traderState.running == true) {
            t.traderState.running = false;
            if (document.getElementById('pbTraderState')) {document.getElementById('pbTraderState').value = "Transport = OFF";document.getElementById('pbTraderState').setAttribute("class", "buttonDash_OFF");}
            if (document.getElementById('TransportToggle')) {document.getElementById('TransportToggle').value = "Transport = OFF";document.getElementById('TransportToggle').setAttribute("class", "buttonDash_OFF");}
            ClearMarchQueue("Transport");
        } else {
            t.traderState.running = true;
            if (document.getElementById('pbTraderState')) {document.getElementById('pbTraderState').value = "Transport = ON";document.getElementById('pbTraderState').setAttribute("class", "buttonDash_ON");}
            if (document.getElementById('TransportToggle')) {document.getElementById('TransportToggle').value = "Transport = ON";document.getElementById('TransportToggle').setAttribute("class", "buttonDash_ON");}
        }
    },   
    doMarch: function(cityID,c){
        var t = Tabs.transport;
        for (var i=0;i<t.tradeRoutes.length;i++) if (parseInt(t.tradeRoutes[i]["city"]) == parseInt(cityID)) t.doTrades(i);
    },   
  	doTrades: function(count){
		var t = Tabs.transport;
	   	var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
	    params.gold =0;
	    params.r1 =0;
	    params.r2 =0;
	    params.r3 =0;
	    params.r4 =0 ;
	    params.r5 =0 ;
	    params.kid = 0;
	    
	    var carry_amount= 0;
	    var wagons_needed=0;
	    var citymax = 0;
	    var city = t.tradeRoutes[count]["city"];
	    var cityID = 'city' + city;
	    
	    var xcoord = t.tradeRoutes[count]["target_x"];
	    var ycoord = t.tradeRoutes[count]["target_y"];
	    var trade_Food = t.tradeRoutes[count]["trade_Food"];
	    var trade_Wood = t.tradeRoutes[count]["trade_Wood"];
	    var trade_Stone = t.tradeRoutes[count]["trade_Stone"];
	    var trade_Ore = t.tradeRoutes[count]["trade_Ore"];
	    var trade_Astone = t.tradeRoutes[count]["trade_Astone"];
	    var trade_Gold = t.tradeRoutes[count]["trade_Gold"];
	    var target_Food = t.tradeRoutes[count]["target_Food"];
	    var target_Wood = t.tradeRoutes[count]["target_Wood"];
	    var target_Stone = t.tradeRoutes[count]["target_Stone"];
	    var target_Ore = t.tradeRoutes[count]["target_Ore"];
	    var target_Astone = t.tradeRoutes[count]["target_Astone"];
	    var target_Gold = t.tradeRoutes[count]["target_Gold"];
	    var ship_Food = t.tradeRoutes[count]["ship_Food"];
	    var ship_Wood = t.tradeRoutes[count]["ship_Wood"];
	    var ship_Stone = t.tradeRoutes[count]["ship_Stone"];
	    var ship_Ore = t.tradeRoutes[count]["ship_Ore"];
	    var ship_Astone = t.tradeRoutes[count]["ship_Astone"];
	    var ship_Gold = t.tradeRoutes[count]["ship_Gold"];
	    var citymax_Food = parseIntNan(Seed.resources[cityID]['rec1'][0] / 3600);
	    var citymax_Wood = parseIntNan(Seed.resources[cityID]['rec2'][0] / 3600);
	    var citymax_Stone = parseIntNan(Seed.resources[cityID]['rec3'][0] / 3600);
	    var citymax_Ore = parseIntNan(Seed.resources[cityID]['rec4'][0] / 3600);
	    var citymax_Astone = parseIntNan(Seed.resources[cityID]['rec5'][0]);
	    var citymax_Gold = parseIntNan(Seed.citystats[cityID]['gold']);
	    var carry_Food = parseIntNan(citymax_Food - target_Food);
	    var carry_Wood = parseIntNan(citymax_Wood - target_Wood);
	    var carry_Stone = parseIntNan(citymax_Stone - target_Stone);
	    var carry_Ore = parseIntNan(citymax_Ore - target_Ore);
	    var carry_Astone = parseIntNan(citymax_Astone - target_Astone);
	    var carry_Gold = 0;
	    if (carry_Food < 0 || ship_Food == false) carry_Food = 0;
	    if (carry_Wood < 0 || ship_Wood == false) carry_Wood = 0;
	    if (carry_Stone < 0 || ship_Stone == false) carry_Stone = 0;
	    if (carry_Ore < 0 || ship_Ore == false) carry_Ore = 0;
	    if (carry_Astone < 0 || ship_Astone == false) carry_Astone = 0;
	    if (trade_Food > 0 && (carry_Food > trade_Food)) carry_Food = parseIntNan(trade_Food);
	    if (trade_Wood > 0 && (carry_Wood > trade_Wood)) carry_Wood = parseIntNan(trade_Wood);
	    if (trade_Stone > 0 && (carry_Stone > trade_Stone)) carry_Stone = parseIntNan(trade_Stone);
	    if (trade_Ore > 0 && (carry_Ore > trade_Ore)) carry_Ore = parseIntNan(trade_Ore);
	    if (trade_Astone > 0 && (carry_Astone > trade_Astone)) carry_Astone = parseIntNan(trade_Astone);
	    carry_Astone *= 5; //Multiply by 5 to account for 5 times less carrying capacity
	  
	  	if (t.tradeRoutes[count]['TroopType'] == undefined) var wagons = parseInt(Seed.units[cityID]['unt'+ 9]);
	  	 else var wagons =  parseInt(Seed.units[cityID][t.tradeRoutes[count]['TroopType']]);
      
     	var rallypointlevel = t.getRallypoint(cityID);
     	var max = rallypointlevel * 10000;
        var TR = unsafeWindow.cm.ThroneController.effectBonus(66);
    	if (TR > 150) TR=150;
		if (Seed.cityData.city[t.tcp.city.id].isPrestigeCity) {
    		switch(parseInt(Seed.cityData.city[t.tcp.city.id].prestigeInfo.prestigeLevel)){
    			case 1: max = Math.floor(max * 1.50);break;
    			case 2: max = Math.floor(max * 1.60);break;
    			case 3: max = Math.floor(max * 1.65);break;
			}
		}
    	max+=Math.floor(max * (TR / 100));
           
        if (wagons > max) wagons = max;
      	if (t.tradeRoutes[count]['TroopType'] == undefined) var unit = 'unt9';
     	 else var unit = t.tradeRoutes[count]['TroopType'];
      	var Troops = parseInt(Seed.units[cityID][unit]);
      	if(parseInt(Troops)>parseInt(wagons)) Troops = wagons;
      	//var featherweight = parseInt(Seed.tech.tch10);
        //var Load = parseInt(unsafeWindow.unitstats[unit]['5'])
      	var maxloadperwagon = getMaxLoad(unit.substr(3),1); //(featherweight * ((Load/100)*10)) + Load;
      	var maxload = getMaxLoad(unit.substr(3),Troops);
        if(wagons <= 0) return;
        for (var t=0; t< Seed.cities.length;t++) if ( parseInt(Seed.cities[t][0]) == city) var cityname = Seed.cities[t][1];                        
        
		var shift_Food = parseIntNan(maxload / 9); //Total of 9 portions
		var shift_Wood = parseIntNan(maxload / 9);
		var shift_Stone = parseIntNan(maxload / 9);
		var shift_Ore = parseIntNan(maxload / 9);
		var shift_Astone = parseIntNan(maxload / 9 * 5); //Aetherstone takes 5 of 9 portions    
		if ((maxload - carry_Food - carry_Wood - carry_Stone - carry_Ore - carry_Astone) < 0){
			var shift_num=0;
			var shift_spare=0;

			// Check: See if load/4 is to big for some resources...
			if (carry_Food < shift_Food) {
		    	shift_spare += (shift_Food - carry_Food);
		    	shift_Food = carry_Food;
			}
			if (carry_Wood < shift_Wood) {
			    shift_spare += (shift_Wood - carry_Wood);
			    shift_Wood = carry_Wood;
			}
			if (carry_Stone < shift_Stone) {
			    shift_spare += (shift_Stone - carry_Stone);
			    shift_Stone = carry_Stone;
			}
			if (carry_Ore < shift_Ore) {
			    shift_spare += (shift_Ore - carry_Ore);
			    shift_Ore = carry_Ore;
			}
			if (carry_Astone < shift_Astone) {
			    shift_spare += (shift_Astone - carry_Astone);
			    shift_Astone = carry_Astone;
			}                        
             
          	while (shift_spare >1) {
                if (carry_Food < (shift_Food + shift_spare)){
                    shift_spare = shift_spare - carry_Food;;
                    shift_Food = carry_Food;
                }
                else{
                  shift_Food = (shift_Food + shift_spare);
                  shift_spare = shift_spare- shift_spare;
                }
                if (carry_Wood < (shift_Wood + shift_spare)){
                    shift_spare = shift_spare - carry_Wood;;
                    shift_Wood = carry_Wood;
                } else {
                    shift_Wood = shift_Wood + shift_spare;
                    shift_spare = shift_spare - shift_spare;
                }
                if (carry_Stone < (shift_Stone + shift_spare)){
                    shift_spare = shift_spare - carry_Stone;
                    shift_Stone = carry_Stone;
                } else {
                    shift_Stone = shift_Stone + shift_spare;
                    shift_spare = shift_spare - shift_spare;
                }
                if (carry_Ore < (shift_Ore + shift_spare)) {
                    shift_spare = shift_spare - carry_Ore;
                    shift_Ore = carry_Ore;
                } else {
                    shift_Ore = shift_Ore + shift_spare;
                    shift_spare = shift_spare - shift_spare;
                }
                if (carry_Astone < (shift_Astone + shift_spare)) {
                    shift_spare = shift_spare - carry_Astone;
                    shift_Astone = carry_Astone;
                } else {
                    shift_Astone = shift_Astone + shift_spare;
                    shift_spare = shift_spare - shift_spare;
                }
            }
            carry_Food = shift_Food;
            carry_Wood = shift_Wood;
            carry_Stone = shift_Stone;
            carry_Ore = shift_Ore;
            carry_Astone = shift_Astone;
        }
        if (maxload > (carry_Food + carry_Wood + carry_Stone + carry_Ore + carry_Astone) && ship_Gold == true) {
            if ((maxload - (carry_Food + carry_Wood + carry_Stone + carry_Ore + carry_Astone)) > (citymax_Gold - target_Gold)) {
                carry_Gold = (citymax_Gold - target_Gold);
                if (carry_Gold < 0) carry_Gold = 0;
            } else carry_Gold = (maxload - (carry_Food + carry_Wood + carry_Stone + carry_Ore + carry_Astone));
            if (trade_Gold > 0 && (carry_Gold > trade_Gold)) carry_Gold = parseInt(trade_Gold);
        }
        wagons_needed = ((carry_Food + carry_Wood + carry_Stone + carry_Ore + carry_Astone + carry_Gold) / maxloadperwagon);
        wagons_needed = wagons_needed.toFixed(0);
        if (wagons_needed < ((carry_Food + carry_Wood + carry_Stone + carry_Ore + carry_Astone + carry_Gold) / maxloadperwagon)) wagons_needed++;
        if (wagons_needed < Options.minwagons) {
            if (DEBUG_TRACE) logit('Small transport skipped');
            return;
        }   
        for (var i=1;i<=15;i++) params['u'+i] = 0;     
        switch (unit){
		      case 'unt1': params.u1 = wagons_needed;break;
		      case 'unt2': params.u2 = wagons_needed;break;
		      case 'unt3': params.u3 = wagons_needed;break;
		      case 'unt4': params.u4 = wagons_needed;break;
		      case 'unt5': params.u5 = wagons_needed;break;
		      case 'unt6': params.u6 = wagons_needed;break;
		      case 'unt7': params.u7 = wagons_needed;break;
		      case 'unt8': params.u8 = wagons_needed;break;
		      case 'unt9': params.u9 = wagons_needed;break;
		      case 'unt10': params.u10 = wagons_needed;break;
		      case 'unt11': params.u11 = wagons_needed;break;
		      case 'unt12': params.u12 = wagons_needed;break;
		}
        
        if ((carry_Food + carry_Wood + carry_Stone + carry_Ore + carry_Astone + carry_Gold) > 0) {
        	for (i=1;i<=Seed.cities.length;i++) if (Seed.cities[i-1][0] == city) cityNumber = i;
        	var astone = parseInt(carry_Astone/5);
        	var now = unixTime();
        	Options.lastCityTransport[cityNumber] = now;
        	MarchQueue[cityNumber].unshift({
				what: 			"Transport",
				city: 			city,
				action: 		1,
				targetX: 		xcoord,
				targetY: 		ycoord,
				1: 				params.u1,
				2: 				params.u2,
				3: 				params.u3,
				4: 				params.u4,
				5: 				params.u5,
				6: 				params.u6,
				7: 				params.u7,
				8: 				params.u8,
				9: 				params.u9,
				10: 			params.u10,
				11: 			params.u11,
				12: 			params.u12,
				13: 			params.u13,
				14: 			params.u14,
				15: 			params.u15,
				r1: 			carry_Food,
				r2: 			carry_Wood,
				r3: 			carry_Stone,
				r4: 			carry_Ore,
				r5: 			astone,
				gold: 			carry_Gold,
	        });
        }
    },
    
    ManualTransport: function(){
	    var t = Tabs.transport;
	    if (document.getElementById ('ptcityX').value == "" || document.getElementById ('ptcityY').value == "") return;
	    if ( t.TroopsNeeded > t.Troops) return;
	    
	    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
	    var unitType = document.getElementById('TransportTroop').value;
	    var LoadUnit = (parseInt(Seed.tech.tch10) * ((parseInt(unsafeWindow.unitstats[unitType]['5'])/100)*10)) + parseInt(unsafeWindow.unitstats[unitType]['5']);
	    var MaxLoad =  parseInt(Seed.units['city' + t.tcp.city.id][unitType]) * LoadUnit;
	    document.getElementById ('errorSpace').innerHTML = '';
	          
	    params.kid = 0;
	    params.cid=  t.tcp.city.id;
	    params.type = "1";
	    params.xcoord = parseInt(document.getElementById ('ptcityX').value);
	    params.ycoord = parseInt(document.getElementById ('ptcityY').value);
	    params.r1 = parseInt(document.getElementById ('pbtradeamountFood').value);
	    params.r2 = parseInt(document.getElementById ('pbtradeamountWood').value);
	    params.r3 = parseInt(document.getElementById ('pbtradeamountStone').value);
	    params.r4 = parseInt(document.getElementById ('pbtradeamountOre').value);
	    params.r5 = parseInt(document.getElementById ('pbtradeamountAstone').value);
	    params.gold = parseInt(document.getElementById ('pbtradeamountGold').value);
	        
	    switch (unitType){
	      case 'unt1': params.u1 = parseInt(document.getElementById ('TroopsToSend').value);break;
	      case 'unt2': params.u2 = parseInt(document.getElementById ('TroopsToSend').value);break;
	      case 'unt3': params.u3 = parseInt(document.getElementById ('TroopsToSend').value);break;
	      case 'unt4': params.u4 = parseInt(document.getElementById ('TroopsToSend').value);break;
	      case 'unt5': params.u5 = parseInt(document.getElementById ('TroopsToSend').value);break;
	      case 'unt6': params.u6 = parseInt(document.getElementById ('TroopsToSend').value);break;
	      case 'unt7': params.u7 = parseInt(document.getElementById ('TroopsToSend').value);break;
	      case 'unt8': params.u8 = parseInt(document.getElementById ('TroopsToSend').value);break;
	      case 'unt9': params.u9 = parseInt(document.getElementById ('TroopsToSend').value);break;
	      case 'unt10': params.u10 = parseInt(document.getElementById ('TroopsToSend').value);break;
	      case 'unt11': params.u11 = parseInt(document.getElementById ('TroopsToSend').value);break;
	      case 'unt12': params.u12 = parseInt(document.getElementById ('TroopsToSend').value);break;
	    }
	    if ((params.r1 + params.r2 + params.r3 + params.r4 + params.r5 + params.gold) > 0) {
	                 
	        var profiler = new unsafeWindow.cm.Profiler("ResponseTime", "march.php");
	        new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/march.php" + unsafeWindow.g_ajaxsuffix, {
	                  method: "post",
	                  parameters: params,
	                  loading: true,
	                  onSuccess: function (transport) {
						  profiler.stop();
	                  var rslt = eval("(" + transport.responseText + ")");
	                  if (rslt.ok) {                  
	                          var timediff = parseInt(rslt.eta) - parseInt(rslt.initTS);
	                          var ut = unixTime();
	                          var unitsarr=[0,0,0,0,0,0,0,0,0,0,0,0,0];
	                          for(i = 0; i <= unitsarr.length; i++){
	                              if(params["u"+i]){
	                              unitsarr[i] = params["u"+i];
	                              }
	                          }
	                          var resources=new Array();
	                          resources[0] = params.gold;
	                          for(i=1; i<=5; i++){
	                              resources[i] = params["r"+i];
	                          }
	                          var currentcityid = t.tcp.city.id;
	                          unsafeWindow.attach_addoutgoingmarch(rslt.marchId, rslt.marchUnixTime, ut + timediff, params.xcoord, params.ycoord, unitsarr, params.type, params.kid, resources, rslt.tileId, rslt.tileType, rslt.tileLevel, currentcityid, true);
	                          if(rslt.updateSeed){unsafeWindow.update_seed(rslt.updateSeed)};
	                          document.getElementById ('errorSpace').innerHTML = 'Send: ' + addCommas(params.r1+params.r2+params.r3+params.r4+params.r5+params.gold) + ' Resources with ' + addCommas(parseInt(document.getElementById ('TroopsToSend').value)) + ' ' + unsafeWindow.unitcost[unitType][0];
	                          document.getElementById ('pbtradeamountFood').value = 0;
	                          document.getElementById ('pbtradeamountWood').value = 0;
	                          document.getElementById ('pbtradeamountStone').value = 0;
	                          document.getElementById ('pbtradeamountOre').value = 0;
	                          document.getElementById ('pbtradeamountAstone').value = 0;
	                          document.getElementById ('pbtradeamountGold').value = 0;
	                          document.getElementById ('TroopsToSend').value = 0;
	                  } else {
						    if (rslt.user_action == "backOffWaitTime") {
							logit('backoffwaittime '+rslt.wait_time);
	                        var wait = 1;
	                        if(rslt.wait_time)
	                        wait = rslt.wait_time;
	                        setTimeout (function(){t.ManualTransport();}, wait*1000);
	                        document.getElementById ('errorSpace').innerHTML = '<HR><FONT COLOR=red>'+translate("Error:")+' ' + 'kabam making us wait for '+wait+' seconds then retry march' +'</font>';
	                        return;
						  };
	                          var errorcode =  'err_' + rslt.error_code;
	                          if (rslt.msg == undefined)document.getElementById ('errorSpace').innerHTML = '<HR><FONT COLOR=red>'+translate("Error:")+' ' + unsafeWindow.g_js_strings.errorcode[errorcode] +'</font>';
	                          else document.getElementById ('errorSpace').innerHTML = '<HR><FONT COLOR=red>'+translate("Error:")+' ' + rslt.msg +'</font>';
	                  }
	                  },
	                  onFailure: function () {profiler.stop();}
	        });
	    }
    },
    show: function () {
        var t = Tabs.transport;
        if (t.traderState.running) document.getElementById('pbTraderState').value = "Transport = ON";
        	else document.getElementById('pbTraderState').value = "Transport = OFF";
        clearTimeout(t.timer);
        t.updateTroops();
        t.updateResources();
        t.timer = setTimeout(t.show, 1000);
    },
    hide: function () {
        var t = Tabs.transport;
        clearTimeout(t.timer);
    },
    onUnload: function () {
        var t = Tabs.transport;
        if (!ResetAll) t.saveTradeRoutes();
        if (!ResetAll) t.saveTraderState();
    },
}


/*********************************  Raid Tab ***********************************/

 Tabs.Raid = {
  tabDisabled : false,
  tabOrder : 110,
  myDiv : null,
  rallypointlevel:null,
  knt:{},
  Troops:{},
  city:0,
  raidtimer:null,
  rslt:{},
  save:{},
  stopping:false,
  resuming:false,
  deleting:false,
  stopprogress:0,
  stopcount:0,
  activecount:0,
  count:0,
  
  init : function (div){
    var t = Tabs.Raid;
    t.myDiv = div;
    t.raidtimer = setTimeout(t.checkRaids, 30000);

    var m = '<DIV class=pbStat>RAID FUNCTIONS</div><TABLE width=100% height=0% class=pbTab><TR align="center">';
        m += '<TD><INPUT id=pbRaidStart type=submit value="Auto Reset = '+ (Options.RaidRunning?'ON':'OFF') +'" ></td>';
        m += '<TD><INPUT id=pbsendraidreport type=checkbox '+ (Options.foodreport?'CHECKED':'') +'\> Send raid report every ';
        m += '<INPUT id=pbsendreportint value='+ Options.MsgInterval +' type=text size=3 \> hours </td>';
        m += '</tr></table></div>';
        m += '<DIV class=pbStat>ACTIVE RAIDS</div><TABLE width=100% height=0% class=pbTab><TR align="center">';
        m += '<TD><DIV style="margin-bottom:10px;"><span id=ptRaidCity></span></div></td></tr>';
        m+='<TR><TD><DIV style="margin-bottom:10px;"><span id=ptRaidTimer></span></div></td></tr></table>';
        m += '<DIV id=PaintRaids></div>';
        m += '<DIV class=pbStat>SAVED RAIDS</div><TABLE width=100% height=0% class=pbTab><TR align="center">';
        m += '<DIV id=SavedRaids></div>';
    t.myDiv.innerHTML = m;
    
    t.from = new CdispCityPicker ('ptRaidpicker', document.getElementById('ptRaidCity'), true, t.clickCitySelect, 0);
    document.getElementById('pbRaidStart').addEventListener('click', t.toggleRaidState, false);
    document.getElementById('pbsendraidreport').addEventListener('change', function(){
        Options.foodreport = document.getElementById('pbsendraidreport').checked;
        saveOptions();
    }, false);
    document.getElementById('pbsendreportint').addEventListener('change', function(){
        Options.MsgInterval = parseInt(document.getElementById('pbsendreportint').value);
        saveOptions();
    }, false);
    
    var serverID = getServerId();
    t.save = GM_getValue ('SavedRaids_'+serverID);
    if (t.save != undefined) t.save = JSON2.parse (t.save);
    
  },
 
  paint : function ()    {
      var t = Tabs.Raid;
      var botMarchStat = {0:'Inactive',
                          1:'Raiding',
                          2:'Returning',
                          3:'Stopped',
                          4:'Resting',
                          5:'Unknown',
                          7:'Situation Changed',
                          8:'Returning',
                          9:'Aborting'};
      var botStat = {0:'Undefined',
                          1:'Marching',
                          2:'Returning',
                          3:'Stopped',
                          4:'Insufficient Troops',
                          5:'Max Raids Exceeded',
                          7:'Timed out',
                          8:'Resting'};
      var o = '';
      if (t.rslt.settings != undefined) o+= '<FONT size=2px><B>Raid Timer: '+ timestr( 86400 - ( unixTime() - t.rslt.settings.lastUpdated )) +'</b></font>';
      document.getElementById('ptRaidTimer').innerHTML = o;
      
      var z ='<TABLE class=pbTab><TR><TD width=60px align=center><A onclick="pbStopAll('+t.cityId+')">STOP</a></td><TD width=70px>Time</td><TD width=85px>Coords</td><TD width=50px>Level</td><TD width=50px></td><TD width=50px><A onclick="pbDeleteAll()">DELETE</a></td></TR>';
      if (t.rslt['queue'] != ""){
          for (y in t.rslt['queue']) {
              if (t.rslt['queue'][y]['botMarches'] != undefined) {
                  for (k in Seed.queue_atkp['city' + t.cityId]){
                      if (Seed.queue_atkp['city' + t.cityId][k]['marchId'] == t.rslt['queue'][y]['botMarches']['marchId']) {
                          botMarchStatus = Seed.queue_atkp['city' + t.cityId][k]['botMarchStatus'];
                          MarchStatus = Seed.queue_atkp['city' + t.cityId][k]['marchStatus'];
                          restPeriod = (Seed.queue_atkp['city' + t.cityId][k]['restPeriod']/60);
                          destinationUnixTime = Seed.queue_atkp['city' + t.cityId][k]['destinationUnixTime'];
                          returnUnixTime = Seed.queue_atkp['city' + t.cityId][k]['returnUnixTime']
                          now = unixTime();
                          //z+='<TR><TD>('+ botMarchStatus +'/'+ MarchStatus +')</td>';
                          z+='<TR>';
                          //if (destinationUnixTime > now && botMarchStatus !=3) z+='<TD align=center><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/attacking.jpg></td>';
                          if (MarchStatus ==1) z+='<TD align=center><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/attacking.jpg></td>';
                          //if ((destinationUnixTime - now) <= 0 && botMarchStatus !=3 && returnUnixTime > now) z+='<TD align=center><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/returning.jpg></td>';
                          if (MarchStatus ==8 && (destinationUnixTime - now) <= 0 && botMarchStatus !=3 && returnUnixTime > now) z+='<TD align=center><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/returning.jpg></td>';
                          if (MarchStatus == 3) z+='<TD align=center><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/autoAttack/raid_stopped_desat.png></td>';
                          //if (returnUnixTime < now  && botMarchStatus !=3) z+='<TD align=center><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/autoAttack/raid_resting.png></td>';
                          if (MarchStatus == 4 || (returnUnixTime < now  && botMarchStatus !=3)) z+='<TD align=center><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/autoAttack/raid_resting.png></td>';
                          
                          if (destinationUnixTime >= now) z+='<TD>'+ timestr(Seed.queue_atkp['city' + t.cityId][k]['destinationUnixTime'] - unixTime())+'</td>';
                          if (destinationUnixTime <= now) {
                              if ((destinationUnixTime - now) <= 0 && returnUnixTime > now) z+='<TD>'+ timestr(returnUnixTime - now)+'</td>';
                              if (returnUnixTime <= now) z+='<TD>'+ timestr(now - returnUnixTime)+'</td>';
                          }
                      }
                  }
                  z+='<TD>('+ t.rslt['queue'][y]['botMarches']['toXCoord'] +','+ t.rslt['queue'][y]['botMarches']['toYCoord']+')</td>';
                  z+='<TD align=center>'+ t.rslt['queue'][y]['botMarches']['toTileLevel'] +'</td>';
                  if (botMarchStatus == 3) z+='<TD><A onclick="pbEditRaid('+ y +')">Edit</a></td>';
                      else z+='<TD><FONT COLOR= "CCCCCC">Edit</font></td>';
                  if (botMarchStatus == 3) z+='<TD align=center><A onclick="pbDeleteRaid('+ t.rslt['queue'][y]['botMarches']['marchId']+')">Delete</a></td>';
                  else z+='<TD align=center><FONT COLOR= "CCCCCC">Delete</font></td>';
                  //z +='<TD width=25px></td><TD>Status: '+ botMarchStat[botMarchStatus]+'</td>';
                  z +='<TD width=25px></td><TD>Rest Time: '+ timestr(restPeriod) +'</td>';
                  z+='</tr>';
              }
          }
      }
      z+='</table>';
      if (t.rslt['queue'] == "") z ='<TABLE class=pbTab><TR><TD>No Raids in city!</td></TR>';
      document.getElementById('PaintRaids').innerHTML = z;
      
      var check = true;
          if (t.save != ""){
              var a ='<TABLE class=pbTab><TR><TD width=60px></td><TD width=70px></td><TD width=85px>Coords</td><TD width=50px>Level</td><TD width=50px></td><TD width=50px></td></tr>';
              for (y in t.save){
                  if (t.save[y] != undefined && t.cityId == t.save[y]['cityId']){
                      a +='<TR><TD align=center><A onclick="pbDeleteSavedRaid('+ t.save[y]['marchId'] +')">X</a></td>';
                      a +='<TD></td><TD><FONT COLOR= "CC0000">('+t.save[y]['toXCoord']+','+t.save[y]['toYCoord']+')</font></td>';
                      a +='<TD align=center>'+t.save[y]['toTileLevel']+'</td>';
                      a +='<TD><A onclick="pbEditSavedRaid('+ y +')">Edit</a></td>';
                      a +='<TD align=center><A onclick="pbAddRaid('+ t.save[y]['marchId']+')">Add</a></td></tr>';
                      check = false;
                  }    
              }
              m+='</table>';
          }
          
      if (check) a ='<TABLE class=pbTab><TR><TD>No Saved Raids in city!</td></TR>';
      
      document.getElementById('SavedRaids').innerHTML = a;      
      
      unsafeWindow.pbDeleteRaid = t.DeleteRaid;
      unsafeWindow.pbEditRaid = t.EditRaid;
      unsafeWindow.pbAddRaid = t.AddRaid;
      unsafeWindow.pbDeleteSavedRaid = t.DeleteSavedRaid;
      unsafeWindow.pbEditSavedRaid = t.EditSavedRaid;
      unsafeWindow.pbStopAll = t.StopCityRaids;
      unsafeWindow.pbDeleteAll = t.DeleteCityRaids;
  },
  
  DeleteSavedRaid : function (Id){
          var t = Tabs.Raid;
          for (yy=0;yy<t.save.length;yy++){
              if (t.save[yy]['marchId'] == Id){
                    t.save.splice (yy,1);
              }    
          }
          var serverID = getServerId();
          setTimeout (function (){GM_setValue ('SavedRaids_'+serverID, JSON2.stringify(t.save));}, 0);
          t.paint();
    },
  
  EditSavedRaid : function (y){
      var t = Tabs.Raid;
      var pop = new pbPopup ('pbEditRaid', 0,0, 750,350, true);
      if (t.popFirst){
        pop.centerMe (mainPop.getMainDiv());  
        t.popFirst = false;
      }
      pop.getTopDiv().innerHTML = '<CENTER><B>Edit Saved Raid</b></center>';
      cityId =  t.save[y]['cityId'];
      
          var m = '<BR><TABLE id=pbRaidAdd height=0% class=pbTab><TR align="center">';
          m+='<TR></tr><TR><TD width=25px>X= <INPUT id=toXCoord type=text size=3 maxlength=3 value='+t.save[y]['toXCoord']+'></td>';
          m+='<TD width=10px></td><TD widht=25px>Y= <INPUT id=toYCoord type=text size=3 maxlength=3 value='+ t.save[y]['toYCoord'] +'></td>';
          m+='<TD width=25px></td><TD>Round Trip: '+ timestr((t.save[y]['returnUnixTime'] - t.save[y]['destinationUnixTime'])*2)+ '</td></tr></table>';

          m += '<BR><TABLE id=pbRaidAdd width=100% height=0% class=pbTab><TR align="center">';
          m += '<TR><TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_1_50.jpg?6545?6545"></td>';
          m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt1']) +'</td>'
          m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_2_50.jpg?6545?6545"></td>'
          m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt2']) +'</td>'
          m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_3_50.jpg?6545?6545"></td>'
          m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt3']) +'</td>'
          m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_4_50.jpg?6545?6545"></td>'
          m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt4']) +'</td></tr>'
          m += '<TR><TD><INPUT id=Unit1 type=text size=6 maxlength=6 value="'+ t.save[y]['unit1Count']+'"></td>';
          m += '<TD><INPUT id=Unit2 type=text size=6 maxlength=6 value="'+ t.save[y]['unit2Count']+'"></td>';
          m += '<TD><INPUT id=Unit3 type=text size=6 maxlength=6 value="'+ t.save[y]['unit3Count']+'"></td>';
          m += '<TD><INPUT id=Unit4 type=text size=6 maxlength=6 value="'+ t.save[y]['unit4Count']+'"></td></tr>';
          
          m += '<TR><TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_5_50.jpg?6545?6545"></td>';
          m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt5']) +'</td>'
          m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_6_50.jpg?6545?6545"></td>'
          m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt6']) +'</td>'
          m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_7_50.jpg?6545?6545"></td>'
          m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt7']) +'</td>'
          m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_8_50.jpg?6545?6545"></td>'
          m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt8']) +'</td></tr>'
          m += '<TR><TD><INPUT id=Unit5 type=text size=6 maxlength=6 value="'+ t.save[y]['unit5Count']+'"></td>';
          m += '<TD><INPUT id=Unit6 type=text size=6 maxlength=6 value="'+ t.save[y]['unit6Count']+'"></td>';
          m += '<TD><INPUT id=Unit7 type=text size=6 maxlength=6 value="'+ t.save[y]['unit7Count']+'"></td>';
          m += '<TD><INPUT id=Unit8 type=text size=6 maxlength=6 value="'+ t.save[y]['unit8Count']+'"></td></tr>';
          
          m += '<TR><TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_9_50.jpg?6545?6545"></td>';
          m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt9']) +'</td>'
          m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_10_50.jpg?6545?6545"></td>'
          m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt10']) +'</td>'
          m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_11_50.jpg?6545?6545"></td>'
          m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt11']) +'</td>'
          m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_12_50.jpg?6545?6545"></td>'
          m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt12']) +'</td></tr>'
          m += '<TR><TD><INPUT id=Unit9 type=text size=6 maxlength=6 value="'+ t.save[y]['unit9Count']+'"></td>';
          m += '<TD><INPUT id=Unit10 type=text size=6 maxlength=6 value="'+ t.save[y]['unit10Count']+'"></td>';
          m += '<TD><INPUT id=Unit11 type=text size=6 maxlength=6 value="'+ t.save[y]['unit11Count']+'"></td>';
          m += '<TD><INPUT id=Unit12 type=text size=6 maxlength=6 value="'+ t.save[y]['unit12Count']+'"></td></tr></table>';
          
          m += '<BR><CENTER><SELECT id=AddKnights type=list></select></center>';
          m+= '<BR><CENTER>'+ strButton20('Save', 'id=pbSaveRaid') +'</center>';
            
      pop.getMainDiv().innerHTML = m;
      
      t.getKnights(cityId);
      
      document.getElementById ('AddKnights').value =  t.save[y]['knightId'];
      document.getElementById ('pbSaveRaid').addEventListener ('click', function(){
                  t.save[y]['knightId'] = parseInt(document.getElementById ('AddKnights').value);
                  t.save[y]['toXCoord'] = parseInt(document.getElementById ('toXCoord').value);
                  t.save[y]['toYCoord'] = parseInt(document.getElementById ('toYCoord').value);
                  t.save[y]['unit1Count'] = parseInt(document.getElementById ('Unit1').value);
                  t.save[y]['unit2Count'] = parseInt(document.getElementById ('Unit2').value);
                  t.save[y]['unit3Count'] = parseInt(document.getElementById ('Unit3').value);
                  t.save[y]['unit4Count'] = parseInt(document.getElementById ('Unit4').value);
                  t.save[y]['unit5Count'] = parseInt(document.getElementById ('Unit5').value);
                  t.save[y]['unit6Count'] = parseInt(document.getElementById ('Unit6').value);
                  t.save[y]['unit7Count'] = parseInt(document.getElementById ('Unit7').value);
                  t.save[y]['unit8Count'] = parseInt(document.getElementById ('Unit8').value);
                  t.save[y]['unit9Count'] = parseInt(document.getElementById ('Unit9').value);
                  t.save[y]['unit10Count'] = parseInt(document.getElementById ('Unit10').value);
                  t.save[y]['unit11Count'] = parseInt(document.getElementById ('Unit11').value);
                  t.save[y]['unit12Count'] = parseInt(document.getElementById ('Unit12').value);
                  var serverID = getServerId();
                  setTimeout (function (){GM_setValue ('SavedRaids_'+serverID, JSON2.stringify(t.save));}, 0);
                  pop.show (false);
      }, false);
      
      pop.show (true);      
    },
      
  EditRaid : function (y){
        var t = Tabs.Raid;
        var pop = new pbPopup ('pbEditRaid', 0,0, 750,350, true);
        if (t.popFirst){
          pop.centerMe (mainPop.getMainDiv());  
          t.popFirst = false;
        }
        pop.getTopDiv().innerHTML = '<CENTER><B>Edit Raid</b></center>';
        cityId = t.rslt['queue'][y]['botMarches']['cityId'];
        
            var m = '<BR><TABLE id=pbRaidAdd height=0% class=pbTab><TR align="center">';
            m+='<TR></tr><TR><TD width=25px>X= <INPUT id=toXCoord type=text size=3 maxlength=3 value='+t.rslt['queue'][y]['botMarches']['toXCoord']+'></td>';
            m+='<TD width=10px></td><TD widht=25px>Y= <INPUT id=toYCoord type=text size=3 maxlength=3 value='+ t.rslt['queue'][y]['botMarches']['toYCoord'] +'></td>';
            m+='<TD width=25px></td><TD>Round Trip: '+ timestr((t.rslt['queue'][y]['botMarches']['returnUnixTime'] - t.rslt['queue'][y]['botMarches']['destinationUnixTime'])*2)+ '</td></tr></table>';

            m += '<BR><TABLE id=pbRaidAdd width=100% height=0% class=pbTab><TR align="center">';
            m += '<TR><TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_1_50.jpg?6545?6545"></td>';
            m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt1']) +'</td>'
            m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_2_50.jpg?6545?6545"></td>'
            m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt2']) +'</td>'
            m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_3_50.jpg?6545?6545"></td>'
            m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt3']) +'</td>'
            m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_4_50.jpg?6545?6545"></td>'
            m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt4']) +'</td></tr>'
            m += '<TR><TD><INPUT id=Unit1 type=text size=6 maxlength=6 value="'+ t.rslt['queue'][y]['botMarches']['unit1Count']+'"></td>';
            m += '<TD><INPUT id=Unit2 type=text size=6 maxlength=6 value="'+ t.rslt['queue'][y]['botMarches']['unit2Count']+'"></td>';
            m += '<TD><INPUT id=Unit3 type=text size=6 maxlength=6 value="'+ t.rslt['queue'][y]['botMarches']['unit3Count']+'"></td>';
            m += '<TD><INPUT id=Unit4 type=text size=6 maxlength=6 value="'+ t.rslt['queue'][y]['botMarches']['unit4Count']+'"></td></tr>';
            
            m += '<TR><TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_5_50.jpg?6545?6545"></td>';
            m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt5']) +'</td>'
            m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_6_50.jpg?6545?6545"></td>'
            m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt6']) +'</td>'
            m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_7_50.jpg?6545?6545"></td>'
            m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt7']) +'</td>'
            m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_8_50.jpg?6545?6545"></td>'
            m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt8']) +'</td></tr>'
            m += '<TR><TD><INPUT id=Unit5 type=text size=6 maxlength=6 value="'+ t.rslt['queue'][y]['botMarches']['unit5Count']+'"></td>';
            m += '<TD><INPUT id=Unit6 type=text size=6 maxlength=6 value="'+ t.rslt['queue'][y]['botMarches']['unit6Count']+'"></td>';
            m += '<TD><INPUT id=Unit7 type=text size=6 maxlength=6 value="'+ t.rslt['queue'][y]['botMarches']['unit7Count']+'"></td>';
            m += '<TD><INPUT id=Unit8 type=text size=6 maxlength=6 value="'+ t.rslt['queue'][y]['botMarches']['unit8Count']+'"></td></tr>';
            
            m += '<TR><TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_9_50.jpg?6545?6545"></td>';
            m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt9']) +'</td>'
            m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_10_50.jpg?6545?6545"></td>'
            m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt10']) +'</td>'
            m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_11_50.jpg?6545?6545"></td>'
            m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt11']) +'</td>'
            m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_12_50.jpg?6545?6545"></td>'
            m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt12']) +'</td></tr>'
            m += '<TR><TD><INPUT id=Unit9 type=text size=6 maxlength=6 value="'+ t.rslt['queue'][y]['botMarches']['unit9Count']+'"></td>';
            m += '<TD><INPUT id=Unit10 type=text size=6 maxlength=6 value="'+ t.rslt['queue'][y]['botMarches']['unit10Count']+'"></td>';
            m += '<TD><INPUT id=Unit11 type=text size=6 maxlength=6 value="'+ t.rslt['queue'][y]['botMarches']['unit11Count']+'"></td>';
            m += '<TD><INPUT id=Unit12 type=text size=6 maxlength=6 value="'+ t.rslt['queue'][y]['botMarches']['unit12Count']+'"></td></tr></table>';
            
            m += '<BR><CENTER><SELECT id=AddKnights type=list></select></center>';
            m+= '<BR><CENTER>'+ strButton20('Save', 'id=pbRaidSave') +'</center>';
              
        pop.getMainDiv().innerHTML = m;
        
        t.getKnights(cityId);
        
        document.getElementById ('AddKnights').value =  t.rslt['queue'][y]['botMarches']['knightId'];
        document.getElementById ('pbRaidSave').addEventListener ('click', function(){
            var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
                              
            params.pf = 0;
            params.ctrl = 'BotManager';
            params.action = 'editMarch';
            params.settings = {};
            params.settings.cityId = t.rslt['queue'][y]['botMarches']['fromCityId'];
            params.queue = {0:{botMarches:{botMarchStatus:1,botState:1},cityMarches:{}}};        
            params.queue[0].cityMarches.knightId = parseInt(document.getElementById ('AddKnights').value);
            params.queue[0].cityMarches.toXCoord =  parseInt(document.getElementById ('toXCoord').value);
            params.queue[0].cityMarches.toYCoord =  parseInt(document.getElementById ('toYCoord').value);
            params.queue[0].cityMarches.unit0Count = 0; //document.getElementById ('Unit0').value;
            params.queue[0].cityMarches.unit1Count =  parseInt(document.getElementById ('Unit1').value);
            params.queue[0].cityMarches.unit2Count = parseInt(document.getElementById ('Unit2').value);
            params.queue[0].cityMarches.unit3Count = parseInt(document.getElementById ('Unit3').value);
            params.queue[0].cityMarches.unit4Count = parseInt(document.getElementById ('Unit4').value);
            params.queue[0].cityMarches.unit5Count = parseInt(document.getElementById ('Unit5').value);
            params.queue[0].cityMarches.unit6Count = parseInt(document.getElementById ('Unit6').value);
            params.queue[0].cityMarches.unit7Count = parseInt(document.getElementById ('Unit7').value);
            params.queue[0].cityMarches.unit8Count = parseInt(document.getElementById ('Unit8').value);
            params.queue[0].cityMarches.unit9Count = parseInt(document.getElementById ('Unit9').value);
            params.queue[0].cityMarches.unit10Count = parseInt(document.getElementById ('Unit10').value);
            params.queue[0].cityMarches.unit11Count = parseInt(document.getElementById ('Unit11').value);
            params.queue[0].cityMarches.unit12Count = parseInt(document.getElementById ('Unit12').value);
            params.queue[0].cityMarches.marchId =  t.rslt['queue'][y]['botMarches']['marchId'];
            
            
             new AjaxRequest2(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
                            method: "post",
                           parameters: params,
                           loading: true,
                           onSuccess: function(transport){
                              var rslt = eval("(" + transport.responseText + ")");
                                if (rslt.ok) {
                                        pop.show (false);
                                      unsafeWindow.cityinfo_army();
                                    setTimeout(unsafeWindow.update_seed_ajax, 250);
                                    setTimeout(t.GetRaids, (750),Seed.cities[i][0]);
                                  }
                           },
                   });
            }, false);
        
        pop.show (true);      
  },
  
  DeleteRaid : function (Id){
      var t = Tabs.Raid;
      var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
      
      for (y in t.rslt['queue']) {
          if (t.rslt['queue'][y]['botMarches'] != undefined) {
              if (t.rslt['queue'][y]['botMarches']['marchId'] == Id) {
                      marchId = t.rslt['queue'][y]['botMarches']['marchId'];
                      cityId = t.rslt['queue'][y]['botMarches']['cityId'];
                      knightId = t.rslt['queue'][y]['botMarches']['knightId'];
                      toTileLevel = t.rslt['queue'][y]['botMarches']['toTileLevel'];
                      returnUnixTime = t.rslt['queue'][y]['botMarches']['returnUnixTime'];
                      destinationUnixTime = t.rslt['queue'][y]['botMarches']['destinationUnixTime'];
                      toXCoord = t.rslt['queue'][y]['botMarches']['toXCoord'];
                      toYCoord = t.rslt['queue'][y]['botMarches']['toYCoord'];
                      var units = {};
                      for (i=1;i<13;i++) units[i] = t.rslt['queue'][y]['botMarches']['unit'+i+'Count'];
              }
          }
      }    
      
      params.pf = 0;
      params.ctrl = 'BotManager';
      params.action = 'deleteMarch';
      params.marchId = marchId;
      params.settings = {};
      params.settings.cityId = cityId;

      
      
    new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
               method: "post",
               parameters: params,
               loading: true,
               onSuccess: function(transport){
                  var rslt = eval("(" + transport.responseText + ")");
                    if (rslt.ok) {
                          var serverID = getServerId();
                          t.save = GM_getValue ('SavedRaids_'+serverID);
                          if (t.save == undefined) t.save =new Array();
                      else t.save = JSON2.parse (t.save);
                      
                          t.save.push ({
                              marchId:        marchId,
                              cityId:           cityId,
                              knightId:        knightId,
                              toTileLevel:    toTileLevel,
                              returnUnixTime:    destinationUnixTime,
                              returnUnixTime:    returnUnixTime,
                              toXCoord:        toXCoord,
                              toYCoord:        toYCoord,
                              unit1Count:     units[1],
                              unit2Count:     units[2],
                              unit3Count:     units[3],
                              unit4Count:     units[4],
                              unit5Count:     units[5],
                              unit6Count:     units[6],
                              unit7Count:     units[7],
                              unit8Count:     units[8],
                              unit9Count:     units[9],
                              unit10Count:     units[10],
                              unit11Count:     units[11],
                              unit12Count:     units[12],
                          });
                          var troops = Seed.units["city" + cityId];
                      for (var u = 1; u <= 12; ++u) {
                          var troop_number = parseInt(rslt["unit" + u + "Return"]);
                          if (isNaN(troop_number)) {
                              troop_number = parseInt(Seed.units["city" + cityId]["unt" + u]);
                          } else troop_number = parseInt(rslt["unit" + u + "Return"]) + parseInt(Seed.units["city" + cityId]["unt" + u]);
                          troops["unt" + u] = troop_number;
                      }
                      for (u in Seed.queue_atkp['city' + cityId]){
                          if (Seed.queue_atkp['city' + cityId][u]['marchId'] == marchId){
                            Seed.queue_atkp['city' + cityId][u] = "";
                              unsafeWindow.seed.queue_atkp['city' + cityId] = Seed.queue_atkp['city' + cityId];
                          }
                      }
                      
                      for (u in Seed.knights['city' + cityId]){
                          if (Seed.knights['city' + cityId][u]['knightId'] == knightId){
                              Seed.knights['city' + cityId][u]["knightStatus"] = 1;
                              unsafeWindow.seed.knights['city' + cityId] = Seed.knights['city' + cityId];
                          }
                      }
                                                      
                          GM_setValue ('SavedRaids_'+serverID, JSON2.stringify(t.save));
                          t.save = null;
                      unsafeWindow.cityinfo_army();
                        setTimeout(unsafeWindow.update_seed_ajax, 250);
                        t.GetRaids(cityId);
                      }
               },
       });
},
  
  StopCityRaids : function (cityId){
        var t = Tabs.Raid;
        var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);

        
        params.pf = 0;
        params.ctrl = 'BotManager';
        params.action = 'stopAll';
        params.settings = {};

          params.settings.cityId = cityId;
               
         new AjaxRequest2(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
                      method: "post",
                     parameters: params,
                     loading: true,
                     onSuccess: function(transport){
                        var rslt = eval("(" + transport.responseText + ")");
                          if (rslt.ok) {
                                  
                          }
                     },
             });   
    setTimeout(t.GetRaids, (750), cityId);     
    },
  
  StopAllRaids : function (){
          var t = Tabs.Raid;
          if (t.stopping == true || t.resuming == true || t.deleting == true) return;
          if (t.activecount == 0) return;
        t.stopping = true;     
              for (i=0;i<Seed.cities.length;i++){
                  setTimeout(t.DoAllStop, (i*1500),i);
             }
   },
   
   ResumeAllRaids : function (){
           var t = Tabs.Raid;
           if (t.stopping == true || t.resuming == true || t.deleting == true) return;
           if (t.stopcount == 0) return;
           t.resuming = true;
               for (i=0;i<Seed.cities.length;i++){
                   setTimeout(t.DoAllResume, (i*1500),i);
               }
    },
   
   
   DeleteAllRaids : function (){
           var t = Tabs.Raid;
           if (t.stopping == true || t.resuming == true || t.deleting == true) return;
           if (t.stopcount == 0) return;
           t.deleting = true;
           count=0;
           t.count = t.stopcount;
                for (d=0; d< Seed.cities.length;d++) {
                        cityID = 'city' + Seed.cities[d][0];    
                            for (e in Seed.queue_atkp[cityID]){
                                destinationUnixTime = Seed.queue_atkp[cityID][e]['destinationUnixTime'];
                                MarchStatus = Seed.queue_atkp[cityID][e]['marchStatus'];
                                MarchType = Seed.queue_atkp[cityID][e]['marchType'];
                                if (MarchType == 9 && (botMarchStatus == 3 || MarchStatus == 3)) {
                                    count++;
                                    setTimeout(t.DoAllDelete, (count*1250), (Seed.queue_atkp[cityID][e]['marchId']),d,count);
                                }
                            }
                }
    },
    
  
  DoAllStop: function(i) {
    var t = Tabs.Raid;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
      params.pf = 0;
      params.ctrl = 'BotManager';
      params.action = 'stopAll';
      params.settings = {};
      params.settings.cityId = Seed.cities[i][0];
           
                
           new AjaxRequest2(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
                        method: "post",
                       parameters: params,
                       loading: true,
                       onSuccess: function(transport){
                          var rslt = eval("(" + transport.responseText + ")");
                            if (rslt.ok) {
                                    t.stopprogress = t.stopprogress + (100/Seed.cities.length);
                                    actionLog('Stopping: '+ Seed.cities[i][1]);
                                    if (t.stopprogress.toFixed(0) == 100) {
                                         t.stopprogress = 0;
                                    }        
                            }
                            else {
                                    if (rslt.msg == "The system is busy, please try again later") setTimeout (t.DoAllStop, (2000),i);
                                    else {
                                         t.stopprogress = t.stopprogress + (100/Seed.cities.length);
                                         actionLog('Stopping: '+ Seed.cities[i][1] + ' - ' + rslt.msg);
                                         if (t.stopprogress.toFixed(0) == 100) {
                                              t.stopprogress = 0;
                                         }
                                     }
                             }
                       },
    });  
  },

  DoAllResume: function(i) {
    var t = Tabs.Raid;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
      params.pf = 0;
      params.ctrl = 'BotManager';
      params.action = 'resumeAll';
      params.settings = {};
    params.settings.cityId = Seed.cities[i][0];
                
                  
           new AjaxRequest2(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
                        method: "post",
                       parameters: params,
                       loading: true,
                       onSuccess: function(transport){
                          var rslt = eval("(" + transport.responseText + ")");
                            if (rslt.ok) {
                                    t.stopprogress = t.stopprogress + (100/Seed.cities.length);
                                    actionLog('Resuming: '+ Seed.cities[i][1]);
                                    if (t.stopprogress.toFixed(0) == 100) {
                                         t.stopprogress = 0;
                                    }        
                            }
                            else {
                                    if (rslt.msg == "The system is busy, please try again later") setTimeout (t.DoAllResume, (2000),i);
                                    else {
                                         t.stopprogress = t.stopprogress + (100/Seed.cities.length);
                                         actionLog('Stopping: '+ Seed.cities[i][1]  + ' - ' + rslt.msg);
                                         if (t.stopprogress.toFixed(0) == 100) {
                                              t.stopprogress = 0;
                                         }    
                                     }
                             }
                       },
    });  
  },
  
  DoAllDelete : function (Id,city,count){
        var t = Tabs.Raid;
        var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
        
        cityID = 'city'+ Seed.cities[city][0];
        
        for (f in Seed.queue_atkp[cityID]){
            if (Seed.queue_atkp[cityID][f]['marchId'] == Id) {
                    marchId = Seed.queue_atkp[cityID][f]['marchId'];
                    cityId = Seed.queue_atkp[cityID][f]['cityId'];
                    knightId = Seed.queue_atkp[cityID][f]['knightId'];
                    toTileLevel = Seed.queue_atkp[cityID][f]['toTileLevel'];
                    returnUnixTime = Seed.queue_atkp[cityID][f]['returnUnixTime'];
                    destinationUnixTime = Seed.queue_atkp[cityID][f]['destinationUnixTime'];
                    toXCoord = Seed.queue_atkp[cityID][f]['toXCoord'];
                    toYCoord = Seed.queue_atkp[cityID][f]['toYCoord'];
                    var units = {};
                    for (i=1;i<13;i++) units[i] = Seed.queue_atkp[cityID][f]['unit'+i+'Count'];
            }
        }
        
        params.pf = 0;
        params.ctrl = 'BotManager';
        params.action = 'deleteMarch';
        params.marchId = marchId;
        params.settings = {};
        params.settings.cityId = cityId;
       
      new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
                 method: "post",
                 parameters: params,
                 loading: true,
                 onSuccess: function(transport){
                    var rslt = eval("(" + transport.responseText + ")");
                      if (rslt != "") {
                            var serverID = getServerId();
                            t.save = GM_getValue ('SavedRaids_'+serverID, "[]");
                            if (t.save != undefined) t.save = JSON2.parse (t.save);
                            if (t.save == undefined) t.save =new Array();
  
                            t.save.push ({
                                marchId:        marchId,
                                cityId:           cityId,
                                knightId:        knightId,
                                toTileLevel:    toTileLevel,
                                returnUnixTime:    destinationUnixTime,
                                returnUnixTime:    returnUnixTime,
                                toXCoord:        toXCoord,
                                toYCoord:        toYCoord,
                                unit1Count:     units[1],
                                unit2Count:     units[2],
                                unit3Count:     units[3],
                                unit4Count:     units[4],
                                unit5Count:     units[5],
                                unit6Count:     units[6],
                                unit7Count:     units[7],
                                unit8Count:     units[8],
                                unit9Count:     units[9],
                                unit10Count:     units[10],
                                unit11Count:     units[11],
                                unit12Count:     units[12],
                            });
                            
                            var troops = Seed.units["city" + cityId];
                            for (var u = 1; u <= 12; ++u) {
                                var troop_number = parseInt(rslt["unit" + u + "Return"]);
                                if (isNaN(troop_number)) {
                                    troop_number = parseInt(Seed.units["city" + cityId]["unt" + u]);
                                } else troop_number = parseInt(rslt["unit" + u + "Return"]) + parseInt(Seed.units["city" + cityId]["unt" + u]);
                                troops["unt" + u] = troop_number;
                            }
                            
                            setTimeout (function (){GM_setValue ('SavedRaids_'+serverID, JSON2.stringify(t.save));}, 0);
                          unsafeWindow.cityinfo_army();      
                          setTimeout(unsafeWindow.update_seed_ajax, 250);
                        }
                 },
         });
                 t.stopprogress = count * (100/t.count);
                 actionLog('Deleting: '+ Seed.cities[city][1]);
                 if (t.stopprogress.toFixed(0) == 100) {
                      t.stopprogress = 0;
                      t.GetRaids(cityId);
      }    
         
},
  
      
  DeleteCityRaids : function (){
          var t = Tabs.Raid;
          alert('This button needs to be added...');
          /*var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
  
          
          params.pf = 0;
          params.ctrl = 'BotManager';
          params.action = 'stopAll';
          params.settings = {};
  
            params.settings.cityId = t.cityId;
                    
           new AjaxRequest2(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
                        method: "post",
                       parameters: params,
                       loading: true,
                       onSuccess: function(transport){
                          var rslt = eval("(" + transport.responseText + ")");
                            if (rslt.ok) {
                                    
                            }
                       },
               }); */       
      },
        
        
  AddRaid : function (Id){
        var t = Tabs.Raid;
        var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
        update = {};
        
        params.pf = 0;
        params.ctrl = 'BotManager';
        params.action = 'saveMarch';
        params.settings = {};
        params.queue = {0:{botMarches:{botMarchStatus:1,botState:1},cityMarches:{}}};
        
        for (y in t.save){
            if (t.save[y]['marchId'] == Id){
                params.settings.cityId = t.save[y]['cityId'];
                params.queue[0].cityMarches.knightId = t.save[y]['knightId']; //parseInt(document.getElementById('AddKnights').value);
                params.queue[0].cityMarches.toXCoord = t.save[y]['toXCoord'];
                params.queue[0].cityMarches.toYCoord = t.save[y]['toYCoord'];
                params.queue[0].cityMarches.unit0Count = 0;
                params.queue[0].cityMarches.unit1Count = t.save[y]['unit1Count'];
                params.queue[0].cityMarches.unit2Count = t.save[y]['unit2Count'];
                params.queue[0].cityMarches.unit3Count = t.save[y]['unit3Count'];
                params.queue[0].cityMarches.unit4Count = t.save[y]['unit4Count'];
                params.queue[0].cityMarches.unit5Count = t.save[y]['unit5Count'];
                params.queue[0].cityMarches.unit6Count = t.save[y]['unit6Count'];
                params.queue[0].cityMarches.unit7Count = t.save[y]['unit7Count'];
                params.queue[0].cityMarches.unit8Count = t.save[y]['unit8Count'];
                params.queue[0].cityMarches.unit9Count = t.save[y]['unit9Count'];
                params.queue[0].cityMarches.unit10Count = t.save[y]['unit10Count'];
                params.queue[0].cityMarches.unit11Count = t.save[y]['unit12Count'];
                params.queue[0].cityMarches.unit12Count = t.save[y]['unit12Count'];
            }
        }    
         
         
         new AjaxRequest2(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
                      method: "post",
                     parameters: params,
                     loading: true,
                     onSuccess: function(transport){
                        var rslt = eval("(" + transport.responseText + ")");
                          if (rslt.ok) {
                                t.GetRaids(params.settings.cityId);
                                  unsafeWindow.cityinfo_army();
                                    setTimeout(unsafeWindow.update_seed_ajax, 250);
                                    for (yy=0;yy<t.save.length;yy++){
                                        if (t.save[yy]['marchId'] == Id){
                                              t.save.splice (yy,1);
                                        }    
                                    }
                                    var serverID = getServerId();
                                    setTimeout (function (){GM_setValue ('SavedRaids_'+serverID, JSON2.stringify(t.save));}, 0);
                                    t.paint();
                         } else {
                                 logit('Error: '+ rslt.msg);      
                         }
                     },
             });        
    },
    
        
  getKnights : function(cityId){
         var t = Tabs.Raid;
         var knt = new Array();
         var status ="";
         for (k in Seed.knights['city' + cityId]){
                 if ( Seed.leaders['city' + cityId]["resourcefulnessKnightId"] != Seed.knights['city' + cityId][k]["knightId"] && Seed.leaders['city' + cityId]["politicsKnightId"] != Seed.knights['city' + cityId][k]["knightId"] && Seed.leaders['city' + cityId]["combatKnightId"] != Seed.knights['city' + cityId][k]["knightId"] && Seed.leaders['city' + cityId]["intelligenceKnightId"] != Seed.knights['city' + cityId][k]["knightId"]){
                    if (Seed.knights['city' + cityId][k]["knightStatus"] == 1 ) status = "Free";
                    else status = "Marching";
                     knt.push ({
                         Name:   Seed.knights['city' + cityId][k]["knightName"],
                         Combat:    parseInt(Seed.knights['city' + cityId][k]["combat"]),
                         ID:        Seed.knights['city' + cityId][k]["knightId"],
                         Status: status,
                     });
                 }
         }
         knt = knt.sort(function sort(a,b) {a = a['Combat'];b = b['Combat'];return a == b ? 0 : (a > b ? -1 : 1);});
         document.getElementById('AddKnights').options.length=0;
          var o = document.createElement("option");
          o.text = '--Choose a Knight--';
          o.value = 0;
          document.getElementById("AddKnights").options.add(o);
         for (k in knt){
                  if (knt[k]["Name"] !=undefined){
                      var o = document.createElement("option");
                      o.text = (knt[k]["Name"] + ' (' + knt[k]["Combat"] +') (' + knt[k]["Status"] +')');
                      o.value = knt[k]["ID"];
                      document.getElementById("AddKnights").options.add(o);
                  }
          }
      },
  
    
  clickCitySelect : function (city){
      var t = Tabs.Raid;
      t.cityId = city['id'];
      t.GetRaids(t.cityId);
  },
  
  checkRaids : function (){
    var t = Tabs.Raid;
    var now = unixTime();
    if(!Options.RaidRunning) return;
    if ( (now - Options.RaidReset) > 7200 ) {
        Options.RaidReset = now;
        saveOptions();
        for (g=0;g<Seed.cities.length;g++){
                t.citiesdone = "";
                setTimeout(t.resetRaids, (1500*g), Seed.cities[g][0],Seed.cities[g][1]);
        }
        setTimeout(t.postLog, 30000);
    }
    t.raidtimer = setTimeout(t.checkRaids, 900000);
  },
  
  GetRaids : function(cityId){
          var t = Tabs.Raid;
          var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
                    
          params.pf = 0;
          params.ctrl = 'BotManager';
          params.action = 'getMarches';
          params.settings = {};
          params.settings.cityId = cityId;
          
          	
           new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
                   method: "post",
                   parameters: params,
                   loading: true,
                   onSuccess: function(transport){
                      var rslt = eval("(" + transport.responseText + ")");
                        if (rslt.ok) {
                            t.rslt = rslt;
                              t.paint();
                              unsafeWindow.cityinfo_army();
                              setTimeout(unsafeWindow.update_seed_ajax, 250);
                          }
                   },
           });
  },
  
  
  resetRaids : function(cityId,cityName){
          var t = Tabs.Raid;
          var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
                    
          params.pf = 0;
          params.ctrl = 'BotManager';
          params.action = 'resetRaidTimer';
        params.settings = {};
          params.settings.cityId = cityId;
          
          
           new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
                   method: "post",
                   parameters: params,
                 loading: true,
                 onSuccess: function(transport){
                    var rslt = eval("(" + transport.responseText + ")");
                        if (rslt.ok) {
                            unsafeWindow.cityinfo_army();
                            setTimeout(unsafeWindow.update_seed_ajax, 250);
                            t.citiesdone += cityName + ' ';
                        }
                 },
           });
  },
  
  postLog : function (){
          var t = Tabs.Raid;
          actionLog('Reset Raidtimer: ' + t.citiesdone);
  },
  
  sendreport: function(){
      var t = Tabs.Raid;
      if(!Options.foodreport) return;
      var now = new Date().getTime()/1000.0;
      now = now.toFixed(0);
      if (now < (parseInt(Options.LastReport)+(Options.MsgInterval*60*60))) return;
    
    var total = 0;
    var message = 'Raid Stats: %0A';
    message += '%0A Food Gain (for '+ Options.MsgInterval +' hour of raiding) %0A';
    for (q=1;q<=Seed.cities.length;q++){
        var cityID = 'city' + Seed.cities[q-1][0];
        var gain = parseInt(Seed.resources[cityID]['rec1'][0] / 3600) - Options.Foodstatus[q];
        message+= Seed.cities[q-1][1] + ': Start: ' + addCommas(Options.Foodstatus[q]) + ' End :' + addCommas(parseInt(Seed.resources[cityID]['rec1'][0] / 3600)) + ' Gain: ';
        message += addCommas(gain)  + '%0A';
        total += gain;
        Options.Foodstatus[q] = parseInt(Seed.resources[cityID]['rec1'][0] / 3600);
    }
    message += '%0A Total food gain : '+addCommas(total)+'%0A';
    
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.emailTo = Seed.player['name'];
    params.subject = "Raid Overview";
    params.message = message;
    params.requestType = "COMPOSED_MAIL";
    
    new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getEmail.php" + unsafeWindow.g_ajaxsuffix, {
        method: "post",
        parameters: params,
        onSuccess: function (message) {
            var rslt = eval("(" + message.responseText + ")");
            if (rslt.ok) {
            } else {
            }
        },
        onFailure: function () {
        },
    });
    
    Options.LastReport = now;
    saveOptions();
  },
  
  toggleRaidState : function (){
      var t = Tabs.Raid;
      if(Options.RaidRunning){
          Options.RaidRunning = false;
          t.raidtimer = null;
          document.getElementById('pbRaidStart').value = 'Auto Reset = OFF';
      } else {
          Options.RaidRunning = true;
          t.raidtimer = setTimeout(t.checkRaids, 5000);
          document.getElementById('pbRaidStart').value = 'Auto Reset = ON';
      }
      saveOptions();
  },

  hide : function (){
  },

  show : function (){
  },
 };


/*************************** Auto Craft Tab *************************************/
var CraftTabActive = false;

Tabs.AutoCraft = {
    tabOrder: 20,
    tabLabel: "Auto Craft",
    myDiv: null,
    init: function(div){
    	var t = Tabs.AutoCraft;
      	t.myDiv = div;
      	unsafeWindow.CraftClick = t.CraftClick;
      	if (CraftOptions.cap=="") t.MakeOptions();
      	if (CraftOptions.until=="") t.MakeExtraOptions();
      	var m = '<DIV class=pbStat>AUTOMATED CRAFTING FUNCTION</div><TABLE width=100% height=0% class=pbTab><TR align="center">';
      	m+='<TD><INPUT class="buttonDash_'+ (CraftOptions.Running?'ON':'OFF') +'" id=pbCraftRunning type=submit value="'+translate("Crafting")+' = '+ (CraftOptions.Running?'ON':'OFF')+'"></td>';
      	m+='<TD><span id=CraftFrom></span></td></tr>';
      	m+='</tr></table><DIV id=CraftStats></div><DIV id=CraftBody></div>';
      	t.myDiv.innerHTML = m;
      	t.from = new CdispCityPicker ('pbCraftFrom', document.getElementById('CraftFrom'), true, t.ClickCitySelect, 0); 
      	t.PaintCraftItems();
      	document.getElementById('pbCraftRunning').addEventListener('click', t.toggleStateRunning , false);
	},
	toggleStateRunning: function(obj){
		var t = Tabs.AutoCraft;
		if (CraftOptions.Running == true) {
			CraftOptions.Running = false;
			saveCraftOptions();
			if (document.getElementById('pbCraftRunning')) {document.getElementById('pbCraftRunning').value = "Crafting = OFF";document.getElementById('pbCraftRunning').setAttribute("class", "buttonDash_OFF");}
			if (document.getElementById('CraftToggle')) {document.getElementById('CraftToggle').value = "Crafting = OFF";document.getElementById('CraftToggle').setAttribute("class", "buttonDash_OFF");}
		}
		else {
		      CraftOptions.Running = true;
		      saveCraftOptions();
		      if (document.getElementById('pbCraftRunning')) {document.getElementById('pbCraftRunning').value = "Crafting = ON";document.getElementById('pbCraftRunning').setAttribute("class", "buttonDash_ON");}
		      if (document.getElementById('CraftToggle')) {document.getElementById('CraftToggle').value = "Crafting = ON";document.getElementById('CraftToggle').setAttribute("class", "buttonDash_ON");}
		      t.CraftCylce();
		}
		t.PaintCraftItems();
    },
	PaintStats:function(){
		var t = Tabs.AutoCraft;
		var m='<TABLE class=pbTab width=95%><TR><TD><B>City:</b></td>';
		var now=unixTime();
		for (var ii=0;ii<Seed.cities.length;ii++) m+='<TD style="text-align:right;"><INPUT id="CraftCity_'+Seed.cities[ii][0]+'" '+(CraftOptions.City[ii]?'checked=true':'unchecked=true')+' type=checkbox><B> '+ Seed.cities[ii][1] + '</b></td>';
		m+='</tr><TR><TD><B>Item:</b></td>';	
		for (var ii=0;ii<Seed.cities.length;ii++) {
			if (Seed.queue_craft['city'+Seed.cities[ii][0]][0]==undefined) m+='<TD style="text-align:right;">----</td>';
			 else {
			 	for (var y=0;y<unsafeWindow.recipelist['1'].length;y++) if (unsafeWindow.recipelist['1'][y].recipe_id == Seed.queue_craft['city'+Seed.cities[ii][0]][0].recipeId) m+='<TD style="text-align:right;">'+ unsafeWindow.itemlist['i'+unsafeWindow.recipelist['1'][y].output_item_id].name + '</td>';
			 	for (var y=0;y<unsafeWindow.recipelist['3'].length;y++) if (unsafeWindow.recipelist['3'][y].recipe_id == Seed.queue_craft['city'+Seed.cities[ii][0]][0].recipeId) m+='<TD style="text-align:right;">'+ unsafeWindow.itemlist['i'+unsafeWindow.recipelist['3'][y].output_item_id].name + '</td>';
			 }
		}
		m+='</tr><TR><TD><B>Time:</b></td>';	
		for (var ii=0;ii<Seed.cities.length;ii++) {
     		if (getCityBuilding(Seed.cities[ii][0],20).count>0) {
     			if (Seed.queue_craft['city'+Seed.cities[ii][0]]!=null && Seed.queue_craft['city'+Seed.cities[ii][0]].length>0) {
     				var CraftTime = Seed.queue_craft['city'+Seed.cities[ii][0]][0].craftingEtaUnixTime - now;
     				if (CraftTime<0) CraftTime=0;
     				if (CraftTime == 0) m+='<TD style="text-align:right;"><FONT color=red>0s</font></td>';
					 else m+='<TD style="text-align:right;">'+timestr(CraftTime)+'</td>';
     			} else m+='<TD style="text-align:right;"><FONT color=red>0s</font></td>';
     		} else m+='<TD style="text-align:right;">----</td>';
     	}
     	m+='</tr><TR><TD><B>Aetherstones:</b></td>';
     	for (var ii=0;ii<Seed.cities.length;ii++) m+='<TD style="text-align:right;">'+ addCommas(parseInt(Seed.resources['city'+Seed.cities[ii][0]]['rec5'][0])) + '</td>';
     	m+='</tr></table>';
     	document.getElementById('CraftStats').innerHTML = m;
     	for (var ii=0;ii<Seed.cities.length;ii++) document.getElementById('CraftCity_'+Seed.cities[ii][0]).addEventListener('click', t.saveCraftOptions , false);
	},
	PaintCraftItems:function(){
		var t=Tabs.AutoCraft;
		var m='<DIV class=pbStat>ITEM LIST (Click on item icon to manualy craft!)</div><DIV id="CraftItems" style="max-height:600px;overflow:auto;">';
      	m+= '<TABLE class=pbTab width=95%><TR valign=top><TD><DIV id=CraftLeft></div></td><TD width=30px>&nbsp</td><TD style="width:30px;border-left: 1px solid black;">&nbsp</td><TD><DIV id=CraftRight></div></td></tr></table>';  	
      	var left=right= '<TABLE width=100% class=pbTab>';
      	var Counter=1;
      	for(var i=0; i < unsafeWindow.recipelist[1].length; i++) {
      	 	Counter++;
      	 	var cont ='<TR><TD style="width:60px;vertical-align:middle" rowspan="3"><a class=hasTooltip onclick="CraftClick('+i+',1)"><img style="width:50px" src="http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/70/'+ unsafeWindow.recipelist[1][i].output_item_id + '.jpg">';
      	 	cont+='<SPAN><img style="width:25px;vertical-align:middle;" src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/aetherstone_70.png">&nbsp'+addCommas(parseInt(unsafeWindow.recipelist[1][i].input.resources[1]))+'</span></a></td></tr>';
      	 	cont+='<TR valign=top><TD colspan=2>'+((Seed.items['i'+unsafeWindow.recipelist[1][i].output_item_id])?Seed.items['i'+unsafeWindow.recipelist[1][i].output_item_id]:0)+' '+unsafeWindow.itemlist['i'+unsafeWindow.recipelist[1][i].output_item_id].name+'</td>';
      	 	cont+='<TD colspan=4><INPUT id="Craft_'+unsafeWindow.recipelist[1][i].recipe_id+'" '+(CraftOptions.enabled[unsafeWindow.recipelist[1][i].recipe_id]?'checked=true':'unchecked=true')+' type=checkbox>';
      	 	cont+='<SELECT id="CraftMethod_'+unsafeWindow.recipelist[1][i].recipe_id+'"><OPTION value="false">Craft</option><OPTION value="true">Craft untill</option></select>';
      	 	cont+='<INPUT id="CraftNumber_'+unsafeWindow.recipelist[1][i].recipe_id+'" type=text size=4 maxlength=4 value="'+CraftOptions.cap[unsafeWindow.recipelist[1][i].recipe_id]+'"> items</td></tr><TR>';
      	 	for (var y in unsafeWindow.recipelist[1][i].input.items) if(y>0) {
      	 		var inventory = Seed.items['i'+y];
      	 		if (inventory==undefined) inventory=0;
      	 		color = ((parseInt(unsafeWindow.recipelist[1][i].input.items[y]) <= inventory)?'BLACK':'RED');
      	 		cont+='<TD style="text-align:center"><a class="hasTooltip"><img style="width:25px;vertical-align:middle;" src="http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/70/'+ y + '.jpg">';
      	 		cont+='<SPAN>'+unsafeWindow.itemlist['i'+y].name+'</span></a>';
      	 		cont+='<FONT color='+color+'> '+unsafeWindow.recipelist[1][i].input.items[y]+'/'+inventory+'</font></td>';
      	 	}
      	 	cont+='</tr>';
      	 	if (Counter%2==0) left+=cont;
      	 	 else right+=cont;
      	}
		for(var i=0; i < unsafeWindow.recipelist[3].length; i++) {
      	 	Counter++;
      	 	var cont ='<TR><TD style="width:60px;vertical-align:middle" rowspan="3"><a class=hasTooltip onclick="CraftClick('+i+',1)"><img style="width:50px" src="http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/70/'+ unsafeWindow.recipelist[3][i].output_item_id + '.jpg">';
      	 	cont+='<SPAN><img style="width:25px;vertical-align:middle;" src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/aetherstone_70.png">&nbsp'+addCommas(parseInt(unsafeWindow.recipelist[3][i].input.resources[1]))+'</span></a></td></tr>';
      	 	cont+='<TR valign=top><TD colspan=2>'+((Seed.items['i'+unsafeWindow.recipelist[3][i].output_item_id])?Seed.items['i'+unsafeWindow.recipelist[3][i].output_item_id]:0)+' '+unsafeWindow.itemlist['i'+unsafeWindow.recipelist[3][i].output_item_id].name+'</td>';
      	 	cont+='<TD colspan=4><INPUT id="Craft_'+unsafeWindow.recipelist[3][i].recipe_id+'" '+(CraftOptions.enabled[unsafeWindow.recipelist[3][i].recipe_id]?'checked=true':'unchecked=true')+' type=checkbox>';
      	 	cont+='<SELECT id="CraftMethod_'+unsafeWindow.recipelist[3][i].recipe_id+'"><OPTION value="false">Craft</option><OPTION value="true">Craft untill</option></select>';
      	 	cont+='<INPUT id="CraftNumber_'+unsafeWindow.recipelist[3][i].recipe_id+'" type=text size=4 maxlength=4 value="'+CraftOptions.cap[unsafeWindow.recipelist[3][i].recipe_id]+'"> items</td></tr><TR>';
      	 	for (var y in unsafeWindow.recipelist[3][i].input.items) if(y>0) {
      	 		var inventory = Seed.items['i'+y];
      	 		if (inventory==undefined) inventory=0;
      	 		color = ((parseInt(unsafeWindow.recipelist[3][i].input.items[y]) <= inventory)?'BLACK':'RED');
      	 		cont+='<TD style="text-align:center"><a class="hasTooltip"><img style="width:25px;vertical-align:middle;" src="http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/70/'+ y + '.jpg">';
      	 		cont+='<SPAN>'+unsafeWindow.itemlist['i'+y].name+'</span></a>';
      	 		cont+='<FONT color='+color+'> '+unsafeWindow.recipelist[3][i].input.items[y]+'/'+inventory+'</font></td>';
      	 	}
      	 	cont+='</tr>';
      	 	if (Counter%2==0) left+=cont;
      	 	 else right+=cont;
      	}
      	left+='</table>';
      	right+='</table>';
      	document.getElementById('CraftBody').innerHTML = m;
      	document.getElementById('CraftLeft').innerHTML = left;
      	document.getElementById('CraftRight').innerHTML = right;
    	for(var i=0; i < unsafeWindow.recipelist[1].length; i++) {
    		document.getElementById('Craft_'+unsafeWindow.recipelist[1][i].recipe_id).addEventListener('click', t.saveCraftOptions , false);
    		document.getElementById('CraftMethod_'+unsafeWindow.recipelist[1][i].recipe_id).addEventListener('change', t.saveCraftOptions , false);
    		document.getElementById('CraftNumber_'+unsafeWindow.recipelist[1][i].recipe_id).addEventListener('change', t.saveCraftOptions , false);
    		document.getElementById('CraftMethod_'+unsafeWindow.recipelist[1][i].recipe_id).value= CraftOptions.until[unsafeWindow.recipelist[1][i].recipe_id];

    	}
    	for(var i=0; i < unsafeWindow.recipelist[3].length; i++) {
    		document.getElementById('Craft_'+unsafeWindow.recipelist[3][i].recipe_id).addEventListener('click', t.saveCraftOptions , false);
    		document.getElementById('CraftMethod_'+unsafeWindow.recipelist[3][i].recipe_id).addEventListener('change', t.saveCraftOptions , false);
    		document.getElementById('CraftNumber_'+unsafeWindow.recipelist[3][i].recipe_id).addEventListener('change', t.saveCraftOptions , false);
    		document.getElementById('CraftMethod_'+unsafeWindow.recipelist[3][i].recipe_id).value= CraftOptions.until[unsafeWindow.recipelist[3][i].recipe_id];
    	}	 
	},
	saveCraftOptions:function(){
		var t=Tabs.AutoCraft;
		for (var ii=0;ii<Seed.cities.length;ii++) CraftOptions.City[ii] = document.getElementById('CraftCity_'+Seed.cities[ii][0]).checked;
		for (var i=0;i<unsafeWindow.recipelist[1].length;i++) {
			CraftOptions.enabled[unsafeWindow.recipelist[1][i].recipe_id] = document.getElementById('Craft_'+unsafeWindow.recipelist[1][i].recipe_id).checked;
			CraftOptions.until[unsafeWindow.recipelist[1][i].recipe_id] = document.getElementById('CraftMethod_'+unsafeWindow.recipelist[1][i].recipe_id).value;
			CraftOptions.cap[unsafeWindow.recipelist[1][i].recipe_id] = document.getElementById('CraftNumber_'+unsafeWindow.recipelist[1][i].recipe_id).value;		
		}
		for (var i=0;i<unsafeWindow.recipelist[3].length;i++) {
			CraftOptions.enabled[unsafeWindow.recipelist[3][i].recipe_id] = document.getElementById('Craft_'+unsafeWindow.recipelist[3][i].recipe_id).checked;
			CraftOptions.until[unsafeWindow.recipelist[3][i].recipe_id] = document.getElementById('CraftMethod_'+unsafeWindow.recipelist[3][i].recipe_id).value;
			CraftOptions.cap[unsafeWindow.recipelist[3][i].recipe_id] = document.getElementById('CraftNumber_'+unsafeWindow.recipelist[3][i].recipe_id).value;
		}
    	saveCraftOptions();
	},
 	CraftClick:function(recipe,categoryId){
 		var t=Tabs.AutoCraft;
 		item = unsafeWindow.recipelist[categoryId][recipe];
 		if (Seed.queue_craft['city'+t.from.city.id].length>0)  {t.AlertPopup('You are already crafting in this city.');return;}
 		if (parseInt(item.input.resources['1']) >= (Seed.resources['city'+t.from.city.id]['rec5'][0])) {t.AlertPopup('You don\'t have enough Aetherstones.');return;}
 		for (var y in item.input.items) if(y>0) if (Seed.items['i'+y] < parseInt(item.input.items[y])) {t.AlertPopup('You don\'t have all the ingredients.');return;}
 		if (getCityBuilding(t.from.city.id,20).maxLevel < parseInt(item.requirements.building)) {t.AlertPopup('Spire level not high enough.');return;}
		if (getCityBuilding(t.from.city.id,20).count==0) return; 
 		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
        params.ctrl = 'Crafting';
        params.action = 'craft';
        params.cityId = t.from.city.id;
        params.itemId = item.output_item_id;
        params.categoryId = categoryId;
        params.recipeId = item.recipe_id;
        params.insurance = false;
        new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
            method: "post",
            parameters: params,
            onSuccess: function (transport) {
              var rslt = eval("(" + transport.responseText + ")");
              if(rslt.ok) if(rslt.status == 'success') {
              	actionLog("Craft: " + rslt.status + " - " + item.name);
              	t.PaintCraftItems();
              	var add={};
               	add.recipeId=params.recipeId;
               	add.craftingUnixTime=rslt.time.startTime;
               	add.craftingEtaUnixTime=rslt.time.endTime;
               	add.craftingId=rslt.craftingId;
               	add.categoryId=categoryId;
               	add.recipeIndex=null;
               	unsafeWindow.seed.queue_craft["city"+params.cityId].push(add);
               	for (var y in item.input.items) unsafeWindow.seed.items['i'+y]-= parseInt(item.input.items[y]);
               	unsafeWindow.seed.resources['city'+params.cityId]['rec5'][0] -= item.input.resources['1'];
               	if (unsafeWindow.currentcityid == params.cityId) if (unsafeWindow.jQuery("#queue_head_building").hasClass("sel")) unsafeWindow.queue_changetab_building();
              } else {
              		for (var y in item.input.items) unsafeWindow.seed.items['i'+y]-= parseInt(item.input.items[y]);
               		unsafeWindow.seed.resources['city'+params.cityId]['rec5'][0] -= item.input.resources['1'];
               		unsafeWindow.seed.items['i'+item.consolation_item_id]++;
               		var msg = "Craft failed";
               		if (rslt.errorMessage) msg +=' (' +rslt.errorMessage+')';
               		if (item.consolation_item_id) msg+= ', you get a <img width=25 src="http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/70/'+ parseInt(item.consolation_item_id) + '.jpg">';
               		t.AlertPopup(msg);
              }
              t.PaintCraftItems();
            },
            onFailure: function () {
            },
        });   
 	},
 	AlertPopup:function(msg){
 		var t=Tabs.AutoCraft;
 		var pop = new pbPopup ('CraftAlert', 0, 0, 500, 100, true);
	    pop.centerMe (mainPop.getMainDiv());  
	    pop.getMainDiv().innerHTML = '<BR><DIV style="text-align:center"><B>'+msg+'</b></div><BR><BR><BR>';
	    pop.getTopDiv().innerHTML = '<CENTER><B>Crafting Alert</b></center>';
	    pop.show (true);
 	},
 	CraftCylce:function(){
 		var t=Tabs.AutoCraft;
 		for (var i=0;i<Seed.cities.length;i++) {
 			if (Seed.queue_craft['city'+Seed.cities[i][0]].length>0){
	 			var check = parseInt(Seed.queue_craft['city'+Seed.cities[i][0]][0].craftingEtaUnixTime)+5 - unixTime();
	 			var done = ((check>0)?false:true);
	 			if (done) Seed.queue_craft["city" + Seed.cities[i][0]].splice(0, 1);
	 		}
 		}
 		for (var i=0;i<Seed.cities.length;i++) if (Seed.queue_craft['city'+Seed.cities[i][0]].length==0) setTimeout(t.CheckCity,2500*i,i);
 	},
 	CheckCity:function(city){
 		var t=Tabs.AutoCraft;
 		for (var y=unsafeWindow.recipelist[3].length-1;y>=0;y--){
 				var action = CraftOptions.until[unsafeWindow.recipelist[3][y].recipe_id];
	 			var ok = t.IngredientsCheck(unsafeWindow.recipelist[3][y],Seed.cities[city][0]);
	 			if (ok) {t.doCraft(unsafeWindow.recipelist[3][y],Seed.cities[city][0],Seed.cities[city][1],city,2,action);return;}
 		}
 		for (var y=unsafeWindow.recipelist[1].length-1;y>=0;y--){
  				var action = CraftOptions.until[unsafeWindow.recipelist[1][y].recipe_id];
	 			var ok = t.IngredientsCheck(unsafeWindow.recipelist[1][y],Seed.cities[city][0]);
	 			if (ok) {t.doCraft(unsafeWindow.recipelist[1][y],Seed.cities[city][0],Seed.cities[city][1],city,1,action);return;}
 		}
 	},
 	IngredientsCheck:function(item,cityId){
 		var t=Tabs.AutoCraft;
 		var inventory = t.getInventory(item);
 		if (CraftOptions.City[cityId]==false) return false;
 		if (CraftOptions.enabled[item.recipe_id]==false) return false;		 		
 		if (parseInt(item.input.resources['1']) >= (Seed.resources['city'+cityId]['rec5'][0])) return false;
 		for (var y in item.input.items) if(y>0) if (Seed.items['i'+y] < parseInt(item.input.items[y])) return false;
 		if (getCityBuilding(cityId,20).maxLevel < parseInt(item.requirements.building)) return false;
		if (getCityBuilding(cityId,20).count==0) return false;	
		if (parseInt(CraftOptions.cap[item.recipe_id])==0) return false;
		if (CraftOptions.until[item.recipe_id]=="true" && inventory >= parseInt(CraftOptions.cap[item.recipe_id])) return false;		
		return true;
 	},
 	getInventory:function(item){
 		var inventory = parseInt(Seed.items['i'+item.output_item_id]);
 		if (inventory==undefined) inventory =0;
 		for (var i=0;i<Seed.cities.length;i++) if (Seed.queue_craft['city'+Seed.cities[i][0]].length>0) if (parseInt(Seed.queue_craft['city'+Seed.cities[i][0]][0].recipeId) == parseInt(item.recipe_id)) inventory++;
 		return inventory;
 	},
 	doCraft:function(item,cityId,cityName,city,categoryId,action){
 		var t=Tabs.AutoCraft;
 		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
        params.ctrl = 'Crafting';
        params.action = 'craft';
        params.cityId = cityId;
        params.itemId = item.output_item_id;
        params.categoryId = categoryId;
        params.recipeId = item.recipe_id;
        params.insurance = false;
        
        new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
            method: "post",
            parameters: params,
            onSuccess: function (transport) {
              var rslt = eval("(" + transport.responseText + ")");
              if(rslt.ok) if(rslt.status == 'success') {
              	actionLog("Craft in " +cityName + ': ' + rslt.status + " - " + item.name);
              	var add={};
               	add.recipeId=params.recipeId;
               	add.craftingUnixTime=rslt.time.startTime;
               	add.craftingEtaUnixTime=rslt.time.endTime;
               	add.craftingId=rslt.craftingId;
               	add.categoryId=categoryId;
               	add.recipeIndex=null;
               	unsafeWindow.seed.queue_craft["city"+params.cityId].push(add);
               	for (var y in item.input.items) unsafeWindow.seed.items['i'+y]-= parseInt(item.input.items[y]);
               	unsafeWindow.seed.resources['city'+params.cityId]['rec5'][0] -= item.input.resources['1'];
               	if (unsafeWindow.currentcityid == params.cityId) if (unsafeWindow.jQuery("#queue_head_building").hasClass("sel")) unsafeWindow.queue_changetab_building();
               	if (action=="false") CraftOptions.cap[item.recipe_id]--;
               	saveCraftOptions();
              } else {
              		for (var y in item.input.items) unsafeWindow.seed.items['i'+y]-= parseInt(item.input.items[y]);
               		unsafeWindow.seed.resources['city'+params.cityId]['rec5'][0] -= item.input.resources['1'];
               		unsafeWindow.seed.items['i'+item.consolation_item_id]++;
               		var msg = "Craft failed in " + cityName + " - " + item.name;
               		if (rslt.errorMessage) msg +=' (' +rslt.errorMessage+')';
               		if (item.consolation_item_id) msg+= ', you get a '+ unsafeWindow.itemlist['i'+item.consolation_item_id].name ;
               		actionLog(msg);
               		if (rslt.errorCode==null && rslt.errorMessage==null)t.CheckCity(city);
              }
              if (CraftTabActive) t.PaintCraftItems();
            },
            onFailure: function () {
            },
        });   
 	},
 	MakeOptions:function(){
 		var items = {};
 		var cap = {};
 		for(var i=0; i < unsafeWindow.recipelist[1].length; i++) cap[unsafeWindow.recipelist[1][i].recipe_id] = 0;
 		for(var i=0; i < unsafeWindow.recipelist[3].length; i++) cap[unsafeWindow.recipelist[3][i].recipe_id] = 0;
 		CraftOptions.cap= cap;
 		saveCraftOptions();
 	},
 	MakeExtraOptions:function(){
 		var enabled = {};
 		var until = {};
 		for(var i=0; i < unsafeWindow.recipelist[1].length; i++) enabled[unsafeWindow.recipelist[1][i].recipe_id] = false;
 		for(var i=0; i < unsafeWindow.recipelist[3].length; i++) enabled[unsafeWindow.recipelist[3][i].recipe_id] = false;
 		for(var i=0; i < unsafeWindow.recipelist[1].length; i++) until[unsafeWindow.recipelist[1][i].recipe_id] = true;
 		for(var i=0; i < unsafeWindow.recipelist[3].length; i++) until[unsafeWindow.recipelist[3][i].recipe_id] = true;
 		CraftOptions.enabled= enabled;
 		CraftOptions.until= until;
 		saveCraftOptions();
 	},
    hide : function (){CraftTabActive = false;},
	show : function (){CraftTabActive = true;},  
}



/*********************************  Cresting Tab ***********************************/
 Tabs.Crest = {
  tabOrder : 70,
  myDiv : null,
  rallypointlevel:null,
  error_code: 0,
  knt:{},

     
  init : function (div){
    var t = Tabs.Crest;
    t.myDiv = div;
    var selbut=0;
    var m = '<DIV id=pbTowrtDivF class=pbStat>AUTOMATED CRESTING FUNCTION</div><TABLE id=pbcrestfunctions width=100% height=0% class=pbTab><TR align="center">';
    m+='<TD><INPUT class="buttonDash_'+ (CrestOptions.Running?'ON':'OFF') +'" id=Cresttoggle type=submit value="'+translate("Crest")+' = '+ (CrestOptions.Running?'ON':'OFF')+'"></td>';
    m += '<TD><INPUT id=CrestHelp type=submit class=pbButton value="HELP"></td><TD>Rallypoint options in options tab!</td></table>';
    m += '<DIV id=pbOpt class=pbStat>CRESTING OPTIONS</div>';
    m += '<B>This tab crests 1 wild from 1 city with abandon!! TO CREST PLAYERS/BARBS/WILDS with 1 wave for TR items, use ATTACK TAB...</b><BR><BR>';
    m +='<TABLE id=pbcrestopt	 width=100% height=0% class=pbTab><TR align="center"></table>';
    m += '<DIV style="margin-bottom:10px;">Crest from city: <span id=crestcity></span></div>';    
    m += '<TABLE class=pbTab><TR><TD>Wild coords: X:<INPUT id=pbcrestx type=text size=3 maxlength=3 value="'+CrestOptions.X+'"</td>';
    m += '<TD>Y:<INPUT id=pbcresty type=text size=3 maxlength=3 value="'+CrestOptions.Y+'"</td></tr></table>';   
    m += '<TABLE class=pbTab><TR><TD>Wave <b>1</b>: </td><TD><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_2_30.png></td><TD><INPUT id=R1MM type=text size=5 maxlength=5 value="'+CrestOptions.R1MM+'" (When left 0 it will not send out a first wave, for whatever reason you want to do that...)</td>';
    m += '</td><TD></td><TD><TD><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_10_30.png></td><TD><INPUT id=R1Ball type=text size=5 maxlength=5 value="'+CrestOptions.R1Ball+'"</td>';
    m += '<TD><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_12_30.png></td><TD><INPUT id=R1Cat type=text size=5 maxlength=5 value="'+CrestOptions.R1Cat+'"</td></tr>';    
    m += '<TR><TD>Wave <b>2</b>: </td><TD><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_2_30.png></td><TD><INPUT id=R2MM type=text size=5 maxlength=5 value="'+CrestOptions.R2MM+'"</td>';
    m += '<TD><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_4_30.png></td><TD><INPUT id=R2Pike type=text size=5 maxlength=5 value="'+CrestOptions.R2Pike+'"</td>';
    m += '<TD><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_5_30.png></td><TD><INPUT id=R2Sword type=text size=5 maxlength=5 value="'+CrestOptions.R2Sword+'"</td>';
    m += '<TD><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_6_30.png></td><TD><INPUT id=R2Arch type=text size=5 maxlength=5 value="'+CrestOptions.R2Arch+'"</td>';
    m += '<TD><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_10_30.png></td><TD><INPUT id=R2Ball type=text size=5 maxlength=5 value="'+CrestOptions.R2Ball+'"</td>';
    m += '<TD><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_11_30.png></td><TD><INPUT id=R2Ram type=text size=5 maxlength=5 value="'+CrestOptions.R2Ram+'"</td>';
    m += '<TD><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_12_30.png></td><TD><INPUT id=R2Cat type=text size=5 maxlength=5 value="'+CrestOptions.R2Cat+'"</td></tr></table>';
    
    t.myDiv.innerHTML = m;
    
    for (var i=0;i<Seed.cities.length;i++){
		if (CrestOptions.CrestCity == Seed.cities[i][0]){
			selbut=i;
			break;
		}
	}
		
    t.tcp = new CdispCityPicker ('crestcityselect', document.getElementById('crestcity'), true, t.clickCitySelect, selbut);
    
    if (CrestOptions.CrestCity == 0) {
    	CrestOptions.CrestCity = t.tcp.city.id
    	saveCrestOptions();
    }
         
    document.getElementById('crestcity').addEventListener('click', function(){CrestOptions.CrestCity = t.tcp.city.id;saveCrestOptions();} , false);
    document.getElementById('Cresttoggle').addEventListener('click', function(){t.toggleCrestState(this)} , false);
    document.getElementById('CrestHelp').addEventListener('click', function(){t.helpPop();} , false);
    document.getElementById('pbcrestx').addEventListener('change', function(){
    	CrestOptions.X = document.getElementById('pbcrestx').value;
    	t.StopCrest();
    	saveCrestOptions();
    } , false);
    document.getElementById('pbcresty').addEventListener('change', function(){
    	CrestOptions.Y = document.getElementById('pbcresty').value;
    	t.StopCrest();
    	saveCrestOptions();
    } , false);
    document.getElementById('R1MM').addEventListener('change', function(){CrestOptions.R1MM = document.getElementById('R1MM').value; saveCrestOptions()} , false);
    document.getElementById('R1Ball').addEventListener('change', function(){CrestOptions.R1Ball = document.getElementById('R1Ball').value; saveCrestOptions()} , false);
    document.getElementById('R1Cat').addEventListener('change', function(){CrestOptions.R1Cat = document.getElementById('R1Cat').value; saveCrestOptions()} , false);
    document.getElementById('R2MM').addEventListener('change', function(){CrestOptions.R2MM = document.getElementById('R2MM').value; saveCrestOptions()} , false);
    document.getElementById('R2Pike').addEventListener('change', function(){CrestOptions.R2Pike = document.getElementById('R2Pike').value; saveCrestOptions()} , false);
    document.getElementById('R2Sword').addEventListener('change', function(){CrestOptions.R2Sword = document.getElementById('R2Sword').value; saveCrestOptions()} , false);
    document.getElementById('R2Arch').addEventListener('change', function(){CrestOptions.R2Arch = document.getElementById('R2Arch').value; saveCrestOptions()} , false);
    document.getElementById('R2Ball').addEventListener('change', function(){CrestOptions.R2Ball = document.getElementById('R2Ball').value; saveCrestOptions()} , false);
    document.getElementById('R2Ram').addEventListener('change', function(){CrestOptions.R2Ram = document.getElementById('R2Ram').value; saveCrestOptions()} , false);
    document.getElementById('R2Cat').addEventListener('change', function(){CrestOptions.R2Cat = document.getElementById('R2Cat').value; saveCrestOptions()} , false);
  },
  
  helpPop : function (){
    var helpText = '<BR>The crest tab is designed to attack one wild over and over again.<BR>';
    helpText += 'It will attack a wild in 2 waves, abandon it and start over.<BR>';
    helpText += 'So make sure u have 1 FREE SLOT in your castle for a wild!<BR>';
    helpText += 'Just fill in the coordinates, troops and hit "ON".<BR><BR>';
    helpText += 'Troop numers (from KOC WIKI):<BR>';
    helpText += '<A target="_tab" href="http://koc.wikia.com/wiki/Wilderness">More can be found on Koc Wikia</a>';
    helpText += '<TABLE width=100%><TR><TD>Level</td><TD>Wave 1</td><TD>Wave 2</td><TD>Troop loses</td><TD>Min. Fletching</td></tr>';
    helpText += '<TR><TD>1</td><TD>n/a</td><TD>160 MM</td><TD>12 MM</td><TD>0</td></tr>';
    helpText += '<TR><TD>1</td><TD>n/a</td><TD>80 archers</td><TD>None</td><TD>1+</td></tr>';
    helpText += '<TR><TD>2</td><TD>5 MM</td><TD>130 archers</td><TD>1st Wave</td><TD>2+</td></tr>';
    helpText += '<TR><TD>3</td><TD>10 MM</td><TD>520 archers</td><TD>1st Wave</td><TD>3+</td></tr>';
    helpText += '<TR><TD>4</td><TD>20 MM</td><TD>1600 archers</td><TD>1st Wave</td><TD>4+</td></tr>';
    helpText += '<TR><TD>5</td><TD>50 MM</td><TD>2200 archers</td><TD>1st Wave</td><TD>6+</td></tr>';
    helpText += '<TR><TD>6</td><TD>100 MM</td><TD>3000 archers</td><TD>1st Wave</td><TD>7+</td></tr>';
    helpText += '<TR><TD>7</td><TD>150 MM</td><TD>6000 archers</td><TD>1st Wave</td><TD>8+</td></tr>';
    helpText += '<TR><TD>8</td><TD>299 MM + 1Bal</td><TD>9000 archers + 900 Bal</td><TD>1st Wave + 1 Archer</td><TD>9+</td></tr>';
    helpText += '<TR><TD>9</td><TD>599 MM + 1Bal</td><TD>13000 archers + 900 Bal</td><TD>1st Wave + 2 Archer</td><TD>10</td></tr>';
    helpText += '<TR><TD>10</td><TD>1199 MM + 1Cat</td><TD>35000 archers + 2500 Cat</td><TD>1st Wave + 6 Archer + 50 Cat</td><TD>10</td></tr></table>';
    
    var pop = new pbPopup ('giftHelp', 0, 0, 585, 400, true);
    pop.centerMe (mainPop.getMainDiv());  
    pop.getMainDiv().innerHTML = helpText;
    pop.getTopDiv().innerHTML = '<CENTER><B>AIO Script Help: Cresting</b></center>';
    pop.show (true);
  },

  StopCrest: function(){
		CrestOptions.Running = false;
		if (document.getElementById('Cresttoggle')) {document.getElementById('Cresttoggle').value = "Crest = OFF";document.getElementById('Cresttoggle').setAttribute("class", "buttonDash_OFF");}
		if (document.getElementById('CrestToggleD')) {document.getElementById('CrestToggleD').value = "Crest = OFF";document.getElementById('CrestToggleD').setAttribute("class", "buttonDash_OFF");}
		ClearMarchQueue("Crest");
		saveCrestOptions();
  },

  toggleCrestState: function(obj){
		var t = Tabs.Crest;
        if (CrestOptions.Running == true) {
            CrestOptions.Running = false;
            if (document.getElementById('Cresttoggle')) {document.getElementById('Cresttoggle').value = "Crest = OFF";document.getElementById('Cresttoggle').setAttribute("class", "buttonDash_OFF");}
            if (document.getElementById('CrestToggleD')) {document.getElementById('CrestToggleD').value = "Crest = OFF";document.getElementById('CrestToggleD').setAttribute("class", "buttonDash_OFF");}
            ClearMarchQueue("Crest");
            saveCrestOptions();
        }
        else {
            CrestOptions.Running = true;
            if (document.getElementById('Cresttoggle')) {document.getElementById('Cresttoggle').value = "Crest = ON";document.getElementById('Cresttoggle').setAttribute("class", "buttonDash_ON");}
            if (document.getElementById('CrestToggleD')) {document.getElementById('CrestToggleD').value = "Crest = ON";document.getElementById('CrestToggleD').setAttribute("class", "buttonDash_ON");}
            saveCrestOptions();
        }
    },
    
    getAtkKnight : function(cityID){
     var t = Tabs.Crest;
     t.knt = new Array();
     for (k in Seed.knights[cityID]){
     		if (Seed.knights[cityID][k]["knightStatus"] == 1 && Seed.leaders[cityID]["resourcefulnessKnightId"] != Seed.knights[cityID][k]["knightId"] && Seed.leaders[cityID]["politicsKnightId"] != Seed.knights[cityID][k]["knightId"] && Seed.leaders[cityID]["combatKnightId"] != Seed.knights[cityID][k]["knightId"] && Seed.leaders[cityID]["intelligenceKnightId"] != Seed.knights[cityID][k]["knightId"]){
     			t.knt.push ({
     				Name:   Seed.knights[cityID][k]["knightName"],
     				Combat:	(parseInt(Seed.knights[cityID][k]["combat"])+((Seed.knights[cityID][k]["combatBoostExpireUnixtime"]>0)?(Math.floor(parseInt(Seed.knights[cityID][k]["combat"])*0.25)):0)),
     				ID:		Seed.knights[cityID][k]["knightId"],
     			});
     		}
     }
     t.knt = t.knt.sort(function sort(a,b) {a = a['Combat'];b = b['Combat'];return a == b ? 0 : (a > b ? -1 : 1);});
  },
  
  getRallypointLevel: function(cityId){
    var t = Tabs.Crest;
    for (var o in Seed.buildings[cityId]){
  	var buildingType = parseInt(Seed.buildings[cityId][o][0]);
  	var buildingLevel = parseInt(Seed.buildings[cityId][o][1]);
  	if (buildingType == 12) t.rallypointlevel=parseInt(buildingLevel);
     }
  },
  
  
  FirstRound: function(){
      var t = Tabs.Crest;
      var buzy = false;
      if (!CrestOptions.Running) return;
      cityID = 'city' + CrestOptions.CrestCity;
      if (parseInt(Seed.units[cityID]['unt2']) < CrestOptions.R1MM || parseInt(Seed.units[cityID]['unt10']) < CrestOptions.R1Ball || parseInt(Seed.units[cityID]['unt12']) < CrestOptions.R1Cat || parseInt(Seed.units[cityID]['unt2']) < CrestOptions.R1MM || parseInt(Seed.units[cityID]['unt2']) < CrestOptions.R2MM || parseInt(Seed.units[cityID]['unt4']) < CrestOptions.R2Pike || parseInt(Seed.units[cityID]['unt5']) < CrestOptions.R2Sword || parseInt(Seed.units[cityID]['unt6']) < CrestOptions.R2Arch || parseInt(Seed.units[cityID]['unt10']) < CrestOptions.R2Ball || parseInt(Seed.units[cityID]['unt11']) < CrestOptions.R2Ram || parseInt(Seed.units[cityID]['unt12']) < CrestOptions.R2Cat) return;
      for (var k in Seed.queue_atkp[cityID]) if (Seed.queue_atkp[cityID][k]['toXCoord']==CrestOptions.X && Seed.queue_atkp[cityID][k]['toYCoord']==CrestOptions.Y)  buzy=true;
      if (!buzy)  {
        CrestOptions.RoundOne=true;
        CrestOptions.RoundTwo=true;
        saveCrestOptions();
      }
      if(!CrestOptions.RoundOne) return;
      
      if (CrestOptions.R1MM == 0 && CrestOptions.R1Ball==0 && CrestOptions.R1Cat==0){
	      CrestOptions.RoundOne = false;
	      saveCrestOptions();
	      return;
      }
      
              
       var now = new Date().getTime()/1000.0;
       now = now.toFixed(0)
		
	   if (CrestOptions.R1MM > parseInt(Seed.units[cityID]['unt2']) || CrestOptions.R1Ball > parseInt(Seed.units[cityID]['unt10']) || CrestOptions.R1Cat > parseInt(Seed.units[cityID]['unt12'])){return;}
          
	    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
        if (now < (parseInt(CrestOptions.lastRoundTwo) + 300)) { 
        	params.u2= (CrestOptions.R1MM / 10);
        	params.u2 = params.u2.toFixed(0);	
        	if (params.u2 < (CrestOptions.R1MM / 10)) params.u2++;
        }	
  		else params.u2= CrestOptions.R1MM;
  		params.u10=CrestOptions.R1Ball;
  		params.u12=CrestOptions.R1Cat;
  		
		for (i=1;i<=Seed.cities.length;i++) if (Seed.cities[i-1][0] == CrestOptions.CrestCity) var cityNumber = i;
		MarchQueue[cityNumber].push({
				what: 			"Crest",
				city:           CrestOptions.CrestCity,
                action:         4,
                targetX:        CrestOptions.X,
                targetY:        CrestOptions.Y,
                1:              0,
                2:              params.u2,
                3:              0,
                4:              0,
                5:              0,
                6:              0,
                7:              0,
                8:              0,
                9:              0,
                10:             params.u10,
                11:             0,
                12:             params.u12,
                13:             0,
                14:             0,
                15:             0,
                r1:             0,
                r2:             0,
                r3:             0,
                r4:             0,
                r5:             0,
                gold:           0,
        });

  		CrestOptions.RoundOne = false;
  		saveCrestOptions();
  		t.SecondRound();
  	 },
     
     	 
    SecondRound: function(){
      var t = Tabs.Crest;
      if (!CrestOptions.Running || !CrestOptions.RoundTwo) return;
      var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
      cityID = 'city' + CrestOptions.CrestCity;
      if (parseInt(Seed.units[cityID]['unt2']) < CrestOptions.R1MM || parseInt(Seed.units[cityID]['unt10']) < CrestOptions.R1Ball || parseInt(Seed.units[cityID]['unt12']) < CrestOptions.R1Cat || parseInt(Seed.units[cityID]['unt2']) < CrestOptions.R1MM || parseInt(Seed.units[cityID]['unt2']) < CrestOptions.R2MM || parseInt(Seed.units[cityID]['unt4']) < CrestOptions.R2Pike || parseInt(Seed.units[cityID]['unt5']) < CrestOptions.R2Sword || parseInt(Seed.units[cityID]['unt6']) < CrestOptions.R2Arch || parseInt(Seed.units[cityID]['unt10']) < CrestOptions.R2Ball || parseInt(Seed.units[cityID]['unt11']) < CrestOptions.R2Ram || parseInt(Seed.units[cityID]['unt12']) < CrestOptions.R2Cat) return;
      
   		params.u2=CrestOptions.R2MM;
  		params.u4=CrestOptions.R2Pike;
  		params.u5=CrestOptions.R2Sword;
  		params.u6=CrestOptions.R2Arch;
  		params.u10=CrestOptions.R2Ball;
  		params.u11=CrestOptions.R2Ram;
  		params.u12=CrestOptions.R2Cat;

  		for (i=1;i<=Seed.cities.length;i++) if (Seed.cities[i-1][0] == CrestOptions.CrestCity) var cityNumber = i;
		MarchQueue[cityNumber].push ({
						what: 			"Crest",
                        city:           CrestOptions.CrestCity,
                        action:         4,
                        targetX:        CrestOptions.X,
                        targetY:        CrestOptions.Y,
                        1:              0,
                        2:              params.u2,
                        3:              0,
                        4:              params.u4,
                        5:              params.u5,
                        6:              params.u6,
                        7:              0,
                        8:              0,
                        9:              0,
                        10:             params.u10,
                        11:             params.u11,
                        12:             params.u12,
                        13:             0,
                        14:             0,
                        15:             0,
                        r1:             0,
                        r2:             0,
                        r3:             0,
                        r4:             0,
                        r5:             0,
                        gold:           0,
        });

		CrestOptions.RoundTwo = false;
        var now = new Date().getTime()/1000.0;
        now = now.toFixed(0);
        CrestOptions.lastRoundTwo = now;
  		saveCrestOptions();
  	},
  		 
  		 
  	abandonWilderness: function(tid,x,y,cid){
      var t = Tabs.Crest;
      var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
      var cityID = cid;
	  var tileid = tid;
      params.tid=tid;
  	  params.cid=cid;
  	  params.x=x;
  	  params.y=y;
  	   		
  		new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/abandonWilderness.php" + unsafeWindow.g_ajaxsuffix, {
  		         method: "post",
  		         parameters: params,
  		         loading: true,
  		         onSuccess: function (transport) {
  		         var rslt=eval("("+transport.responseText+")");
  		         
  		         
				  if (rslt.ok) {
				  	 t.error_code = 0;
				     CrestOptions.RoundOne = true;
				     CrestOptions.RoundTwo = true;
				     saveCrestOptions();
				      if (rslt.returningMarches) {
				          var cities = Object.keys(rslt.returningMarches);
				          for (var i = 0; i < cities.length; i++) {
				              for (var j = 0; j < rslt.returningMarches[cities[i]].length; j++) {
				                  var cid = cities[i].split("c")[1];
				                  var mid = rslt.returningMarches[cities[i]][j];
				                  var march = Seed.queue_atkp["city" + cid]["m" + mid];
				                  if (march) {
				                      var marchtime = Math.abs(parseInt(march.destinationUnixTime) - parseInt(march.marchUnixTime));
				                      var ut = unsafeWindow.unixtime();
				                      Seed.queue_atkp["city" + cid]["m" + mid].destinationUnixTime = ut;
				                      Seed.queue_atkp["city" + cid]["m" + mid].marchUnixTime = ut - marchtime;
				                      Seed.queue_atkp["city" + cid]["m" + mid].returnUnixTime = ut + marchtime;
				                      Seed.queue_atkp["city" + cid]["m" + mid].marchStatus = 8
				                  }
				              }
				          }
				      }
				      if(rslt.updateSeed){unsafeWindow.update_seed(rslt.updateSeed)};
				      
				      if (Object.keys(Seed.wilderness["city" + cityID]).length == 1) {
				          Seed.wilderness["city" + cityID] = []
  		         	  } else{
  		         	  	delete Seed.wilderness["city"+cityID]["t"+tileid];
  		         	  }
               } 
  		         },
  		         onFailure: function () {}
  		 });
    },
    
  hide : function (){
    var t = Tabs.Crest;
  },

  show : function (){
  },
 };



/*********************************** Dashboard Tab ***********************************/

function createDashboard (){
	var Dashboard = document.createElement('div');
	var beacon = document.getElementById('mod_cityinfo');
	Dashboard.id='Dash_div';
	Dashboard.style.position = 'relative';	
	if (GlobalOptions.pbWideScreenStyle=="ultra") Dashboard.style.width= "450px";
	 else if (GlobalOptions.pbWideScreenStyle=="wide") Dashboard.style.width= "400px";
	  else Dashboard.style.width = (screen.width - 1122 - 22) +"px";
	if (!Options.pbChatOnRight) Dashboard.style.width= "450px";
  	Dashboard.style.top = "-605px";
  	if (Options.pbChatOnRight) Dashboard.style.left ="1122px";
  	 else Dashboard.style.left ="760px";
  	Dashboard.style.height = "728px";
  	Dashboard.style.background = '#FFFFE6';
  	Dashboard.style.overflow = 'auto';
	beacon.parentNode.insertBefore(Dashboard, beacon);
}

var DashboardOptions = {
	foodLevel:10000000000,
    woodLevel:1000000000,
    stoneLevel:100000000,
    oreLevel:100000000,
    astoneLevel:250000,
    showRP:true,
    showThrone:true,
    showStatus:true,
    showButtons:true,
    showReso:true,
    ShowResoCity:[true,true,true,true,true,true,true,true],
    ShowResoTypes:[null,true,true,true,true],
    showLog:true,
    showTroops:true,
    showTower:true,
    showWarnings:true,
    showMarches:true,
    showSacrifice:true,
}

var Dashboard = {
    tabOrder: 800,
    tabLabel: 'Dashboard',
    myDiv : null,
    Alerts: [],
    showMarchesInfo: true,
    
    init : function (div){
        var t = Dashboard;
        t.myDiv = div;
        Tabs.Reassign.readReassignState();
        Tabs.build.readBuildStates();

        createDashboard();

        if (GlobalOptions.pbWideScreenStyle=="wide" || GlobalOptions.pbWideScreenStyle=="ultra") {
        	var m = '<div class="pbStat" id=dbHeader></div>';
	        m += '<TABLE class=pbTab cellspacing=0 cellpadding=0>';
	        m += '<TR><TD><INPUT id=AttackToggleD type=submit class=pbButton style="width: 120px;"></td><TD><INPUT id=CraftToggle type=submit class=pbButton style="width: 120px;"></td><TD><INPUT id=TransportToggle type=submit class=pbButton style="width: 120px;"></td></tr>';
	        m += '<TR><TD><INPUT id=CrestToggleD type=submit class=pbButton style="width: 120px;"></td><TD><INPUT id=AutoDfToggle type=submit class=pbButton style="width: 120px;"></td><TD><INPUT id=AutotrainToggle type=submit class=pbButton style="width: 120px;"></td></tr>';
	        m += '<TR><TD><INPUT id=AutoFarmToggle type=submit class=pbButton style="width: 120px;"></td><TD><INPUT id=ReassignToggle type=submit class=pbButton style="width: 120px;"></td><TD><INPUT id=AutoSalvageToggle type=submit class=pbButton style="width: 120px;"></td></tr>';        
	        m += '<TR><TD>&nbsp</td></tr><TR><TD><INPUT id=BuildToggle type=submit class=pbButton style="width: 120px;"></td><TD><INPUT id=BuildModeToggle type=submit class=pbButton style="width: 120px;">&nbsp&nbsp<SPAN id=buildStatus style="vertical-align:bottom;"></span></td>';
	        m += '</table>';
	        m+='<BR><DIV id=MarchesSendInfo></div>';
	        m += '<BR><DIV id=CityStatus></div>';
	        m += '<BR><div class="pbStat">THRONE ROOM</div><DIV id=UpgradeStatus></div><DIV id=TriesStatus></div>';
	        m += '<BR><DIV id=ShowTrPresets></div>';
	        m += '<BR><DIV id=ShowRP></div>';
	        m += '<DIV id=SacrificePlaceholder></div>';
	        m += '<DIV id=TowerAlertPlaceholder></div>';
	        //m += '<BR><DIV id=ShowAutoTrain></div>';
	        m += '<BR><DIV id=ShowTroops></div>';     
	        m += '<DIV id=AlertsPlaceholder></div>';
	        m += '<DIV id=ShowMarches></div>'; 
	        m += '<BR><DIV id=ShowLog></div>';
        } else {
        	var m = '<div class="pbStat" id=dbHeader></div>';
	        m += '<TABLE width=100% class=pbTab cellspacing=0 cellpadding=0>';
	        m += '<TR><TD><INPUT id=AttackToggleD type=submit class=pbButton style="width: 120px;"></td></tr><TR><TD><INPUT id=CraftToggle type=submit class=pbButton style="width: 120px;"></td></tr><TR><TD><INPUT id=TransportToggle type=submit class=pbButton style="width: 120px;"></td></tr>';
	        m += '<TR><TD><INPUT id=CrestToggleD type=submit class=pbButton style="width: 120px;"></td></tr><TR><TD><INPUT id=AutoDfToggle type=submit class=pbButton style="width: 120px;"></td></tr><TR><TD><INPUT id=AutotrainToggle type=submit class=pbButton style="width: 120px;"></td></tr>';
	        m += '<TR><TD><INPUT id=AutoFarmToggle type=submit class=pbButton style="width: 120px;"></td></tr><TR><TD><INPUT id=ReassignToggle type=submit class=pbButton style="width: 120px;"></td></tr><TR><TD><INPUT id=AutoSalvageToggle type=submit class=pbButton style="width: 120px;"></td></tr>';        
	        m += '<TR><TD>&nbsp</td></tr><TR><TD><INPUT id=BuildToggle type=submit class=pbButton style="width: 120px;"></td></tr><TR><TD><INPUT id=BuildModeToggle type=submit class=pbButton style="width: 120px;">&nbsp&nbsp<SPAN id=buildStatus style="vertical-align:bottom;"></span></td>';
	        m += '</table>';
	        m+='<BR><DIV id=MarchesSendInfo></div>';
	        m += '<BR><DIV id=ShowTrPresets></div>';
	        m += '<DIV id=AlertsPlaceholder></div>'; 
        }
        document.getElementById('Dash_div').innerHTML = m;
        unsafeWindow.clearMarches = t.clearMarches;

        if (AtkOptions.Running) {document.getElementById('AttackToggleD').value = "Attack = ON";document.getElementById('AttackToggleD').setAttribute("class", "buttonDash_ON");}
        	else {document.getElementById('AttackToggleD').value = "Attack = OFF";document.getElementById('AttackToggleD').setAttribute("class", "buttonDash_OFF");}
        if (CraftOptions.Running) {document.getElementById('CraftToggle').value = "Crafting = ON";document.getElementById('CraftToggle').setAttribute("class", "buttonDash_ON");}
        	else {document.getElementById('CraftToggle').value = "Crafting = OFF";document.getElementById('CraftToggle').setAttribute("class", "buttonDash_OFF");}
        if (Tabs.transport.traderState.running) {document.getElementById('TransportToggle').value = "Transport = ON";document.getElementById('TransportToggle').setAttribute("class", "buttonDash_ON");}
        	else {document.getElementById('TransportToggle').value = "Transport = OFF"; document.getElementById('TransportToggle').setAttribute("class", "buttonDash_OFF");} 
        if (CrestOptions.Running) {document.getElementById('CrestToggleD').value = "Crest = ON";document.getElementById('CrestToggleD').setAttribute("class", "buttonDash_ON");}
    		else {document.getElementById('CrestToggleD').value = "Crest = OFF";document.getElementById('CrestToggleD').setAttribute("class", "buttonDash_OFF");}
    	if (DFOptions.Running) {document.getElementById('AutoDfToggle').value = "Auto DF = ON";document.getElementById('AutoDfToggle').setAttribute("class", "buttonDash_ON");}
    		else {document.getElementById('AutoDfToggle').value = "Auto DF = OFF";document.getElementById('AutoDfToggle').setAttribute("class", "buttonDash_OFF");}
		if (TrainOptions.Running) {document.getElementById('AutotrainToggle').value = "AutoTrain = ON";document.getElementById('AutotrainToggle').setAttribute("class", "buttonDash_ON");}
			else {document.getElementById('AutotrainToggle').value = "AutoTrain = OFF";document.getElementById('AutotrainToggle').setAttribute("class", "buttonDash_OFF");}
		if (FarmOptions.Running) {document.getElementById('AutoFarmToggle').value = "Farming = ON";document.getElementById('AutoFarmToggle').setAttribute("class", "buttonDash_ON");}
			else {document.getElementById('AutoFarmToggle').value = "Farming = OFF";document.getElementById('AutoFarmToggle').setAttribute("class", "buttonDash_OFF");}
		if (Tabs.Reassign.reassignState.running) {document.getElementById('ReassignToggle').value = "Reassign = ON";document.getElementById('ReassignToggle').setAttribute("class", "buttonDash_ON");}
			else {document.getElementById('ReassignToggle').value = "Reassign = OFF";document.getElementById('ReassignToggle').setAttribute("class", "buttonDash_OFF");}
		if (Options.ThroneDeleteItems) {document.getElementById('AutoSalvageToggle').value = "Salvage = ON";document.getElementById('AutoSalvageToggle').setAttribute("class", "buttonDash_ON");}
			else {document.getElementById('AutoSalvageToggle').value = "Salvage = OFF";document.getElementById('AutoSalvageToggle').setAttribute("class", "buttonDash_OFF");}
		if (Tabs.build.buildStates.running=='ON') {document.getElementById('BuildToggle').value = "Auto Build = ON";document.getElementById('BuildToggle').setAttribute("class", "buttonDash_ON");}
		if (Tabs.build.buildStates.running=='AUTO') {document.getElementById('BuildToggle').value = "Auto Build = AUTO";document.getElementById('BuildToggle').setAttribute("class", "buttonDash_ON");}		
		if (Tabs.build.buildStates.running=='OFF') {document.getElementById('BuildToggle').value = "Auto Build = OFF";document.getElementById('BuildToggle').setAttribute("class", "buttonDash_OFF");}
		
		document.getElementById('BuildModeToggle').value = "Build Mode = OFF";
		document.getElementById('BuildModeToggle').setAttribute("class", "buttonDash_OFF");

		document.getElementById('buildStatus').innerHTML = '<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAWJJREFUeNrUU79PwkAUvv5IG6iAg8HEMIlxNLBCNxkkYah/gP6NmAChiYQUupjA4uCicbKJBQ0E24OWtvjdgCHGdmHyJV/efffuvrx37x232WzIPsaTPW1vAXGXaJpGRFGUOY67AD0FMsAX8IpSH4Mg8JrNZrwATI6i6KrRaGjVarWWTqePXde1TdO873Q67GYX8GIFwjAs1ev160qlckMp5QG2XQC/Xa1WnK7r7+APsQLr9fq8XC7XbNvmWXd832d7BFnxxWKxhnUvUQAXcqg/7zgOcRyKjIKfmCRJeRZPfETP89zJ5HO6XIYngiAThq1R6k5ZPLGNOPBsGMYglcpEsqyQLSRJicbj8YDFEzOwLGvUat21KfVFVb1Us9nc0WIx/xgOe2a/323PZrPRbwFud5RRvyQIwpmiKCX4AvgB4g6684Z2PsG/MJ4kIMAdsnn4Y+jYi85x3o8V+J+f6VuAAQDR57f+eJX9fgAAAABJRU5ErkJggg=="/>';	 



        document.getElementById('AttackToggleD').addEventListener ('click', function(){Tabs.Attack.toggleAttackState();},false);
        document.getElementById('CraftToggle').addEventListener ('click', function(){Tabs.AutoCraft.toggleStateRunning(this);},false); 
        document.getElementById('TransportToggle').addEventListener ('click', function(){Tabs.transport.toggleTraderState(this);},false);
        document.getElementById('CrestToggleD').addEventListener ('click', function(){Tabs.Crest.toggleCrestState();},false);
        document.getElementById('AutoDfToggle').addEventListener ('click', function(){Tabs.DF.toggleDFState(this);},false);  
        document.getElementById('AutotrainToggle').addEventListener ('click', function(){Tabs.AutoTrain.toggleAutoTrainState(this);},false);
        document.getElementById('AutoFarmToggle').addEventListener ('click', function(){Tabs.farm.toggleBarbState(this);},false);
        document.getElementById('ReassignToggle').addEventListener ('click', function(){Tabs.Reassign.toggleReassignState(this);},false);
        document.getElementById('AutoSalvageToggle').addEventListener ('click', function(){Tabs.Throne.ToggleSalvageState(this);},false);
        document.getElementById('BuildToggle').addEventListener ('click', function(){Tabs.build.toggleStateRunning(this);},false);
        document.getElementById('BuildModeToggle').addEventListener ('click', function(){Tabs.build.toggleStateMode(this);},false);
        
        if (GlobalOptions.pbWideScreenStyle=="wide" || GlobalOptions.pbWideScreenStyle=="ultra") {
        	if (DashboardOptions.showWarnings) t.CheckForAlerts();
	        if (DashboardOptions.showThrone) t.ShowTrPresets();
	        t.RPM();
	        if (DashboardOptions.showStatus) t.CityStatus();
	        if (DashboardOptions.showTower) t.ShowTowerAlerts();
	        if (DashboardOptions.showLog) t.ShowLog();
	        if (DashboardOptions.showTroops) t.ShowTroops();
	        if (DashboardOptions.showSacrifice) t.showSacrifice();
	        t.ShowMarches();
	        //t.ShowAutoTrain();
        } else {
        	if (DashboardOptions.showThrone) t.ShowTrPresetsMini();
	        t.RPM();
	        if (DashboardOptions.showWarnings) t.CheckForAlerts();
        }
    },

    CheckForAlerts: function (){
    	var t = Dashboard;
    	var foodLev = DashboardOptions.foodLevel
    	var woodLev = DashboardOptions.woodLevel
    	var stoneLev = DashboardOptions.stoneLevel
    	var oreLev = DashboardOptions.oreLevel
    	var astoneLev = DashboardOptions.astoneLevel
    	t.Alerts = [];
		for (var a=1; a<=5;a++) for(b=0; b<Cities.numCities; b++) {
			if (a==5) rec = Seed.resources["city" + Seed.cities[b][0]]['rec'+a][0];
				else rec = Math.round(Seed.resources["city" + Seed.cities[b][0]]['rec'+a][0]/3600);
    		switch (a){
    			case 1:if (rec < foodLev) t.Alerts.push(Seed.cities[b][1] + " (" + (b+1) +"): Food warning -> " + addCommas(rec));break;
    			case 2:	if (rec < woodLev) t.Alerts.push(Seed.cities[b][1] + " (" + (b+1) + "): Wood warning -> " + addCommas(rec));break;
    			case 3:	if (rec < stoneLev) t.Alerts.push(Seed.cities[b][1] + " (" + (b+1) + "): Stone warning -> " + addCommas(rec));break;
    			case 4:	if (rec < oreLev) t.Alerts.push(Seed.cities[b][1] + " (" + (b+1) + "): Ore warning -> " + addCommas(rec));break;
    			case 5:	if (rec < astoneLev) t.Alerts.push(Seed.cities[b][1] + " (" + (b+1) + "): Aetherstones warning -> " + addCommas(rec));break;
    		}
    	}
    	for(b=0; b<Seed.cities.length; b++) if (Seed.queue_unt["city" + Seed.cities[b][0]].length == 0) t.Alerts.push(Seed.cities[b][1] +  " (" + (b+1) + "): No troops training");

    	for(b=0; b<Seed.cities.length; b++) {
    		var check = false;
    		var tech = false;
    		var tech2 = false;
    		for (k in Seed.buildings["city" + Seed.cities[b][0]])	{
    			if (Seed.buildings["city" + Seed.cities[b][0]][k][1] < 9 && Seed.buildings["city" + Seed.cities[b][0]][k][2] < 500) if (Seed.queue_con["city" + Seed.cities[b][0]].length == 0 && Tabs.build["bQ_" + Seed.cities[b][0]].length == 0) check = true;
    			if (Seed.buildings["city" + Seed.cities[b][0]][k][0] == 11 && Seed.queue_tch["city" + Seed.cities[b][0]].length == 0) tech = true;
    			if (Seed.buildings["city" + Seed.cities[b][0]][k][0] == 27 && Seed.queue_tch2["city" + Seed.cities[b][0]].length == 0) tech2 = true;
    		}
    		if (check) t.Alerts.push(Seed.cities[b][1] +  " (" + (b+1) + "): No Buildqueue");
    		if (tech) t.Alerts.push(Seed.cities[b][1] +  " (" + (b+1) + "): No Reseach");
    		if (tech2) t.Alerts.push(Seed.cities[b][1] +  " (" + (b+1) + "): No Briton Reseach");
    	}
    	
    	var count = 0;
    	for (k in unsafeWindow.kocThroneItems) count++;
    	if (count > (Seed.throne.rowNum*5)) t.Alerts.push('Throne Room FULL (' + count + '/' + (Seed.throne.rowNum*5) +')');
    	
    	var msg="";
    	for (k=0;k<t.Alerts.length;k++) msg+= t.Alerts[k] + '<BR>';
    	if (t.Alerts.length > 0) {
    		document.getElementById('AlertsPlaceholder').innerHTML = '<BR><DIV class="pbStatOrange">Warnings</div><DIV id=ShowAlerts></div>'; //style="height: 60px; overflow: auto"
    		document.getElementById('ShowAlerts').innerHTML = msg;	
    	} else document.getElementById('AlertsPlaceholder').innerHTML = "";
    },
    

    ShowMarches: function (){
    	var t = Dashboard;
    	var msg= "";
    	t.showMarchesInfo = true;
    	if (MarchOptions.Queue.length > 0) {
    		msg = '<BR><DIV class="pbStat">Marches&nbsp&nbsp<INPUT type=submit class=pbButton id=HideMarches value=Hide></div><DIV id=MarchesInfo></div>';
    		document.getElementById('ShowMarches').innerHTML = msg;
    		msg = '<TABLE width=100% class=pbTab>';
    		msg +='<TR><TD>City</td><TD>Coords</td><TD>Target</td><TD>City</td><TD>Troops</td><TD>Action</td>';
    		for (k=0;k<MarchOptions.Queue.length;k++) {
    			var action = MarchOptions.Queue[k];
    			for (postcity in Seed.cities) if (Seed.cities[postcity][0] == action.city) logcity = Seed.cities[postcity][1];
			    var total = 0;
				var info = "";
				var type="";
				for (i=1;i<=12;i++) total += parseInt(action[i]);
				switch (parseInt(action.tileType)) {
					case 0: info = "Bog";break;
					case 10: info = "Grassland";break;
					case 11: info = "Lake";break;
					case 20: info = "Woods";break;
					case 30: info = "Hills";break;
					case 40: info = "Mountain";break;
					case 50: info = "Plain";break;
					case 51: 
						if (action.targetCityName == null && !action.misted) info = "Barb Camp";
							else info = action.targetName;
						break;
					case 53: info = "Misted City";break;
				}
				switch (parseInt(action.action)) {
					case 1: type = "Transport";break;
					case 2: type = "Reinforce";break;
					case 3: type = "Scout";break;
					case 4: type = "Attack";break;
					case 5: type = "Reassign";break;
				} 
    			msg += '<TR><TD>'+logcity+'</td><TD>'+coordLink(parseInt(action.targetX),parseInt(action.targetY))+'</td><TD>'+info+'</td><TD>'+action.targetCityName+'</td><TD>'+addCommas(total)+'</td><TD><INPUT type=submit class=pbButton id="dbDoAction' + k + '" value='+ type +' style="color:red;"></td>';
    		}
    		document.getElementById('MarchesInfo').innerHTML = msg;
			for (k=0;k<MarchOptions.Queue.length;k++) document.getElementById('dbDoAction' + k).addEventListener('click', function(){Tabs.March.doMarch(MarchOptions.Queue[this.id.substr(10)]);}, false);
			document.getElementById('HideMarches').addEventListener ('click', function(){t.clearMarches();},false);
		} else document.getElementById('ShowMarches').innerHTML = "";

	},

	showSacrifice: function(){
		var t = Dashboard;
		var now = unixTime();
		var NoSacrifice = true;
		for (var i=0;i<Seed.cities.length;i++) if (Seed.queue_sacr["city"+Seed.cities[i][0]][0]!=undefined) NoSacrifice = false;
    	if (NoSacrifice) {
    		document.getElementById('SacrificePlaceholder').innerHTML = "";
    		return;
    	}
		var msg = '<DIV class="pbStat">Sacifice</div><TABLE id=pbRPStats 50% class=pbTab>';
		for (var i=0;i<Seed.cities.length;i++){
			var cityID = Seed.cities[i][0];
			if (Seed.queue_sacr["city"+cityID][0]!=undefined) msg+='<TR><TD width=150px>'+Seed.cities[i][1]+' (1)</td><TD width=30px><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+Seed.queue_sacr["city"+cityID][0].unitType +'_30_s34.jpg?6545></td><TD width=75px>'+Seed.queue_sacr["city"+cityID][0].quantity+'</td><TD width=50px>'+timestr(Seed.queue_sacr["city"+cityID][0].eta-now)+' ('+timestr(Seed.queue_sacr["city"+cityID][0].eta-Seed.queue_sacr["city"+cityID][0].start)+')</td></tr>';
			if (Seed.queue_sacr["city"+cityID][1]!=undefined) msg+='<TR><TD width=150px>'+Seed.cities[i][1]+' (2)</td><TD width=30px><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+Seed.queue_sacr["city"+cityID][1].unitType +'_30_s34.jpg?6545></td><TD width=75px>'+Seed.queue_sacr["city"+cityID][1].quantity+'</td><TD width=50px>'+timestr(Seed.queue_sacr["city"+cityID][1].eta-now)+' ('+timestr(Seed.queue_sacr["city"+cityID][1].eta-Seed.queue_sacr["city"+cityID][1].start)+')</td></tr>';
		}
		msg += '</table>';
		document.getElementById('SacrificePlaceholder').innerHTML = msg;
	},
	
	clearMarches: function (){
    	var t = Dashboard;
		if (!t.showMarchesInfo) {
			t.showMarchesInfo=true;
			t.ShowMarches();
		} else {
				if (document.getElementById('MarchesInfo')) document.getElementById('MarchesInfo').innerHTML ="";
				document.getElementById('HideMarches').value = "Show";
				t.showMarchesInfo=false;
			}
    },

    ShowRP: function (){
    	var t = Dashboard;
    	var msg = '<DIV class="pbStat">Rallypoints</div><TABLE id=pbRPStats width=100% class=pbTab><TR>';
		for(b=0; b<Seed.cities.length;b++) {
    		slots = CheckCityMarches(b);
    		rallypointlevel = getRallypoint(Seed.cities[b][0]);
			msg += '<TD>' + unsafeWindow.roman[b] + ': (' + slots + '/' + rallypointlevel +')</td>';
			if ((b+1)%4==0) msg+='</tr><TR>';
		}
		document.getElementById('ShowRP').innerHTML = msg;
    },

    ShowTrPresets: function (){
    	var t = Dashboard;
    	var msg = '<DIV class="pbStat"><INPUT id=pbTRHelp type=submit class=pbButton value="HELP">&nbsp; &nbsp; Throne Preset Switcher</div><TABLE id=pbThroneTr width=100% class=pbTab><TR>';
    	for (i=1;i<=8;i++) {		
    			var total = 0;
    			var active =0;
    			var what="";
    			for (j=1;j<Tabs.Throne.EquipType.length;j++) {
    				what = Tabs.Throne.EquipType[j];
    				id = ThroneOptions.Presets[i][what.toLowerCase()];
    				if (what == "Chair") what = "Throne";
     				if (what == "Windows") what = "Window";
     				if (unsafeWindow.kocThroneItems[id] != undefined && unsafeWindow.kocThroneItems[id].isEquipped) active++;
     				if (id > 0) total++;
    			}
    			if (active == total) msg+= '<TD align="center"><B>'+active+'/'+total+'</b></td>';
    				else msg+= '<TD align="center">'+active+'/'+total+'</td>';
    			var stats = renderLocalPresetStats(i);
    			msg+= '<TD><a class=hasTooltip><INPUT type=submit class=pbButton id="Preset_' + i + '" value="'+ThroneOptions.PresetName[i]+'"><SPAN>'+stats+'</span></a></td>';
    			if (i%4==0) msg+='</tr><TR>';
    	}
    	msg += '</tr></table>';
    	msg += '<TABLE class=pbTab><TR><TD style="width:100px">Kabam presets:</td>';
    	for (var i=1;i<=Seed.throne.slotNum;i++) {
    		msg+='<TD style="width:30px"><a class=hasTooltip><INPUT type=submit class=pbButton id="KabamPreset_' + i + '" value="'+i+'"><SPAN id="KabamPresetHover'+i+'"></span></a></td>';
    	}
    	msg += '</tr></table>';
    	document.getElementById('ShowTrPresets').innerHTML = msg;
    	//for (var i=1;i<=Seed.throne.slotNum;i++) 
    	document.getElementById('pbTRHelp').addEventListener('click', function () {t.helpPop();});
		for (i=1;i<=8;i++) document.getElementById('Preset_' + i).addEventListener ('click', function(){Tabs.Throne.EquipPreset(this.id.substr(7))},false);
		
		for (i=1;i<=Seed.throne.slotNum;i++) {
			if (document.getElementById('KabamPreset_'+i)) document.getElementById('KabamPreset_' + i).addEventListener ('click', function(){Tabs.Throne.EquipKabamPreset(this.id.substr(12))},false);
			if (i==Seed.throne.activeSlot && document.getElementById('KabamPreset_'+i)) document.getElementById('KabamPreset_'+i).setAttribute("class", "pbButton_selected");
			if (i==Seed.throne.activeSlot && document.getElementById('KabamPreset_Chat_'+i)) document.getElementById('KabamPreset_Chat_'+i).setAttribute("class", "pbButton_selected");
			renderKabamPresetStats(i); 
		}
    },
	ShowTrPresetsMini: function (){
    	var t = Dashboard;
    	var msg = '<DIV class="pbStat">TR Switcher &nbsp; <INPUT id=pbTRHelp type=submit class=pbButton value="?"></div><TABLE id=pbThroneTr width=100% class=pbTab>';
    	for (i=1;i<=6;i++) {
    			msg+= '<TR><TD><INPUT type=submit class=pbButton id="Preset_' + i + '" value="'+ThroneOptions.PresetName[i]+'"></td>';
    			var total = 0;
    			var active =0;
    			var what="";
    			for (j=1;j<Tabs.Throne.EquipType.length;j++) {
    				what = Tabs.Throne.EquipType[j];
    				id = ThroneOptions.Presets[i][what.toLowerCase()];
    				if (what == "Chair") what = "Throne";
     				if (what == "Windows") what = "Window";
     				if (unsafeWindow.kocThroneItems[id] != undefined && unsafeWindow.kocThroneItems[id].isEquipped) active++;
     				if (id > 0) total++;
    			}
    			if (active == total) msg+= '<TD align="center"><B>'+active+'/'+total+'</b></td></tr>';
    				else msg+= '<TD align="center">'+active+'/'+total+'</td></tr>';
    	}
    	msg += '</table>'
    	document.getElementById('ShowTrPresets').innerHTML = msg;
    	document.getElementById('pbTRHelp').addEventListener('click', function () {t.helpPop();});
		for (i=1;i<=6;i++) document.getElementById('Preset_' + i).addEventListener ('click', function(){Tabs.Throne.EquipPreset(this.id.substr(7))},false);
    },
	
	helpPop: function () {
        var helpText = '<DIV style="height:462px;max-height=462px"><BR><B>This DOES work.</b><BR><BR>It just might not do what you think it does.<BR><BR>These are LOCAL presets, it DOES NOT switch the game presets.<BR><BR><U><B>To use this feature...</b></u><BR><BR>1. Go to your AIO and select the Throne tab.<BR><BR>2. Select the Preset subtab.<BR><BR>3. In here you will see local presets that you can rename to whatever you want, eg \'Training\' or \'Range\'.<BR><BR>4. Once named, switch to the \'Compare\' subtab. These are all your cards.<BR><BR>5. Click on any of the titles of the cards. This opens a popup window where you can equip, add to preset, add to update or enhance queue.<BR><BR>6. Once you add it to a preset, go back to the \'Preset\' subtab.<BR><BR>7. You should now see your card in the preset you added it to.<BR><BR>8. Refresh <BR><BR> 9.Click on the \'Quick TR Switcher\' button on the dashboard for those cards to be equipped automatically.</div>';
        var pop = new pbPopup('giftHelp', 0, 0, 425, 485, true);
        pop.centerMe(mainPop.getMainDiv());
        pop.getMainDiv().innerHTML = helpText;
        pop.getTopDiv().innerHTML = '<CENTER><B>TR Switcher Help</b></center>';
        pop.show(true);
	},

	ShowAutoTrain: function (){
    	var t = Dashboard;
    	var msg = '<DIV class="pbStat">Auto Train</div>';
		var now = unixTime();
		if (!TrainOptions.Running) msg+="Auto Train is OFF";
			else {
				if (Tabs.AutoTrain.trainTime > now) msg += "Doing Train cycle (Set Preset/Train Troops/Reset TR Items) for: " + timestr(Tabs.AutoTrain.trainTime - now);
					else if (Tabs.AutoTrain.nextround > now) msg += "Next Auto Train cycle in: " + timestr(Tabs.AutoTrain.nextround - now);
		}
 		document.getElementById('ShowAutoTrain').innerHTML = msg;
    },

    ShowTowerAlerts: function (){
    	var t = Dashboard;
    	var NoAttack = true;
    	for (k in Seed.queue_atkinc) if (Seed.queue_atkinc[k].marchType == 3 || Seed.queue_atkinc[k].marchType ==4) NoAttack = false;
    	if (NoAttack) {
    		document.getElementById('TowerAlertPlaceholder').innerHTML = "";
    		return;
    	}
    	document.getElementById('TowerAlertPlaceholder').innerHTML = '<BR><DIV class="pbStatRed">Tower Alerts</div><DIV id=ShowTowerAlerts></div>'; //style="height: 100px; overflow: auto">
    	var msg = '';
    	var action = '';
    	var arrivalTime = 0;

    	for(k in Seed.queue_atkinc) {
    		var now = unixTime();
    		var counter = 0;

    		if (Seed.queue_atkinc[k].fromPlayerId != unsafeWindow.tvuid && Seed.queue_atkinc[k].arrivalTime > now) {
				for (postcity in Seed.cities) if (Seed.cities[postcity][0] == Seed.queue_atkinc[k].toCityId) cityName = Seed.cities[postcity][1];
				if (Seed.queue_atkinc[k].marchType == 3) action = "Scout";
				if (Seed.queue_atkinc[k].marchType == 4) action = "Attack";
				arrivalTime = Seed.queue_atkinc[k].arrivalTime - now;
				msg += cityName + ': ' + action + ' -- ETA: ' + timestr(arrivalTime);
				msg +='<BR><TABLE class=pbTab><TR>';
				for (i=1;i<=15;i++){
					if (Seed.queue_atkinc[k]["unts"] == undefined) {
						msg +='<TR><TD>???</td></tr>'; 
					} else if (parseInt(Seed.queue_atkinc[k]["unts"]["u"+i]) > 0) {
						if (counter%4==0) msg+='</tr><TR>';
						counter++;
						msg+='<TD width=30px><img src=http://www352.kingdomsofcamelot.com/fb/e2/src/img/units/unit_'+i+'_30_s34.jpg?6545></td><TD width=80px>' + parseInt(Seed.queue_atkinc[k]["unts"]["u"+i]) + '</td>';
					}
				}
				msg+='</tr></table>';
			}

    	}
    	document.getElementById('ShowTowerAlerts').innerHTML = msg;
    },

    RPM: function (){
    	var t = Dashboard;
    	var now=unixTime();
        var time = 0;
        var calc = 0
        time = now - RPMtime;   
        calc =(RPM/time)*60;
        calc = Math.round(calc);
        if (time <30) calc = "...";
        document.getElementById('dbHeader').innerHTML = "Requests send per minute: " + calc + ' (<SPAN id=MouseMove></span>)'; 
    },

    CityStatus: function (){
    	var t = Dashboard;
    	var msg = '<DIV class="pbStat">City Defend Status</div><TABLE id=pbRPStats width=100% class=pbTab><TR>';
    	for(b=0; b<Cities.numCities; b++) msg+= '<TD><INPUT type=submit id="cityDEF_' + Seed.cities[b][0] + '" value="'+unsafeWindow.roman[b]+'"></td>';
    	document.getElementById('CityStatus').innerHTML = msg;
    	for(b=0; b<Cities.numCities; b++) {
    		if (parseInt(Seed.citystats["city" + Seed.cities[b][0]].gate) == 0) document.getElementById('cityDEF_' + Seed.cities[b][0]).style.backgroundColor  = "green";
    			else document.getElementById('cityDEF_' + Seed.cities[b][0]).style.backgroundColor  = "red";
    		document.getElementById('cityDEF_' + Seed.cities[b][0]).style.color  = "white";
    		document.getElementById('cityDEF_' + Seed.cities[b][0]).addEventListener ('click', function(){
	    		var city = this.id.substr(8);
	    		if (parseInt(Seed.citystats["city" + city].gate) == 0) t.ChangeDefMode(city,1);
	    		if (parseInt(Seed.citystats["city" + city].gate) == 1) t.ChangeDefMode(city,0);
      		},false);
    	}    	
    },

    ChangeDefMode : function (cityId, state){
    	var t = Dashboard;
        var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
        params.cid = cityId;
        params.state = state;
        
        new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/gate.php" + unsafeWindow.g_ajaxsuffix, {
            method: "post",
            parameters: params,
            onSuccess: function (rslt) {
                if (rslt.ok) {
                    Seed.citystats["city" + cityId].gate = state;
                    if(rslt.updateSeed){unsafeWindow.update_seed(rslt.updateSeed)};
                }
            },
            onFailure: function () {
            }
        })
  	},

  	ShowLog: function (){
  		var t = Dashboard;
  		var msg = '<DIV class="pbStat">Action Log</div>';
  		var amount = parseInt(Tabs.Options.last250.length)-1;
  		for (i=amount;i>(amount-5);i--) if (Tabs.Options.last250[i] != undefined) msg+= Tabs.Options.last250[i].ts + ': ' + Tabs.Options.last250[i].msg + '<BR>';
  		document.getElementById('ShowLog').innerHTML = msg;
    
    },

    ShowTroops: function (){
    	var t = Dashboard;
    	var msg = '<DIV class="pbStat">Troops</div>';
    	msg+= '<SPAN id=dbCityCel></span>&nbsp&nbsp&nbsp<INPUT type=submit class=pbButton id="HideTroops" value="Hide"><BR><DIV id=dbCityInfo></div>';
    	document.getElementById('ShowTroops').innerHTML = msg;  	
    	t.tcp = new CdispCityPicker ('dbCityCelBut', document.getElementById('dbCityCel'), true, t.PaintTroops);
    	document.getElementById('HideTroops').addEventListener ('click', function(){document.getElementById('dbCityInfo').innerHTML = "";t.tcp = new CdispCityPicker ('dbCityCelBut', document.getElementById('dbCityCel'), true, t.PaintTroops)},false);	
    },

    PaintTroops: function (){
    	var t = Dashboard;
    	var info ='<TABLE id=pbRPStats width=100% class=pbTab><TR>';
    	for (l in Seed.units['city' + t.tcp.city.id]) {
    		info+= '<TD style="width: 30px;"><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+ l.substr(3) +'_30_s34.jpg?6545></td><TD style="vertical-align: middle;">' + addCommas(Seed.units['city' + t.tcp.city.id][l]) +'</td>';
    		if (l.substr(3)%4==0) info+='</tr><TR>';
    	}
    	document.getElementById('dbCityInfo').innerHTML = info;
    },

    show: function (){},
    
    hide : function (){}
}

    

/*********************************** Options Tab ***********************************/
Tabs.Options = {
  tabOrder: 699,
  myDiv : null,
  curTabBut : null,
  curTabName : null,
  maxEntries: 300,
  last250 : [],
  state : null,
  Data: {Options: {},GlobalOptions: {},Colors: {},ChatIcons: {},Build1: {},Build2: {},Build3: {},Build4: {},Build5: {},Build6: {},Build7: {},Build8: {},ThroneOptions: {},CrestOptions: {},TrainOptions: {},ReassignRoutes: {},BuildOptions: {},TransportOptions: {},TransportState: {},RaidOptions: {},DFOptions: {},ApothecaryOptions: {},FarmOptions: {},TradeOptions: {},MarchOptions: {},CraftOptions: {},AtkOptions: {},DFOptions: {}},
  
  init : function (div){
    var t = Tabs.Options;

    t.cont = div;
    var main = '<TABLE align=center class=pbTab width=85%><TR><TD><INPUT class=pbButton ID=pbOptions_Options type=submit value="Options"></td>';    
	main +='<TD><INPUT class=pbButton ID=pbOptions_Layout type=submit value="Layout"></td>';
	main +='<TD><INPUT class=pbButton ID=pbOptions_Log type=submit value="Log"></td>';
	main +='<TD><INPUT class=pbButton ID=pbOptions_Dashboard type=submit value="Dashboard"></td>';
	main +='<TD><INPUT class=pbButton ID=pbOptions_Spam type=submit value="Spam"></td>';
	main +='<TD><INPUT class=pbButton ID=pbOptions_Export type=submit value="Export"></td></tr></table><HR class=ptThin>';
    main +='<DIV id=pbOptOutput style="margin-top:10px; height:650px; overflow:auto;"></div>';
    t.cont.innerHTML = main;
    t.Overv = document.getElementById('pbOptOutput');
    
    document.getElementById('pbOptions_Options').addEventListener('click', e_butSubtab, false);
    document.getElementById('pbOptions_Layout').addEventListener('click', e_butSubtab, false);
    document.getElementById('pbOptions_Log').addEventListener('click', e_butSubtab, false);
    document.getElementById('pbOptions_Dashboard').addEventListener('click', e_butSubtab, false);
    document.getElementById('pbOptions_Spam').addEventListener('click', e_butSubtab, false);
    document.getElementById('pbOptions_Export').addEventListener('click', e_butSubtab, false);
	

	window.addEventListener('unload', t.onUnload, false);  
	var a = JSON2.parse(GM_getValue ('log_'+getServerId(), '[]'));
    if (matTypeof(a) == 'array') t.last250 = a;
 
    changeSubtab (document.getElementById('pbOptions_'+Options.curOptTab));
    
    function e_butSubtab (evt){            
      changeSubtab (evt.target);   
    }

    function changeSubtab (but){
      if (but == t.curTabBut)
        return;
      if (t.curTabBut){
        t.curTabBut.className='pbButton'; 
        t.curTabBut.disabled=false;
      }
      t.curTabBut = but;
      but.className='pbButton_selected'; 
      but.disabled=true;
      t.curTabName = but.id.substr(10);
	  Options.curOptTab = t.curTabName;
      t.show();
    }
  },

  Options: function(){
  	var t= Tabs.Options;
	 try {      
      m = '<DIVstyle="height:650px; max-height:650px; overflow-y:auto"><TABLE class=pbTab width=100% class=pbTab cellspacing=0 cellpadding=0>\
        <TR><TD colspan=2><B>'+translate("AIO Script Config:")+'</b></td></tr>\
        <TR><TD width=30px>&nbsp;&nbsp;&nbsp;-</td><TD style="max-width:150px;word-break:break-all;">Global Rallypoint setting (Crest/DF/Attack/Transport/Reassign) - Keep <INPUT id=pbRPClip type=text size=1 maxlength=1> rallypoint slots free.</td></tr>\
        <TR><TD><INPUT id=pballowWinMove type=checkbox /></td><TD>'+translate("Enable window drag (move window by dragging top bar with mouse)")+'</td></tr>\
        <TR><TD><INPUT id=pbTrackWinOpen type=checkbox /></td><TD>'+translate("Remember window open state on refresh")+'</td></tr>\
        <TR><TD><INPUT id=pbHideOnGoto type=checkbox /></td><TD>'+translate("Hide window when clicking on map coordinates")+'</td></tr>\
        <TR><TD><INPUT id=pbWideOpt type=checkbox '+ (GlobalOptions.pbWideScreen?'CHECKED ':'') +'/></td><TD>'+translate("Enable widescreen style:")+' '+ htmlSelector({normal:'Normal', wide:'Widescreen', ultra:'Ultra'},GlobalOptions.pbWideScreenStyle,'id=selectScreenMode') +' '+translate("(all domains, requires refresh)")+'</td></tr>\
        <TR><TD><INPUT id=pbsendmeaway type=checkbox '+ (GlobalOptions.pbNoMoreKabam?'CHECKED ':'')+'/></td><TD>'+translate("Send me away from Kabam!")+'</td></tr>\
        <TR><TD>&nbsp;&nbsp;&nbsp;-</td><TD>'+translate("Change window transparency between \"0.7 - 2\" ")+'&nbsp <INPUT id=pbtogOpacity type=text size=3 /> <span style="color:#800; font-weight:bold"><sup>'+translate("*Requires Refresh")+'</sup></span></td></tr>\
        <TR><TD colspan=2><BR><B>'+translate("KofC Features:")+'</b></td></tr>\
        <TR><TD><INPUT id=pbFairie type=checkbox /></td><TD>'+translate("Disable annoying Faire and Court popups")+'</td></tr>\
        <TR><TD><INPUT id=pbWatchEnable type=checkbox '+ (GlobalOptions.pbWatchdog?'CHECKED ':'') +'/></td><TD>'+translate("Refresh if KOC not loaded within 1 minute (all domains)")+'</td></tr>\
        <TR><TD><INPUT id=pbEveryEnable type=checkbox /></td><TD>'+translate("Refresh KOC every")+' <INPUT id=pbeverymins type=text size=2 maxlength=3> '+translate("minutes")+'</td></tr>\
        <TR><TD><INPUT id=pbChatREnable type=checkbox /></td><TD>'+translate("Put chat on right (requires wide screen)")+'</td></tr>\
        <TR><TD><INPUT id=pbWMapEnable type=checkbox /></td><TD>'+translate("Use WideMap (requires wide screen)")+'</td></tr>\
        <TR><TD><INPUT id=pbGoldEnable type=checkbox /></td><TD>'+translate("Auto collect gold when happiness reaches")+' <INPUT id=pbgoldLimit type=text size=2 maxlength=3 \>%</td></tr>\
        <TR><TD><INPUT id=pbFoodToggle type=checkbox /></td><TD>'+translate("Enable Food Alert (on less than 6 Hours of food. Checked every hour)")+'</td></tr>\
        <TR><TD><INPUT id=pbAntiCheat type=checkbox /></td><TD>Disable \"You have Koc open in a newer window\" pop-up:<br/><b>(Use at own risk, you will be logged by kabam for this method)</b></td></tr>\
        <TR><TD><INPUT id=pbSummonToggle type=checkbox /></td><TD>'+translate("Hide Summoning Circle (Refresh needed)")+'</td></tr>\
        <TR><TD colspan=2><BR><B>'+translate("Extra Features")+':</b></td></tr>\
        <TR><TD><INPUT id=HelReq type=checkbox /></td><TD width=100px>'+translate("Help alliance build/research posts")+'</td><TD  width=30px><INPUT id=DelReq type=checkbox /></td><TD>'+translate("Hide alliance requests in chat")+'</td></tr>\
        <TR><TD><INPUT id=PubReq type=checkbox '+ (GlobalOptions.autoPublishGamePopups?'CHECKED ':'') +'/></td><TD>'+translate("Auto HIDE Facebook posts")+'</td><TD><INPUT id=MapExtra type=checkbox /></td><TD>'+translate("Show Player & Might in map")+'.</td></tr>\
        <TR><TD><INPUT id=deletetoggle type=checkbox /></td><TD> '+translate("Auto delete barb/transport reports from you")+'</td><TD><INPUT id=deletes0toggle type=checkbox /></td><TD> '+translate("Auto delete transport reports to you")+'</td></tr>\
        <TR><TD><INPUT id=deletes1toggle type=checkbox /></td><TD> '+translate("Auto delete wild reports")+'</td><TD><INPUT id=deletes2toggle type=checkbox /></td><TD> '+translate("Auto delete crest reports regardless of target type")+'</td></tr>\
        <TR><TD><INPUT id=deletes3toggle type=checkbox /></td><TD> '+translate("Auto delete DF reports")+'</td><TD><INPUT id=MAgicBOx type=checkbox /></td><TD> '+translate("Kill merlins magic box's on startup")+'</td></tr>\
        <TR><TD><INPUT id=ptEnableWisperAlert type=checkbox /></td><TD>Enable sound alert on whisper</td><TD><INPUT id=ptEnableTowerAlert type=checkbox /></td><TD>Enable sound alert on tower alert in chat</td></tr>\
        </table><BR><TABLE class=pbTab><TR><TD rowspan=2><select multiple size="4" id="ExcludeMembers" style="width:200px"></td><TD></select><SPAN><INPUT type=submit id="RemoveFilter" value="Remove"></td></tr>\
        <TR><TD>Attack reports from the user(s) in this list will <B>automatically</b> be deleted! Add users to this list with the \"Player Search Tab\".</td></tr></table>\
        <HR>'+strButton20(translate('Reset ALL Options'), 'id=ResetALLOPT') + '</div>';
     t.Overv.innerHTML = m;
     //
      document.getElementById('selectScreenMode').addEventListener ('change', function(){
              GlobalOptions.pbWideScreenStyle = document.getElementById('selectScreenMode').value;
              GM_setValue ('Options_??', JSON2.stringify(GlobalOptions));
      },false);    
      document.getElementById('PubReq').addEventListener ('change', function(){
              GlobalOptions.autoPublishGamePopups = document.getElementById('PubReq').checked;
            GM_setValue ('Options_??', JSON2.stringify(GlobalOptions));
      },false);    
      document.getElementById('pbsendmeaway').addEventListener ('click', function(){
            GlobalOptions.pbNoMoreKabam = document.getElementById('pbsendmeaway').checked;
            GM_setValue ('Options_??', JSON2.stringify(GlobalOptions));
      },false);    
      document.getElementById('RemoveFilter').addEventListener ('click', function(){
      	if (document.getElementById('ExcludeMembers').value!="") Options.PlayerFilter.splice(document.getElementById('ExcludeMembers').value,1);
      	t.PaintFilterList();
      },false);

      document.getElementById('ResetALLOPT').addEventListener ('click', function(){
              var serverID = getServerId();
              RemoveList = (GM_listValues());
              for (i=0;i<RemoveList.length;i++){
                  GM_deleteValue(RemoveList[i]);
              }
              ResetAll=true;
              reloadKOC();
      },false);

      document.getElementById('pbWatchEnable').addEventListener ('change', t.e_watchChanged, false);
      document.getElementById('pbWideOpt').addEventListener ('change', t.e_wideChanged, false);
      t.changeOpt ('pbtogOpacity', 'Opacity');
      t.changeOpt ('pbRPClip', 'RPClip');
      t.togOpt ('pballowWinMove', 'pbWinDrag', mainPop.setEnableDrag);
      t.togOpt ('pbTrackWinOpen', 'pbTrackOpen');
      t.togOpt ('pbHideOnGoto', 'hideOnGoto');
      t.togOpt ('pbFairie', 'pbKillFairie', FairieKiller.setEnable);
      t.togOpt ('pbGoldEnable', 'pbGoldEnable', CollectGold.setEnable);
      t.changeOpt ('pbgoldLimit', 'pbGoldHappy');
      t.togOpt ('pbFoodToggle', 'pbFoodAlert');
      t.togOpt ('pbAntiCheat', 'pbAntiCheat');
      t.togOpt ('pbSummonToggle', 'pbSummonToggle');
      t.changeOpt ('pbeverymins', 'pbEveryMins' , RefreshEvery.setTimer);
      t.togOpt ('pbEveryEnable', 'pbEveryEnable', RefreshEvery.setEnable);
      t.togOpt ('pbChatREnable', 'pbChatOnRight', WideScreen.setChatOnRight);
      t.togOpt ('pbWMapEnable', 'pbWideMap', WideScreen.useWideMap);
      t.togOpt ('pbEveryEnable', 'pbEveryEnable', RefreshEvery.setEnable);
      t.togOpt ('HelReq', 'HelpRequest');
      t.togOpt ('DelReq', 'DeleteRequest');
      t.togOpt ('MapExtra', 'MapShowExtra');
      t.togOpt ('deletetoggle', 'DeleteMsg');
      t.togOpt ('deletes0toggle', 'DeleteMsgs0');
      t.togOpt ('deletes1toggle', 'DeleteMsgs1');
      t.togOpt ('deletes2toggle', 'DeleteMsgs2'); 
      t.togOpt ('deletes3toggle', 'DeleteMsgs3');
      t.togOpt ('MAgicBOx', 'KMagicBox');
      t.togOpt ('ptEnableWisperAlert', 'enableWhisperAlert');
      t.togOpt ('ptEnableTowerAlert', 'enableTowerAlert'); 
      t.PaintFilterList();  
    } catch (e) {}  		
  },

  PaintFilterList:function(){
  	 document.getElementById('ExcludeMembers').options.length=0; 
   	  for (var i=0;i<Options.PlayerFilter.length;i++){
	        if (Options.PlayerFilter[i]["uid"] !=undefined){
	            var o = document.createElement("option");
	            o.text = Options.PlayerFilter[i]["name"];
	            o.value = i;
	            document.getElementById("ExcludeMembers").options.add(o);
	        }
	  }          
  },

  spam: function(){
  	var t=Tabs.Options;
  	var m = '<DIV class=pbStat>Advertise</div><TABLE class=pbTab width=100% height=0% ><TR align="center">';
  	m+='<TD><INPUT class="buttonDash_'+ (Options.spamconfig.aspam?'ON':'OFF') +'" id=pbSpamEnable type=submit value="'+translate("Spam")+' = '+ (Options.spamconfig.aspam?'ON':'OFF')+'"></td>';
       if (Options.spamconfig.spamstate == 'a') m += '<TD><INPUT id=pbSpamState type=submit class=pbButton value="Send To Alliance"></td>';
        else m += '<TD><INPUT id=pbSpamState type=submit class=pbButton value="Send To  Global "></td>';
        m += '</tr></table></div>';
       m += '<DIV class=pbStat>Settings</div><TABLE class=pbTab>';
        m += '<tr><td>Automatically post every <INPUT id=pbSpamMin type=text size=2 maxlength=3 value="'+ Options.spamconfig.spammins +'"  \> minutes</td></tr><BR>\
              <tr><TD><TABLE cellpadding=0 cellspacing=0>\
              <TD align=left>Your spam: &nbsp; </td><TD><INPUT id=pbSpamAd type=text size=60 maxlength=500 value="'+ Options.spamconfig.spamvert +'" \></td></tr>\
              </table><BR>';
    
    t.Overv.innerHTML = m;

    document.getElementById('pbSpamEnable').addEventListener ('click', function(){t.toggleon(this);}, false);
    document.getElementById('pbSpamAd').addEventListener ('change', t.e_spamOptChanged, false);
    document.getElementById('pbSpamMin').addEventListener ('change', t.e_spamOptChanged, false);
    document.getElementById('pbSpamState').addEventListener ('click', function(){t.togglespam(this);}, false);
  },

  Paintlog: function(){
  	var t=Tabs.Options;
  	t.Overv.innerHTML = '<DIV class=pbStat>ACTION LOG - VERSION: '+ Version+'</div><DIV style="height:600px;max-height:600px;max-width:500px:overflow-y:auto;overflow-x:auto">\
      <TABLE cellpadding=0 cellspacing=0 id=pbactionlog class=pbTabLined><TR><TD></td><TD width=95%></td></table></div>';
    t.logTab = document.getElementById('pbactionlog');  
    t.state = 1;
    for (var i=0; i<t.last250.length; i++) t._addTab (t.last250[i].msg, t.last250[i].ts);
  },

   _addTab : function (msg, ts){
    var t = Tabs.Options;
    if (t.state != 1) return;
    if (t.logTab.rows.length >= t.maxEntries) t.logTab.deleteRow(t.maxEntries-1);
    var row = t.logTab.insertRow(0);
    row.vAlign = 'top';
    row.insertCell(0).innerHTML = ts;
    row.insertCell(1).innerHTML = msg;
  },
  
  log : function (msg){
    var t = Tabs.Options;
    var ts = new Date().toTimeString().substring (0,8);
    t._addTab (msg, ts);
    while (t.last250.length >= 250) t.last250.shift();
    t.last250.push ({msg:msg, ts:ts});
  },

  Layout :function (){
    var t = Tabs.Options;  
    saveColors();
    try {      
      m= '<TABLE class=ptTab>';
	  m+='<TR><TD colspan=2><U><B>Chat Layout:</b></u></td></tr>';
	  m+='<TR><TD><INPUT id=togChatStuff type=checkbox /></td><TD>Enable Chat Enable Chat enhancements (clickable coords, click on icon to whisper, colors).</td></tr>';
      m+='<TR><TD><INPUT id=togChatGlobal type=checkbox /></td><TD>Enable Global chat background color.</td></tr>';
	  m+='<TR><TD><INPUT id=togChatWhisper type=checkbox /></td><TD>Enable Whisper in Color Font.</td></tr>';
	  m+='<TR><TD><INPUT id=togChatBold type=checkbox /></td><TD>Enable Chat in Bold Font.</td></tr>';
	  m+='<TR><TD><INPUT id=togChatAttack type=checkbox /></td><TD>Enable background color on tower alert.</td></tr>';
	  m+='<TR><TD><INPUT id=togChatLead type=checkbox /></td><TD>Enable background for alliance Leaders.<SPAN class=boldRed>&nbsp;(NEW)</span></td></tr></table>';

	  m+='<TABLE class=ptTab><BR><TR><TD colspan=2><U><B>Colors: &nbsp;(Refresh for effect)</b></u></td></tr>';
      m+='<TR><TD>Chat Color - Global: </td><TD><INPUT id=togGlobal type=text size=7 maxlength=7 value="'+Colors.ChatGlobal+'"></td>&nbsp;<TD style="background-color:'+Colors.ChatGlobal+'" width=30px>&nbsp;</td></tr>';
	  m+='<TR><TD>Chat Color - Alliance: </td><TD><INPUT id=togAll type=text size=7 maxlength=7 value="'+Colors.ChatAll+'"></td>&nbsp;<TD style="background-color:'+Colors.ChatAll+'" width=30px>&nbsp;</td></tr>';
      m+='<TR><TD>Chat Color - Tower Alert: </td><TD><INPUT id=togChatAtt type=text size=7 maxlength=7 value="'+Colors.ChatAtt+'"></td>&nbsp;<TD style="background-color:'+Colors.ChatAtt+'" width=30px>&nbsp;</td></tr>';
      m+='<TR><TD>Chat Color - Whisper Alert: </td><TD><INPUT id=togWhisper type=text size=7 maxlength=7 value="'+Colors.ChatWhisper+'"></td>&nbsp;<TD style="background-color:'+Colors.ChatWhisper+'" width=30px>&nbsp;</td></tr>';
      m+='<TR><TD>Chat Color - Chancy: </td><TD><INPUT id=togChatC type=text size=7 maxlength=7 value="'+Colors.ChatChancy+'"></td>&nbsp;<TD style="background-color:'+Colors.ChatChancy+'" width=30px>&nbsp;</td></tr>';
      m+='<TR><TD>Chat Color - Vice-C: </td><TD><INPUT id=togChatVC type=text size=7 maxlength=7 value="'+Colors.ChatVC+'"></td>&nbsp;<TD style="background-color:'+Colors.ChatVC+'" width=30px>&nbsp;</td></tr>';
      m+='<TR><TD>Chat Color - Officers: </td><TD><INPUT id=togChatLeaders type=text size=7 maxlength=7 value="'+Colors.ChatLeaders+'"></td>&nbsp;<TD style="background-color:'+Colors.ChatLeaders+'" width=30px>&nbsp;</td></tr>';
	  
	  
      m+='<TR><TD>General - Dark Row: </td><TD><INPUT id=togDarkRow type=text size=7 maxlength=7 value="'+Colors.DarkRow+'"></td>&nbsp;<TD style="background-color:'+Colors.DarkRow+'" width=30px>&nbsp;</td></tr>';
      m+='<TR><TD>General - Button Selected: </td><TD><INPUT id=togButClick type=text size=7 maxlength=7 value="'+Colors.ButtonSelected+'"></td>&nbsp;<TD style="background-color:'+Colors.ButtonSelected+'" width=30px>&nbsp;</td></tr>';
     
      m+='<TR><TD>Overview - Dark Rows:</td><TD><INPUT id=togOverDarkRow type=text size=7 maxlength=7 value="'+Colors.OverviewDarkRow+'"></td>&nbsp;<TD style="background-color:'+Colors.OverviewDarkRow+'" width=30px>&nbsp;</td></tr>';
	  m+='<TR><TD>Transparency:&nbsp;&nbsp;<span style="color:#800;"><sup>(0.7 - 2)</sup></span></td><TD><INPUT id=togOpacity type=text size=3 maxlength=3 value="'+Colors.Opacity+'"/></td><TD></tr>';
	  
      m+='</table><BR><BR><DIV>HTML colors:&nbsp;&nbsp;&nbsp;';
      m+='<a href="http://www.colorpicker.com/" target="_blank">Color Picker</a>&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;&nbsp;';
      m+='<a href="http://www.w3schools.com/html/html_colors.asp" target="_blank">Colors</a>';
      m+='</table><BR><BR><HR>To apply colors you need to REFRESH!<BR>';
      m+= strButton20('Reset Colors', 'id=ResetALL');
      t.Overv.innerHTML = m;
            
      t.togOpt ('togChatStuff', 'chatEnhance', ChatStuff.setEnable, ChatStuff.isAvailable);
      t.togOpt ('togChatGlobal', 'chatglobal');
      t.togOpt ('togChatWhisper', 'chatwhisper');	
      t.togOpt ('togChatBold', 'chatbold');
      t.togOpt ('togChatAttack', 'chatAttack');
      t.togOpt ('togChatLead', 'chatLeaders');
      
      document.getElementById('togGlobal').addEventListener('change', function(){Colors.ChatGlobal = document.getElementById('togGlobal').value;t.Layout()}, false);
      document.getElementById('togChatLeaders').addEventListener('change', function(){Colors.ChatLeaders = document.getElementById('togChatLeaders').value;t.Layout()}, false);
      document.getElementById('togChatC').addEventListener('change', function(){Colors.ChatChancy = document.getElementById('togChatC').value;t.Layout()}, false);
      document.getElementById('togChatVC').addEventListener('change', function(){Colors.ChatVC = document.getElementById('togChatVC').value;t.Layout()}, false);
      document.getElementById('togDarkRow').addEventListener('change', function(){Colors.DarkRow = document.getElementById('togDarkRow').value;t.Layout()}, false);
      document.getElementById('togButClick').addEventListener('change', function(){Colors.ButtonSelected = document.getElementById('togButClick').value;t.Layout()}, false);
      document.getElementById('togOverDarkRow').addEventListener('change', function(){Colors.OverviewDarkRow = document.getElementById('togOverDarkRow').value;t.Layout()}, false);
      document.getElementById('togAll').addEventListener('change', function(){Colors.ChatAll = document.getElementById('togAll').value;t.Layout()}, false);
      document.getElementById('togChatAtt').addEventListener('change', function(){Colors.ChatAtt = document.getElementById('togChatAtt').value;t.Layout()}, false);
      document.getElementById('togWhisper').addEventListener('change', function(){Colors.ChatWhisper = document.getElementById('togWhisper').value;t.Layout()}, false);
      document.getElementById('togOpacity').addEventListener('change', function(){Colors.Opacity = document.getElementById('togOpacity').value;t.Layout()}, false);
      document.getElementById('ResetALL').addEventListener ('click', function(){
      		RemoveList = (GM_listValues());
      		for (i=0;i<RemoveList.length;i++){
      			if (RemoveList[i] == "Colors") GM_deleteValue(RemoveList[i]);
      		}
      		ResetColors=true;
      		reloadKOC();
      },false);	
      
    } catch (e) {
      t.cont.innerHTML = '<PRE>'+ e.name +' : '+ e.message +'</pre>';  
    }
  },
  
  Dashboard :function (){
    var t = Tabs.Options;  
    try {      
     	var left = '<TABLE id=pbDashOpts width=100% class=pbTab><TR>';
        left += '<TR><TD colspan=2>Show warnings when resources are below:</td></tr>';
        left += '<TR><TD style="width:50px;"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/food_30.png"></td><TD><INPUT id=pbFoodWarning size=13 maxLength=12 type=text value='+DashboardOptions.foodLevel+'></td></tr>';
        left += '<TR><TD style="width:50px;"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/wood_30.png"></td><TD><INPUT id=pbWoodWarning size=13 maxLength=12 type=text value='+DashboardOptions.woodLevel+'></td></tr>';
        left += '<TR><TD style="width:50px;"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/stone_30.png"></td><TD><INPUT id=pbStoneWarning size=13 maxLength=12 type=text value='+DashboardOptions.stoneLevel+'></td></tr>';
        left += '<TR><TD style="width:50px;"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/iron_30.png"></td><TD><INPUT id=pbOreWarning size=13 maxLength=12 type=text value='+DashboardOptions.oreLevel+'></td></tr>';
        left += '<TR><TD style="width:50px;"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/aetherstone_30.png"><TD><INPUT id=pbAStoneWarning size=8 maxLength=7 type=text value='+DashboardOptions.astoneLevel+'></td></tr></table>';
        var right = '<TABLE id=pbDashOptsSel width=100% class=pbTab>';
        right += '<TR><TD colspan=2>Select options you want to see in dashboard: (Refresh after toggle!)</td></tr>';
        right += '<TR><TD colspan=3><INPUT id=pbShowThrone type=checkbox '+(DashboardOptions.showThrone?'CHECKED':'')+'>&nbsp; Show Throne Presets</td></tr>';
        right += '<TR><TD colspan=3><INPUT id=pbShowRP type=checkbox '+(DashboardOptions.showRP?'CHECKED':'')+'>&nbsp; Show Rally Point Slots</td></tr>';
        right += '<TR><TD colspan=3><INPUT id=pbShowStatus type=checkbox '+(DashboardOptions.showStatus?'CHECKED':'')+'>&nbsp; Show City Defensive Status (Green off, Red on)</td></tr>';
        right += '<TR><TD colspan=3><INPUT id=pbShowTower type=checkbox '+(DashboardOptions.showTower?'CHECKED':'')+'>&nbsp; Show Tower Alerts</td></tr>';
        right += '<TR><TD colspan=3><INPUT id=pbShowWarnings type=checkbox '+(DashboardOptions.showWarnings?'CHECKED':'')+'>&nbsp; Show Warnings</td></tr>';
        right += '<TR><TD colspan=3><INPUT id=pbShowLog type=checkbox '+(DashboardOptions.showLog?'CHECKED':'')+'>&nbsp; Show Last 5 Log Items</td></tr>';
        right += '<TR><TD colspan=3><INPUT id=pbShowMarches type=checkbox '+(DashboardOptions.showMarches?'CHECKED':'')+'>&nbsp; Show Saved Marches</td></tr>';
        right +='</table>';
        var m = '<div class="pbStat">DASHBOARD OPTIONS</div><TABLE id=dbMain width=100% class=pbTab><TD>'+left+'</td><TD>'+right+'</td>';
        t.Overv.innerHTML = m;
        document.getElementById('pbFoodWarning').addEventListener('keyup',function(){DashboardOptions.foodLevel = this.value;saveDashboardOptions();},false);
        document.getElementById('pbWoodWarning').addEventListener('keyup',function(){DashboardOptions.woodLevel = this.value;saveDashboardOptions();},false);
        document.getElementById('pbStoneWarning').addEventListener('keyup',function(){DashboardOptions.stoneLevel = this.value;saveDashboardOptions();},false);
        document.getElementById('pbOreWarning').addEventListener('keyup',function(){DashboardOptions.oreLevel = this.value;saveDashboardOptions();},false);
        document.getElementById('pbAStoneWarning').addEventListener('keyup',function(){DashboardOptions.astoneLevel = this.value;saveDashboardOptions();},false);
        document.getElementById('pbShowThrone').addEventListener('change',function(){DashboardOptions.showThrone = document.getElementById('pbShowThrone').checked;saveDashboardOptions();},false);
        document.getElementById('pbShowRP').addEventListener('change',function(){DashboardOptions.showRP = document.getElementById('pbShowRP').checked;saveDashboardOptions();},false);
        document.getElementById('pbShowStatus').addEventListener('change',function(){DashboardOptions.showStatus = document.getElementById('pbShowStatus').checked;saveDashboardOptions();},false);
        document.getElementById('pbShowTower').addEventListener('change',function(){DashboardOptions.showTower = document.getElementById('pbShowTower').checked;saveDashboardOptions();},false);      
        document.getElementById('pbShowWarnings').addEventListener('change',function(){DashboardOptions.showWarnings = document.getElementById('pbShowWarnings').checked;saveDashboardOptions();},false);
        document.getElementById('pbShowLog').addEventListener('change',function(){DashboardOptions.showLog = document.getElementById('pbShowLog').checked;saveDashboardOptions();},false);
        document.getElementById('pbShowMarches').addEventListener('change',function(){DashboardOptions.showMarches = document.getElementById('pbShowMarches').checked;saveDashboardOptions();},false);     
    } catch (e) {
      t.cont.innerHTML = '<PRE>'+ e.name +' : '+ e.message +'</pre>';  
    }
  },
  
  Export :function (){
    var t = Tabs.Options;  
    try {      
     	var m = '<div class="pbStat">OPTIONS EXPORT TOOL</div>';
        m+='<TABLE align="center"><TD><input type="submit" value="Import" id="pbImport_submit"></td><TD><input type="submit" value="Export" id="pbexport_submit"></td></table>';
        m+= '<BR><textarea type="text" id="pbImportData" rows=20 cols=80></textarea>';
         t.Overv.innerHTML = m;
        $('pbexport_submit').addEventListener('click', t.doExport, false);
        $('pbImport_submit').addEventListener('click', t.doImport, false);  
    } catch (e) {
      t.cont.innerHTML = '<PRE>'+ e.name +' : '+ e.message +'</pre>';  
    }
  },
  doImport: function (){
      var t = Tabs.Options;
      var serverID = getServerId();
      var Data = JSON2.parse(document.getElementById('pbImportData').value);
      if (Data.TransportOptions != {}) Tabs.transport.tradeRoutes = Data.TransportOptions;
      Tabs.transport.saveTradeRoutes();
      if (Data.TransportState != {}) Tabs.transport.traderState = Data.TransportState;
      Tabs.transport.saveTraderState();
      if (Data.ReassignRoutes != {}) Tabs.Reassign.reassignRoutes = Data.ReassignRoutes;
      Tabs.Reassign.saveReassignRoutes();
      for (i=0;i<Seed.cities.length;i++) if (Data["Build" + (i+1)].length > 0) Tabs.build["bQ_" + Seed.cities[i][0]] = Data["Builds" + (i+1)];
      if (Data.Options != {}) Options = Data.Options;
      saveOptions();
      if (Data.GlobalOptions != {}) GlobalOptions = Data.GlobalOptions;
      GM_setValue ('Options_??', JSON2.stringify(GlobalOptions));
      if (Data.ThroneOptions != {}) ThroneOptions = Data.ThroneOptions;
      saveThroneOptions();
      if (Data.TrainOptions != {}) TrainOptions = Data.TrainOptions;
      saveTrainOptions();
      if (Data.ApothecaryOptions != {}) ApothecaryOptions = Data.ApothecaryOptions;
      if (Data.FarmOptions != {}) FarmOptions = Data.FarmOptions;
      saveFarmOptions();
      if (Data.MarchOptions != {}) MarchOptions = Data.MarchOptions;
      saveMarchOptions();
      if (Data.Colors != {}) Colors = Data.Colors;
      saveColors();
      if (Data.ChatIcons != {}) ChatIcons = Data.ChatIcons;
      saveChatIcons();
      if (Data.CraftOptions != {}) CraftOptions = Data.CraftOptions;
      saveCraftOptions();
      if (Data.AtkOptions != {}) AtkOptions = Data.AtkOptions;
      saveAtkOptions();
      if (Data.DFOptions != {}) DFOptions = Data.DFOptions;
      saveDFOptions();
      if (Data.CrestOptions != {}) CrestOptions = Data.CrestOptions;
      saveCrestOptions();
      reloadKOC();    
    },
    doExport: function (){
      var t = Tabs.Options;
      var serverID = getServerId();
      for (i=0;i<Seed.cities.length;i++) t.Data["Build" + (i+1)] = JSON2.parse(GM_getValue('bQ_' + serverID + '_' + Seed.cities[i][0]));
      t.Data.TransportOptions = Tabs.transport.tradeRoutes;
      t.Data.TransportState = Tabs.transport.traderState
      t.Data.Options = Options;
      t.Data.GlobalOptions = GlobalOptions;
      t.Data.ThroneOptions = ThroneOptions;
      t.Data.CrestOptions = CrestOptions;
      t.Data.TrainOptions = TrainOptions;
      t.Data.DFOptions = DFOptions;
      t.Data.ApothecaryOptions = ApothecaryOptions;
      t.Data.FarmOptions = FarmOptions;
      t.Data.MarchOptions = MarchOptions;
      t.Data.ReassignRoutes = Tabs.Reassign.reassignRoutes;
      t.Data.Colors = Colors;
      t.Data.ChatIcons = ChatIcons;
      t.Data.CraftOptions = CraftOptions;
      t.Data.AtkOptions = AtkOptions;
      document.getElementById('pbImportData').value = JSON2.stringify(t.Data);
      document.getElementById('pbImportData').select();
    },
  
  togOpt : function (checkboxId, optionName, callOnChange){
    var t = Tabs.Options;
    var checkbox = document.getElementById(checkboxId);
    if (Options[optionName]) checkbox.checked = true;
    checkbox.addEventListener ('change', eventHandler, false);
    function eventHandler (){
      Options[optionName] = this.checked;
      saveOptions();
      if (callOnChange) callOnChange (this.checked);
    }
  },
  
  changeOpt : function (valueId, optionName, callOnChange){
    var t = Tabs.Options;
    var e = document.getElementById(valueId);
    e.value = Options[optionName];
    e.addEventListener ('change', eventHandler, false);
    function eventHandler (){
      Options[optionName] = this.value;
      saveOptions();
      if (callOnChange) callOnChange (this.value);
    }
  },
  
  e_watchChanged : function (){
    GlobalOptions.pbWatchdog = document.getElementById('pbWatchEnable').checked;
    GM_setValue ('Options_??', JSON2.stringify(GlobalOptions));  
  },
  
  e_wideChanged : function (){
    GlobalOptions.pbWideScreen = document.getElementById('pbWideOpt').checked;
    GM_setValue ('Options_??', JSON2.stringify(GlobalOptions));  
  },
  
  e_updateChanged : function (){
    GlobalOptions.pbupdate = document.getElementById('pbupdate').checked;
    GM_setValue ('Options_??', JSON2.stringify(GlobalOptions));  
  },

  e_spamOptChanged : function (){
  var t = Tabs.Spam;
  Options.spamconfig.spamvert = document.getElementById('pbSpamAd').value;
  Options.spamconfig.spammins = document.getElementById('pbSpamMin').value;
  if(parseInt(Options.spamconfig.spammins) < 30){
   Options.spamconfig.spammins = 30;
   document.getElementById('pbSpamMin').value = 30;
  }
  saveOptions ();
 },

 togglespam: function(obj){
  if (Options.spamconfig.spamstate == 'a') {
   Options.spamconfig.spamstate = 'g';
   obj.value = "Send To  Global ";
  }
  else {
   Options.spamconfig.spamstate = 'a';
   obj.value = "Send To Alliance";
  }
  saveOptions ();
 },

 toggleon: function(obj){
  if (Options.spamconfig.aspam == true) {
   Options.spamconfig.aspam = false;
   obj.value = "Spam Off";
   obj.setAttribute("class", "buttonDash_OFF");
  }
  else {
   Options.spamconfig.aspam = true;	
   obj.value = "Spam On";
   obj.setAttribute("class", "buttonDash_ON");
   SpamEvery.init();
  }
  saveOptions ();
 },

  hide : function (){
  },

  show : function (){
  	 var t = Tabs.Options;
  	 switch (t.curTabName){
  	 	case 'Options': t.Options();break;
  	 	case 'Layout': t.Layout();break;
  	 	case 'Log': t.Paintlog();break;
  	 	case 'Dashboard': t.Dashboard();break; 
  	 	case 'Spam': t.spam();break;
  	 	case 'Export': t.Export();break; 	
  	 }   

  },

  onUnload : function (){
    var t = Tabs.Options;
    if (!ResetAll) GM_setValue ('log_'+getServerId(), JSON2.stringify(t.last250));
  },
  
}

/****************************  Reassign Implementation  *******************************/
var troops = {1:'SupplyTroops',
              2:'Militiaman',
              3:'Scout',
              4:'Pikeman',
              5:'Swordsman',
              6:'Archer',
              7:'Cavalry',
              8:'HeavyCavalry',
              9:'SupplyWagon',
              10:'Ballista',
              11:'BatteringRam',
              12:'Catapult'};  

Tabs.Reassign = {
  tabOrder: 30,
  tabLabel: 'Reassign',
  myDiv: null,
  timer: null,
  reassignState: [],
  lRE: [],
  reassignRoutes: [],
  rallypointlevel:null,
  count:0,
  check:false,

    init: function(div){
        var t = Tabs.Reassign;
        t.myDiv = div;
        t.reassignState = {
            running: false,
        };
        t.readReassignState();
        t.readReassignRoutes();
        t.e_reassignRoutes();

      var m = '<DIV id=pbReMainDivF class=pbStat>'+translate("AUTOMATED REASSIGN FUNCTION")+'</div><TABLE id=pbtraderfunctions width=100% height=0% class=pbTab><TR align="center">';
      m+='<TD><INPUT class="buttonDash_'+ (t.reassignState.running?'ON':'OFF') +'" id=pbReassignState type=submit value="'+translate("Reassign")+' = '+ (t.reassignState.running?'ON':'OFF')+'"></td>';
      m += '<TD><INPUT id=pbReassShowRoutes type=submit class=pbButton value="Show Routes"></td>';
      m += '</tr></table></div>';
      m += '<DIV id=pbReassignDivD class=pbStat>'+translate("ADD REASSIGN ROUTE")+'</div>';

      m += '<TABLE id=pbaddreasignroute width=95% height=0% class=pbTab><TR align="left">';
      m += '<TD width=20px>'+translate("From City:")+'</td> <TD width=310px><DIV style="margin-bottom:10px;"><span id=ptassigncity></span></div></td></tr>';

      m += '<TR align="left">';
      m += '<TD width=20px>'+translate("To City:")+'</td> <TD width=310px><DIV style="margin-bottom:10px;"><span id=ptassigncityTo></span></div></td>';
      
        m += '<TR align="left">';
        m += '<TD colspan=4>'+translate("Check reassign every:")+' <INPUT id=pbreassigninterval type=text size=2 value="'+Options.reassigninterval+'"\> '+translate("minutes")+'</td></tr>';
        m += '<TR><TD><INPUT id=autofilloff type=checkbox unchecked=true\> '+translate("Lock troop values")+'</TR></TD></table>';
      m += '<DIV style="margin-top:10px;margin-bottom:5px;">'+translate("Fill in the number of troops you want to keep in a city:")+'</div>';
      m += '<TABLE id=pbaddreasignroute width=100% height=0% class=pbTab><TR align="center">';
      
      m += '<TR><TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_1_50.jpg?6545?6545"></td>';
      m += '<TD>'+translate("Supply Troop")+'</td>'
      m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_2_50.jpg?6545?6545"></td>'
      m += '<TD>'+translate("Militiaman")+'</td>'
      m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_3_50.jpg?6545?6545"></td>'
      m += '<TD>'+translate("Scout")+'</td>'
      m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_4_50.jpg?6545?6545"></td>'
      m += '<TD>'+translate("Pikeman")+'</td></tr>'
      m += '<TR><TD><INPUT id=pbSupplyTroops type=checkbox unchecked=true\>';
      m += '<INPUT id=pbtargetSupplyTroops disabled=true type=text size=10 maxlength=10 value="0"\></td>';
      m += '<TD><INPUT id=pbMilitiaman type=checkbox unchecked=true\>';
      m += '<INPUT id=pbtargetMilitiaman disabled=true type=text size=10 maxlength=10 value="0"\></td>';
      m += '<TD><INPUT id=pbScout type=checkbox unchecked=true\>';
      m += '<INPUT id=pbtargetScout disabled=true type=text size=10 maxlength=10 value="0"\></td>';
      m += '<TD><INPUT id=pbPikeman type=checkbox unchecked=true\>';
      m += '<INPUT id=pbtargetPikeman disabled=true type=text size=10 maxlength=10 value="0"\></td></tr>';
      
      m += '<TR><TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_5_50.jpg?6545?6545"></td>';
      m += '<TD>'+translate("Swordsman")+'</td>'
      m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_6_50.jpg?6545?6545"></td>'
      m += '<TD>'+translate("Archer")+'</td>'
      m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_7_50.jpg?6545?6545"></td>'
      m += '<TD>'+translate("Cavalry")+'</td>'
      m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_8_50.jpg?6545?6545"></td>'
      m += '<TD>'+translate("Heavy Cavalry")+'</td></tr>'
      m += '<TR><TD><INPUT id=pbSwordsman type=checkbox unchecked=true\>';
      m += '<INPUT id=pbtargetSwordsman disabled=true type=text size=10 maxlength=10 value="0"\></td>';
      m += '<TD><INPUT id=pbArcher type=checkbox unchecked=true\>';
      m += '<INPUT id=pbtargetArcher disabled=true type=text size=10 maxlength=10 value="0"\></td>';
      m += '<TD><INPUT id=pbCavalry type=checkbox unchecked=true\>';
      m += '<INPUT id=pbtargetCavalry disabled=true type=text size=10 maxlength=10 value="0"\></td>';
      m += '<TD><INPUT id=pbHeavyCavalry type=checkbox unchecked=true\>';
      m += '<INPUT id=pbtargetHeavyCavalry disabled=true type=text size=10 maxlength=10 value="0"\></td></tr>';
      
      m += '<TR><TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_9_50.jpg?6545?6545"></td>';
      m += '<TD>'+translate("Supply Wagon")+'</td>'
      m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_10_50.jpg?6545?6545"></td>'
      m += '<TD>'+translate("Ballista")+'</td>'
      m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_11_50.jpg?6545?6545"></td>'
      m += '<TD>'+translate("Battering Ram")+'</td>'
      m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_12_50.jpg?6545?6545"></td>'
      m += '<TD>'+translate("Catapult")+'</td></tr>'
      m += '<TR><TD><INPUT id=pbSupplyWagon type=checkbox unchecked=true\>';
      m += '<INPUT id=pbtargetSupplyWagon disabled=true type=text size=10 maxlength=10 value="0"\></td>';
      m += '<TD><INPUT id=pbBallista type=checkbox unchecked=true\>';
      m += '<INPUT id=pbtargetBallista disabled=true type=text size=10 maxlength=10 value="0"\></td>';
      m += '<TD><INPUT id=pbBatteringRam type=checkbox unchecked=true\>';
      m += '<INPUT id=pbtargetBatteringRam disabled=true type=text size=10 maxlength=10 value="0"\></td>';
      m += '<TD><INPUT id=pbCatapult type=checkbox unchecked=true\>';
      m += '<INPUT id=pbtargetCatapult disabled=true type=text size=10 maxlength=10 value="0"\></td></tr></table>';
      
      m += '<DIV style="text-align:center; margin-top:15px"><INPUT id=pbSaveRouteReassign type=submit class=pbButton value="'+translate("Add Route")+'"></div>';
      
      t.myDiv.innerHTML = m;
      
      t.tcp = new CdispCityPicker ('ptreassign', document.getElementById('ptassigncity'), true, null, 0);
      t.tcpto = new CdispCityPicker ('ptreassignTo', document.getElementById('ptassigncityTo'), true);
      for(var k in troops) document.getElementById('pbtarget'+troops[k]).value = parseInt(Seed.units['city' + t.tcp.city.id]['unt'+k]);

      document.getElementById('ptassigncity').addEventListener('click', function(){if(document.getElementById('autofilloff').checked == false) for(var k in troops) document.getElementById('pbtarget'+troops[k]).value = parseInt(Seed.units['city' + t.tcp.city.id]['unt'+k]);}, false);
      document.getElementById('pbReassignState').addEventListener('click', function(){t.toggleReassignState(this);}, false);
      document.getElementById('pbSaveRouteReassign').addEventListener('click', function(){t.addReassignRoute();}, false);
      document.getElementById('pbReassShowRoutes').addEventListener('click', function(){t.showReassignRoutes();}, false);
      
      document.getElementById('pbreassigninterval').addEventListener('keyup', function(){
        if (isNaN(document.getElementById('pbreassigninterval').value)){ document.getElementById('pbreassigninterval').value=0 ;}
        Options.reassigninterval = document.getElementById('pbreassigninterval').value;
        saveOptions();
      }, false);
      
    document.getElementById('pbtargetSupplyTroops').addEventListener('keyup', function(){if (isNaN(document.getElementById('pbtargetSupplyTroops').value)) document.getElementById('pbtargetSupplyTroops').value=0 ;}, false);
    document.getElementById('pbtargetMilitiaman').addEventListener('keyup', function(){if (isNaN(document.getElementById('pbtargetMilitiaman').value)) document.getElementById('pbtargetMilitiaman').value=0 ;}, false);
    document.getElementById('pbtargetScout').addEventListener('keyup', function(){if (isNaN(document.getElementById('pbtargetScout').value)) document.getElementById('pbtargetScout').value=0 ;}, false);
    document.getElementById('pbtargetPikeman').addEventListener('keyup', function(){if (isNaN(document.getElementById('pbtargetPikeman').value)) document.getElementById('pbtargetPikeman').value=0 ;}, false);
    document.getElementById('pbtargetSwordsman').addEventListener('keyup', function(){if (isNaN(document.getElementById('pbtargetSwordsman').value)) document.getElementById('pbtargetSwordsman').value=0 ;}, false);
    document.getElementById('pbtargetArcher').addEventListener('keyup', function(){if (isNaN(document.getElementById('pbtargetArcher').value)) document.getElementById('pbtargetArcher').value=0 ;}, false);
    document.getElementById('pbtargetCavalry').addEventListener('keyup', function(){if (isNaN(document.getElementById('pbtargetCavalry').value)) document.getElementById('pbtargetCavalry').value=0 ;}, false);
    document.getElementById('pbtargetHeavyCavalry').addEventListener('keyup', function(){if (isNaN(document.getElementById('pbtargetHeavyCavalry').value)) document.getElementById('pbtargetHeavyCavalry').value=0 ;}, false);
    document.getElementById('pbtargetSupplyWagon').addEventListener('keyup', function(){if (isNaN(document.getElementById('pbtargetSupplyWagon').value)) document.getElementById('pbtargetSupplyWagon').value=0 ;}, false);
    document.getElementById('pbtargetBallista').addEventListener('keyup', function(){if (isNaN(document.getElementById('pbtargetBallista').value)) document.getElementById('pbtargetBallista').value=0 ;}, false);
    document.getElementById('pbtargetBatteringRam').addEventListener('keyup', function(){if (isNaN(document.getElementById('pbtargetBatteringRam').value)) document.getElementById('pbtargetBatteringRam').value=0 ;}, false);
    document.getElementById('pbtargetCatapult').addEventListener('keyup', function(){if (isNaN(document.getElementById('pbtargetCatapult').value)) document.getElementById('pbtargetCatapult').value=0 ;}, false);
     
      
      document.getElementById('pbSupplyTroops').addEventListener('click', function(){
          if (document.getElementById('pbSupplyTroops').checked==false) {
              document.getElementById('pbtargetSupplyTroops').disabled = true;
          }
          else {
            document.getElementById('pbtargetSupplyTroops').disabled = false;
          }
      },false);
      document.getElementById('pbMilitiaman').addEventListener('click', function(){
          if (document.getElementById('pbMilitiaman').checked==false) {
              document.getElementById('pbtargetMilitiaman').disabled = true;
          }
          else {
            document.getElementById('pbtargetMilitiaman').disabled = false;
          }
      },false);
      document.getElementById('pbScout').addEventListener('click', function(){
          if (document.getElementById('pbScout').checked==false) {
              document.getElementById('pbtargetScout').disabled = true;
          }
          else {
            document.getElementById('pbtargetScout').disabled = false;
          }
      },false);
      document.getElementById('pbPikeman').addEventListener('click', function(){
          if (document.getElementById('pbPikeman').checked==false) {
              document.getElementById('pbtargetPikeman').disabled = true;
          }
          else {
            document.getElementById('pbtargetPikeman').disabled = false;
          }
      },false);
      document.getElementById('pbSwordsman').addEventListener('click', function(){
          if (document.getElementById('pbSwordsman').checked==false) {
              document.getElementById('pbtargetSwordsman').disabled = true;
          }
          else {
            document.getElementById('pbtargetSwordsman').disabled = false;
          }
      },false);
      document.getElementById('pbArcher').addEventListener('click', function(){
          if (document.getElementById('pbArcher').checked==false) {
              document.getElementById('pbtargetArcher').disabled = true;
          }
          else {
            document.getElementById('pbtargetArcher').disabled = false;
          }
      },false);
      document.getElementById('pbCavalry').addEventListener('click', function(){
          if (document.getElementById('pbCavalry').checked==false) {
              document.getElementById('pbtargetCavalry').disabled = true;
          }
          else {
            document.getElementById('pbtargetCavalry').disabled = false;
          }
      },false);
      document.getElementById('pbHeavyCavalry').addEventListener('click', function(){
          if (document.getElementById('pbHeavyCavalry').checked==false) {
              document.getElementById('pbtargetHeavyCavalry').disabled = true;
          }
          else {
            document.getElementById('pbtargetHeavyCavalry').disabled = false;
          }
      },false);
      document.getElementById('pbSupplyWagon').addEventListener('click', function(){
          if (document.getElementById('pbSupplyWagon').checked==false) {
              document.getElementById('pbtargetSupplyWagon').disabled = true;
          }
          else {
            document.getElementById('pbtargetSupplyWagon').disabled = false;
          }
      },false);
      document.getElementById('pbBallista').addEventListener('click', function(){
          if (document.getElementById('pbBallista').checked==false) {
              document.getElementById('pbtargetBallista').disabled = true;
          }
          else {
            document.getElementById('pbtargetBallista').disabled = false;
          }
      },false);
      document.getElementById('pbBatteringRam').addEventListener('click', function(){
          if (document.getElementById('pbBatteringRam').checked==false) {
              document.getElementById('pbtargetBatteringRam').disabled = true;
          }
          else {
            document.getElementById('pbtargetBatteringRam').disabled = false;
          }
      },false);
      document.getElementById('pbCatapult').addEventListener('click', function(){
          if (document.getElementById('pbCatapult').checked==false) {
              document.getElementById('pbtargetCatapult').disabled = true;
          }
          else {
            document.getElementById('pbtargetCatapult').disabled = false;
          }
      },false);
      
      
      window.addEventListener('unload', t.onUnload, false);
    },
    
    getRallypoint: function(cityId){
      var t = Tabs.Reassign;
      for (var o in Seed.buildings[cityId]){
        var buildingType = parseInt(Seed.buildings[cityId][o][0]);
        var buildingLevel = parseInt(Seed.buildings[cityId][o][1]);
        if (buildingType == 12) t.rallypointlevel=parseInt(buildingLevel);
       }  
    },
            
    

    e_reassignRoutes: function(){
      var t = Tabs.Reassign;
      var now = new Date();
      if (t.reassignState.running == true)    {
          var now = new Date().getTime()/1000.0;
          now = now.toFixed(0);
          var last = Options.lastreassign;
               if ( now > (parseInt(last) + (Options.reassigninterval*60))){
                  t.checkdoReassign();
              }
      }
      setTimeout(function(){ t.e_reassignRoutes();}, Options.reassigninterval*1000);
      
    },
        
    delReassignRoutes: function() {     
        var t = Tabs.Reassign;       
        t.reassignRoutes= [];
    },
    checkcoords : function (obj){
        var t = Tabs.Reassign;
        if(obj.id == 'pbok'){
            t.check = true;
            t.addReassignRoute();
        }
        return;            
    },
    addReassignRoute: function () {
        var t = Tabs.Reassign;
        var city = t.tcp.city.id;
        if(t.tcpto.city == null){
            new CdialogCancelContinue('<SPAN class=boldRed>'+translate("No destination selected!")+'</span>', null, null, mainPop.getMainDiv);
            return;
        }
        if(t.tcp.city.id == t.tcpto.city.id){
            new CdialogCancelContinue('<SPAN class=boldRed>'+translate("Can\'t reassign to same city!")+'</span>', null, null, mainPop.getMainDiv);
            return;
        }
        if ((t.tcpto.city.x == 0 && t.tcpto.city.y == 0)&& !t.check)
        {
            new CdialogConfirm ('<SPAN class=boldRed>'+translate("You are about to set a route to location 0,0!")+'</span>', t.checkcoords, unsafeWindow.modal_attack_check, mainPop.getMainDiv);
            return;
        }
        t.check = false;
        
        var SendSupplyTroop = document.getElementById('pbSupplyTroops').checked;
        var SendMilitiaman = document.getElementById('pbMilitiaman').checked;
        var SendScout = document.getElementById('pbScout').checked;
        var SendPikeman = document.getElementById('pbPikeman').checked;
        var SendSwordsman = document.getElementById('pbSwordsman').checked;
        var SendArchers = document.getElementById('pbArcher').checked;
        var SendCavalry = document.getElementById('pbCavalry').checked;
        var SendHeavyCavalry = document.getElementById('pbHeavyCavalry').checked;
        var SendSupplyWagons = document.getElementById('pbSupplyWagon').checked;
        var SendBallista = document.getElementById('pbBallista').checked;
        var SendBatteringRam = document.getElementById('pbBatteringRam').checked;
        var SendCatapult = document.getElementById('pbCatapult').checked;
        var SupplyTroop = document.getElementById('pbtargetSupplyTroops').value;
        var Militiaman = document.getElementById('pbtargetMilitiaman').value;
        var Scout = document.getElementById('pbtargetScout').value;
        var Pikeman = document.getElementById('pbtargetPikeman').value;
        var Swordsman = document.getElementById('pbtargetSwordsman').value;
        var Archers = document.getElementById('pbtargetArcher').value;
        var Cavalry = document.getElementById('pbtargetCavalry').value;
        var HeavyCavalry = document.getElementById('pbtargetHeavyCavalry').value;
        var SupplyWagons = document.getElementById('pbtargetSupplyWagon').value;
        var Ballista = document.getElementById('pbtargetBallista').value;
        var BatteringRam = document.getElementById('pbtargetBatteringRam').value;
        var Catapult = document.getElementById('pbtargetCatapult').value;
        var target_x = t.tcpto.city.x;
        var target_y = t.tcpto.city.y;
        var target_city = t.tcpto.city.id;
                
        var lRE = t.reassignRoutes;
            lRE.push({
                city:                city,
                target_x:            target_x,
                target_y:            target_y,
                target_city:        target_city,
                SendSupplyTroop:    SendSupplyTroop,
                SupplyTroop:        SupplyTroop,
                SendMilitiaman:        SendMilitiaman,
                Militiaman:            Militiaman,
                SendScout:            SendScout,
                Scout:                Scout,
                SendPikeman:         SendPikeman,
                Pikeman:             Pikeman,
                SendSwordsman:        SendSwordsman,
                Swordsman:            Swordsman,
                SendArchers:        SendArchers,
                Archers:            Archers,
                SendCavalry:         SendCavalry,
                Cavalry:             Cavalry,
                SendHeavyCavalry:    SendHeavyCavalry,
                HeavyCavalry:        HeavyCavalry,
                SendSupplyWagons:    SendSupplyWagons,
                SupplyWagons:        SupplyWagons,
                SendBallista:         SendBallista,
                Ballista:             Ballista,
                SendBatteringRam:    SendBatteringRam,
                BatteringRam:        BatteringRam,
                SendCatapult:        SendCatapult,
                Catapult:            Catapult,
            });
        document.getElementById('pbReassignDivD').style.background ='#99FF99';
        setTimeout(function(){ (document.getElementById('pbReassignDivD').style.background =''); }, 1000);
    },
    showReassignRoutes: function () {
        var t = Tabs.Reassign;
        var popReassignRoutes = null;
        t.popReassignRoutes = new pbPopup('pbShowTrade', 0, 0, 1100, 485, true, function() {clearTimeout (1000);});
        var m = '<DIV style="max-height:460px; height:460px; overflow-y:auto"><TABLE align=center cellpadding=0 cellspacing=0 width=100% class="pbShowReassignRoutes" id="pbRoutesQueue">';       
        t.popReassignRoutes.getMainDiv().innerHTML = '</table></div>' + m;
        t.popReassignRoutes.getTopDiv().innerHTML = '<TD><CENTER><B>'+translate("Reassign routes")+'</center></td>';
        t.paintReassignRoutes();
        t._addTabHeader();
        t.popReassignRoutes.show(true)    ;
    },
    paintReassignRoutes: function(){
            var t = Tabs.Reassign;
            var r = t.reassignRoutes;
            var cityname;
            for (var i = (r.length-1); i>=0; i--) {
                for (var y=0; y< Seed.cities.length;y++) {
                    if ( parseInt(Seed.cities[y][0]) == r[i].city) var cityname = Seed.cities[y][1];
                }    
                var queueId = i;
                t._addTab(queueId,cityname, r[i].target_x, r[i].target_y, r[i].target_city, r[i].SendSupplyTroop,r[i].SupplyTroop, r[i].SendMilitiaman, r[i].Militiaman, r[i].SendScout, r[i].Scout, r[i].SendPikeman, r[i].Pikeman, r[i].SendSwordsman, r[i].Swordsman, r[i].SendArchers, r[i].Archers, r[i].SendCavalry, r[i].Cavalry, r[i].SendHeavyCavalry, r[i].HeavyCavalry, r[i].SendSupplyWagons, r[i].SupplyWagons, r[i].SendBallista, r[i].Ballista, r[i].SendBatteringRam, r[i].BatteringRam, r[i].SendCatapult, r[i].Catapult);
            }
        },
      
     _addTab: function(queueId,cityname,target_x,target_y,target_city,SendSupplyTroop,SupplyTroop,SendMilitiaman,Militiaman,SendScout,Scout,SendPikeman,Pikeman,SendSwordsman,Swordsman,SendArchers,Archers,SendCavalry,Cavalry,SendHeavyCavalry,HeavyCavalry,SendSupplyWagons,SupplyWagons,SendBallista,Ballista,SendBatteringRam,BatteringRam,SendCatapult,Catapult){
         var t = Tabs.Reassign;
        var To = target_x+','+target_y;
        for (var y=0; y< Seed.cities.length;y++) {
            if ( parseInt(Seed.cities[y][0]) == parseInt(target_city)){
                To = Seed.cities[y][1];
                break;
            }
        }
         var row = document.getElementById('pbRoutesQueue').insertRow(0);
         row.vAlign = 'top';
         row.insertCell(0).innerHTML = queueId;
         row.insertCell(1).innerHTML = cityname;
         row.insertCell(2).innerHTML = To;
         row.insertCell(3).innerHTML = SendSupplyTroop;
         row.insertCell(4).innerHTML = addCommas(SupplyTroop);
         row.insertCell(5).innerHTML = SendMilitiaman;
         row.insertCell(6).innerHTML = addCommas(Militiaman);
          row.insertCell(7).innerHTML = SendScout;
          row.insertCell(8).innerHTML = addCommas(Scout);
          row.insertCell(9).innerHTML = SendPikeman;
          row.insertCell(10).innerHTML = addCommas(Pikeman);
          row.insertCell(11).innerHTML = SendSwordsman;
          row.insertCell(12).innerHTML = addCommas(Swordsman);
          row.insertCell(13).innerHTML = SendArchers;
          row.insertCell(14).innerHTML = addCommas(Archers);
          row.insertCell(15).innerHTML = SendCavalry;
          row.insertCell(16).innerHTML = addCommas(Cavalry);
          row.insertCell(17).innerHTML = SendHeavyCavalry;
          row.insertCell(18).innerHTML = addCommas(HeavyCavalry);
          row.insertCell(19).innerHTML = SendSupplyWagons;
          row.insertCell(20).innerHTML = addCommas(SupplyWagons);
          row.insertCell(21).innerHTML = SendBallista;
          row.insertCell(22).innerHTML = addCommas(Ballista);
          row.insertCell(23).innerHTML = SendBatteringRam;
          row.insertCell(24).innerHTML = addCommas(BatteringRam);
          row.insertCell(25).innerHTML = SendCatapult;
          row.insertCell(26).innerHTML = addCommas(Catapult);
         row.insertCell(27).innerHTML = '<a class="button20" id="tradecancel_' + queueId + '"><span>'+translate("Delete")+'</span></a>';
         document.getElementById('tradecancel_' + queueId).addEventListener('click', function(){
            t.cancelQueueElement(queueId);
         }, false);
     },
     
     _addTabHeader: function() {
     var t = Tabs.transport;
         var row = document.getElementById('pbRoutesQueue').insertRow(0);
         row.vAlign = 'top';
         row.insertCell(0).innerHTML = "ID";
         row.insertCell(1).innerHTML = translate("From");
         row.insertCell(2).innerHTML = translate("To");
         row.insertCell(3).innerHTML = translate("Sup. Tr.");
         row.insertCell(4).innerHTML = "";
         row.insertCell(5).innerHTML = translate("MM");
         row.insertCell(6).innerHTML = "";
         row.insertCell(7).innerHTML = translate("Scouts");
         row.insertCell(8).innerHTML = "";
         row.insertCell(9).innerHTML = translate("Pikes");
         row.insertCell(10).innerHTML = "";
         row.insertCell(11).innerHTML = translate("Swords");
         row.insertCell(12).innerHTML = "";
         row.insertCell(13).innerHTML = translate("Archers");
         row.insertCell(14).innerHTML = "";
         row.insertCell(15).innerHTML = translate("Cav");
         row.insertCell(16).innerHTML = "";
         row.insertCell(17).innerHTML = translate("HC");
         row.insertCell(18).innerHTML = "";
         row.insertCell(19).innerHTML = translate("Wagons");
         row.insertCell(20).innerHTML = "";
         row.insertCell(21).innerHTML = translate("Ballista");
         row.insertCell(22).innerHTML = "";
         row.insertCell(23).innerHTML = translate("Rams");
         row.insertCell(24).innerHTML = "";
         row.insertCell(25).innerHTML = translate("Catapults");
         row.insertCell(26).innerHTML = "";
         row.insertCell(27).innerHTML = translate("Delete");
       },   
       
     cancelQueueElement: function(queueId){
         var t = Tabs.Reassign;
         var queueId = parseInt(queueId);
         t.reassignRoutes.splice(queueId, 1);
         t.showReassignRoutes();
     },
       
    saveReassignRoutes: function(){
        var t = Tabs.Reassign;
        var serverID = getServerId();
        GM_setValue('reassignRoutes_' + serverID, JSON2.stringify(t.reassignRoutes));
    },
    readReassignRoutes: function(){
        var t = Tabs.Reassign;
        var serverID = getServerId();
        s = GM_getValue('reassignRoutes_' + serverID);
        if (s != null) {
            route = JSON2.parse(s);
            for (k in route)
                t.reassignRoutes[k] = route[k];
        }
        try{
            t.checkcitymoved();
        } catch (e) {
            //Do nothing
        }
    },
    checkcitymoved: function(){
        var t = Tabs.Reassign;
        for(var i=0; i < t.reassignRoutes.length; i++){
            if(t.reassignRoutes[i].target_city == 'undefined') break;
            if(t.reassignRoutes[i].target_x != Cities.byID[t.reassignRoutes[i].target_city].x) t.reassignRoutes[i].target_x = Cities.byID[t.reassignRoutes[i].target_city].x;
            if(t.reassignRoutes[i].target_y != Cities.byID[t.reassignRoutes[i].target_city].y) t.reassignRoutes[i].target_y = Cities.byID[t.reassignRoutes[i].target_city].y;
        }
    },
    saveReassignState: function(){
        var t = Tabs.Reassign;
        var serverID = getServerId();
        GM_setValue('reassignState_' + serverID, JSON2.stringify(t.reassignState));
    },
    readReassignState: function(){
        var t = Tabs.Reassign;
        var serverID = getServerId();
        s = GM_getValue('reassignState_' + serverID);
        if (s != null) {
            state = JSON2.parse(s);
            for (k in state)
                t.reassignState[k] = state[k];
        }
    },
    toggleReassignState: function(obj){
        var t = Tabs.Reassign;
        if (t.reassignState.running == true) {
            t.reassignState.running = false;
            if (document.getElementById('pbReassignState')) {document.getElementById('pbReassignState').value = "Reassign = OFF";document.getElementById('pbReassignState').setAttribute("class", "buttonDash_OFF");}
        	if (document.getElementById('ReassignToggle')) {document.getElementById('ReassignToggle').value = "Reassign = OFF";document.getElementById('ReassignToggle').setAttribute("class", "buttonDash_OFF");}
            t.checkdoreassigntimeout = null;
            t.count = 0;
        }
        else {
            t.reassignState.running = true;
            if (document.getElementById('pbReassignState')) {document.getElementById('pbReassignState').value = "Reassign = ON";document.getElementById('pbReassignState').setAttribute("class", "buttonDash_ON");}
        	if (document.getElementById('ReassignToggle')) {document.getElementById('ReassignToggle').value = "Reassign = ON";document.getElementById('ReassignToggle').setAttribute("class", "buttonDash_ON");}
            t.e_reassignRoutes();
        }
    },
    
    checkdoReassign: function(){
    var t = Tabs.Reassign;
    t.doReassign(t.count);
    t.count++;
        if(t.count < t.reassignRoutes.length && t.reassignState.running){
          t.checkdoreassigntimeout = setTimeout(function() { t.checkdoReassign();}, 5000);
        } else {
          var now = new Date().getTime()/1000.0;
          now = now.toFixed(0);
          Options.lastreassign = now;
          saveOptions();    
          t.count = 0;
        }
    },
    
    doReassign: function(count){
        var t = Tabs.Reassign;
        var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
        if(t.reassignRoutes.length==0) return;
        var send=[];
        var citytotal=0;
        var totalsend=0;
        params.u1 = 0;
        params.u2 = 0;
        params.u3 = 0;
        params.u4 = 0;
        params.u5 = 0;
        params.u6 = 0;
        params.u7 = 0;
        params.u8 = 0;
        params.u9 = 0;
        params.u10 = 0;
        params.u11 = 0;
        params.u12 = 0;    
                
        var city = t.reassignRoutes[count]["city"];
        var xcoord = t.reassignRoutes[count]["target_x"];
        var ycoord = t.reassignRoutes[count]["target_y"];
        
        var cityID = 'city' + city;
        if(!Cities.byID[city]) return;
        var marching = getMarchInfo(cityID);
        t.getRallypoint(cityID);
        if(t.rallypointlevel == 11) t.rallypointlevel = 15;
        else if(t.rallypointlevel == 12) t.rallypointlevel = 20;
        var maxsend = (t.rallypointlevel * 10000);
        totalsend=0;
        
        var troopsselect=["SupplyTroop","Militiaman","Scout","Pikeman","Swordsman","Archers","Cavalry","HeavyCavalry","SupplyWagons","Ballista","BatteringRam","Catapult"];
        for (k=0; k<troopsselect.length; k++) {
            var citytroops = Seed.units[cityID]['unt'+(parseInt(k)+1)];
            var marchtroops = marching.marchUnits[parseInt(k)+1];
            citytotal = parseInt(citytroops) + parseInt(marchtroops);
            if(t.reassignRoutes[count]['Send'+troopsselect[k]]==false) {continue; }
            if(citytotal > t.reassignRoutes[count][troopsselect[k]]){
                var sendtroops = parseInt(citytotal) - parseInt(t.reassignRoutes[count][troopsselect[k]]);
                if (parseInt(sendtroops) > parseInt(citytroops)) sendtroops = citytroops;
                if (parseInt(sendtroops) < 0) sendtroops = 0;
                send[(parseInt(k)+1)] = sendtroops;
                totalsend += send[(parseInt(k)+1)];                
            }
            if(totalsend > maxsend){
                totalsend -= send[(parseInt(k)+1)];
                send[(parseInt(k)+1)] = parseInt(maxsend-totalsend);
                totalsend += send[(parseInt(k)+1)];
                break;
            }
        }
        
        for (var t=0; t< Seed.cities.length;t++) {
            if ( parseInt(Seed.cities[t][0]) == city) var cityname = Seed.cities[t][1];
        }
        
        params.cid= city;
        params.type = "5";
        params.kid=0;
        params.xcoord = xcoord;
        params.ycoord = ycoord;
        params.u1 = send[1];
        params.u2 = send[2];
        params.u3 = send[3];
        params.u4 = send[4];
        params.u5 = send[5];
        params.u6 = send[6];
        params.u7 = send[7];
        params.u8 = send[8];
        params.u9 = send[9];
        params.u10 = send[10];
        params.u11 = send[11];
        params.u12 = send[12];    
        
           if (totalsend >0) {
           
        var profiler = new unsafeWindow.cm.Profiler("ResponseTime", "march.php");
        RPM++;
              new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/march.php" + unsafeWindow.g_ajaxsuffix, {
                  method: "post",
                  parameters: params,
                  loading: true,
                  onSuccess: function (transport) {
                      profiler.stop();
                  var rslt = eval("(" + transport.responseText + ")");
                  if (rslt.ok) {
	                  actionLog('Reassign   From: ' + cityname + "   To: " + xcoord + ',' + ycoord + "    ->   Troops: " + totalsend);
	                  var timediff = parseInt(rslt.eta) - parseInt(rslt.initTS);
	                  var ut = unixTime();
	                  var unitsarr=[0,0,0,0,0,0,0,0,0,0,0,0,0];
	                                      for(i = 0; i <= unitsarr.length; i++){
	                                          if(params["u"+i]){
	                                                  unitsarr[i] = params["u"+i];
	                                          }
	                                      }
	                  var resources=[0,0,0,0,0,0,0,0,0,0,0,0,0];
	                  var currentcityid = city;
	                  unsafeWindow.attach_addoutgoingmarch(rslt.marchId, rslt.marchUnixTime, ut + timediff, params.xcoord, params.ycoord, unitsarr, params.type, params.kid, resources, rslt.tileId, rslt.tileType, rslt.tileLevel, currentcityid, true);
	                  if(rslt.updateSeed){unsafeWindow.update_seed(rslt.updateSeed)};
                  } 
                  },
                  onFailure: function () {profiler.stop();}
          });
        }      
    },
    
    show: function(){
        var t = Tabs.Reassign;
    },
    hide: function(){
        var t = Tabs.Reassign;
    },
    onUnload: function(){
        var t = Tabs.Reassign;
        if (!ResetAll) t.saveReassignRoutes();
        if (!ResetAll) t.saveReassignState();
        
    },
}

/************************  Attack Tab ************************/
Tabs.Attack = {
  tabOrder: 999997,
  tabLabel: 'Attack',
  myDiv: null,
  tileTypes:{0:"Bog",10:"Grassland",11:"Lake",20:"Woods",30:"Hills",40:"Mountain",50:"Plain",51:"City",52:"Ruin",53:"Misted City",54:"Dark Forest"},


    init: function(div){
    	var t = Tabs.Attack;
        t.myDiv = div;
        unsafeWindow.RemoveAtkQueue = t.RemoveQueue;

      	var m = '<DIV id=pbReinfMain class=pbStat>ATTACK (TO CREST BARB/PLAYER)</div><TABLE id=pireinforce width=100% height=0% class=pbTab><TR align="center"><BR>';
      	m +='<DIV align=center><INPUT class="buttonDash_'+ (AtkOptions.Running?'ON':'OFF') +'" id=AttackToggle type=submit value="'+translate("Attack")+' = '+ (AtkOptions.Running?'ON':'OFF')+'">&nbsp Rallypoint options in options tab!</div>';
      	m += '<TABLE id=pbReinf width=95% height=0% class=pbTab><TR align="left">';
      	m += '<TD width="75px"><B>From City: </b></td> <TD width=310px><DIV style="margin-bottom:10px;"><span id=pbAcityFrom></span></div></td>';
      	m += '<TD width="60px"><B>Target:</b></td><TD>X:<INPUT id=targetX type=text size=3>&nbsp&nbspY:<INPUT id=targetY type=text size=3></td></table>';
    	  m += '<TABLE id=pbMarch width=100% height=0% class=pbTab><TR align="center"><TR><TR>';
        for (i=1;i<=4;i++) m += '<TD rowspan="3"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+i+'_50_s34.jpg?6545"></td><TD>'+ unsafeWindow.unitnamedesctranslated["unt"+i][0]+'</td>';
      	m+='</tr><TR>';
      	for (i=1;i<=4;i++) m += '<TD><SPAN id=unit'+i+'></span></td>';
      	m+='</tr><TR>';
      	for (i=1;i<=4;i++) m += '<TD><INPUT id=Unt'+i+' type=text size=10 maxlength=10 value="0"><INPUT id=Max'+i+' type=submit class=pbButton value='+translate("Max")+'></td>';
      	m+='</tr><TR>';   	
      	for (i=5;i<=8;i++) m += '<TD rowspan="3"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+i+'_50_s34.jpg?6545"></td><TD>'+ unsafeWindow.unitnamedesctranslated["unt"+i][0]+'</td>';
      	m+='</tr><TR>';
      	for (i=5;i<=8;i++) m += '<TD><SPAN id=unit'+i+'></span></td>';
      	m+='</tr><TR>';
      	for (i=5;i<=8;i++) m += '<TD><INPUT id=Unt'+i+' type=text size=10 maxlength=10 value="0"><INPUT id=Max'+i+' type=submit class=pbButton value='+translate("Max")+'></td>';
      	m+='</tr><TR>';
      	for (i=9;i<=12;i++) m += '<TD rowspan="3"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+i+'_50_s34.jpg?6545"></td><TD>'+ unsafeWindow.unitnamedesctranslated["unt"+i][0]+'</td>';
      	m+='</tr><TR>';
      	for (i=9;i<=12;i++) m += '<TD><SPAN id=unit'+i+'></span></td>';
      	m+='</tr><TR>';
      	for (i=9;i<=12;i++) m += '<TD><INPUT id=Unt'+i+' type=text size=10 maxlength=10 value="0"><INPUT id=Max'+i+' type=submit class=pbButton value='+translate("Max")+'></td>';
      	m+='</tr><TR>';
        for (i=13;i<=15;i++) m += '<TD rowspan="3"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+i+'_50_s34.jpg?6545"></td><TD>'+ unsafeWindow.unitnamedesctranslated["unt"+i][0]+'</td>';
      	m+='</tr><TR>';
      	for (i=13;i<=15;i++) m += '<TD><SPAN id=unit'+i+'></span></td>';
      	m+='</tr><TR>';
      	for (i=13;i<=15;i++) m += '<TD><INPUT id=Unt'+i+' type=text size=10 maxlength=10 value="0"><INPUT id=Max'+i+' type=submit class=pbButton value='+translate("Max")+'></td>';
      	m+='</tr><TR>';

  	    m += '</table><BR><TABLE id=pbReinfETA width=10% height=0% align="center" class=pbTab>';
  	    m += '<TR align="center"><TD><a class="button20" id=AtkaddToQueue><span>Save Attack</span></a></td></tr></table>';
  	    m+= '<BR><DIV id=pbReinfMain class=pbStat>Saved Marches</div><BR><BR><DIV id=AtkQueue></div>';
      
      	t.myDiv.innerHTML = m;

      	t.from = new CdispCityPicker ('pbAfrom', document.getElementById('pbAcityFrom'), true, t.ClickCitySelect, 0); 
		document.getElementById('AttackToggle').addEventListener('click', function(){t.toggleAttackState()} , false);     
      	for (i=1;i<=15;i++) document.getElementById('unit'+i).innerHTML = addCommas(Seed.units["city" + t.from.city.id]["unt"+i]);
      	for (i=1;i<=15;i++)  document.getElementById('Max'+i).addEventListener('click', function(){t.CalcMax(this.id)}, false);
		    document.getElementById('AtkaddToQueue').addEventListener ('click', t.GetCoords,false); 	
        	t.PaintQueue();
    },

    toggleAttackState: function() {
        var t = Tabs.Attack;
            if (AtkOptions.Running == true) {
                AtkOptions.Running = false;
                if (document.getElementById('AttackToggle')) {document.getElementById('AttackToggle').value = "Attack = OFF";document.getElementById('AttackToggle').setAttribute("class", "buttonDash_OFF");}
                if (document.getElementById('AttackToggleD')) {document.getElementById('AttackToggleD').value = "Attack = OFF";document.getElementById('AttackToggleD').setAttribute("class", "buttonDash_OFF");}
                ClearMarchQueue("Attack");
                saveAtkOptions();
            } else {
                AtkOptions.Running = true;
                if (document.getElementById('AttackToggle')) {document.getElementById('AttackToggle').value = "Attack = ON";document.getElementById('AttackToggle').setAttribute("class", "buttonDash_ON");}
                if (document.getElementById('AttackToggleD')) {document.getElementById('AttackToggleD').value = "Attack = ON";document.getElementById('AttackToggleD').setAttribute("class", "buttonDash_ON");}
                saveAtkOptions();
            }
    },

   	GetCoords : function (){
	    var t= Tabs.Attack;
	    var targetName = "";
	    var targetCityName = "";
	    var tileLevel =0;
	    var total=0;
	    targetX = document.getElementById('targetX').value;
	    targetY = document.getElementById('targetY').value;
	    if (targetX =="" || targetY=="") {alert("Please enter coords...");return;}
	    for (i=1;i<=15;i++) total += parseInt(document.getElementById('Unt'+i).value);
	    if (total == 0) {alert("You got to send a least one troop...");return;}
	    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    	params.blocks = "bl_" + targetX + "_bt_" + targetY;
	     
	    new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/fetchMapTiles.php" + unsafeWindow.g_ajaxsuffix, {
      		method: "post",
      		parameters: params,
      		onSuccess: function (transport) {
      			var rslt = eval("(" + transport.responseText + ")");
        		if (rslt.ok) {
    				userId = rslt.data["l_"+targetX+"_t_"+targetY].tileUserId;    				
    				if (rslt.data["l_"+targetX+"_t_"+targetY].cityName) targetCityName = rslt.data["l_"+targetX+"_t_"+targetY].cityName;
    				 else targetCityName = "---";			
    				if (userId != null && userId != 0) targetName = rslt.userInfo["u" + userId]["n"];
        			for (i=1;i<=Seed.cities.length;i++) if (Seed.cities[i-1][0] == t.from.city.id) cityNumber = i;
        			AtkOptions[cityNumber].push ({
        				what: 			"Attack",
        				city: 			t.from.city.id,
        				action: 		4,
        				targetX: 		targetX,
        				targetY: 		targetY,
        				targetCityName: targetCityName,
        				targetName: 	targetName,
        				tileLevel: 		rslt.data["l_"+targetX+"_t_"+targetY].tileLevel,
        				tileType: 		rslt.data["l_"+targetX+"_t_"+targetY].tileType,
        				1: 				document.getElementById('Unt1').value,
        				2: 				document.getElementById('Unt2').value,
        				3: 				document.getElementById('Unt3').value,
        				4: 				document.getElementById('Unt4').value,
        				5: 				document.getElementById('Unt5').value,
        				6: 				document.getElementById('Unt6').value,
        				7: 				document.getElementById('Unt7').value,
        				8: 				document.getElementById('Unt8').value,
        				9: 				document.getElementById('Unt9').value,
        				10: 			document.getElementById('Unt10').value,
        				11: 			document.getElementById('Unt11').value,
        				12: 			document.getElementById('Unt12').value,
        				13: 			document.getElementById('Unt13').value,
        				14: 			document.getElementById('Unt14').value,
        				15: 			document.getElementById('Unt15').value,
        				r1:             0,
            			r2:             0,
            			r3:             0,
            			r4:             0,
            			r5:             0,
           				gold:           0,
        			});
					saveAtkOptions();
					t.PaintQueue();
					for(i=1;i<=15;i++) document.getElementById('Unt'+i).value=0;
					document.getElementById('targetX').value="";
					document.getElementById('targetY').value="";
        		}
      		},
    	});
	},

	PaintQueue : function (){
	    var t= Tabs.Attack;
	    document.getElementById('AtkQueue').innerHTML = '<TABLE id=AtkShowQ class=pbStat align="center" width=80%></table>';
	    for (var i=1;i<=Seed.cities.length;i++) {
	    	CityQueue = AtkOptions[i];
	    	for (var y=0;y<CityQueue.length;y++) {
	    		tag = "city"+i+"item"+y;	
	    		t._addTab(CityQueue[y],tag,i,y);
	    	}
	    }
	    t._addTabHeader();
	 },

	 _addTab: function(action,k,city,item){
	    var t = Tabs.Attack;

	    for (postcity in Seed.cities) if (Seed.cities[postcity][0] == action.city) logcity = Seed.cities[postcity][1];
	    var total = 0;
		var info = "";
		var type="";
		for (i=1;i<=15;i++) total += parseInt(action[i]);
		switch (parseInt(action.tileType)) {
			case 0: info = "Bog";break;
			case 10: info = "Grassland";break;
			case 11: info = "Lake";break;
			case 20: info = "Woods";break;
			case 30: info = "Hills";break;
			case 40: info = "Mountain";break;
			case 50: info = "Plain";break;
			case 51: 
				if (action.targetCityName == null && !action.misted) info = "Barb Camp";
					else info = action.targetName;
				break;
			case 53: info = "Misted City";break;
		}
	    var row = document.getElementById('AtkShowQ').insertRow(0);
	    row.vAlign = 'top';
	    row.style.color = "black";
	    row.insertCell(0).innerHTML = '<A onclick="RemoveAtkQueue('+ city +','+ item +')"><img src="data:image/png;base64,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"/>';	  
	    row.insertCell(1).innerHTML = logcity;
	    row.insertCell(2).innerHTML = coordLink(parseInt(action.targetX),parseInt(action.targetY));
	    row.insertCell(3).innerHTML = info;
	    row.insertCell(4).innerHTML = action.targetCityName;
	    row.insertCell(5).innerHTML = action.tileLevel;
	    row.insertCell(6).innerHTML = addCommas(total);
	    row.insertCell(7).innerHTML = '<a class="button20" id="Details' + k + '"><span>Details</span></a>';
	    document.getElementById('Details' + k).addEventListener('click', function(){t.DetailsPop(action,logcity,info);}, false);
	},

	_addTabHeader: function() {
	    var t = Tabs.Attack;
	    var row = document.getElementById('AtkShowQ').insertRow(0);
	    row.vAlign = 'top';
	    row.style.color = "black";
	    row.insertCell(0).innerHTML = "&nbsp";
	    row.insertCell(1).innerHTML = "From City";
	    row.insertCell(2).innerHTML = "Coords";
	    row.insertCell(3).innerHTML = "Target Name";
	    row.insertCell(4).innerHTML = "City";
	    row.insertCell(5).innerHTML = "Level";
	    row.insertCell(6).innerHTML = "Troops";
	    row.insertCell(7).innerHTML = "Details";
	},

	DetailsPop : function (action,logcity,info){
		var t = Tabs.Attack;
		var m = '<TABLE id=pbMarch width=100% height=0% class=pbTab>';
	    m+= '<TR><TD width="50px"></td><TD>From city: ' + logcity + '</td></tr>';
	    m+= '<TR><TD width="50px"></td><TD>Target: ' + info + '</td></tr>';
	    m+= '<TR><TD width="50px"></td><TD>City: ' + action.targetCityName + '</td></tr>';
	    m+= '<TR><TD width="50px"></td><TD>Level: ' + action.tileLevel + '</td></tr>';
	    m+= '<TR><TD width="50px"></td><TD>Coords: ' +  coordLink(parseInt(action.targetX),parseInt(action.targetY)) + '</td></tr></table><BR>';
	    m += '<TABLE id=pbMarch width=100% height=0% class=pbTab><TR>';
	    for (i=1;i<=4;i++) m += '<TD width="51px"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+i+'_50_s34.jpg?6545"></td><TD width="75px">'+ addCommas(action[i]) +'</td>';
	    m+='</tr><TR>'; 
	    for (i=5;i<=8;i++) m += '<TD width="51px"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+i+'_50_s34.jpg?6545"></td><TD width="75px">'+ addCommas(action[i]) +'</td>';
	    m+='</tr><TR>'; 
	    for (i=9;i<=12;i++) m += '<TD width="51px"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+i+'_50_s34.jpg?6545"></td><TD width="75px">'+ addCommas(action[i]) +'</td>';
	    m+='</tr><TR>';
	    for (i=13;i<=15;i++) m += '<TD width="51px"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+i+'_50_s34.jpg?6545"></td><TD width="75px">'+ addCommas(action[i]) +'</td>';
	    m+='</tr></table><BR>'; 
	    var pop = new pbPopup ('giftHelp', 0, 0, 550, 410, true);
	    pop.centerMe (mainPop.getMainDiv());  
	    pop.getMainDiv().innerHTML = m;
	    pop.getTopDiv().innerHTML = '<CENTER><B>Saved March info</center>';
	    pop.show (true);
	  },
   
    ClickCitySelect: function(city){
                var t = Tabs.Attack;  
                for (i=1;i<=15;i++) document.getElementById('unit'+i).innerHTML = addCommas(Seed.units["city" + t.from.city.id]["unt"+i]);
    },

    RemoveQueue: function(city,item){
        var t = Tabs.Attack;
        AtkOptions[city].splice(item,1);
        t.PaintQueue();
    	saveAtkOptions();
    },

    doMarch: function(cityID,i){
        var t = Tabs.Attack;
        for (var y=0;y<AtkOptions[i+1].length;y++) if (AtkOptions[i+1][y]["city"] == cityID) MarchQueue[i+1].push(AtkOptions[i+1][y]);
    },

    show: function(){
        var t = Tabs.Attack;
    },
    hide: function(){
        var t = Tabs.Attack;
    },
    onUnload: function(){
    },
}




/************************  Dark Forest Tab ************************/
Tabs.DF = {
  tabOrder: 999990,
  tabLabel: 'Dark Forest',
  myDiv: null,
  cityID: null,
  rallypointlevel:null,
  maxsend:0,
  knt:null,
  DFArray:{},


    init: function(div){
    	var t = Tabs.DF;
        t.myDiv = div;

      	var m= '<DIV id=pbReinfMain class=pbStat>AUTOMATED FOREST FUNCTION</div><BR>';
      	m+='<TD><INPUT class="buttonDash_'+ (DFOptions.Running?'ON':'OFF') +'" id=AttSearch type=submit value="'+translate("Auto DF")+' = '+ (DFOptions.Running?'ON':'OFF')+'"></td>';
      	m+='&nbsp<INPUT id=pbDFShow type=submit class=pbButton value="Show DF\'s">&nbsp<INPUT id=pbReset type=submit class=pbButton value="Re-search">';
      	m+='&nbsp Radius 45 - Search every 20min - rallypoint options in options tab!';
      	m+='<DIV id=DFStats text-align=center></div>';
      	m+='<DIV id=pbReinfMain class=pbStat>DF SELECT LEVELS</div><BR>';

      	m+='<TABLE width=100%>';
      	for (i=0;i<Seed.cities.length;i++) {
      		m+='<TR><TD>' + Seed.cities[i]["1"] + '</td>';
      		for (y=1;y<=10;y++) m+='<TD class=DFLevelopt><INPUT id=DFcity'+i+'level'+y+' type=checkbox unchecked=true>Lvl:'+y+'</td>';
      	}
      	m+='</table>';
      	m += '<DIV id=pbReinfMain class=pbStat>DF SELECT TROOPS</div>';
      	m += '<B>For a march with max. amount of troops for the rallypoint, enter MAX in the box.</b><BR>';
      	m+='<TABLE width=100%><TR><TD></td>';
      	for(var i=1;i<=12; i++) m+='<TD>'+unsafeWindow.unitcost['unt'+i][0]+'</td>';
      	for(i=1;i<=10;i++){
        	m += '</tr><TR><TD>Level '+i+': </td>';
         	for(var j=1; j<=12; j++) m += '<TD class=DFTroopOpt><INPUT id="DFlevel'+i+'troop'+j+'" type=text size=4 maxlength=6 value="'+DFOptions.Troops[i][j]+'" /></td>';
     	}
     	m+='</tr></table>';

      	
      	t.myDiv.innerHTML = m;

      	for(i=0;i<Seed.cities.length;i++) for(w=1;w<=10;w++)document.getElementById('DFcity'+i+'level'+w).checked = DFOptions.Levels[i+1][w];
      	document.getElementById('pbReset').addEventListener('click', t.ResetDFData, false);
      	var element_class = document.getElementsByClassName('DFLevelopt');
    	for (k=0;k<element_class.length;k++) element_class[k].addEventListener('click', t.saveLevelOptions , false);
    	var element_class = document.getElementsByClassName('DFTroopOpt');
    	for (k=0;k<element_class.length;k++) element_class[k].addEventListener('change', t.saveTroopOptions , false);
    	document.getElementById('AttSearch').addEventListener('click', function(){t.toggleDFState()} , false);
    	document.getElementById('pbDFShow').addEventListener('click', function(){t.ShowDFArray()} , false);
    	
    	var now = unixTime();
    	document.getElementById('DFStats').innerHTML = "Last Search done at: " + FullDateTime(DFOptions.LastSearch) + " found " + DFOptions.DFFound + " Dark Forests.";
		if ((DFOptions.LastSearch + (20 * 60 * 1000)) < now && DFOptions.Running) t.ResetDFData(); 
		else {
			for (i=0;i<Seed.cities.length;i++){
	    		var helpArray = JSON2.parse(GM_getValue('DarkForest_' + Seed.player['name'] + '_city_' + (i+1) + '_' + getServerId(),"[]"));
	    		t.DFArray[i] = [];
	    		if (helpArray) t.DFArray[i] = helpArray.sort(function sortBarbs(a,b) {a = a['dist'];b = b['dist'];return a == b ? 0 : (a < b ? -1 : 1);});
			}
		}
	},

	ShowDFArray: function(){
		var t = Tabs.DF;
		var m = '<TABLE id=pbDF width=80% height=0% class=pbTab>';
		for (i=0;i<Seed.cities.length;i++) {
			if (t.DFArray[i].length>0){
				m+= '<TR><TD colspan=5 style=\'background: #335577;\' align=center><B><FONT color=white>' + Seed.cities[i][1] +': </font></b></td></tr>';
				for (var k in t.DFArray[i]) if (t.DFArray[i][k].dist) {
					if (t.DFArray[i][k].Level>=1 && t.DFArray[i][k].Level<=3) var Tlevel = 1;
					if (t.DFArray[i][k].Level>=4 && t.DFArray[i][k].Level<=6) var Tlevel = 4;
					if (t.DFArray[i][k].Level>=7) var Tlevel = 7;
					m+='<TR><TD>' + coordLink(t.DFArray[i][k].X,t.DFArray[i][k].Y) + '</td><TD width=50px><img width=50px src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/buildings/boss_lvl'+Tlevel+'.png"></td><TD>Lvl.: '+t.DFArray[i][k].Level+'</td><TD>Dist.: '+t.DFArray[i][k].dist+'</td></tr>';
				}
			}
		}
	    var pop = new pbPopup ('DFArray', 0, 0, 550, 410, true);
	    pop.centerMe (mainPop.getMainDiv());  
	    pop.getMainDiv().innerHTML = '<DIV style="width:550px;max-width:550px;height:410px;max-height:410px;overflow:auto">' +m+ '</div>';
	    pop.getTopDiv().innerHTML = '<CENTER><B>DF\'s Found</center>';
	    pop.show (true);

	},

    toggleDFState: function(obj){
		    var t = Tabs.DF;
		    if (DFOptions.Running == true) {
		        DFOptions.Running = false;
		        if (document.getElementById('AttSearch')) {document.getElementById('AttSearch').value = "Auto DF = OFF";document.getElementById('AttSearch').setAttribute("class", "buttonDash_OFF");}
		        if (document.getElementById('AutoDfToggle')) {document.getElementById('AutoDfToggle').value = "Auto DF = OFF";document.getElementById('AutoDfToggle').setAttribute("class", "buttonDash_OFF");}
		       	ClearMarchQueue("DF");
		        saveDFOptions();
		    } else {
		        DFOptions.Running = true;
		        if (document.getElementById('AttSearch')) {document.getElementById('AttSearch').value = "Auto DF = ON";document.getElementById('AttSearch').setAttribute("class", "buttonDash_ON");}
		        if (document.getElementById('AutoDfToggle')) {document.getElementById('AutoDfToggle').value = "Auto DF = ON";document.getElementById('AutoDfToggle').setAttribute("class", "buttonDash_ON");}
		        if ((DFOptions.LastSearch + (20 * 60)) < now) t.ResetDFData(); 
		        saveDFOptions();
		    }
  	},

    saveLevelOptions : function(){
        for(i=0;i<Seed.cities.length;i++){
            DFOptions.Levels[i+1][0]=false;
            for (w=1;w<=10;w++){
                var ele = document.getElementById('DFcity'+i+'level'+w);
                DFOptions.Levels[i+1][w]=ele.checked;
                if (ele.checked) DFOptions.Levels[i+1][0]=true;
            }        
        }
        saveDFOptions();
    },

    saveTroopOptions : function(){
        for(i=1;i<=10;i++) for (w=1;w<=12;w++) DFOptions.Troops[i][w] = document.getElementById('DFlevel'+i+'troop'+w).value;  
        saveDFOptions();
    },

    doMarch : function(cityID,i){
    	var t = Tabs.DF;
    	var now = unixTime();
    	if ((DFOptions.LastSearch + (20 * 60)) < now) {t.ResetDFData();return false;}  		
    	if (t.DFArray[i].length==0) return false;
    	var Level = parseInt(t.DFArray[i][0].Level);
    	if (!DFOptions.Levels[i+1][Level]) return;
    	var troops = [0,0,0,0,0,0,0,0,0,0,0,0,0];
    	for (y=1;y<=12;y++){
    		if (DFOptions.Troops[Level][y] == "MAX") {
    			var total=0;
    			for (var yy=1;yy<=12;yy++) if (y!=yy) total+=parseInt(DFOptions.Troops[Level][yy]);
    			troops[y] =  t.CalcMax(cityID,y) - total;
    		}
    		else troops[y] = DFOptions.Troops[Level][y];
    	}
    	MarchQueue[i+1].push ({
    		what: 			"DF",
			city: 			cityID,
			action: 		4,
			targetX: 		t.DFArray[i][0].X,
			targetY: 		t.DFArray[i][0].Y,
			1: 				troops[1],
			2: 				troops[2],
			3: 				troops[3],
			4: 				troops[4],
			5: 				troops[5],
			6: 				troops[6],
			7: 				troops[7],
			8: 				troops[8],
			9: 				troops[9],
			10: 			troops[10],
			11: 			troops[11],
			12: 			troops[12],
			13: 			0,
			14: 			0,
			15: 			0,
        });
        t.DFArray[i].splice(0,1);
        GM_setValue('DarkForest_' + Seed.player['name'] + '_city_' + (i+1) + '_' + getServerId(), JSON2.stringify(t.DFArray[i]));
        return true;
    },

    ResetDFData: function(){
    	var t = Tabs.DF;
    	for (i=0;i<Seed.cities.length;i++) GM_deleteValue('DarkForest_' + Seed.player['name'] + '_city_' + (i+1) + '_' + getServerId(),"[]")
    	var ToSearch = [];
    	var now = unixTime();
    	for (i=0;i<Seed.cities.length;i++){
    		AllEmpty = true;
    		t.DFArray[i] = [];
    		for (var y=1;y<=10;y++) if (DFOptions.Levels[i+1][y]) AllEmpty = false;
    		if (!AllEmpty) ToSearch.push(i);
    	}
    	if (ToSearch.length > 0){
    		DFOptions.LastSearch = now;
    		DFOptions.DFFound = 0;
    		saveDFOptions();
    		document.getElementById('DFStats').innerHTML='Searching: <PROGRESS id=searchProgress value="0" max="'+ ToSearch.length +'"></progress>';
    		for (i=0;i<ToSearch.length;i++) {
    			X = parseInt(Seed.cities[ToSearch[i]][2]);
              	Y = parseInt(Seed.cities[ToSearch[i]][3]);
				setTimeout(t.MakeBlocks,((i+1)*6500),X,Y,(ToSearch[i]+1),(i+1),ToSearch.length);
    		}
    	}	
    },

    MakeBlocks:function(getX,getY,city,i,length){
    	var t = Tabs.DF;
    	var blocks = [];
		var xx=0;
		var yy=0;
		for (x=(getX-35);x<=(getX+35);x+=5) {
		   for (y=(getY-35);y<=(getY+35);y+=5) {
				xx=x;
				yy=y;
				if (x>750) xx-=750;
				if (y>750) yy-=750;
				if (x<0) xx+=750;
				if (y<0) yy+=750;
				blocks.push ("bl_" + xx + "_bt_" + yy);
			}
		}
		t.doSearch(blocks,getX,getY,city,i,length)
    },

    doSearch:function (pass,xx,yy,city,i,length){
    	var t = Tabs.DF;
		var mapDat = [];
	    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    	params.blocks = pass;
	     
	    new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/fetchMapTiles.php" + unsafeWindow.g_ajaxsuffix, {
      		method: "post",
      		parameters: params,
      		onSuccess: function (transport) {
      			var rslt = eval("(" + transport.responseText + ")");
        		if (rslt.ok) {
        			if (rslt.data == []) alert("MAP ERROR");
        			if (i < length) document.getElementById('searchProgress').value = i;
        			else document.getElementById('DFStats').innerHTML = "";
        			for (y in rslt.data) {
        				if (rslt.data[y].tileType == 54 && DFOptions.Levels[city][parseInt(rslt.data[y].tileLevel)]) {
        					var tileX = parseInt(rslt.data[y].xCoord);
        					var tileY = parseInt(rslt.data[y].yCoord);
							var Level = parseInt(rslt.data[y].tileLevel);
							var dist = distance(xx, yy, tileX, tileY);
        					mapDat.push({X:tileX,Y:tileY,Level:Level,dist:dist});
        					DFOptions.DFFound++;
        					saveDFOptions();
        				}
        			}        			        			
					GM_setValue('DarkForest_' + Seed.player['name'] + '_city_' + city + '_' + getServerId(), JSON2.stringify(mapDat));
					var helpArray = JSON2.parse(GM_getValue('DarkForest_' + Seed.player['name'] + '_city_' + city + '_' + getServerId(),"[]"));
					if (helpArray) t.DFArray[(city-1)] = helpArray.sort(function sortBarbs(a,b) {a = a['dist'];b = b['dist'];return a == b ? 0 : (a < b ? -1 : 1);});
					if (i < length) document.getElementById('searchProgress').value = i;
        			else document.getElementById('DFStats').innerHTML = "Last Search done at: " + FullDateTime(DFOptions.LastSearch) + " found " + DFOptions.DFFound + "Dark Forests.";
        		}
      		},
    	});
	},

    CalcMax : function (city,troop){
    	var t = Tabs.DF;
    	var maxsend = 0;
    	var rallypointlevel = 0;	
    	for (var o in Seed.buildings["city" + city]){
		    var buildingType = parseInt(Seed.buildings["city" + city][o][0]);
		    var buildingLevel = parseInt(Seed.buildings["city" + city][o][1]);
		    if (buildingType == 12) rallypointlevel=parseInt(buildingLevel);
		}
    	if(rallypointlevel == 11) rallypointlevel = 15;
		if(rallypointlevel == 12) rallypointlevel = 20;
    	maxsend = (rallypointlevel * 10000);
		if (Seed.cityData.city[city].isPrestigeCity) {
    		switch(parseInt(Seed.cityData.city[city].prestigeInfo.prestigeLevel)){
    			case 1: maxsend = Math.round(maxsend * 1.50);break;
    			case 2: maxsend = Math.round(maxsend * 1.60);break;
    			case 3: maxsend = Math.round(maxsend * 1.65);break;
    		}
    	}
    	var TR = unsafeWindow.cm.ThroneController.effectBonus(66);
    	if (TR > 150) TR=150;
    	//maxsend = maxsend + ((maxsend / 100) * TR);
    	maxsend+=Math.round(maxsend * (TR / 100));
    	if (maxsend > Seed.units["city" + city]["unt"+troop]) maxsend=0;
    	return maxsend; 
    },

	getKnights : function(){
	   var t = Tabs.DF;
	   t.knt = new Array();
	   for (k in Seed.knights['city' + t.from.city.id]){
	           if (Seed.knights['city' + t.from.city.id][k]["knightStatus"] == 1 && Seed.leaders['city' + t.from.city.id]["resourcefulnessKnightId"] != Seed.knights['city' + t.from.city.id][k]["knightId"] && Seed.leaders['city' + t.from.city.id]["politicsKnightId"] != Seed.knights['city' + t.from.city.id][k]["knightId"] && Seed.leaders['city' + t.from.city.id]["combatKnightId"] != Seed.knights['city' + t.from.city.id][k]["knightId"] && Seed.leaders['city' + t.from.city.id]["intelligenceKnightId"] != Seed.knights['city' + t.from.city.id][k]["knightId"]){
	               t.knt.push ({
	                   Name:   Seed.knights['city' + t.from.city.id][k]["knightName"],
	                   Combat:    parseInt(Seed.knights['city' + t.from.city.id][k]["combat"]),
	                   ID:        Seed.knights['city' + t.from.city.id][k]["knightId"],
	               });
	           }
	   }
	   t.knt = t.knt.sort(function sort(a,b) {a = a['Combat'];b = b['Combat'];return a == b ? 0 : (a > b ? -1 : 1);});
	 
	},

    show: function(){var t = Tabs.DF;},
    hide: function(){var t = Tabs.DF;},
    onUnload: function(){},
}


/************************  March Tab ************************/
Tabs.March = {
  tabOrder: 999998,
  tabLabel: 'March',
  myDiv: null,
  cityID: null,
  rallypointlevel:null,
  maxsend:0,
  dist:0,
  ETAstr:null,
  ETAType:null,
  checkETA:null,
  knt:null,
  ETAstr:null,
  ETAType:null,
  checkETA:null,
  resources:["food","wood","stone","iron","aetherstone"],
  speed:["0,0","0,180","0,200","0,3000","0,300","0,275","0,250","1,1000","1,750","1,150","1,100","1,120","1,80","0,900","0,500","1,775"],

    init: function(div){
    	var t = Tabs.March;
        t.myDiv = div;
        unsafeWindow.RemoveQueue = t.RemoveQueue;

        t.i931 = 0;
	    t.i932 = 0;
	    t.i55 = 0;
	    t.i57 = 0;
	    
	    if (Seed.items['i'+931]) t.i931 = Seed.items['i'+931];
	    if (Seed.items['i'+932]) t.i932 = Seed.items['i'+932];
	    if (Seed.items['i'+55]) t.i55 = Seed.items['i'+55];
	    if (Seed.items['i'+57]) t.i57 = Seed.items['i'+57];

      	var m = t.PaintContent();
      	t.myDiv.innerHTML = m;

      	if (t.i931 == 0) document.getElementById('AuraOfCommand').disabled = true; else document.getElementById('AuraOfCommand').disabled = false;
      	if (t.i932 == 0) document.getElementById('AuraOfConquest').disabled = true; else document.getElementById('AuraOfConquest').disabled = false;
      	if (t.i55 == 0) document.getElementById('GreenGriffin').disabled = true; else document.getElementById('GreenGriffin').disabled = false;
      	if (t.i57 == 0) document.getElementById('RedDragon').disabled = true; else document.getElementById('RedDragon').disabled = false;

      	t.from = new CdispCityPicker ('pbMfrom', document.getElementById('pbMcityFrom'), true, t.ClickCitySelect, 0);  
      	t.to = new CdispCityPicker ('pbMcityTo', document.getElementById ('pbMcityTo'), true, t.citySelNotify);
		t.to.bindToXYboxes(document.getElementById ('MtargetX'), document.getElementById ('MtargetY'));

      	for (i=1;i<=15;i++)  document.getElementById('M_Max'+i).addEventListener('click', function(){t.CalcMax(this.id);t.ETA();}, false);
        for (i=0;i<5;i++)  document.getElementById('M_R_Max'+i).addEventListener('click', function(){t.Calc_R_Max(this.id)}, false);
        for (i=1;i<=15;i++)  document.getElementById('M_Unt'+i).addEventListener('change', function(){t.ETA()}, false);	
        document.getElementById('MtargetX').addEventListener('change', function(){if (document.getElementById("MtargetX").value != "" && document.getElementById("MtargetY").value != "") document.getElementById('M_Dist'). innerHTML = "Dist.: " + distance(t.from.city.x, t.from.city.y, document.getElementById("MtargetX").value, document.getElementById("MtargetY").value);}, false);
    	document.getElementById('MtargetY').addEventListener('change', function(){if (document.getElementById("MtargetX").value != "" && document.getElementById("MtargetY").value != "") document.getElementById('M_Dist'). innerHTML = "Dist.: " + distance(t.from.city.x, t.from.city.y, document.getElementById("MtargetX").value, document.getElementById("MtargetY").value);}, false);
		document.getElementById('addToQueue').addEventListener ('click', t.GetCoords,false); 	
		document.getElementById('ManualMarch').addEventListener ('click', t.ManualMarch,false);
		document.getElementById('pbMarchType').addEventListener ('click', t.MarchType,false);
		document.getElementById('RedDragon').addEventListener ('click', t.PaintMarchSize,false);
		document.getElementById('AuraOfCommand').addEventListener ('click', t.PaintMarchSize,false);
		document.getElementById('AuraOfConquest').addEventListener ('click', t.PaintMarchSize,false);
		document.getElementById('GreenGriffin').addEventListener ('click', function(){if (document.getElementById('GreenGriffin').checked) document.getElementById('RedDragon').checked = false;t.ETA();},false);
		document.getElementById('RedDragon').addEventListener ('click', function(){if (document.getElementById('RedDragon').checked) document.getElementById('GreenGriffin').checked = false;t.ETA();},false);
        if (MarchOptions.Queue.length > 0) t.PaintQueue();
        t.PaintMarchSize(); 
        t.ClickCitySelect();  
        t.MarchType();
    },

    PaintContent : function (){
    	var t = Tabs.March;
    	var color = "black";
    	var m = '<DIV id=pbReinfMain class=pbStat>INFO</div><DIV id=MPresetCont></div>'; 
      	m += '<DIV id=pbReinfMain class=pbStat>MARCH (SAVE MARCHES TO LAUNCH MANUALLY)</div><TABLE id=pireinforce width=80% height=0% class=pbTab>';    
      	m += '<TR><TD><B>From City: </b></td><TD><SPAN id=pbMcityFrom></span></td></tr>';
      	m += '<TR><TD><B>To City:</b></td><TD><SPAN id=pbMcityTo></span></td><TD><INPUT id=MtargetX maxlength=3 type=text>&nbsp&nbsp&nbspY:&nbsp<INPUT id=MtargetY maxlength=3 type=text></td>';
      	m += '<TD><SPAN id=M_Dist>Dist.: N/A</span></td><TD><SPAN id=M_ETA>ETA.: N/A</span></td></tr></table>';
    	m += '<TABLE id=pbMarch width=100% height=0% class=pbTab><TR>';
     	for (i=1;i<=5;i++) m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+i+'_30_s34.jpg?6545"></td><TD><SPAN id=M_unit'+i+'></span></td>';
      	m+='</tr><TR>';
      	for (i=1;i<=5;i++) m += '<TD><INPUT id=M_Unt'+i+' type=text size=10 maxlength=10 value="0"><INPUT id=M_Max'+i+' type=submit class=pbButton value='+translate("Max")+'></td>';
      	m+='</tr><TR>';   	
      	for (i=6;i<=10;i++) m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+i+'_30_s34.jpg?6545"></td><TD><SPAN id=M_unit'+i+'></span></td>';
      	m+='</tr><TR>';
      	for (i=6;i<=10;i++) m += '<TD><INPUT id=M_Unt'+i+' type=text size=10 maxlength=10 value="0"><INPUT id=M_Max'+i+' type=submit class=pbButton value='+translate("Max")+'></td>';
      	m+='</tr><TR>';
      	for (i=11;i<=15;i++) m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+i+'_30_s34.jpg?6545"></td><TD><SPAN id=M_unit'+i+'></span></td>';
      	m+='</tr><TR>';
      	for (i=11;i<=15;i++) m += '<TD><INPUT id=M_Unt'+i+' type=text size=10 maxlength=10 value="0"><INPUT id=M_Max'+i+' type=submit class=pbButton value='+translate("Max")+'></td>';
      	m+='</tr><TR>';
      	for (i=0;i<5;i++) m += '<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/'+t.resources[i]+'_30.png"></td><TD><SPAN id=M_recInfo'+i+'></span></td>';
      	m+='</tr><TR>';
        for (i=0;i<5;i++) m += '<TD><INPUT id=M_Recource'+i+' type=text size=10 maxlength=10 value="0"><INPUT id=M_R_Max'+i+' type=submit class=pbButton value='+translate("Max")+'></td>';

	    m += '</tr></table><BR><TABLE id=pbReinfETA width=90% height=0% align="center" class=pbTab>';
	    m += '<TR align="center"><TD rowspan=2 width=150px><SELECT id="pbMarchType"><OPTION value=4>Attack</option><OPTION value=3>Scout</option><OPTION value=5>Reassign</option><OPTION value=2>Reinforce</option></select></td>';
	    m += '<TD rowspan=2><SELECT id=M_Knight type=list></select></td>';
	    m += '<TD rowspan=2 width=100px><a class="button20" id=addToQueue><span>Save march</span></a></td><TD rowspan=2 width=100px><a class="button20" id=ManualMarch><span>Manual March</span></a></td>';
	    m += '<TD style="width:30px;text-align:right"><INPUT id=AuraOfCommand type=checkbox unchecked=true><TD rowspan=2 width=30px><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/30/931.jpg></td>';
	    m += '<TD style="width:30px;text-align:right"><INPUT id=AuraOfConquest type=checkbox unchecked=true><TD rowspan=2 width=30px><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/30/932.jpg></td>';
	    m += '<TD style="width:30px;text-align:right"><INPUT id=GreenGriffin type=checkbox unchecked=true><TD rowspan=2 width=30px><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/30/55.jpg></td>';
	    m += '<TD style="width:30px;text-align:right"><INPUT id=RedDragon type=checkbox unchecked=true><TD rowspan=2 width=30px><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/30/57.jpg></td>';

	    if (t.i931 == 0) color = "red"; else color = "black";
	    m+= '<TR align="center"><TD align=right><FONT color='+color+'>'+t.i931+'</font></td>';
	    if (t.i932 == 0) color = "red"; else color = "black";
	    m+= '<TD align=right><FONT color='+color+'>'+t.i932+'</font></td>'
	    if (t.i55 == 0) color = "red"; else color = "black";
	    m+= '<TD align=right><FONT color='+color+'>'+t.i55+'</font></td>'
	    if (t.i57 == 0) color = "red"; else color = "black";
	    m+= '<TD align=right><FONT color='+color+'>'+t.i57+'</font></td>'
	    m += '</tr></table>';
	    m+= '<BR><DIV id=MarchInfo></div>';
	    m+= '<BR><DIV id=pbReinfMain class=pbStat>Saved Marches</div><BR><BR><DIV id=M_Queue></div>';
	    return m;
    },

    ListKnights : function(){
       	var t = Tabs.March;
       	var knt = new Array();
       	for (k in Seed.knights['city' + t.from.city.id]){
       		if (Seed.knights['city' + t.from.city.id][k]["knightStatus"] == 1 && Seed.leaders['city' + t.from.city.id]["resourcefulnessKnightId"] != Seed.knights['city' + t.from.city.id][k]["knightId"] && Seed.leaders['city' + t.from.city.id]["politicsKnightId"] != Seed.knights['city' + t.from.city.id][k]["knightId"] && Seed.leaders['city' + t.from.city.id]["combatKnightId"] != Seed.knights['city' + t.from.city.id][k]["knightId"] && Seed.leaders['city' + t.from.city.id]["intelligenceKnightId"] != Seed.knights['city' + t.from.city.id][k]["knightId"]){
       			knt.push ({
       				Name:   Seed.knights['city' + t.from.city.id][k]["knightName"],
       				Combat:	(parseInt(Seed.knights['city' + t.from.city.id][k]["combat"])+((Seed.knights['city' + t.from.city.id][k]["combatBoostExpireUnixtime"]>0)?(Math.floor(parseInt(Seed.knights['city' + t.from.city.id][k]["combat"])*0.25)):0)),
       				ID:		Seed.knights['city' + t.from.city.id][k]["knightId"],
       			});
       		}
       	}
       	knt = knt.sort(function sort(a,b) {a = a['Combat'];b = b['Combat'];return a == b ? 0 : (a > b ? -1 : 1);});
      	document.getElementById('M_Knight').options.length=0;	
		if (document.getElementById('pbMarchType').value != 4) t.AddZeroKnight();
       	for (k in knt){
    			if (knt[k]["Name"] !=undefined){
	    			var o = document.createElement("option");
	    			o.text = (knt[k]["Name"] + ' (' + knt[k]["Combat"] +')')
	    			o.value = knt[k]["ID"];
	    			document.getElementById("M_Knight").options.add(o);
    			}
    	}
    	if (document.getElementById('pbMarchType').value == 4) t.AddZeroKnight();
    },

    AddZeroKnight: function(){
    	var o = document.createElement("option");
		o.text = '--Choose a Knight--';
		o.value = 0;
		document.getElementById("M_Knight").options.add(o);
    },

    PaintMarchSize : function (){
    	var t = Tabs.March;
    	var Aura = 0;
    	if (document.getElementById('AuraOfCommand').checked) Aura = 25;
    	if (document.getElementById('AuraOfConquest').checked) Aura = 50;
   		t.getRallypoint("city" + t.from.city.id);
    	RallypointMax = (t.rallypointlevel * 10000);
    	var TR = unsafeWindow.cm.ThroneController.effectBonus(66);
    	if (TR > 150) TR=150;
    	//t.maxsend = RallypointMax + ((RallypointMax / 100) * TR);
    	t.maxsend = RallypointMax + Math.round(RallypointMax * (TR / 100));
    	if (Seed.cityData.city[t.from.city.id].isPrestigeCity) {
    		switch(parseInt(Seed.cityData.city[t.from.city.id].prestigeInfo.prestigeLevel)){
    			case 1: t.maxsend = Math.round(t.maxsend * 1.50);break;
    			case 2: t.maxsend = Math.round(t.maxsend * 1.60);break;
    			case 3: t.maxsend = Math.round(t.maxsend * 1.65);break;
    		}
    	}
    	t.maxsend = t.maxsend * (1 + (Aura/100));  	
    	var m = 'March Size: ' + addCommas(Math.floor(t.maxsend)) + ' (TR: ' + TR + '% - Aura: ' + Aura + '%)';
    	document.getElementById('MPresetCont').innerHTML = m;
    },

    MarchType : function(){
    	var t = Tabs.March;  
    	if (document.getElementById('pbMarchType').value == 3) {
    		for (var i=1;i<=15;i++) if (i!=3) {
    			document.getElementById('M_Unt'+i).disabled = true;
    			document.getElementById('M_Unt'+i).value = 0;
    			document.getElementById('M_Max'+i).disabled = true;
    		} else if (Seed.units["city" + t.from.city.id]["unt"+i] ==0) {
    			document.getElementById('M_Unt'+i).disabled = true;
    			document.getElementById('M_Unt'+i).value = 0;
    			document.getElementById('M_Max'+i).disabled = true;
    		} else {
    			document.getElementById('M_Unt'+i).disabled = false;
	    		document.getElementById('M_Max'+i).disabled = false; 
    		}
    	} else for (var i=1;i<=15;i++) {
    		if (Seed.units["city" + t.from.city.id]["unt"+i] == 0) {
	    		document.getElementById('M_Unt'+i).disabled = true;
	    		document.getElementById('M_Unt'+i).value = 0;
	    		document.getElementById('M_Max'+i).disabled = true; 
	    	} else {
	    		document.getElementById('M_Unt'+i).disabled = false;
	    		document.getElementById('M_Max'+i).disabled = false; 
	    	}
    	}

    	if (document.getElementById('pbMarchType').value != 2) for (i=0;i<5;i++) {document.getElementById('M_Recource'+i).disabled = true;document.getElementById('M_R_Max'+i).disabled = true;}
    	else for (i=0;i<5;i++) {document.getElementById('M_Recource'+i).disabled = false;document.getElementById('M_R_Max'+i).disabled = false;}
    	t.ListKnights();
    },

    ShowWarning: function(msg,ok){
    	var t = Tabs.March;
    	if (ok) var color = "green";
    	 else var color = "red";
    	document.getElementById('MarchInfo').innerHTML = '<FONT color='+color+'><B>' + msg + '</b></font>';
    },

    ManualMarch : function (){
    	var t = Tabs.March;
    	var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    	var total = 0;
		params.kid = document.getElementById("M_Knight").value;
		if (params.kid == 0 && document.getElementById('pbMarchType').value==4) {t.ShowWarning('Please select a knight...',false);return;}
		params.cid=t.from.city.id;
    	params.type=document.getElementById('pbMarchType').value;
	    params.xcoord = document.getElementById('MtargetX').value;
	    params.ycoord = document.getElementById('MtargetY').value;
	    TroopsOK = true;
	    for (var i=1;i<=15;i++){
	    	TroopsInCity = Seed.units['city'+t.from.city.id]['unt'+i];
    		if (parseInt(TroopsInCity) < parseInt(document.getElementById('M_Unt'+i).value)) TroopsOK = false;
    		else if (parseInt(document.getElementById('M_Unt'+i).value) > 0) params['u'+i]=parseInt(document.getElementById('M_Unt'+i).value);
	    }
	    for (i=0;i<5;i++) params['r'+(i+1)] = document.getElementById('M_Recource'+i).value; 
	    if (!TroopsOK) return;

	    if (params.xcoord =="" || params.xcoord=="") {t.ShowWarning("Please enter coords...",false);return;}
	    for (i=1;i<=15;i++) total += parseInt(document.getElementById('M_Unt'+i).value);
	    if (total == 0) {t.ShowWarning("You got to send a least one troop...",false);return;}
		if (total > t.maxsend) {t.ShowWarning("Can't send out that amount of troops, wrong TR cards or Aura?",false);return;}

	    var items=new Array();
	    if (document.getElementById('AuraOfCommand').checked) items.push(931);
	    if (document.getElementById('AuraOfConquest').checked) items.push(932);
	    if (document.getElementById('GreenGriffin').checked) items.push(55);
	    if (document.getElementById('RedDragon').checked) items.push(57);
	    if (items.length > 0) params.items=items.join(","); 
	     
    	new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/march.php" + unsafeWindow.g_ajaxsuffix, {
              method: "post",
              parameters: params,
              loading: true,
              onSuccess: function (transport) {
                  var rslt = eval("(" + transport.responseText + ")");
                  if (rslt.ok) {
	                  var now = unixTime();
	                  var timediff = parseInt(rslt.eta) - parseInt(rslt.initTS);
	                  var ut = unixTime();
	                  var unitsarr=[0,0,0,0,0,0,0,0,0,0,0,0,0];
	                  for(i = 0; i <= unitsarr.length; i++) if(params["u"+i]) unitsarr[i] = params["u"+i];  
	                  var resources=new Array();
	                  resources[0] = params.gold;
	                  for(i=1; i<=4; i++) resources[i] = params["r"+i];
	                  var currentcityid = params.cid;
	                  unsafeWindow.attach_addoutgoingmarch(rslt.marchId, rslt.marchUnixTime, ut + timediff, params.xcoord, params.ycoord, unitsarr, params.type, params.kid, resources, rslt.tileId, rslt.tileType, rslt.tileLevel, currentcityid, true);
	                  if(rslt.updateSeed){unsafeWindow.update_seed(rslt.updateSeed)};  
	                  for(var i=0;i<items.length;i++){
							Seed.items["i"+items[i]]=parseInt(Seed.items["i"+items[i]])-1;
							unsafeWindow.ksoItems[items[i]].subtract();
					  }
	                  //t.myDiv.innerHTML = "";
	                  //t.init(t.myDiv);
	                  switch (parseInt(params.type)) {
							case 1: var type = "TRANSPORT";break;
							case 2: var type = "REINFORCE";break;
							case 3: var type = "SCOUT";break;
							case 4: var type = "ATTACK";break;
							case 5: var type = "REASSIGN";break;
					  }
	                  msg = 'Send ' + type + ' to ' + coordLink(params.xcoord,params.ycoord);
	                  t.ShowWarning(msg,true);
	                  setTimeout(t.ShowWarning,5000,"",true)
	                  t.PaintMarchSize(); 
        			  t.ClickCitySelect();  
        			  t.MarchType();
                  } else {t.ShowWarning("Error: "+ rslt.msg,false)}
              },
              onFailure: function () {}
      });     

    },

    Calc_R_Max : function(what){
    	var t = Tabs.March;
    	var otherResources = 0;
    	var maxload = 0;
    	var otherRes = 0;
    	id = what.substr(7);
		for (i=1;i<=15;i++) if (parseInt(document.getElementById('M_Unt'+i).value) > 0) maxload += getMaxLoad(i,parseInt(document.getElementById('M_Unt'+i).value));
		for (i=0;i<5;i++) if (id != i) otherRes += parseInt(document.getElementById('M_Recource' + i).value);
		maxload = maxload - otherRes;
		document.getElementById('M_Recource'+id).value = maxload;
    },

    CalcMax : function (i){
    	var t = Tabs.March;
    	var othertroops=0;
    	var max=0;
    	id = i.substr(5);
    	var rallypointlevel = 0;
    	for (var o in Seed.buildings["city"+ t.from.city.id]){
		    var buildingType = parseInt(Seed.buildings["city"+ t.from.city.id][o][0]);
		    var buildingLevel = parseInt(Seed.buildings["city"+ t.from.city.id][o][1]);
		    if (buildingType == 12) rallypointlevel=parseInt(buildingLevel);
		}
    	if(rallypointlevel == 11) rallypointlevel = 15;
		if(rallypointlevel == 12) rallypointlevel = 20;
    	t.maxsend = (rallypointlevel * 10000);
		if (Seed.cityData.city[t.from.city.id].isPrestigeCity) {
    		switch(parseInt(Seed.cityData.city[t.from.city.id].prestigeInfo.prestigeLevel)){
    			case 1: t.maxsend = Math.round(t.maxsend * 1.50);break;
    			case 2: t.maxsend = Math.round(t.maxsend * 1.60);break;
    			case 3: t.maxsend = Math.round(t.maxsend * 1.65);break;
    		}
    	}
    	var TR = unsafeWindow.cm.ThroneController.effectBonus(66);
    	if (TR > 150) TR=150;
    	//t.maxsend = t.maxsend + ((t.maxsend / 100) * TR);
    	t.maxsend += Math.round(t.maxsend * (TR / 100));
    	if (document.getElementById('AuraOfCommand').checked) t.maxsend = t.maxsend * 1.25;
    	if (document.getElementById('AuraOfConquest').checked) t.maxsend = t.maxsend * 1.50;
    	for (i=1;i<=15;i++) if (id !=i) othertroops += parseInt(document.getElementById('M_Unt'+i).value);
    	if (othertroops < t.maxsend) max = (t.maxsend - othertroops);   	
    	if (max > Seed.units["city" + t.from.city.id]["unt"+id]) max = Seed.units["city" + t.from.city.id]["unt"+id];
    	document.getElementById('M_Unt'+id).value = Math.floor(max);
    },

    ETA : function (){
    	var t = Tabs.March;
    	var a = {};
    	for (i=1;i<=15;i++) a[i] = document.getElementById('M_Unt'+i).value;
    	var items = {};

    	if (document.getElementById('GreenGriffin').checked) items["55"] = true;
	     else if (document.getElementById('RedDragon').checked) items["57"] = true;
    	var dist = distance(t.from.city.x, t.from.city.y, document.getElementById("MtargetX").value, document.getElementById("MtargetY").value)
    	var ETA = marchTimeCalculator(a, false, items, t.from.city.id, document.getElementById('pbMarchType').value,dist);
    	document.getElementById('M_ETA').innerHTML = "ETA: " + ETA;
    },

	GetCoords : function (){
	    var t= Tabs.March;
	    var targetName = "";
	    var targetCityName = "";
	    var total=0;
	    targetX = document.getElementById('MtargetX').value;
	    targetY = document.getElementById('MtargetY').value;
	    if (targetX =="" || targetY=="") {alert("Please enter coords...");return;}
	    for (i=1;i<=15;i++) total += parseInt(document.getElementById('M_Unt'+i).value);
	    if (total == 0) {alert("You got to send a least one troop...");return;}
	    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    	params.blocks = "bl_" + targetX + "_bt_" + targetY;
	    
	    new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/fetchMapTiles.php" + unsafeWindow.g_ajaxsuffix, {
      		method: "post",
      		parameters: params,
      		onSuccess: function (transport) {
      			var rslt = eval("(" + transport.responseText + ")");
        		if (rslt.ok) {
        			if (rslt.data["l_"+targetX+"_t_"+targetY].tileType == 51) {
        				userId = rslt.data["l_"+targetX+"_t_"+targetY].tileUserId;
        				if (userId != null) targetName = rslt.userInfo["u" + userId]["n"];
        				targetCityName = rslt.data["l_"+targetX+"_t_"+targetY].cityName;
        			}
        			MarchOptions.Queue.push ({
        				what: 			"March",
        				city: 			t.from.city.id,
        				action: 		document.getElementById('pbMarchType').value,
        				targetX: 		targetX,
        				targetY: 		targetY,
        				tileType: 		rslt.data["l_"+targetX+"_t_"+targetY].tileType,
        				tileLevel: 		rslt.data["l_"+targetX+"_t_"+targetY].tileLevel,
        				targetCityName: targetCityName,
        				targetName: 	targetName,
        				cityNumber: 	rslt.data["l_"+targetX+"_t_"+targetY].cityNum,
        				1: 				document.getElementById('M_Unt1').value,
        				2: 				document.getElementById('M_Unt2').value,
        				3: 				document.getElementById('M_Unt3').value,
        				4: 				document.getElementById('M_Unt4').value,
        				5: 				document.getElementById('M_Unt5').value,
        				6: 				document.getElementById('M_Unt6').value,
        				7: 				document.getElementById('M_Unt7').value,
        				8: 				document.getElementById('M_Unt8').value,
        				9: 				document.getElementById('M_Unt9').value,
        				10: 			document.getElementById('M_Unt10').value,
        				11: 			document.getElementById('M_Unt11').value,
        				12: 			document.getElementById('M_Unt12').value,
        				13: 			document.getElementById('M_Unt13').value,
        				14: 			document.getElementById('M_Unt14').value,
        				15: 			document.getElementById('M_Unt15').value,	
        				r1: 			document.getElementById('M_Recource0').value,
        				r2: 			document.getElementById('M_Recource1').value,
        				r3: 			document.getElementById('M_Recource2').value,
        				r4: 			document.getElementById('M_Recource3').value,
        				r5: 			document.getElementById('M_Recource4').value
        			});
					t.PaintQueue();
					saveMarchOptions();
					for(i=1;i<=15;i++) document.getElementById('M_Unt'+i).value=0;
					document.getElementById('MtargetX').value="";
					document.getElementById('MtargetY').value="";
					Dashboard.ShowMarches();
        		}
      		},
    	});	
	},

PaintQueue : function (){
    var t= Tabs.March;
    document.getElementById('M_Queue').innerHTML = '<TABLE id=ShowQ class=pbStat align="center" width=80%></table>';
    for (k=(MarchOptions.Queue.length-1);k>=0;k--) t._addTab(MarchOptions.Queue[k],k);  
    t._addTabHeader();
 },

 _addTab: function(action,k){
    var t = Tabs.March;
    for (postcity in Seed.cities) if (Seed.cities[postcity][0] == action.city) logcity = Seed.cities[postcity][1];
    var total = 0;
	var info = "";
	var type="";
	for (i=1;i<=15;i++) total += parseInt(action[i]);
	switch (parseInt(action.tileType)) {
		case 0: info = "Bog";break;
		case 10: info = "Grassland";break;
		case 11: info = "Lake";break;
		case 20: info = "Woods";break;
		case 30: info = "Hills";break;
		case 40: info = "Mountain";break;
		case 50: info = "Plain";break;
		case 51: 
			if (action.targetCityName == null && !action.misted) info = "Barb Camp";
				else info = action.targetName;
			break;
		case 53: info = "Misted City";break;
	}
	switch (parseInt(action.action)) {
		case 1: type = "TRANSPORT";break;
		case 2: type = "REINFORCE";break;
		case 3: type = "SCOUT";break;
		case 4: type = "ATTACK";break;
		case 5: type = "REASSIGN";break;
	}
    var row = document.getElementById('ShowQ').insertRow(0);
    row.vAlign = 'top';
    row.style.color = "black";
    row.insertCell(0).innerHTML ='<A onclick="RemoveQueue('+ k +')"><img src="data:image/png;base64,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"/>';	  
    row.insertCell(1).innerHTML = logcity;
    row.insertCell(2).innerHTML = coordLink(parseInt(action.targetX),parseInt(action.targetY));
    row.insertCell(3).innerHTML = info;
    row.insertCell(4).innerHTML = action.targetCityName;
    row.insertCell(5).innerHTML = action.tileLevel;
    row.insertCell(6).innerHTML = addCommas(total);
    row.insertCell(7).innerHTML = '<a class="button20" id="Details' + k + '"><span>Details</span></a>&nbsp&nbsp&nbsp<a class="button20 ptButtonRed" id="doAction' + k + '"><span>'+ type+'</span></a>';
    document.getElementById('doAction' + k).addEventListener('click', function(){t.doMarch(action);}, false);
    document.getElementById('Details' + k).addEventListener('click', function(){t.DetailsPop(action,logcity,info);}, false);
},

_addTabHeader: function() {
    var t = Tabs.March;
    var row = document.getElementById('ShowQ').insertRow(0);
    row.vAlign = 'top';
    row.style.color = "black";
    row.insertCell(0).innerHTML = "&nbsp";
    row.insertCell(1).innerHTML = "From City";
    row.insertCell(2).innerHTML = "Coords";
    row.insertCell(3).innerHTML = "Target Name";
    row.insertCell(4).innerHTML = "City";
    row.insertCell(5).innerHTML = "Level";
    row.insertCell(6).innerHTML = "Troops";
    row.insertCell(7).innerHTML = "Action";
},

DetailsPop : function (action,logcity,info){
	var t = Tabs.March;
	var m = '<TABLE id=pbMarch width=100% height=0% class=pbTab>';
    m+= '<TR><TD width="50px"></td><TD>From city: ' + logcity + '</td></tr>';
    m+= '<TR><TD width="50px"></td><TD>Target: ' + info + '</td></tr>';
    m+= '<TR><TD width="50px"></td><TD>City: ' + action.targetCityName + '</td></tr>';
    m+= '<TR><TD width="50px"></td><TD>Level: ' + action.tileLevel + '</td></tr>';
    m+= '<TR><TD width="50px"></td><TD>Coords: ' +  coordLink(parseInt(action.targetX),parseInt(action.targetY)) + '</td></tr></table><BR>';
    m += '<TABLE id=pbMarch width=100% height=0% class=pbTab><TR>';
    for (i=1;i<=4;i++) m += '<TD width="51px"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+i+'_50_s34.jpg?6545"></td><TD width="75px">'+ addCommas(action[i]) +'</td>';
    m+='</tr><TR>'; 
    for (i=5;i<=8;i++) m += '<TD width="51px"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+i+'_50_s34.jpg?6545"></td><TD width="75px">'+ addCommas(action[i]) +'</td>';
    m+='</tr><TR>'; 
    for (i=9;i<=12;i++) m += '<TD width="51px"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+i+'_50_s34.jpg?6545"></td><TD width="75px">'+ addCommas(action[i]) +'</td>';
    m+='</tr><TR>';
    for (i=13;i<=15;i++) m += '<TD width="51px"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+i+'_50_s34.jpg?6545"></td><TD width="75px">'+ addCommas(action[i]) +'</td>';
    m+='</tr></table><BR>'; 
	m += '<TABLE id=pbMarch width=100% height=0% class=pbTab><TR>';
    m+='<TD width="30px"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/food_30.png"></td><TD width="100px">' + addCommas(action.r1) +'</td>';
	m+='<TD width="30px"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/wood_30.png"></td><TD width="100px">' + addCommas(action.r2) +'</td>';
	m+='<TD width="30px"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/stone_30.png"></td><TD width="100px">' + addCommas(action.r3) +'</td>';
	m+='<TD width="30px"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/iron_30.png"></td><TD width="100px">' + addCommas(action.r4) +'</td>';
	m+='</tr></TR><TD width="30px"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/aetherstone_30.png"></td><TD width="100px">' + addCommas(action.r5) +'</td>';
	m+='<TD width="30px"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/gold_30.png"></td><TD width="100px">' + addCommas(action.gold) +'</td>';
	m+='</tr></table>'; 	
    var pop = new pbPopup ('giftHelp', 0, 0, 550, 410, true);
    pop.centerMe (mainPop.getMainDiv());  
    pop.getMainDiv().innerHTML = m;
    pop.getTopDiv().innerHTML = '<CENTER><B>Saved March info</center>';
    pop.show (true);
  },


    
ClickCitySelect: function(city){
    var t = Tabs.March;  
    for (i=1;i<=15;i++) {
    	document.getElementById('M_unit'+i).innerHTML = addCommas(Seed.units["city" + t.from.city.id]["unt"+i]);
    	if (Seed.units["city" + t.from.city.id]["unt"+i] ==0) {
    		document.getElementById('M_Unt'+i).disabled = true;
    		document.getElementById('M_Unt'+i).value = 0;
    		document.getElementById('M_Max'+i).disabled = true;
    	}
    }
    for (i=0;i<=4;i++) {
    	var rec = 0;
    	if (i==4) rec = parseInt(Seed.resources["city" + t.from.city.id]['rec'+(i+1)][0]);
    	else rec = parseInt(Seed.resources["city" + t.from.city.id]['rec'+(i+1)][0]/3600);
    	document.getElementById('M_recInfo'+i).innerHTML = addCommas(Math.round(rec));	
    }
    if (document.getElementById("MtargetX").value != "" && document.getElementById("MtargetY").value != "") {
    	document.getElementById('M_Dist'). innerHTML = "Dist.: " + distance(t.from.city.x, t.from.city.y, document.getElementById("MtargetX").value, document.getElementById("MtargetY").value);
    	t.ETA();
    }
    t.ListKnights();
    t.PaintMarchSize();
    t.MarchType();
},

RemoveQueue: function(id){
    var t = Tabs.March;
    MarchOptions.Queue.splice(id,1);
    t.PaintQueue();
	saveMarchOptions();
	Dashboard.ShowMarches();
},
             
getKnights : function(){
   var t = Tabs.March;
   t.knt = new Array();
   for (k in Seed.knights['city' + t.from.city.id]){
           if (Seed.knights['city' + t.from.city.id][k]["knightStatus"] == 1 && Seed.leaders['city' + t.from.city.id]["resourcefulnessKnightId"] != Seed.knights['city' + t.from.city.id][k]["knightId"] && Seed.leaders['city' + t.from.city.id]["politicsKnightId"] != Seed.knights['city' + t.from.city.id][k]["knightId"] && Seed.leaders['city' + t.from.city.id]["combatKnightId"] != Seed.knights['city' + t.from.city.id][k]["knightId"] && Seed.leaders['city' + t.from.city.id]["intelligenceKnightId"] != Seed.knights['city' + t.from.city.id][k]["knightId"]){
               t.knt.push ({
                   Name:   Seed.knights['city' + t.from.city.id][k]["knightName"],
                   Combat:    parseInt(Seed.knights['city' + t.from.city.id][k]["combat"]),
                   ID:        Seed.knights['city' + t.from.city.id][k]["knightId"],
               });
           }
   }
   t.knt = t.knt.sort(function sort(a,b) {a = a['Combat'];b = b['Combat'];return a == b ? 0 : (a > b ? -1 : 1);});
},

    
    getRallypoint: function(cityId){
      var t = Tabs.March;
      for (var o in Seed.buildings[cityId]){
        var buildingType = parseInt(Seed.buildings[cityId][o][0]);
        var buildingLevel = parseInt(Seed.buildings[cityId][o][1]);
        if (buildingType == 12) t.rallypointlevel=parseInt(buildingLevel);
       }
     if(t.rallypointlevel == 11) t.rallypointlevel = 15;
     if(t.rallypointlevel == 12) t.rallypointlevel = 20;      
 	},

  
    doMarch: function(action){
        var t = Tabs.March;
        t.getKnights();
		if (t.knt.toSource() == "[]") return;
		var kid = t.knt[0].ID;
        var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
        params.cid=action.city;
        params.type=action.action;
        if (action.action == 4 || action.action == 5) params.kid=kid;
        else params.kid=0;
        params.xcoord = action.targetX;
        params.ycoord = action.targetY;
        params.u1=action["1"];
        params.u2=action["2"];
        params.u3=action["3"];
        params.u4=action["4"];
        params.u5=action["5"];
        params.u6=action["6"];
        params.u7=action["7"];
        params.u8=action["8"];
        params.u9=action["9"];
        params.u10=action["10"];
        params.u11=action["11"];
        params.u12=action["12"];
        params.u13=action["13"];
        params.u14=action["14"];
        params.u15=action["15"];
        if (action.gold) params.gold = action.gold;
      	if (action.r1) params.r1= action.r1;
      	if (action.r2) params.r2= action.r2;
      	if (action.r3) params.r3= action.r3;
      	if (action.r4) params.r4= action.r4;
      	if (action.r5) params.r5= action.r5;
        
        var total=0;
    	var max = 0;
    	t.getRallypoint("city" + action.city);
    	RallypointMax = (t.rallypointlevel * 10000);
    	var TR = unsafeWindow.cm.ThroneController.effectBonus(66);
    	if (TR > 150) TR=150;
    	//t.maxsend = RallypointMax + ((RallypointMax / 100) * TR);
    	t.maxsend = RallypointMax + Math.round(RallypointMax * (TR / 100));
    	if (Seed.cityData.city[t.from.city.id].isPrestigeCity) {
    		switch(parseInt(Seed.cityData.city[t.from.city.id].prestigeInfo.prestigeLevel)){
    			case 1: t.maxsend = Math.round(t.maxsend * 1.50);break;
    			case 2: t.maxsend = Math.round(t.maxsend * 1.60);break;
    			case 3: t.maxsend = Math.round(t.maxsend * 1.65);break;
    		}
    	}
    	for (i=1;i<=15;i++) total += parseInt(params["u"+i]);
    	if (total > t.maxsend) {alert("Can't send out that amount of troops, wrong TR cards?");return;}
    	
          new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/march.php" + unsafeWindow.g_ajaxsuffix, {
                  method: "post",
                  parameters: params,
                  loading: true,
                  onSuccess: function (transport) {
	                  var rslt = eval("(" + transport.responseText + ")");
	                  if (rslt.ok) {
		                  var timediff = parseInt(rslt.eta) - parseInt(rslt.initTS);
		                  var ut = unixTime();
		                  var unitsarr=[0,0,0,0,0,0,0,0,0,0,0,0,0];
		                  for(i = 0; i <= unitsarr.length; i++){
		                      if(params["u"+i]){
		                      unitsarr[i] = params["u"+i];
		                      }
		                  }
		                  var resources=new Array();
		                  resources[0] = params.gold;
		                  for(i=1; i<=4; i++){
		                      resources[i] = params["r"+i];
		                  }
		                  var currentcityid = params.cid;
		                  unsafeWindow.attach_addoutgoingmarch(rslt.marchId, rslt.marchUnixTime, ut + timediff, params.xcoord, params.ycoord, unitsarr, params.type, params.kid, resources, rslt.tileId, rslt.tileType, rslt.tileLevel, currentcityid, true);
		                  if(rslt.updateSeed){unsafeWindow.update_seed(rslt.updateSeed)};
	                  } 
           
                  },
                  onFailure: function () {}
          });
               
    },
    
    
    show: function(){
        var t = Tabs.March;
        if (MarchOptions.Queue.length > 0) t.PaintQueue();
    },
    hide: function(){
        var t = Tabs.March;
    },
    onUnload: function(){
    },
}

/************************  Gift Tab ************************/
Tabs.Gift = {
  tabLabel: 'Gift',
  myDiv: null,
  amount:0,
  Gifts:{},

    init: function(div){
    	var t = Tabs.Gift;
        t.myDiv = div;
      	var msg = '<DIV id=pbReinfMain class=pbStat>GIFT TAB</div>';
      	msg += '<BR>Select the gift you want to receive (only works when people are running AIO!), your avatar will be used to determine the gift, so don\'t change it!!';
      	msg += '<BR>It will spread out gifting, so if your alliance has 100 members, everybody should get a gift every 4 days from the same member.';
      	msg += '<BR>FYI, it will send out gifts to people not running AIO...';
      	msg += '<BR><BR><INPUT type=checkbox id=GiftOption '+((Options.sendGift)?'checked':'unchecked')+'>&nbspAutomatically send gifts.'
      	msg+='<BR><DIV id=GiftInfo></div>';
      	t.myDiv.innerHTML = msg;
      	document.getElementById('GiftOption').addEventListener('click', function(){Options.sendGift=this.checked;saveOptions();}, false);
       	t.GetGifts();    
    },

    GetGifts: function(){
    	var t = Tabs.Gift;
    	var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    	params.ctrl = 'GiftItems';
    	params.action = 'getGiftItems';
    	 
    	new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
        	method: "post",
          	parameters: params,
          	onSuccess: function (rslt) {
            	if (rslt) {
            		var m ='';
            		for (var i=0;i<rslt.giftItems.length;i++) {
            			t.Gifts[i+1] = rslt.giftItems[i].itemId;
            			m += '<BR><input id="Gift_'+rslt.giftItems[i].itemId+'"" type="radio" name="GiftTypes" value="Cities">' + rslt.giftItems[i].name + ': ' + rslt.giftItems[i].description;
            		}
            		document.getElementById('GiftInfo').innerHTML = m;
            		for (var i=0;i<rslt.giftItems.length;i++)  document.getElementById('Gift_'+ rslt.giftItems[i].itemId).addEventListener('click', function(){t.changeAvatar(this.id);}, false);

            		if (unsafeWindow.seed.player.avatarId > 10) {
            			document.getElementById('Gift_' + t.Gifts[1]).checked = true;
            			t.changeAvatar('Gift_' + t.Gifts[1]);
            		} else document.getElementById('Gift_' + t.Gifts[unsafeWindow.seed.player.avatarId]).checked = true;

            	}
          	},
        });
    },

    changeAvatar: function(id){
    	var t = Tabs.Gift;
    	var avatar = 16;
    	id = id.substr(5);
    	for (i in t.Gifts) 	if (t.Gifts[i] == id) avatar = i;
    	var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    	params.aid = avatar;
    	 
    	new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/changeAvatar.php" + unsafeWindow.g_ajaxsuffix, {
        	method: "post",
          	parameters: params,
          	onSuccess: function (rslt) {
            	if (rslt.ok) {
            		unsafeWindow.seed.player.avatarId = params.aid;
           			var d = unsafeWindow.seed.player.avatarurl.lastIndexOf("/");
                    var c = unsafeWindow.seed.player.avatarurl.substr(d + 2);
                    var e = params.aid + ".png";
                    unsafeWindow.seed.player.avatarurl = unsafeWindow.seed.player.avatarurl.replace(c, e);
                    //var f;
                    //((unsafeWindow.seed.player.prefix == "Lord") ? f = "m" : f = "f");
                   	//unsafeWindow.jQuery("#hudAvatarPic").attr("class", "avatars_50 " + f + unsafeWindow.seed.player.avatarId);
            	}
          	},
        });
    },

    Check: function(){
    	var t = Tabs.Gift;
    	var now = unixTime();
    	if (!Options.sendGift) return;
    	if ((Options.lastGiftSend + (6*60*60)) > now) return;
    	var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		params.ctrl = 'allianceGifting\\AllianceGiftingServiceAjax';
		params.action = 'getRecipients';
		
	  	new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch53.php" + unsafeWindow.g_ajaxsuffix, {
			method: "post",
			parameters: params,
			loading: true,
			onSuccess: function (transport) {
				var rslt = eval("(" + transport.responseText + ")");
				if(rslt.ok) {
					t.amount = parseInt(rslt.freeSlot);
					if (t.amount > 0) t.MakeGiftList(rslt.recipients);
				}
			},
			onFailure: function () {},
		});
    },

    MakeGiftList: function(recipients){
    	var t = Tabs.Gift;
    	var helpArray = {};
    	var GiftList = new Array();
    	var AvatarList = {1:[],2:[],3:[],4:[],5:[],6:[],7:[],8:[],9:[],10:[]};
    	for (var i=0;i<recipients.length;i++) if (recipients[i].userId == 9666766 || recipients[i].userId == 9688786) helpArray[recipients[i].userId] = {avatar:recipients[i].avatarId,lastSend:0};
    	for (var i=0;i<recipients.length;i++) {
    		if (Options.GiftSendTo[recipients[i].userId] == undefined) Options.GiftSendTo[recipients[i].userId] = 1;
    		helpArray[recipients[i].userId] = {avatar:recipients[i].avatarId,lastSend:Options.GiftSendTo[recipients[i].userId]};
    	}
    	saveOptions();
    	for (var i in helpArray) GiftList.push({id:i,avatar:helpArray[i].avatar,lastSend:helpArray[i].lastSend});
    	GiftList = GiftList.sort(function sort(a,b) {a = a['lastSend'];b = b['lastSend'];return a == b ? 0 : (a < b ? -1 : 1);});
    	for (var i=0;i<t.amount;i++) {
    		var avatar = 1;
    		if (GiftList[i]) {
    			if (parseInt(GiftList[i].avatar) <= 10) avatar = parseInt(GiftList[i].avatar);
    			AvatarList[avatar].push(parseInt(GiftList[i].id));
    		}
    	}
		for (i=1;i<=10;i++) if (AvatarList[i].length > 0) setTimeout(t.SendGift,(i*5000),AvatarList[i],i);
    },

    SendGift: function(recipients,i){
    	var t = Tabs.Gift;
		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		params.ctrl = 'allianceGifting\\AllianceGiftingServiceAjax';
		params.action = 'sendGift';
		params.recipients = String(recipients).replace(/,/g,"|");
		params.itemId = t.Gifts[i];
		 
		new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch53.php" + unsafeWindow.g_ajaxsuffix, {
				method: "post",
				parameters: params,
				loading: true,
				onSuccess: function (transport) {
					var rslt = eval("(" + transport.responseText + ")");
					if (rslt.ok){
						var now = unixTime();
						Options.lastGiftSend = now;
						for (y in rslt.succeedRecipients) {
							Options.GiftSendTo[recipients[y].userId] = now;
							saveOptions();
						}
						actionLog('Send: ' + rslt.succeedRecipients.length + 'x ' + unsafeWindow.itemlist['i'+params.itemId].name);
					}
				},
				onFailure: function () {},
		});
	},

    show: function(){},
    hide: function(){},
}


/************************  AutoTrain Tab ************************/
Tabs.AutoTrain = {
  tabOrder: 120,
  tabLabel: 'Auto Train',
  myDiv: null,
  city:0,
  gamble : {"1":{"min":"5","max":"15","cost":"2"},"2":{"min":"10","max":"25","cost":"4"}},
  
  init: function(div){
    var t = Tabs.AutoTrain;
    t.myDiv = div;
    t.city = 0;
    t.nextcity();
    
    var m = '<DIV class=pbStat>AUTO TRAIN</div><TABLE width=100% height=0% class=pbTab><TR><TD width=200></td>';
        m += '<TD align=center><INPUT class="buttonDash_'+ (TrainOptions.Running?'ON':'OFF') +'" id=pbAutoTrainState type=submit value="'+translate("Train")+' = '+ (TrainOptions.Running?'ON':'OFF')+'"></td>';
        m += '<TD align=right><INPUT id=pbShowTrainHelp type=submit class=pbButton value='+translate("HELP")+'></td></tr></table>';
        m += '<table><tr><td align=left><INPUT id=pbatTR type=checkbox '+(TrainOptions.tr?'CHECKED':'')+'> Only train when throne room set <INPUT id=pbatTRset type=text size=2 maxlength=1 value="'+ TrainOptions.trset +'">  is equiped</td>';
        m += '</tr></table></div>';
        m += '<DIV class=pbStat>TRAIN OPTIONS</div><TABLE width=100% height=0% class=pbTab><TR align="center">';
    for (i=0;i<Seed.cities.length;i++){
		var citynum = Seed.cities[i][0];
        city = i+1;
          m += '<TABLE width=100% height=0% class=pbTab><TR align="left">';
          m+='<TR><TD width=30px><INPUT type=checkbox class='+city+' id="SelectCity'+city+'"></td>';
        m+='<TD><TABLE><TR>';
        m+='<TD><B>'+ Seed.cities[i][1] +'</b></td>';
        m+='<TD width=150px><SELECT class='+city+' id="TroopsCity'+city+'"><option value="Select">--Select--</options>';
            for (y in unsafeWindow.unitcost) {
                var faux = 0;
                var uc = unsafeWindow.unitcost[y];
				if (matTypeof(uc[8]) == 'object'){
					if(!Seed.cityData.city[citynum].isPrestigeCity) {
						for (k in uc[8]){
							var b = getCityBuilding (Seed.cities[i][0], k.substr(1));
							if (b.maxLevel < uc[8][k][1]){
								faux = 1;
								break;
							}
						}
					}else {
						if(uc[8]['b13']) {
							var b = getCityBuilding (Seed.cities[i][0], 13);
							if (b.maxLevel < uc[8]['b13'][1]){
								faux = 1;
							}
						}
					}	
				}
                if (matTypeof(uc[9]) == 'object'){
                    for (k in uc[9]){
                        if (parseInt(Seed.tech['tch'+k.substr(1)]) < uc[9][k][1]){
                            faux = 1;
                            break;
                        }
                    }
                }
                if(y == "unt13") faux = 1;
				if(y == "unt14") faux = 1;
				if(y == "unt15") faux = 1;
				
                if (faux==0)
                    m+='<option value="'+y.substr(3)+'">'+unsafeWindow.unitcost[y][0]+'</option>';
            }
        m+='</select></td>';
        m+='<TD width=100px>Min.: <INPUT class='+city+' id=treshold'+city+' type=text size=4 maxlength=6 value="'+ TrainOptions.Threshold[city]+'"\></td>';
        m+='<TD width=130px><INPUT type=checkbox class='+city+' id="SelectMax'+city+'"> '+translate("Max")+'.: <INPUT class='+city+' id=max'+city+' type=text size=5 maxlength=6 value="'+ TrainOptions.Max[city]+'"\></td>';
        m +='<TD>'+translate("Use Workers")+': ';
        m+='<SELECT class='+city+' id="workers'+city+'"><option value="0">0%</options>';
        m+='<option value="25">25%</options>';
        m+='<option value="50">50%</options>';
        m+='<option value="75">75%</options>';
        m+='<option value="100">100%</options></select>';
        m+='</td><td>';
        m += '<TD><SELECT class='+city+' id="TrainSpeedItem_'+city+'">\
        <option value=0><CENTER>--- '+unsafeWindow.g_js_strings.commonstr.items+' '+unsafeWindow.g_js_strings.commonstr.speedup+' ---</center></option>\
        <option value=36>'+unsafeWindow.itemlist.i36.name+'</option>\
        <option value=37>'+unsafeWindow.itemlist.i37.name+'</option>\
        <option value=38>'+unsafeWindow.itemlist.i38.name+'</option></select>';
        m+='</td></tr></table></td><tr>';
        m += '<TD></td><TD><TABLE><TR>';
        m += '<TD width=5%><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/food_30.png"></td>';
        m += '<TD><INPUT class='+city+' id="KeepFood'+city+'" type=text size=7 maxlength=7 value="'+ TrainOptions.Keep[city]['Food']+'"\></td>';
        m += '<TD width=20px><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/wood_30.png"></td>';
        m += '<TD><INPUT class='+city+' id="KeepWood'+city+'" type=text size=7 maxlength=7 value="'+ TrainOptions.Keep[city]['Wood']+'"\></td>';
        m += '<TD width=20px><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/stone_30.png"></td>';
        m += '<TD><INPUT class='+city+' id="KeepStone'+city+'" type=text size=7 maxlength=7 value="'+ TrainOptions.Keep[city]['Stone']+'"\></td>';
        m += '<TD width=20px><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/iron_30.png"></td>';
        m += '<TD><INPUT class='+city+' id="KeepOre'+city+'" type=text size=7 maxlength=7 value="'+ TrainOptions.Keep[city]['Ore']+'"\></td>';
        m += '<TD><SELECT class='+city+' id="Resource'+city+'"><option value="true">'+translate("Keep")+'</options>';
        m+='<option value="false">'+translate("Use")+'</option>';
        m+='</select></td>';
          
        m += '<TD><SELECT class='+city+' id="TrainSpeed_'+city+'">\
        <option value=0><CENTER>--- '+unsafeWindow.g_js_strings.commonstr.speedup+' ---</center></option>\
        <option value=1>'+ t.gamble[1].cost+'x res ('+ t.gamble[1].min+' - '+t.gamble[1].max+'%)</option>\
        <option value=2>'+ t.gamble[2].cost+'x res ('+ t.gamble[2].min+' - '+t.gamble[2].max+'%)</option></select>';
        m+='</td></tr></table>';       
        if(Seed.cityData.city[citynum].prestigeInfo.blessings) {
        if(Seed.cityData.city[citynum].prestigeInfo.blessings.indexOf(11) != -1) {
			m += '<tr><td></td><td align=left><INPUT class='+city+' id=AsEnabled'+city+' type=checkbox '+(TrainOptions.AsEnabled[city]?'CHECKED':'')+'> Auto train '+unsafeWindow.unitcost['unt13'][0]+' '+translate("Min")+'.: <INPUT class='+city+' id=AsTroops'+city+' type=text size=4 maxlength=6 value="'+TrainOptions.AsTroops[city]+'"><INPUT type=checkbox class='+city+' id="AsSelectMax'+city+'"> '+translate("Max")+'.: <INPUT class='+city+' id=Asmax'+city+' type=text size=5 maxlength=6 value="'+ TrainOptions.AsMax[city]+'"\></td>';
		};
		if(Seed.cityData.city[citynum].prestigeInfo.blessings.indexOf(21) != -1) {
			m += '<tr><td></td><td align=left><INPUT class='+city+' id=AsEnabled'+city+' type=checkbox '+(TrainOptions.AsEnabled[city]?'CHECKED':'')+'> Auto train '+unsafeWindow.unitcost['unt14'][0]+' '+translate("Min")+'.: <INPUT class='+city+' id=AsTroops'+city+' type=text size=4 maxlength=6 value="'+TrainOptions.AsTroops[city]+'"><INPUT type=checkbox class='+city+' id="AsSelectMax'+city+'"> '+translate("Max")+'.: <INPUT class='+city+' id=Asmax'+city+' type=text size=5 maxlength=6 value="'+ TrainOptions.AsMax[city]+'"\></td>';
		};
		if(Seed.cityData.city[citynum].prestigeInfo.blessings.indexOf(31) != -1) {
			m += '<tr><td></td><td align=left><INPUT class='+city+' id=AsEnabled'+city+' type=checkbox '+(TrainOptions.AsEnabled[city]?'CHECKED':'')+'> Auto train '+unsafeWindow.unitcost['unt15'][0]+' '+translate("Min")+'.: <INPUT class='+city+' id=AsTroops'+city+' type=text size=4 maxlength=6 value="'+TrainOptions.AsTroops[city]+'"><INPUT type=checkbox class='+city+' id="AsSelectMax'+city+'"> '+translate("Max")+'.: <INPUT class='+city+' id=Asmax'+city+' type=text size=5 maxlength=6 value="'+ TrainOptions.AsMax[city]+'"\></td>';
		};
	}; 
        m+='</td></tr></table>';
    }
      
        t.myDiv.innerHTML = m;
      
    for (i=0;i<Seed.cities.length;i++){
        city = i+1;
        document.getElementById('TroopsCity'+city).value = TrainOptions.Troops[city];
        document.getElementById('SelectCity'+city).checked = TrainOptions.Enabled[city];
        document.getElementById('Resource'+city).value = TrainOptions.Resource[city];
        document.getElementById('SelectMax'+city).checked = TrainOptions.SelectMax[city];
        document.getElementById('workers'+city).value = TrainOptions.Workers[city];
        document.getElementById('TrainSpeed_'+city).value = TrainOptions.Gamble[city];
        document.getElementById('TrainSpeedItem_'+city).value = TrainOptions.Item[city];
        if (!TrainOptions.SelectMax[city]) document.getElementById('max'+city).disabled=true;
        if(document.getElementById('AsEnabled'+city)) {
			document.getElementById('AsEnabled'+city).checked = TrainOptions.AsEnabled[city];
			document.getElementById('AsTroops'+city).value = TrainOptions.AsTroops[city];
			document.getElementById('AsSelectMax'+city).checked = TrainOptions.AsSelectMax[city];
			if (!TrainOptions.AsSelectMax[city]) document.getElementById('Asmax'+city).disabled=true;
		};
    }
       
    document.getElementById('pbShowTrainHelp').addEventListener('click', function(){
        t.helpPop(this);
    }, false);
       
    document.getElementById('pbAutoTrainState').addEventListener('click', function(){
        t.toggleAutoTrainState(this);
    }, false);

    document.getElementById('pbatTR').addEventListener ('change', function() {
        TrainOptions.tr = this.checked;
        saveTrainOptions();
        }, false);
    document.getElementById('pbatTRset').addEventListener ('change', function() {
        TrainOptions.trset = this.value;
        saveTrainOptions();
        }, false);

    for(var k=1; k<=Seed.cities.length; k++){
         document.getElementById('treshold'+k).addEventListener('change', function(e){
             if (isNaN(e.target.value)) e.target.value=0 ;
            TrainOptions.Threshold[e.target['className']] = e.target.value;
             saveTrainOptions();
         }, false);
         document.getElementById('SelectMax'+k).addEventListener('change', function(e){
             TrainOptions.SelectMax[e.target['className']] = e.target.checked;
             if (!TrainOptions.SelectMax[e.target['className']]){
                document.getElementById('max'+e.target['className']).value = 0;
                document.getElementById('max'+e.target['className']).disabled=true;
            } else {
                document.getElementById('max'+e.target['className']).disabled=false;
            }
            saveTrainOptions();
         }, false);
         document.getElementById('max'+k).addEventListener('change', function(e){
              TrainOptions.Max[e.target['className']] = e.target.value;
              saveTrainOptions();
          }, false);
         document.getElementById('workers'+k).addEventListener('change', function(e){
              TrainOptions.Workers[e.target['className']] = e.target.value;
              t.AF_TU_Change(e.target['className'],document.getElementById('TroopsCity'+e.target['className']).value);
              TrainOptions.Max[e.target['className']] = document.getElementById('max'+e.target['className']).value;
              saveTrainOptions();
          }, false);
         document.getElementById('Resource'+k).addEventListener('change', function(e){
            TrainOptions.Resource[e.target['className']] = e.target.value;
             saveTrainOptions();
        }, false);
         document.getElementById('TrainSpeed_'+k).addEventListener('change', function(e){
            TrainOptions.Gamble[e.target['className']] = e.target.value;
             saveTrainOptions();
        }, false);
         document.getElementById('TrainSpeedItem_'+k).addEventListener('change', function(e){
            TrainOptions.Item[e.target['className']] = e.target.value;
             saveTrainOptions();
        }, false);
        document.getElementById('SelectCity'+k).addEventListener('change', function(e){
            TrainOptions.Enabled[e.target['className']] = e.target.checked;
            saveTrainOptions();
          }, false);
          document.getElementById('TroopsCity'+k).addEventListener('change', function(e){
            t.AF_TU_Change(e.target['className'],e.target.value);
            TrainOptions.Troops[e.target['className']] = e.target.value;
              TrainOptions.Max[e.target['className']] = document.getElementById('max'+e.target['className']).value;
            saveTrainOptions();
          }, false);
          document.getElementById('KeepFood'+k).addEventListener('change', function(e){
            if (isNaN(e.target.value)) e.target.value=0 ;
            TrainOptions.Keep[e.target['className']]['Food'] = e.target.value;
            saveTrainOptions();
          }, false);
          document.getElementById('KeepWood'+k).addEventListener('change', function(e){
              if (isNaN(e.target.value)) e.target.value=0 ;
            TrainOptions.Keep[e.target['className']]['Wood'] = e.target.value;
            saveTrainOptions();
          }, false);
          document.getElementById('KeepStone'+k).addEventListener('change', function(e){
            if (isNaN(e.target.value)) e.target.value=0 ;
            TrainOptions.Keep[e.target['className']]['Stone'] = e.target.value;
            saveTrainOptions();
          }, false);
          document.getElementById('KeepOre'+k).addEventListener('change', function(e){
              if (isNaN(e.target.value)) e.target.value=0 ;
            TrainOptions.Keep[e.target['className']]['Ore'] = e.target.value;
            saveTrainOptions();
          }, false);
           if(document.getElementById('AsEnabled'+k)) {  
        document.getElementById('AsEnabled'+k).addEventListener('change', function(e){
            TrainOptions.AsEnabled[e.target['className']] = e.target.checked;
            saveTrainOptions();
          }, false);
         document.getElementById('AsTroops'+k).addEventListener('change', function(e){
             if (isNaN(e.target.value)) e.target.value=0 ;
            TrainOptions.AsTroops[e.target['className']] = e.target.value;
             saveTrainOptions();
         }, false);
                 document.getElementById('Asmax'+k).addEventListener('change', function(e){
              TrainOptions.AsMax[e.target['className']] = e.target.value;
              saveTrainOptions();
          }, false);
            document.getElementById('AsSelectMax'+k).addEventListener('change', function(e){
             TrainOptions.AsSelectMax[e.target['className']] = e.target.checked;
             if (!TrainOptions.AsSelectMax[e.target['className']]){
                document.getElementById('Asmax'+e.target['className']).value = 0;
                document.getElementById('Asmax'+e.target['className']).disabled=true;
            } else {
                document.getElementById('Asmax'+e.target['className']).disabled=false;
            }
            saveTrainOptions();
         }, false);
		};
               
          
          
          
    }
  },
  
  
  helpPop : function (){
    var helpText = '<BR><DL><dt>Autotrain:<dd><LI>Toggle the box in front of the row to enable autotrain for that city (the number is the citynumer).</dd>\
        <dd><LI>Select a trooptype per city in the dropdown boxes.</dd>\
        <dd><LI>Fill in the minimum troops that triggers the autotrain (less then this will not be trained).</dd>\
        <dt>Fill in resources:</dt>\
          <dd><LI>Keep: Autotrain will keep this amount available in the city.</dd>\
          <dd><LI>Use: Autotrain will only use the resources to train troops.</dd>\
        <dt>Turn it on: </dt>\
          <dd><LI>Hit the AutoTrain toggle button.</dd></ul>';
    var pop = new pbPopup ('giftHelp', 0, 0, 550, 230, true);
    pop.centerMe (mainPop.getMainDiv());  
    pop.getMainDiv().innerHTML = helpText;
    pop.getTopDiv().innerHTML = '<CENTER><B>AIO Script '+translate("Help")+'</b>:  '+translate("Auto Train")+'</center>';
    pop.show (true);
  },
  
  toggleAutoTrainState: function(obj){
    var t = Tabs.AutoTrain;
     if (TrainOptions.Running == true) {
            TrainOptions.Running = false;
            if (document.getElementById('pbAutoTrainState')) {document.getElementById('pbAutoTrainState').value = "Train = OFF";document.getElementById('pbAutoTrainState').setAttribute("class", "buttonDash_OFF");}
        	if (document.getElementById('AutotrainToggle')) {document.getElementById('AutotrainToggle').value = "Train = OFF";document.getElementById('AutotrainToggle').setAttribute("class", "buttonDash_OFF");}
        }
        else {
            TrainOptions.Running = true;
            if (document.getElementById('pbAutoTrainState')) {document.getElementById('pbAutoTrainState').value = "Train = ON";document.getElementById('pbAutoTrainState').setAttribute("class", "buttonDash_ON");}
        	if (document.getElementById('AutotrainToggle')) {document.getElementById('AutotrainToggle').value = "Train = ON";document.getElementById('AutotrainToggle').setAttribute("class", "buttonDash_ON");}
        	t.nextcity();
        }
    saveTrainOptions();
  },
    
  show: function(){
    var t = Tabs.AutoTrain;
  },
  hide: function(){
    var t = Tabs.AutoTrain;
  },
      AF_TU_Change: function(numcity,unit) {
        var t = Tabs.AutoTrain;
        var cityId = Cities.cities[numcity-1].id
        var coutenpop= unsafeWindow.unitcost['unt'+unit][6];
        var X = Seed.citystats['city'+cityId].pop[1];//max pop
        var Y = unsafeWindow.seed.citystats["city"+cityId].pop[3];//workers
        var Q= coutenpop;
        var Z = document.getElementById('workers'+numcity).value/100;
        if (Z == 0)
        document.getElementById("max"+numcity).value=parseIntNan((X-Y)/Q);
        else if (Z == 1)
        document.getElementById("max"+numcity).value=parseIntNan(X/Q);
        else
        document.getElementById("max"+numcity).value = parseIntNan((X-(Y*Z))/Q);
    },
  checkidlepopulation : function(cityId){
    var t = Tabs.AutoTrain;
    if(TrainOptions.Workers[t.city] == 0)
        t.idle = parseInt(Seed.citystats['city'+cityId].pop[0]) - parseInt(Seed.citystats['city'+cityId].pop[3]);
    else
        t.idle = ((TrainOptions.Workers[t.city]/100)*parseInt(Seed.citystats['city'+cityId].pop[0])).toFixed(0);
    return t.idle>0?true:false;
  },
  checktrainslots : function(cityId,prest){
     var t = Tabs.AutoTrain;
     if(!prest) {
        t.barracks = getCityBuilding(cityId, 13).count;
        t.slots = 0;
        for (k in Seed.queue_unt['city'+cityId])
           if(Seed.queue_unt['city'+cityId][k][7] == false)
              t.slots += 1;
        t.empty = parseInt(t.barracks - t.slots);
        return t.empty>0?true:false;
     } else {
        t.barracks = Number(getCityBuilding(cityId, 22).count + getCityBuilding(cityId, 24).count + getCityBuilding(cityId, 26).count);//24 fey barracks, 22 druid barracks 26 briton barracks
        t.slots = 0;
        for (k in Seed.queue_unt['city'+cityId])
           if(Seed.queue_unt['city'+cityId][k][7] == true)
              t.slots += 1;
        t.empty = parseInt(t.barracks - t.slots);
        return t.empty>0?true:false;
     }
  },
  checkresources : function(cityId){
    var t = Tabs.AutoTrain;
    t.food = parseInt((Seed.resources['city'+cityId].rec1[0]/3600) - TrainOptions['Keep'][t.city]['Food']);
    t.wood = parseInt((Seed.resources['city'+cityId].rec2[0]/3600) - TrainOptions['Keep'][t.city]['Wood']);
    t.stone = parseInt((Seed.resources['city'+cityId].rec3[0]/3600) - TrainOptions['Keep'][t.city]['Stone']);
    t.ore = parseInt((Seed.resources['city'+cityId].rec4[0]/3600) - TrainOptions['Keep'][t.city]['Ore']);
    if(t.food>0 && t.wood>0 && t.stone>0 && t.ore>0){
        return true;
    }
    return false;
  },
  trainamt : function(cityId, unitId){
    var t = Tabs.AutoTrain;
    if(!unitId || unitId<1) return false;
    var cost = unsafeWindow.Object.clone(unsafeWindow.unitcost['unt'+ unitId]);
    var gamble = (parseInt(TrainOptions.Gamble[t.city])>0)?t.gamble[TrainOptions.Gamble[t.city]].cost:1;
    t.amt = Math.floor(t.idle/cost[6]);
    for(var rs=1; rs<5; rs++)
        cost[rs] *= gamble;
    if ((t.food/cost[1]) < t.amt) t.amt = Math.floor(t.food/cost[1]);
    if ((t.wood/cost[2]) < t.amt) t.amt = Math.floor(t.wood/cost[2]);
    if ((t.stone/cost[3]) < t.amt) t.amt = Math.floor(t.stone/cost[3]);
    if ((t.ore/cost[4]) < t.amt) t.amt = Math.floor(t.ore/cost[4]);
    if (unitId < 13) {
    if(TrainOptions.SelectMax[t.city]){
        if(parseInt(t.amt) > parseInt(TrainOptions.Max[t.city])) t.amt = TrainOptions.Max[t.city];
    }
    if(parseInt(t.amt) < parseInt(TrainOptions.Threshold[t.city])) t.amt = 0;
	} else {
		if(TrainOptions.AsSelectMax[t.city])
        if(parseInt(t.amt) > parseInt(TrainOptions.AsMax[t.city])) t.amt = TrainOptions.AsMax[t.city];
		
		if(parseInt(t.amt) < parseInt(TrainOptions.AsTroops[t.city])) t.amt = 0;
	}
    
    return t.amt>0?true:false;
  },
  
  nextcity : function(){
    var t = Tabs.AutoTrain;
    if (!TrainOptions.Running) return;
    if (TrainOptions.tr && TrainOptions.trset != 0) {
        if (Seed.throne.activeSlot != TrainOptions.trset) {
	        setTimeout(t.nextcity, 60000);
            return;
            };
        };
     t.city++;
   if(t.city > Seed.cities.length) t.city = 1;
    var cityId = Seed.cities[t.city-1][0];
    var idle = t.checkidlepopulation(cityId);
    var resources = t.checkresources(cityId);
	if(Seed.cityData.city[cityId].isPrestigeCity) {
		var ptrainslots = t.checktrainslots(cityId,true);
		var punit = false;
		if(getCityBuilding(cityId, 22).count)
			punit = 13;
		if(getCityBuilding(cityId, 24).count)
			punit = 14;
		if(getCityBuilding(cityId, 26).count)
			punit = 15;
		if(punit)	
			var ptrain = t.trainamt(cityId, punit);
		if(TrainOptions.AsEnabled[t.city] && idle && ptrainslots && resources && ptrain) {
				t.doTrain(cityId, punit, t.amt, t.nextcity, TrainOptions.Item[t.city]);
				t.city--;
				return;
		};
	};
    var trainslots = t.checktrainslots(cityId);
    var train = t.trainamt(cityId, TrainOptions['Troops'][t.city]);
    

    if(!TrainOptions.Enabled[t.city] || TrainOptions['Troops'][t.city]==0 || !idle || !trainslots || !resources || !train){
        setTimeout(t.nextcity, 5000);
        return;
    }
    t.doTrain(cityId, TrainOptions['Troops'][t.city], t.amt, t.nextcity, TrainOptions.Item[t.city]);
  },
  doTrain : function (cityId, unitId, num, notify, tut){
    var t = Tabs.AutoTrain;
    var time = unsafeWindow.modal_barracks_traintime(unitId, num);
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.cid = cityId;
    params.type = unitId;
    params.quant = num;
    if(parseIntNan(tut) > 0)
        params.items = tut;
    if(parseInt(TrainOptions.Gamble[t.city]) > 0)
        params.gambleId = TrainOptions.Gamble[t.city];
	if(params.type < 13)
		var inPrestige = false;
	else var inPrestige = true;
    var profiler = new unsafeWindow.cm.Profiler("ResponseTime", "train.php");
     
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/train.php" + unsafeWindow.g_ajaxsuffix, {
        method: "post",
        parameters: params,
        onSuccess: function(rslt) {
      if (rslt.updateSeed)
        unsafeWindow.update_seed(rslt.updateSeed);
            profiler.stop();
          if (rslt.ok) {

            for (var i = 1; i < 5; i++) {
                var resourceLost = parseInt(unsafeWindow.unitcost["unt" + unitId][i]) * 3600 * parseInt(num);
                if(rslt.gamble) resourceLost = resourceLost*rslt.gamble[i];
                unsafeWindow.seed.resources["city" + cityId]["rec" + i][0] = parseInt(unsafeWindow.seed.resources["city" + cityId]["rec" + i][0]) - resourceLost;
            }
            unsafeWindow.seed.citystats["city" + cityId].gold[0] = parseInt(unsafeWindow.seed.citystats["city" + cityId].gold[0]) - parseInt(unsafeWindow.unitcost["unt" + unitId][5]) * parseInt(num);
            unsafeWindow.seed.citystats["city" + cityId].pop[0] = parseInt(unsafeWindow.seed.citystats["city" + cityId].pop[0]) - parseInt(unsafeWindow.unitcost["unt" + unitId][6]) * parseInt(num);
            unsafeWindow.seed.queue_unt["city" + cityId].push([unitId, num, rslt.initTS, parseInt(rslt.initTS) + time, 0, time, null,inPrestige]);
            setTimeout (notify, 10000);
            for (postcity in Seed.cities) if (Seed.cities[postcity][0] == params.cid) logcity = Seed.cities[postcity][1];
            actionLog(logcity  + ' Train ' + num + ':  ' + troops[unitId] );
          } else {
            setTimeout (notify, 10000);
          }
        },
      onFailure: function () {profiler.stop();}
    });
  },
}

/************************ Gold Collector ************************/
var CollectGold = {
  timer : null,
  lastCollect : {},
      
  init : function (){
    var t = CollectGold;
    for (var c=0; c<Cities.numCities; c++)
      t.lastCollect['c'+ Cities.cities[c].id] = 0;
    if (Options.pbGoldEnable)
      t.setEnable (true);
  },
  
  setEnable : function (tf){
    var t = CollectGold;
    clearTimeout (t.timer);
    if (tf)
      t.tick();
  },

  colCityName : null,
  colHappy : 0,  
  tick : function (){
    var t = CollectGold;
    for (var c=0; c<Cities.numCities; c++){
      var city = Cities.cities[c];
      var happy = Seed.citystats['city'+ city.id].pop[2];
      var since = unixTime() - t.lastCollect['c'+city.id];
      if (happy>=Options.pbGoldHappy && since>15*60){
        t.lastCollect['c'+city.id] = unixTime();
        t.colCityName = city.name;
        t.colHappy = happy;
        t.ajaxCollectGold (city, t.e_ajaxDone);
        break;
      }
    }
    t.timer = setTimeout (t.tick, 15000);    
  },

  e_ajaxDone : function (rslt){
    var t = CollectGold;
    if (rslt.ok)
      actionLog ('Collected '+ rslt.goldGained +' gold for '+ t.colCityName +' (happiness was '+ t.colHappy +')');
    else
      actionLog ('Error collecting gold for '+ t.colCityName +': <SPAN class=boldRed>'+ rslt.errorMsg +'</span>');
  },
  
  ajaxCollectGold : function (city, notify){
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.cid = city.id;
     
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/levyGold.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        if (notify)  
          notify (rslt);
      },
      onFailure: function (rslt) {
        if (notify)  
          notify (rslt);
      }
    });
  },
}



/************************ Gold Collector ************************/
var CollectGold = {
  timer : null,
  lastCollect : {},
      
  init : function (){
    var t = CollectGold;
    for (var c=0; c<Cities.numCities; c++)
      t.lastCollect['c'+ Cities.cities[c].id] = 0;
    if (Options.pbGoldEnable)
      t.setEnable (true);
  },
  
  setEnable : function (tf){
    var t = CollectGold;
    clearTimeout (t.timer);
    if (tf)
      t.tick();
  },

  colCityName : null,
  colHappy : 0,  
  tick : function (){
    var t = CollectGold;
    for (var c=0; c<Cities.numCities; c++){
      var city = Cities.cities[c];
      var happy = Seed.citystats['city'+ city.id].pop[2];
      var since = unixTime() - t.lastCollect['c'+city.id];
      if (happy>=Options.pbGoldHappy && since>15*60){
        t.lastCollect['c'+city.id] = unixTime();
        t.colCityName = city.name;
        t.colHappy = happy;
        t.ajaxCollectGold (city, t.e_ajaxDone);
        break;
      }
    }
    t.timer = setTimeout (t.tick, 15000);    
  },

  e_ajaxDone : function (rslt){
    var t = CollectGold;
    if (rslt.ok)
      actionLog ('Collected '+ rslt.goldGained +' gold for '+ t.colCityName +' (happiness was '+ t.colHappy +')');
    else
      actionLog ('Error collecting gold for '+ t.colCityName +': <SPAN class=boldRed>'+ rslt.errorMsg +'</span>');
  },
  
  ajaxCollectGold : function (city, notify){
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.cid = city.id;
    
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/levyGold.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        if (notify) notify (rslt);
      },
      onFailure: function (rslt) {
        if (notify) notify (rslt);
      }
    });
  },
}

/************************ Refresh Every X minutes ************************/
var RefreshEvery  = {
  timer : null,
  PaintTimer : null,
  NextRefresh : 0,
  box : null,
  target : null,
  
  init : function (){
    var t = RefreshEvery;
    t.creatediv();
    if (Options.pbEveryMins < 1) Options.pbEveryMins = 1;
    RefreshEvery.setEnable (Options.pbEveryEnable);
  },
  
  creatediv : function(){
    var t = RefreshEvery;
    t.target = document.getElementById('comm_tabs');
    if(t.target == null){
        setTimeout(t.creatediv, 2000);
        return;
    }
    t.box = document.createElement('div');
    t.target.appendChild(t.box);
  },
  
  setEnable : function (tf){
    var t = RefreshEvery;
    clearTimeout (t.timer);
    if (tf) {
      //t.timer = setTimeout (t.doit, Options.pbEveryMins*60000);
      t.NextRefresh = unixTime() + (Options.pbEveryMins*60);
      t.timer = setTimeout (t.Paint, 1000);
    } else {
        //t.PaintTimer = null;
        t.timer = null;
        t.NextRefresh = 0;
        t.box.innerHTML = '<BR><FONT color=white><B>&nbsp;&nbsp;&nbsp;&nbsp;'+ getMyAlliance()[1] + ' (' + getServerId() +')</b></font>';
    }
  },
  
  doit : function (){
    actionLog ('Refreshing ('+ Options.pbEveryMins +' minutes expired)');
    saveOptions();
    reloadKOC();
  },
  
  setTimer : function (){
    var t = RefreshEvery;
    clearTimeout (t.timer);
    if (Options.pbEveryMins < 1) Options.pbEveryMins = 1;
    RefreshEvery.setEnable (Options.pbEveryEnable);
  },
  
  Paint : function(){
     var t = RefreshEvery;
     if(t.timer == null) return;
     now = unixTime();
     var text = '';
     var Left = parseInt(t.NextRefresh - now);
     var Mouse = unixTime() - Options.MouseMove;
     logit(Mouse);
     if ( Left < 0){
        Left = 0;
        if (Mouse > 500) t.doit();
     }
     if (Left > 60) text = '<BR>&nbsp;&nbsp;&nbsp;&nbsp;<FONT color=white>Next refresh in: <B>'+ timestr(Left) +'</b></font></div>';
     if (Left < 60) text = '<BR>&nbsp;&nbsp;&nbsp;&nbsp;<FONT color=white>Next refresh in: </font><FONT color=red><B>'+ timestr(Left) +'</b></font></div>';
     if (Left==0) text = '<BR>&nbsp;&nbsp;&nbsp;&nbsp;<FONT color=white>Waiting for AFK (5min.)</font></div>';    
     t.box.innerHTML = text;
     t.timer = setTimeout (t.Paint, 1000);
  },
}

/************************ Fairie Killer ************************/
var FairieKiller  = {
  saveFunc : null,
  init : function (tf){
    if (firefoxVersion.substring(0,4) == '4.0b')  // bug in firefox 4.0b10 causes syntax error with: "var func = eval ('function (){}');"
      return;
    FairieKiller.saveFunc = unsafeWindow.Modal.showModalUEP;
    FairieKiller.setEnable (tf);
  },
  setEnable : function (tf){
    if (tf)
      unsafeWindow.Modal.showModalUEP = eval ('function FairieKiller (a,b,c) {actionLog ("Blocked Faire popup");}');
    else
      unsafeWindow.Modal.showModalUEP = FairieKiller.saveFunc;
  },
}

/********** facebook watchdog: runs only in 'http://apps.facebook.com/kingdomsofcamelot/*' instance!  ******/
function facebookWatchdog (){
  var INTERVAL = 50000; // wait 50 seconds minute before checking DOM
  if (!GlobalOptions.pbWatchdog)
    return;
  setTimeout (watchdog, INTERVAL);
  
// TODO: actionLog ?  
  function watchdog (){
    try {
//      if (document.getElementById('app_content_130402594779').firstChild.firstChild.childNodes[1].firstChild.tagName!='IFRAME'){
      if (document.getElementById('app_content_130402594779') == null){
        logit ("KOC NOT FOUND!");
        KOCnotFound(5*60);
      }
    } catch (e){
      logit ("KOC NOT FOUND!");
      KOCnotFound(4*60);
    }
  }
}


function kocWatchdog (){
  var INTERVAL = 10000; // wait 30 seconds before checking DOM
  if (!GlobalOptions.pbWatchdog)
    return;
  setTimeout (watchdog, INTERVAL);
  function watchdog (){
logit ("KOC WATCHDOG: "+ document.getElementById('mod_maparea'));    
    if (document.getElementById('mod_maparea')==null){
      logit ("KOC not loaded");
      KOCnotFound(20);
    }     
  }
}


function KOCnotFound(secs){
  var div;
  var countdownTimer = null;
  var endSecs = (new Date().getTime()/1000) + secs;
    
  div = document.createElement('div');
  div.innerHTML = '<DIV style="font-size:18px; background-color:#a00; color:#fff"><CENTER><BR>'+translate("KOC AIO Script has detected that KOC is not loaded")+'<BR>'+translate("Refreshing in")+' <SPAN id=pbwdsecs></span><BR><INPUT id=pbwdcan type=submit class=pbButton value="'+translate("Cancel Refresh")+'"><BR><BR></div>';
  document.body.insertBefore (div, document.body.firstChild);
  document.getElementById('pbwdcan').addEventListener('click', cancel, false);
  countdown();
      
  function countdown (){
    var secsLeft = endSecs - (new Date().getTime()/1000);
    document.getElementById('pbwdsecs').innerHTML = timestr(secsLeft);
    if (secsLeft < 0) reloadKOC();
    countdownTimer = setTimeout (countdown, 1000);
  }
  function cancel (){
    clearTimeout (countdownTimer);
    document.body.removeChild (div);
  }
}

function searchDOM (node, condition, maxLevel, doMult){
    var found = [];
    eval ('var compFunc = function (node) { return ('+ condition +') }');
    doOne(node, 1);
    if(!doMult){
      if (found.length==0)
        return null;
      return found[0];
    }
    return found;
    function doOne (node, curLevel){
      try {
        if (compFunc(node))
          found.push(node);
      } catch (e){
      }      
      if (!doMult && found.length>0)
        return;
      if (++curLevel<maxLevel && node.childNodes!=undefined)
        for (var c=0; c<node.childNodes.length; c++)
          doOne (node.childNodes[c], curLevel);
    }
  }


var WideScreen = {
  chatIsRight : false,
  useWideMap : false,
  rail : null,
  
  init : function (){
    t = WideScreen;
    if (GlobalOptions.pbWideScreen){
      t.rail = searchDOM (document.getElementById('mod_maparea'), 'node.className=="maparea_rrail"', 10);
      GM_addStyle ('.modalCurtain {width:760px !important} .mod_comm_mmb{z-index:0 !important}');  
      try {
        document.getElementById('progressBar').parentNode.removeChild(document.getElementById('progressBar'));
        document.getElementById('crossPromoBarContainer').parentNode.removeChild(document.getElementById('crossPromoBarContainer'));
      } catch (e) {
      }
    }
  },
        
  setChatOnRight : function (tf){
    t = WideScreen;
    if (tf == t.chatIsRight || !GlobalOptions.pbWideScreen)
      return;
    if (tf){
      var chat = document.getElementById('kocmain_bottom').childNodes[1];
      if (!chat || chat.className!='mod_comm')
        setTimeout (function (){t.setChatOnRight(tf)}, 1000);
      chat.style.top = '-624px';
      chat.style.left = '760px';
      chat.style.height = '720px';
      chat.style.background = 'url("'+ CHAT_BG_IMAGE +'")';
      document.getElementById('mod_comm_list1').style.height = '580px';
      document.getElementById('mod_comm_list2').style.height = '580px';

    } else {
      var chat = document.getElementById('kocmain_bottom').childNodes[1];
      chat.style.top = '0px';
      chat.style.left = '0px';
      chat.style.height = '';
      chat.style.background = '';
      document.getElementById('mod_comm_list1').style.height = '287px';
      document.getElementById('mod_comm_list2').style.height = '287px';
    }
    t.chatIsRight = tf;
  },
  
  useWideMap : function (tf) {
      t = WideScreen;
      if (tf == t.useWideMap || !GlobalOptions.pbWideScreen)
          return;
      if (tf){
      t.rail.style.display = 'none';
      document.getElementById('mapwindow').style.height = "436px";
      document.getElementById('mapwindow').style.width = "1220px";
      document.getElementById('mapwindow').style.zIndex = "50";
      } else {
      t.rail.style.display = 'block';
      document.getElementById('mapwindow').style.height = "439px";
      document.getElementById('mapwindow').style.width = "760px";
      document.getElementById('mapwindow').style.zIndex = "";
      }
  },
}

/*******************   KOC Map interface ****************/
// 0:bog, 10:grassland, 11:lake, 20:woods, 30:hills, 40:mountain, 50:plain, 51:city / barb, 53:misted city
function CMapAjax (){
  this.normalize = normalize;  
  this.request = request;

  function request (left, top, width, notify){    
    var left = parseInt(left / 5) * 5;
    var top = parseInt(top / 5) * 5;
    var width = parseInt((width+4) / 5) * 5;
    
    var blockString = generateBlockList(left, top, width);
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.blocks = blockString;
    
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/fetchMapTiles.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        if (rslt.ok) notify(left, top, width, rslt);
        	else actionlog('-------MAP SEARCH ERROR-------')
      },
      onFailure: function (rslt) {
        notify(left, top, width, rslt);
      }
    });
    function generateBlockList (left, top, width) {
      var width5 = parseInt(width / 5);
      var bl = [];
      for (x=0; x<width5; x++){
        var xx = left + (x*5);
        if (xx > 745)
          xx -= 750;
        for (y=0; y<width5; y++){
          var yy = top + (y*5);
          if (yy > 745)
            yy -= 750;
          bl.push ('bl_'+ xx +'_bt_'+ yy);
        }
      }
      return bl.join(",");
    }
  }
 
  function normalize  (x){
    if ( x >= 750)
      x -= 750;
    else if (x < 0)
      x += 750;
    return parseInt (x/5) * 5;
  }
}

var anticd = {
  isInited : false,
  KOCversion : '?',
  
  init: function (){
    if (this.isInited) return this.KOCversion;
    unsafeWindow.cm.cheatDetector.detect = eval ('function a (){}');
    var scripts = document.getElementsByTagName('script');
    for (var i=0; i<scripts.length; i++) if (scripts[i].src.indexOf('camelotmain') >=0) break;   
    if (i<scripts.length){
      var m = scripts[i].src.match (/camelotmain-(.*).js/);  
      if (m) this.KOCversion = m[1];
    }
    this.isInited = true;
    // more coming soon :)
  },
  
  getKOCversion : function (){
    return this.KOCversion;
  },
}
try {
  anticd.init ();
} catch (e){
  logit ("ANTICD error: "+ e);
}

var tabManager = {
  tabList : {},           // {name, obj, div}
  currentTab : null,
  
  init : function (mainDiv){
    var t = tabManager;
    var sorter = [];
    for (k in Tabs){
      if (!Tabs[k].tabDisabled){ 
      	
        t.tabList[k] = {};
        t.tabList[k].name = k;

        t.tabList[k].type = Tabs[k].type;

        t.tabList[k].obj = Tabs[k];
        if (Tabs[k].tabLabel != null)
          t.tabList[k].label = Tabs[k].tabLabel;
        else
          t.tabList[k].label = k;
        if (Tabs[k].tabOrder != null)
          sorter.push([Tabs[k].tabOrder, t.tabList[k]]);
        else
          sorter.push([1000, t.tabList[k]]);
        t.tabList[k].div = document.createElement('div');
      }
    }

    sorter.sort (function (a,b){return a[0]-b[0]});
    var m = '<TABLE cellspacing=2 width=98% class=pbMainTab><TR>';
    for (var i=0; i<sorter.length; i++) {
      if (sorter[i][1].type == 'Tools') var cs = 'notSelTools';
       else var cs = 'notSel';	
      m += '<TD class=spacer></td><TD align=center class='+cs+' id=pbtc'+ sorter[i][1].name +' ><A><SPAN>'+ sorter[i][1].label +'</span></a></td>';
      if ((i+1)%10==0) m+='</tr><TR>';
    }
    m+='</tr></table>';  
    mainPop.getMainTopDiv().innerHTML = m;
    
    for (k in t.tabList) {
      if (t.tabList[k].name == Options.currentTab)
        t.currentTab =t.tabList[k] ;
      document.getElementById('pbtc'+ k).addEventListener('click', this.e_clickedTab, false);
      var div = t.tabList[k].div;
      div.style.display = 'none';
      div.style.height = '100%';
      mainDiv.appendChild(div);
      try {
        t.tabList[k].obj.init(div);
      } catch (e){
        div.innerHTML = "INIT ERROR: "+ e;
      }
    }
    
    if (t.currentTab == null) t.currentTab = sorter[0][1];    
    t.setTabStyle (document.getElementById ('pbtc'+ t.currentTab.name), true, t.currentTab.type);
    t.currentTab.div.style.display = 'block';
  },
  
  hideTab : function (){
    var t = tabManager;
    t.currentTab.obj.hide();
  },
  
  showTab : function (){
    var t = tabManager;
    t.currentTab.obj.show();
  },
    
  setTabStyle : function (e, selected,type){
    if (selected){
    	if (type == 'Tools') e.className = 'selTools';
      	 else e.className = 'sel';
    } else {
    	if (type == 'Tools') e.className = 'notSelTools';
      	 else e.className = 'notSel';
    }
  },
   
  e_clickedTab : function (e,id){
    var t = tabManager;
    if (id) var newTab = t.tabList[id];
     else var newTab = t.tabList[e.target.parentNode.parentNode.id.substring(4)];
    if (t.currentTab.name != newTab.name){
      t.setTabStyle (document.getElementById ('pbtc'+ t.currentTab.name), false, t.currentTab.type);
      t.setTabStyle (document.getElementById ('pbtc'+ newTab.name), true, newTab.type);
      t.currentTab.obj.hide ();
      t.currentTab.div.style.display = 'none';
      t.currentTab = newTab;
      newTab.div.style.display = 'block';
      Options.currentTab = newTab.name;      
    }
    newTab.obj.show();
  },
}

function onUnload (){
  Options.pbWinPos = mainPop.getLocation();
  if (!ResetAll) saveOptions();
}

function mouseMainTab (me){   // right-click on main button resets window location
  if (me.button == 2){
    var c = getClientCoords (document.getElementById('main_engagement_tabs'));
    mainPop.setLocation ({x: c.x+4, y: c.y+c.height});
  }
}

function eventHideShow (){
  if (mainPop.toggleHide(mainPop)){
    tabManager.showTab();
    Options.pbWinIsOpen = true;
  } else {
    tabManager.hideTab();
    Options.pbWinIsOpen = false;
  }
  saveOptions();
}

function hideMe (){
  mainPop.show (false);
  tabManager.hideTab();
  Options.pbWinIsOpen = false;
  saveOptions();
}

function showMe (){
  mainPop.show (true);
  tabManager.showTab();
  Options.pbWinIsOpen = true;
  saveOptions();
}

function addMyFunction (func){      // add function to run in our own scope
  unsafeWindow[func.name] = func;
}

function addunsafeWindowFunction (func){      // add function to run in unsafeWindow's scope
  var scr = document.createElement('script');
    scr.innerHTML = func.toString();
    document.body.appendChild(scr);
}

function alterunsafeWindowFunction (funcName, frArray){
  try {
    funcText = unsafeWindow[funcName].toString();
    rt = funcText.replace ('function '+funcName, 'function');
    for (i=0; i<frArray.length; i++){
      x = rt.replace(frArray[i][0], frArray[i][1]);
      if (x == rt)
        return false;
      rt = x;
    }
    js = funcName +' = '+ rt;
      var scr=document.createElement('script');
      scr.innerHTML=js;
      document.body.appendChild(scr);
      return true;
  } catch (err) {
    return false;
  }
}

function officerId2String (oid){
  if (oid==null)
    return '';
  else if (oid==3)
    return 'Officer';
  else if (oid==2)
    return 'Vice Chance';
  else if (oid==1)
    return 'Chancellor';
  return '';
}

var KnightRoles = [
  ['Foreman', 'politics', 'Pol'],
  ['Marshall', 'combat', 'Com'],
  ['Alchemystic', 'intelligence', 'Int'],
  ['Steward', 'resourcefulness', 'Res'],
];

function officerId2String (oid){
  if (oid==null)
    return '';
  else if (oid==3)
    return 'Officer';
  else if (oid==2)
    return 'Vice Chance';
  else if (oid==1)
    return 'Chancellor';
  return '';
}

var fortNamesShort = {
  53: "Crossbows",
  55: "Trebuchet",
  60: "Trap",
  61: "Caltrops",
  62: "Spiked Barrier",
}

// onClick (city{name, id, x, y}, x, y)   city may be null!
function CdispCityPicker (id, span, dispName, notify, selbut, disable_list){
  function CcityButHandler (t){
    var that = t;
    this.clickedCityBut = clickedCityBut;
    function clickedCityBut (e){
      if (that.selected != null)
        that.selected.className = "castleBut castleButNon";
      that.city = Cities.cities[e.target.id.substr(that.prefixLen)];
      if (that.dispName)
        document.getElementById(that.id+'cname').innerHTML = that.city.name;
      e.target.className = "castleBut castleButSel";
      that.selected = e.target;
      if (that.coordBoxX){
        that.coordBoxX.value = that.city.x;
        that.coordBoxY.value = that.city.y;
        var evt = document.createEvent("HTMLEvents");
        evt.initEvent('change', true, true ); // event type,bubbling,cancelable
        that.coordBoxX.dispatchEvent(evt);
        that.coordBoxY.dispatchEvent(evt);
        that.coordBoxX.style.backgroundColor = '#ffffff';
        that.coordBoxY.style.backgroundColor = '#ffffff';
      }
      if (that.notify != null)
        that.notify(that.city, that.city.x, that.city.y);
    }
  }

  function selectBut (idx){
    document.getElementById(this.id+'_'+idx).click();
  }

  function bindToXYboxes (eX, eY){
    function CboxHandler (t){
      var that = t;
      this.eventChange = eventChange;
      if (that.city){
        eX.value = that.city.x;
        eY.value = that.city.y;
      }
      function eventChange (){
        var xValue=that.coordBoxX.value.trim();
            var xI=/^\s*([0-9]+)[\s|,|-|.]+([0-9]+)/.exec(xValue);                 
            if(xI) {
                that.coordBoxX.value=xI[1]
                that.coordBoxY.value=xI[2]
            }
        var x = parseInt(that.coordBoxX.value, 10);
        var y = parseInt(that.coordBoxY.value, 10);
        if (isNaN(x) || x<0 || x>750){
          that.coordBoxX.style.backgroundColor = '#ff8888';
          return;
        }
        if (isNaN(y) || y<0 || y>750){
          that.coordBoxY.style.backgroundColor = '#ff8888';
          return;
        }
        that.coordBoxX.style.backgroundColor = '#ffffff';
        that.coordBoxY.style.backgroundColor = '#ffffff';
        if (that.notify != null)
          that.notify (null, x, y);
      }
      return false;
    }
    this.coordBoxX = eX;
    this.coordBoxY = eY;
    var bh = new CboxHandler(this);
    eX.maxLength=8;
    eY.maxLength=3;
    eX.style.width='2em';    
    eY.style.width='2em';    
    eX.addEventListener('change', bh.eventChange, false);
    eY.addEventListener('change', bh.eventChange, false);
  }

  this.selectBut = selectBut;
  this.bindToXYboxes = bindToXYboxes;
  this.coordBoxX = null;
  this.coordBoxY = null;
  this.id = id;
  this.dispName = dispName;
  this.prefixLen = id.length+1;
  this.notify = notify;
  this.selected = null;
  this.city = null;
  var m = '';
  for (var i=0; i<Cities.cities.length; i++){
    if(matTypeof(disable_list) == 'array'){
        if(disable_list[i])
            m += '<INPUT class="castleBut castleButNon" id="'+ id +'_'+ i +'" value="'+ (i+1) +'" type=submit DISABLED \>';
        else
            m += '<INPUT class="castleBut castleButNon" id="'+ id +'_'+ i +'" value="'+ (i+1) +'" type=submit \>';
    } else
        m += '<INPUT class="castleBut castleButNon" id="'+ id +'_'+ i +'" value="'+ (i+1) +'" type=submit \>';
  }
  if (dispName)
    m += ' &nbsp; <SPAN style="display:inline-block; width:85px; font-weight:bold;" id='+ id +'cname' +'></span>';
  span.innerHTML = m;
  var handler = new CcityButHandler(this);
  for (var i=0; i<Cities.cities.length; i++)
    document.getElementById (id+'_'+i).addEventListener('click', handler.clickedCityBut, false);
  if (selbut != null)
    this.selectBut(selbut);
};

function setCities(){
  Cities.numCities = Seed.cities.length;
  Cities.cities = [];
  Cities.byID = {};
  for (i=0; i<Cities.numCities; i++){
    city = {};
    city.idx = i;
    city.id = parseInt(Seed.cities[i][0]);
    city.name = Seed.cities[i][1];
    city.x = parseInt(Seed.cities[i][2]);
    city.y = parseInt(Seed.cities[i][3]);
    city.tileId = parseInt(Seed.cities[i][5]);
    city.provId = parseInt(Seed.cities[i][4]);
    getTroopDefTrainEstimates('city'+ city.id, city);
    Cities.cities[i] = city;
    Cities.byID[Seed.cities[i][0]] = city;
  }
}

function getTroopDefTrainEstimates (cityID, city){
    var b = Seed.buildings[cityID];
    city.numCottages = 0;
    city.numBarracks = 0;
    city.maxBarracks = 0;
    city.totLevelsBarracks = 0;
    city.blacksmithLevel = 0;
    city.stableLevel = 0;
    city.workshopLevel = 0;
    city.wallLevel = 0;
    city.feyLevel = 0;
    for (var j=1; j<33; j++){
        if (b['pos'+j]) {
            var bname = parseInt(b['pos'+j][0]);
            var blvl = parseInt(b['pos'+j][1]);
            switch(bname){
                case 13:
                    city.numBarracks++;
                    city.totLevelsBarracks += parseInt(blvl);
                    if (blvl>city.maxBarracks) city.maxBarracks=blvl;
                    break;
                case 5:
                    city.numCottages++;
                    break;
                case 15:
                    city.blacksmithLevel = blvl;
                    break;
                case 16:
                    city.workshopLevel = blvl;
                    break;
                case 17:
                    city.stableLevel = blvl;
                    break;
                case 19:
                    city.wallLevel = blvl;
                    break;
                case 20:
                    city.feyLevel = blvl;
                    break;
            }
        }
    }

    var now = unixTime();
    city.marshallCombatScore = 0;
    var s = Seed.knights[cityID];
    if (s) {
        s = s["knt" + Seed.leaders[cityID].combatKnightId];
        if (s){
            city.marshallCombatScore = s.combat;
            if (s.combatBoostExpireUnixtime > now)
                city.marshallCombatScore *= 1.25;
        }
    }
    city.foremanBasePoliticsScore = 0;
    var s = Seed.knights[cityID];
    if (s) {
        s = s["knt" + Seed.leaders[cityID].politicsKnightId];
        if (s){
            city.foremanBasePoliticsScore = s.politics;
            if (s.politicsBoostExpireUnixtime > now)
                city.foremanBasePoliticsScore *= 1.25;
        }
    }

    city.loggingLevel = parseInt(Seed.tech["tch2"]);
    city.geometryLevel = parseInt(Seed.tech["tch5"]);
    city.eagleEyesLevel = parseInt(Seed.tech["tch6"]);
    city.poisonedEdgeLevel = parseInt(Seed.tech["tch8"]);
    city.metalAlloysLevel = parseInt(Seed.tech["tch9"]);
    city.featherweightPowderLevel = parseInt(Seed.tech["tch10"]);
    city.alloyHorseshoesLevel = parseInt(Seed.tech["tch12"]);
    city.fletchingLevel = parseInt(Seed.tech["tch13"]);
    city.giantsStrengthLevel = parseInt(Seed.tech["tch16"]);

    var bm = city.numBarracks + 0.1 * (city.totLevelsBarracks - city.numBarracks);
    var mf = city.marshallCombatScore / 200;
    var gf = city.geometryLevel / 10;
    var sf = city.stableLevel / 10;
    var wf = city.workshopLevel / 10;
    var isf = bm * (1 + mf + gf);
    var csf = bm * (1 + mf + gf + sf);
    var ssf = bm * (1 + mf + gf + sf + wf);
    var pf = city.foremanBasePoliticsScore / 200;
    var gsf = city.giantsStrengthLevel / 10;
    var dsf = 1 + pf + gsf;

    
    city.Troop1Time = ((city.maxBarracks > 0)?(50/isf):0);
    city.Troop2Time = city.Troop1Time/2;
    city.Troop3Time = ((city.maxBarracks > 1 && city.eagleEyesLevel > 0)?(100/isf):0);
    city.Troop4Time = ((city.maxBarracks > 1 && city.poisonedEdgeLevel > 0)?(150/isf):0);
    city.Troop5Time = ((city.maxBarracks > 2 && city.blacksmithLevel > 0 && city.metalAlloysLevel > 0)?(225/isf):0);
    city.Troop6Time = ((city.maxBarracks > 3 && city.fletchingLevel > 0)?(350/isf):0);
    city.Troop7Time = ((city.maxBarracks > 4 && city.stableLevel > 0 && city.alloyHorseshoesLevel > 0)?(500/csf):0);
    city.Troop8Time = ((city.maxBarracks > 6 && city.blacksmithLevel > 4 && city.stableLevel > 4 && city.alloyHorseshoesLevel > 4)?(1500/csf):0);
    city.Troop9Time = ((city.maxBarracks > 5 && city.stableLevel > 0 && city.workshopLevel > 2 && city.featherweightPowderLevel > 0)?(1000/ssf):0);
    city.Troop10Time = ((city.maxBarracks > 7 && city.stableLevel > 1 && city.workshopLevel > 4 && city.geometryLevel > 4 && city.fletchingLevel > 5)?(3000/ssf):0);
    city.Troop11Time = ((city.maxBarracks > 8 && city.blacksmithLevel > 4 && city.stableLevel > 2 && city.workshopLevel > 6 && city.metalAlloysLevel > 7 && city.geometryLevel > 6)?(4500/ssf):0);
    city.Troop12Time = ((city.maxBarracks > 9 && city.stableLevel > 1 && city.workshopLevel > 8 && city.geometryLevel > 9 && city.fletchingLevel > 9)?(6000/ssf):0);
    city.Def53Time = ((city.wallLevel > 5 && city.blacksmithLevel > 5 && city.fletchingLevel > 4)?(180/dsf):0);
    city.Def55Time = ((city.wallLevel > 7 && city.blacksmithLevel > 7 && city.fletchingLevel > 6 && city.geometryLevel > 6)?(135/dsf):0);
    city.Def60Time = ((city.wallLevel > 3 && city.blacksmithLevel > 3 && city.poisonedEdgeLevel > 1)?(90/dsf):0);
    city.Def61Time = ((city.wallLevel > 0 && city.metalAlloysLevel > 0)?(30/dsf):0);
    city.Def62Time = ((city.wallLevel > 1 && city.blacksmithLevel > 1 && city.loggingLevel > 1)?(60/dsf):0);
}


function dialogRetry (errMsg, seconds, onRetry, onCancel, errCode){
  seconds = parseInt(seconds);
  var pop = new pbPopup ('pbretry', 0, 0, 400,225, true);
  pop.centerMe(mainPop.getMainDiv());
  pop.getTopDiv().innerHTML = '<CENTER>KOC AIO Script</center>';
  pop.getMainDiv().innerHTML = '<CENTER><BR><FONT COLOR=#550000><B>An error has ocurred:</b></font><BR><BR><DIV id=paretryErrMsg></div>\
      <BR><BR><B>Automatically retrying in <SPAN id=paretrySeconds></b></span> seconds ...<BR><BR><INPUT id=paretryCancel type=submit class=pbButton value="CANCEL Retry" \>';
  document.getElementById('paretryCancel').addEventListener ('click', doCancel, false);
  pop.show(true);
  
  if(errCode && unsafeWindow.g_js_strings.errorcode['err_'+errCode])
    document.getElementById('paretryErrMsg').innerHTML = unsafeWindow.g_js_strings.errorcode['err_'+errCode];
  else
    document.getElementById('paretryErrMsg').innerHTML = errMsg;
  document.getElementById('paretrySeconds').innerHTML = seconds;
  var rTimer = setTimeout (doRetry, seconds*1000);
  countdown ();

  function countdown (){
    document.getElementById('paretrySeconds').innerHTML = seconds--;
    if (seconds > 0)
      cdTimer = setTimeout (countdown, 1000);
  }
  function doCancel(){
    clearTimeout (rTimer);
    clearTimeout (cdTimer);
    pop.destroy();
    onCancel ();
  }
  function doRetry (){
    clearTimeout (rTimer);
    clearTimeout (cdTimer);
    pop.show(false);
    onRetry();
  }
}

function implodeUrlArgs (obj){
  var a = [];
  for (var k in obj)
    a.push (k +'='+ encodeURI(obj[k]) );
  return a.join ('&');    
}

// NOTE: args can be either a string which will be appended as is to url or an object of name->values
function addUrlArgs (url, args){
  if (!args)
    return url;
  if (url.indexOf('?') < 0)
    url += '?';
  else if (url.substr(url.length-1) != '&')
    url += '&';    
  if (matTypeof(args == 'object'))
    return url + implodeUrlArgs (args);    
  return url + args;
}

// emulate protoype's Ajax.Request ...
function AjaxRequest (url, opts){
  RPM++;
  var headers = {
    'X-Requested-With': 'XMLHttpRequest',
    'X-Prototype-Version': '1.6.1',
    'Accept': 'text/javascript, text/html, application/xml, text/xml, */*'
  };
  var ajax = null;
  
  if (window.XMLHttpRequest)
    ajax=new XMLHttpRequest();
  else
    ajax=new ActiveXObject("Microsoft.XMLHTTP");
  
  if (opts.method==null || opts.method=='')
    method = 'GET';
  else
    method = opts.method.toUpperCase();  
    
  if (method == 'POST'){
    headers['Content-type'] = 'application/x-www-form-urlencoded; charset=UTF-8';
  } else if (method == 'GET'){
    addUrlArgs (url, opts.parameters);
  }

  ajax.onreadystatechange = function(){
//  ['Uninitialized', 'Loading', 'Loaded', 'Interactive', 'Complete']; states 0-4
    if (ajax.readyState==4) {
     if (ajax.status == 500)
        if (opts.onFailure) opts.onFailure(ajax);
      if (ajax.status >= 200 && ajax.status < 305)
        if (opts.onSuccess) opts.onSuccess(ajax);
      else
        if (opts.onFailure) opts.onFailure(ajax);
      
      Options.ResponseSize += parseInt(ajax.getResponseHeader ("Content-Length"));
    } else {
      if (opts.onChange) opts.onChange (ajax);
    }  
  }  
    
  ajax.open(method, url, true);   // always async!


  for (var k in headers)
    ajax.setRequestHeader (k, headers[k]);
  if (matTypeof(opts.requestHeaders)=='object')
    for (var k in opts.requestHeaders)
      ajax.setRequestHeader (k, opts.requestHeaders[k]);
      
  
  if (method == 'POST'){
    var a = [];
    for (k in opts.parameters){
      if(matTypeof(opts.parameters[k]) == 'object')
        for(var h in opts.parameters[k])
            a.push (k+'['+h+'] ='+ opts.parameters[k][h] );
      else
        a.push (k +'='+ opts.parameters[k] );
    }
    ajax.send (a.join ('&'));
  } else               {
    ajax.send();
  }
}   

function AsyncAjaxRequest (url, opts){
 var headers = {
    'X-Requested-With': 'XMLHttpRequest',
    'X-Prototype-Version': '1.6.1',
    'Accept': 'text/javascript, text/html, application/xml, text/xml, */*'
  };
  var ajax = null;
  
  if (window.XMLHttpRequest)
    ajax=new XMLHttpRequest();
  else
    ajax=new ActiveXObject("Microsoft.XMLHTTP");
  
  if (opts.method==null || opts.method=='')
    method = 'GET';
  else
    method = opts.method.toUpperCase();  
    
  if (method == 'POST'){
    headers['Content-type'] = 'application/x-www-form-urlencoded; charset=UTF-8';
  } else if (method == 'GET'){
    addUrlArgs (url, opts.parameters);
  }

  ajax.onreadystatechange = function(){
//  ['Uninitialized', 'Loading', 'Loaded', 'Interactive', 'Complete']; states 0-4
    if (ajax.readyState==4) {
     if (ajax.status == 500)
        if (opts.onFailure) opts.onFailure(ajax);
      if (ajax.status >= 200 && ajax.status < 305)
        if (opts.onSuccess) opts.onSuccess(ajax);
      else
        if (opts.onFailure) opts.onFailure(ajax);
      
      Options.ResponseSize += parseInt(ajax.getResponseHeader ("Content-Length"));
    } else {
      if (opts.onChange) opts.onChange (ajax);
    }  
  }  
    
  ajax.open(method, url, false);  


  for (var k in headers)
    ajax.setRequestHeader (k, headers[k]);
  if (matTypeof(opts.requestHeaders)=='object')
    for (var k in opts.requestHeaders)
      ajax.setRequestHeader (k, opts.requestHeaders[k]);
      
  
  if (method == 'POST'){
    var a = [];
    for (k in opts.parameters){
      if(matTypeof(opts.parameters[k]) == 'object')
        for(var h in opts.parameters[k])
            a.push (k+'['+h+'] ='+ opts.parameters[k][h] );
      else
        a.push (k +'='+ opts.parameters[k] );
    }
    ajax.send (a.join ('&'));
  } else               {
    ajax.send();
  }
}   

function MyAjaxRequest (url, o, noRetryX){
  RPM++;
  if (DEBUG_TRACE) logit (" 0 myAjaxRequest: "+ url +"\n" + inspect (o, 2, 1));
  var opts = unsafeWindow.Object.clone(o);
  var wasSuccess = o.onSuccess;
  var wasFailure = o.onFailure;
  var retry = 0;
  var delay = 3;
  var show = true;
  var noRetry = noRetry===true?true:false;
  var silentTimer;
  opts.onSuccess = mySuccess;
  opts.onFailure = myFailure;

  new AjaxRequest(url, opts);
  return;

  function myRetry(){
    ++retry;
    
    new AjaxRequest(url, opts);
    delay = delay * 1.25;
  }
  function myFailure(){
    var o = {};
    o.ok = false;
    o.errorMsg = "AJAX Communication Failure";
    wasFailure (o);
  }
  function mySuccess (msg){
    var rslt;
    try {
        rslt = JSON2.parse(msg.responseText);
    } catch(e) {
        if (retry<5) {
            rslt = {"ok":false,"error_code":9,"errorMsg":"Failed due to invalid json"}
        } else {
            rslt = {"ok":true,"error_code":9,"data":[]};
        }
    }
    var x;
    if (window.EmulateAjaxError){
      rslt.ok = false;  
      rslt.error_code=8;
    }
    if (rslt.ok){
      if (rslt.updateSeed)
        unsafeWindow.update_seed(rslt.updateSeed);
      wasSuccess (rslt);
      return;
    }
    rslt.errorMsg = unsafeWindow.printLocalError((rslt.error_code || null), (rslt.msg || null), (rslt.feedback || null));
    if (!noRetry && (rslt.error_code==0 || rslt.error_code==8 || rslt.error_code==1 || rslt.error_code==3)){
      dialogRetry (inspect(rslt.errorMsg), delay, function(){myRetry()}, function(){wasSuccess (rslt)}, rslt.error_code);
    } else if (!noRetry && rslt.error_code==9) {
        silentTimer = setTimeout(silentRetry, delay*100);
    } else {
      wasSuccess (rslt);
    }
  }
  
  function silentRetry() {
    clearTimeout(silentTimer);
    myRetry();
  }
}

function saveOptions (){
  var serverID = getServerId();
  setTimeout (function (){GM_setValue ('Options_'+serverID, JSON2.stringify(Options));}, 0);
}

function saveDashboardOptions (){
  var serverID = getServerId();
  setTimeout (function (){GM_setValue ('DashboardOptions_'+serverID, JSON2.stringify(DashboardOptions));}, 0);
}

function saveTrainOptions (){
  var serverID = getServerId();
  setTimeout (function (){GM_setValue ('TrainOptions_' + Seed.player['name'] + '_' +serverID, JSON2.stringify(TrainOptions));}, 0);
}

function saveCrestOptions (){
  var serverID = getServerId();
  setTimeout (function (){GM_setValue ('CrestOptions_' + Seed.player['name'] + '_' +serverID, JSON2.stringify(CrestOptions));}, 0);
}

function saveCraftOptions (){
  var serverID = getServerId();
  setTimeout (function (){GM_setValue ('CraftOptions_' + Seed.player['name'] + '_' +serverID, JSON2.stringify(CraftOptions));}, 0);
}

function saveApothecaryOptions (){
  var serverID = getServerId();
  setTimeout (function (){GM_setValue ('ApothecaryOptions_' + Seed.player['name'] + '_' +serverID, JSON2.stringify(ApothecaryOptions));}, 0);
}

function saveMarchOptions (){
  var serverID = getServerId();
  setTimeout (function (){GM_setValue ('MarchOptions_' + Seed.player['name'] + '_' +serverID, JSON2.stringify(MarchOptions));}, 0);
}

function saveAtkOptions (){
  var serverID = getServerId();
  setTimeout (function (){GM_setValue ('AtkOptions_' + Seed.player['name'] + '_' +serverID, JSON2.stringify(AtkOptions));}, 0);
}

function saveDFOptions (){
  var serverID = getServerId();
  setTimeout (function (){GM_setValue ('DFOptions' + Seed.player['name'] + '_' +serverID, JSON2.stringify(DFOptions));}, 0);
}

function saveColors (){
  var serverID = getServerId();
  GM_setValue ('Colors_'+serverID, JSON2.stringify(Colors));
}

function readColors (){
  var serverID = getServerId();
  s = GM_getValue ('Colors_'+serverID);
  if (s != null){
    opts = JSON2.parse (s);
    for (k in opts)
      Colors[k] = opts[k];
  }else{
	s = GM_getValue ('Colors');
	if (s != null){
		opts = JSON2.parse (s);
		for (k in opts)
		  Colors[k] = opts[k];
	}
  }
  if (Colors.ChatLeaders == "#B8B8B8") {Colors.ChatLeaders = "#B6E7F2";saveColors();}
  if (Colors.ChatVC == "#00ff00") {Colors.ChatVC = "#9ADE78";saveColors();}
  if (Colors.ChatChancy == "#F8E151") {Colors.ChatChancy = "#E9BEED";saveColors();}
}



function readOptions (){
  var serverID = getServerId();
  s = GM_getValue ('Options_'+serverID);
  if (s != null){
    opts = JSON2.parse (s);
    for (k in opts){
      if (matTypeof(opts[k]) == 'object')
        for (kk in opts[k])
          Options[k][kk] = opts[k][kk];
      else
        Options[k] = opts[k];
    }
  }
}

function readChatIcons (){
  var serverID = getServerId();
	s = GM_getValue ('ChatIcons'+serverID);
	if (s != null){
		opts = JSON2.parse (s);
		for (k in opts){
			if (ChatIcons[k] != undefined) {
				if (matTypeof(opts[k]) == 'object') {
					for (kk in opts[k])
						if (ChatIcons[k][kk] != undefined)
							ChatIcons[k][kk] = opts[k][kk];
				} else
					ChatIcons[k] = opts[k];
			}
		}
	}
}

function saveChatIcons (){
  var serverID = getServerId();
	GM_setValue ('ChatIcons'+serverID, JSON2.stringify(ChatIcons));
}


function readDashboardOptions (){
  var serverID = getServerId();
  s = GM_getValue ('DashboardOptions_'+serverID);
  if (s != null){
    opts = JSON2.parse (s);
    for (k in opts){
      if (matTypeof(opts[k]) == 'object')
        for (kk in opts[k])
          DashboardOptions[k][kk] = opts[k][kk];
      else
        DashboardOptions[k] = opts[k];
    }
  }
}
function readGlobalOptions (){
  GlobalOptions = JSON2.parse (GM_getValue ('Options_??', '{}'));
}

function readApothecaryOptions (){
  var serverID = getServerId();
  s = GM_getValue ('ApothecaryOptions_'+Seed.player['name']+'_'+serverID, '[]');
  if (s != null){
    opts = JSON2.parse (s);
    for (k in opts){
      if (matTypeof(opts[k]) == 'object')
        for (kk in opts[k])
          ApothecaryOptions[k][kk] = opts[k][kk];
      else
        ApothecaryOptions[k] = opts[k];
    }
  }
}

function readDFOptions (){
  var serverID = getServerId();
  s = GM_getValue ('DFOptions'+Seed.player['name']+'_'+serverID, '[]');
  if (s != null){
    opts = JSON2.parse (s);
    for (k in opts){
      if (matTypeof(opts[k]) == 'object') for (kk in opts[k]) DFOptions[k][kk] = opts[k][kk];
      else if (DFOptions[k] != undefined) DFOptions[k] = opts[k];
    }
  }
}

function readCrestOptions (){
  var serverID = getServerId();
  s = GM_getValue ('CrestOptions_' + Seed.player['name'] + '_' +serverID);
  if (s != null){
    opts = JSON2.parse (s);
    for (k in opts){
      if (matTypeof(opts[k]) == 'object')
        for (kk in opts[k])
          CrestOptions[k][kk] = opts[k][kk];
      else
        CrestOptions[k] = opts[k];
    }
  }
}

function readCraftOptions (){
  var serverID = getServerId();
  s = GM_getValue ('CraftOptions_' + Seed.player['name'] + '_' +serverID);
  if (s != null){
    opts = JSON2.parse (s);
    for (k in opts){
      if (matTypeof(opts[k]) == 'object')
        for (kk in opts[k])
          CraftOptions[k][kk] = opts[k][kk];
      else
        CraftOptions[k] = opts[k];
    }
  }
}

function readTrainingOptions (){
  var serverID = getServerId();
  s = GM_getValue ('TrainOptions_' + Seed.player['name'] + '_' +serverID);
  if (s != null){
    opts = JSON2.parse (s);
    for (k in opts){
      if (matTypeof(opts[k]) == 'object') {
      	for (kk in opts[k]) if (TrainOptions[k] != undefined) TrainOptions[k][kk] = opts[k][kk];
      } else if (TrainOptions[k] != undefined) TrainOptions[k] = opts[k];   	
    }
  }
}

function readMarchOptions (){
  var serverID = getServerId();
  s = GM_getValue ('MarchOptions_' + Seed.player['name'] + '_' +serverID);
  if (s != null){
    opts = JSON2.parse (s);
    for (k in opts){
      if (matTypeof(opts[k]) == 'object')
        for (kk in opts[k])
            if (matTypeof(opts[k][kk]) == 'object')
                for (kkk in opts[k][kk])
                  MarchOptions_[k][kk][kkk] = opts[k][kk][kkk];
            else
                MarchOptions[k][kk] = opts[k][kk];
      else
        MarchOptions[k] = opts[k];
    }
  }
}


function readAtkOptions (){
  var serverID = getServerId();
  s = GM_getValue ('AtkOptions_' + Seed.player['name'] + '_' +serverID);
  if (s != null){
    opts = JSON2.parse (s);
    for (k in opts){
      if (matTypeof(opts[k]) == 'object')
        for (kk in opts[k])
            if (matTypeof(opts[k][kk]) == 'object')
                for (kkk in opts[k][kk])
                  AtkOptions_[k][kk][kkk] = opts[k][kk][kkk];
            else
                AtkOptions[k][kk] = opts[k][kk];
      else
        AtkOptions[k] = opts[k];
    }
  }
}


function createButton (label,id){
  var a=document.createElement('a');
  a.className='button20';
  a.id = id;
  a.innerHTML='<span style="color: #ff6;vertical-align:middle">'+ label +'</span>';
  return a;
}

function AddMainTabLink(text, eventListener, mouseListener) {
  var a = createButton (text,'botbutton');
  a.className='tab';
  var tabs=document.getElementById('main_engagement_tabs');
  if(!tabs) {
    tabs=document.getElementById('topnav_msg');
    if (tabs) tabs=tabs.parentNode;
  }
  if (tabs) {
    var e = tabs.parentNode;
    var gmTabs = null;
    for (var i=0; i<e.childNodes.length; i++){
      var ee = e.childNodes[i];
      if (ee.tagName && ee.tagName=='DIV' && ee.className=='tabs_engagement' && ee.id!='main_engagement_tabs'){
        gmTabs = ee;
        break;
      }
    }
    if (gmTabs == null){
      gmTabs = document.createElement('div');
      gmTabs.className='tabs_engagement';
      gmTabs.style.background='#ca5';
      tabs.parentNode.insertBefore (gmTabs, tabs);
      gmTabs.style.whiteSpace='nowrap';
      gmTabs.style.width='735px';
      gmTabs.lang = 'en_PB';
    }
    gmTabs.appendChild(a);
    a.addEventListener('click',eventListener, false);
    if (mouseListener != null)a.addEventListener('mousedown',mouseListener, true);
    return a;
  }
  return null;
}

function AddSubTabLink(text, eventListener, id) {
  var a = createButton (text,'botbutton');
  a.className='tab';
  var tabs=document.getElementById('main_engagement_tabs');
  if(!tabs) {
    tabs=document.getElementById('topnav_msg');
    if (tabs) tabs=tabs.parentNode;
  }
  if (tabs) {
    var e = tabs.parentNode;
    var gmTabs = null;
    for (var i=0; i<e.childNodes.length; i++){
      var ee = e.childNodes[i];
      if (ee.tagName && ee.tagName=='DIV' && ee.className=='tabs_engagement' && ee.id!='main_engagement_tabs'){
        gmTabs = ee;
        break;
      }
    }
    if (gmTabs == null){
      gmTabs = document.createElement('div');
      gmTabs.className='tabs_engagement';
      gmTabs.style.background='#ca5';
      tabs.parentNode.insertBefore (gmTabs, tabs);
      gmTabs.style.whiteSpace='nowrap';
      gmTabs.style.width='735px';
      gmTabs.lang = 'en_PB';
    }
    gmTabs.appendChild(a);
    a.addEventListener('click',eventListener, false);
    if (id != null)
      a.id = id;
    return a;
  }
  return null;
}

function coordLink (x, y){
  var m = [];
  m.push ('(<a onclick="pbGotoMap (');
  m.push (x);
  m.push (',');
  m.push (y);
  m.push ('); return false">');
  m.push (x);
  m.push (',');
  m.push (y);
  m.push ('</a>)');  
  return m.join('');
}


unsafeWindow.pbGotoMap = function (x, y){
  setTimeout (function (){
    document.getElementById('mapXCoor').value = x;
    document.getElementById('mapYCoor').value = y;
    unsafeWindow.reCenterMapWithCoor();
    var a = document.getElementById("mod_views").getElementsByTagName("a");
    for (var b = 0; b < a.length; b++) {
        a[b].className = ""
    }
    document.getElementById('mod_views_map').className = "sel";
    document.getElementById("maparea_city").style.display = 'none';
    document.getElementById("maparea_fields").style.display = 'none';
    document.getElementById("maparea_map").style.display = 'block';
    unsafeWindow.tutorialClear()
  }, 0);
};



/************** ChatPane **********/
var ChatPane = {
  init : function(){
    var t = ChatPane;
  },
  
  HandleChatPane : function() {
    var DisplayName = GetDisplayName();
    var AllianceChatBox=document.getElementById('mod_comm_list2');
    var GlobalChatBox=document.getElementById('mod_comm_list1');
    
    if(AllianceChatBox){
        var chatPosts = document.evaluate(".//div[contains(@class,'chatwrap')]", AllianceChatBox, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null );
        if(chatPosts){
            for (var i = 0; i < chatPosts.snapshotLength; i++) {
                thisPost = chatPosts.snapshotItem(i);
                if(Options.HelpRequest){
                    var postAuthor = document.evaluate('.//*[@class="nm"]', thisPost, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null );
                    if(postAuthor.snapshotItem(0)){
                        var postAuthorName = postAuthor.snapshotItem(0).innerHTML;
                        if(postAuthorName != DisplayName){
                            var helpAllianceLinks=document.evaluate(".//a[contains(@onclick,'claimAllianceChatHelp')]", thisPost, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null );  
                            if(helpAllianceLinks){
                                for (var j = 0; j < helpAllianceLinks.snapshotLength; j++) {
                                    thisLink = helpAllianceLinks.snapshotItem(j);
                                    var alreadyClicked = thisLink.getAttribute("clicked");
                                    if(!alreadyClicked){
                                        thisLink.setAttribute('clicked', 'true');
                                        var myregexp = /(claimAllianceChatHelp\(.*\);)/;
                                        var match = myregexp.exec(thisLink.getAttribute("onclick"));
                                        
                                        if (match != null) {
                                            onclickCode = match[0];
                                            if(true){
                                            	RPM++
                                                DoUnsafeWindow(onclickCode);
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                // Hide alliance requests in chat
               if(Options.DeleteRequest){
                     var helpAllianceLinks=document.evaluate(".//a[contains(@onclick,'claimAllianceChatHelp')]", thisPost, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null );
                    if(helpAllianceLinks){
                        for (var j = 0; j < helpAllianceLinks.snapshotLength; j++) {
                            thisLink = helpAllianceLinks.snapshotItem(j);
                            thisLink.parentNode.parentNode.parentNode.parentNode.parentNode.removeChild(thisLink.parentNode.parentNode.parentNode.parentNode);
                        }
                    }
                // Hide alliance reports in chat
                    var myregexp1 = /You are # [0-9]+ of [0-9]+ to help/i;
                    var myregexp2 = /\'s Kingdom does not need help\./i;
                    var myregexp3 = /\'s project has already been completed\./i;
                    var myregexp4 = /\'s project has received the maximum amount of help\./i;
                    var myregexp5 = /You already helped with (.*?)\'s project\./i;
                    if (thisPost.innerHTML.match(myregexp1) || thisPost.innerHTML.match(myregexp2) || thisPost.innerHTML.match(myregexp3) || thisPost.innerHTML.match(myregexp4) || thisPost.innerHTML.match(myregexp5)) {
                        thisPost.parentNode.removeChild(thisPost);
                    }
                }
            }    
        }    
    }
    if (GlobalChatBox) {
    	 var chatPosts = document.evaluate(".//div[contains(@class,'chatwrap')]", GlobalChatBox, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null );
    	 if(chatPosts) for (var i = 0; i < chatPosts.snapshotLength; i++) {
    	 	 thisPost = chatPosts.snapshotItem(i);
		     if(Options.DeleteRequest){
		            var helpAllianceLinks=document.evaluate(".//a[contains(@onclick,'claimAllianceChatHelp')]", thisPost, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null );
		            if(helpAllianceLinks){
		                for (var j = 0; j < helpAllianceLinks.snapshotLength; j++) {
		                    thisLink = helpAllianceLinks.snapshotItem(j);
		                    thisLink.parentNode.parentNode.parentNode.parentNode.parentNode.removeChild(thisLink.parentNode.parentNode.parentNode.parentNode);
		                }
		            }
		      }
		 }
    }
  },

}


/**********************************************************************************/
function addScript (scriptText){
	var scr = document.createElement('script');   
	scr.innerHTML = scriptText;
	document.body.appendChild(scr);
}
addScript ('uwuwuwFunc = function (text){ eval (text);  }');

var CalterUwFunc = function (funcName, findReplace) {
  var t = this;
  this.isEnabled = false;
  this.isAvailable = isAvailable;
  this.setEnable = setEnable;
  this.funcName = funcName;
  this.funcOld = unsafeWindow[funcName];  
  this.funcNew = null;
  try {
    var funcText = unsafeWindow[funcName].toString();
    var rt = funcText.replace ('function '+ funcName, 'function');
    for (var i=0; i<findReplace.length; i++){
      x = rt.replace(findReplace[i][0], findReplace[i][1]);
      if (x == rt)
        return false;
      rt = x;
    }
    this.funcNew = rt;
  } catch (err) {
  }
      
  function setEnable (tf){
    if (t.funcNew == null)
      return;
    if (t.isEnabled != tf){
      if (tf){
          var scr=document.createElement('script');
          scr.innerHTML = funcName +' = '+ t.funcNew;
          document.body.appendChild(scr);
        setTimeout ( function (){document.body.removeChild(scr);}, 0);
          t.isEnabled = true;
      } else {
        unsafeWindow[t.funcName] = t.funcOld;
        t.isEnabled = false;
      }
    }
  }
  function isAvailable (){
    if (t.funcNew == null)
      return false;
    return true;
  }
};

var CalterUwFuncTools = function (funcName, findReplace) {
  var t = this;
  this.isEnabled = false;
  this.isAvailable = isAvailable;
  this.setEnable = setEnable;
  this.funcOld = null;  
  this.funcNew = null;
  try {
    var x = funcName.split('.');
    var f = unsafeWindow;
    for (var i=0; i<x.length; i++)
      f = f[x[i]];
    ft = f.toString();
    this.funcOld = f;
    var rt = ft.replace ('function '+ funcName, 'function');
    for (var i=0; i<findReplace.length; i++){
      x = rt.replace(findReplace[i][0], findReplace[i][1]);
      if (x == rt)  // if not found
        return;
      rt = x;
    }
    this.funcNew = rt;
  } catch (err) {
  }
      
  function setEnable (tf){
    if (t.funcNew == null) return;
    if (t.isEnabled != tf){
      if (tf){
		unsafeWindow.uwuwuwFunc(funcName +' = '+ t.funcNew);
      	t.isEnabled = true;
      } else {
      var x = funcName.split('.');
      var f = unsafeWindow;
      for (var i=0; i<x.length-1; i++)
        f = f[x[i]];
      f[x[x.length-1]] = this.funcOld;
        t.isEnabled = false;
      }
    }
  }
  function isAvailable (){
    if (t.funcNew == null)
      return false;
    return true;
  }
};

var CalterunsafeWindowVar = function (funcName, findReplace) {
  var t = this;
  this.isEnabled = false;
  this.isAvailable = isAvailable;
  this.setEnable = setEnable;
  this.funcName = funcName;
  this.funcOld = unsafeWindow[funcName];  
  this.funcNew = null;
  try {
    var funcText = null;
    funcName = funcName.split('.');
    funcText = unsafeWindow[funcName[0]];
    for(var i=1; i<funcName.length; i++)
        funcText = funcText[funcName[i]];

    var rt = funcText.toString();
    for (var i=0; i<findReplace.length; i++){
      x = rt.replace(findReplace[i][0], findReplace[i][1]);
      if (x == rt)
        return false;
      rt = x;
    }
    this.funcNew = rt;
  } catch (err) {
    GM_log(err);
  }
  
  function setEnable (tf){
    if (t.funcNew == null)
      return;
    if (t.isEnabled != tf){
      if (tf){
          var scr=document.createElement('script');
          scr.innerHTML = funcName +' = '+ t.funcNew;
          document.body.appendChild(scr);
        setTimeout ( function (){document.body.removeChild(scr);}, 0);
          t.isEnabled = true;
      } else {
        unsafeWindow[t.funcName] = t.funcOld;
        t.isEnabled = false;
      }
    }
  }
  function isAvailable (){
    if (t.funcNew == null)
      return false;
    return true;
  }
};

function getMarchInfo (cityID){
  var ret = {};

  ret.marchUnits = [];
  ret.returnUnits = [];
  ret.resources = [];
  for (i=0; i<13; i++){
    ret.marchUnits[i] = 0;
    ret.returnUnits[i] = 0;
  }
  for (i=0; i<5; i++){
    ret.resources[i] = 0;
  }
  
  for (k in Seed.queue_atkp[cityID]){   // each march
      march = Seed.queue_atkp[cityID][k];
      if(march.marchType != 5){
          if (typeof (march) == 'object'){
            for (ii=0; ii<13; ii++){
              ret.marchUnits[ii] += parseInt (march['unit'+ ii +'Count']);
              ret.returnUnits[ii] += parseInt (march['unit'+ ii +'Return']);
            }
            for (ii=1; ii<5; ii++){
              ret.resources[ii] += parseInt (march['resource'+ ii]);
            }
              ret.resources[0] += parseInt (march['gold']);
          }
      }
    }
  return ret;
}

function makeButton20 (label){
  var a = document.createElement('a');
  a.className = "button20 ptButton20";
  var s = document.createElement('span');
  s.innerHTML = label;
  a.appendChild (s);
  return a;
}

function strButton20 (label, tags){
  if (tags == null)
    tags = '';
  return ('<TABLE class=ptNoPad><TR><TD><A class="button20 ptButton20" '+ tags +'><SPAN>'+ label +'</span></a></td></tr></table>' );
}

function strButton14 (label, tags){
  if (tags == null)
    tags = '';
  return ('<A class="button14 ptButton20" '+ tags +'><SPAN>'+ label +'</span></a>' );
}

function reloadKOC (){
  var serverId = getServerId();
  if(serverId == '??') window.location.reload(true);
  var goto = window.location.protocol+'//apps.facebook.com/kingdomsofcamelot/?s='+serverId;
  if(document.URL.match(/standalone=1/i)){
    goto = window.location.protocol+'//www.kabam.com/kingdoms-of-camelot/play?s='+serverId;
  }
  var t = '<FORM target="_top" action="'+ goto +'" method=post><INPUT id=xxpbButReload type=submit class=pbButton value=RELOAD><INPUT type=hidden name=s value="'+ serverId +'"</form>';
  var e = document.createElement ('div');
  e.innerHTML = t;
  document.body.appendChild (e);
  setTimeout (function (){document.getElementById('xxpbButReload').click();}, 0);
}
  
function htmlSelector (valNameObj, curVal, tags){
  var m = [];
  m.push ('<SELECT');
  if (tags){
    m.push (' ');
    m.push (tags);
  }  
  for (var k in valNameObj){
    m.push ('><OPTION ');
    if (k == curVal)
      m.push ('SELECTED ');
    m.push ('value="');
    m.push (k);
    m.push ('">');
    m.push (valNameObj[k]);
    m.push ('</option>');
  }
  m.push ('</select>');
  return m.join ('');
}

function cityStatusString (cs){
  if (cs==4)
    return 'Vacation';
  if (cs==3)
    return 'Truce';
  if (cs==2)
    return 'Beg Protection';
  return 'Normal';
}    

// Simple method, as if it were typed in thru DOM
function sendChat (msg){
  document.getElementById ("mod_comm_input").value = msg;
  unsafeWindow.Chat.sendChat ();
}

// works well, but message is not echoed back to local client
Chat = {
  params : null,

  sendWhisper : function (msg, who, notify){
    this.params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    this.params.ctype = 3;
    this.params.name = who;
    this._sendit (msg, notify);
  },

  sendGlobal : function (msg, notify){
    this.params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    this.params.ctype = 1;
    this._sendit (msg, notify);
  },

  sendAlliance : function (msg, notify){
    this.params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    this.params.ctype = 2;
    this._sendit (msg, notify);
  },

  _sendit : function (msg, notify){
    function strip(s) {
       return s.replace(/^\s+/, '').replace(/\s+$/, '');
    }
    this.params.comment = strip (msg);
    
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/sendChat.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: this.params,
      onSuccess: function(transport) {
        if (notify)
          notify ();
      },
      onFailure: function(transport) {
        if (notify)
          notify ();
      }
    });
  },
}



/************  LIB classes/functions .... **************/

DebugTimer = {
  startTime : 0,
  start : function (){
    now = new Date();
    DebugTimer.startTime = now.getTime();
  },
  getMillis : function (){
    now = new Date();
    return now.getTime() - DebugTimer.startTime;
  },
  display : function (label, noReset){
    now = new Date();
    elapsed = now.getTime() - DebugTimer.startTime;
    logit (label +": "+ elapsed/1000);
    if (noReset===null || !noReset)
      DebugTimer.startTime = now.getTime();
  },
};


function debugPos  (e){
  return '['+ e.tagName +'] client - offset: '+ e.clientLeft +','+ e.clientTop +','+ e.clientWidth +','+ e.clientHeight
          +' - '+ e.offsetLeft +','+ e.offsetTop +','+ e.offsetWidth +','+ e.offsetHeight +' '+ e +' --OP--> '+ e.offsetParent;
}

function CwaitForElement (id, timeout, notify){
  this.check = check;
  this.end = new Date().getTime() + timeout;
  var t = this;
  this.check();
  function check(){
    if (document.getElementById (id))
      notify (true);
    else if (new Date().getTime() > t.end)
      notify (false);
    else
      setTimeout (t.check, 500);
  }
}

function clickWin (win,obj,evtName) {
    var evt = win.document.createEvent("MouseEvents");
    evt.initMouseEvent(evtName, true, true, win, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
    return !obj.dispatchEvent(evt);
}
    
function debugElement  (e){
  var x = unsafeWindow.Object.clone (e.wrappedJSObject);
  x.innerHTML = '';
  x.innerText = '';
  x.textContent = '';
  return inspect (x, 1, 1);
}     

function getClientCoords(e){
  if (e==null)
    return {x:null, y:null, width:null, height:null};
  var x=0, y=0;
  ret = {x:0, y:0, width:e.clientWidth, height:e.clientHeight};
  while (e.offsetParent != null){
    ret.x += e.offsetLeft;
    ret.y += e.offsetTop;
    e = e.offsetParent;
  }
  return ret;
}

function DOMtree (e, levels){
  var m = [];
  level (e, levels, 0);
  
  function level (e, levels, cur){
    try {        
      for (var i=0; i<cur; i++)
        m.push('  ');
      if (!e.tagName)
        m.push ('?');
      else
        m.push (e.tagName);
      if (e.id){
        m.push (' id=');
        m.push (e.id);
      }
      if (e.name){
        m.push (' name=');
        m.push (e.name);
      }
      if (e.className){
        m.push (' class=');
        m.push (e.className);
      }
      if (e.style && e.style.display && e.style.display.indexOf('none')>0)
        m.push (' hidden');
       m.push ('\n');
      if (cur < levels){
        for (var c=0; c<e.childNodes.length; c++){
          level (e.childNodes[c], levels, cur+1);
        }
      }
    } catch (e) {
      m.push ('UNAVAILBLE!\n');
    }
  }
  return m.join('');  
}

function parseIntNan (n){
  x = parseInt(n, 10);
  if (isNaN(x))
    return 0;
  return x;
}
function parseIntCommas (n){
  n = n.split(',');
  n = n.join('');
  x = parseInt(n, 10);
  if (isNaN(x))
    return 0;
  return x;
}
function parseIntZero (n){
  n = n.trim();
  if (n == '')
    return 0;
  return parseInt(n, 10);
}
function isNaNCommas (n){
  n = n.split(',');
  n = n.join('');
  return isNaN(n);
}


function getFirefoxVersion (){
  var ver='', i;
  var ua = navigator.userAgent;  
  if (ua==null || (i = ua.indexOf('Firefox/'))<0)
    return;
  return ua.substr(i+8);
}

var WinManager = {
  wins : {},    // prefix : pbPopup obj
  didHide : [],
  
  
  get : function (prefix){
    var t = WinManager;
    return t.wins[prefix];
  },
  
  add : function (prefix, pop){
    var t = WinManager;
    t.wins[prefix] = pop;
    if (unsafeWindow.cpopupWins == null)
      unsafeWindow.cpopupWins = {};
    unsafeWindow.cpopupWins[prefix] = pop;
  },
  
  hideAll : function (){
    var t = WinManager;
    t.didHide = [];
    for (k in t.wins){
      if (t.wins[k].isShown()){
        t.didHide.push (t.wins[k]);
        t.wins[k].show (false);
      }
    }
  },
  restoreAll : function (){
    var t = WinManager;
    for (var i=0; i<t.didHide.length; i++)
      t.didHide[i].show (true);
  },
  
  delete : function (prefix){
    var t = WinManager;
    delete t.wins[prefix];
    delete unsafeWindow.cpopupWins[prefix];
  }    
}


// creates a 'popup' div
// prefix must be a unique (short) name for the popup window
function pbPopup (prefix, x, y, width, height, enableDrag, onClose) {
  var pop = WinManager.get(prefix);
  if (pop){
    pop.show (false);
    return pop;
  }
  this.BASE_ZINDEX = 111111;
    
  // protos ...
  this.show = show;
  this.toggleHide = toggleHide;
  this.getTopDiv = getTopDiv;
  this.getMainTopDiv = getMainTopDiv;
  this.getMainDiv = getMainDiv;
  this.getLayer = getLayer;
  this.setLayer = setLayer;
  this.setEnableDrag = setEnableDrag;
  this.getLocation = getLocation;
  this.setLocation = setLocation;
  this.focusMe = focusMe;
  this.isShown = isShown;
  this.unfocusMe = unfocusMe;
  this.centerMe = centerMe;
  this.destroy = destroy;
  this.autoHeight = autoHeight;

  // object vars ...
  this.div = document.createElement('div');
  this.prefix = prefix;
  this.onClose = onClose;
  
  var t = this;
  this.div.className = 'pbPopup '+ prefix +'_pbPopup';
  this.div.id = prefix +'_outer';
  this.div.style.background = "#fff";
  this.div.style.zIndex = this.BASE_ZINDEX        // KOC modal is 100210 ?
  this.div.style.display = 'none';
  this.div.style.width = width + 'px';
  this.div.style.height = height + 'px';
  this.div.style.maxHeight = height + 'px';
  this.div.style.overflowY = 'show';
  this.div.style.position = "absolute";
  this.div.style.top = y +'px';
  this.div.style.left = x + 'px';
  
  if (pbPopUpTopClass==null)
    topClass = 'pbPopupTop '+ prefix +'_pbPopupTop';
  else
    topClass = pbPopUpTopClass +' '+ prefix +'_'+ pbPopUpTopClass;
    
  var m = '<TABLE cellspacing=0 width=100% ><TR id="'+ prefix +'_bar" class="'+ topClass +'"><TD width=99% valign=bottom><SPAN id="'+ prefix +'_top"></span></td>\
      <TD id='+ prefix +'_X align=right valign=middle onmouseover="this.style.cursor=\'pointer\'" style="color:#fff; background:#333; font-weight:bold; font-size:14px; padding:0px 5px; border-top-right-radius: 25px;">x</td></tr>\
      </table><TABLE cellspacing=0 width=100% ><TR><TD height=100% valign=top class="pbPopMain '+ prefix +'_pbPopMain" colspan=2 id="'+ prefix +'_main"></td></tr></table>';
  document.body.appendChild(this.div);
  this.div.innerHTML = m;
  document.getElementById(prefix+'_X').addEventListener ('click', e_XClose, false);
  this.dragger = new CWinDrag (document.getElementById(prefix+'_bar'), this.div, enableDrag);
  
  this.div.addEventListener ('mousedown', e_divClicked, false);
  WinManager.add(prefix, this);
  
  function e_divClicked (){
    t.focusMe();
  }  
  function e_XClose (){
    t.show(false);
    if (t.onClose != null)
      t.onClose();
  }
  function autoHeight (onoff){
    if (onoff)
      t.div.style.height = '';  
    else
      t.div.style.height = t.div.style.maxHeight;
  }
  function focusMe (){
    t.setLayer(5);
    for (k in unsafeWindow.cpopupWins){
      if (k != t.prefix)
        unsafeWindow.cpopupWins[k].unfocusMe();
    }
  }
  function unfocusMe (){
    t.setLayer(-5);
  }
  function getLocation (){
    return {x: parseInt(this.div.style.left), y: parseInt(this.div.style.top)};
  }
  function setLocation (loc){
    t.div.style.left = loc.x +'px';
    t.div.style.top = loc.y +'px';
  }
  function destroy (){
    document.body.removeChild(t.div);
    WinManager.delete (t.prefix);
  }
  function centerMe (parent){
    if (parent == null){
      var coords = getClientCoords(document.body);
    } else
      var coords = getClientCoords(parent);
    var x = ((coords.width - parseInt(t.div.style.width)) / 2) + coords.x;
    var y = ((coords.height - parseInt(t.div.style.height)) / 2) + coords.y;
    if (x<0)
      x = 0;
    if (y<0)
      y = 0;
    t.div.style.left = x +'px';
    t.div.style.top = y +'px';
  }
  function setEnableDrag (tf){
    t.dragger.setEnable(tf);
  }
  function setLayer(zi){
    t.div.style.zIndex = ''+ (this.BASE_ZINDEX + zi);
  }
  function getLayer(){
    return parseInt(t.div.style.zIndex) - this.BASE_ZINDEX;
  }
  function getTopDiv(){
    return document.getElementById(this.prefix+'_top');
  }
  function getMainDiv(){
    return document.getElementById(this.prefix+'_main');
  }
  function getMainTopDiv(){
      return document.getElementById(this.prefix+'_top');
  }
  function isShown (){
    return t.div.style.display == 'block';
  }
  function show(tf){
    if (tf){
      t.div.style.display = 'block';
      t.focusMe ();
    } else {
      t.div.style.display = 'none';
    }
    return tf;
  }
  function toggleHide(t){
    if (t.div.style.display == 'block') {
      return t.show (false);
    } else {
      return t.show (true);
    }
  }
}

function CWinDrag (clickableElement, movingDiv, enabled) {
  var t=this;
  this.setEnable = setEnable;
  this.setBoundRect = setBoundRect;
  this.debug = debug;
  this.dispEvent = dispEvent;
  this.lastX = null;
  this.lastY = null;
  this.enabled = true;
  this.moving = false;
  this.theDiv = movingDiv;
  this.body = document.body;
  this.ce = clickableElement;
  this.moveHandler = new CeventMove(this).handler;
  this.outHandler = new CeventOut(this).handler;
  this.upHandler = new CeventUp(this).handler;
  this.downHandler = new CeventDown(this).handler;
  this.clickableRect = null;
  this.boundRect = null;
  this.bounds = null;
  this.enabled = false;
  if (enabled == null)
    enabled = true;
  this.setEnable (enabled);

  function setBoundRect (b){    // this rect (client coords) will not go outside of current body
    this.boundRect = boundRect;
    this.bounds = null;
  }

  function setEnable (enable){
    if (enable == t.enabled)
      return;
    if (enable){
      clickableElement.addEventListener('mousedown',  t.downHandler, false);
      t.body.addEventListener('mouseup', t.upHandler, false);
    } else {
      clickableElement.removeEventListener('mousedown', t.downHandler, false);
      t.body.removeEventListener('mouseup', t.upHandler, false);
    }
    t.enabled = enable;
  }

  function CeventDown (that){
    this.handler = handler;
    var t = that;
    function handler (me){
      if (t.bounds == null){
        t.clickableRect = getClientCoords(clickableElement);
        t.bodyRect = getClientCoords(document.body);
        if (t.boundRect == null)
          t.boundRect = t.clickableRect;
        t.bounds = {top:10-t.clickableRect.height, bot:t.bodyRect.height-25, left:40-t.clickableRect.width, right:t.bodyRect.width-25};
      }
      if (me.button==0 && t.enabled){
        t.body.addEventListener('mousemove', t.moveHandler, true);
        t.body.addEventListener('mouseout', t.outHandler, true);
        t.lastX = me.clientX;
        t.lastY = me.clientY;
        t.moving = true;
      }
    }
  }

  function CeventUp  (that){
    this.handler = handler;
    var t = that;
    function handler (me){
      if (me.button==0 && t.moving)
        _doneMoving(t);
    }
  }

  function _doneMoving (t){
    t.body.removeEventListener('mousemove', t.moveHandler, true);
    t.body.removeEventListener('mouseout', t.outHandler, true);
    t.moving = false;
  }

  function CeventOut  (that){
    this.handler = handler;
    var t = that;
    function handler (me){
      if (me.button==0){
        t.moveHandler (me);
      }
    }
  }

  function CeventMove (that){
    this.handler = handler;
    var t = that;
    function handler (me){
      if (t.enabled && !t.wentOut){
        var newTop = parseInt(t.theDiv.style.top) + me.clientY - t.lastY;
        var newLeft = parseInt(t.theDiv.style.left) + me.clientX - t.lastX;
        if (newTop < t.bounds.top){     // if out-of-bounds...
          newTop = t.bounds.top;
          _doneMoving(t);
        } else if (newLeft < t.bounds.left){
          newLeft = t.bounds.left;
          _doneMoving(t);
        } else if (newLeft > t.bounds.right){
          newLeft = t.bounds.right;
          _doneMoving(t);
        } else if (newTop > t.bounds.bot){
          newTop = t.bounds.bot;
          _doneMoving(t);
        }
        t.theDiv.style.top = newTop + 'px';
        t.theDiv.style.left = newLeft + 'px';
        t.lastX = me.clientX;
        t.lastY = me.clientY;
      }
    }
  }

  function debug  (msg, e){
    logit ("*************** "+ msg +" ****************");
    logit ('clientWidth, Height: '+ e.clientWidth +','+ e.clientHeight);
    logit ('offsetLeft, Top, Width, Height (parent): '+ e.offsetLeft +','+ e.offsetTop +','+ e.offsetWidth +','+ e.offsetHeight +' ('+ e.offsetParent +')');
    logit ('scrollLeft, Top, Width, Height: '+ e.scrollLeft +','+ e.scrollTop +','+ e.scrollWidth +','+ e.scrollHeight);
  }

  function dispEvent (msg, me){
    logit (msg + ' Button:'+ me.button +' Screen:'+ me.screenX +','+ me.screenY +' client:'+  me.clientX +','+ me.clientY +' rTarget: '+ me.relatedTarget);
  }
}

function inspect(obj, maxLevels, level, doFunctions){
  var str = '', type, msg;
  if(level == null)  level = 0;
  if(maxLevels == null) maxLevels = 1;
  if(maxLevels < 1)
      return 'Inspect Error: Levels number must be > 0';
  if(obj == null)
    return 'ERROR: Object is NULL\n';
  var indent = '';
  for (var i=0; i<level; i++)
    indent += '  ';
  for(property in obj) {
    try {
        type =  matTypeof(obj[property]);
        if (doFunctions==true && (type == 'function')){
          str += indent + '(' + type + ') ' + property + "[FUNCTION]\n";
        } else if (type != 'function') {
          str += indent + '(' + type + ') ' + property + ( (obj[property]==null)?(': null'):('')) +' = '+ obj[property] +"\n";
        }
        if((type=='object' || type=='array') && (obj[property] != null) && (level+1 < maxLevels))
          str += inspect(obj[property], maxLevels, level+1, doFunctions);  // recurse
    }
    catch(err) {
      // Is there some properties in obj we can't access? Print it red.
      if(typeof(err) == 'string') msg = err;
      else if(err.message)        msg = err.message;
      else if(err.description)    msg = err.description;
      else                        msg = 'Unknown';
      str += '(Error) ' + property + ': ' + msg +"\n";
    }
  }
  str += "\n";
  return str;
}

Array.prototype.compare = function(testArr) {
    if (this.length != testArr.length) return false;
    for (var i = 0; i < testArr.length; i++) {
        if (this[i].compare) {
            if (!this[i].compare(testArr[i])) return false;
        }
        if (this[i] !== testArr[i]) return false;
    }
    return true;
}
String.prototype.StripQuotes = function() {
    return this.replace(/"/g,'');
}

String.prototype.entityTrans = { '&':'&amp;', '<':'&lt;',  '>':'&gt;',  '\"':'&quot;', '\'':'&#039', '<':'\\u003c', '/':'\\/', '\\':'\\\\', '\"':'\\\"','{':'&#123;','}':'&#125;'};
String.prototype.htmlSpecialChars = function() {
  var ret = this.toString();
  for (k in this.entityTrans)
     ret  = ret.split(k).join(this.entityTrans[k]);
  return ret;
}
String.prototype.htmlSpecialCharsDecode = function() {
  var ret = this.toString();
  for (k in this.entityTrans)
     ret = ret.split(this.entityTrans[k]).join(k);
  return ret;
}
String.prototype.trim = function () {
    return this.replace(/^\s*/, "").replace(/\s*$/, "");
}
String.prototype.escape_space = function(){
    var s = this.split(" ");
    for(var i=0; i<s.length; i++)
        s[i] = escape(s[i]);
    //return s.join(" ");
    return this.replace(/</ig,"&#60;");
}
String.prototype.unescape_space = function(){
    var s = this.split(" ");
    for(var i=0; i<s.length; i++)
        s[i] = unescape(s[i]);
    //return s.join(" ");
    return this;
}

function officerId2String (oid){
  if (oid==null)
    return '';
  else if (oid==3)
    return 'Officer';
  else if (oid==2)
    return 'Vice Chance';
  else if (oid==1)
    return 'Chancellor';
  return '';
}

function getResourceProduction (cityId){
  var ret = [0,0,0,0,0];
  var now = unixTime ();
  
  var wilds = [0, 0, 0, 0, 0];
  var w = Seed.wilderness["city" + cityId];
  for (var k in w){
    var type = parseInt(w[k].tileType);
    if (type==10 || type==11)
      wilds[1] += parseInt(w[k].tileLevel);
    else
      wilds[type/10] += parseInt(w[k].tileLevel);
  }  
  
  knight = 0;       
  var s = Seed.knights["city" + cityId];
  if (s) {
    s = s["knt" + Seed.leaders["city" + cityId].resourcefulnessKnightId];
    if (s){
      var knight = parseInt(s.resourcefulness);
      if (s.resourcefulnessBoostExpireUnixtime > now)
        knight *= 1.25;
    }
  }
  var workerFactor = 1;
  var c = parseInt(Seed.citystats["city" + cityId]["pop"][0]);  // Current  population
  var w = parseInt(Seed.citystats["city" + cityId]["pop"][3]);  // Labor force
  if (w > c)
    workerFactor = c / w;
  
  for (var i=1; i<5; i++){
    var usage = Seed.resources["city" + cityId]["rec" + i];
    var items = 0;
    if (parseInt(Seed.playerEffects["r" + i + "BstExp"]) > now) {
      items = 0.25;
    }
    var tech = Seed.tech["tch" + i];
    ret[i] = parseInt((usage[2] * (1 + tech/10 + knight/100 + items + 0.05 * wilds[i]) * workerFactor + 100));
  }
  return ret;  
}

function objectName (o){
  var s = o.toString();
  return s.substr(7,s.length-8);
}

function matTypeof (v){
  if (typeof (v) == 'object'){
    if (!v)
      return 'null';
//    else if (unsafeWindow.Object.prototype.toString.apply(v) === '[object Array]')
    else if (v.constructor.toString().indexOf("Array")>=0 && typeof(v.splice)=='function')
      return 'array';
    else return 'object';
  }
  return typeof (v);
}

function updatebotbutton(text, id)
{
    var but=document.getElementById(id);
    but.innerHTML = '<span style="color: #ff6">'+text+'</span>';
}

function tbodyScroller (tbody, maxHeight){  
  tbody.style.maxHeight = '';
  tbody.style.height = '';
  tbody.style.overflowX = 'hidden';
  if (parseInt(tbody.clientHeight) > maxHeight){
    tbody.style.height = maxHeight + 'px';
    tbody.style.maxHeight = maxHeight + 'px';
    tbody.style.overflowY = 'auto';
  }
}
function getRemainingHeight (e, cont){
  var ec = getClientCoords(e);
  var cc = getClientCoords(cont);
  return cont.clientHeight - (ec.y - cc.y);
}

function addCommasInt(n){
  nStr = parseInt(n) + '';
  var rgx = /(\d+)(\d{3})/;
  while (rgx.test(nStr)) {
    nStr = nStr.replace(rgx, '$1' + ',' + '$2');
  }
  return nStr;
}

function addCommas(nStr){
  nStr += '';
  x = nStr.split('.');
  x1 = x[0];
  x2 = x.length > 1 ? '.' + x[1] : '';
  var rgx = /(\d+)(\d{3})/;
  while (rgx.test(x1)) {
    x1 = x1.replace(rgx, '$1' + ',' + '$2');
  }
  return x1 + x2;
}

function unixTime (){
  return parseInt (new Date().getTime() / 1000) + unsafeWindow.g_timeoff;
}
function htmlOptions (a, curVal){
  m = '';
  for (k in a)
    m += '<OPTION value="'+ k +'"'+ (k==curVal?' SELECTED':'')  +'>'+ a[k] +'</option>';
  return m;
}
function getFunctionName (func){
  var name=/\W*function\s+([\w\$]+)\(/.exec(func);
  if (!name)
    return '';
  return name[1];
}

function findAllBetween (txt, find1, find2){
  var m = [];
  var last = 0;
  while ( (i1=txt.indexOf(find1, last))>=0 && (i2=txt.indexOf (find2, i1))>=0 ) {
    m.push (txt.substring(i1+find1.length, i2));
    last = i2 + find2.length;
  }
  return m;
}

function strUpTo (s, find){
  var i = s.indexOf(find);
  if (i > 0)
    return s.substr(0, i);
  return s;
}

/********
 Xd Xh
 Xh Xm
 Xm Xs
 Xs
********/
function timestrShort(time) {
  time = parseInt (time);
  if (time > 86400){
    var m = [];
    time /= 3600;
    m.push (parseInt(time/24));
    m.push ('d ');
    m.push (parseInt(time%24));
    m.push ('h ');
    return m.join ('');    
  } else
    return timestr (time);
}

/**********************
 part       full
 Xd Xh Xm   Xd Xh Xm Xs
 Xh Xm      Xh Xm Xs
 Xm Xs      Xm Xs
 Xs         Xs
**********************/
function timestr(time, full) {
  time = parseInt (time);
  var m = [];
  var t = time;
  if (t < 61)
    return  t + 's';
  if (t > 86400){
    m.push (parseInt(t/86400));
    m.push ('d ');
    t %= 86400;
  }  
  if (t>3600 || time>3600){
    m.push (parseInt(t/3600));
    m.push ('h ');
    t %= 3600;
  }  
  m.push (parseInt(t/60));
  m.push ('m');
  if (full || time<=3600 ){
    m.push (' ');
    m.push (t%60);
    m.push ('s');  
  }
  return m.join ('');
}

/************  LIB singletons .... **************/
// TODO: fix REopening window
var WINLOG_MAX_ENTRIES = 1000;     // TODO
var WinLog = {
  state : null,
  win: null,
  eOut : null,
  lastE : null,
  enabled : true,
  reverse : true,
  busy : false,
isOpening : false,

  open : function (){
    var t = WinLog;

    function eventButClear(){
      var t = WinLog;
      t.lastE = null;
      t.eOut.innerHTML ='';
    }
    function eventButReverse(){
      var t = WinLog;
      if (t.busy)
        return;
      t.busy = true;
      if (t.reverse){
        t.win.document.getElementById('wlRev').value= 'Top';
        t.reverse = false;
      } else{
        t.win.document.getElementById('wlRev').value= 'Bottom';
        t.reverse = true;
      }
      var n = t.eOut.childNodes.length;
      if (n < 2)
        return;
      for (i=n-2; i>=0; i--){
        t.eOut.appendChild (t.eOut.childNodes[i]);
      }
      t.busy = false;
    }
    
    if (!t.win || t.win.closed){
t.isOpening = true;  
// Firefox bug??? It appears as if a new thread is started on open, withOUT reusing same window? huh?
      t.win = window.open('', 'unsafeWindowtrace', 'top=30,left=0,width=900,height=700,scrollbars=no,location=no,menubar=no,directories=no,status=no');
t.isOpening = false;
t.state = null;
    }
    
    if (t.state == null){
      t.win.document.body.innerHTML = '<STYLE>pre{margin:0px} hr{margin:3px; height:1px; border:0px; color:#cee; background-color:#cee}</style>\
        <BODY style="margin:0px; padding:0px; border:none">\
        <DIV id=winlogtop style="background-color:#d0d0d0; margin:0px; padding:0px; border:1px solid">\
        <INPUT id=wlClear type=submit class=pbButton value="Clear"> &nbsp; <INPUT id=wlRev type=submit class=pbButton value="Bottom"></div>\
        <DIV id=wlOut style="overflow-y:auto; height:100%; max-height:100%"></div></body>';
      t.win.document.getElementById('wlClear').addEventListener('click', eventButClear, false);
      t.win.document.getElementById('wlRev').addEventListener('click', eventButReverse, false);
      t.eOut =  t.win.document.getElementById('wlOut');
      t.lastE = null;
      t.state = 1;
    }
  },

  writeText : function (msg){
    var t = WinLog;
    if (!t.enabled || t.isOpening)
      return;
    t.write (msg.htmlSpecialChars());
  },
  
  write : function (msg){
    var t = WinLog;
    if (!t.enabled || t.isOpening)
      return;
    t.open();
    var te = document.createElement('pre');
    var now = new Date();
    var m = [];
    var millis = now.getMilliseconds();
    m.push (now.toTimeString().substring (0,8));
    m.push ('.');
    if (millis<100)
      m.push('0');
    if (millis<10)
      m.push('0');
    m.push(millis);
    m.push (': ');
    m.push (msg);
    te.innerHTML = m.join('');
    if (t.reverse){
      if (t.lastE == null){
        t.eOut.appendChild(te);
        t.lastE = te;
      } else {
        t.eOut.insertBefore(te, t.lastE);
      }
      var hr = document.createElement('hr');
      t.eOut.insertBefore(hr, te);
      t.lastE = hr;
    } else {
      t.eOut.appendChild(te);
      t.eOut.appendChild(document.createElement('hr'));
    }
  },

};

 
/*********************************** Resources TAB ***********************************/
/****
courtDoAction.php
&atype=4&toid=1290791&givercityid=26654
{"ok":true,"gold":500,"resource":500,"resourcetype":"4"}
***/
Tabs.Resources = {
  tabOrder : 100,
  resource : {1:'Food', 2:'Wood', 3:'Stone', 4:'Ore'},
  users : [],
  myDiv : null,
  doList : [], // list of gifts to accept
  accepting : false,
  city : null,
  total : {gold:0, 1:0, 2:0, 3:0, 4:0},
    
  init : function (div){
    var t = Tabs.Resources;
        t.myDiv = div;
    div.innerHTML = '<TABLE cellpadding=0 cellspacing=0 class=pbTab width=100%><TR><TD align=center><INPUT id="pballlist" type=submit class=pbButton value="Fetch User List" \></td></tr></table><HR>';
    div.innerHTML += '<DIV id=resDiv style="width:100%; min-height:300px; height:100%;">';
    document.getElementById('pballlist').addEventListener ('click', t.e_clickfetchlist, false);

  },
  
  show : function (){
  },
  hide : function (){
  },
  
  progress : function (msg, span, add){
    if(add)
        document.getElementById(span).innerHTML+=msg;
    else
        document.getElementById(span).innerHTML=msg;
  },

  e_clickfetchlist : function  (){     // (also cancel accepting)
    var t = Tabs.Resources;
    t.users = [];
    if (t.accepting){
      document.getElementById('pballlist').value = 'Fetch User List';
      document.getElementById('resDiv').innerHTML+= '<BR><SPAN class=boldRed>Cancelled.</span>';
      t.accepting = false;
      return;
    }
    document.getElementById('resDiv').innerHTML = 'Fetching user list ... <span id=pbResUserListCount></span>';
    
    t.fetchUserList (gotUserList);
    function gotUserList(userList){
        if(userList.length < 1){
            listGifts();
            return;
        }
        document.getElementById('resDiv').innerHTML += '<BR>Check if able to collect ... <span id=pbResUserAvailCount></span>';
        t.checkDailyAction(userList, listGifts);
    }
    
    function listGifts (){
      t.city = Cities.cities[0];
      var m = '<DIV class=pbStat><CENTER>User List &nbsp; &nbsp; &nbsp; ('+ t.users.length +' found)</center></div>';
      if (t.users.length<1){
        document.getElementById('resDiv').innerHTML = m + '<BR><BR><CENTER>No users found!</center>';
        return;
      }
      m += '<TABLE class=pbTab align=center><TR><TD align=right>City to apply gifts to: </td><TD id=pbrescityselspan></td></tr>\
          <TR><TD align=right>Select resource to collect</td><TD>'
        + htmlSelector (t.resource, Options.getResType, 'id=pbResColType')
        + '</td></tr><TR><TD>Select users you want to collect from and hit: </td><TD width=250><INPUT type=submit class=pbButton id=pbResDo value="Accept Resources">\
        &nbsp; <SPAN id=pbResNone class=boldRed></span></td></tr></table><HR><TABLE class=pbTab><TR valign=top><TD>\
        <INPUT id=pbResButAll type=submit class=pbButton value="All" style="width:100%; margin-bottom:5px"><BR><INPUT id=pbResButNone type=submit class=pbButton value="None"></td>\
        <TD width=10></td><TD><TABLE align=center cellpadding=0 cellspacing=0 class=pbTabLined>\
        <TBODY id=pbResTbody style="height:250px; overflow:auto; display:block;">\
        <TR style="font-weight:bold; background:white"><TD>Name</td><TD>Might</td><TD width=20></td></tr>';
      for (var i=0; i<t.users.length; i++){
        m += '<TR><TD><INPUT type=checkbox id=pbrchk_'+ i +'> &nbsp;'+ t.users[i].name +'</td><TD>'+ t.users[i].might +'</td></tr>';
      }
      document.getElementById('resDiv').innerHTML = m + '</tbody></table></td></tr></table>';
      new CdispCityPicker ('pbrescitysel', document.getElementById('pbrescityselspan'), true, t.e_CityButton, t.city.idx);
      document.getElementById('pbResDo').addEventListener ('click', t.getErDone, false);
      document.getElementById('pbResButAll').addEventListener ('click', t.e_butAll, false);
      document.getElementById('pbResButNone').addEventListener ('click', t.e_butNone, false);
      // var tbody = document.getElementById('pbResTbody');
      // tbodyScroller (tbody, getRemainingHeight (tbody, mainPop.div));
    }
  },

  e_CityButton : function (city, x, y){
    var t = Tabs.Resources;
    t.city = city;
  },
  
  e_butAll : function (){
    var t = Tabs.Resources;
    for (var i=0; i<t.users.length; i++)
      document.getElementById('pbrchk_'+i).checked = true;
  },
  
  e_butNone : function (){
    var t = Tabs.Resources;
    for (var i=0; i<t.users.length; i++)
      document.getElementById('pbrchk_'+i).checked = false;
  },
  
  getErDone : function (){
    var t = Tabs.Resources;
    t.doList = [];
    document.getElementById('pbResNone').innerHTML = '';
    Options.getResType = document.getElementById('pbResColType').value;
    t.total = {gold:0, 1:0, 2:0, 3:0, 4:0};
    for (var i=0; i<t.users.length; i++){
      if (document.getElementById('pbrchk_'+i).checked)
        t.doList.push (t.users[i]);
    }
    if (t.doList.length==0){
      document.getElementById('pbResNone').innerHTML = 'None Selected!';
      return;
    }
    t.accepting = true;
    document.getElementById('pballlist').value = 'Stop Accepting';
    document.getElementById('resDiv').innerHTML = '<DIV id=rsltDiv style="height:400px; max-height:400px; overflow-y:auto"><B>Accepting from '+ t.doList.length +' users:</b><BR></div>';    
    t.acceptNext ();
  },

    
  allDone : function (msg){
    var t = Tabs.Resources;
    msg += '<BR><BR> Total resources gained : <BR>\
           Gold: '+addCommas(t.total.gold)+'<BR>';
    for(var i=1; i<=4; i++){
        msg += t.resource[i]+': '+addCommas(t.total[i])+'<BR>';
    }
    document.getElementById('rsltDiv').innerHTML += '<BR><BR>' + msg;
    document.getElementById('pballlist').value = 'Fetch User List';
    t.accepting = false;
  },
  
    
  acceptNext : function (){
    var t = Tabs.Resources;
    var gift = t.doList.shift();
    if (gift == null){
      t.allDone ('Done accepting resources.');
      return;
    }
    var acpDiv = document.getElementById('rsltDiv');
    var curDiv = document.createElement ('div');
    acpDiv.appendChild (curDiv);
    curDiv.innerHTML = '<B>From '+ gift.name +': ';    
    var statSpan = document.createElement ('span');
    curDiv.appendChild (statSpan);
    statSpan.innerHTML = 'Accepting... ';
    t.getCourtAction (gift, gotGiftData);
        
    function gotGiftData (rslt){
//logit ("getErDone.gotGiftData ... \n"+ inspect (gift, 8, 1));
      if (!t.accepting)
        return;
      if (rslt.ok){
        var msg = rslt.gold +' gold and '+rslt.resource +' '+ t.resource[rslt.resourcetype]+'&nbsp; &nbsp; OK.';
        actionLog ('Accepted from '+gift.name+': '+ rslt.gold +' gold and '+ rslt.resource +' '+ t.resource[rslt.resourcetype]);
        statSpan.innerHTML += msg;
        t.total.gold += rslt.gold;
        t.total[rslt.resourcetype] += rslt.resource;
        t.acceptNext ();  
        return;
      }
        
      if (rslt.msg)
        msg = '<B>'+ rslt.msg + '</b>';
      else
        msg = '<SPAN class=boldRed>ERROR: '+ rslt.ajaxErr +'</span>';

      curDiv.removeChild (statSpan);
      curDiv = document.createElement ('div');
      curDiv.className = 'indent25';
      acpDiv.appendChild (curDiv);
      curDiv.innerHTML = msg;
      t.acceptNext ();  
    }
    
  },

  getMembersInfo : function (pageNo, notify) {
    var t = Tabs.Resources;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    
    params.pageNo = pageNo;
    
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/allianceGetMembersInfo.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        notify (rslt);
      },
      onFailure: function (rslt) {
        notify ({errMsg:'Ajax Comm Error'});
      },
    });
  },
  
  getDailyAction : function (uid, notify){
    var t = Tabs.Resources;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    
    params.pid = uid;
    
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/viewCourt.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        notify (rslt);
      },
      onFailure: function (rslt) {
        notify ({errMsg:'Ajax Comm Error'});
      },
    });
  },
  
  getCourtAction : function (gift, notify){
    var t = Tabs.Resources;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    
    params.atype = Options.getResType;
    params.toid = gift.userId;
    params.givercityid = t.city.id;
    
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/courtDoAction.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        notify (rslt);
      },
      onFailure: function (rslt) {
        notify ({errMsg:'Ajax Comm Error'});
      },
    });
  },
  
  checkDailyAction : function (userList, notify){
    var t = Tabs.Resources;
    var count = 0;
    t.getDailyAction(userList[count].userId, parseViewCourt);
    
    function parseViewCourt (rslt){
        if (!rslt.ok || rslt.errMsg)
            notify ({errMsg:'Ajax Comm Error'});
        if(rslt.dailyActionFlag == 0)
            t.users.push(userList[count]);
        t.progress(count, 'pbResUserAvailCount');
        count++;
        if(count < userList.length){
            t.getDailyAction(userList[count].userId, parseViewCourt);
        } else {
            notify();
        }
    }
  },
  
  // notify with gifts[] or: {errMsg:xxx}
  fetchUserList : function (notify){
    var t = Tabs.Resources;
    var userList = [];
    t.getMembersInfo(1, parseAlliancePage);
    
    function parseAlliancePage (rslt){
      if (!rslt.ok || rslt.errMsg)
        notify ({errMsg:'Ajax Comm Error'});
      var users = rslt.memberInfo;
      for(var k in users){
        userList.push({userId:users[k].userId, name:users[k].name, might:users[k].prestige, type:'alliance'});
      }
      t.progress(userList.length, 'pbResUserListCount');
      if(rslt.currentPage < rslt.noOfPages){
        t.getMembersInfo((rslt.currentPage+1), parseAlliancePage);
      } else {
        notify(userList);
      }
    }
    
    
  },
}



function addCommasWhole(nStr){
  nStr += '';
  x = nStr.split('.');
  x1 = x[0];
  x2 = x.length > 1 ? '.' + x[1] : '';
  var rgx = /(\d+)(\d{3})/;
  while (rgx.test(x1)) {
    x1 = x1.replace(rgx, '$1' + ',' + '$2');
  }
  return x1;
}

function encode_utf8( s ){
  return unescape( encodeURIComponent( s ) );
}

function decode_utf8( s ){
  return decodeURIComponent( escape( s ) );
}

function CdialogCancelContinue (msg, canNotify, contNotify, centerElement){
  var pop = new pbPopup ('ptcancont', 10, 10, 400,200, true, canNotify);
  if (centerElement)
    pop.centerMe(centerElement);
  else
    pop.centerMe(document.body);
  pop.getTopDiv().innerHTML = '<CENTER>KOC AIO Script</center>';
  pop.getMainDiv().innerHTML = '<TABLE class=pbTab align=center style="height: 100%"><TR align=center height=90%><TD>'+ msg +'</td></tr>\
      <TR align=center><TD><INPUT id=ptok type=submit class=pbButton value="OK" \> &nbsp; &nbsp; </td></tr></table>';
  document.getElementById('ptok').addEventListener ('click', function (){pop.destroy(false); if (canNotify) canNotify();}, false);
  pop.show(true);
}

function CdialogConfirm (msg, canNotify, contNotify, centerElement){
  var pop = new pbPopup ('ptcancont', 10, 10, 400,200, true, canNotify);
  if (centerElement)
    pop.centerMe(centerElement);
  else
    pop.centerMe(document.body);
  pop.getTopDiv().innerHTML = '<CENTER>KOC AIO Script</center>';
  pop.getMainDiv().innerHTML = '<TABLE class=pbTab align=center style="height: 100%"><TR align=center height=90%><TD colspan=2>'+ msg +'</td></tr>\
      <TR align=center><TD><INPUT id=pbok type=submit class=pbButton value="OK" \> &nbsp; &nbsp; </td><TD><INPUT id=pbcancel type=submit class=pbButton value="CANCEL" \> &nbsp; &nbsp; </td></tr></table>';
  document.getElementById('pbok').addEventListener ('click', function (){pop.destroy(false); if (canNotify) canNotify(this);}, false);
  document.getElementById('pbcancel').addEventListener ('click', function (){pop.destroy(false); if (canNotify) canNotify(this);}, false);
  pop.show(true);
}

function hexDump (dat){
  var i = 0;
  var s = [];
  while (i < dat.length) {
    asc = [];
    s.push (hex4(i));
    s.push (': ');
    for (var ii=0; ii<16; ii++) {
      c = dat.charCodeAt(i+ii);
      s.push (hex2(c));
      s.push (' ');
      if (c>31 && c<128)
        asc.push (dat.charAt(i+ii));
      else
        asc.push ('.');
    }
    s.push ('  ');
    s.push (asc.join(''))
    s.push ('\n');
    i += 16;
  }
  return s.join ('');
  function hex4(d){
    return hexDig(d>>12) + hexDig(d>>8) + hexDig(d>>4) + hexDig(d&15);
  }
  function hex2(d){
    return hexDig(d>>4) + hexDig(d&15);
  }
  function hexDig (d){
    hexdigs = '0123456789ABCDEF';
    return hexdigs.charAt(d&15);    
  }
}
 
// value is 0 to 1.0
function SliderBar (container, width, height, value, classPrefix, margin){
  var self = this;
  this.listener = null;
  if (value==null)
    value = 0;
  if (!margin)
    margin = parseInt(width*.05);
  this.value = value;
  if (width<20) width=20;
  if (height<5) height=5;
  if (classPrefix == null){
    classPrefix = 'slider';
    var noClass = true;
  }    
  var sliderHeight = parseInt(height/2);
  var sliderTop = parseInt(height/4);
  this.sliderWidth = width - (margin*2);
    
  this.div = document.createElement ('div');
  this.div.style.height = height +'px';
  this.div.style.width = width +'px';
  this.div.className = classPrefix +'Cont';
  if (noClass)
    this.div.style.backgroundColor='#ddd';
  
  this.slider = document.createElement ('div');
  this.slider.setAttribute ('style', 'position:relative;');
  this.slider.style.height = sliderHeight + 'px'
  this.slider.style.top = sliderTop + 'px';
  this.slider.style.width = this.sliderWidth +'px';
  this.slider.style.left = margin +'px';   /////
  this.slider.className = classPrefix +'Bar';
  this.slider.draggable = true;
  if (noClass)
    this.slider.style.backgroundColor='#fff';
  
  this.sliderL = document.createElement ('div');
  this.sliderL.setAttribute ('style', 'width:100px; height:100%; position:relative; ');
  this.sliderL.className = classPrefix +'Part';
  this.sliderL.draggable = true;
  if (noClass)
    this.sliderL.style.backgroundColor='#0c0';
  
  this.knob = document.createElement ('div');
  this.knob.setAttribute ('style', 'width:3px; position:relative; left:0px; background-color:#222');
  this.knob.style.height = height +'px';
  this.knob.style.top = (0-sliderTop) +'px';
  this.knob.className = classPrefix +'Knob';
  this.knob.draggable = true;
  this.slider.appendChild(this.sliderL);
  this.sliderL.appendChild (this.knob);
  this.div.appendChild (this.slider);
  container.appendChild (this.div);
  this.div.addEventListener('mousedown',  mouseDown, false);

  this.getValue = function (){
    return self.value;
  }

  this.setValue = function (val){   // todo: range check
    var relX = (val * self.sliderWidth);
    self.sliderL.style.width = relX + 'px';
    self.knob.style.left =  relX + 'px';
    self.value = val;
    if (self.listener)
      self.listener(self.value);
  }
  
  this.setChangeListener = function (listener){
    self.listener = listener;
  }

  function moveKnob (me){
    var relX = me.clientX - self.divLeft;
    if (relX < 0)
      relX = 0;
    if (relX > self.sliderWidth)
      relX = self.sliderWidth;
    self.knob.style.left = (relX - (self.knob.clientWidth/2) ) +'px';   // - half knob width !?!?
    self.sliderL.style.width = relX + 'px';
    self.value =  relX / self.sliderWidth; 
    if (self.listener)
      self.listener(self.value);
  }
  function doneMoving (){
    self.div.removeEventListener('mousemove', mouseMove, true);
    document.removeEventListener('mouseup', mouseUp, true);
  }
  function mouseUp (me){
    moveKnob (me);
    doneMoving();
  }
  
  function mouseDown(me){
    var e = self.slider;
    self.divLeft = 0;
    while (e.offsetParent){   // determine actual clientX
      self.divLeft += e.offsetLeft;
      e = e.offsetParent;
    }
    moveKnob (me);
    document.addEventListener('mouseup',  mouseUp, true);
    self.div.addEventListener('mousemove',  mouseMove, true);
  }
  function mouseMove(me){
    moveKnob (me);
  }
}

function pause(milliseconds) {
    var dt = new Date();
    while ((new Date()) - dt <= milliseconds) { /* Do nothing */ }
}

function CmatSimpleSound (playerUrl, container, attrs, onLoad, flashVars) {
  var self = this;
  this.player = null;
  this.volume = 100;
  this.isLoaded = false;
  this.onSwfLoaded = null;
  
  var div = document.createElement ('div');
  this.onSwfLoaded = onLoad;
  if (navigator.appName.toLowerCase().indexOf('microsoft')+1) {
    div.innerHTML = '<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0"><param name="movie" value="'+playerUrl+'"><param name="quality" value="high"></object>';
    this.player = div.getElementsByTagName('object')[0];
  } else {
    div.innerHTML = '<embed src="'+playerUrl+'"  bgcolor="#eeeeee" allowfullscreen=false FlashVars="'+ flashVars +'" quality="high" allowscriptaccess="always" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" ></embed>';
    this.player = div.getElementsByTagName('embed')[0].wrappedJSObject;
  }
  if (container)
    container.appendChild (div);
  else
    document.body.appendChild (div);
  for (k in attrs)
    this.player.setAttribute(k, attrs[k]);
       
  this.setVolume = function (chanNum, vol){
    if (!self.isLoaded)
      return;
    self.player.jsSetVolume (chanNum, vol);
    volume = vol;
  }
  
  this.load = function (chanNum, url, bStream, bAutoplay, bUsePolicyFile){   // loop ?
    self.player.jsLoad (chanNum, url, bStream, bAutoplay, bUsePolicyFile);
  }
  
  this.play = function (chanNum, position){
       if (this.isLoaded)
    self.player.jsPlay (chanNum, position);
  }
    
  this.stop = function (chanNum){
       if (this.isLoaded)
    self.player.jsStop (chanNum);
  }
    
  this.getStatus = function (chanNum){           // returns null if sound channel is 'empty'
   if (this.isLoaded)
    return self.player.jsGetStatus (chanNum);
  }
  
  this.debugFunc = function (msg){  // overload to use
  }
      
  this.swfDebug = function (msg){    // called by plugin
    self.debugFunc('SWF: '+ msg);
  }
  this.swfLoaded = function (){    // called by plugin when ready to go!
    self.isLoaded = true;
    self.debugFunc ('playerIsReady');
    if (self.onSwfLoaded)
      self.onSwfLoaded();
  }
  this.swfPlayComplete = function (chanNum){    // called by plugin when a sound finishes playing (overload to be notified)
  }
  this.swfLoadComplete = function (chanNum, isError){    // called by plugin when a sound finishes loading  (overload to be notified)
  }
}
    
function DoUnsafeWindow(func, execute_by_embed) {
    if(this.isChrome || execute_by_embed) {
        var scr=document.createElement('script');
        scr.innerHTML=func;
        document.body.appendChild(scr);
    } else {
        try {
            eval("unsafeWindow."+func);
        } catch (error) {
            logit("A javascript error has occurred when executing a function via DoUnsafeWindow. Error description: "+error.description);
        }
    }
}  

function GetDisplayName(){
    var DisplayName = document.getElementById('topnavDisplayName');
    if(DisplayName){
        DisplayName = DisplayName.innerHTML;
    }else{
        DisplayName = null;
    }
    return DisplayName
}

function DrawLevelIcons() {
	var maptileRe = /modal_maptile.([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+)/;
	var mapwindow=document.getElementById('mapwindow');
	if(!mapwindow) return;
	var levelIcons=document.getElementById('levelIcons');
	if(levelIcons) return;
	var ss=document.evaluate(".//a[contains(@class,'slot')]",mapwindow,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);
	var idDone=false;
	for(var s=0; s<ss.snapshotLength; s++) {
		var a=ss.snapshotItem(s);
		var onclick=a.getAttribute('id');
		var owner='';
		if(onclick) {
			var tileinfo = unsafeWindow.g_mapObject.model.getTileActions(onclick)["tileClick"];	
			if(tileinfo) {
				var might = tileinfo.might;
				if (might == "--------") might=0;
				var might = parseInt(might)/1000000;
				if (might > 1) might = Math.round(might);
				 else if (might>0) might = might.toFixed(2);
				var alliance = parseIntNan(tileinfo.allianceId);
				var dip = getDiplomacy(alliance);
				owner = tileinfo.username;
				if (owner.length>10) owner = owner.slice(0,10) + '...';
			}
		}
		var sp=a.getElementsByTagName('span');
		if(sp.length==0) continue;

		if(!idDone) { a.id='levelIcons'; idDone=true; }
		var LevelColor = 'black';
		var InfoColor = 'black';

		var Prestige = a.getAttribute('class')
		if (Prestige.indexOf('Prestige') >=0) LevelColor = "#689C00";
		if (Prestige.indexOf('Briton') >=0) LevelColor = "#A944DB";
		if (Prestige.indexOf('Fey') >=0) LevelColor = "#E36600";

		if (tileinfo.type=="city") {
			if (tileinfo.allianceId == null)  InfoColor = '#C4C4C4'; //sp[0].style.color='#57BEFF'; //City unallied -> grey
			if (tileinfo.allianceId != null)  InfoColor = '#F5AF36'; //sp[0].style.color='#FF57B6'; //City allied -> orange
			if (tileinfo.status !="Normal") LevelColor = "white";
		}

		if (tileinfo.type!="city") {				
			if (tileinfo.allianceId != null && tileinfo.tileuserid != null)  LevelColor = InfoColor = '#F5AF36'; //Wild owned allied -> orange
			if (tileinfo.allianceId == null && tileinfo.tileuserid != null && tileinfo.tileuserid != "0" && !tileinfo.mistedflag) LevelColor = InfoColor = '#C4C4C4'; //Wild owned unallied -> grey
			if (tileinfo.mistedflag) LevelColor = InfoColor = '#F5AF36'; //Wild owned misted -> grey
			if (tileinfo.allianceId == null && tileinfo.tileuserid == null && !tileinfo.mistedflag) LevelColor = InfoColor = '#000000	'; //Wild un-owned
		}

		var friendly = hostile = false;
		for (var i in Seed.allianceDiplomacies.friendly) if (Seed.allianceDiplomacies.friendly[i].allianceId == tileinfo.allianceId) friendly = true;
		if (Seed.allianceDiplomacies.allianceId == tileinfo.allianceId) friendly = true;
		for (var i in Seed.allianceDiplomacies.hostile) if (Seed.allianceDiplomacies.hostile[i].allianceId == tileinfo.allianceId) hostile = true;
		if (friendly) InfoColor = '#9ED2FF';
		if (hostile) InfoColor = '#FF5757'

		if (Options.MapShowExtra && unsafeWindow.tvuid!=tileinfo.tileuserid) {
			if (tileinfo.username!="null")
			sp[0].innerHTML = '<B><FONT color="'+LevelColor+'">' + tileinfo.level + '</b></font><FONT color="'+InfoColor+'"> ('+might+ 'M)<br />'+owner + '</font>';
			else
			sp[0].innerHTML = '<FONT color="'+LevelColor+'">' + tileinfo.level + '</font>';
		}
		else if (unsafeWindow.tvuid==tileinfo.tileuserid) {
			if (Prestige.indexOf('city') >=0) LevelColor = "white";
			sp[0].style.color=LevelColor;
		}
	}
}

function AjaxRequest2 (url, opts){
	RPM++;
    var headers = {
        'X-Requested-With': 'XMLHttpRequest',
        'X-Prototype-Version': '1.6.1',
        'Accept': 'text/javascript, text/html, application/xml, text/xml, */*'
    };
    var ajax = null; 
    if (window.XMLHttpRequest)
      ajax=new XMLHttpRequest();
    else
      ajax=new ActiveXObject("Microsoft.XMLHTTP"); 
    if (opts.method==null || opts.method=='')
      method = 'GET';
    else
      method = opts.method.toUpperCase();  
    if (method == 'POST'){
        headers['Content-type'] = 'application/x-www-form-urlencoded; charset=UTF-8';
    } else if (method == 'GET'){
        addUrlArgs (url, opts.parameters);
    }  
    ajax.onreadystatechange = function(){
        // ['Uninitialized', 'Loading', 'Loaded', 'Interactive', 'Complete']; states 0-4
        if (ajax.readyState==4) {
            if (ajax.status >= 200 && ajax.status < 305)
            if (opts.onSuccess) opts.onSuccess(ajax);
            else
                if (opts.onFailure) opts.onFailure(ajax);
            } else {
                if (opts.onChange) opts.onChange (ajax);
            }
    }  
    ajax.open(method, url, true); // always async!
    for (var k in headers)
      ajax.setRequestHeader (k, headers[k]);
     if (matTypeof(opts.requestHeaders)=='object')
          for (var k in opts.requestHeaders)
            ajax.setRequestHeader (k, opts.requestHeaders[k]);
    if (method == 'POST'){
        var a = [];
        for (k in opts.parameters){
              if(matTypeof(opts.parameters[k]) == 'object'){
                  for(var h in opts.parameters[k]){
                      if(matTypeof(opts.parameters[k][h]) == 'object'){
                          for(var i in opts.parameters[k][h]){
                              if(matTypeof(opts.parameters[k][h][i]) == 'object'){
                              for(var j in opts.parameters[k][h][i]){
                                  a.push (k+'['+h+']['+i+']['+j+'] ='+ opts.parameters[k][h][i][j] );
                              }
                              } else
                                  a.push (k+'['+h+']['+i+']'+' ='+ opts.parameters[k][h][i]);
                          }
                      } else
                      a.push (k+'['+h+'] ='+ opts.parameters[k][h] );
                  }
              } else
              a.push (k +'='+ opts.parameters[k] );
        }
        ajax.send (a.join ('&'));
    } else {
        ajax.send();
    }
}

function saveFarmOptions() {
    var serverID = getServerId();
    setTimeout(function () {
        GM_setValue('FarmOptions_' + serverID, JSON2.stringify(FarmOptions));
    }, 0);
}

function readFarmOptions() {
    var serverID = getServerId();
    s = GM_getValue('FarmOptions_' + serverID);
    if (s != null) {
        opts = JSON2.parse(s);
        for (k in opts) {
            if (matTypeof(opts[k]) == 'object') for (kk in opts[k])
            FarmOptions[k][kk] = opts[k][kk];
            else FarmOptions[k] = opts[k];
        }
    }
}

function saveThroneOptions() {
    var serverID = getServerId();
    setTimeout(function () {
        GM_setValue('ThroneOptions_' + serverID, JSON2.stringify(ThroneOptions));
    }, 0);
}

function readThroneOptions() {
    var serverID = getServerId();
    s = GM_getValue('ThroneOptions_' + serverID);
    if (s != null) {
        opts = JSON2.parse(s);
        for (k in opts) {
            if (matTypeof(opts[k]) == 'object') {
            	for (kk in opts[k]) if (ThroneOptions[k] != undefined) ThroneOptions[k][kk] = opts[k][kk];
            } else if (ThroneOptions[k] != undefined) ThroneOptions[k] = opts[k];
        }
    }
}
 
var DeleteReports = {
    deleting : false,
    init : function(){
        var t = DeleteReports;
    },
    
    startdeletereports : function(){
        var t = DeleteReports;
	      if(!t.deleting && (Options.DeleteMsg || Options.DeleteMsgs0 || Options.DeleteMsgs1 || Options.DeleteMsgs2 || Options.DeleteMsgs3 || Options.PlayerFilter.length>0)){
	          t.deleting = true;
	          t.fetchreport(0, t.checkreports);
	      }
    },
    
    fetchreport : function(pageNo, callback){
        var t = DeleteReports;
        var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
        if(pageNo > 1) params.pageNo = pageNo;
        
        new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/listReports.php" + unsafeWindow.g_ajaxsuffix, {
            method: "post",
            parameters: params,
            onSuccess: function (rslt) {
                callback(rslt);
            },
                onFailure: function () {
                callback();
            },
        });
    },
    
    checkreports : function(rslt){
        var t = DeleteReports;
        if(!rslt.ok){
            t.deleting = false;
            return;
        }
        if(rslt.arReports.length < 1){
        logit("CR stopped arreports < 1");
            t.deleting = false;
            return;
        }
        var reports = rslt.arReports;
        var totalPages = rslt.totalPages;
        if (rslt.totalPages > 30)
        var totalPages = 30;
        var deletes1 = new Array();
        var deletes0 = new Array();
        for(k in reports){
            if(Options.DeleteMsg){
                if((reports[k].marchType==4 || reports[k].marchType==9) && reports[k].side0PlayerId==0 && reports[k].side0TileType > 50)
                    deletes1.push(k.substr(2));
                else if(reports[k].marchType==1 && t.isMyself(reports[k].side1PlayerId))
                    deletes1.push(k.substr(2));
            }
            if (Options.DeleteMsgs0) if(reports[k].marchType==1 && !t.isMyself(reports[k].side1PlayerId)) deletes0.push(k.substr(2));   
            if (Options.DeleteMsgs1) if((reports[k].side0TileType <= 50 || reports[k].side0TileType==54)&& reports[k].side0PlayerId==0) deletes1.push(k.substr(2));                 
            if (Options.DeleteMsgs2){
            	for (var i=1;i<=Seed.cities.length;i++) {
			    	CityQueue = AtkOptions[i];
			    	for (var y=0;y<CityQueue.length;y++) {
			    		if (reports[k].side0XCoord == CityQueue[y].targetX && reports[k].side0YCoord == CityQueue[y].targetY  && t.isMyself(reports[k].side1PlayerId)) deletes1.push(k.substr(2));
			    	}
			    }
			    if (reports[k].side0XCoord == CrestOptions.X && reports[k].side0YCoord == CrestOptions.Y  && t.isMyself(reports[k].side1PlayerId)) deletes1.push(k.substr(2));
            }
            if (Options.DeleteMsgs3) if (reports[k].marchType == 10) deletes1.push(k.substr(2));
            if (FarmOptions.DeleteReports) {
            	for (i=1;i<=Seed.cities.length;i++){
                    var x=Seed.cities[i-1]["2"];
                    var y=Seed.cities[i-1]["3"];
                    if (Tabs.farm.FarmArray[i]) for (j=0;j<Tabs.farm.FarmArray[i].length;j++) if (reports[k].side1XCoord == x && reports[k].side1YCoord == y && reports[k].side0XCoord == Tabs.farm.FarmArray[i][j]["x"] && reports[k].side0YCoord == Tabs.farm.FarmArray[i][j]["y"]) deletes1.push(k.substr(2));
                	
            	}	    
            }
        }
        for (var i=0;i<Options.PlayerFilter.length;i++) if (Options.PlayerFilter[i]['uid']==reports[k].side1PlayerId) deletes1.push(k.substr(2));
        if(deletes1.length > 0 || deletes0.length > 0){
            t.deleteCheckedReports(deletes1, deletes0);
        } else {
            t.deleting = false;
            return;
        }
    },
    
    deleteCheckedReports : function(deletes1, deletes0){
        var t = DeleteReports;
        var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
        params.s1rids = deletes1.join(",");
        params.s0rids = deletes0.join(",");
        params.cityrids = '';
        
        new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/deleteCheckedReports.php" + unsafeWindow.g_ajaxsuffix, {
            method: "post",
            parameters: params,
            onSuccess: function (rslt) {
                if(rslt.ok){
                    Seed.newReportCount = parseInt(Seed.newReportCount) - parseInt(deletes1.length) - parseInt(deletes0.length);
                }
                t.fetchreport(0, t.checkreports);
            },
            onFailure: function () {
            },
        });
    },
    
    isMyself: function(userID){
        var t = DeleteReports;
        if(!Seed.players["u"+userID])
            return false;
        if(Seed.players["u"+userID].n == Seed.player.name)
            return true;
        else
            return false;
        return false;
    },
}

/******************* Apothecary Tab **********************/
Tabs.Apothecary = {
  tabOrder : 591,                    
  tabDisabled : false, 
  tabLabel : 'Apothecary',           
  cities : [],
  pop : null,
  pop2 : null,
  myDiv : null,
  timer : null,
  city : 0,
  
  init : function (div){
    var t = Tabs.Apothecary;
    t.myDiv = div;
    var n = '<DIV class=pbStat >APOTHECARY TAB</div><table width=100% height=0% class=pbTab><tr align=center >';
    n += '<td><input class="buttonDash_'+ (ApothecaryOptions.Active?'ON':'OFF') +'" type=submit id=pbapothecary_power value="Auto Heal = '+(ApothecaryOptions.Active?'ON':'OFF')+'" /></td></tr></table>';
    n += '<DIV class=pbStat >WOUNDED UNITS</div><DIV id= showTroops></div>';
    n += '<DIV class=pbStat >UNITS REVIVING</div><DIV id=showInfo></div>';
    div.innerHTML = n;
    document.getElementById('pbapothecary_power').addEventListener('click', function(){t.e_toggleswitch(this);},false);
    t.paintStats();
    t.loop();
  },

  paintStats : function (){
    var t = Tabs.Apothecary;
    var time = 0;
    var now = unixTime();
    var troop = 0;
    var amount = 0;

    var n='<TABLE class=pbTabOverview cellpadding=0 cellspacing=0><TR><TD style="background: #FFFFFF; vertical-align:top;"></td>';
    for(i=0; i<Cities.numCities; i++) n += "<TD width=81 style='background: #FFFFFF'><B>"+ Cities.cities[i].name.substring(0,11) +"</b></td>";
    n+="</tr>";
   	for(a=1;a<=15;a++) {
		n+='<TR><TD style="background: #FFFFFF; vertical-align:top;">'+ unsafeWindow.unitcost['unt'+a][0]+'</td>';
   	    for(b=0; b<Cities.numCities; b++) {
   	       	if (Seed.woundedUnits['city' + Seed.cities[b][0]]['unt'+a] > 0) n+= '<TD align=right >'+addCommas(Seed.woundedUnits['city' + Seed.cities[b][0]]['unt'+a])+'</td>';
   	        else n+='<TD></td>';
   	    }
   	}
   	n+='<TR><TD></td></table>';
    document.getElementById('showTroops').innerHTML = n;     
    var o = '<TABLE class=pbTabOverview cellpadding=0 cellspacing=0><TR><TD width="100px"></td><TD width="200px">Troops</td><TD width="150px">Time</td></tr>';
    for(b=0;b<Cities.numCities;b++) {
     	if (t.CheckApothecary(Seed.cities[b][0])) var color = "black";
     	else var color = "red";
     	o += '<TR><TD><FONT color='+ color+'>' + Seed.cities[b][1] +':</font></td>';
     	troop = 0;
     	amount = 0;
     	if (Seed.queue_revive['city' + Seed.cities[b][0]][0] != undefined) {
     		troop  = Seed.queue_revive['city' + Seed.cities[b][0]][0][0];
     		amount = Seed.queue_revive['city' + Seed.cities[b][0]][0][1];
     	}	
     	if (amount > 0 && troop > 0) o+= '<TD>' + amount + ' ' + troops[troop] + '</td>';
     	else o+='<TD>&nbsp</td>';
     	time = 0;
     	if (Seed.queue_revive['city' + Seed.cities[b][0]][0] != undefined) time = Seed.queue_revive['city' + Seed.cities[b][0]][0][3] - now;   	
     	if (time > 0) { 
     		o+= '<TD align=right >'+timestr(time) + ' ';	 
     		time = 0;
     		if (Seed.queue_revive['city' + Seed.cities[b][0]][0] != undefined) time = Seed.queue_revive['city' + Seed.cities[b][0]][0][3] - Seed.queue_revive['city' + Seed.cities[b][0]][0][2];
     		o+= '(' + timestr(time) + ')</td>';
     	} else o+='<TD>&nbsp</td>';

     	o += '<TD>&nbsp</td>';
    }   
    o+='</tr></table>';  
    document.getElementById('showInfo').innerHTML = o;    
  },

  CheckApothecary : function(cityId){
    var t = Tabs.Apothecary;
    var check = false;
    for (k in Seed.buildings['city' + cityId]) if (Seed.buildings['city' + cityId][k][0] == 21 || Seed.buildings['city' + cityId][k][0] == 23) check= true;	   
  	return check;
  },

  loop : function(){
    var t = Tabs.Apothecary;
    if(!ApothecaryOptions.Active) return;
    var now = unixTime();
    for(b=0;b<Cities.numCities;b++) {
    	if (Seed.queue_revive['city' + Seed.cities[b][0]][0] != undefined) if (now > Seed.queue_revive['city' + Seed.cities[b][0]][0][3]) Seed.queue_revive['city' + Seed.cities[b][0]].splice(0,1); 
     	if (t.CheckApothecary(Seed.cities[b][0]) &&  Seed.queue_revive['city' + Seed.cities[b][0]].length == 0)  for(a=1;a<=15;a++) if (Seed.woundedUnits['city' + Seed.cities[b][0]]['unt'+a] > 0) setTimeout(t.do_revive, (1000*(b+1)),Seed.cities[b][0],a,Seed.woundedUnits['city' + Seed.cities[b][0]]['unt'+a]);
	}    	
  },
  
  e_toggleswitch : function(obj){
    var t = Tabs.Apothecary;
    if(ApothecaryOptions.Active){
        if (document.getElementById('pbapothecary_power')) {document.getElementById('pbapothecary_power').value = "Auto Heal = OFF";document.getElementById('pbapothecary_power').setAttribute("class", "buttonDash_OFF");}
        if (document.getElementById('ApothecaryToggle')) {document.getElementById('ApothecaryToggle').value = "Auto Heal = OFF";document.getElementById('ApothecaryToggle').setAttribute("class", "buttonDash_OFF");}
        ApothecaryOptions.Active = false;
    } else {
        if (document.getElementById('pbapothecary_power')) {document.getElementById('pbapothecary_power').value = "Auto Heal = ON";document.getElementById('pbapothecary_power').setAttribute("class", "buttonDash_ON");}
        if (document.getElementById('ApothecaryToggle')) {document.getElementById('ApothecaryToggle').value = "Auto Heal = ON";document.getElementById('ApothecaryToggle').setAttribute("class", "buttonDash_ON");}
        ApothecaryOptions.Active = true;
    }
    saveApothecaryOptions();
  },

  do_revive : function(currentcityid,unitId,num){
    var t = Tabs.Apothecary;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.cid = currentcityid;
    params.type = unitId;
    params.apothecary = true;
    var time = unsafeWindow.cm.RevivalModel.getRevivalStats(unitId, num).time;
    if (time > 3600) params.quant =  Math.round(3600 / (time/num));
     else params.quant = num;
    time = unsafeWindow.cm.RevivalModel.getRevivalStats(unitId, params.quant).time;
    
    new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/train.php" + unsafeWindow.g_ajaxsuffix, {
        method: "post",
        parameters: params,
        onSuccess: function(transport) {
          var rslt=eval("("+transport.responseText+")");
          if (rslt.ok) {
            for (var i = 1; i < 5; i++) {
                var resourceLost = parseInt(unsafeWindow.unitcost["unt" + unitId][i]) * 3600 * parseInt(params.quant);
                if(rslt.gamble) resourceLost = resourceLost*rslt.gamble[i];
                Seed.resources["city" + params.cid]["rec" + i][0] = parseInt(Seed.resources["city" + params.cid]["rec" + i][0]) - resourceLost;
            }
            if (!rslt.initTS) rslt.initTS = unixTime() - 1;         
            Seed.queue_revive["city" + params.cid].push([unitId, params.quant, rslt.initTS, parseInt(rslt.initTS) + time, time, time, null]);        
  	        var cost = unsafeWindow.cm.RevivalModel.getRevivalStats(unitId, params.quant).cost;
            Seed.woundedUnits["city" + params.cid]["unt"+params.type]-= params.quant;
            Seed.citystats["city" + params.cid].gold[0] -= parseInt(cost);
            for (postcity in Seed.cities) if (Seed.cities[postcity][0] == params.cid) logcity = Seed.cities[postcity][1];
            actionLog('Revived: ' + params.quant + ' ' + troops[params.type]+ ' in ' + logcity);
            t.paintStats();
          }
        },
      onFailure: function () {}
    });
  },
  
  hide : function (){
    var t = Tabs.Apothecary;
    clearInterval(t.timer);
  },
  
  show : function (){
    var t = Tabs.Apothecary;
    t.timer = setInterval(t.paintStats,1000);
  },
}

/****************************  Population Control Tab  ******************************/
Tabs.popcontrol = {
  tabOrder : 850,
  tabDisabled : false,
  tabLabel : 'Pop Control',
  myDiv : null,
  timer : null,
  timer_del : null,
  timer_cycle : null,
	del_count : 0,
	cycle_running : false,
	busy : false,
	cycle_step : 0,

  logtable : null,
  logmaxEntries: 300,
  loglast99 : [],

  init : function (div)
  	{
		var t = Tabs.popcontrol;
		t.myDiv = div;
		var selbut=0;
		
		var m = '<DIV class=pbStat>Population Control</div>';

		m += '<table border=0 width="100%">';	
		m += '<tr align=center>';
		m += '<td align=left><input type=submit class=pbButton id=pophelp_button value="HELP!"></td>';
		m += '<td align=center>Pick City:<span id=popcity></span></td>';
		m += '<td align=center>Population Gain per cycle: <span id=poptab_cycle_pop></span></td>';
		m += '</tr>';
		m += '</table>';
		
		m += '<DIV class=pbStat>City Requirements:</div>';
		m += '<table border="0" width="100%">';		
		m += '<tr>';
		m += '<td>Current Food: &nbsp<span id=poptab_cur_food></span></td>';
		m += '<td>Current Wood: &nbsp<span id=poptab_cur_wood></span></td>';
		m += '<td>Current Ore: &nbsp&nbsp<span id=poptab_cur_ore></span></td>';
		m += '<td>Current MM: <span id=poptab_cur_mm></span></td>';
		m += '</tr>';
		m += '<tr>';
		m += '<td>Needed Food: &nbsp<span id=poptab_needed_food></span></td>';
		m += '<td>Needed Wood: &nbsp<span id=poptab_needed_wood></span></td>';
		m += '<td>Needed Ore: &nbsp&nbsp<span id=poptab_needed_ore></span></td>';
		m += '<td>Needed MM: <span id=poptab_needed_mm></span></td>';
		m += '</tr>';
		m += '</table>';

		m += '<DIV class=pbStat>City Status:</div>';
		m += '<table border="0" width="100%">';	
		m += '<tr align=center>';
		m += '<td>Maximum Idle Population: <span id=poptab_max_idle_pop></span></td>';
		m += '<td># Slots Used: <span id=poptab_slots_used></span><br></td>';
		m += '<td># of barracks: <span id=poptab_barracks></span></td>';
		//m += '<td> </td>';
		m += '</tr>';
		m += '<tr align=center>';
		m += '<td>Current Idle Population: <span id=poptab_cur_idle_pop></span></td>';
		m += '<td># Slots Free: <span id=poptab_slots_free></span></td>';
		m += '<td># of cottages: <span id=poptab_cottages></span></td>';
		//m += '<td> </td>';
		m += '</tr>';		
		m += '</table>';

		m += '<DIV class=pbStat>Commands:</div>';
		m += '<table border="0" width="100%">';	
		m += '<tr align=center>';
		m += '<td><input type="submit" id="poptab_dismiss_mm" value="Dismiss MM" disabled></td>';
		m += '<td><input type="submit" id="poptab_queue_st" value="Queue Supply Troops" disabled></td>';
		m += '<td><input type="submit" id="poptab_del_queues" value="Delete All Queues" disabled></td>';
		m += '<td><input type="submit" id="poptab_run_cycle" value="Run cycle" disabled></td>';
		//m += '<td><input type="submit" id="poptab_test" value="Test"></td>';
		m += '</tr>';		
		m += '</table>';
	
		m += '<DIV class=pbStat>Action Log:</div>';

		m += '<DIV style="height:250px; max-height:250px; overflow-y:auto">';
		m += '<TABLE cellpadding=0 cellspacing=0 id=poptab_log class=pbTabLined>';
		m += '<TR><TD></td><TD width=95%></td>';
		m += '</table></div>';

		t.myDiv.innerHTML = m;

		t.logtable = document.getElementById('poptab_log');  
		var a = JSON2.parse(GM_getValue ('poptab_log_'+getServerId(), '[]'));
		if (matTypeof(a) == 'array')
			{
			t.loglast99 = a;
			for (var i=0; i<t.loglast99.length; i++)		t.addlogrow (t.loglast99[i].msg, t.loglast99[i].ts);
			}
		window.addEventListener('unload', t.onUnload, false);

		t.tcp = new CdispCityPicker ('popcityselect', document.getElementById('popcity'), true, null, selbut);
		
		document.getElementById('pophelp_button').addEventListener		('click', function(){	t.helpPop(this);							} , false);
		document.getElementById('popcity').addEventListener						('click', function(){	t.show_city	(t.tcp.city.id);	} , false);
		document.getElementById('poptab_dismiss_mm').addEventListener	('click', function(){	t.dismiss_mm(t.tcp.city.id);	} , false);
		document.getElementById('poptab_queue_st').addEventListener		('click', function(){	t.queue_st	(t.tcp.city.id);	} , false);
		document.getElementById('poptab_del_queues').addEventListener	('click', function(){	t.del_queues_start(t.tcp.city.id);	} , false);
		document.getElementById('poptab_run_cycle').addEventListener	('click', function(){	t.run_cycle	(t.tcp.city.id);	} , false);
		//document.getElementById('poptab_test').addEventListener	('click', function(){	t.btest	();	} , false);
  
  	},

	disable_btns : function ()
		{
		var t = Tabs.popcontrol;
		t.busy = true;
		document.getElementById('poptab_del_queues'	).disabled = true;
		document.getElementById('poptab_queue_st').disabled = true;
		document.getElementById('poptab_dismiss_mm').disabled = true;
		document.getElementById('poptab_run_cycle').disabled = true; 
		},

	onUnload : function ()
		{
		var t = Tabs.popcontrol;
		GM_setValue ('poptab_log_'+getServerId(), JSON2.stringify(t.loglast99));
		},
    
	addlogrow : function (msg, ts)
		{
		var t = Tabs.popcontrol;
		if (t.logtable.rows.length >= t.maxEntries)	t.logtable.deleteRow(t.maxEntries-1);
		var row = t.logtable.insertRow(0);
		row.vAlign = 'top';
		row.insertCell(0).innerHTML = ts;
		row.insertCell(1).innerHTML = msg;
		},
  
	log : function (msg)
		{
		var t = Tabs.popcontrol;
		var ts = new Date().toTimeString().substring (0,8);
		for (postcity in Seed.cities) if (Seed.cities[postcity][0] == t.tcp.city.id) logcity = Seed.cities[postcity][1];
		msg = logcity + ": " + msg;
		t.addlogrow (msg, ts);
		while (t.loglast99.length >= 99)
		t.loglast99.shift();
		t.loglast99.push ({msg:msg, ts:ts});
		},

  hide : function (){         // called whenever the main window is hidden, or another tab is selected
    var t = Tabs.popcontrol;
    clearTimeout (t.timer);
  },
  
  show : function (){         // called whenever this tab is shown
    var t = Tabs.popcontrol;
    clearTimeout (t.timer);
    t.timer = setTimeout (t.show, 2000);
		t.show_city(t.tcp.city.id);
  },

	helpPop : function ()
		{
		var helpText = "";
		
		helpText += '<p>** This is a work in progress... If it gets stuck, refresh. By ADABman / Lurkin **';
		helpText += 'Probably a good idea to temporarily turn off auto transport, auto reassign, and auto train, when using this.';
		
		helpText += '<p>POPULATION CONTROL tab will help you convert your excess/useless millitiamen ';
		helpText += 'into massive amounts of idle population. Massive idle population is very useful ';
		helpText += 'to have before a might tournament starts, or if you want to do a massive siege ';
		helpText += 'build with a Merlins tutelage.';
		helpText += '</p>';
		
		helpText += '<p>The CITY REQUIREMENTS area displays the amount of resouces and Militiamen ';
		helpText += 'required for a \'full cycle\' of building massive idle population. If any of these ';
		helpText += 'requirements are not met, they will be displayed in red.';
		helpText += '</p>';
		
		helpText += '<p>The CITY STATUS area displays the maximum amount of population your cottages ';
		helpText += 'provide, and the current amount of idle population in your city. This area also ';
		helpText += 'shows the number of training queue slots total and in use.';
		helpText += '</p>';
		
		helpText += '<p>The COMMANDS area displays the buttons that automate this process:';
		helpText += '</p>';

		helpText += '<UL>';
		
		helpText += 'DISMISS MM BUTTON<BR><li>' + dismissBtn_help1 + '</li>';
		helpText += '<li>' + dismissBtn_help2 + '</li><BR>';
		
		helpText += 'QUEUE SUPPLY TROOP BUTTON<BR><li>' + queueBtn_help1 + '</li>';
		helpText += '<li>' + queueBtn_help2 + '</li><BR>';
		
		helpText += 'DELETE QUEUE BUTTON<BR><li>' + deleteBtn_help1 + '</li>';
		helpText += '<li>' + deleteBtn_help2 + '</li>';
		helpText += '<li>' + deleteBtn_help3 + '</li><BR>';
		
		helpText += 'RUN CYCLE BUTTON<BR><li>' + runcycleBtn_help1 + '</li>';
		helpText += '<li>' + runcycleBtn_help2 + '</li>';
		helpText += '<li>' + runcycleBtn_help3 + '</li><BR>';
	
		helpText += '</UL><BR>';
		
		//function CPopup (prefix, x, y, width, height, enableDrag, onClose)
		var pop = new pbPopup ('popcontrol_Help', 0, 0, 740, 600, true);
		pop.centerMe (mainPop.getMainDiv());  
		pop.getMainDiv().innerHTML = helpText;
		pop.getTopDiv().innerHTML = '<CENTER><B>AIO Script Help</b>:  Population Control</center>';
		pop.show (true);
		},

	show_city : function (cityId)
		{
		var t = Tabs.popcontrol;

		t.st_food = 50;
		t.st_wood = 150;
		//t.st_stone = 0;
		t.st_ore = 10;
		
		var green = '#03F003';
		var red =   '#F0303';

		t.max_idle_pop = (parseInt(Seed.citystats['city'+cityId].pop[1])).toFixed(0);
		t.cur_idle_pop = (parseInt(Seed.citystats['city'+cityId].pop[0])).toFixed(0);
		document.getElementById('poptab_max_idle_pop').innerHTML	= t.max_idle_pop;
		document.getElementById('poptab_cur_idle_pop').innerHTML	= t.cur_idle_pop;

		t.barracks = parseInt(getCityBuilding(cityId, 13).count);
		t.cottages = parseInt(getCityBuilding(cityId, 5).count);
		t.slots_used = parseInt(Seed.queue_unt['city'+cityId].length);
		t.slots_free = parseInt(t.barracks - t.slots_used);
		document.getElementById('poptab_barracks').innerHTML = t.barracks;
		document.getElementById('poptab_cottages').innerHTML = t.cottages;
		document.getElementById('poptab_slots_used').innerHTML = t.slots_used;
		document.getElementById('poptab_slots_free').innerHTML = t.slots_free;

		t.cycle_pop = (parseInt(t.barracks) * parseInt(t.max_idle_pop)) + (parseInt(t.max_idle_pop) * 2);
		document.getElementById('poptab_cycle_pop').innerHTML	= addCommas( t.cycle_pop / 2 );

		t.cur_food = parseInt(Seed.resources['city'+cityId].rec1[0]/3600);
		t.cur_wood = parseInt(Seed.resources['city'+cityId].rec2[0]/3600);
		//t.cur_stone = parseInt(Seed.resources['city'+cityId].rec3[0]/3600);
		t.cur_ore = parseInt(Seed.resources['city'+cityId].rec4[0]/3600);
		
		document.getElementById('poptab_cur_food').innerHTML = addCommas (t.cur_food);
		document.getElementById('poptab_cur_wood').innerHTML = addCommas (t.cur_wood);
		//document.getElementById('poptab_cur_stone').innerHTML = addCommas (t.cur_stone);
		document.getElementById('poptab_cur_ore').innerHTML = addCommas (t.cur_ore);
		
		t.needed_food = parseInt(t.cycle_pop) * parseInt(t.st_food);
		t.needed_wood = parseInt(t.cycle_pop) * parseInt(t.st_wood);
		//t.needed_stone = 0;//parseInt(t.cycle_pop) * parseInt(t.st_Stone);
		t.needed_ore = parseInt(t.cycle_pop) * parseInt(t.st_ore);
		
		document.getElementById('poptab_needed_food').innerHTML = addCommas (t.needed_food);
		document.getElementById('poptab_needed_wood').innerHTML = addCommas (t.needed_wood);
		//document.getElementById('poptab_needed_stone').innerHTML = addCommas (t.needed_stone);
		document.getElementById('poptab_needed_ore').innerHTML = addCommas (t.needed_ore);
		
		document.getElementById('poptab_needed_food').style.color = (t.needed_food  > t.cur_food?'red':'green');
		document.getElementById('poptab_cur_food').style.color = (t.needed_food  > t.cur_food?'red':'green');
		document.getElementById('poptab_needed_wood').style.color  = (t.needed_wood  > t.cur_wood?'red':'green');
		document.getElementById('poptab_cur_wood').style.color = (t.needed_wood  > t.cur_wood?'red':'green');
		//document.getElementById('poptab_needed_stone').style.color = (t.needed_stone > t.cur_stone?'red':'green');
		//document.getElementById('poptab_cur_stone').style.color = (t.needed_stone > t.cur_stone?'red':'green');
		document.getElementById('poptab_needed_ore').style.color = (t.needed_ore  > t.cur_ore?'red':'green');
		document.getElementById('poptab_cur_ore').style.color = (t.needed_ore  > t.cur_ore?'red':'green');

		t.needed_mm = t.cycle_pop;
		t.cur_mm = parseInt(Seed.units['city'+cityId]['unt2']);
		document.getElementById('poptab_needed_mm').innerHTML = addCommas(t.needed_mm);
		document.getElementById('poptab_cur_mm').innerHTML = addCommas(t.cur_mm);
		
		document.getElementById('poptab_needed_mm').style.color = (t.needed_mm  > t.cur_mm?'red':'green')
		document.getElementById('poptab_cur_mm').style.color = (t.needed_mm  > t.cur_mm?'red':'green')
		
		dismissBtn_help1 = "This button is used to quickly get your city to its maximum idle population allowed by dismissing just the right amount of militiamen.";
		dismissBtn_help2 = "This button will only light up when when your city is not at its maximum population, and then only if you have enough MM in your city to dismiss.";
		need_to_dismiss = parseInt(t.max_idle_pop - t.cur_idle_pop);
		dismissBtn = document.getElementById('poptab_dismiss_mm');
		if(parseInt(need_to_dismiss) > 0 && parseInt(need_to_dismiss) <= parseInt(t.cur_mm) && !t.busy && !t.cycle_running)
			{
			dismissBtn.disabled = false;
			dismissBtn.value = "Dismiss " + addCommas(need_to_dismiss) + " MM";
			}
		else
			{
			dismissBtn.disabled = true;
			dismissBtn.value = "Dismiss MM";
			}

		queueBtn_help1 = "This button is used to train all the idle population into Supply Troops.";
		queueBtn_help2 = "This button will only light up when your city is at full idle population, and then only if you have enough resources to train all those Supply Troops and at least 1 free training slot.";
		unitId = 1;	
		var res_ok = 0;
		for (var i = 1; i < 5; i++)
			{
			var res_need = parseInt(unsafeWindow.unitcost["unt" + unitId][i]) * 3600 * parseInt(t.cur_idle_pop);
			var res_have = parseInt(unsafeWindow.seed.resources["city" + cityId]["rec" + i][0]);
			if(parseInt(res_need) > parseInt(res_have))	{	res_ok++;	}
			}
		queueBtn = document.getElementById('poptab_queue_st');
		if(parseInt(t.slots_free) > 0 && parseInt(t.cur_idle_pop) >= parseInt(t.max_idle_pop) && parseInt(res_ok)==0 && !t.busy && !t.cycle_running)
			{
			queueBtn.disabled = false;
			queueBtn.value = "Queue " + addCommas(t.cur_idle_pop) + " Supply Troops";
			}
		else
			{
			queueBtn.disabled = true;
			queueBtn.value = "Queue Supply Troops";
			}

		deleteBtn_help1 = "This button is used to quickly delete all those queued up Supply Troops, returning 1/2 the used population (and resources?).";
		deleteBtn_help2 = "This button will only light up when there is at least 1 training queue slot used.";
		//deleteBtn_help3 = "** Due to a bug, you should refresh your game before using this button! **";
		deleteBtn_help3 = "If you have any problems with this button, refresh and try again.";
		deletebtn = document.getElementById('poptab_del_queues'	);
		if(Seed.queue_unt['city'+cityId].length > 0 && !t.busy && !t.cycle_running)
			{
			deletebtn.disabled = false;
			deletebtn.value = " Delete " + Seed.queue_unt['city'+cityId].length + " Queues";
			}
		else
			{
			deletebtn.disabled = true;
			deletebtn.value = "Delete All Queues";
			}

		runcycleBtn_help1 = "This button is used to automate the entire process of repeatedly dismissing Militiamen then queueing Supply Troops, and then finally delete all of those queues.";
		runcycleBtn_help2 = "This button will only light up when your city has the required amount of resources and Militiamen";
		//runcycleBtn_help3 = "------ This button is disabled for now. -----";
		runcycleBtn_help3 = "If the queue slots wont delete, refresh and hit the 'Delete All Queues' button.";
		res_ok = 0;
		t.cycle_pop_continue = (parseInt(t.slots_free) * parseInt(t.max_idle_pop)) + (parseInt(t.max_idle_pop) * 2);
		for (var i = 1; i < 5; i++)
			{
			var res_need = parseInt(unsafeWindow.unitcost["unt" + unitId][i]) * 3600 * parseInt(t.cycle_pop_continue);
			var res_have = parseInt(unsafeWindow.seed.resources["city" + cityId]["rec" + i][0]);
			if(parseInt(res_need) > parseInt(res_have))	{	res_ok++;	}
			}
		runcycleBtn = document.getElementById('poptab_run_cycle');
		//if(parseInt(t.cur_idle_pop) >= parseInt(t.max_idle_pop) && parseInt(res_ok)==0 && !t.busy && !t.cycle_running)
		t.needed_mm_continue = t.cycle_pop_continue;
		if(parseInt(t.needed_mm) <= parseInt(t.cur_mm) && parseInt(res_ok)==0 && !t.busy && !t.cycle_running)
			{
			runcycleBtn.disabled = false;
			}
		else
			{
			runcycleBtn.disabled = true; 
			}
		
		},

	run_cycle : function (cityId)
		{
		// Temp disable auto train for this city & auto reassign & auto transport & auto refresh
		// log all that
		
		var t = Tabs.popcontrol;
		clearTimeout (t.timer);
		clearTimeout (t.timer_cycle);
		t.disable_btns();
		if(!t.cycle_running)
			{
			t.log("Starting population build cycle. Population at start: " + t.cur_idle_pop);
			t.cycle_running = true;
			t.cycle_step = 1;
			}
		
		//t.actionlog("1");
		t.max_idle_pop = (parseInt(Seed.citystats['city'+cityId].pop[1])).toFixed(0);
		t.cur_idle_pop = (parseInt(Seed.citystats['city'+cityId].pop[0])).toFixed(0);
		//num = parseInt(t.max_idle_pop) - parseInt(t.cur_idle_pop);
		if(parseInt(t.cur_idle_pop) < parseInt(t.max_idle_pop))	// Need to Dismiss MM
			{
			if (t.cycle_running)	t.dismiss_mm(cityId);
			
			//t.actionlog("2");
			}
		else if(parseInt(t.slots_free) > 0 && parseInt(t.cur_idle_pop) >= parseInt(t.max_idle_pop)) // Need to queue supply troops
			{
			if (t.cycle_running)	t.queue_st(cityId);
			//t.actionlog("3");
			}
		else if(parseInt(t.slots_free) == 0)	// Delete all the queues
			{
			//t.actionlog("4");
			t.cycle_running = false;
			setTimeout(unsafeWindow.update_seed_ajax, 250);
			t.del_queues_start(t.tcp.city.id);
			t.timer = setTimeout (t.show, 1000);
			return;
			}
		else
			{
			t.log("Waiting...");	// Wait
			}
		//t.actionlog("5");
		setTimeout(unsafeWindow.update_seed_ajax, 250);
		t.timer_cycle = setTimeout (function() {t.run_cycle(cityId)}, 3000);
		},

	dismiss_mm : function (cityId)
		{
		var t = Tabs.popcontrol;
		t.disable_btns();
		
		unitId = 2;

		t.max_idle_pop = (parseInt(Seed.citystats['city'+cityId].pop[1])).toFixed(0);
		t.cur_idle_pop = (parseInt(Seed.citystats['city'+cityId].pop[0])).toFixed(0);
		num = parseInt(t.max_idle_pop) - parseInt(t.cur_idle_pop);
		//t.log(num);
		
		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		params.cid = cityId;
		params.type = unitId;
		params.quant = num;

		
		new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/dismissUnits.php" + unsafeWindow.g_ajaxsuffix,
			{
			method: "post",
			parameters: params,
			onSuccess: function(rslt)
				{
				if (rslt.ok) 
					{
 					//t.log("Dismissed "+ addCommas(num) +" "+ troops[unitId]);
					t.log("Dismissed "+ addCommas(num) +" Militiamen");
					Seed.units['city'+cityId]['unt'+unitId] -= num;
					if(rslt.updateSeed){unsafeWindow.update_seed(rslt.updateSeed)};
					//setTimeout(unsafeWindow.update_seed_ajax, 250);
					t.busy = false;
					t.show_city(cityId);
					
					// Dismiss gets back 1/2 res ?
					//for (var i = 1; i < 5; i++)
					//	{
					//	var resourceGain = parseInt(unsafeWindow.unitcost["unt" + unitId][i]) * 3600 * parseInt(num) / 2;
					//	unsafeWindow.seed.resources["city" + cityId]["rec" + i][0] = parseInt(unsafeWindow.seed.resources["city" + cityId]["rec" + i][0]) + resourceGain;
					//	}
					}
				else
					{
					//t.log("FAILED to dismiss "+ addCommas(num) +" "+ troops[unitId] + " :(");
					t.log("FAILED to dismiss "+ addCommas(num) +" Militiamen :(");
					t.busy = false;
					}
				},
			});		
		setTimeout(unsafeWindow.update_seed_ajax, 250);
		},

	queue_st : function (cityId)
		{
		var t = Tabs.popcontrol;
		t.disable_btns();

		unitId = 1;
		num = t.cur_idle_pop;
		//num = 15;
		
		var time = unsafeWindow.modal_barracks_traintime(unitId, num);
		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		params.cid = cityId;
		params.type = unitId;
		params.quant = num;
		params.gambleId = 0;

		
		new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/train.php" + unsafeWindow.g_ajaxsuffix,
			{
			method: "post",
			parameters: params,
			onSuccess: function(rslt)
				{
				if (rslt.ok) 
					{
					//t.log("Trained "+ addCommas(num) +" "+ troops[unitId]);
					t.log("Trained "+ addCommas(num) +" Supply Troops");
					if(rslt.updateSeed){unsafeWindow.update_seed(rslt.updateSeed)};
					for (var i = 1; i < 5; i++)
						{
						var resourceLost = parseInt(unsafeWindow.unitcost["unt" + unitId][i]) * 3600 * parseInt(num);
						if(rslt.gamble) resourceLost = resourceLost*rslt.gamble[i];
						unsafeWindow.seed.resources["city" + cityId]["rec" + i][0] = parseInt(unsafeWindow.seed.resources["city" + cityId]["rec" + i][0]) - resourceLost;
						}
					unsafeWindow.seed.citystats["city" + cityId].gold[0] = parseInt(unsafeWindow.seed.citystats["city" + cityId].gold[0]) - parseInt(unsafeWindow.unitcost["unt" + unitId][5]) * parseInt(num);
					unsafeWindow.seed.citystats["city" + cityId].pop[0] = parseInt(unsafeWindow.seed.citystats["city" + cityId].pop[0]) - parseInt(unsafeWindow.unitcost["unt" + unitId][6]) * parseInt(num);
					//unsafeWindow.seed.queue_unt["city" + cityId].push([unitId, num, rslt.initTS, parseInt(rslt.initTS) + time, 0, time, null]);
					unsafeWindow.seed.queue_unt["city" + cityId].push([unitId, num, rslt.initTS, parseInt(rslt.initTS) + time, 0, rslt.ticksNeeded, null]);
					t.busy = false;
					t.show_city(cityId);
					}
				else
					{
					//t.log("FAILED to train "+ addCommas(num) +" "+ troops[unitId] + " :(");
					t.log("FAILED to train "+ addCommas(num) +" Supply Troops :(");
					t.busy = false;
					}
				},
			});
		setTimeout(unsafeWindow.update_seed_ajax, 250);
		},


	del_queues_start : function (cityId)
		{
		var t = Tabs.popcontrol;
		t.disable_btns();

		t.del_count = Seed.queue_unt['city'+cityId].length;
		t.log("Attempting to delete " + t.del_count + " Queue slots...");
		t.del_queues(cityId);
		},

 	del_queues : function (cityId)
		{
		var t = Tabs.popcontrol;
		clearTimeout (t.timer_del);

		var q = Seed.queue_unt['city'+cityId];
		var qs = q.toString();

		if(q.length > 0 || t.del_count > 0)
			{
			t.del_count -= 1;
			typetrn =		q[0][0];
			numtrptrn =	q[0][1];
			trnTmp =		q[0][2];
			trnETA = 		q[0][3];
			trnNeeded =	q[0][5];
			trainingId = 0;

			t.delete_queue_slot(typetrn, numtrptrn, trnTmp, trnETA, trnNeeded, cityId, trainingId)
			t.delete_queue_slot(typetrn, numtrptrn, trnTmp, parseInt(trnETA)-1, trnNeeded, cityId, trainingId)	//?!
						}
		else
			{
			t.log("No more queue slots to delete.");
			t.del_count = 0;
			t.busy = false;
			return;
			}
		setTimeout(unsafeWindow.update_seed_ajax, 250);
		t.timer_del = setTimeout (function() {t.del_queues(cityId)}, 1500);
		},

	delete_queue_slot : function (typetrn, numtrptrn, trnTmp, trnETA, trnNeeded, cityId, trainingId)
		{
		var t = Tabs.popcontrol;
		var unsafeWindow = unsafeWindow;
		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		params.pf =0;
		params.requestType = "CANCEL_TRAINING";
		params.cityId = cityId;
		params.typetrn = typetrn;
		params.numtrptrn = numtrptrn;
		params.trnETA = trnETA;
		params.trnTmp = trnTmp;
		params.trnNeeded = trnNeeded;

		
		new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/cancelTraining.php" + unsafeWindow.g_ajaxsuffix,
			{
			method: "post",
			parameters: params,
			onSuccess: function (message)
				{
				var rslt=eval("("+message.responseText+")");
				if (rslt.ok)
					{
					t.log("Deleted queue of "+ addCommas(numtrptrn) +" "+ troops[typetrn]);
					if(rslt.updateSeed){unsafeWindow.update_seed(rslt.updateSeed)};
					var k=0;
					for(var j=0;j<Seed.queue_unt["city"+cityId].length;j++)
						{
						if(j>trainingId)
							{
							Seed.queue_unt["city"+cityId][j][2]=parseInt(rslt.dateTraining[k]["start"]);
							Seed.queue_unt["city"+cityId][j][3]=parseInt(rslt.dateTraining[k]["end"]);
							k++;
							}
						}
					Seed.queue_unt["city"+cityId].splice(trainingId,1);
					for(var i=1;i<5;i++)
						{
						var totalReturn=parseInt(unsafeWindow.unitcost["unt"+typetrn][i])*parseInt(numtrptrn)*3600/2;
						Seed.resources["city"+cityId]["rec"+i][0]=parseInt(Seed.resources["city"+cityId]["rec"+i][0])+totalReturn;
						}
					}
				else
					{
					}
				},
			onFailure: function ()
				{
				},
			});
		},


}

/***** Ascension Tab ******/
Tabs.ascension = {
    tabLabel: 'Ascension',
    tabOrder: 300,
    myDiv: null,

    init: function (div) {
        var t = Tabs.ascension;
        t.myDiv = div;
        var m = '<DIV id=pbAscensionMain></div><TABLE id=pbAscension><TR>';
        m += '<TD></td><TD>Percent</td><TD><CENTER>Menu</center></td><TD>Current Level</td><TD>Current Cost</td><TD>'+strButton20(translate('Building Values'), 'id=pbBuildingValues') +'</td><TR>';
        for (i = 0; i < Cities.cities.length; i++) {
            var cityPrestige = Seed.cityData.city[Cities.cities[i].id].cityValue;
            var cityPrestigeLevel = Seed.cityData.city[Cities.cities[i].id].prestigeInfo.prestigeLevel;
            var isPrestigeCity = Seed.cityData.city[Cities.cities[i].id].isPrestigeCity;
            var currentGemPrice = null;
            var fullPrestige = 1200;
            var progressWidth = parseInt(((cityPrestige / fullPrestige) * 100));
            if (progressWidth > 100) progressWidth = 100;
            var fullBarWidth = 378;
            var gemFullPrice = 1250;
            m += '<TR><TD>City ' + Cities.cities[i].name + ' - </td>';
            m += '<TR><TD background="https://koc-power-bot.googlecode.com/svn/trunk/progress_brown_bar.png" width=' + fullBarWidth + ' height=25">';
            m += '<DIV id=pbGreenBar_' + i + '></div></td><TD align=center><DIV id=pbProgPerc_' + i + '></div></td><TD><INPUT id=pbAscendBtn_' + Cities.cities[i].id + ' type=submit class=pbButton value="Ascend"></td><TD align=center><DIV id=pbCityPrestigeLevel_' + i + '></div></td><TD align=center><DIV id=pbGemCost_' + Cities.cities[i].id + '></div></td><TD align=center><CENTER><DIV id=pbAscCurMight_'+i+'></div></center></td>';
        }
        div.innerHTML = m;
        document.getElementById('pbBuildingValues').addEventListener('click', function(){t.paintHelp();});
    },
    paintHelp: function() {
    	var t = Tabs.ascension;
    	var helpText = translate("Ascension Building Values");
       	helpText += '<TABLE><TR><TD align=center>Building</td><TD align=center width=50>Lvl 1</td><TD align=center width=50>+1 Lvl</td></tr>';

       	helpText += '<TR><TD>Castle</td><TD><CENTER>10</center></td><TD><CENTER>+8</center></td></tr>';       	
       	helpText += '<TR><TD>Tavern</td><TD><CENTER>7</center></td><TD><CENTER>+6</center></td></tr>';
       	helpText += '<TR><TD>Knights Hall</td><TD><CENTER>7</center></td><TD><CENTER>+6</center></td></tr>';
       	helpText += '<TR><TD>Alchemy Lab</td><TD><CENTER>7</center></td><TD><CENTER>+6</center></td></tr>';
       	helpText += '<TR><TD>Rally Point</td><TD><CENTER>7</center></td><TD><CENTER>+6</center></td></tr>';
       	helpText += '<TR><TD>Wall</td><TD><CENTER>7</center></td><TD><CENTER>+6</center></td></tr>';
       	helpText += '<TR><TD>DRUID Barracks (field)</td><TD><CENTER>7</center></td><TD><CENTER>+6</center></td></tr>';
       	helpText += '<TR><TD>DRUID Apothecary (field)</td><TD><CENTER>6</center></td><TD><CENTER>+5</center></td></tr>';
       	helpText += '<TR><TD>Embassy</td><TD><CENTER>6</center></td><TD><CENTER>+5</center></td></tr>';
       	helpText += '<TR><TD>Market</td><TD><CENTER>6</center></td><TD><CENTER>+5</center></td></tr>';
       	helpText += '<TR><TD>Watch Tower</td><TD><CENTER>6</center></td><TD><CENTER>+5</center></td></tr>';
       	helpText += '<TR><TD>Spire</td><TD><CENTER>6</center></td><TD><CENTER>+5</center></td></tr>';
       	helpText += '<TR><TD>Apothecary</td><TD><CENTER>6</center></td><TD><CENTER>+5</center></td></tr>';
       	helpText += '<TR><TD>NORMAL Barracks</td><TD><CENTER>2</center></td><TD><CENTER>+2</center></td></tr>';
       	helpText += '<TR><TD>Cottage</td><TD><CENTER>2</center></td><TD><CENTER>+2</center></td></tr>';
       	helpText += '</table><TABLE>';
       	helpText += '<TR><TR><TD>These numbers are for every added level of a building. Whether you are building it to level 2 or level 10, it will only add this amount to the total, shown under this help button. Every buildings "might" value combines to give the total. Once it reaches 1200, you are at 100% and can level up again.</td></tr></tr>';
       	helpText += '</table>';

       	var pop = new pbPopup ('ascensionHelp', 0, 0, 400, 400, true);
       	pop.centerMe (mainPop.getMainDiv());  
       	pop.getMainDiv().innerHTML = helpText;
       	pop.getTopDiv().innerHTML = '<CENTER><B>AIO Script '+translate("Help")+': '+translate("Ascension")+'</b></center>';
       	pop.show (true);
    },
    paintTab: function () {
        for (i = 0; i < Cities.cities.length; i++) {
            var cityPrestige = Seed.cityData.city[Cities.cities[i].id].cityValue;
            var cityPrestigeLevel = Seed.cityData.city[Cities.cities[i].id].prestigeInfo.prestigeLevel;
            var isPrestigeCity = Seed.cityData.city[Cities.cities[i].id].isPrestigeCity;
            var currentGemPrice = null;
            var fullPrestige = 1200;
            var progressWidth = parseInt(((cityPrestige / fullPrestige) * 100));
            if (progressWidth > 100) progressWidth = 100;
            var fullBarWidth = 378;
            var gemFullPrice = 1250;
            m += '<TR><TD>City ' + Cities.cities[i].name + ' - </td>';
            m += '<TR><TD style="background:https://koc-power-bot.googlecode.com/svn/trunk/progress_brown_bar.png" width=100% height=25">';
            if (isPrestigeCity) {
                if (cityPrestigeLevel < 3) {
                    document.getElementById('pbGreenBar_' + i).innerHTML = '<img src="https://koc-power-bot.googlecode.com/svn/trunk/progress_green_bar.png" width=' + progressWidth + '% height=25>'
                    document.getElementById('pbProgPerc_' + i).innerHTML = progressWidth + '%';
                    document.getElementById('pbCityPrestigeLevel_' + i).innerHTML = cityPrestigeLevel + '/3';
                    document.getElementById('pbAscCurMight_'+i).innerHTML = cityPrestige + '/1200';
                } else {
                    document.getElementById('pbGreenBar_' + i).innerHTML = '<CENTER><B>C O M P L E T E &nbsp;&nbsp;&nbsp; (for now)</center>'
                    document.getElementById('pbProgPerc_' + i).innerHTML = 'N/A';
                    document.getElementById('pbCityPrestigeLevel_' + i).innerHTML = 'N/A';
                    document.getElementById('pbAscCurMight_' + i).innerHTML = 'N/A';
                }
                m += '<TR>';
            } else {
                document.getElementById('pbGreenBar_' + i).innerHTML = '<CENTER><B>C I T Y &nbsp;&nbsp;&nbsp; N O T  &nbsp;&nbsp;&nbsp; A S C E N D E D &nbsp;&nbsp;&nbsp; Y E T</center>'
                document.getElementById('pbProgPerc_' + i).innerHTML = '<CENTER>N/A</center>';
                document.getElementById('pbCityPrestigeLevel_' + i).innerHTML = '<CENTER>0/3</center>';
                document.getElementById('pbAscCurMight_' + i).innerHTML = 'N/A';
            }
        }
    },
    clickCitySelect: function (city) {
        var t = Tabs.ascension;
        t.selectedCity = city;
        t.JumpCity(city);
        unsafeWindow.cm.PrestigeManagerController.open()
    },
    JumpCity: function (city) {
        var t = Tabs.ascension;
        for (i = 0; i < Seed.cities.length; i++) {
            if (Seed.cities[i][0] == city) var cityNum = i;
        }
        cityNum++;
        var obj = document.getElementById('citysel_' + cityNum);
        return t.ClickWin(window, obj, 'click');
    },
    ClickWin: function (win, obj, evtName) {
        var evt = win.document.createEvent("MouseEvents");
        evt.initMouseEvent(evtName, true, true, win, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
        return !obj.dispatchEvent(evt);
    },
    getGemCost: function (cityId, callback) {
        var t = Tabs.ascension;
        var isPrestigeCity = Seed.cityData.city[cityId].isPrestigeCity;
        var cityPrestigeLevel = Seed.cityData.city[Cities.cities[i].id].prestigeInfo.prestigeLevel;
        if (isPrestigeCity && cityPrestigeLevel < 3) {
            var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
            params.cid = cityId;
            params.prestigeType = 1;
             
            new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getPrestigeCost.php" + unsafeWindow.g_ajaxsuffix, {
                method: "post",
                parameters: params,
                onSuccess: function (rslt) {
                    if (rslt.ok) {
                        callback(cityId, rslt.cost, rslt.original_cost)
                    }
                }
            });
        } else {
            callback(cityId, null, null)
        }
    },
    show: function () {
        var t = Tabs.ascension;
        t.Timer = setInterval(t.paintTab, 1000)
        for (i = 0; i < Cities.cities.length; i++) {
            document.getElementById('pbAscendBtn_' + Cities.cities[i].id).addEventListener('click', function () {
                var t = Tabs.ascension
                var what = this.id.substr(12); // strip first 12 char's -> pbAscendBtn_
                t.clickCitySelect(what);
            });
            var isPrestigeCity = Seed.cityData.city[Cities.cities[i].id].isPrestigeCity;
            if (isPrestigeCity) {
                t.getGemCost(Cities.cities[i].id, function (cid, cost, origCost) {
                    if (cost < 0 || cost == null || origCost == null) {
                        document.getElementById('pbGemCost_' + cid).innerHTML = '<CENTER>Max</center>';
                    } else {
                        document.getElementById('pbGemCost_' + cid).innerHTML = '<CENTER>' + cost + '/' + origCost + '</center>';
                    }
                })
            } else {
                document.getElementById('pbGemCost_' + Cities.cities[i].id).innerHTML = '<CENTER>Not Ascended</center>';
            }
        }
    },
    hide: function () {
        var t = Tabs.ascension;
        clearInterval(t.Timer)
    },
}

/**************************** TurboSearch Tab ****************************************/
Tabs.TurboSearch = {
myDiv: null,
tileTypes:{0:"Bog",10:"Grassland",11:"Lake",20:"Woods",30:"Hills",40:"Mountain",50:"Plain",51:"City",52:"Ruin",53:"Misted City",54:"Dark Forest"},
rankings:{},
provinces:{	101:{x:0,y:0},102:{x:150,y:0},103:{x:300,y:0},104:{x:450,y:0},105:{x:600,y:0},
			106:{x:0,y:150},107:{x:150,y:150},108:{x:300,y:150},109:{x:450,y:150},110:{x:600,y:150},
			111:{x:0,y:300},112:{x:150,y:300},113:{x:450,y:300},114:{x:600,y:300},
			115:{x:0,y:450},116:{x:150,y:450},117:{x:300,y:450},118:{x:450,y:450},119:{x:600,y:450},
			120:{x:0,y:600},121:{x:150,y:600},122:{x:300,y:600},123:{x:450,y:600},124:{x:600,y:600},
},
data:null,
userInfo:null,
allianceNames:null,
data:[],

	init: function(div){
		var t = Tabs.TurboSearch;
		t.myDiv = div;
		unsafeWindow.pbExportToRaid = t.ExportToRaid;

		var m = '<DIV class=pbStat>Turbo Search</div>';
		m+= '<BR><B>Search from: </b><SPAN id=TScityPick></span>&nbsp&nbsp&nbspX:&nbsp<INPUT id=TSfromX maxlength=3 type=text>&nbsp&nbsp&nbspY:&nbsp<INPUT id=TSfromY maxlength=3 type=text>';
		m+= '&nbsp&nbsp&nbsp&nbsp&nbsp&nbspSearch:&nbsp<select id=TSselectRadius>';
		for (var i=5;i<=45;i+=5) m+='<option value='+i+'>'+i+' Blocks</option>';
		m+='<option value='+null+'>--------------</option>';
		for (var i=1;i<=24;i++) m+='<option value='+(100+i)+'>'+unsafeWindow.provincenames['p'+i]+'</option>';
		m+= '</select>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<INPUT id=TSsearchButton type=submit class=pbButton value="Start Search">';
		m+= '<BR><BR><DIV class=pbStat><TABLE class=pbTab width=350px align=center><TR><TD>Search Results</td><TD><INPUT id=TSscoutButton type=submit class=pbButton value="Scout"></td><TD><INPUT id=TSShowMisted type=submit class=pbButton value="Show misted"></td></tr></table></div>';
		m+= '<TABLE id=TSleftMain width=100% class=pbTab><TD style="vertical-align:top;"><DIV style="width:150px;max-width:150px;overflow:auto;" id=TSleft></div></td><TD style="text-align:left;vertical-align:top;"><DIV style="max-width:700px;height:450px;max-height:450px;overflow:auto"id=TSright></div></td></table>';

		t.myDiv.innerHTML = m;
		
		t.from = new CdispCityPicker ('pbSearchPicker', document.getElementById ('TScityPick'), true, t.citySelNotify,0);
		t.from.bindToXYboxes(document.getElementById ('TSfromX'), document.getElementById ('TSfromY'));
		document.getElementById('TSselectRadius').value = 10;
		document.getElementById('TSsearchButton').addEventListener ('click', function (){
			var Radius = document.getElementById('TSselectRadius').value;
			if (Radius=="null") return;
			if (document.getElementById('TSfromX').value==""  && document.getElementById('TSfromY').value== "") {alert("Please select a city or enter coords.");return;}
			document.getElementById('TSsearchButton').disabled = true;
			document.getElementById('TSsearchButton').value = "Searching";
      		if (Radius<100){
      			var blocks = MakeBlocks(parseInt(document.getElementById('TSfromX').value), parseInt(document.getElementById('TSfromY').value), parseInt(document.getElementById('TSselectRadius').value));	
      			t.doSearch(blocks, parseInt(document.getElementById('TSfromX').value), parseInt(document.getElementById('TSfromY').value), t.searchDone);	
      		} 
      		if (Radius>100) {
      			var ProvinceBlocks={1:[],2:[],3:[],4:[],5:[],6:[],7:[],8:[],9:[],10:[],11:[],12:[],13:[],14:[],15:[],16:[],17:[],18:[],19:[],20:[],21:[],22:[],23:[],24:[],25:[]};
      			for (var i=1;i<=25;i++) {
      				if (i>=1 && i<=5) {var x=t.provinces[Radius].x+((i-1)*30);var y=t.provinces[Radius].y;}
      				if (i>=6 && i<=10) {var x=t.provinces[Radius].x+((i-6)*30);var y=t.provinces[Radius].y+30;}
      				if (i>=11 && i<=15) {var x=t.provinces[Radius].x+((i-11)*30);var y=t.provinces[Radius].y+60;}
      				if (i>=16 && i<=20) {var x=t.provinces[Radius].x+((i-16)*30);var y=t.provinces[Radius].y+90;}
      				if (i>=21 && i<=25) {var x=t.provinces[Radius].x+((i-21)*30);var y=t.provinces[Radius].y+120;}
      				ProvinceBlocks[i]=(MakeProvinceBlocks(x,y));
      			}
      			t.data = new Array(); 
      			t.userInfo = {};
      			t.allianceNames = {};	
      			t.ProvinceSearch(ProvinceBlocks, parseInt(document.getElementById('TSfromX').value), parseInt(document.getElementById('TSfromY').value), 1);	
      		}
      	}, false);
      	document.getElementById('TSscoutButton').addEventListener ('click', function (){
      		var list =[];
      		var element_class = document.getElementsByClassName('TSscout');
    		for (k=0;k<element_class.length;k++) if (element_class[k].checked) list.push(element_class[k].id);
    		t.doAddScout(list);
      	}, false);
      	document.getElementById('TSShowMisted').addEventListener ('click', function (){
      		var TodoList = new Array();
			for (var z=0;z<t.data.length;z++) if (t.data[z].mapDat.cityName=="???") TodoList.push({x:t.data[z].mapDat.xCoord,y:t.data[z].mapDat.yCoord});
			t.CheckMistedCities(TodoList);
      	}, false);

      	/*document.getElementById('TSAddButton').addEventListener ('click', function (){
      		var list =[];
      		var element_class = document.getElementsByClassName('TSscout');
    		for (k=0;k<element_class.length;k++) if (element_class[k].checked) list.push(element_class[k].id);
    		t.doAddAttack(list);
      	}, false);*/
	},

	CheckCityMarches:function(cityID){
		var Counter=0;
		if (Seed.queue_atkp['city'+ cityID] != undefined) {
			for (atkp in Seed.queue_atkp['city'+ cityID]) if (Seed.queue_atkp['city'+ cityID][atkp]["marchUnixTime"]) Counter++;
		} else Counter=0;
		return Counter;
	},

	CheckMistedCities:function(list){
		var t = Tabs.TurboSearch;
		document.getElementById('TSright').innerHTML = "";
		var m='This function was made because Kabam needs to fix this bug, it has been around for ages.<BR>';
		m+='If you (just like me) don\'t like this exploit, please report it at: <a href="https://kabam.secure.force.com/PKB/pkb_contactUs?game=All&lang=en_US&l=en_US" target="_blank">This link</a><BR><BR>';
		m+="<TABLE width=450px class=pbTab><TR><TD><B>Coord</b></td><TD><B>Player Name</b></td><TD><B>City Name</b></td></tr>";
		for (var i=0;i<list.length;i++)m+='<TR><TD>'+coordLink(list[i].x,list[i].y)+'</td><TD><DIV id="TSmistPlayer_'+list[i].x+'_'+list[i].y+'"></div></td><TD><SPAN id="TSmistCity_'+list[i].x+'_'+list[i].y+'"></span></td></tr>';
		m+='</table>'
		document.getElementById('TSright').innerHTML = m;
		t.FetchTileID(0,list.length,list)
	},

	FetchTileID:function(number,total,list){
		var t = Tabs.TurboSearch;
		if (number==total) return;
		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    	params.blocks = "bl_" + list[number].x + "_bt_" + list[number].y;
    	 
	    new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/fetchMapTiles.php" + unsafeWindow.g_ajaxsuffix, {
      		method: "post",
      		parameters: params,
      		onSuccess: function (transport) {
      			var rslt = eval("(" + transport.responseText + ")");
        		if (rslt.ok) {
        			for (var i in rslt.data) if(parseInt(rslt.data[i].xCoord)==list[number].x && parseInt(rslt.data[i].yCoord)==list[number].y) var tileId=parseInt(rslt.data[i].tileId)
        			t.SetBookmark(number,total,list,tileId);
        		}
      		},
    	});
	},

	SetBookmark:function(number,total,list,tileId){
		var t = Tabs.TurboSearch;
		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		params.requestType="BOOKMARK_LOCATION";
		params.tileId=tileId;
    	params.bookmarkName = "Misted_City";
    	 
	    new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/tileBookmark.php" + unsafeWindow.g_ajaxsuffix, {
      		method: "post",
      		parameters: params,
      		onSuccess: function (transport) {
      			var rslt = eval("(" + transport.responseText + ")");
        		if (rslt.ok) t.GetBookmarkInfo(number,total,list);	
      		},
    	});
	},

	GetBookmarkInfo:function(number,total,list){
		var t = Tabs.TurboSearch;
		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		params.requestType="GET_BOOKMARK_INFO";
    	 
	    new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/tileBookmark.php" + unsafeWindow.g_ajaxsuffix, {
      		method: "post",
      		parameters: params,
      		onSuccess: function (transport) {
      			var rslt = eval("(" + transport.responseText + ")");
        		if (rslt.ok) {
        			for (var i in rslt.bookmarkInfo) if (parseInt(rslt.bookmarkInfo[i].xCoord)==list[number].x && parseInt(rslt.bookmarkInfo[i].yCoord)==list[number].y) {
        				document.getElementById('TSmistPlayer_'+list[number].x+'_'+list[number].y).innerHTML = rslt.bookmarkInfo[i].userName;
        				document.getElementById('TSmistCity_'+list[number].x+'_'+list[number].y).innerHTML = rslt.bookmarkInfo[i].cityName;
        			}
        			number++;
        			setTimeout(t.FetchTileID,750,number,total,list);
        			t.RemoveBookMark(number,list,rslt.bookmarkInfo[i].bookmarkId);
        		}
      		},
    	});
	},

	RemoveBookMark:function(number,list,bookmarkId){
		var t = Tabs.TurboSearch;
		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		params.requestType="REMOVE_BOOKMARK";
		params.bookmarkId=bookmarkId;
    	 
	    new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/tileBookmark.php" + unsafeWindow.g_ajaxsuffix, {
      		method: "post",
      		parameters: params,
      		onSuccess: function (transport) {
      			var rslt = eval("(" + transport.responseText + ")");
        		if (rslt.ok) {
        		}
      		},
    	});
	},

	doAddAttack : function (list){
	  	var t = Tabs.TurboSearch;
	  	for (var k=0;k<list.length;k++){		
	  		var coords = list[k].substr(14);
	  		var array = coords.split(',');
		  	if (array[0] != undefined && array[1] != undefined){
	  			var x = array[0];
	  			var y = array[1];
		  	}
	  	}
  	},

  	GetCoords : function (){
	    var t= Tabs.transport;
	    var targetName = "";
	    var targetCityName = "";
	    var total=0;
	    var units = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
	    targetX = parseInt(document.getElementById ('ptcityX').value);
	    targetY = parseInt(document.getElementById ('ptcityY').value);
	    if (targetX =="" || targetY=="") {alert("Please enter coords...");return;}
	    var what = document.getElementById('TransportTroop').value;
	    what = what.substr(3);
	    if (parseInt(document.getElementById('TroopsToSend')) == 0) {alert("You got to send a least one troop...");return;}
	    units[what] = parseInt(document.getElementById('TroopsToSend').value);	

	    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    	params.blocks = "bl_" + targetX + "_bt_" + targetY;
    	 
	    new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/fetchMapTiles.php" + unsafeWindow.g_ajaxsuffix, {
      		method: "post",
      		parameters: params,
      		onSuccess: function (transport) {
      			var rslt = eval("(" + transport.responseText + ")");
        		if (rslt.ok) {
        			if (rslt.data["l_"+targetX+"_t_"+targetY].tileType == 51) {
        				userId = rslt.data["l_"+targetX+"_t_"+targetY].tileUserId;
        				if (userId != null) targetName = rslt.userInfo["u" + userId]["n"];
        				targetCityName = rslt.data["l_"+targetX+"_t_"+targetY].cityName;
        			}
        			MarchOptions.Queue.push ({
        				city: 			t.tcp.city.id,
        				action: 		1,
        				targetX: 		targetX,
        				targetY: 		targetY,
        				tileType: 		rslt.data["l_"+targetX+"_t_"+targetY].tileType,
        				tileLevel: 		rslt.data["l_"+targetX+"_t_"+targetY].tileLevel,
        				targetCityName: targetCityName,
        				targetName: 	targetName,
        				cityNumber: 	rslt.data["l_"+targetX+"_t_"+targetY].cityNum,
        				1: 				units[1],
        				2: 				units[2],
        				3: 				units[3],
        				4: 				units[4],
        				5: 				units[5],
        				6: 				units[6],
        				7: 				units[7],
        				8: 				units[8],
        				9: 				units[9],
        				10: 			units[10],
        				11: 			units[11],
        				12: 			units[12],
        				13: 			units[13],
        				14: 			units[14],
        				15: 			units[15],
        				r1: 			parseInt(document.getElementById ('pbtradeamountFood').value),
        				r2: 			parseInt(document.getElementById ('pbtradeamountWood').value),
        				r3: 			parseInt(document.getElementById ('pbtradeamountStone').value),
        				r4: 			parseInt(document.getElementById ('pbtradeamountOre').value),
        				r5: 			parseInt(document.getElementById ('pbtradeamountAstone').value),
        				gold: 			parseInt(document.getElementById ('pbtradeamountGold').value)
        			});
					saveMarchOptions();
					document.getElementById('TroopsToSend').value = 0;
					document.getElementById ('pbtradeamountFood').value == 0;
				    document.getElementById ('pbtradeamountWood').value == 0;
				    document.getElementById ('pbtradeamountStone').value == 0;
				    document.getElementById ('pbtradeamountOre').value == 0;
				    document.getElementById ('pbtradeamountAstone').value == 0;
				    document.getElementById ('pbtradeamountGold').value == 0;
					Dashboard.ShowMarches();
        		}
      		},
    	});
		
	},

	doAddScout : function (list){
	  	var t = Tabs.TurboSearch;
	  	var count = -1;
	  	var city="";
	  	slots = t.CheckCityMarches(t.from.city.id);
		rallypointlevel = getRallypoint(t.from.city.id);
	  	for (var k=0;k<list.length;k++){		
	  		var coords = list[k].substr(14);
	  		var array = coords.split(',');
	  		if (array[0] != undefined && array[1] != undefined){
	  			var x = array[0];
	  			var y = array[1];
		  		count++;
	  			setTimeout(t.doScout,1500*count, x,y,list[k]);
	  		}
	  	}
  	},

  	doScout : function (x,y,box) {
  	var t = Tabs.TurboSearch;
	  	var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		params.cid= t.from.city.id;
	    params.type = 3
	    params.kid = 0
	    params.xcoord = x;
	    params.ycoord = y;
	  	params.u3 = 1;
	  	params.gold = 0;
	  	params.r1 = 0;
	  	params.r2 = 0;
	  	params.r3 = 0;
	  	params.r4 = 0;
	  	params.r5 = 0;
	  	 
		new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/march.php" + unsafeWindow.g_ajaxsuffix, {
			    method: "post",
			    parameters: params,
			    loading: true,
			    onSuccess: function (rslt) {
			        var t = Tabs.AllianceList;  
			        if (rslt.ok) {
			        	var timediff = parseInt(rslt.eta) - parseInt(rslt.initTS);
				        var ut = unsafeWindow.unixtime();
				        var unitsarr=[0,0,0,0,0,0,0,0,0,0,0,0,0];
				        for(i = 0; i <= unitsarr.length; i++){
				           	if(params["u"+i]){
				             	unitsarr[i] = params["u"+i];
				           	}
				        }
				        var resources=new Array();
				        resources[0] = params.gold;
				        for(i=1; i<=4; i++){
				           	resources[i] = params["r"+i];
				        }
				        var currentcityid =  params.cid;
				        unsafeWindow.attach_addoutgoingmarch(rslt.marchId, rslt.marchUnixTime, ut + timediff, params.xcoord, params.ycoord, unitsarr, params.type, params.kid, resources, rslt.tileId, rslt.tileType, rslt.tileLevel, currentcityid, true);
				        unsafeWindow.update_seed(rslt.updateSeed)
				        if(rslt.updateSeed){unsafeWindow.update_seed(rslt.updateSeed)};
				        document.getElementById(box).checked = false;        
			        }
			    }, 
			    onFailure: function () {},
		});
  	},

	searchDone: function(data, userInfo, allianceNames, fromX, fromY, ProvinceSearch){
		var t = Tabs.TurboSearch;
		var dist = 0;
		mapDat = [];
		for (var i in data) {
			dist_i = distance(fromX, fromY, data[i].xCoord, data[i].yCoord)
			mapDat.push({
				xCoord: 		data[i].xCoord,
				yCoord: 		data[i].yCoord,
				dist: 			dist_i,
				tileType: 		data[i].tileType,
				tileLevel: 		data[i].tileLevel,
				tileUserId: 	data[i].tileUserId,
				cityName: 		data[i].cityName,
				tileCityId: 	data[i].tileCityId,
				cityNum:  		data[i].cityNum,
			});
		}
    	mapDat = mapDat.sort(function sort(a,b) {a = a['dist'];b = b['dist'];return a == b ? 0 : (a < b ? -1 : 1);});	
    	var checked = ((ProvinceSearch)?"unchecked":"checked");		
		var left = '<BR><input id=RadioCities type="radio" name="TStypes" value="Cities">Cities';
		left += '<BR><input id=RadioBarb type="radio" name="TStypes" value="Barb Camps">Barb Camps';
		left += '<BR><input id=RadioWild type="radio" name="TStypes" value="Wilderness">Wilderness:';
		left += '<BR>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<select id=TSwildType>';
		left += '<option value=ALL>ALL</option><option value=99>Grass./Lake</option><option value=20>Woodland</option><option value=30>Hills</option><option value=40>Mountain</option><option value=50>Plain</option><option value=54>Dark Forest</option></select>';
		left += '<BR>___________________<BR>';
		left += '<INPUT type=checkbox id=TSunowned checked=true><SPAN id=DIVunowned></span>';
		left += '<BR><SPAN id=DIVminLevel></span><select id=TSminLevel>';
		for (var i=1;i<=10;i++) left+='<option value='+i+'>'+i+'</option>';
        left += '</select><BR><SPAN id=DIVmaxLevel></span><select id=TSmaxLevel>';
		for (var i=1;i<=10;i++) left+='<option value='+i+'>'+i+'</option>';
		left += '</select>';	
		left += '<BR>___________________<BR>';
		left += '<INPUT type=checkbox id=TSallied checked=true><SPAN id=DIVallied></span>';		
		left += '<BR>&nbsp&nbsp&nbsp&nbsp<INPUT type=checkbox id=TSmisted checked=true><SPAN id=DIVmisted></span>';
		left += '<BR>&nbsp&nbsp&nbsp&nbsp<INPUT type=checkbox id=TShostile '+checked+'><SPAN id=DIVhostile></span>';
		left += '<BR>&nbsp&nbsp&nbsp&nbsp<INPUT type=checkbox id=TSfriendly '+checked+'><SPAN id=DIVfriendly></span>';
		left += '<BR>&nbsp&nbsp&nbsp&nbsp<INPUT type=checkbox id=TSfriendlyToUs '+checked+'><SPAN id=DIVfriendlyToUs></span>';
		left += '<BR>&nbsp&nbsp&nbsp&nbsp<INPUT type=checkbox id=TSneutral '+checked+'><SPAN id=DIVneutral></span>';
		left += '<BR><INPUT type=checkbox id=TSunAllied '+checked+'><SPAN id=DIVunAllied></span>';
		left += '<BR><BR><SPAN id=DIVmight></span>';
		left += '<BR><SPAN id=DIVmightMin></span><INPUT id=TSmightMin size=4 maxlength=4 type=text value='+parseInt(Options.SearchMightMin)+'>';
		left += '<BR><SPAN id=DIVmightMax></span><INPUT id=TSmightMax size=4 maxlength=4 type=text value='+parseInt(Options.SearchMightMax)+'>';
		
		left += '<BR><BR><INPUT type=checkbox id=TSfilerTop disabled=true unchecked=true><SPAN id=DIVfilterTop></span>';
		left += '<BR>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<select id=TStopMin>';
		for (var i=1;i<=19;i++) left+='<option value='+i+'>'+i+'</option><';
		left += '</select>&nbsp&nbsp<SPAN id=DIVtop></span>&nbsp&nbsp<select id=TStopMax>';
		for (var i=2;i<=20;i++) left+='<option value='+i+'>'+i+'</option>';
		left += '</select>';	

		document.getElementById('TSleft').innerHTML = left;
      	document.getElementById('TSsearchButton').value = "Start Search";
      	document.getElementById('TSsearchButton').disabled = false;
      	document.getElementById('TSminLevel').addEventListener ('change', function (){
      		Options.srcMinLevel = document.getElementById('TSminLevel').value;
      		saveOptions();
      		t.checkData(mapDat, userInfo, allianceNames, fromX, fromY);
      	}, false);
      	document.getElementById('TSmaxLevel').addEventListener ('change', function (){
      		Options.srcMaxLevel = document.getElementById('TSmaxLevel').value;
      		saveOptions();
      		t.checkData(mapDat, userInfo, allianceNames, fromX, fromY);
      	}, false);
      	document.getElementById('TSmightMin').addEventListener ('change', function (){
      		Options.SearchMightMin = document.getElementById('TSmightMin').value;
      		saveOptions();
      		t.checkData(mapDat, userInfo, allianceNames, fromX, fromY);
      	}, false);
      	document.getElementById('TSmightMax').addEventListener ('change', function (){
      		Options.SearchMightMax = document.getElementById('TSmightMax').value;
      		saveOptions();
      		t.checkData(mapDat, userInfo, allianceNames, fromX, fromY);
      	}, false);
      	document.getElementById('TSfilerTop').addEventListener ('change', function (){
      		if (document.getElementById('TSfilerTop').disabled) {
      			document.getElementById('TStopMin').disabled = true;
				document.getElementById('TStopMax').disabled = true;
				document.getElementById('DIVfilterTop').innerHTML = '<FONT color=grey>Filter alliances Rank:</font>';
				document.getElementById('DIVtop').innerHTML = '<FONT color=grey>to</font>';
      		} else {
      			document.getElementById('TStopMin').disabled = false;
				document.getElementById('TStopMax').disabled = false;
				document.getElementById('DIVfilterTop').innerHTML = '<FONT color=black>Filter alliances Rank:</font>';
				document.getElementById('DIVtop').innerHTML = '<FONT color=black>to</font>';
      		}
      		t.checkData(mapDat, userInfo, allianceNames, fromX, fromY);
      	}, false);

      	document.getElementById('RadioCities').addEventListener ('click', function (){t.checkData(mapDat, userInfo, allianceNames, fromX, fromY);}, false);
      	document.getElementById('RadioBarb').addEventListener ('click', function (){t.checkData(mapDat, userInfo, allianceNames, fromX, fromY);}, false);
      	document.getElementById('RadioWild').addEventListener ('click', function (){t.checkData(mapDat, userInfo, allianceNames, fromX, fromY);}, false);
      	document.getElementById('TSwildType').addEventListener ('change', function (){t.checkData(mapDat, userInfo, allianceNames, fromX, fromY);}, false);
      	document.getElementById('TSunowned').addEventListener ('click', function (){t.checkData(mapDat, userInfo, allianceNames, fromX, fromY);}, false);
      	document.getElementById('TSmisted').addEventListener ('click', function (){t.checkData(mapDat, userInfo, allianceNames, fromX, fromY);}, false);
      	document.getElementById('TShostile').addEventListener ('click', function (){t.checkData(mapDat, userInfo, allianceNames, fromX, fromY);}, false);
      	document.getElementById('TSfriendly').addEventListener ('click', function (){t.checkData(mapDat, userInfo, allianceNames, fromX, fromY);}, false);
      	document.getElementById('TSfriendlyToUs').addEventListener ('click', function (){t.checkData(mapDat, userInfo, allianceNames, fromX, fromY);}, false);
      	document.getElementById('TSneutral').addEventListener ('click', function (){t.checkData(mapDat, userInfo, allianceNames, fromX, fromY);}, false);
      	document.getElementById('TSallied').addEventListener ('click', function (){t.checkData(mapDat, userInfo, allianceNames, fromX, fromY);}, false);
      	document.getElementById('TSunAllied').addEventListener ('click', function (){t.checkData(mapDat, userInfo, allianceNames, fromX, fromY);}, false);
      	document.getElementById('TStopMin').addEventListener ('change', function (){t.checkData(mapDat, userInfo, allianceNames, fromX, fromY);}, false);
      	document.getElementById('TStopMax').addEventListener ('change', function (){t.checkData(mapDat, userInfo, allianceNames, fromX, fromY);}, false);
      	document.getElementById('RadioCities').checked = true;
      	document.getElementById('TSminLevel').value = Options.srcMinLevel;
      	document.getElementById('TSmaxLevel').value = Options.srcMaxLevel;
      	document.getElementById('TStopMin').value = 1;
      	document.getElementById('TStopMax').value = 10;
      	t.checkData(mapDat, userInfo, allianceNames, fromX, fromY)      	
	},

	checkData: function(mapDat, userInfo, allianceNames, fromX, fromY){
		var t = Tabs.TurboSearch;
		t.checkOptions();
		t.data=new Array();
		var Dip = Seed.allianceDiplomacies;
		var data = "<TABLE id=dbMain width=100% class=pbTab>";
		data += '<TR><TD><INPUT id=CheckAll type=checkbox unchecked=true></td><TD><B>Coords</b></td><TD><B>Dist</b></td><TD><B>Type (#)</b></td><TD><B>Lvl</b></td><TD><B>Might</b></td><TD>&nbsp</td><TD><B>Player</b></td><TD><B>Name</b></td><TD><B>Alliance</b></td></tr>';
      	var LastX=0;
      	var LastY=0;
      	for (var i in mapDat) {
      		if (mapDat[i].xCoord != undefined) {
      			var tileType = parseInt(mapDat[i].tileType);
      			if (document.getElementById('RadioCities').checked) {
      				if ((tileType == 51 || tileType== 53) && mapDat[i].tileCityId != null ) {
	      				var allianceID = 0;
	      				if (userInfo['u'+mapDat[i].tileUserId]) allianceID = parseInt(userInfo['u'+mapDat[i].tileUserId]["a"]);
	      				var diplomacy = 0;
	      				var Might = 0;
	      				if (userInfo['u'+mapDat[i].tileUserId]) Might = Math.round(userInfo['u'+mapDat[i].tileUserId]["m"]);
	      				var misted, hostile, friendly, friendlyToUs,neutral, allied, mightCheck, A_check;
	      				misted = hostile =  friendly = friendlyToUs = neutral = allied = mightCheck = A_check = false;
	      				var top = true;
	      				if (Dip.friendly && Dip.friendly['a'+allianceID]) diplomacy = 1;
		  				if (Dip.hostile && Dip.hostile['a'+allianceID]) diplomacy = 2;
		  				if (Dip.friendlyToYou && Dip.friendlyToYou['a'+allianceID]) diplomacy = 3;
		  				if (Dip.allianceId == allianceID) diplomacy = 1;
		  				if (allianceID > 0 || tileType== 53) allied =true;
		  				if (Might >= (Options.SearchMightMin*1000000) && Might <= (Options.SearchMightMax* 1000000)) mightCheck =true;
						if (document.getElementById('TSallied').checked && allied) A_check = true;
	      				 else if (document.getElementById('TSallied').checked && allied) A_check = false;
	      				if (document.getElementById('TSunAllied').checked && !allied) A_check = true;
	      				 else if (document.getElementById('TSunAllied').checked && !allied) A_check = false;
		  				if (document.getElementById('TSmisted').checked && tileType== 53) misted = true;
	      				 else if (document.getElementById('TSmisted').checked && tileType==51) misted = false;
	      				if (document.getElementById('TShostile').checked && diplomacy==2) hostile = true;
	      				 else if (document.getElementById('TShostile').checked && tileType==2) hostile = false;
	      				if (document.getElementById('TSfriendly').checked && diplomacy==1) friendly = true;
	      				 else if (document.getElementById('TSfriendly').checked && tileType==1) friendly = false;
	      				if (document.getElementById('TSfriendlyToUs').checked && diplomacy==3) friendlyToUs = true;
	      				 else if (document.getElementById('TSfriendlyToUs').checked && tileType==3) friendlyToUs = false;
	      				if (document.getElementById('TSneutral').checked && diplomacy==0) neutral = true;
	      				 else if (document.getElementById('TSneutral').checked && tileType==0) neutral = false;
	      				if (!allied) neutral = true;
	      				if (misted) mightCheck = true;
	      				if (document.getElementById('TSfilerTop').checked && t.rankings[allianceID] >= document.getElementById('TStopMin').value && t.rankings[allianceID] <= document.getElementById('TStopMax').value) top = false;
	      				var unique = true;
	      				if (parseInt(mapDat[i].xCoord)==LastX && parseInt(mapDat[i].yCoord)==LastY) unique=false;
      				 	LastX = parseInt(mapDat[i].xCoord);
      					LastY = parseInt(mapDat[i].yCoord);
	      				if ((misted || hostile || friendly || friendlyToUs ||  neutral) && A_check && mightCheck && top && unique) data += t.paintData(mapDat[i], userInfo, allianceNames, fromX, fromY);	
	      			}
      			}
      			if (document.getElementById('RadioBarb').checked) {
      				if (tileType == 51 && mapDat[i].tileCityId == null && parseInt(mapDat[i].tileLevel)>=Options.srcMinLevel && parseInt(mapDat[i].tileLevel)<=Options.srcMaxLevel) data += t.paintData(mapDat[i], userInfo, allianceNames, fromX, fromY);
      			}
      			if (document.getElementById('RadioWild').checked && tileType != 51 && tileType != 53) {
      				if (document.getElementById('TSunowned').checked && mapDat[i].tileCityId == null) var unownedOnly = true;
      				 else if (document.getElementById('TSunowned').checked) var unownedOnly = false;
      				  else var unownedOnly = true;
      				var filter = document.getElementById('TSwildType').value;
      				if ((tileType==10 || tileType==11) && filter==99) if (unownedOnly && parseInt(mapDat[i].tileLevel)>=Options.srcMinLevel && parseInt(mapDat[i].tileLevel)<=Options.srcMaxLevel)	data += t.paintData(mapDat[i], userInfo, allianceNames, fromX, fromY);
      				if (tileType == filter && unownedOnly && parseInt(mapDat[i].tileLevel)>=Options.srcMinLevel && parseInt(mapDat[i].tileLevel)<=Options.srcMaxLevel)	data += t.paintData(mapDat[i], userInfo, allianceNames, fromX, fromY);
					if (filter == "ALL" && unownedOnly && parseInt(mapDat[i].tileLevel)>=Options.srcMinLevel && parseInt(mapDat[i].tileLevel)<=Options.srcMaxLevel)	data += t.paintData(mapDat[i], userInfo, allianceNames, fromX, fromY);
      			}  

   	      	}
      	}
      	document.getElementById('TSright').innerHTML = data;
      	document.getElementById('CheckAll').addEventListener ('change', t.doSelectall, false);
      	var uList = [];
	    for(k in mapDat) if(mapDat[k].tileUserId != null) uList.push(mapDat[k].tileUserId);
	    t.fetchPlayerStatus(uList);
	},

	doSelectall : function (){
   		var t = Tabs.TurboSearch;
  		var element_class = document.getElementsByClassName('TSscout');
		for (k=0;k<element_class.length;k++) ((element_class[k].checked)?element_class[k].checked=false:element_class[k].checked=true)
  	},

	paintData: function(mapDat, userInfo, allianceNames, fromX, fromY){
  		var t = Tabs.TurboSearch;
   		var Dip = Seed.allianceDiplomacies;
   		t.data.push({mapDat:mapDat})
   		//Checkbox
   		data = '<TR><TD><INPUT class=TSscout id=ScoutCheckbox_'+mapDat.xCoord+","+mapDat.yCoord+' type=checkbox unchecked=true></td>'; 
   		//Coords
   		data+= '<TD>'+coordLink(mapDat.xCoord,mapDat.yCoord)+'</td>';
  		//Distance
  		data+= '<TD>'+mapDat.dist+'</td>';
  		//Tile Type
  		var tileType = parseInt(mapDat.tileType);
  		if (tileType == 51 && mapDat.tileCityId == null) tileType = 'Barb Camp';
  		 else tileType = t.tileTypes[parseInt(mapDat.tileType)];
  		data+= '<TD>'+tileType;
  		if (parseInt(mapDat.tileType) == 51 && mapDat.tileCityId != null) data += ' (' + mapDat.cityNum+ ')'; 
  		data+= '</td>';
  		//Tile Level
  		if (mapDat.tileLevel > 0) data+= '<TD>'+mapDat.tileLevel+'</td>';
  		else data+= '<TD>??</td>';	
  		//Might
  		if (mapDat.tileUserId != null && mapDat.tileUserId != 0) data+= '<TD align=right>'+addCommas(Math.round(parseInt(userInfo['u'+mapDat.tileUserId]["m"])))+'</td>';
  		  else data+= '<TD></td>';
  		//Space
  		data+='<TD>&nbsp</td>';
  		//Player
  		if (mapDat.tileUserId != null && mapDat.tileUserId != 0) data+= '<TD><SPAN class="DIVonline_'+mapDat.tileUserId+'"></span>'+userInfo['u'+mapDat.tileUserId]["n"]+'</td>';
  		 else if (mapDat.tileUserId == 0) data+= '<TD>???</td>';
  		  else data+= '<TD>---</td>';
  		//City Name
  		if (mapDat.cityName != null) data+= '<TD>'+mapDat.cityName+'</td>';
  		else if (mapDat.tileUserId == 0) data+= '<TD>???</td>';
  		 else data+= '<TD>---</td>';
  		//Alliance Name
  		if (mapDat.tileUserId != null && mapDat.tileUserId != 0) {
  			var allianceID = userInfo['u'+mapDat.tileUserId]["a"];
  			if (allianceID != 0) {
  				var color = "black";
  				if (Dip.friendly && Dip.friendly['a'+allianceID]) color = "green";
  				if (Dip.hostile && Dip.hostile['a'+allianceID]) color = "red";
  				if (Dip.friendlyToYou && Dip.friendlyToYou['a'+allianceID]) color = "orange";
  				if (Dip.allianceId == allianceID) color = "blue";
  				data+= '<TD><FONT color='+color+'>'+allianceNames['a'+allianceID]+'</font></td>'; 
  			} else data+= '<TD>---</td>'; 
  		} else if (mapDat.tileUserId == 0) data+= '<TD>???</td>';
  		   else if (parseInt(mapDat.tileType) == 51 && mapDat.tileCityId == null) data+='<TD><A onclick="pbExportToRaid('+ mapDat.xCoord +','+ mapDat.yCoord +')">Export</td>';
  		  	else data+= '<TD>---</td>';	
      	return data;
	},

	ExportToRaid : function (X,Y){
		var t = Tabs.TurboSearch;
		var cityId = t.from.city.id;
	    var pop = new pbPopup ('pbExportRaid', 0,0, 750,255, true);
	    if (t.popFirst){pop.centerMe (mainPop.getMainDiv());  t.popFirst = false;}
	    pop.getTopDiv().innerHTML = '<CENTER><B>Export to Raid</b></center>';   
	    var m = '<TABLE id=pbRaidAdd width=100% height=0% class=pbTab><TR>';      
	    for (i=1;i<=5;i++)		m+='<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+i+'_30_s34.jpg?6545"><TD align=left>'+ addCommas(Seed.units['city'+cityId]['unt'+i]) +'</td>';
		m+='</tr><TR>';
		for (i=1;i<=5;i++)		m+='<TD><INPUT id="Unit'+i+'" type=text size=6 maxlength=6 value="0"></td>';
	    m+='</tr><TR>';
		for (i=6;i<=10;i++)		m+='<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+i+'_30_s34.jpg?6545"><TD align=left>'+ addCommas(Seed.units['city'+cityId]['unt'+i]) +'</td>';
		m+='</tr><TR>';
		for (i=6;i<=10;i++)		m+='<TD><INPUT id="Unit'+i+'" type=text size=6 maxlength=6 value="0"></td>';
	    m+='</tr><TR>';
		for (i=11;i<=15;i++)	m+='<TD rowspan="2"><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+i+'_30_s34.jpg?6545"><TD align=left>'+ addCommas(Seed.units['city'+cityId]['unt'+i]) +'</td>';
		m+='</tr><TR>';
		for (i=11;i<=15;i++)	m+='<TD><INPUT id="Unit'+i+'" type=text size=6 maxlength=6 value="0"></td>';
	    m+='</tr></table>';
	    m+= '<BR><CENTER>' +strButton20(translate('Help'), 'id=pbHelp')+'<SELECT id=RaidKnights type=list></select></center>';
	    m+= '<BR><CENTER>'+ strButton20(translate('Raid and save'), 'id=pbRaidSave') +'</center>';        
	    pop.getMainDiv().innerHTML = m;
	    t.getKnights(); 
	    document.getElementById ('pbHelp').addEventListener ('click', t.helpPop, false);
	    document.getElementById ('pbRaidSave').addEventListener ('click', function(){
        var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);                       
        params.pf = 0;
        params.ctrl = 'BotManager';
        params.action = 'saveMarch';
        params.settings = {};
        params.settings.cityId = cityId;
        params.queue = {0:{botMarches:{botMarchStatus:1,botState:1},cityMarches:{}}};        
        params.queue[0].cityMarches.knightId = parseInt(document.getElementById ('RaidKnights').value);
        params.queue[0].cityMarches.toXCoord = X;
        params.queue[0].cityMarches.toYCoord = Y;
        params.queue[0].cityMarches.unit0Count = 0;
        for (var i=1;i<=15;i++) params.queue[0].cityMarches['unit'+i+'Count'] = parseInt(document.getElementById ('Unit'+i).value);	
         
		new AjaxRequest2(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
                      method: "post",
                     parameters: params,
                     loading: true,
                     onSuccess: function(transport){
                        var rslt = eval("(" + transport.responseText + ")");
                        if (rslt.ok) {
                            pop.show (false);
                            unsafeWindow.cityinfo_army();
                          	setTimeout(unsafeWindow.update_seed_ajax, 250);
                        } else ('Error :' + rslt.msg);
                     },
             });
        }, false); 
    	pop.show (true);
	},

	getKnights : function(){
        var t = Tabs.TurboSearch;
        var knt = new Array();
        cityId = t.from.city.id;
	    for (k in Seed.knights['city' + cityId]){
            if (Seed.knights['city' + cityId][k]["knightStatus"] == 1 && Seed.leaders['city' + cityId]["resourcefulnessKnightId"] != Seed.knights['city' + cityId][k]["knightId"] && Seed.leaders['city' + cityId]["politicsKnightId"] != Seed.knights['city' + cityId][k]["knightId"] && Seed.leaders['city' + cityId]["combatKnightId"] != Seed.knights['city' + cityId][k]["knightId"] && Seed.leaders['city' + cityId]["intelligenceKnightId"] != Seed.knights['city' + cityId][k]["knightId"]){
                knt.push ({Name:   Seed.knights['city' + cityId][k]["knightName"],Combat:    parseInt(Seed.knights['city' + cityId][k]["combat"]),ID:        Seed.knights['city' + cityId][k]["knightId"],});
            }
	    }
        knt = knt.sort(function sort(a,b) {a = a['Combat'];b = b['Combat'];return a == b ? 0 : (a > b ? -1 : 1);});
        document.getElementById('RaidKnights').options.length=0;
        var o = document.createElement("option");
        o.text = '--Choose a Knight--';
        o.value = 0;
        document.getElementById("RaidKnights").options.add(o);
        for (k in knt){
            if (knt[k]["Name"] !=undefined){
                var o = document.createElement("option");
                o.text = (knt[k]["Name"] + ' (' + knt[k]["Combat"] +')')
                o.value = knt[k]["ID"];
                document.getElementById("RaidKnights").options.add(o);
            }
        }
    },

    helpPop : function (){
       var helpText = '<A target="_tab" href="http://koc.wikia.com/wiki/Barbarian_Camps">A lot more can be found on Koc Wikia</a>';
       helpText += '<TABLE><TR><TD>Lvl</td><TD>Troops</td></tr>';
       helpText += '<TR><TD>1</td><TD>500 Supply Troops + 500 Archers</td></tr>';
       helpText += '<TR><TD>2</td><TD>500 Supply Troops + 2500 Archers</td></tr>';
       helpText += '<TR><TD>3</td><TD>500 Supply Troops + 5000 Archers</td></tr>';
       helpText += '<TR><TD>4</td><TD>500 Supply Troops + 7500 Archers</td></tr>';
       helpText += '<TR><TD>5</td><TD>15000 Archers</td></tr>';
       helpText += '<TR><TD>5</td><TD>12000 Archers IF Level 10 fletching and Level 9 Featherweight</td></tr>';
       helpText += '<TR><TD>6</td><TD>25000 Archers IF Level 9 fletching</td></tr>';
       helpText += '<TR><TD>6</td><TD>22000 Archers IF Level 10 fletching</td></tr>';
       helpText += '<TR><TD>7</td><TD>45000 Archers IF Level 10 fletching</td></tr>';
       helpText += '<TR><TD>7</td><TD>44000 Archers IF Level 10 fletching and knight 69+</td></tr>';
       helpText += '<TR><TD>7</td><TD>40000 Archers IF Level 10 fletching and knight 94+</td></tr>';
       helpText += '<TR><TD>8</td><TD>28000 Ballista WITH Level 10 fletching and Knight 91+</td></tr>';
       helpText += '<TR><TD>9</td><TD>56000 Ballista WITH Level 10 fletching and Knight 98+</td></tr>';
       helpText += '<TR><TD>10</td><TD>125000 Catapults (500 Catapults loss!)</td></tr></tr></table>';
       var pop = new pbPopup ('giftHelp', 0, 0, 400, 350, true);
       pop.centerMe (mainPop.getMainDiv());  
       pop.getMainDiv().innerHTML = helpText;
       pop.getTopDiv().innerHTML = '<CENTER><B>AIO Script '+translate("Help")+': '+translate("Raids")+'</b></center>';
       pop.show (true);
    },

	doSearch: function(blocks,fromX,fromY,callback){
		var t = Tabs.TurboSearch;
	    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		params.blocks = blocks;
		
	    new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/fetchMapTiles.php" + unsafeWindow.g_ajaxsuffix, {
	  		method: "post",
	  		parameters: params,
	  		onSuccess: function (transport) {
	  			var rslt = eval("(" + transport.responseText + ")");
	    		if (rslt.ok) {
	    			if (rslt.data == []) alert("MAP ERROR");
	    			 else callback(rslt.data, rslt.userInfo, rslt.allianceNames, fromX,fromY,false);
	    		}
	  		},
	  		onFailure: function () {
	  			alert('Search Failed');
	  			document.getElementById('TSsearchButton').value = "Start Search";
      			document.getElementById('TSsearchButton').disabled = false;
	  		},	
		});
	},

	ProvinceSearch:function(blocks,fromX,fromY,number){
		var t = Tabs.TurboSearch;
		if (number==26) {t.searchDone(t.data,t.userInfo,t.allianceNames,fromX,fromY,true);return;}
		document.getElementById('TSsearchButton').value = number + '/25';
	    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		params.blocks = blocks[number];
		
	    new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/fetchMapTiles.php" + unsafeWindow.g_ajaxsuffix, {
	  		method: "post",
	  		parameters: params,
	  		onSuccess: function (transport) {
	  			var rslt = eval("(" + transport.responseText + ")");
	    		if (rslt.ok) {
	    			if (rslt.data == []) alert("MAP ERROR");
	    			 else {
	    			 	for (var r in rslt.data) t.data.push(rslt.data[r]);
						for (var r in rslt.userInfo) {t.userInfo[r]=rslt.userInfo[r]};
						for (var r in rslt.allianceNames) {t.allianceNames[r]=rslt.allianceNames[r]};
	    			 	number++;  			 	
	    			 	setTimeout(t.ProvinceSearch,500,blocks,fromX,fromY,number)
	    			 }
	    		}
	  		},
	  		onFailure: function () {
	  			alert('Search Failed');
	  			document.getElementById('TSsearchButton').value = "Start Search";
      			document.getElementById('TSsearchButton').disabled = false;
	  		},	
		});

	},

	fetchPlayerStatus : function (uidArray){
	    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
	    params.checkArr = uidArray.join(',');
	    
	    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getOnline.php" + unsafeWindow.g_ajaxsuffix, {
	      method: "post",
	      parameters: params,
	      onSuccess: function (rslt) {
	      		if (rslt.ok) for (var y in rslt.data) {
	      			if (rslt.data[y]) var status = '<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAVNJREFUeNrUk09OwkAUh9+gUKpAFIuIfxJilLIlMd6gaw+Ax/AY7r2AnMFFb2DcC5gYYlBotYKttEwp83zjQtFIN6x8yZfJ9PfypZM3wxARFqkELFgLC5ZnN+yyQF9YjrR12hpEiegRJghoQIQunj7PF1DlQOB5dadi6Nt6cSWlKiPu8+ZTq9bu3tUoPyPc+UcQWK9sHRh6oVIOXF91XpzE2AtUXTss72tlQ+axR4AQjb313aJlWSCEAM75J3JS2dVMUebUdREjECWcojLwBiCZRJOvKB2mFZnH/wEXvb7b5zbaKmR+No6jMZd5/Bg5mt3HByupJQE24Js8gD/0LJnHC0zecNuO6d06HcGmAWRBTCEK/NZbh9+PTJn/FrDZq8wYS0GeVeE4cQIldkT6TZq/DT28gWtxBa/YpP73OMESLWuE8seli4gh9YdzBf/zMX0IMACs96WetcYlTQAAAABJRU5ErkJggg=="/>';      
	      			 else var status = '<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAWJJREFUeNrUU79PwkAUvv5IG6iAg8HEMIlxNLBCNxkkYah/gP6NmAChiYQUupjA4uCicbKJBQ0E24OWtvjdgCHGdmHyJV/efffuvrx37x232WzIPsaTPW1vAXGXaJpGRFGUOY67AD0FMsAX8IpSH4Mg8JrNZrwATI6i6KrRaGjVarWWTqePXde1TdO873Q67GYX8GIFwjAs1ev160qlckMp5QG2XQC/Xa1WnK7r7+APsQLr9fq8XC7XbNvmWXd832d7BFnxxWKxhnUvUQAXcqg/7zgOcRyKjIKfmCRJeRZPfETP89zJ5HO6XIYngiAThq1R6k5ZPLGNOPBsGMYglcpEsqyQLSRJicbj8YDFEzOwLGvUat21KfVFVb1Us9nc0WIx/xgOe2a/323PZrPRbwFud5RRvyQIwpmiKCX4AvgB4g6684Z2PsG/MJ4kIMAdsnn4Y+jYi85x3o8V+J+f6VuAAQDR57f+eJX9fgAAAABJRU5ErkJggg=="/>';    
	        		var element = document.getElementsByClassName('DIVonline_'+y);
				    for (var k=0;k<element.length;k++) element[k].innerHTML = status;	      
	        	}	
	      },
	      onFailure: function () {},
	    });
  	},

	checkOptions: function(){
		var t = Tabs.TurboSearch;
		if (document.getElementById('RadioCities').checked){
			document.getElementById('DIVminLevel').innerHTML = '<FONT color=grey>Min. Level: </font>';
			document.getElementById('DIVmaxLevel').innerHTML = '<FONT color=grey>Max. Level: </font>';
			document.getElementById('DIVunowned').innerHTML = '<FONT color=grey>Unowned</font>';
			document.getElementById('TSunowned').disabled = true;
			document.getElementById('TSminLevel').disabled = true;
			document.getElementById('TSmaxLevel').disabled = true;
			t.enableCityOptions();
		} 
		if (document.getElementById('RadioBarb').checked || document.getElementById('RadioWild').checked) {
			document.getElementById('DIVminLevel').innerHTML = '<FONT color=black>Min. Level: </font>';
			document.getElementById('DIVmaxLevel').innerHTML = '<FONT color=black>Max. Level: </font>';
			if (document.getElementById('RadioBarb').checked) {
				document.getElementById('DIVunowned').innerHTML = '<FONT color=grey>Unowned</font>';
				document.getElementById('TSunowned').disabled = true;
			} else {
				document.getElementById('DIVunowned').innerHTML = '<FONT color=black>Unowned</font>';
				document.getElementById('TSunowned').disabled = false;
			}
			document.getElementById('TSminLevel').disabled = false;
			document.getElementById('TSmaxLevel').disabled = false;
			t.disableCityOptions();
		}
	},

	disableCityOptions: function(){
		document.getElementById('DIVmisted').innerHTML = '<FONT color=grey>Misted</font>';
		document.getElementById('DIVhostile').innerHTML = '<FONT color=grey>Hostile</font>';
		document.getElementById('DIVfriendly').innerHTML = '<FONT color=grey>Friendly / Us</font>';
		document.getElementById('DIVfriendlyToUs').innerHTML = '<FONT color=grey>Friendly To Us</font>';
		document.getElementById('DIVneutral').innerHTML = '<FONT color=grey>Neutral</font>';
		document.getElementById('DIVallied').innerHTML = '<FONT color=grey>Allied</font>';
		document.getElementById('DIVunAllied').innerHTML = '<FONT color=grey>Unallied</font>';
		document.getElementById('DIVmight').innerHTML = '<FONT color=grey>Might (in Million):</font>';
		document.getElementById('DIVmightMin').innerHTML = '<FONT color=grey>Min.:</font>';
		document.getElementById('DIVmightMax').innerHTML = '<FONT color=grey>Max.:</font>';
		document.getElementById('DIVfilterTop').innerHTML = '<FONT color=grey>Filter alliances Rank:</font>';
		document.getElementById('DIVtop').innerHTML = '<FONT color=grey>to</font>';
		document.getElementById('TSmisted').disabled = true;
		document.getElementById('TShostile').disabled = true;
		document.getElementById('TSfriendly').disabled = true;
		document.getElementById('TSfriendlyToUs').disabled = true;
		document.getElementById('TSneutral').disabled = true;
		document.getElementById('TSallied').disabled = true;
		document.getElementById('TSunAllied').disabled = true;
		document.getElementById('TSmightMin').disabled = true;
		document.getElementById('TSmightMax').disabled = true;
		document.getElementById('TSfilerTop').disabled = true;
		document.getElementById('TStopMin').disabled = true;
		document.getElementById('TStopMax').disabled = true;
	},
	enableCityOptions: function(){
		if (document.getElementById('TSallied').checked){
			document.getElementById('TSmisted').disabled = false;
			document.getElementById('TShostile').disabled = false;
			document.getElementById('TSfriendly').disabled = false;
			document.getElementById('TSfriendlyToUs').disabled = false;
			document.getElementById('TSneutral').disabled = false;
			document.getElementById('DIVmisted').innerHTML = '<FONT color=black>Misted</font>';
			document.getElementById('DIVhostile').innerHTML = '<FONT color=red>Hostile</font>';
			document.getElementById('DIVfriendly').innerHTML = '<FONT color=green>Friendly</font>&nbsp/&nbsp<FONT color=blue>Us</font>';
			document.getElementById('DIVfriendlyToUs').innerHTML = '<FONT color=orange>Friendly To Us</font>';
			document.getElementById('DIVneutral').innerHTML = '<FONT color=black>Neutral</font>';
		} else {
			document.getElementById('TSmisted').disabled = true;
			document.getElementById('TShostile').disabled = true;
			document.getElementById('TSfriendly').disabled = true;
			document.getElementById('TSfriendlyToUs').disabled = true;
			document.getElementById('TSneutral').disabled = true;
			document.getElementById('DIVmisted').innerHTML = '<FONT color=grey>Misted</font>';
			document.getElementById('DIVhostile').innerHTML = '<FONT color=grey>Hostile</font>';
			document.getElementById('DIVfriendly').innerHTML = '<FONT color=grey>Friendly</font>';
			document.getElementById('DIVfriendlyToUs').innerHTML = '<FONT color=grey>Friendly To Us</font>';
			document.getElementById('DIVneutral').innerHTML = '<FONT color=grey>Neutral</font>';
		}
		document.getElementById('DIVallied').innerHTML = '<FONT color=black>Allied</font>';
		document.getElementById('DIVunAllied').innerHTML = '<FONT color=black>Unallied</font>';
		document.getElementById('DIVmight').innerHTML = '<FONT color=black>Might (in Million):</font>';
		document.getElementById('DIVmightMin').innerHTML = '<FONT color=black>Min.:</font>';
		document.getElementById('DIVmightMax').innerHTML = '<FONT color=black>Max.:</font>';
		document.getElementById('DIVfilterTop').innerHTML = '<FONT color=black>Filter alliances Rank:</font>';
		document.getElementById('DIVtop').innerHTML = '<FONT color=black>to</font>';
		document.getElementById('TSallied').disabled = false;
		document.getElementById('TSunAllied').disabled = false;
		document.getElementById('TSmightMin').disabled = false;
		document.getElementById('TSmightMax').disabled = false;
		document.getElementById('TSfilerTop').disabled = false;
		document.getElementById('TStopMin').disabled = false;
		document.getElementById('TStopMax').disabled = false;
	},

	show: function (){
		var t = Tabs.TurboSearch;
		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
	    params.pageNo = 1;
	    params.cityId = unsafeWindow.currentcityid;
	     
	    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/allianceGetOtherInfo.php" + unsafeWindow.g_ajaxsuffix, {
		    method: "post",
		    parameters: params,
		    onSuccess: function (rslt) {
				var data = rslt.otherAlliances;
				for (y=0;y<data.length;y++) t.rankings[data[y].allianceId] = data[y].ranking; 
					var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
				    params.pageNo = 2;
				    params.cityId = unsafeWindow.currentcityid;
				     
				    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/allianceGetOtherInfo.php" + unsafeWindow.g_ajaxsuffix, {
				      	method: "post",
				      	parameters: params,
				      	onSuccess: function (rslt) {
						  	var data = rslt.otherAlliances;
						  	for (y=0;y<data.length;y++) t.rankings[data[y].allianceId] = data[y].ranking; 
				      	},
				    });
		    },
	    });
	},
	hide: function (){}
}

/************************  Overview Tab ************************/
var OverviewTabActive = false;

Tabs.Overview = {
	tabOrder: 1,
	tabLabel: 'Overview',
	type: 'Tools',
	myDiv: null,

    init: function(div){
    	var t = Tabs.Overview;
        t.myDiv = div;
        dt = new Date ();
    	dt.setTime (Seed.player.datejoinUnixTime * 1000);
      	var m = '<DIV class=pbStat><TABLE width=100% height=0% class=pbTab>';
      	m+= '<TR align=left><TD>Joined on: '+ dt.toLocaleDateString() +'</td>';
      	m+= '<TD>Might: ' + addCommas(Seed.player.might) +'</td>';
      	m+= '<TD>Alliance: ' + getMyAlliance()[1] +'</td>';
     	m+= '<TD align=right>Domain: ' + unsafeWindow.domainName +'</td></tr></table></div><BR>';      
      	m+= '<DIV id=Stats></div><BR>';
      	m+= '<DIV id=TroopStats></div>';
      	m+= '<DIV id=O_Options></div><BR>';
       	t.myDiv.innerHTML = m;    	
    },
    paintStats: function(){
    	var t = Tabs.Overview;
    	m= '<TABLE width=100% height=0% class=pbTab><TR valign=top align=right><TD></td><TD style="background: #ffc">TOTAL</td>';
     	for (var i=0;i<Seed.cities.length;i++) {
     		m+='<TD><b>'+Seed.cities[i][1] + '</b>';
     		m+='<BR>'+coordLink(Seed.cities[i][2],Seed.cities[i][3]);
     		m+='<BR>'+unsafeWindow.provincenames['p'+Seed.cities[i][4]];
     	}
     	m+='</tr>';
     	for (var i=0;i<=5;i++){
     		var resourceinfo = unsafeWindow.resourceinfo[i];
     		var total=0;
     		if (i==5) resourceinfo = unsafeWindow.resourceinfo[7];   		
     		m+='<TR><TD><B>'+resourceinfo+'</b></td>';
     		if (i==0) m+= t.paintGold();
     		 else m+= t.paintRec(i);
     	}
     	m+='</tr><TR style="height:5px;max-height:5px"><TD colspan=10 style="height:100%;border-bottom: 1px dashed #000000;"></td></tr>';
     	m+='<TR style="height:4px;max-height:4px"><TD colspan=10 style="height:100%"></td></tr>';
     	m+= t.paintTroops();
     	m+='<TR style="height:5px;max-height:5px"><TD colspan=10 style="height:100%;border-bottom: 1px dashed #000000;"></td></tr>';
     	m+='<TR style="height:4px;max-height:4px"><TD colspan=10 style="height:100%"></td></tr>';
     	m+= '<TR><TD><B>Food Usage</b></td>';
     	var total = 0;
     	for (var ii=0;ii<Seed.cities.length;ii++) {
     		var usage = t.getFoodUsage(ii);
     		total+= usage[2];
     	}
     	m+= '<TD  style="text-align:right;background: #ffc">'+addCommas(total)+'</td>';
     	for (var ii=0;ii<Seed.cities.length;ii++) {
     		var usage = t.getFoodUsage(ii);
        	m+= '<TD style="text-align:right;">'+addCommas(usage[2])+'</td>';
     	}
     	m+= '</tr><TR><TD><B>Food Left</b></td><TD></td>';
     	for (var ii=0;ii<Seed.cities.length;ii++) {
     		var usage = t.getFoodUsage(ii);
     		if (usage[2] > 0) m+='<TD style="text-align:right;">----</td>';
     		 else {
     		 	var timeLeft = parseInt(Seed.resources['city'+Seed.cities[ii][0]]['rec1'][0]) / (0-usage[2]);
     		 	if (timeLeft < (3600*24)) m+='<TD style="text-align:right;"><SPAN style="padding-left:3px; padding-right:3px; background-color:#700; color:white; font-weight:bold">'+ timestrShort(timeLeft) +'</span></td>';
     		 	 else m+='<TD style="text-align:right;">'+ timestrShort(timeLeft) +'</td>';
     		}
     	}
     	m+='</tr><TR style="height:5px;max-height:5px"><TD colspan=10 style="height:100%;border-bottom: 1px dashed #000000;"></td></tr>';
     	m+='<TR style="height:4px;max-height:4px"><TD colspan=10 style="height:100%"></td></tr>';
     	m+='<TR><TD><B>#Wilds</b></td><TD></td>';
     	for (var ii=0;ii<Seed.cities.length;ii++) {
     		var wilds = 0;
     		var castle = parseInt(Seed.buildings['city'+ Seed.cities[ii][0]].pos0[1]);
       		if(castle == 11) castle = 12;
       		 else if(castle == 12) castle = 14;
     		if (Seed.wilderness['city'+ Seed.cities[ii][0]]!=null && matTypeof(Seed.wilderness['city'+ Seed.cities[ii][0]])=='object') for (var k in Seed.wilderness['city'+ Seed.cities[ii][0]]) wilds++;
     		if (wilds < castle) m+='<TD style="text-align:right;"><FONT color=red>'+wilds+'/'+castle+'</font></td>';
     		 else m+='<TD style="text-align:right;">'+wilds+'/'+castle+'</td>';
     	}
     	m+= '</tr><TR><TD><B># Knights</b></td><TD></td>';
     	for (var ii=0;ii<Seed.cities.length;ii++) {
     		var Knights = 0;
            for (k in Seed.knights['city'+ Seed.cities[ii][0]]) Knights++;
            m+='<TD style="text-align:right;">'+Knights+'</td>';
     	}
     	m+= '</tr><TR><TD><B>TroopQ</b></td><TD></td>';
     	var now = unixTime();
     	for (var ii=0;ii<Seed.cities.length;ii++) {	
			if (getCityBuilding(Seed.cities[ii][0],13).count>0) {
				if (Seed.queue_unt['city'+Seed.cities[ii][0]]!=null && Seed.queue_unt['city'+Seed.cities[ii][0]].length>0) TroopTime = Seed.queue_unt['city'+Seed.cities[ii][0]][Seed.queue_unt['city'+Seed.cities[ii][0]].length-1][3] - now;
				else TroopTime = 0;
				if (TroopTime == 0) m+='<TD style="text-align:right;"><FONT color=red>0s</font></td>';
				 else m+='<TD style="text-align:right;">'+timestr(TroopTime)+'</td>';
			} else m+='<TD style="text-align:right;">----</td>';
     	}
     	m+= '</tr><TR><TD><B>WallQ</b></td><TD></td>';
     	for (var ii=0;ii<Seed.cities.length;ii++) {
     		var wall = {};
	        getWallInfo (Seed.cities[ii][0], wall);
	        var WallTime = 0;
	        var q = Seed.queue_fort['city'+Seed.cities[ii][0]]; 
	        if (Seed.queue_fort['city'+Seed.cities[ii][0]]!=null && Seed.queue_fort['city'+Seed.cities[ii][0]].length>0) WallTime = Seed.queue_fort['city'+Seed.cities[ii][0]][Seed.queue_fort['city'+Seed.cities[ii][0]].length-1][3] - now;
	        if (WallTime < 0) WallTime = 0;
	        if (WallTime==0 && (wall.wallSpaceUsed < wall.wallSpace-4 || wall.fieldSpaceUsed < wall.fieldSpace-4)) m+='<TD style="text-align:right;"><FONT color=red>0s</font></td>';
			 else if (WallTime >0) m+='<TD style="text-align:right;">'+timestr(WallTime)+'</td>';
			  else m+='<TD style="text-align:right;">----</td>';
     	}
     	m+= '</tr><TR><TD><B>CraftQ</b></td><TD></td>';
     	for (var ii=0;ii<Seed.cities.length;ii++) {
     		if (getCityBuilding(Seed.cities[ii][0],20).count>0) {
     			if (Seed.queue_craft['city'+Seed.cities[ii][0]]!=null && Seed.queue_craft['city'+Seed.cities[ii][0]].length>0) {
     				var CraftTime = Seed.queue_craft['city'+Seed.cities[ii][0]][0].craftingEtaUnixTime - now;
     				if (CraftTime<0) CraftTime=0;
     				if (CraftTime == 0) m+='<TD style="text-align:right;"><FONT color=red>0s</font></td>';
					 else m+='<TD style="text-align:right;">'+timestr(CraftTime)+'</td>';
     			} else m+='<TD style="text-align:right;"><FONT color=red>0s</font></td>';
     		} else m+='<TD style="text-align:right;">----</td>';
     	}
     	m+= '</tr></table>';	
     	document.getElementById('Stats').innerHTML = m;
    },
    paintGold:function(){
    	var gold = "";
    	var total=0;
    	for (var ii=0;ii<Seed.cities.length;ii++) total += parseInt(Seed.citystats['city'+Seed.cities[ii][0]].gold[0]);
     	gold += '<TD style="text-align:right;background: #ffc">'+addCommas(total)+'</td>';
     	for (var ii=0;ii<Seed.cities.length;ii++) gold+='<TD style="text-align:right;">'+addCommas(parseInt(Seed.citystats['city'+Seed.cities[ii][0]].gold[0]))+'</td>';
		return gold; 
    },
    paintRec:function(i){
    	var t = Tabs.Overview;
    	var rec = "";
    	var total=0;
    	for (var ii=0;ii<Seed.cities.length;ii++) {
    		if (i==5) total += parseInt(Seed.resources['city'+Seed.cities[ii][0]]['rec'+i][0]);
    		 else total += Math.round(parseInt(Seed.resources['city'+Seed.cities[ii][0]]['rec'+i][0])/3600);
    	}
     	if (i!=5) rec += '<TD style="text-align:right;background: #ffc"><a class=hasTooltip style="color:black">'+addCommas(total)+'<SPAN>'+t.getTotalTransporting(i)+'</span></a></td>';
     	else rec += '<TD style="text-align:right;background: #ffc">'+addCommas(total)+'</td>';
     	for (var ii=0;ii<Seed.cities.length;ii++) {
     		if (i==5) rec+='<TD style="text-align:right;">'+addCommas(parseInt(Seed.resources['city'+Seed.cities[ii][0]]['rec'+i][0]))+'</td>';
     		else rec+='<TD style="text-align:right;">'+addCommas(Math.round(parseInt(Seed.resources['city'+Seed.cities[ii][0]]['rec'+i][0])/3600))+'</td>';
     	}
		return rec; 
    },
    paintTroops: function(){
    	var troops = "";
    	var units = 15;
    	if (unsafeWindow.unitstats.unt16) units=16;
    	for (var i=1;i<=units;i++){
    		var total= 0;
    		troops+='<TR><TD><B>'+unsafeWindow.unitnamedesctranslated['unt'+i][0]+'</b></td>';
    		for (var ii=0;ii<Seed.cities.length;ii++) total+= parseInt(Seed.units['city'+Seed.cities[ii][0]]['unt'+i]);
    		troops+='<TD style="text-align:right;background: #ffc">'+addCommas(total)+'</td>';
    		for (var ii=0;ii<Seed.cities.length;ii++) troops+='<TD style="text-align:right;">'+ addCommas(parseInt(Seed.units['city'+Seed.cities[ii][0]]['unt'+i]))+'</td>'; 
    		troops+='</tr>';	
    	}
    	return troops;
    },
    getFoodUsage: function(ii){
    	var production = getResourceProduction (Seed.cities[ii][0]);
     	var used = parseInt(Seed.resources["city" + Seed.cities[ii][0]]['rec1'][3]);
     	var usage = [production[1],used,(production[1]-used)];
     	return usage;
    },
    getTotalTransporting: function(type){
    	var resource = 0;
    	var what = {1:"food",2:"wood",3:"stone",4:"iron"};
    	if (type == "gold") var hover = '<img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/gold_30.png> 0 marching';
    	else var hover = '<img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/'+what[type]+'_30.png> 0 marching';
    	for (var i=0;i<Seed.cities.length;i++){
    		for (k in Seed.queue_atkp['city'+Seed.cities[i][0]]){
    			transport = Seed.queue_atkp['city'+Seed.cities[i][0]];
    			if (transport[k].marchType==1 && transport[k].marchStatus!=8) {
    			 	if (type == "gold") {
    			 		resource += parseInt(transport[k]['gold']);
    			 		hover = '<img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/gold_30.png> ' + addCommas(resource) + ' marching';
    			 	} else {
    			 		resource +=  parseInt(transport[k]['resource'+type]);
    			 		hover = '<img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/'+what[type]+'_30.png> ' + addCommas(resource) + ' marching';
    			 	}   		 	
    			}
    		}
    	}
    	return hover;
    },
    show: function(){
        OverviewTabActive = true;
    },
    hide: function(){
       OverviewTabActive = false;
    },
    onUnload: function(){
    },
}


/*********************************** Players TAB ***********************************/

function officerId2String (oid){
	if (oid==null) return '';
	else if (oid==3) return unsafeWindow.allianceOfficerTypeMapping[3];
	else if (oid==2) return unsafeWindow.allianceOfficerTypeMapping[2];
	else if (oid==1) return unsafeWindow.allianceOfficerTypeMapping[1];
	else if (oid==4) return unsafeWindow.allianceOfficerTypeMapping[4];
	return '';
}

Tabs.AllianceList = {
    tabOrder : 2,
    type: 'Tools',
    tabLabel : unsafeWindow.g_js_strings.commonstr.player,
    myDiv : null,
    dat : [],
    clickedAlly:false,
    lastLogin:0,
    warStatus:0,
    CityFrom:null,
  
	init : function (div){
		var t = Tabs.AllianceList;
		t.myDiv = div;
		unsafeWindow.PTgetMembers = t.eventGetMembers;
		unsafeWindow.PTPaintMembers = t.GetDataForMap;
		unsafeWindow.PTpd = t.clickedPlayerDetail;
		unsafeWindow.PTpl = t.clickedPlayerLeaderboard;
		unsafeWindow.PTpl2 = t.clickedPlayerLeaderboard2;
		unsafeWindow.PTpFilter = t.FilterPlayer;
		unsafeWindow.PTalClickPrev = t.eventListPrev;
		unsafeWindow.PTalClickNext = t.eventListNext;
		unsafeWindow.PCplo = t.clickedPlayerGetLastLogin;
		unsafeWindow.PTPlayClick = t.clickedPlayerInAll;
		Lastlogin=0;
		t.show();
	},

	fetchPlayerCourt : function (uid, notify){
		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		params.pid = uid;
		 
		new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/viewCourt.php" + unsafeWindow.g_ajaxsuffix, {
			method: "post",
			parameters: params,
			onSuccess: function (rslt) {notify (rslt);},
			onFailure: function (rslt) {notify (rslt);},
		});
	},
 
	hide : function (){},

  	show : function (){
    	var t = Tabs.AllianceList;
    	if (t.state == null){
      		if (getMyAlliance()[0] == 0) {
        		t.myDiv.innerHTML = '<BR><BR><CENTER>'+unsafeWindow.g_js_strings.membersInfo.youmustbelong+'</center>';
        		t.state = 1;
        		return;
      		}
      		var m = '<DIV class=ptentry><TABLE width=100% cellpadding=0>';
			m+='<TR><TD class=xtab align=right></td><TD class=xtab>'+unsafeWindow.g_js_strings.modal_fow_leaderboard.searchuser+': &nbsp; </td>';
			m+=' <TD width=80% class=xtab><INPUT id=allPlayName size=20 type=text/> &nbsp;'; 
			m+='<INPUT id=playSubmit type=submit class=pbButton value="'+unsafeWindow.g_js_strings.modal_fow_leaderboard.finduser+'" /> &nbsp; <INPUT id=ffbuidsubmit type=submit class=pbButton value="UID" /></td>\
			<TD class="xtab ptErrText"><SPAN id=ptplayErr></span></td></tr>\
			<TR><TD class=xtab></td><TD class=xtab>'+unsafeWindow.g_js_strings.setDiplomacyWindow.srchalli+': &nbsp;</td>\
			<TD class=xtab><INPUT id=allAllName type=text /> &nbsp; <INPUT id=allSubmit type=submit class=pbButton value="'+unsafeWindow.g_js_strings.modal_fow_leaderboard.findalli+'" /></td>\
			<TD class="xtab ptErrText"><SPAN id=ptallErr></span></td></tr>\
			<TR><TD class=xtab><INPUT align=left id=allListSubmit type=submit class=pbButton value="'+unsafeWindow.g_js_strings.commonstr.alliances+'" /></td>\
			<TD class=xtab><INPUT align=right id=idMyAllSubmit type=submit class=pbButton value="'+ getMyAlliance()[1] +'"/>\
			<TD><INPUT id=pbShowFriendlies type=CHECKBOX>Show Friendlys &nbsp;<INPUT id=pbShowHostiles type=CHECKBOX>Show Hostiles</td>\
			 <TD class=xtab></td><TD class=xtab><span align=right <b>'+unsafeWindow.g_js_strings.attack_generateincoming.estimatedarrival+': </b></span>\
			<div><select id="idFindETASelect">\
			<option value="0,0" > -- Select -- </option>\
			<option value="0,180" >'+unsafeWindow.unitcost["unt1"][0]+'</option>\
			<option value="0,200" > '+unsafeWindow.unitcost["unt2"][0]+' </option>\
			<option value="0,3000" > '+unsafeWindow.unitcost["unt3"][0]+' </option>\
			<option value="0,300" > '+unsafeWindow.unitcost["unt4"][0]+' </option>\
			<option value="0,275" > '+unsafeWindow.unitcost["unt5"][0]+' </option>\
			<option value="0,250" > '+unsafeWindow.unitcost["unt6"][0]+' </option>\
			<option value="1,1000" > '+unsafeWindow.unitcost["unt7"][0]+' </option>\
			<option value="1,750" > '+unsafeWindow.unitcost["unt8"][0]+' </option>\
			<option value="1,150" > '+unsafeWindow.unitcost["unt9"][0]+' </option>\
			<option value="1,100" > '+unsafeWindow.unitcost["unt10"][0]+' </option>\
			<option value="1,120" > '+unsafeWindow.unitcost["unt11"][0]+' </option>\
			<option value="1,80" > '+unsafeWindow.unitcost["unt12"][0]+' </option>\
			</select></div></td></tr>\
			<TR><TD colspan=5><DIV id=pbFriendlyDivs style="max-width:725px; white-space:pre-wrap"></div></td>\
			<TR><TD colspan=5><DIV id=pbHostilesDivs style="max-width:725px; white-space:pre-wrap"></div></td>\
			</table><span style="vertical-align:middle;" id=altInput></span></div><SPAN id=allListOut></span>';
			t.myDiv.innerHTML = m;
			document.getElementById('allPlayName').addEventListener ('keypress', function(e) {if ( e.which == 13)  document.getElementById('playSubmit').click();}, false);
			document.getElementById('allAllName').addEventListener ('keypress', function(e) {if ( e.which == 13)  document.getElementById('allSubmit').click();}, false);
			document.getElementById('pbShowFriendlies').addEventListener ('change',function(){
				if (this.checked)t.paintFriendlyDiv();
				 else document.getElementById('pbFriendlyDivs').innerHTML = '';
			});
		    document.getElementById('pbShowHostiles').addEventListener ('change',function(){
		        if (this.checked)t.paintHostilesDiv();
		        else document.getElementById('pbHostilesDivs').innerHTML = '';      
		    });
			document.getElementById('allSubmit').addEventListener ('click', t.eventSubmit, false);
			document.getElementById('playSubmit').addEventListener ('click', t.eventPlayerSubmit, false);
			document.getElementById('ffbuidsubmit').addEventListener ('click', t.eventPlayerUIDSubmit, false);
			document.getElementById('allAllName').addEventListener ('focus', function (){document.getElementById('ptallErr').innerHTML='';}, false);
			document.getElementById('allPlayName').addEventListener ('focus', function (){document.getElementById('ptplayErr').innerHTML='';}, false);
			document.getElementById('allListSubmit').addEventListener ('click', t.eventListSubmit, false);
			document.getElementById('idMyAllSubmit').addEventListener ('click', t.showMyAlliance, false);
			document.getElementById('idFindETASelect').addEventListener ('click', t.handleEtaSelect, false);
			document.getElementById('idFindETASelect').disabled = true;
			t.ModelCity=Cities.cities[0];
			t.curPage = 0;
			t.MaxPage = -1;
			t.state = 1;
    	}
  	},
  	paintFriendlyDiv : function () {
    	var t = Tabs.AllianceList;
    	var mess = ' ----- Friendlys ----- <BR>';
	    for (k in Seed.allianceDiplomacies.friendly) mess += '<INPUT id=pbFriendly_'+k+' type=submit class=pbButton value="'+Seed.allianceDiplomacies.friendly[k].allianceName+'">&nbsp;';
	    document.getElementById('pbFriendlyDivs').innerHTML = mess;
	    for (q in Seed.allianceDiplomacies.friendly) document.getElementById('pbFriendly_'+q).addEventListener('click', function(){unsafeWindow.PTgetMembers(this.id.substr(12))});    
  	},
	paintHostilesDiv : function () {
		var t = Tabs.AllianceList;
		var mess = ' ----- Hostiles ----- <BR>';
		for (k in Seed.allianceDiplomacies.hostile) mess += '<INPUT id=pbHostile_'+k+' type=submit class=pbButton value="'+Seed.allianceDiplomacies.hostile[k].allianceName+'">&nbsp;'; //		
		document.getElementById('pbHostilesDivs').innerHTML = mess;
		for (q in Seed.allianceDiplomacies.hostile) document.getElementById('pbHostile_'+q).addEventListener('click', function(){unsafeWindow.PTgetMembers(this.id.substr(11))});
	},
  	pName : '',
	eventPlayerSubmit : function (){
		var t = Tabs.AllianceList;
		document.getElementById('ptplayErr').innerHTML='';
		var name = document.getElementById('allPlayName').value;
		name = name.replace(/\'/g,"_");
		t.pName = name;
		if (name.length < 3){
		  document.getElementById('ptplayErr').innerHTML = unsafeWindow.g_js_strings.getAllianceSearchResults.entryatleast3;
		  return;
		}
		document.getElementById('altInput').innerHTML = '';
		document.getElementById('allListOut').innerHTML = '<BR><BR><CENTER>'+unsafeWindow.g_js_strings.commonstr.loadingddd+'</center>';
		t.fetchPlayerList (name, t.eventGotPlayerList);
	},
	eventGotPlayerList : function (rslt){
		var t = Tabs.AllianceList;
		if (!rslt.ok){
		  document.getElementById('allListOut').innerHTML = rslt.errorMsg;
		  return;
		}
		t.playerList = rslt.matchedUsers;
		var uList = [];
		for (k in rslt.matchedUsers) uList.push (rslt.matchedUsers[k].userId);     
		t.fetchPlayerStatus (uList, function(r){t.eventGotPlayerOnlineList(r)});    
	},    
    eventGotPlayerOnlineList : function (rslt){
		var t = Tabs.AllianceList;
		if (!rslt.ok){
		  document.getElementById('allListOut').innerHTML = rslt.errorMsg;
		  return;
		}
		var m = '<DIV class=pbStat>'+unsafeWindow.g_js_strings.recommendSelectedFriends.playersrch+': <B>"'+ t.pName +'"</b></div>\
		  <DIV style="height:575px; max-height:575px; overflow-y:auto">\
		  <TABLE class=pbTab cellspacing=0><TR style="font-weight:bold"><TD width=150px>'+unsafeWindow.g_js_strings.commonstr.nametx+'</td>\
		  <TD align=right width=50px>UID</td><TD align=right width=100px>'+unsafeWindow.g_js_strings.commonstr.might+'</td><TD align=right width=75px>'+unsafeWindow.g_js_strings.commonstr.online+'</td><TD align=center width=100px>Facebook</td><TD align=center width=100px>Delete reports</td><TD width=125px align=center>'+unsafeWindow.g_js_strings.commonstr.search+' </td></tr>';
		var row=0;
		var cl='';
		for (k in t.playerList){
		  var u = t.playerList[k];
		  if (++row % 2) cl = 'class=ptOddrow ';
		  else cl = '';
		  var what = ((CheckFilter(u.userId))?"":'<SPAN onclick="PTpFilter('+u.userId+',\''+u.name+'\')"><A>Add to list</a></span>'); 
		  m += '<TR '+ cl +'valign=top><TD>'+ u.genderAndName +'</td><TD><A target="_tab" href="http://kocmon.com/'+getServerId()+'/players/'+ u.userId +'">' + u.userId + '</a></td><TD align=right>'+ addCommasInt(u.might) +'</td>\
		      <TD align=right>'+ (rslt.data[u.userId]?"&nbsp;<SPAN class=boldDarkRed>"+unsafeWindow.g_js_strings.commonstr.online+"</span>":"") +'</td>\
		      <TD align=center><A target="_tab" href="http://www.facebook.com/profile.php?id='+ u.fbuid +'">'+unsafeWindow.g_js_strings.commonstr.profile+'</a></td>\
		      <TD align=center id=Search_'+u.userId+'>'+what+'</td>\
		      <TD align=center><SPAN onclick="PTpl2(this,'+ u.userId+','+rslt.data[u.userId]+')"><A>'+unsafeWindow.g_js_strings.modaltitles.leaderboard+'</a></span></td></tr>';
				//<SPAN onclick="PTpd(this, '+ u.userId +')"><A>'+unsafeWindow.g_js_strings.modaltitles.memberdetails+'</a> &nbsp; <BR></span>      <SPAN onclick="PCplo(this, \''+ u.userId +'\')"><A>'+unsafeWindow.g_js_strings.modal_messages_viewreports_view.lastlogin+'</a></span>
		}
		m += '</table></div>';
		document.getElementById('allListOut').innerHTML = m;
	},
	FilterPlayer: function(uid,name){
		var t = Tabs.AllianceList;
		Options.PlayerFilter.push({uid:uid,name:name});
		document.getElementById('Search_'+uid).innerHTML ="";
		saveOptions();
	},
  	asName : '', 
    eventPlayerUIDSubmit : function (){
		var t = Tabs.AllianceList;
		document.getElementById('ptplayErr').innerHTML='';
		var uid = document.getElementById('allPlayName').value;
		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		params.uid = uid;
		 
		AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getUserGeneralInfo.php" + unsafeWindow.g_ajaxsuffix, {
			method: "post",
			parameters: params,
				onSuccess: function (transport) {
				var rslt = eval("(" + transport.responseText + ")");
				if (rslt.ok) test = rslt.userInfo[0].name;
				else document.getElementById('allListOut').innerHTML = '<BR><BR><CENTER>'+unsafeWindow.g_js_strings.barbarian.erroroccured+'</center>';
			},
			onFailure: function (rslt) {
			   	document.getElementById('allListOut').innerHTML = '<BR><BR><CENTER>'+unsafeWindow.g_js_strings.errorcode.err_602+'</center>';
				return;
			},
		});
		t.pName = t.asName;
		document.getElementById('altInput').innerHTML = '';
		document.getElementById('allListOut').innerHTML = '<BR><BR><CENTER>'+unsafeWindow.g_js_strings.commonstr.loadingddd+'</center>';
		setTimeout(t.fetchPlayerList,500, test, t.eventGotPlayerList);
  	},
	clickedPlayerDetail : function (span, uid){
		var t = Tabs.AllianceList;
		span.onclick = '';
		span.innerHTML = unsafeWindow.g_js_strings.commonstr.search +': '+ unsafeWindow.g_js_strings.modaltitles.memberdetails + " ...";
		t.fetchPlayerInfo (uid, function (r) {t.gotPlayerDetail(r, span)});
	},
	clickedPlayerLeaderboard : function (span, uid){
		var t = Tabs.AllianceList;
		span.onclick = '';
		span.innerHTML = unsafeWindow.g_js_strings.commonstr.search +': '+ unsafeWindow.g_js_strings.modaltitles.leaderboard + " ...";
		t.fetchLeaderboard (uid, function (r) {t.gotPlayerLeaderboard(r, span)});
	},
	clickedPlayerLeaderboard2 : function (span, uid,status){
		var t = Tabs.AllianceList;
		span.onclick = '';
		span.innerHTML = unsafeWindow.g_js_strings.commonstr.search +': '+ unsafeWindow.g_js_strings.modaltitles.leaderboard + " ...";
		t.fetchLeaderboard (uid, function (r) {t.gotPlayerLeaderboard2(r, span,uid,status)});
	},
	clickedPlayerGetLastLogin : function (span, uid){
		var t = Tabs.AllianceList;
		span.onclick = '';
		span.innerHTML = unsafeWindow.g_js_strings.commonstr.search +': '+ unsafeWindow.g_js_strings.modal_messages_viewreports_view.lastlogin + " ...";
		t.fetchPlayerLastLogin (uid, function (r) {t.gotPlayerLastLogin(r, span)});
	},
	gotPlayerLeaderboard2 : function (rslt,span,uid,status){
		var t = Tabs.AllianceList;
		var prestige="";
		if (!rslt.ok){
		  span.innerHTML = rslt.errorMsg;
		  return;
		}
		t.dat = [];
		var myA = getMyAlliance ();
		if (rslt.totalResults == 0){
		  t.fetchPlayerLastLogin (uid, function (r) {t.displayPlayer("",r)});
		  return;
		}
		var p = rslt.results[0];
	    if ( myA[0] == p.allianceId) t.friendEta = true;
	    else t.friendEta = false;
	    for (var c=0; c<p.cities.length; c++){
			if (p.cities[c].prestigeType ==0) prestige = "";
			if (p.cities[c].prestigeType ==1) prestige = "Druid";
			if (p.cities[c].prestigeType ==2) prestige = "Fey";
			if (p.cities[c].prestigeType ==3) prestige = "Briton";
			t.dat.push ([p.displayName, parseInt(p.might), p.officerType, parseInt(p.numCities), parseInt(p.cities[c].tileLevel),
	       	parseInt(p.cities[c].xCoord), parseInt(p.cities[c].yCoord), p.cities[c].cityName, 0, status,0,p.userId,prestige,p.userId,p.cities[c].tileProvinceId,p.cities[c].dateCreated,p.cities[c].desertionBuffExpire,p.cities[c].prestigeBuffExpire,p.cities[c].blessing,p.cities[c].prestigeLevel,p.cities[c].cityStatus]);
	    }
	    t.setDistances (Cities.cities[0].x, Cities.cities[0].y);
	    t.ModelCity=Cities.cities[0];
	    t.setEta();
	    t.fetchPlayerLastLogin (uid, function (r) {t.displayPlayer(p.allianceName,r)});
	}, 
	gotPlayerLeaderboard : function (rslt, span){
		var t = Tabs.AllianceList;
		if (!rslt.ok){
			span.innerHTML = rslt.errorMsg;
			return;
		}
		if (rslt.totalResults == 0){
			span.innerHTML = '<B>'+unsafeWindow.g_js_strings.commonstr.leaderboard+': </b>'+unsafeWindow.itemlist.i10021.name+'?<BR>';
			return;
		}
		var p = rslt.results[0];
		var an = p.allianceName;
		if (!an || an=='' || p.officerType==4) an = 'none';
		else an += ' ('+ officerId2String(p.officerType) +')';
		pStr = JSON2.stringify(p);
		m = '<TABLE cellspacing=0 class=pbTab><TR><TD><B>'+unsafeWindow.g_js_strings.commonstr.leaderboard+': </b></td><TD colspan=2>'+unsafeWindow.g_js_strings.commonstr.might +': '+ p.might  +' &nbsp; '+unsafeWindow.g_js_strings.commonstr.alliance+': '+ an +'</td></tr>'; 
		for (var i=0; i<p.cities.length; i++){
			var c = p.cities[i];
			var created = '';
			if (c.dateCreated && c.dateCreated.substr(0,2)=='20') created = ' &nbsp; created: ' + c.dateCreated.substr(0,10);
			m += '<TR><TD align=right><B>City #'+ (i+1) +':</b></td><TD> &nbsp; '+ c.cityName 
			m += ' (<a onclick="pbGotoMap ('+ c.xCoord +',' +c.yCoord+ ')">'+ c.xCoord +','+ c.yCoord +'</a>)</td><TD width=75%> &nbsp; level: ';
			m += c.tileLevel +' &nbsp; status: '+ cityStatusString (c.cityStatus) + created +'</td></tr>';
		}  
		span.innerHTML = m + '</table>';
	},
	gotPlayerDetail : function (rslt, span){
		var t = Tabs.AllianceList;
		if (!rslt.ok){
		  span.innerHTML = rslt.errorMsg;
		  return;
		}
		var u = rslt.userInfo[0];
		var a = 'None';
		if (u.allianceName) a = u.allianceName +' ('+ getDiplomacy(u.allianceId) + ')';
		var m = '<DIV style="max-width:550x; width:550px; overflow-y:auto"><TABLE cellspacing=0 class=pbTab><TR><TD><B>Details:</b> &nbsp; </td><TD>'+unsafeWindow.g_js_strings.commonstr.alliance+': '+ a +' &nbsp; '+unsafeWindow.g_js_strings.commonstr.cities+': ';
		m+= u.cities +' &nbsp; '+unsafeWindow.g_js_strings.commonstr.population+': '+ u.population +'</td></tr><TR><TD></td><TD></div>'+unsafeWindow.g_js_strings.commonstr.province+': ';
		var pids = u.provinceIds.split (',');
		var p = [];
		for (var i=0; i<pids.length; i++) p.push(unsafeWindow.provincenames['p'+pids[i]]);
		span.innerHTML = m + p.join (', ') +'</td></tr></table>';
	},
	eventMyAllianceSubmit : function (){
		var t = Tabs.AllianceList;
		document.getElementById('allListOut').innerHTML = '<BR><BR><CENTER>'+unsafeWindow.g_js_strings.commonstr.loadingddd+'</center>';
		t.fetchAllianceMemberList (getMyAlliance()[0], null, t.eventGotMemberList);
	},  
    aName : '',
	eventSubmit : function (){
		var t = Tabs.AllianceList;
		document.getElementById('ptallErr').innerHTML='';
		if (t.clickedAlly) t.aName = t.clickedAllyName;
		else t.aName = document.getElementById('allAllName').value;	
		if (t.aName.length < 3){
		  document.getElementById('ptallErr').innerHTML = unsafeWindow.g_js_strings.getAllianceSearchResults.entryatleast3;
		  return;
		}
		var myA = getMyAlliance ();
		document.getElementById('altInput').innerHTML = '';
		document.getElementById('allListOut').innerHTML = '<BR><BR><CENTER>'+unsafeWindow.g_js_strings.commonstr.loadingddd+'</center>';
		if (myA[0]!=0 && myA[1].toLowerCase().indexOf(t.aName.toLowerCase())>=0) t.fetchAllianceList (t.aName, myA[0], t.eventGotAllianceList);
		else t.fetchAllianceList (t.aName, null, t.eventGotAllianceList);
	},

	eventListSubmit : function (){
		var t = Tabs.AllianceList;
		var myA = getMyAlliance ();
		document.getElementById('allListOut').innerHTML = '<BR><BR><CENTER>'+unsafeWindow.g_js_strings.commonstr.loadingddd+'</center>';
		if (myA[0]!=0  ) {
		   t.curPage=1;
		   t.fetchOtherAllianceInfo ( 1, t.eventGotOtherAlliancePage);
		}
		else document.getElementById('allListOut').innerHTML = unsafeWindow.g_js_strings.membersInfo.youmustbelong;
	},

  eventGotAllianceList : function (rslt){
    var t = Tabs.AllianceList;
    if (!rslt.ok){
      document.getElementById('allListOut').innerHTML = rslt.errorMsg;
      return;
    }
    var m = '<DIV class=pbStat>'+unsafeWindow.g_js_strings.commonstr.alliances+'<B>"'+ t.aName +'"</b></div>\
    <TABLE><TR style="font-weight:bold"><TD class=xtab>'+unsafeWindow.g_js_strings.commonstr.alliance+'</td><TD class=xtab>'+unsafeWindow.g_js_strings.commonstr.rank+'</td><TD class=xtab>'+unsafeWindow.g_js_strings.commonstr.members+'</td>\
        <TD align=right class=xtab>'+unsafeWindow.g_js_strings.commonstr.might+'</td><TD class=xtab>'+unsafeWindow.g_js_strings.getAllianceSearchResults.currdiplo+'</td><TD class=xtab>'+unsafeWindow.g_js_strings.commonstr.members+'</td><TD class=xtab>'+unsafeWindow.g_js_strings.commonstr.viewmap+'</td></tr>';
    for (k in rslt.alliancesMatched){
      var all = rslt.alliancesMatched[k];
      var dip = '';
      if (all.relation && all.relation==1)
        dip = unsafeWindow.g_js_strings.commonstr.friendly;
      else if (all.relation && all.relation==2)
        dip = unsafeWindow.g_js_strings.commonstr.hostile;
      m += '<TR><TD class=xtab>'+ all.allianceName +'</td><TD align=right class=xtab>'+ all.ranking +'</td><TD align=right class=xtab>'+ all.membersCount +'</td>\
       <TD align=right class=xtab>'+ addCommasInt(all.might) +'</td><TD class=xtab>'+ dip +'</td>\
       <TD class=xtab><a onclick="PTgetMembers('+ all.allianceId +')">'+unsafeWindow.g_js_strings.commonstr.members+'</a></td>\
        <TD class=xtab><a onclick="PTPaintMembers('+ all.allianceId +')">'+unsafeWindow.g_js_strings.commonstr.viewmap+'</a></td></tr>';
    }
    document.getElementById('allListOut').innerHTML = m;
  },


  showMyAlliance : function (){
    var t = Tabs.AllianceList;
    var myA = getMyAlliance ();
    document.getElementById('allListOut').innerHTML = '<BR><BR><CENTER>'+unsafeWindow.g_js_strings.commonstr.loadingddd+'</center>';
    if (myA[0]!=0  ) {
       t.eventGetMembers(myA[0],false);
    }
    else {
       document.getElementById('allListOut').innerHTML = unsafeWindow.g_js_strings.membersInfo.youmustbelong;
    }
  },

  curPage : 0,
  MaxPage : 0,

  eventListNext : function (amt){
    var t = Tabs.AllianceList;
    if( parseInt(amt) >= 9999 )
       t.curPage = t.MaxPage;
    else {
      t.curPage = parseInt(t.curPage) + parseInt(amt);
      if ( t.curPage > t.MaxPage) {
        t.curPage = t.MaxPage;
      }
    }
    document.getElementById('allListOut').innerHTML = '<BR><BR><CENTER>'+unsafeWindow.g_js_strings.commonstr.loadingddd+'</center>';
    t.fetchOtherAllianceInfo (t.curPage, t.eventGotOtherAlliancePage);
  },

  eventListPrev : function (amt){
    var t = Tabs.AllianceList;
    if(amt <= -1)
       t.curPage = 1;
    else {
      t.curPage-=amt;
      if ( t.curPage < 1 ) {
        t.curPage = 1;
      }
    }
    document.getElementById('allListOut').innerHTML = '<BR><BR><CENTER>'+unsafeWindow.g_js_strings.commonstr.loadingddd+'</center>';
    t.fetchOtherAllianceInfo (t.curPage, t.eventGotOtherAlliancePage);
  },

   eventGotOtherAlliancePage : function (rslt){
    var t = Tabs.AllianceList;

    if (!rslt.ok){
      document.getElementById('allListOut').innerHTML = rslt.errorMsg;
      return;
    }

    //  document.getElementById('idPageNum').value = t.curPage;

    t.MaxPage=rslt.noOfPages;
    //document.getElementById('idMaxPageNum').innerHTML = 'of ' + t.MaxPage;

    var m = '<div style="overflow:auto; height:556px;width:650px;"><TABLE><thead><TR style="font-weight:bold"> \
        <th class=xtab>'+unsafeWindow.g_js_strings.modaltitles.alliance+'</th><th class=xtab>'+unsafeWindow.g_js_strings.commonstr.rank+'</th><th class=xtab>'+unsafeWindow.g_js_strings.commonstr.members+'</th>\
        <th align=right class=xtab>'+unsafeWindow.g_js_strings.commonstr.might+'</th><th class=xtab>'+unsafeWindow.g_js_strings.getAllianceSearchResults.currdiplo+'</th><th class=xtab>'+unsafeWindow.g_js_strings.commonstr.members+'</th><th class=xtab>'+unsafeWindow.g_js_strings.commonstr.viewmap+'</th></tr></thead><tbody>';
    document.getElementById('allListOut').innerHTML = m;

    for (var i=0; i<rslt.otherAlliances.length; i++) {
      var alliance = rslt.otherAlliances[i];
      var dip = '';
      dip = getDiplomacy(alliance.allianceId);

      m += '<TR class="'+ dip + '"><TD class=xtab>' + alliance.name +'</td><TD align=right class=xtab>'+ alliance.ranking +'</td><TD align=right class=xtab>'+ alliance.membersCount +'</td>\
       <TD align=right class=xtab>'+ addCommasInt(alliance.might) +'</td><TD class=xtab>'+ dip +'</td>\
       <TD class=xtab><a onclick="PTgetMembers('+ alliance.allianceId +')">'+unsafeWindow.g_js_strings.commonstr.members+'</a></td>\
         <TD class=xtab><a onclick="PTPaintMembers('+ alliance.allianceId +')">'+unsafeWindow.g_js_strings.commonstr.viewmap+'</a></td></tr>';
    }
    m += '</tbody></TABLE><div style="font-weight:bold"; height:20px;width:560px; ><span> <a onclick="PTalClickPrev(-1)"> [|<] </a><a onclick="PTalClickPrev(10)"> [-10] </a><a onclick="PTalClickPrev(5)"> [-5] </a><a onclick="PTalClickPrev(1)"> [<] </a> \
          <a onclick="PTalClickNext(1)"> [>] </a><a onclick="PTalClickNext(5)"> [+5] </a><a onclick="PTalClickNext(10)"> [+10] </a><a onclick="PTalClickNext(9999)"> [>|] </a> </span></div>';
    m += '</div>';
    document.getElementById('allListOut').innerHTML = m;
 },

  showCurrentPage : function (){
    var t = Tabs.AllianceList;
    var myA = getMyAlliance ();

    document.getElementById('allListOut').innerHTML = '<BR><BR><CENTER>'+unsafeWindow.g_js_strings.commonstr.loadingddd+'</center>';
    if (myA[0]!=0  ) {
       t.fetchOtherAllianceInfo ( t.curPage, t.eventGotOtherAlliancePage);
    }
    else {
       t.fetchOtherAllianceInfo ( t.curPage, t.eventGotOtherAlliancePage);
    }

  },

  eventGotMemberList : function (rslt){
    var t = Tabs.AllianceList;
    if (!rslt.ok){
      document.getElementById('allListOut').innerHTML = rslt.errorMsg;
      return;
    }
    t.memberListRslt = rslt;
    var uList = [];
    for (k in rslt.results)
      uList.push (rslt.results[k].userId);     
    t.fetchPlayerStatus (uList, function(r){t.eventGotMemberOnlineList(r)});    
  },    
    
  eventGotMemberOnlineList : function (rslt){
    var t = Tabs.AllianceList;
    var numInvalid = 0;
    var numPlayers = 0;
    var myA = getMyAlliance ();
    var prestige="";
    t.dat = [];
    for (var i=0; i<t.memberListRslt.results.length; i++){
      p = t.memberListRslt.results[i];
      if (p.userId == 0){
        ++numInvalid;
      } else {
        ++numPlayers;
        if ( myA[0] == p.allianceId)
           t.friendEta = true;
        else
           t.friendEta = false;
        for (var c=0; c<p.cities.length; c++){
          if (p.cities[c].prestigeType ==0) prestige = "";
          if (p.cities[c].prestigeType ==1) prestige = "Druid";
          if (p.cities[c].prestigeType ==2) prestige = "Fey";
          if (p.cities[c].prestigeType ==3) prestige = "Briton";
          t.dat.push ([p.displayName, parseInt(p.might), p.officerType, parseInt(p.numCities), parseInt(p.cities[c].tileLevel),
               parseInt(p.cities[c].xCoord), parseInt(p.cities[c].yCoord), p.cities[c].cityName, 0, rslt.data[p.userId]?1:0,'--',p.userId,prestige,p.userId,p.cities[c].tileProvinceId,p.cities[c].dateCreated,p.cities[c].desertionBuffExpire,p.cities[c].prestigeBuffExpire,p.cities[c].blessing,p.cities[c].prestigeLevel,p.cities[c].cityStatus]);
        }
      }
    }
    t.setDistances (Cities.cities[0].x, Cities.cities[0].y);
    t.ModelCity=Cities.cities[0];
    t.setEta();
    t.displayMembers (t.memberListRslt.allianceName, numPlayers);
  },

  // sort and display
  reDisp : function (){
    var t = Tabs.AllianceList;
    function sortFunc (a, b){
      var t = Tabs.AllianceList;
      if (typeof(a[t.sortColNum]) == 'number'){
        if (t.sortDir > 0)
          return a[t.sortColNum] - b[t.sortColNum];
        else
          return b[t.sortColNum] - a[t.sortColNum];
      } else if (typeof(a[t.sortColNum]) == 'boolean'){
// TODO !!        
return 0;        
      } else {
        if (t.sortDir > 0)
          return a[t.sortColNum].localeCompare(b[t.sortColNum]);
        else
          return b[t.sortColNum].localeCompare(a[t.sortColNum]);
      }
    }
    t.dat.sort (sortFunc);
    var m = '';
    var cityName= "";
    for (var i=0; i<t.dat.length; i++){
      cityName = t.dat[i][5].toString() + t.dat[i][6].toString();
      var status = '<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAWJJREFUeNrUU79PwkAUvv5IG6iAg8HEMIlxNLBCNxkkYah/gP6NmAChiYQUupjA4uCicbKJBQ0E24OWtvjdgCHGdmHyJV/efffuvrx37x232WzIPsaTPW1vAXGXaJpGRFGUOY67AD0FMsAX8IpSH4Mg8JrNZrwATI6i6KrRaGjVarWWTqePXde1TdO873Q67GYX8GIFwjAs1ev160qlckMp5QG2XQC/Xa1WnK7r7+APsQLr9fq8XC7XbNvmWXd832d7BFnxxWKxhnUvUQAXcqg/7zgOcRyKjIKfmCRJeRZPfETP89zJ5HO6XIYngiAThq1R6k5ZPLGNOPBsGMYglcpEsqyQLSRJicbj8YDFEzOwLGvUat21KfVFVb1Us9nc0WIx/xgOe2a/323PZrPRbwFud5RRvyQIwpmiKCX4AvgB4g6684Z2PsG/MJ4kIMAdsnn4Y+jYi85x3o8V+J+f6VuAAQDR57f+eJX9fgAAAABJRU5ErkJggg=="/>';
      if (t.dat[i][9] ==1) status = '<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAVNJREFUeNrUk09OwkAUh9+gUKpAFIuIfxJilLIlMd6gaw+Ax/AY7r2AnMFFb2DcC5gYYlBotYKttEwp83zjQtFIN6x8yZfJ9PfypZM3wxARFqkELFgLC5ZnN+yyQF9YjrR12hpEiegRJghoQIQunj7PF1DlQOB5dadi6Nt6cSWlKiPu8+ZTq9bu3tUoPyPc+UcQWK9sHRh6oVIOXF91XpzE2AtUXTss72tlQ+axR4AQjb313aJlWSCEAM75J3JS2dVMUebUdREjECWcojLwBiCZRJOvKB2mFZnH/wEXvb7b5zbaKmR+No6jMZd5/Bg5mt3HByupJQE24Js8gD/0LJnHC0zecNuO6d06HcGmAWRBTCEK/NZbh9+PTJn/FrDZq8wYS0GeVeE4cQIldkT6TZq/DT28gWtxBa/YpP73OMESLWuE8seli4gh9YdzBf/zMX0IMACs96WetcYlTQAAAABJRU5ErkJggg=="/>';      

      m += '<TR style="max-height:30px"><TD class=xxtab>'+ status + '<SPAN onclick="PTPlayClick(this, \''+ t.dat[i][13] +'\',\''+ t.dat[i][9] +'\')"><A>'+ t.dat[i][0] +'</a></span></td><TD align=right class=xxtab>'+ addCommasInt(t.dat[i][1]);
      m +='</td><TD align=center class=xxtab>'+ t.dat[i][12] +'</td><TD class=xxtab>'+ officerId2String(t.dat[i][2]);                      
      m +='</td><TD class=xxtab><INPUT id=ScoutCheckbox_'+cityName+' type=checkbox unchecked=true></td><TD class=xxtab><a class=hasTooltip>'+ t.dat[i][7] +'<SPAN>'+t.makeToolTip(i)+'</span></td><TD align=right class=xxtab>'+ t.dat[i][4];
      m +='</td><TD align=center class=xxtab><DIV onclick="pbGotoMap('+ t.dat[i][5] +','+ t.dat[i][6] +')"><A>'+ t.dat[i][5] +','+ t.dat[i][6] +'</a></div></td>';
      m +='<TD align=right class=xxtab style="padding-right:20px;">'+ t.dat[i][8].toFixed(2) +'</td>'
      m +='</td><TD  nowrap class=xxtab>'+ (t.dat[i][10]?'<SPAN>'+ (t.dat[i][10]>0?timestr(t.dat[i][10],1):'--') +'</span>':'<SPAN>--</span>') +'<td class=xxtab><SPAN onclick="PCplo(this, \''+ t.dat[i][11] +'\')"><A>Login</a></span></td>';
      //if (t.dat[i][14]!=undefined && t.dat[i][14]!='0000-00-00 00:00:00') m +='<TD>'+t.dat[i][14]+'</td>';
      //m +='<TD><a class=hasTooltip>Info<SPAN>'+t.makeToolTip()+'</span></a></td>';
      m +='</tr>';

    }
    var tbody = document.getElementById('allBody');
    tbody.style.maxHeight = '';
    tbody.innerHTML = m;


    if (parseInt(tbody.clientHeight) > 470){
      tbody.style.height = '470px';
      tbody.style.maxHeight = '470px';
    }
  },

  makeToolTip: function(i){
  	var t = Tabs.AllianceList;
  	var msg = '<TABLE class=pbTab><TR><TD>Province</td><TD>' + unsafeWindow.provincenames['p'+ t.dat[i][14]] + '</td></tr>';
  	msg += '<TR><TD>Date created</td><TD>' + t.dat[i][15] + '</td></tr>';
  	msg += '<TR><TD>Desertion Buff Exp.</td><TD>' + t.dat[i][16] + '</td></tr>';
  	if (t.dat[i][19] > 0) {
  		var blessing =  t.dat[i][18].split(',');
  		msg += '<TR><TD>Prestige Buff Exp.</td><TD>' + t.dat[i][17] + '</td></tr>';
  		msg += '<TR><TD>Prestige Level</td><TD>' + t.dat[i][19] + '</td></tr>';
  		for (var y=1;y<=t.dat[i][19];y++) {
  			msg += '<TR><TD>Blessing '+y+'</td><TD>' + unsafeWindow.g_js_strings.blessingSystem['blessing_name_'+blessing[y-1]] + '</td></tr>';
  			msg += '<TR><TD></td><TD>'+unsafeWindow.g_js_strings.blessingSystem['blessing_description_'+blessing[y-1]]+'</td></tr>';
  		}  		
  	}
  	msg += '<TR><TD>City Status</td><TD>' + t.dat[i][20] + '</td></tr>';
  	msg += '</table>'
  	return msg;	
  },

  clickedPlayerInAll : function (span,uid,status){
    var t = Tabs.AllianceList;
    t.clickedPlayerLeaderboard2(span,uid,status);
  },

  setDistances : function (x, y){
    var t = Tabs.AllianceList;
    for (var i=0; i<t.dat.length; i++) t.dat[i][8] = distance (x, y, t.dat[i][5], t.dat[i][6]);
  },

  friendEta:false,

  setEta : function (){
    var t = Tabs.AllianceList;
    for (var i=0; i<t.dat.length; i++) {
      if (t.dat[i][8]) {
        var eta = t.estETA(parseFloat(t.dat[i][8]));
        if (t.friendEta)
           t.dat[i][10] = eta.friendETA;
        else
           t.dat[i][10] = eta.ETA;
      }
    }
  },



  handleEtaSelect : function (){
    var t = Tabs.AllianceList;
    t.setEta();
    t.reDisp();
  },

  sortColNum : 8,
  sortDir : 1,

  displayMembers : function (allName, numPlayers){
    var t = Tabs.AllianceList;
    function alClickSort (e){
      var t = Tabs.AllianceList;
      var newColNum = e.id.substr(8);
      document.getElementById('clickCol'+t.sortColNum).className = 'clickable';
      e.className='clickable clickableSel';
      if (newColNum == t.sortColNum)
        t.sortDir *= -1;
      else
        t.sortColNum = newColNum;
      t.reDisp();
    }
    unsafeWindow.PTalClickSort = alClickSort;
    var m = '<STYLE>.clickable{background-color:#ddd; border:2px outset; border-color:#555; padding-left:5px; padding-right:5px}\
            .clickableSel{background-color:#ffffcc;}\
            .xxtab{background-color:none; padding-left:5px; padding-right:5px;} </style>\
      <DIV class=pbStat ><TABLE id=tabAllMembers cellpadding=0  width=100%><TR font-weight:bold"><TD class=xtab> &nbsp; '+ allName +'</td>\
        <TD class=xtab width=80% align=center>'+unsafeWindow.g_js_strings.commonstr.distance+ unsafeWindow.g_js_strings.commonstr.from+' <SPAN id=distFrom>'+ Cities.cities[0].name +' ('+ Cities.cities[0].x +','+ Cities.cities[0].y +')</span></td><TD class=xtab align=right>'+ numPlayers + unsafeWindow.g_js_strings.commonstr.members+'&nbsp; </td></tr></table></div>\
       <div style="max-height:500px; height:500px; overflow-y:auto;"><TABLE id=tabAllMembers align=center cellpadding=0 cellspacing=0><THEAD style="overflow-y:auto;">\
      <TR style="font-weight:bold"><TD id=clickCol0 onclick="PTalClickSort(this)" class=clickable><A><DIV>'+unsafeWindow.g_js_strings.commonstr.player+'</div></a></td>\
         <TD id=clickCol1 onclick="PTalClickSort(this)" class=clickable align=center><A><DIV>Might</a></div></td>\
        <TD id=clickCol3 onclick="PTalClickSort(this)" class=clickable><A><DIV>Faction</a></div></td>\
        <TD id=clickCol2 onclick="PTalClickSort(this)" class=clickable align=center><A><DIV>Rank</a></div></td>\
        <TD id=clickCol9 class=clickable align=center><DIV><INPUT id=ToggleScoutCheckbox type=checkbox unchecked=true></div></td>\
        <TD id=clickCol7 onclick="PTalClickSort(this)" class=clickable><A><DIV>City Name</a></div></td>\
        <TD id=clickCol4 onclick="PTalClickSort(this)" class=clickable><A><DIV>Lvl</a></div></td>\
        <TD id=clickCol5 onclick="PTalClickSort(this)" class=clickable><A><DIV>Coords</a></div></td>\
        <TD id=clickCol8 onclick="PTalClickSort(this)" class=clickable><A><DIV>Dist.</a></div></td>\
        <TD id=clickCol10 onclick="PTalClickSort(this)" class=clickable><A><DIV>Eta</a></div></td>\
        <TD class=clickable><A><DIV>Login</a></div></td></tr></thead>\
      <TBODY id=allBody style="background-color:#ffffff;"></tbody></table></div>';
      
    document.getElementById('allListOut').innerHTML = m; //style="top:670px; left:0px; position:absolute;

    m = '<HR><TABLE width=100% cellpaddding=0><TR>';
    m+= '<TD class=xtab>Show distance from: &nbsp; X: <INPUT size=2 type=text id=plyrX /> Y: <INPUT size=2 type=text id=plyrY /> &nbsp; Or, choose city: <span id=dmcoords></span></td></tr>';
    m+= '<TR><TD class=xtab><DIV id=PaintScout></div></td></tr></table>';
    document.getElementById('altInput').innerHTML = m;

        
    document.getElementById('clickCol'+t.sortColNum).className = 'clickable clickableSel';
    document.getElementById('ToggleScoutCheckbox').addEventListener ('change', t.doSelectall,false);

    t.reDisp();
    //CdispCityPicker (id, span, dispName, notify, selbut, disable_list)
    t.CityFrom = new CdispCityPicker ('plyrdcp', document.getElementById ('dmcoords'), true, t.eventCoords, 0);
    document.getElementById('plyrX').value = t.CityFrom.city.x;
	document.getElementById('plyrY').value = t.CityFrom.city.y;
    
    document.getElementById('plyrY').addEventListener ('change', function(){t.eventCoords(null,document.getElementById('plyrX').value,document.getElementById('plyrY').value);},false); 
    document.getElementById('plyrX').addEventListener ('change', function(){t.eventCoords(null,document.getElementById('plyrX').value,document.getElementById('plyrY').value);},false); 
    document.getElementById('idFindETASelect').disabled = false;
    t.eventCoords(t.CityFrom.city.id,t.CityFrom.city.x,t.CityFrom.city.y);
  },
  
  displayPlayer : function (allName,rslt){
    var t = Tabs.AllianceList;
    var status = "";
    function alClickSort (e){
      var t = Tabs.AllianceList;
      var newColNum = e.id.substr(8);
      document.getElementById('clickCol'+t.sortColNum).className = 'clickable';
      e.className='clickable clickableSel';
      if (newColNum == t.sortColNum)
        t.sortDir *= -1;
      else
        t.sortColNum = newColNum;
      t.reDisp();
    }
    unsafeWindow.PTalClickSort = alClickSort;

    switch (parseInt(rslt.playerInfo.warStatus)) {
        case 1: status = unsafeWindow.g_js_strings.commonstr.normal;break;
        case 2: status = unsafeWindow.g_js_strings.MapObject.begprotect;break;
        case 3: status = unsafeWindow.g_js_strings.commonstr.truce;break;
        case 4: status = unsafeWindow.g_js_strings.commonstr.vacation;break;
        default: status = unsafeWindow.g_js_strings.commonstr.normal
    }

    var m = '<STYLE>.clickable{background-color:#ddd; border:2px outset; border-color:#555; padding-left:5px; padding-right:5px}\
            .clickableSel{background-color:#ffffcc;}\
            .xxtab{background-color:none; padding-left:5px; padding-right:5px;} </style>\
             <DIV id=playerInfo></div><DIV id=TRStats></div>\
      <div style="max-height:470px; height:470px; overflow-y:auto;"><TABLE id=tabAllMembers align=center cellpadding=0 cellspacing=0><THEAD style="overflow-y:hidden;">\
      <TR style="font-weight:bold"><TD id=clickCol0 onclick="PTalClickSort(this)" class=clickable><A><DIV>Player</div></a></td>\
        <TD id=clickCol1 onclick="PTalClickSort(this)" class=clickable align=center><A><DIV>Might</a></div></td>\
        <TD id=clickCol3 onclick="PTalClickSort(this)" class=clickable><A><DIV>Faction</a></div></td>\
        <TD id=clickCol2 onclick="PTalClickSort(this)" class=clickable align=center><A><DIV>Rank</a></div></td>\
        <TD id=clickCol9 class=clickable align=center><DIV><INPUT id=ToggleScoutCheckbox type=checkbox unchecked=true></div></td>\
        <TD id=clickCol7 onclick="PTalClickSort(this)" class=clickable><A><DIV>City Name</a></div></td>\
        <TD id=clickCol4 onclick="PTalClickSort(this)" class=clickable><A><DIV>Lvl</a></div></td>\
        <TD id=clickCol5 onclick="PTalClickSort(this)" class=clickable><A><DIV>Coords</a></div></td>\
        <TD id=clickCol8 onclick="PTalClickSort(this)" class=clickable><A><DIV>Distance</a></div></td>\
        <TD id=clickCol10 onclick="PTalClickSort(this)" class=clickable><A><DIV>Eta</a></div></td>\
    <TD class=clickable><A><DIV>Login</a></div></td>\
    <TD class=clickable><A><DIV>Prestige Buff Exp.</a></div></td></tr></thead>\
      <TBODY id=allBody style="background-color:#ffffff;"></tbody></table></div>\
      <DIV  width:100%; style="top:670px; left:0px; position:absolute; background-color:#ffffff; border-top:1px solid; margin-top:8px; color:#700; font-weight:bold;">';
    document.getElementById('allListOut').innerHTML = m;  //style="top:670px; left:0px; position:absolute;
    
    m = '<HR><TABLE width=100% cellpaddding=0><TR align=left>';
    m+= '<TD class=xtab>Show distance from: &nbsp; X: <INPUT size=2 type=text id=plyrX /> Y: <INPUT size=2 type=text id=plyrY /> &nbsp; Or, choose city: <span id=dmcoords></span></td></tr>';
    m+= '<TR align=left><TD class=xtab><DIV id=PaintScout></div></td></tr></table>';
    document.getElementById('altInput').innerHTML = m;

    m = '<TABLE><TR><TD class=xtab style="width:75px">Alliance:</td><TD class=xtab style="width:150px"><a onclick="PTgetMembers('+ rslt.playerInfo.allianceId +')">'+rslt.playerInfo.allianceName+'</a></td></tr>';
    m+= '<TR><TD class=xtab>Last Login:</td><TD class=xtab>' + rslt.playerInfo.lastLogin + '</td></tr>';
    m+= '<TR><TD class=xtab>Status:</td><TD class=xtab>' + status + '</td>';
    now = unixTime();
    if (rslt.playerInfo.warStatus > 1 && ((rslt.playerInfo.truceExpireUnixTime - now)>0)) m+= '<TD class=xtab>Expires: ' + rslt.playerInfo.truceExpireTimestamp + ' (' + timestr(rslt.playerInfo.truceExpireUnixTime - now) +')</td></tr>';
    if (t.dat.length ==0) m+= '<TR><TD class=xtab><B>MISTED?</b></td><TD class=xtab>Expires: ' + rslt.playerInfo.fogExpireTimestamp +'</td></tr>';
    m+= '<TR><TD class=xtab>Glory:</td><TD class=xtab><DIV id=PaintGlory></div></td></tr><TR><TD class=xtab>Max Glory:</td><TD class=xtab><DIV id=PaintMaxGlory></div></td></tr><TR><TD class=xtab>Provinces:</td><TD class=xtab><DIV id=PaintProvinces></div></td></tr>';

    m +='</table><BR>Compare Throne Room : <INPUT id=CompareTR type=submit class=pbButton value="Compare"><INPUT id=CalcTR type=submit class=pbButton value="Calculate"><BR><BR>';

    document.getElementById('playerInfo').innerHTML = m;
    document.getElementById('ToggleScoutCheckbox').addEventListener ('change', t.doSelectall,false);
    document.getElementById('CompareTR').addEventListener ('click', function (){t.TRStats(rslt.playerInfo.userId,rslt.playerInfo.displayName,"Compare")},false);
    document.getElementById('CalcTR').addEventListener ('click', function (){t.TRStats(rslt.playerInfo.userId,rslt.playerInfo.displayName,"Calc")},false);
    document.getElementById('clickCol'+t.sortColNum).className = 'clickable clickableSel';

    t.PaintGlory(rslt.playerInfo.userId);
    t.fetchPlayerInfo (rslt.playerInfo.userId, function (r) {t.PaintProvinces(r)});
    t.reDisp();
    t.CityFrom = new CdispCityPicker ('plyrdcp', document.getElementById ('dmcoords'), true, t.eventCoords, 0);
    document.getElementById('plyrX').value = t.CityFrom.city.x;
	document.getElementById('plyrY').value = t.CityFrom.city.y;
    document.getElementById('idFindETASelect').disabled = false;
    document.getElementById('plyrY').addEventListener ('change', function(){t.eventCoords(null,document.getElementById('plyrX').value,document.getElementById('plyrY').value);},false); 
    document.getElementById('plyrX').addEventListener ('change', function(){t.eventCoords(null,document.getElementById('plyrX').value,document.getElementById('plyrY').value);},false); 
  	t.eventCoords(t.CityFrom.city.id,t.CityFrom.city.x,t.CityFrom.city.y);
  },

   PaintProvinces: function(r){
   		document.getElementById('PaintProvinces').innerHTML="";
   		var pids = r.userInfo[0].provinceIds.split (',');
		var p = [];
		for (var i=0; i<pids.length; i++) p.push(unsafeWindow.provincenames['p'+pids[i]]);
		document.getElementById('PaintProvinces').innerHTML = p.join (', ');
   },

  PaintGlory: function(uid){
        var t = Tabs.AllianceList;
        var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
        params.userId = uid;
        params.ctrl = 'PlayerProfile';
		params.action = 'get';
		 
        new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
            method: "post",
            parameters: params,
            onSuccess: function (transport) {
              var rslt = eval("(" + transport.responseText + ")");
              if(rslt.ok) {
                document.getElementById('PaintGlory').innerHTML = addCommas(rslt.profile.glory);
                document.getElementById('PaintMaxGlory').innerHTML = addCommas(rslt.profile.maxGlory);
              } else t.PaintGlory(uid);

            },
            onFailure: function () {
            },
        });   
 },



    HisStatEffects: [],
    MyStatEffects: [],

  TRStats : function (uid,name,what){
    var t = Tabs.AllianceList;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
	params.ctrl = 'throneRoom\\ThroneRoomServiceAjax';
	params.action = 'getEquipped';
	params.playerId = uid;
  	 
    new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch53.php" + unsafeWindow.g_ajaxsuffix, {
    method: "post",
    parameters: params,
    loading: true,
    onSuccess: function (transport) {
      var rslt = eval("(" + transport.responseText + ")");
        if(rslt.ok){
          for (k in unsafeWindow.cm.thronestats.effects) t.HisStatEffects[k] = 0;
          for (kk=0;kk<=6;kk++){
              y = rslt.items[kk];
              if (y != undefined) {
                for (i=1;i<=5;i++) {
                     id = y["effects"]["slot"+i]["id"];
                   tier = parseInt(y["effects"]["slot"+i]["tier"]);
                   level = y["level"];
                   p = unsafeWindow.cm.thronestats.tiers[id][tier];
                   Current = p.base + ((level * level + level) * p.growth * 0.5);
                   if (i<=parseInt(y["quality"])) t.HisStatEffects[id] += Current;
              }
            }
          }
          for (k in unsafeWindow.cm.thronestats.effects) t.MyStatEffects[k] = 0;
            for (k in unsafeWindow.kocThroneItems){
              y = unsafeWindow.kocThroneItems[k];
              for (i=1;i<=5;i++) {
                id = y["effects"]["slot"+i]["id"];
                tier = parseInt(y["effects"]["slot"+i]["tier"]);
                level = y["level"];
                p = unsafeWindow.cm.thronestats.tiers[id][tier];
                Current = p.base + ((level * level + level) * p.growth * 0.5);
                if (y.isEquipped && i<=y["quality"]) t.MyStatEffects[id] += Current
            }
          }
          if (what == "Compare") t.PaintTRCompare(name);
          if (what == "Calc") t.PaintTRCalc(name);
         } else t.TRStatsCompare();
    },
    onFailure: function () {
       return;
    },
  });           
  },


	TRlineHolder : {
		1:{1:"Attack",2:null},2:{1:1,2:17},3:{1:24,2:29},4:{1:34,2:39},5:{1:44,2:50},6:{1:56,2:61},7:{1:17,2:1},8:{1:29,2:24},9:{1:39,2:34},10:{1:50,2:44},11:{1:61,2:56},
		12:{1:"Defense",2:null},13:{1:2,2:18},14:{1:25,2:30},15:{1:35,2:40},16:{1:45,2:51},17:{1:18,2:2},18:{1:30,2:25},19:{1:40,2:35},20:{1:51,2:45},
		21:{1:"Life",2:null},22:{1:3,2:19},23:{1:26,2:31},24:{1:36,2:41},25:{1:46,2:52},26:{1:19,2:3},27:{1:31,2:26},28:{1:41,2:36},29:{1:52,2:46},
		30:{1:"Combat Speed",2:null},31:{1:4,2:20},32:{1:27,2:32},33:{1:47,2:53},34:{1:57,2:62},35:{1:20,2:4},36:{1:32,2:27},37:{1:53,2:47},38:{1:62,2:57},
		39:{1:"Range",2:null},40:{1:5,2:21},41:{1:37,2:42},42:{1:58,2:63},43:{1:21,2:5},44:{1:42,2:37},45:{1:63,2:58},  
		46:{1:"Load",2:null},47:{1:6,2:22},48:{1:48,2:54},49:{1:59,2:64},50:{1:22,2:6},51:{1:54,2:48},52:{1:64,2:59},
		52:{1:"Accuracy",2:null},53:{1:7,2:23},54:{1:28,2:33},55:{1:38,2:43},56:{1:49,2:55},57:{1:60,2:65},58:{1:23,2:7},59:{1:33,2:28},60:{1:43,2:38},61:{1:55,2:49},62:{1:65,2:60}, 
		63:{1:"Other",2:null},64:{1:8,2:8},65:{1:9,2:9},65:{1:10,2:10},66:{1:11,2:11},67:{1:12,2:12},68:{1:13,2:13},69:{1:14,2:14},70:{1:15,2:15},71:{1:16,2:16},72:{1:66,2:66},73:{1:67,2:67},74:{1:68,2:68},75:{1:69,2:69},76:{1:70,2:70},77:{1:71,2:71},78:{1:72,2:72},79:{1:73,2:73},80:{1:74,2:74},81:{1:75,2:75},82:{1:76,2:76},83:{1:77,2:77},84:{1:78,2:78},85:{1:79,2:79},86:{1:80,2:80},87:{1:81,2:81},88:{1:82,2:82},89:{1:83,2:83},90:{1:84,2:84},91:{1:85,2:85},92:{1:86,2:86},93:{1:87,2:87},94:{1:88,2:88},95:{1:89,2:89},96:{1:90,2:90},97:{1:91,2:91},98:{1:92,2:92},99:{1:93,2:93},100:{1:94,2:94},101:{1:95,2:95},102:{1:96,2:96},
	},

	PaintTRCalc : function (name){
		var t = Tabs.AllianceList;
		m = '<BR><BR><DIV style="max-height:690px; height:690px; overflow-y:scroll;"><TABLE><TD width="35px" class=xtab></td><TD class=xtab><B>' + name + '</b><TD  width="50px"></td><TD class=xtab><B>'+ Seed.player.name+'</b></td>';
		for (z=1;z<=102;z++) {
			var HisContent = "";
			var MyContent = "";
			var His = t.TRlineHolder[z][1];
			var My = t.TRlineHolder[z][2];
			var diff = 0;
			var color = "black";
			if (t.TRlineHolder[z][2] == null) {
			  m+= '<TR><TD>&nbsp</td></tr><TR><TD class=xtab></td><TD class=xtab><B><U>' + t.TRlineHolder[z][1] + '</b></u><TD  width="50px" class=xtab></td><TD class=xtab></td></tr>';
			} else {
				if (t.HisStatEffects[His] != 0) HisContent = t.HisStatEffects[His] + '% ' + unsafeWindow.cm.thronestats["effects"][His]["1"];
				if (t.MyStatEffects[My] != 0) MyContent = t.MyStatEffects[My] + '% ' + unsafeWindow.cm.thronestats["effects"][My]["1"]; 
				if (t.HisStatEffects[His] != 0 && t.MyStatEffects[My] != 0) { 
				if (z < 63) diff = (parseInt(t.HisStatEffects[His]) + parseInt(t.MyStatEffects[My]));
				if (z > 63) diff = ( parseInt(t.MyStatEffects[My]) - parseInt(t.HisStatEffects[His]) );
				if (MyContent.indexOf("Debuff") != -1 && diff > 0) color = "red";
				else if (MyContent.indexOf("Debuff") != -1 && diff < 0) color = "green";
				else if (HisContent.indexOf("Debuff") != -1 && diff > 0) color = "green";
				else if (HisContent.indexOf("Debuff") != -1 && diff < 0) color = "red";
				else if (diff < 0) color = "red";
				else color = "green";
				m+='<TR><TD class=xtab><FONT color='+ color +'><I><B>'+ diff +'</b></i></font></td><TD class=xtab>' + HisContent + '</td><TD class=xtab></td><TD class=xtab>' + MyContent + '</td>';
			  } else if (t.HisStatEffects[His] != 0 || t.MyStatEffects[His] != 0) m+='<TR><TD class=xtab></td><TD class=xtab>' + HisContent + '</td><TD class=xtab></td><TD class=xtab>' + MyContent + '</td>';
			  m+='</tr>'; 
			}
		}
		m +='</table></div>';
		var popMsg = null;
		t.popMsg = new pbPopup('pbMailBody', 0, 0, 550, 750, true, function() {clearTimeout (1000);});
		t.popMsg.centerMe (mainPop.getMainDiv());
		t.popMsg.getMainDiv().innerHTML = m;
		t.popMsg.getTopDiv().innerHTML = '<DIV align=center><B>Throne Room Compare</B></DIV>';
		t.popMsg.show(true);  
	},
	PaintTRCompare : function (name){
    	var t = Tabs.AllianceList;
    	m = '<BR><BR><DIV style="max-height:690px; height:690px; overflow-y:scroll;"><TABLE><TD class=xtab></td><TD class=xtab><B>' + name + '</b><TD></td><TD class=xtab><B>'+ Seed.player.name+'</b></td></tr><TR><TD>&nbsp</td></tr>';
  		for (k=1;k<t.MyStatEffects.length;k++) {
    		var HisContent = "";
    		var MyContent = "";
    		if (t.HisStatEffects[k] != 0) HisContent = t.HisStatEffects[k] + '% ' + unsafeWindow.cm.thronestats["effects"][k]["1"];
    		if (t.MyStatEffects[k] != 0) MyContent = t.MyStatEffects[k] + '% ' + unsafeWindow.cm.thronestats["effects"][k]["1"];
    		if (t.HisStatEffects[k] != 0 || t.MyStatEffects[k] != 0) m+='<TR><TD  width="25px" class=xtab></td><TD class=xtab>' + HisContent + '</td><TD  width="50px" class=xtab></td><TD class=xtab>' + MyContent + '</td></tr>';
  		}
		m +='</table></div>';
		var popMsg = null;
		t.popMsg = new pbPopup('pbMailBody', 0, 0, 550, 750, true, function() {clearTimeout (1000);});
		t.popMsg.centerMe (mainPop.getMainDiv());
		t.popMsg.getMainDiv().innerHTML = m;
		t.popMsg.getTopDiv().innerHTML = '<DIV align=center><B>Throne Room Compare</B></DIV>';
		t.popMsg.show(true);  
  	},
	rallypointlevel: 0,
	MaxScouts : function (city){
	    var t = Tabs.AllianceList;
	    var othertroops=0;
	    var max = 0;
	    var maxsend = 0;
	    t.getRallypoint("city" + city.id);
	    RallypointMax = (t.rallypointlevel * 10000);
	    maxsend = RallypointMax + ((RallypointMax / 100) * unsafeWindow.cm.ThroneController.effectBonus(66));
	    for (i=1;i<=12;i++) othertroops += parseInt(document.getElementById('Unt'+3).value);
	    if (othertroops < maxsend) max = (maxsend - othertroops);
	    if (max > Seed.units["city" + city.id]["unt"+3]) max = Seed.units["city" + city.id]["unt"+3];
	    document.getElementById('numScouts').value = max;
  	},

getRallypoint: function(cityId){
  var t = Tabs.AllianceList;

  for (var o in Seed.buildings[cityId]){
    var buildingType = parseInt(Seed.buildings[cityId][o][0]);
    var buildingLevel = parseInt(Seed.buildings[cityId][o][1]);
    if (buildingType == 12) t.rallypointlevel=parseInt(buildingLevel);
   }
 if(t.rallypointlevel == 11) t.rallypointlevel = 15;
 if(t.rallypointlevel == 12) t.rallypointlevel = 20;      
},


  doSelectall : function (){
    var t = Tabs.AllianceList;
    var city = "";
    for (var k=0;k<t.dat.length;k++){
      city = t.dat[k][5].toString() + t.dat[k][6].toString();
      if (document.getElementById('ToggleScoutCheckbox').checked) document.getElementById('ScoutCheckbox_'+city).checked = true;
      else document.getElementById('ScoutCheckbox_'+city).checked = false
    }
  },

  	CheckCityMarches:function(cityID){
  		var Counter=0;
		var now=unixTime();
		if (Seed.queue_atkp['city'+ cityID] != undefined) for (atkp in Seed.queue_atkp['city'+ cityID]) if (Seed.queue_atkp['city'+ cityID][atkp]["marchId"] || Seed.queue_atkp['city'+ cityID][atkp]["returnUnixTime"]>now) Counter++;
		return Counter;
	},

  doAddScout : function (){
    var t = Tabs.AllianceList;
    var count = -1;
    var city="";
    slots = t.CheckCityMarches(t.CityFrom.city.id);
  	rallypointlevel = getRallypoint(t.CityFrom.city.id);
    for (var k=0;k<t.dat.length;k++){ 
      if (t.dat[k][5] != undefined && t.dat[k][6] != undefined){
        var x = t.dat[k][5];
        var y = t.dat[k][6];
        city = t.dat[k][5].toString() + t.dat[k][6].toString();
        var box = 'ScoutCheckbox_'+city;
        if (document.getElementById(box).checked) count++;
        if (document.getElementById(box).checked && (count+1) <= (rallypointlevel-slots))setTimeout(t.doScout,(2000*count), x,y,box);
      }
    }
  },

  doScout : function (x,y,box) {
    var t = Tabs.AllianceList;
    slots = t.CheckCityMarches(t.CityFrom.city.id);
  	rallypointlevel = getRallypoint(t.CityFrom.city.id);
  	if (slots==rallypointlevel) return;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.cid= t.CityFrom.city.id;
	params.type = 3
	params.kid = 0
	params.xcoord = x;
	params.ycoord = y;
	params.u3 = document.getElementById('numScouts').value;
	params.gold = 0;
	params.r1 = 0;
	params.r2 = 0;
	params.r3 = 0;
	params.r4 = 0;
	params.r5 = 0;
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/march.php" + unsafeWindow.g_ajaxsuffix, {
          method: "post",
          parameters: params,
          loading: true,
          onSuccess: function (rslt) {
              var t = Tabs.AllianceList;  
              if (rslt.ok) {
                var timediff = parseInt(rslt.eta) - parseInt(rslt.initTS);
                var ut = unsafeWindow.unixtime();
                var unitsarr=[0,0,0,0,0,0,0,0,0,0,0,0,0];
                for(i = 0; i <= unitsarr.length; i++){
                    if(params["u"+i]){
                      unitsarr[i] = params["u"+i];
                    }
                }
                var resources=new Array();
                resources[0] = params.gold;
                for(i=1; i<=4; i++){
                    resources[i] = params["r"+i];
                }
                var currentcityid =  params.cid;
                unsafeWindow.attach_addoutgoingmarch(rslt.marchId, rslt.marchUnixTime, ut + timediff, params.xcoord, params.ycoord, unitsarr, params.type, params.kid, resources, rslt.tileId, rslt.tileType, rslt.tileLevel, currentcityid, true);
                unsafeWindow.update_seed(rslt.updateSeed)
                if(rslt.updateSeed){unsafeWindow.update_seed(rslt.updateSeed)};
                document.getElementById(box).checked = false;        
              } else if (rslt.error_type==0 || rslt.error_type==8) t.doScout(x,y,box);
          }, 
          onFailure: function () {},
    });
  },

  
  eventCoords : function (city, x, y){
    var t = Tabs.AllianceList;
    document.getElementById('PaintScout').innerHTML = 'Scout selected cities from: ' + t.CityFrom.city.name + ' with <INPUT id=numScouts type=text maxlength=7 size=7 value="1"><INPUT id=MaxScout type=submit class=pbButton value=Max> Scout(s) <INPUT id=scoutAllSelected type=submit class=pbButton value=GO>';
    document.getElementById('scoutAllSelected').addEventListener('click', function (){t.doAddScout();});
    document.getElementById('MaxScout').addEventListener('click', function (){t.MaxScouts(city);});
    var m = '';
    if (city != null) {
    	document.getElementById('plyrX').value = city.x;
    	document.getElementById('plyrY').value = city.y;
    	m = city.name +' ('+ city.x +','+ city.y +')';
    } else m = x +','+ y;
    var distFrom = document.getElementById('distFrom');
    if (distFrom) distFrom.innerHTML = m;
    t.ModelCity=city;
    if (city !=null) t.JumpCity(city.name);
    t.setDistances(x,y);
    t.setEta();
    t.reDisp();
  },

  eventGetMembers : function (aid){
    var t = Tabs.AllianceList;
    document.getElementById('allListOut').innerHTML = '<BR><BR><CENTER>'+unsafeWindow.g_js_strings.commonstr.loadingddd+'</center>';
    t.fetchAllianceMemberList (aid, null, t.eventGotMemberList);
  },

  fetchAllianceMemberList : function (allianceId, allianceName, notify) {
    var t = Tabs.AllianceList;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.type = "might";
    params.page = 1;
    params.perPage = 100;
    if (allianceName)
      params.allianceName = allianceName;
    if (allianceId && allianceId != 0)
      params.allianceId = allianceId;
  	 
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getUserLeaderboard.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        notify (rslt);
      },
      onFailure: function (rslt) {
        notify ({errorMsg:'AJAX error'});
      },
    });
  },

  GetDataForMap : function (allianceId) {
    var t = Tabs.AllianceList;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    var Data=[];
    params.perPage = 100;
    params.allianceId = allianceId;
    params.type = "might";
    params.page = 1;
     
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getUserLeaderboard.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        var city = '';
        for (var i=0; i<rslt.results.length; i++) {
            if (rslt.results[i]['userId'] !=0){
              player = rslt.results[i]['cities'];
              for (var ii=0; ii<player.length; ii++) 
              Data.push ({X:player[ii]['xCoord'],Y:player[ii]['yCoord']});
        }   
        }
        if (Data != []) t.PaintDataOnMap(Data);
      },
      onFailure: function (rslt) {
        notify ({errorMsg:'AJAX error'});
      },
    });
  },
  
  PaintDataOnMap : function(Data){
      var provMapCoordsA = {imgWidth:710, imgHeight:708, mapWidth:670, mapHeight:670, leftMargin:31, topMargin:19};  
      var map = '<DIV id=ptAlliProvMap style="height:'+ provMapCoordsA.imgHeight +'px; width:'+ provMapCoordsA.imgWidth +'px; background-repeat:no-repeat; background-image:url(\''+ URL_PROVINCE_MAP +'\')"></div>';
        
    //alert(Data.toSource());
    //Data = [{X:"700", Y:"700"}, {X:"600", Y:"600"}, {X:"500", Y:"500"},{X:"400", Y:"400"},{X:"300", Y:"300"},{X:"200", Y:"200"},{X:"100", Y:"100"},{X:"0", Y:"0"},{X:"750", Y:"750"}, {X:"650", Y:"650"}, {X:"550", Y:"550"},{X:"450", Y:"450"},{X:"350", Y:"350"},{X:"250", Y:"250"},{X:"150", Y:"150"},{X:"50", Y:"50"}];
              
    document.getElementById('allListOut').innerHTML = map;
    var eMap =  document.getElementById('ptAlliProvMap');
    
    
    
    
    
    for (var cc=0; cc<Seed.cities.length; cc++) {
        var city = Seed.cities;
        var Xplot = parseInt((provMapCoordsA.mapWidth * parseInt(city[cc][2])) / 750);
        var Yplot = parseInt((provMapCoordsA.mapHeight * parseInt(city[cc][3])) / 750);
        var cf = document.createElement ('div');
        cf.style.background = 'black';
        cf.style.opacity = '1.0';
        cf.style.position='relative';
        cf.style.display='block';
        cf.style.width='14px';
        cf.style.height='16px';
        cf.style.border='1px solid #fff';
        cf.style.color = 'white';
        cf.style.textAlign = 'center';
        cf.style.top = (Yplot+provMapCoordsA.topMargin-(cc*16)-8) +'px';      
        cf.style.left = (Xplot+provMapCoordsA.leftMargin-7) +'px';
        cf.innerHTML = (cc+1) +'';
        eMap.appendChild(cf);
        
    }

    for (var i=0;i<Data.length;i++) {
      var x = parseInt(Data[i]['X']);
      var y = parseInt(Data[i]['Y']);
            var xplot = parseInt((provMapCoordsA.mapWidth * x) / 750);
            var yplot = parseInt((provMapCoordsA.mapHeight * y) / 750);
          var ce= document.createElement ('div');
            ce.style.background = 'red';
            ce.style.opacity = '1.0';
            ce.style.position='relative';
            ce.style.display='block';
            ce.style.width='4px';
            ce.style.height='4px';
            ce.style.color = 'white';
            ce.style.textAlign = 'center';
          ce.style.top = (yplot+provMapCoordsA.topMargin -(4*i)-((Seed.cities.length)*18)) +'px';      
          ce.style.left = (xplot+provMapCoordsA.leftMargin -2) +'px';
          //ce.innerHTML = '<span onmouseover="this.innerText='+x+','+y+'" onclick="">A</span>';
          ce.innerHTML = '<DIV onclick="pbGotoMap('+ x +','+ y +')">&nbsp;</div>';
            eMap.appendChild(ce);
       }
       
       
  },
  
  fetchLeaderboard : function (uid, notify) {
    var t = Tabs.AllianceList;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.userId = uid;
    params.type = "might";
    params.page = 1;
     
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getUserLeaderboard.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        notify (rslt);
      },
      onFailure: function (rslt) {
        notify ({errorMsg:'AJAX error'});
      },
    });
  },

  fetchAllianceList : function (allianceName, myAid, notify) {   // at least 3 chars :)
    var t = Tabs.AllianceList;
    function combineResults (rsltA, rsltM, notify){
      if (!rsltA.ok){
        if (rsltA.msg.indexOf("No alliance found under")!=0 || !rsltM.ok){
          notify (rsltA);
          return;
        }
        rsltA.ok = true;
        rsltA.count = 0;
        rsltA.alliancesMatched = {};
      }
      if (rsltM.ok){
        rsltA.alliancesMatched['a'+rsltM.allianceInfo.allianceId] = {allianceId: rsltM.allianceInfo.allianceId, allianceName: rsltM.allianceInfo.allianceName,
              membersCount: rsltM.allianceInfo.members, relation: null, might: rsltM.allianceInfo.might, ranking: rsltM.allianceInfo.ranking};
        ++rsltA.count;
      }
      notify (rsltA);
    }
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.allianceName = allianceName;
     
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/allianceGetSearchResults.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        if (myAid!=null && myAid>0)
          t.fetchMyAllianceInfo  (function (r){ combineResults (rslt, r, notify)});
        else
          notify (rslt);
      },
      onFailure: function (rslt) {
        notify ({errorMsg:'AJAX error'});
      },
    });
  },

  fetchOtherAllianceInfo : function (pageNum, notify){    // as in alliance list, sorted by rank, 10 per page
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.pageNo = pageNum;
    params.cityId = unsafeWindow.currentcityid;
     
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/allianceGetOtherInfo.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        notify (rslt);
      },
      onFailure: function (rslt) {
        notify ({errorMsg:'AJAX error'});
      },
    });
  },

  fetchMyAllianceInfo : function (notify){
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
     
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/allianceGetInfo.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        notify (rslt);
      },
      onFailure: function (rslt) {
        notify ({errorMsg:'AJAX error'});
      },
    });
  },

  fetchPlayerList : function (name, notify){  // at least 3 chars!! 
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.searchName = name;
    params.subType = "ALLIANCE_INVITE";
     
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/searchPlayers.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        notify (rslt);
      },
      onFailure: function (rslt) {
        notify ({errorMsg:'AJAX error'});
      },
    });
  },

  fetchPlayerInfo : function (uid, notify){
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.uid = uid;

    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getUserGeneralInfo.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        notify (rslt);
      },
      onFailure: function (rslt) {
        notify ({errorMsg:'AJAX error'});
      },
    });
  },
  
/***
ajax/getOnline.php:
  (string) ok = true
  (object) data = [object Object]
    (boolean) 4394121 = false
  (undefined) errorMsg: null = null
***/
  fetchPlayerStatus : function (uidArray, notify){
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.checkArr = uidArray.join(',');
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getOnline.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        notify (rslt);
      },
      onFailure: function (rslt) {
        notify ({errorMsg:'AJAX error'});
      },
    });
  },
  
  fetchPlayerLastLogin : function (uid, notify){
      var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
      params.pid = uid;
      new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/viewCourt.php" + unsafeWindow.g_ajaxsuffix, {
        method: "post",
        parameters: params,
        onSuccess: function (rslt) {
          notify (rslt);
        },
        onFailure: function (rslt) {
          notify ({errorMsg:'AJAX error'});
        },
      });
    },
    
    gotPlayerLastLogin : function (rslt, span){
        var t = Tabs.AllianceList;
        if (!rslt.ok){
          span.innerHTML = rslt.errorMsg;
          return;
        }
    
        var p = rslt.playerInfo;
        var lastLogin = rslt.playerInfo.lastLogin;
    
        if (lastLogin) {
          m = '<span style="color:black">'+unsafeWindow.g_js_strings.modal_messages_viewreports_view.lastlogin+': '+lastLogin+'</span>';
        } else {
           m = '<span style="color:red">No login date found: '+lastLogin+'</span>';
        }
        span.innerHTML = m + '';
      },

  ModelCity : {},

  estETA : function(dist) { // Need Relief Station Levels to estimate transport, reinf, or reassign times. 
    var t = Tabs.AllianceList;
    var ret={ETA:0,etaStr:'NA',friendETA:0,friendEtaStr:'NA'};    
    var cityID;
    if (dist <= 0) return ret;
    var EtaType = document.getElementById('idFindETASelect');
    var baseSpeedSel = EtaType.options[EtaType.selectedIndex].value;
    var m = baseSpeedSel.split(',');
    var horse = 0;
    var baseSpeed = 0;
    if(m) {
      horse = parseInt(m[0]);
      baseSpeed = parseInt(m[1]);
    }
    if (baseSpeed == 0) return ret;
    var mmLvl = parseInt(Seed.tech.tch11);//Magical Mapping
    var Speed = 0;
    if (horse){
   //HorsesSiegeSpeed = Base * (1 + MM/10) * (1 + AH/20) 
      var hsLvl = parseInt(Seed.tech.tch12);//Alloy Horse Shoes
      Speed = baseSpeed * (1 + mmLvl/10.0) * (1 + hsLvl/20.0);
    }
    else {
    //FootSpeed = Base * (1 + MM/10)
      Speed = baseSpeed * (1 + mmLvl/10.0);
    }
    //Grid Speed (tiles/second) = Speed (100ths/min) / 6000 
    var gSpeed = 0;
    var estSec;
    if (Speed>0) {
      gSpeed = Speed/6000.0;//0.48333 mm=10, hs=9
      estSec = (parseFloat(dist)/gSpeed).toFixed(0);
    }
    ret.ETA = (parseInt((estSec+''))+30); 
    ret.etaStr = timestr (ret.ETA,1);
    //ret.etaStr = ret.ETA + ', ' + timestr (ret.ETA,1);
    //RS - Cities Relief Station Level
    //Friendly Speed = Speed * (1 + RS/2)
    if (t.ModelCity) {
      cityID = t.ModelCity.id;
      var building = getCityBuilding (cityID, 18);
      if (building) {
        fSpeed = Speed * (1 + parseInt(building.maxLevel)/2);
        gSpeed = fSpeed/6000;
        estSec = (dist/gSpeed).toFixed(0);
        ret.friendETA = parseInt((estSec+''))+30; 
        ret.friendEtaStr = timestr ((ret.friendETA+''),1);
      }
   }
    return ret;
  },
  
     JumpCity:function(city) {
      var t = Tabs.AllianceList;
      for (i=0;i<Seed.cities.length;i++) {
        if (Seed.cities[i][1]==city) var cityNum=i;
      }
      cityNum++;
      var obj = document.getElementById('citysel_'+cityNum);
      return t.ClickWin(window,obj,'click');
   },
   
   ClickWin:function(win,obj,evtName) {
    var evt = win.document.createEvent("MouseEvents");
    evt.initMouseEvent(evtName, true, true, win,
      0, 0, 0, 0, 0, false, false, false, false, 0, null);
    return !obj.dispatchEvent(evt);
   },
};


/*************************************** Train Tab ***********************************************/

Tabs.Train = {
  tabOrder : 3,
  type: 'Tools',
  tabLabel : unsafeWindow.g_js_strings.commonstr.train,
  cont : null,
  timer : null,
  stats : {},
  selectedCity : {},
  cityNum :0,
  trainTimer : null,
  running : false,
  gamble : {"1":{"min":"5","max":"15","cost":"2"},"2":{"min":"10","max":"25","cost":"4"}},
  nextAuto:       null,
  defenseOptions: "<option value='53'>Crossbow</option><option value='55'>Trebuchet</option><option value='60'>Trap</option><option value='61'>Caltrop</option><option value='62'>Spiked Barrier</option>",
  prevCityNo:     0,
  
  init : function (div){
    var t = Tabs.Train;
    t.cont = div;
    unsafeWindow.cancelTrain = t.butcancelTrain;
    unsafeWindow.cancelFort = t.butcancelFort;
    s = "<DIV style='max-height:700px; height:px; overflow-y:auto'><DIV id=trainTopSelect >\
      <DIV class=pbStat id=trainheader>"+unsafeWindow.g_js_strings.modal_openBarracks.trainttl+" & "+unsafeWindow.g_js_strings.modal_openWalls.builddefenses+"</div>\
      <DIV style='height:5px'></div><DIV>\
      <DIV style='text-align:center; margin-bottom:5px;'>"+unsafeWindow.g_js_strings.commonstr.city+": &nbsp; <span id=ptspeedcity></span></div>\
      <TABLE class=pbTab width=100%><TR valign=top><TD width=50%>\
      <TABLE align=center><TR><TD align=right>"+unsafeWindow.g_js_strings.modal_messages_viewdesertionreports.trooptypes+": </td><TD colspan=2>\
      <SELECT id=ptttType>";
     for (i=1;i<=15;i++) s+='<option value='+i+'>'+unsafeWindow.unitcost['unt'+i][0]+'</option>';
      s+="</select> &nbsp; ("+unsafeWindow.g_js_strings.commonstr.max+" <span id=ptttSpMax></span>)</td></tr>\
        <TR><TD align=right>"+unsafeWindow.g_js_strings.modal_barracks_train.numtotrain+": </td><TD><INPUT id='ptttInpPS' size=5 type='text' value='0'\></td>\
        <TD><INPUT id='ptttButMaxPS' type=submit class=pbButton value='"+unsafeWindow.g_js_strings.commonstr.max+"'\> &nbsp; (\
        "+unsafeWindow.g_js_strings.commonstr.max+" <span id=ptttSpMaxPS>0</span>)</td></tr>\
        <TR><TD align=right>"+unsafeWindow.buildingcost.bdg13[0]+": </td><TD><INPUT id='ptttInpSlots' size=2 type='text' value='1'\></td>\
        <TD width=75%><INPUT id='ptttButMaxSlots' type=submit class=pbButton value='"+unsafeWindow.g_js_strings.commonstr.max+"'\> &nbsp;\
        ("+unsafeWindow.g_js_strings.commonstr.max+" <span id=ptttSpMaxSlots>1</span>)</td></tr>\
        <TR><TD align=right valign=top></td><TD colspan=2><INPUT type=CHECKBOX id=chkPop"+ (Options.maxIdlePop?' CHECKED ':'') +"> \
        <SPAN style='white-space:normal;'>"+unsafeWindow.g_js_strings.commonstr.use +" "+ unsafeWindow.g_js_strings.commonstr.workers+"</span>\
        <br><SELECT id=tutelage>\
        <option value='0'><CENTER>--- "+unsafeWindow.g_js_strings.commonstr.items+" "+unsafeWindow.g_js_strings.commonstr.speedup+" ---</center></option>\
        <option value='36'>"+ unsafeWindow.itemlist.i36.name+"</option>\
        <option value='37'>"+ unsafeWindow.itemlist.i37.name+"</option>\
        <option value='38'>"+ unsafeWindow.itemlist.i38.name+"</option>\
        </select>\
        <br><br><SELECT id=pttrgamble>\
        <option value='0'><CENTER>--- "+unsafeWindow.g_js_strings.commonstr.resources+" "+unsafeWindow.g_js_strings.commonstr.speedup+" ---</center></option>\
        <option value=1>Use "+ t.gamble[1].cost+"x resources ("+ t.gamble[1].min+" - "+t.gamble[1].max+"%)</option>\
        <option value=2>Use "+ t.gamble[2].cost+"x resources ("+ t.gamble[2].min+" - "+t.gamble[2].max+"%)</option>\
        </select>\
        </td></tr>\
        <TR><TD colspan=3 align=center><DIV id=pbTroopTimeEst></div></td></tr>\
        <TR><TD colspan=3 align=center><DIV style='height:10px'></div><INPUT id='ptttButDo' type=submit class=pbButton value='"+unsafeWindow.g_js_strings.modal_openBarracks.trainttl+"'\
        ></td></tr>\
        </table></td><TD width=20></td><TD style='border-left:solid 2px;' width=50% align=center>\
        <TABLE align=center><TR><TD align=right>"+unsafeWindow.g_js_strings.modal_openWalls.builddefenses+": </td><TD colspan=2>\
        <SELECT id=pttdType>\
        <option value='53'>"+unsafeWindow.fortcost.frt53[0]+"</option>\
        <option value='55'>"+unsafeWindow.fortcost.frt55[0]+"</option>\
        <option value='60'>"+unsafeWindow.fortcost.frt60[0]+"</option>\
        <option value='61'>"+unsafeWindow.fortcost.frt61[0]+"</option>\
        <option value='62'>"+unsafeWindow.fortcost.frt62[0]+"</option>\
        </select> &nbsp; (<span id=pttdSpMax></span>)</td>\
        <TR><TD align=right>"+unsafeWindow.g_js_strings.modal_walls_train.numdefbuild+": </td><TD><INPUT id='pttdInpPS' size=5 type='text' value='0'\></td>\
        <TD><INPUT id='pttdButMaxPS' type=submit class=pbButton value='"+unsafeWindow.g_js_strings.commonstr.max+"'\> &nbsp; ("+unsafeWindow.g_js_strings.commonstr.max+"\
         <span id=pttdSpMaxPS>0</span>)</td></tr>\
        <TR><TD align=right>"+unsafeWindow.g_js_strings.commonstr.space+"("+unsafeWindow.buildingcost.bdg19[0]+"): </td>\
        <TD><INPUT id='pttdInpSlots' size=2 type='text' value='1'\></td>\
        <TD width=75%><INPUT id='pttdButMaxSlots' type=submit class=pbButton value='"+unsafeWindow.g_js_strings.commonstr.max+"'\>&nbsp; (\
        "+unsafeWindow.g_js_strings.commonstr.max+" <span id=pttdSpMaxSlots></span>)</td></tr>\
        <TR align=center><TD colspan=3><SPAN id=pttdSpace></span></td></tr>\
        <TR><TD colspan=3 align=center><DIV style='height:10px'>\
        <SELECT id=siege>\
        <option value='0'><CENTER>--- "+unsafeWindow.g_js_strings.commonstr.speedup+" ---</center></option>\
        <option value='26'>"+ unsafeWindow.itemlist.i26.name+"</option>\
        </select></div>\
        <BR><INPUT id='pttdButDo' type=submit class=pbButton value='"+unsafeWindow.g_js_strings.modal_openWalls.builddefenses+"'\></td></tr></table>\
        </td></tr></table></div></div>\
        <TABLE align=center width=425 class=pbTab><TR><TD><div id=ptTrainStatus style='overflow-y:auto; max-height:78px;'></div></td></tr></table>\
        <TABLE width=100%><TR><TD colspan=3><DIV id=divSTtop></div></td></tr>\
        <TR><TD width=50% style='padding-left:15px; padding-right:15px'><DIV style='text-align:center'>\
        <B>"+unsafeWindow.g_js_strings.commonstr.troops+" ("+unsafeWindow.g_js_strings.modal_openBarracks.trainingttl+")\
        &nbsp; (<SPAN id=statTTtot></span>)</b><BR><HR></div><DIV id=divSTleft style='overflow-y: auto; height:210px; max-height:210px'></div></td>\
        <TD width=50% style='padding-left:15px; padding-right:15px'><DIV style='text-align:center'><B>"+unsafeWindow.g_js_strings.modal_openWalls.defqueue+"&nbsp; (<SPAN\ id=statDTtot></span>)</b><BR><HR></div><DIV id=divSTright style='overflow-y: auto; height:210px; max-height:210px'></div></td></tr>\
        </div></div><BR>";
    t.cont.innerHTML = s;
    document.getElementById('ptttInpPS').addEventListener('keyup',function(){
        if (document.getElementById('ptttInpPS').value != "") t.dispTroopTrainTimes();
         else{
            document.getElementById('ptttInpPS').value = "0"
            t.dispTroopTrainTimes();
        }
    });
    document.getElementById('ptttType').addEventListener('change',function(){
        if (document.getElementById('ptttInpPS').value > 0) t.dispTroopTrainTimes(); 
    t.lastQueString = null;
    t.displayCityStats();
    });
    var dcp = new CdispCityPicker ('ptspeed', document.getElementById('ptspeedcity'), true, t.clickCitySelect, 0);
    t.TTspMax = document.getElementById ('ptttSpMax');
    t.TTspMaxPS = document.getElementById ('ptttSpMaxPS');
    t.TTspMaxSlots = document.getElementById ('ptttSpMaxSlots');
    t.TTbutMaxSlots = document.getElementById ('ptttButMaxSlots');
    t.TTbutMaxPerSlot = document.getElementById ('ptttButMaxPS');
    t.TTinpPerSlot = document.getElementById ('ptttInpPS');
    t.TTinpSlots = document.getElementById ('ptttInpSlots');
    t.TTselType = document.getElementById ('ptttType');
    t.TTbutDo = document.getElementById ('ptttButDo');
    t.TDspMax = document.getElementById ('pttdSpMax');
    t.TDspMaxPS = document.getElementById ('pttdSpMaxPS');
    t.TDspMaxSlots = document.getElementById ('pttdSpMaxSlots');
    t.TDbutMaxSlots = document.getElementById ('pttdButMaxSlots');
    t.TDbutMaxPerSlot = document.getElementById ('pttdButMaxPS');
    t.TDinpPerSlot = document.getElementById ('pttdInpPS');
    t.TDinpSlots = document.getElementById ('pttdInpSlots');
    t.TDselType = document.getElementById ('pttdType');
    t.TDbutDo = document.getElementById ('pttdButDo');
    t.TDspSpace = document.getElementById ('pttdSpace');
    t.divTrainStatus = document.getElementById ('ptTrainStatus');
          
    t.TTinpSlots.addEventListener ('change', t.updateTopTroops, false);
    t.TTbutMaxPerSlot.addEventListener ('click', t.clickTroopMaxPS, false);
    t.TTbutMaxSlots.addEventListener ('click', t.clickTroopMaxSlots, false);
    t.TTselType.addEventListener ('change', t.changeTroopSelect, false);
    t.TTbutDo.addEventListener ('click', t.clickTroopDo, false);
    t.TDinpSlots.addEventListener ('change', t.updateTopDef, false);
    t.TDselType.addEventListener ('change', t.changeDefSelect, false);
    t.TDbutMaxPerSlot.addEventListener ('click', t.clickDefMaxPS, false);
    t.TDbutMaxSlots.addEventListener ('click', t.clickDefMaxSlots, false);
    t.TDbutDo.addEventListener ('click', t.clickDefDo, false);
    document.getElementById ('chkPop').addEventListener ('change', t.clickCheckIdlePop, false);
    document.getElementById ('pttrgamble').addEventListener ('change', t.changeTroopSelect, false);
    
    document.getElementById ('chkPop').addEventListener ('change', t.clickCheckIdlePop, false);
    t.changeTroopSelect();
    t.changeDefSelect();
  },
  dispTroopTrainTimes:function(){
      var t = Tabs.Train;
      var TroopTypeID = parseInt(document.getElementById('ptttType').value);
      var NumOfTroops = parseInt(document.getElementById('ptttInpPS').value); 
      var TroopTime = unsafeWindow.modal_barracks_traintime(TroopTypeID,NumOfTroops);
      var TroopName = unsafeWindow.unitcost['unt'+ TroopTypeID][0];
      var TotalTime2x5 = TroopTime * 0.95;
      var TotalTime2x15 = TroopTime * 0.85;
      var TotalTime4x10 = TroopTime * 0.9;
      var TotalTime4x25 = TroopTime * 0.75;
      var TotalTimeLancelot = TroopTime * 0.7;
      var TotalTimeArthur = TroopTime * 0.5;
      var TotalTimeMerlin = TroopTime * 0.3;
      var TotalTTS = unsafeWindow.cm.ThroneController.effectBonus(77);
      var baseTime = t.calcBaseTrainTime(TroopTypeID,NumOfTroops);

      message =  '<TABLE align=center><TR>';
      message += '<TR><TD><B>Base Time NO TR: '+ timestr(baseTime,true) +' </b></td></tr>';
      message += '<TR><TD>Time with ' + TotalTTS + '% Throne Boost : </td><TD>' + timestr(TroopTime,true) + '</td></tr>';
      message += '<TR><TD>Time with Lacelot\'s : </td><TD>'+timestr(TotalTimeLancelot,true)+' </td></tr>';
      message += '<TR><TD>Time with Arthur\'s : </td><TD>'+timestr(TotalTimeArthur,true)+' </td></tr>';
      message += '<TR><TD>Time with Merlin\'s : </td><TD>'+timestr(TotalTimeMerlin,true)+'</td></tr>';
      message += '<TR><TD>Time with 2x Reso : </td><TD>'+ timestr(TotalTime2x15,true) + ' - ' + timestr(TotalTime2x5,true) + ' </td></tr>'; 
      message += '<TR><TD>Time with 4x Reso : </td><TD>'+ timestr(TotalTime4x25,true) + ' - ' + timestr(TotalTime4x10,true) + ' </td></tr></table>';
      
      document.getElementById('pbTroopTimeEst').innerHTML = message;
  },
 calcBaseTrainTime:function(d, f) {
  var uw = unsafeWindow
    var c = +(uw.unitcost["unt" + d][7]) * f,
        e, k = {}, h = uw.seed.buildings["city" + uw.currentcityid],
        j = {}, l = uw.seed.knights["city" + uw.currentcityid],
        a, g = uw.seed.leaders["city" + uw.currentcityid];
    k.barracks = 0;
    k.workshop = 0;
    k.stable = 0;
    k.tech = 0;
    k.knight = 0;
    k.ultimate = 0;
    unsafeWindow.jQuery.each(h, function (n, m) {
        m.id = +(m[0]);
        m.level = +(m[1]);
        if (m.id === 13 && m.level > 0) k.barracks += (m.level + 9) 
        if (m.id === 16 && m.level > 0) if (+(d) >= 9) k.workshop = m.level
        if (m.id === 17 && m.level > k.stable) if (+(d) >= 7) k.stable = m.level
    });
    e = k.barracks / 10;
    c = Math.max(1, Math.ceil(c / e));
    e = 1;
    if (l) {
        a = l["knt" + g.combatKnightId];
        if (a) k.knight = (+(a.combatBoostExpireUnixtime) - uw.unixtime() > 0) ? (a.combat * 1.25) : a.combat
         else k.knight = 0  
    }
    if (uw.seed.tech) k.tech = uw.seed.tech.tch5 
    k.ultimate = k.workshop + k.stable + k.tech;
    e = e * (1 + (0.1 * k.ultimate) + (0.005 * k.knight));
    if (uw.cm.WorldSettings.isOn("GUARDIAN_MARCH_EFFECT")) {
        var b = uw.cm.guardianModalModel.getStoneTrainingSpeedBonus();
        e = e * (1 + b)
    }
    c = Math.max(1, Math.ceil(c / e));
    return c
},

  calcTRBoosts : function (StatID){
    var equipped = Seed.throne.slotEquip[1];
    var total = 0;
    for(var k = 0; k<equipped.length; k++){
      var item_id = equipped[k];
      var item = unsafeWindow.kocThroneItems[item_id];
      for(var i = 1; i<=item.quality; i++){
        var id = item['effects']['slot'+i]['id'];
        if(id == StatID){
          var tier = parseInt(item["effects"]["slot"+i]["tier"]);
          var level = item["level"];
          var p = unsafeWindow.cm.thronestats.tiers[id][tier];
          var Percent = p.base + ((level * level + level) * p.growth * 0.5);
          total += Percent;
        }
      }
    }
    return total;
  },
  hide : function (){
    var t = Tabs.Train;
    clearTimeout (t.timer);
  },
  
  show : function (){
    var t = Tabs.Train;
    clearTimeout (t.timer);
    t.displayCityStats();
    t.changeTroopSelect();
    t.changeDefSelect();
    t.timer = setTimeout (t.show, 2000);
  },

/*******  TROOPS  ******/  
  
  updateTopTroops : function (){
    var t = Tabs.Train;
    var slots = parseInt(t.TTinpSlots.value, 10);
    if (isNaN(slots) || slots<0)
      slots = 0;
    t.TTspMax.innerHTML = t.stats.MaxTrain;
    t.TTspMaxSlots.innerHTML = t.stats.barracks - t.stats.queued;
    if (slots<1 || (t.stats.barracks-t.stats.queued < 1))
      t.TTspMaxPS.innerHTML = 0;
    else
      t.TTspMaxPS.innerHTML = parseInt(t.stats.MaxTrain / slots);
  },
      
  
  clickTroopMaxPS : function (){
    var t = Tabs.Train;
    var slots = parseInt(t.TTinpSlots.value, 10);
    if (slots<1 || (t.stats.barracks-t.stats.queued < 1))
      t.TTinpPerSlot.value = 0;
    else
      t.TTinpPerSlot.value = parseInt(t.stats.MaxTrain / slots);
    t.dispTroopTrainTimes();
  },

  clickTroopMaxSlots : function (){
    var t = Tabs.Train;
    t.TTinpSlots.value = t.stats.barracks - t.stats.queued;
  },
  
  clickCitySelect : function (city){
    var t = Tabs.Train;
    t.selectedCity = city;
    t.lastQueString = null;   
    t.lastDQueString = null;   
    t.displayCityStats ();
    t.changeTroopSelect();
    t.changeDefSelect();
    t.JumpCity(city.name);
  },
  
  JumpCity:function(city) {
        var t = Tabs.AllianceList;
        for (i=0;i<Seed.cities.length;i++) {
          if (Seed.cities[i][1]==city) var cityNum=i;
        }
        cityNum++;
        var obj = document.getElementById('citysel_'+cityNum);
        return t.ClickWin(window,obj,'click');
     },
  
  ClickWin:function(win,obj,evtName) {
      var evt = win.document.createEvent("MouseEvents");
      evt.initMouseEvent(evtName, true, true, win,
        0, 0, 0, 0, 0, false, false, false, false, 0, null);
      return !obj.dispatchEvent(evt);
     },
  
  clickCheckIdlePop : function (){
    var t = Tabs.Train;
    if (document.getElementById ('chkPop').checked)
      Options.maxIdlePop = true;
    else
      Options.maxIdlePop = false;
    saveOptions ();
    t.displayCityStats ();
    t.changeTroopSelect ();
  },

  limitingFactor : null,
    
  changeTroopSelect : function (){
    var t = Tabs.Train;
    var cityId = t.selectedCity.id;
    // unitcost: NAME, Food, Wood, Stone, Ore, Gold, Pop, ?
    var id = t.TTselType.value;
    t.lastTroopSelect = id;
    t.limitingFactor = null;
    var uc = unsafeWindow.unitcost['unt'+id];
  var actualuc = [];
  for(var r = 1; r<5; r++){
    if(document.getElementById('pttrgamble').value > 0)
      actualuc[r] = uc[r] * t.gamble[document.getElementById('pttrgamble').value].cost;
    else
      actualuc[r] = uc[r];
  }
    var max = 9999999999;
    if ( (t.stats.food / actualuc[1]) < max){
      max = t.stats.food / actualuc[1];
      t.limitingFactor = unsafeWindow.resourceinfo['rec1'];
    }
    if ( (t.stats.wood / actualuc[2]) < max){
      max = t.stats.wood / actualuc[2];
      t.limitingFactor = unsafeWindow.resourceinfo['rec2'];
    }
    if ( (t.stats.stone / actualuc[3]) < max){
      max = t.stats.stone / actualuc[3];
      t.limitingFactor = unsafeWindow.resourceinfo['rec3'];
    }
    if ( (t.stats.ore / actualuc[4]) < max){
      max = t.stats.ore / actualuc[4];
      t.limitingFactor = unsafeWindow.resourceinfo['rec4'];
    }
    if ( (t.stats.idlePop / uc[6]) < max){
      max = t.stats.idlePop / uc[6];
      t.limitingFactor = 'pop';
    }
    t.stats.MaxTrain = parseInt (max);
    if (t.stats.MaxTrain < 0)
      t.stats.MaxTrain = 0;
    if (matTypeof(uc[8]) == 'object'){
      for (k in uc[8]){  // check building requirement
    var isPrestige = getCityPrestige(cityId);
        var b = getCityBuilding (cityId, k.substr(1));
    if(isPrestige){
      var bid = parseInt(k.substr(1));
      switch(bid){
        case 17: //Stable
          b.maxLevel = 12;
        case 16: //Workshop
          b.maxLevel = 12;
        case 15: //Blacksmith
          b.maxLevel = 12;
      }
    }
        if (b.maxLevel < uc[8][k][1]){
          t.stats.MaxTrain = 0;
          t.limitingFactor = null;
          break;
        }
      }
    }
    if (matTypeof(uc[9]) == 'object'){
      for (k in uc[9]){    // check tech requirement
        if (parseInt(Seed.tech['tch'+k.substr(1)]) < uc[9][k][1]){
          t.stats.MaxTrain = 0;
          t.limitingFactor = null;
          break;
        }
      }
    }
  if (t.limitingFactor){
    document.getElementById('ptttr_'+ t.limitingFactor).className = 'boldRed';
    document.getElementById('ptttr2_'+ t.limitingFactor).className = 'boldRed';
  }    
    t.updateTopTroops();
  },

  clickTroopDo : function (){
    var t = Tabs.Train;
    var cityId = t.selectedCity.id;
    var unitId = t.TTselType.value;
    var perSlot = parseInt(t.TTinpPerSlot.value, 10);
    var numSlots = parseInt(t.TTinpSlots.value, 10);
    
    t.displayCityStats ();
    if (t.running){
      t.stopTraining('<SPAN class=boldRed>Training cancelled by user</span>');
      return; 
    }    
    if (perSlot<1){
      t.divTrainStatus.innerHTML = '<FONT COLOR=#550000>'+unsafeWindow.g_js_strings.commonstr.invalid +' ('+unsafeWindow.g_js_strings.modal_barracks_train.numtotrain+')</font>';
      return;
    }
    if (perSlot*numSlots > t.stats.MaxTrain){
      t.divTrainStatus.innerHTML = '<FONT COLOR=#550000>Can\'t train that many troops (max is '+ t.stats.MaxTrain +' total)</font>';
      return;
    }
    if (numSlots<1 || numSlots>t.stats.barracks - t.stats.queued){
      t.divTrainStatus.innerHTML = '<FONT COLOR=#550000>'+unsafeWindow.g_js_strings.commonstr.invalid +' ('+unsafeWindow.buildingcost.bdg13[0]+')</font>';
      return;
    }

  var tut = document.getElementById ('tutelage').value;
  var gamble = document.getElementById ('pttrgamble').value;
    
    t.TDbutDo.disabled = true;
    t.TTbutDo.className = 'ptButCancel';
    t.TTbutDo.value = 'CANCEL';
    var que = [];
    for (var i=0; i<numSlots; i++)
      que.push (['T', unitId, parseInt (perSlot)]);
    t.divTrainStatus.innerHTML = '';
    t.running = true;
    t.doQueue (cityId, tut, gamble, que);
  },

  
/*******  DEF  ******/  
  
  updateTopDef : function (){
    var t = Tabs.Train;
    var slots = parseInt(t.TDinpSlots.value, 10);
    if (isNaN(slots) || slots<0)
      slots = 0;
    t.TDspMax.innerHTML = unsafeWindow.g_js_strings.commonstr.max+':'+ t.stats.MaxDefTrain +'&nbsp; '+unsafeWindow.g_js_strings.commonstr.owned+':'+ t.stats.defOwned;   
    t.TDspMaxSlots.innerHTML = t.stats.wallLevel-t.stats.Dqueued;
    if (slots<1)
      t.TDspMaxPS.innerHTML = 0;
    else
      t.TDspMaxPS.innerHTML = parseInt(t.stats.MaxDefTrain / slots);

    t.TDspSpace.innerHTML = unsafeWindow.buildingcost.bdg19[0]+' ('+unsafeWindow.g_js_strings.guardian.cl1+'): <B>'+ t.stats.wallLevel +'\
    </b><BR>'+unsafeWindow.g_js_strings.modal_openWalls.walldef+': \
    '+ (t.stats.wallSpaceUsed+t.stats.wallSpaceQueued)  +'/<B>'+ t.stats.wallSpace +'</b><BR>\
        '+unsafeWindow.g_js_strings.modal_openWalls.fielddef+': '+ (t.stats.fieldSpaceUsed+t.stats.fieldSpaceQueued) +'/<B>'+ t.stats.fieldSpace +'</b>';
  },


  changeDefSelect : function (){
    var t = Tabs.Train;
    var cityId = t.selectedCity.id;
    // unitcost: NAME, Food, Wood, Stone, Ore, Gold, Pop, ?
    var id = t.TDselType.value;
    t.lastDefSelect = id;
    t.stats.defOwned = parseInt(Seed.fortifications['city' + cityId]['fort'+id]);    
    var uc = unsafeWindow.fortcost['frt'+id];
    var max = 9999999999;
    if ( (t.stats.food / uc[1]) < max)
      max = t.stats.food / uc[1];
    if ( (t.stats.wood / uc[2]) < max)
      max = t.stats.wood / uc[2];
    if ( (t.stats.stone / uc[3]) < max)
      max = t.stats.stone / uc[3];
    if ( (t.stats.ore / uc[4]) < max)
      max = t.stats.ore / uc[4];
    if ( (t.stats.idlePop / uc[6]) < max)
      max = t.stats.idlePop / uc[6];
    t.stats.MaxDefTrain = parseIntNan (max);
    if (t.stats.MaxDefTrain < 0)
      t.stats.MaxDefTrain = 0;
    if (matTypeof(uc[8]) == 'object'){
      for (k in uc[8]){  // check building requirement
        var b = getCityBuilding (cityId, k.substr(1));
        if (k.substr(1)==15 && Seed.cityData.city[cityId].isPrestigeCity) b.maxLevel=12;
        if (k.substr(1)==16 && Seed.cityData.city[cityId].isPrestigeCity) b.maxLevel=12;
        if (b.maxLevel < uc[8][k][1]){
          t.stats.MaxDefTrain = 0;
          break;
        }
      }
    }
    if (matTypeof(uc[9]) == 'object'){
      for (k in uc[9]){    // check tech requirement
        if (parseInt(Seed.tech['tch'+k.substr(1)]) < uc[9][k][1]){
          t.stats.MaxDefTrain = 0;
          break;
        }
      }
    }
    var spaceEach = parseInt(unsafeWindow.fortstats["unt"+ id][5]);
    if (id<60) var spaceAvail = t.stats.wallSpace - t.stats.wallSpaceUsed - t.stats.wallSpaceQueued;
    else var spaceAvail = t.stats.fieldSpace - t.stats.fieldSpaceUsed - t.stats.fieldSpaceQueued;
    if ( t.stats.MaxDefTrain * spaceEach > spaceAvail) t.stats.MaxDefTrain = parseInt(spaceAvail / spaceEach); 
    t.updateTopDef();
  },
  
  clickDefMaxPS : function (){
    var t = Tabs.Train;
    var slots = parseInt(t.TDinpSlots.value, 10);
    if (slots<1)
      t.TDinpPerSlot.value = 0;
    else
      t.TDinpPerSlot.value = parseInt(t.stats.MaxDefTrain / slots);
  },

  clickDefMaxSlots : function (){
    var t = Tabs.Train;
    t.TDinpSlots.value = t.stats.wallLevel-t.stats.Dqueued;
  },
    
  clickDefDo : function (){
    var t = Tabs.Train;
    var cityId = t.selectedCity.id;
    var unitId = t.TDselType.value;
    var perSlot = parseInt(t.TDinpPerSlot.value, 10);
    var numSlots = parseInt(t.TDinpSlots.value, 10);
    
    t.displayCityStats ();
    if (t.running){
      t.stopTraining('<SPAN class=boldRed>'+unsafeWindow.g_js_strings.commonstr.cancelled+'</span>');
      return; 
    }    
    if (perSlot<1)return;
    if (perSlot*numSlots > t.stats.MaxDefTrain){
      t.divTrainStatus.innerHTML = '<FONT COLOR=#550000>'+ unsafeWindow.g_js_strings.modal_attack.maxtroops +': '+ t.stats.MaxDefTrain +'</font>';
      return;
    }
    if (numSlots<1 || numSlots > t.stats.wallLevel-t.stats.Dqueued){
        t.divTrainStatus.innerHTML = '<FONT COLOR=#550000>'+unsafeWindow.g_js_strings.commonstr.invalid+' ()</font>';
      return;
    }
    var siege = document.getElementById ('siege').value;
    t.TTbutDo.disabled = true;
    t.TDbutDo.className = 'ptButCancel';
    t.TDbutDo.value = 'CANCEL';
    var que = [];
    for (var i=0; i<numSlots; i++)
      que.push (['T', unitId, parseInt (perSlot)]);
    t.divTrainStatus.innerHTML = '';
    t.running = true;
    t.doDefQueue (cityId, siege, que);
  },

  doDefQueue : function (cityId, siege, que, errMsg){
    var t = Tabs.Train;
    clearTimeout (t.trainTimer);
    try {
      t.displayCityStats();
      if (errMsg){
        t.stopTraining ('<SPAN class=boldRed>ERROR: '+ errMsg +'</span>');
        return;
      }
      var cmd = que.shift();
      if (!cmd){
        t.stopTraining ('<B>Done queueing defenses.</b>');
        return;
      }
      if (cmd[0] == 'T'){
        t.dispTrainStatus ('Training '+ cmd[2] +' '+  fortNamesShort[cmd[1]] +' at '+ Cities.byID[cityId].name +' ('+ que.length +' slots remaining)<BR>');
        doDefTrain ( cityId, siege, cmd[1], cmd[2], 
          function(errMsg){
            t.trainTimer = setTimeout(function (){Tabs.Train.doDefQueue(cityId, siege, que, errMsg);}, (Math.random()*3500)+1500);
          } );
      }
    } catch (err) {
      logit (inspect (err, 8, 1));
      t.stopTraining ('<SPAN class=boldRed>PROGRAM ERROR: '+ err.message +'</span>');
    }
  },
  

  // fix KofC bugs ....
  // if first start time > now, make it now
  // if any end time != next start time, fix it
  fixQueTimes : function (q){
    var now = unixTime();
    if (q[0][2] > now)
      q[0][2] = now;
    for (var i=0; i<q.length; i++){
      if (q[i+1]!=null && q[i+1][2]!=q[i][3])
        q[i][3] = q[i+1][2];
    }        
  },

  expireTheQueue : function (q){
    if (q==null)
      return;
    var now = unixTime();
    while (q.length>0 && (q[0][3] - now) < 1)
      q.shift();
  },
    
  displayCityStats : function (){
    var t = Tabs.Train;
    var cityId = t.selectedCity.id;
  var isSpecial = false;
  if(t.TTselType.value > 12){
    isSpecial = true;
  }
    t.stats.food = parseInt (Seed.resources['city'+cityId].rec1[0]/3600);
    t.stats.wood = parseInt (Seed.resources['city'+cityId].rec2[0]/3600);
    t.stats.stone = parseInt (Seed.resources['city'+cityId].rec3[0]/3600);
    t.stats.ore = parseInt (Seed.resources['city'+cityId].rec4[0]/3600);
    t.stats.gold = Seed.citystats['city'+cityId].gold[0];
    if (Options.maxIdlePop) t.stats.idlePop = parseInt(Seed.citystats['city'+cityId].pop[0]);
    else t.stats.idlePop = parseInt(Seed.citystats['city'+cityId].pop[0]) - parseInt(Seed.citystats['city'+cityId].pop[3]);
      t.stats.barracks = getCityBuilding (cityId,13).count;     
      t.stats.barracks += getCityBuilding (cityId,22).count;
      t.stats.barracks += getCityBuilding (cityId,24).count;
    var m = '<CENTER><B>'+ Cities.byID[cityId].name +' &nbsp; ('+ Cities.byID[cityId].x +','+ Cities.byID[cityId].y +')</b></center><HR>';

    m += '<TABLE class=pbTab width=100%><TR align=center>';
    for(i=1;i<=6;i++){
      m += '<TR><TD width=75px>'+unsafeWindow.unitcost['unt'+i][0]+'</td><TD width=60px>'+addCommas(parseInt(Seed.units['city'+cityId]['unt'+i]))+'</td>';
      m += '<TD width=75px>'+unsafeWindow.unitcost['unt'+(i+6)][0]+'</td><TD width=60px>'+addCommas(parseInt(Seed.units['city'+cityId]['unt'+(i+6)]))+'</td>';
      if (i<=4) m += '<TD width=75px><SPAN id=ptttr_'+unsafeWindow.resourceinfo['rec'+i]+'>'+unsafeWindow.resourceinfo['rec'+i]+'</span></td><TD width=60px><SPAN id=ptttr2_'+unsafeWindow.resourceinfo['rec'+i]+'>'+addCommas(parseInt(Seed.resources['city'+cityId]['rec'+i][0]/3600))+'</span></td>';
      if (i==5) m += '<TD width=75px><SPAN id=ptttr_gold>'+unsafeWindow.resourceinfo['rec0']+'</span></td><TD width=60px><SPAN id=ptttr2_gold>'+addCommas(Seed.citystats['city'+cityId].gold[0])+'</span></td>';
      if (i==6) m += '<TD width=75px><SPAN id=ptttr_pop>'+unsafeWindow.g_js_strings.showPopTooltip.idlepop+'</td><TD width=60px><SPAN id=ptttr2_pop>'+addCommas(t.stats.idlePop)+'</td>';
      m+='</tr>';
    }
    m+='</table>';
    document.getElementById ('divSTtop').innerHTML = m;
    
// troop queue .... 
    var totTime = 0;
    var q = Seed.queue_unt['city'+cityId];
    t.expireTheQueue(q);
    var qs = q.toString();
    var now = unixTime();
    // if (q!=null && q.length>0)
      // totTime = q[q.length-1][3] - now;
    if ( qs == t.lastQueString){
      if (q!=null && q.length>0){
    var cur = 0;
    for(var i = 0; i<q.length; i++){
      if(q[i][7] && isSpecial){
        cur = q[i][3] - now;
        break;
      }
      if(!q[i][7] && !isSpecial){
        cur = q[i][3] - now;
        break;
      }
    }
    if(document.getElementById ('ptttfq'))
      document.getElementById ('ptttfq').innerHTML = timestr(cur, true);
      }
    } else {
      t.lastQueString = qs;
      t.stats.queued = 0;
      m = '<TABLE align=center class=pbTab>';
      if (q!=null && q.length>0 ){
    if(!getCityPrestige(cityId))
      t.fixQueTimes (q);
        // t.stats.queued = q.length;
        first = true;
        for (var i=0; i<q.length; i++){
      if(isSpecial && q[i][0] < 13){
      continue;
      }
      if(!isSpecial && q[i][0] >= 13){
      continue;
      }
      
          start = q[i][2];
          end = q[i][3];
      if(end > totTime)
      totTime = end;
          if (first)
            actual = end - now;
          else
            actual = end - lastEnd;
          if (actual < 0)
            actual = 0;
          q[i][6] = cityId;
      //q[i][7] If true means special troop training
      
          m += '<TR align=right><TD width="5px"><A><DIV onclick="cancelTrain('+ q[i][0]+','+q[i][1]+','+q[i][2]+','+q[i][3]+','+q[i][5]+','+q[i][6]+','+i +')">X</div></a></td>';
          m += '<TD>'+ q[i][1] +' </td><TD align=left> '+ unsafeWindow.unitcost['unt'+q[i][0]][0];
          if (first)
            m += '</td><TD> &nbsp; '+  timestr(end-start, true) +'</td><TD> (<SPAN id=ptttfq>'+ timestr(actual, true) +'</span>)';
          else
            m += '</td><TD> &nbsp; '+  timestr(actual, true) +'</td></tr>'; 
          lastEnd = end;
          first = false;
      t.stats.queued++;
        }
      }
      m += '</table>';
      document.getElementById ('divSTleft').innerHTML = m;
    t.totTime = totTime;
    }
    m = t.stats.queued +' ' + unsafeWindow.g_js_strings.commonstr.oftx +' ';
    if (t.stats.queued >= 0)
    m += t.stats.barracks;
  
    if ((t.totTime-now) > 0)
      m += ' - '+ unsafeWindow.g_js_strings.commonstr.time + ': '+ unsafeWindow.timestr(t.totTime-now);
    document.getElementById ('statTTtot').innerHTML = m;
    
// defense queue ....
    getWallInfo (cityId, t.stats);    
    var totTime = 0;
    var q = Seed.queue_fort['city'+cityId];
    t.expireTheQueue(q);
    var qs = q.toString();
    if (q!=null && q.length>0)
      totTime = q[q.length-1][3] - now;
    if ( qs == t.lastDQueString){
      if (q!=null && q.length>0){
        var cur = q[0][3] - now;
        document.getElementById ('pttdfq').innerHTML = timestr(cur, true);
      }
    } else {
      t.lastDQueString = qs;
      t.stats.Dqueued = 0;
      t.stats.wallSpaceQueued = 0;
      t.stats.fieldSpaceQueued = 0;
      m = '<TABLE align=center class=pbTab>';
      if (q!=null && q.length > 0 ){
        t.fixQueTimes (q);
        t.stats.Dqueued = q.length;
        first = true;
        for (i=0; i<q.length; i++){
          if (q[i][0] < 60)          
            t.stats.wallSpaceQueued += parseInt(unsafeWindow.fortstats["unt"+ q[i][0]][5]) * parseInt(q[i][1]);
          else          
            t.stats.fieldSpaceQueued += parseInt(unsafeWindow.fortstats["unt"+ q[i][0]][5]) * parseInt(q[i][1]);
          start = q[i][2];
          end = q[i][3];
          if (first)
            actual = end - now;
          else
            actual = end - lastEnd;
          if (actual < 0)
            actual = 0;
      q[i][7]=cityId;
          m += '<TR align=right><TD width="5px"><A><DIV onclick="cancelFort('+ q[i][0]+','+q[i][1]+','+q[i][2]+','+q[i][3]+','+q[i][5]+','+q[i][6]+','+q[i][7] +','+ i +')">X</div></a></td>'
          m += '<TD>'+ q[i][1] +' </td><TD align=left> '+ fortNamesShort[q[i][0]];
          if (first)
            m += '</td><TD> &nbsp; '+  timestr(end-start, true) +'</td><TD> (<SPAN id=pttdfq>'+ timestr(actual, true) +'</span>)';
          else
            m += '</td><TD> &nbsp; '+  timestr(actual, true) +'</td></tr>'; 
          lastEnd = end;
          first = false;
        }
      }
      m += '</table>';
      document.getElementById ('divSTright').innerHTML = m;
    }
    m = t.stats.Dqueued +' slots';
    if (totTime > 0)
      m += ', '+ unsafeWindow.timestr(totTime);
    document.getElementById ('statDTtot').innerHTML = m;
  },
  
  
  dispTrainStatus : function (msg){
    var t = Tabs.Train;
    t.divTrainStatus.innerHTML = msg + t.divTrainStatus.innerHTML;
  },

  butcancelTrain : function (typetrn, numtrptrn, trnTmp, trnETA, trnNeeded, cityId, trainingId){
    var t = Tabs.Train;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    
    params.pf =0;
    params.requestType = "CANCEL_TRAINING";
    params.cityId = cityId;
    params.typetrn = typetrn;
    params.numtrptrn =  numtrptrn;
    params.trnETA = trnETA;
    params.trnTmp = trnTmp;
    params.trnNeeded = trnNeeded;
    
    new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/cancelTraining.php" + unsafeWindow.g_ajaxsuffix, {
        method: "post",
        parameters: params,
        onSuccess: function (message) {
        var rslt=eval("("+message.responseText+")");
        if (rslt.ok) {
          var k=0;
          for(var j=0;j<Seed.queue_unt["city"+cityId].length;j++){
            if(j>trainingId){
              Seed.queue_unt["city"+cityId][j][2]=parseInt(rslt.dateTraining[k]["start"]);
              Seed.queue_unt["city"+cityId][j][3]=parseInt(rslt.dateTraining[k]["end"]);
              k++;
            }
          }
      
      Seed.queue_unt["city"+cityId].splice(trainingId,1);
      for(var i=1;i<5;i++){
        var totalReturn=parseInt(unsafeWindow.unitcost["unt"+typetrn][i])*parseInt(numtrptrn)*3600/2;
        Seed.resources["city"+cityId]["rec"+i][0]=parseInt(Seed.resources["city"+cityId]["rec"+i][0])+totalReturn;
      }
        } 
        },
        onFailure: function () {
        },
    });
  },
  
 butcancelFort : function (typefrt, numtrpfrt, frtTmp, frtETA, frtNeeded, frtid, cityId, queueId){
   var t = Tabs.Train;
   var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
   
   params.pf =0;
   params.requestType = "CANCEL_FORTIFICATIONS";
   params.cityId = cityId;
   params.typefrt = typefrt;
   params.numtrpfrt =  numtrpfrt;
   params.frtETA = frtETA;
   params.frtTmp = frtTmp;
   params.frtNeeded = frtNeeded;
   params.frtid = frtid;
   
   new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/cancelFortifications.php" + unsafeWindow.g_ajaxsuffix, {
       method: "post",
       parameters: params,
       onSuccess: function (message) {
       var rslt=eval("("+message.responseText+")");
       if (rslt.ok) {
      var k=0;
      for(var j=0;j<Seed.queue_fort["city"+cityId].length;j++){
        if(j>queueId){
          Seed.queue_fort["city"+cityId][j][2]=parseInt(rslt.dateFortifications[k]["start"]);
          Seed.queue_fort["city"+cityId][j][3]=parseInt(rslt.dateFortifications[k]["end"]);
          k++;
        }
      }
      unsafeWindow.update_seed(rslt.updateSeed);
      Seed.queue_fort["city"+cityId].splice(queueId,1);
      for(var i=1;i<5;i++){
        Seed.resources["city"+cityId]["rec"+i][0]=parseInt(Seed.resources["city"+cityId]["rec"+i][0])+totalReturn;
      }
    }
       },
       onFailure: function () {
       },
   });
 },
 
  
  stopTraining : function (msg){
    var t = Tabs.Train;
    clearTimeout (t.trainTimer);
    t.trainTimer = null;
    t.dispTrainStatus (msg +'<BR>');
    t.TDbutDo.disabled = false;
    t.TTbutDo.disabled = false;
    t.TTbutDo.value = unsafeWindow.g_js_strings.modal_openBarracks.trainttl;
    t.TDbutDo.value = unsafeWindow.g_js_strings.modal_openWalls.builddefenses;
    t.TTbutDo.className = '';
    t.TDbutDo.className = '';
    t.running = false;
  },
  
  
  doQueue : function (cityId, tut, gamble, que, errMsg){
    var t = Tabs.Train;
    clearTimeout (t.trainTimer);
    try {
      t.displayCityStats();
      if (errMsg){
        t.stopTraining ('<SPAN class=boldRed>'+ errMsg +'</span>');
        return;
      }
      var cmd = que.shift();
      if (!cmd){ 	
        t.stopTraining ('<B>'+unsafeWindow.g_js_strings.update_queue.troopqueue+'</b>');
        return;
      }
      if (cmd[0] == 'T'){
        t.dispTrainStatus (unsafeWindow.g_js_strings.modal_barracks_train.starttraining+': '+ cmd[2] +' '+  unsafeWindow.unitcost['unt'+cmd[1]][0] +' at '+ Cities.byID[cityId].name +' ('+ que.length +' slots remaining)<BR>');
        doTrain (cityId, tut, gamble, cmd[1], cmd[2], 
          function(errMsg){
            if (t.running)
              t.trainTimer = setTimeout(function (){Tabs.Train.doQueue(cityId, tut, gamble, que, errMsg);}, (Math.random()*2500)+1000 );
          }
        );
      }
    } catch (err) {
      t.stopTraining  ('<SPAN class=boldRed>'+unsafeWindow.g_js_strings.barbarian.erroroccured +' '+ err.message +'</span>');
    }
  },

}

/*********************************** Map tab ***********************************/
Tabs.Map = {
	tabOrder : 8,
	tabLabel : document.getElementById('mod_views_map').innerHTML,
	type: 'Tools',
	myDiv : null,

  	init : function (div){
	    var t = Tabs.Map;
	    t.myDiv = div;
	    fortmight = {
	      u53: "4",
	      u55: "7",
	      u60: "1",
	      u61: "2",
	      u62: "3",
	    };
	    var t = Tabs.Map;
	    var m = '<DIV style="max-height:700px; height:700px; overflow-y:auto"><DIV class=pbStat>PROVINCE MAP</div><BR><DIV id=ptProvMap style="height:'+ provMapCoords.imgHeight +'px; width:'+ provMapCoords.imgWidth +'px; background-repeat:no-repeat; background-image:url(\''+ URL_PROVINCE_MAP +'\')"></div>';
	    m+= '<BR><DIV class=pbStat>DISTANCE CALCULATOR</div><DIV class=ptentry><TABLE align=center cellpadding=1 cellspacing=0>\
	      <TR><TD class=xtab align=left><INPUT id=plot type=checkbox>Plot coords on map.</td></tr>\
	      <TR><TD class=xtab align=left><B>First Location: </b></td><TD  class=xtab> X: <INPUT id=calcX type=text\> Y: <INPUT id=calcY type=text\> Or, choose city: <SPAN id=ptloc1></span></td></tr>\
	      <TR><TD class=xtab align=left><B>Second Location: </b></td><TD class=xtab> X: <INPUT id=calcX2 type=text\> Y: <INPUT id=calcY2 type=text\> Or, choose city: <SPAN id=ptloc2></span></td></tr></table>\
	      <CENTER><DIV style="width:60%; font-size:14px; border: 1px solid; background-color:white; margin:20px 3px 3px 0px; padding:4px" id=ptdistout></div></div>\
	      <BR></center></div>';
	    t.myDiv.innerHTML = m +'</div>';
	    
	    for (var c=0; c<Cities.numCities; c++) t.makeCityImg (c, document.getElementById('ptProvMap'));
		new CdispCityPicker ('ptloc1', document.getElementById('ptloc1'), true, t.eventLocChanged, 0).bindToXYboxes(document.getElementById('calcX'), document.getElementById('calcY'));
	    new CdispCityPicker ('ptloc2', document.getElementById('ptloc2'), true, t.eventLocChanged, 0).bindToXYboxes(document.getElementById('calcX2'), document.getElementById('calcY2'));
	    t.eventLocChanged(Cities.cities[0], Cities.cities[0].x, Cities.cities[0].y);
	    document.getElementById('plot').addEventListener('change', function(){
	       	t.plotCityImg(0, document.getElementById('ptProvMap'), document.getElementById('calcX').value, document.getElementById('calcY').value);
		    t.plotCityImg(1, document.getElementById('ptProvMap'), document.getElementById('calcX2').value, document.getElementById('calcY2').value);
	    }, false);
  	},
	hide : function (){},
  	show : function (){},

  	makeCityImg : function (cityNum, eMap){
	    var t = Tabs.Map;
	    var city = Cities.cities[cityNum];
	    var x = parseInt((provMapCoords.mapWidth * city.x) / 750);
	    var y = parseInt((provMapCoords.mapHeight * city.y) / 750);
	    var ce = document.createElement ('div');
	    ce.style.background = 'black';
	    ce.style.opacity = '1.0';
	    ce.style.position='relative';
	    ce.style.display='block';
	    ce.style.width='14px';
	    ce.style.height='16px';
	    ce.style.border='1px solid #fff';
	    ce.style.color = 'white';
	    ce.style.textAlign = 'center';
	    ce.style.top = (y+provMapCoords.topMargin-(cityNum*16)-8) +'px';      
	    ce.style.left = (x+provMapCoords.leftMargin-7) +'px';
	    eMap.appendChild(ce);
	    ce.innerHTML = (cityNum+1) +'';
  	},
  
  	plotCityImg : function (cityNum, eMap, x, y){
	    var t = Tabs.Map;
	    var xplot = parseInt((provMapCoords.mapWidth * x) / 750);
	    var yplot = parseInt((provMapCoords.mapHeight * y) / 750);
		if(document.getElementById('plotmap_'+cityNum) == null){
			var ce = document.createElement ('div');
			ce.style.background = 'white';
			ce.id = 'plotmap_'+cityNum;
			ce.style.opacity = '1.0';
			ce.style.position='relative';
			ce.style.display='block';
			ce.style.width='14px';
			ce.style.height='16px';
			ce.style.border='1px solid #fff';
			ce.style.color = 'black';
			ce.style.textAlign = 'center';
		} else ce = document.getElementById('plotmap_'+cityNum);
	    ce.style.top = (yplot+provMapCoords.topMargin-((Cities.numCities+cityNum)*16)-8) +'px';      
	    ce.style.left = (xplot+provMapCoords.leftMargin-7) +'px';
	    eMap.appendChild(ce);
	    ce.innerHTML = (cityNum+1) +'';
	},
  
	eventLocChanged : function (city, x, y){
		var t = Tabs.Map;
		var x1 = parseInt(document.getElementById('calcX').value);
		var x2 = parseInt(document.getElementById('calcX2').value);
		if (isNaN(x2)) return;
		var y1 = parseInt(document.getElementById('calcY').value);
		var y2 = parseInt(document.getElementById('calcY2').value);
		var m = 'The distance from '+ x1 +','+ y1 +' to '+ x2 +','+ y2 +' is: &nbsp;<B>'+ distance (x1, y1, x2, y2).toFixed(2) +'</b>';
		document.getElementById('ptdistout').innerHTML = m;
		if (document.getElementById('plot').checked){
		    t.plotCityImg(0, document.getElementById('ptProvMap'), x1, y1);
		    t.plotCityImg(1, document.getElementById('ptProvMap'), x2, y2);
		}
	},
}


/*************** KNIGHTS TAB *********************/
Tabs.Knights = {
	tabOrder : 4,
	tabLabel : unsafeWindow.g_js_strings.commonstr.knight,
	type : 'Tools',
	myDiv : null,
	displayTimer : null,
	action : 0,

	init : function (div){
		var t = Tabs.Knights;
		t.myDiv = div;
		unsafeWindow.ptAssignSkill = t.clickedAssignPoints;
		unsafeWindow.ptAssignTunes = t.clickedAssignTune; 
		unsafeWindow.ptButDismiss = t.postDismissKnight; 
		t.myDiv.innerHTML = '<DIV id=ptknightdiv style="max-height:600px; height:600px; max-width:900px; width:900px; overflow-y:auto">';
	},

	hide : function (){
		var t = Tabs.Knights;
		clearTimeout (t.displayTimer);
	},

  show : function (){
    var t = Tabs.Knights;
	clearTimeout (t.displayTimer);
    
    function _dispKnight (roleId, knight, numcid){
      var rid = roleId;
      if (roleId==null) rid = 1;
      var sty='';  
      if (row++ % 2) sty = 'class=ptOddrow ';        
      m = '<TR '+ sty +'valign=top align=right><TD><B>'+ (roleId==null ? '':KnightRoles[rid][0]) +'</b></td><TD align=left>';
      if (knight == null) {
        m += '--------</td><TD colspan=4></td><TD class=ptentry colspan=5></td><TD colspan=2></td></tr>';
      } else {
        var level = parseInt(Math.sqrt(parseInt(knight.experience) / 75)) + 1;
        var unpoints = level - parseInt(knight.skillPointsApplied);
        var salary = (parseInt(knight.skillPointsApplied) + 1) * 20;
        totSalary += salary;
        var ass = '';
        if (knight.knightStatus == 10){
          ass = '<TD class=ptentry align=left colspan=4>Marching</td>';
        } else {  
          if (unpoints > 0){
            unpoints = '<SPAN class="boldRed">'+ unpoints +'</span>';
          	for (var i=0; i<4; i++){
	            var sty = 'padding-left:1px;';
	            if (i == rid) sty += 'font-weight:bold;color:#116654';
	            if (t.action==2) t.clickedAssignPoints(null,cid,knight.knightId,i);  
	            if (t.action==1) t.clickedAssignPoints(null,cid,knight.knightId,1);     
	            ass += '<TD class=ptentry align=left style="'+ sty +'"><A style="'+ sty +'" onclick="ptAssignSkill(this,' + cid +','+ knight.knightId +','+ i +')">['+ KnightRoles[i][2] +'] &nbsp;</a></td>'; 
         	}
          } 
          else
            ass = '<TD class=ptentry colspan=4></td>';
        }  
        var skills = [];
        for (var i=0; i<4; i++){
          if (i == rid) skills[i] = '<B>'+ knight[KnightRoles[i][1]] +'</b>'; 
          else skills[i] = knight[KnightRoles[i][1]]; 
        }
		var item211="0";
        var item221="0";
        var item231="0";
        var item241="0";
        if (Seed.items.i211) item211='<a onclick="citysel_click(document.getElementById(\'citysel_'+ (numcid+1)+'\'));setTimeout (function (){ boost_modal(1,'+ knight.knightId +');return false;}, 500);">'+Seed.items.i211+'</a>';
        if (Seed.items.i221) item221='<a onclick="citysel_click(document.getElementById(\'citysel_'+ (numcid+1)+'\'));setTimeout (function (){ boost_modal(2,'+ knight.knightId +');return false;}, 500);">'+Seed.items.i221+'</a>';
        if (Seed.items.i231) item231='<a onclick="citysel_click(document.getElementById(\'citysel_'+ (numcid+1)+'\'));setTimeout (function (){ boost_modal(3,'+ knight.knightId +');return false;}, 500);">'+Seed.items.i231+'</a>';
        if (Seed.items.i241) item241='<a onclick="citysel_click(document.getElementById(\'citysel_'+ (numcid+1)+'\'));setTimeout (function (){ boost_modal(4,'+ knight.knightId +');return false;}, 500);">'+Seed.items.i241+'</a>';
        m += '<a title="Assigner un role" onclick="citysel_click(document.getElementById(\'citysel_'+ (numcid+1)+'\'));setTimeout (function (){ assign_role_modal('+ knight.knightId +');return false;}, 500);">'+knight.knightName + '</td><TD>'+strButton14('Dismiss', 'onclick="ptButDismiss('+knight.knightId + ','+cid+')" id=tileId_') +'</td><TD>'+ skills[0] +' ('+item211+')</td><TD>'+ skills[1] +' ('+item221+')</td><TD>'+ skills[2] +' ('+item231+')</td><TD>' + skills[3] +' ('+item241+')</td><TD class=ptentry>'+ unpoints +'</td>'+ ass +'<TD><a title="EXP Boost" onclick="citysel_click(document.getElementById(\'citysel_'+ (numcid+1)+'\'));setTimeout (function (){  xpBoost_modal('+ knight.knightId +');return false; }, 500);">'+ level +'</a></td><td><a onclick="citysel_click(document.getElementById(\'citysel_'+ (numcid+1)+'\'));setTimeout (function (){ loyalBoost_modal('+ knight.knightId +');return false;}, 500);">'+knight.loyalty+'</a></td><TD>'+ addCommas(salary) +'</td></tr>';
      }
      return m;
    }          
    
    var totSalary = 0;
    var m = '<TABLE cellspacing=0 align=center width=95% class=pbTab><TBODY>';
	  m += '<TR><TD colspan=15><DIV class=pbStat>Knight Assign Methods - <input style="height:20px;font-size:9px;" type=button value="Add Default Skill" id="ptknight_def"><input style="height:20px;font-size:9px;" type=button value="Add Combat Skill" id="ptknight_com"></div></td></tr><TR><TD>&nbsp</td></tr>';
    for (var c=0; c<Cities.numCities; c++) {
      var cid = Cities.cities[c].id;
      m += '<TR><TD colspan=15><DIV class=pbStat>'+ Cities.cities[c].name +'</div></td></tr>\
          <TR class=ptwpad style="font-weight:bold" align=right><TD width=70>Role</td><TD width=140 align=center>Name</td><TD widith=70 align=center>Dismiss</td><TD width=40>Pol</td><TD width40>Com</td>\
          <TD width=40>Int</td><TD width=40>Res</td><TD width=90 align=center colspan=5>--- Unassigned ---</td><TD width=35>Level</td><td>Loyalty</td><TD width=40 align=right> Salary </td></tr>';
      totSalary = 0;
      var did = {}; 
      var row = 0;
      for (var i=0; i<KnightRoles.length; i++){
        var leader = Seed.leaders['city'+cid][KnightRoles[i][1]+'KnightId'];
        if (leader == 0) m += _dispKnight (i, null, c);
        else {
          m += _dispKnight (i, Seed.knights['city'+cid]['knt'+leader], c);
          did['knt'+leader] = true;
        }
      }
      var list = [];
      for (k in Seed.knights['city'+cid]) if (!did[k]) list.push (Seed.knights['city'+cid][k]); 
      list.sort (function (a,b){return parseInt(b.combat)-parseInt(a.combat)});
      for (i=0; i<list.length; i++) m += _dispKnight (null, list[i], c,cid);
      m += '<TR align=right><TD colspan=13><B>Total Salary:</b></td><TD>'+ addCommas(totSalary) +'</td></tr>';        
    }
    document.getElementById('ptknightdiv').innerHTML = m +'</tbody></table></div>';
	t.action = 0;
    document.getElementById('ptknight_com').addEventListener ('click', function (){
      t.action=1;
      t.show();
    }, false);
    document.getElementById('ptknight_def').addEventListener ('click', function (){
          t.action=2;
          t.show();
    }, false);
    t.displayTimer = setTimeout (t.show, 10000);
  },
  postDismissKnight:function(kid,cid){
  	var t = Tabs.Knights;
  	var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.cid = cid;
    params.kid = kid;
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/fireKnight.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        if (rslt.ok) {
        	if (rslt.updateSeed){
        		delete Seed.knights["city" + cid]["knt" + kid];
        		if (rslt.updateSeed) {
                    unsafeWindow.update_seed(rslt.updateSeed)
                }
        		t.show();
        	}
        } 
      },
      onFailure: function () {},
    });
  },



  clickedAssignPoints : function (e, cid, kid, rid){
    var t = Tabs.Knights;
    clearTimeout (t.displayTimer);
      
    var knight = Seed.knights['city'+cid]['knt'+kid];
    if (knight.knightStatus == 10 && e!=null){
      var row = e.parentNode.parentNode;
      row.childNodes[7].innerHTML = 'Marching';
      return; 
    }
    sk = [];
    var unassigned = parseInt(Math.sqrt(parseInt(knight.experience)/75)) + 1  - parseInt(knight.skillPointsApplied);
	var overassigned = 0;
    for (var i=0; i<4; i++){
      sk[i] = parseInt(knight[KnightRoles[i][1]]);
      if (i == rid)
        sk[i] += unassigned;
      if(sk[i] > 255){
		overassigned = sk[i] - 255;
		sk[i] = 255;
	  }
    }
    unassigned = unassigned - overassigned;
	if (unassigned==0) return;
    if (e!=null) {
		var row = e.parentNode.parentNode;
		for (i=row.cells.length-1; i>=1; i--)
		  row.deleteCell (i);
		var newCell=row.insertCell(-1);
		newCell.colSpan = 12;
		newCell.align= 'left';
		newCell.style.padding='1px 5px 1px 10px';
		var div = document.createElement ('div');
		div.style.backgroundColor = '#ffffff';
		div.style.textAlign = 'center';
		div.style.border = '1px solid';
		div.style.width = '98%';
		div.style.whiteSpace = 'normal';
		newCell.appendChild (div);
		div.innerHTML = 'Assigning '+ unassigned +' skill points to '+ KnightRoles[rid][1] +' ... ';
	}
    t.postSkillPoints (cid, kid, sk[0], sk[1], sk[2], sk[3], function (r){t.postDone(r, div)});  
  },
  
  postDone : function (rslt, div){
    var t = Tabs.Knights;
    clearTimeout (t.displayTimer);
    if (rslt.ok){
      div.innerHTML += '<B>Done.</b>';
      t.displayTimer = setTimeout (t.show, 5000);
    } else {
      div.innerHTML += '<BR><SPAN class=boldRed>ERROR: '+ rslt.errorMsg +'</span>';
      t.displayTimer = setTimeout (t.show, 10000);
    }
  },
  
  postSkillPoints : function (cid, kid, pol, com, int, res, notify){  
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.cid = cid;
    params.kid = kid;
    params.p = pol;
    params.c = com;
    params.i = int;
    params.r = res;
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/skillupKnight.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        if (rslt.ok) {
          var knight = Seed.knights["city" + cid]["knt" + kid];
          var up = pol + com + int + res - knight.politics - knight.combat - knight.intelligence - knight.resourcefulness;
          knight.politics = pol;
          knight.combat = com;
          knight.intelligence = int;
          knight.resourcefulness = res;
          knight.skillPointsApplied = (parseInt(knight.skillPointsApplied) + up).toString();
        } 
        if (notify) notify (rslt);
      },
      onFailure: function () {
        if (notify) notify (rslt);
      },
    });
  },
};


/*************** WILDS TAB *********************/

var wildNames = {
   0: 'Bog',
  10: 'Grassland',
  11: 'Lake',
  20: 'Woods',
  30: 'Hills',
  40: 'Mountain',
  50: 'Plain',
};

var mercNames = {
  0: 'None',
  1: 'Novice',
  2: 'Intermediate',
  3: 'Veteran',
};

Tabs.Wilds = {
  tabOrder : 5,
  type : 'Tools',
  tabLabel : 'Wilds',

  myDiv : null,
  upGoldTimer : null,
  wildList : [],
  buildList : {},
  
  init : function (div){
    var t = Tabs.Wilds;
    t.myDiv = div;
    unsafeWindow.ptButMaxTraps = t.e_butMaxTraps;
    unsafeWindow.ptInpWildTraps = t.e_inpTraps;
    unsafeWindow.ptButWildSet = t.e_butWildSet;
    unsafeWindow.ptButAbandon = t.e_abandon;
    t.myDiv.innerHTML = '<DIV id=wildContent style="maxheight:700px; height:700px; overflow-y:auto">';
  },

  hide : function (){
    var t = Tabs.Wilds;
    clearTimeout (t.upGoldTimer);
  },
  
  show : function (){
    var t = Tabs.Wilds;
    clearTimeout (t.upGoldTimer);
    
    m = '<CENTER>'+ strButton20('RESET', 'id=ptwref') +'</center><TABLE class=pbTabPad cellspacing=0 cellpadding=0 align=center width=90%>';
    for (var c=0; c<Cities.numCities; c++){
      var city = Cities.cities[c];
      var cWilds = Seed.wilderness['city'+city.id];
      t.wildList[c] = []; 
      var castle = parseInt(Seed.buildings['city'+ city.id].pos0[1]);
      if(castle == 11) castle = 12;
      else if(castle == 12) castle = 14;
      var totw = 0;
      if (matTypeof(cWilds)=='object') for (var k in cWilds) ++totw;         
      m += '<TR><TD colspan=20><DIV class=pbStat><TABLE class=ptNoPad width=100%><TR><TD width=100></td><TD width=90% align=center>'+ city.name 
        +' &nbsp; ('+ city.x +','+ city.y +')</td><TD width=150 align=right>Wilds: '+ totw +' of '+ castle +' &nbsp; </TD></tr></table></div></td></tr>';
      var row = 0;  
      var sortem = [];
      if (matTypeof(cWilds) != 'array') {
        m += '<TR style="background-color:white; font-weight:bold;" align=right><TD align=left>Wild Type</td><TD></td><TD align=left>Coords</td><TD>Traps</td><TD align=center>Mercs</td><TD align=center>Abandon</td>';
        m += '<TD colspan=5>'+ htmlTitleLine(' CHANGE DEFENSES ') +'</td></tr>';
        for (var k in Seed.wilderness['city'+city.id])
          sortem.push (Seed.wilderness['city'+city.id][k]);
        sortem.sort (function (a,b){
          var x; if ((x = b.tileLevel-a.tileLevel)!=0) 
            return x; 
          return a.tileType-b.tileType;
        });
        for (i=0; i<sortem.length; i++){
          var wild = sortem[i]; 
          var wildDef = Seed.wildDef['t'+wild.tileId];
          if (wildDef==undefined || !wildDef)
            wildDef = {fort60Count:0, mercLevel:0};
          var maxTraps = parseInt(wild.tileLevel)*100;
          var maxBuild = maxTraps - parseInt(wildDef.fort60Count);
          t.wildList[c][i] = [wild.tileId, maxBuild];          
          //
          m += '<TR align=right'+ (row++%2?'':' class=ptOddrow') +'><TD align=left>'+ wildNames[wild.tileType] +'</td>\
            <TD>'+ wild.tileLevel +'</td><TD align=center><A onclick="pbGotoMap('+ wild.xCoord +','+ wild.yCoord +')">'+ wild.xCoord +','+ wild.yCoord +'</a></td>\
            <TD align=right><B>'+ wildDef.fort60Count +'</b></td><TD align=center><B>'+ mercNames[wildDef.mercLevel] +'</b></td><TD align=center>'+strButton14('Abandon', 'onclick="ptButAbandon('+wild.tileId+','+wild.xCoord+','+wild.yCoord+','+city.id+ ')" id=tileId_'+wild.tileId) + '</td>\
            <TD></td><TD align=left class=ptentry><B>Build Traps:</b> <INPUT onchange="ptInpWildTraps(this)" id=ptwt_'+ c +'_'+ i 
              + (maxBuild==0?' DISABLED ':'')+' style="margin:0px; padding:0px" type=text size=3 maxlength=4></td>'
          if (wildDef.fort60Count < maxTraps)
            m += '<TD class=ptentry style="padding:0px">'+ strButton14('Max', 'id=ptwx_'+ c +'_'+ i +' onclick="ptButMaxTraps(this)"') +'</td>';
          else
            m += '<TD class=ptentry></td>';
          m += '<TD class=ptentry> &nbsp; &nbsp; <B>Mercs:</b> ' + htmlSelector(mercNames, wildDef.mercLevel, 'id=ptwm_'+ c +'_'+ i) +' &nbsp; &nbsp; </td></tr>';
        }
        m += '<TR><TD colspan=6></td><TD></td><TD class=ptentry align=center colspan=3><TABLE><TR><TD width=40% align=left>Cost: <SPAN id=ptwgc_'+ c +'>0</span></td>\
            <TD width=10%>'+ strButton20("SET DEFENSES", 'onclick="ptButWildSet('+ c +')"') +'<TD width=40% align=right>Gold: <SPAN id=ptwgt_'+ c +'>0</span></td></td></tr></table></td></tr>';
      } else {
        m+= '<TR><TD colspan=9> &nbsp; </td></tr>';
      }         
    }
    document.getElementById('wildContent').innerHTML = m + '</table></div><BR>';
    document.getElementById('ptwref').addEventListener ('click', t.show, false);
    t.updateGold ();
  },
  
  e_abandon:function(tileId,xCoord,yCoord,cityId){
  	var t = Tabs.Wilds;
  	var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.tid = tileId;
    params.x = xCoord;
    params.y = yCoord;
    params.cid = cityId; 
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/abandonWilderness.php" + unsafeWindow.g_ajaxsuffix, {
    	method: "post",
    	parameters: params,
    	onSuccess: function (rslt) {
    		if (rslt.ok){
   				delete Seed.wilderness["city"+cityId]["t" + tileId];
   				t.show();
    			if (rslt.updateSeed) unsafeWindow.update_seed(rslt.updateSeed);
    			
    		}
    	},  
    	onFailure: function () {},
    });
  },

  e_butWildSet : function (c){
    var t = Tabs.Wilds;
    var totTraps = 0;  
    var cid = Cities.cities[c].id;
    t.buildList = {cityId:cid, list:[]};      
    for (var w=0; w<t.wildList[c].length; w++){
      var wild = Seed.wilderness['city'+cid]['t'+t.wildList[c][w][0]]; 
      var wildDef = Seed.wildDef['t'+t.wildList[c][w][0]];
// TODO: Seed.wildDef is null if just aquired 
if (wildDef==undefined || !wildDef)
  wildDef = {fort60Count:0, mercLevel:0};
    
      var numTraps = parseInt(document.getElementById('ptwt_'+ c +'_'+ w).value, 10);
      if (isNaN(numTraps))
        numTraps = 0;
      totTraps += numTraps;
      if (numTraps > 0)
        t.buildList.list.push (['T', wild.tileId, numTraps]);
      var mercId =document.getElementById('ptwm_'+ c +'_'+ w).value; 
      if (wildDef.mercLevel != mercId)
        t.buildList.list.push (['M', wild.tileId, mercId, wildDef.mercLevel]);
    }

    var totCost = totTraps * 200; 
    if (totCost > parseInt(Seed.citystats['city'+cid].gold[0])){
      document.getElementById('ptwgc_'+ c).innerHTML = '<SPAN class=boldRed>'+ addCommasInt(totCost) +'</span>';
      return; 
    }
    if (t.buildList.list.length == 0)
      return;
    t.setCurtain (true);
    var popDiv = t.setPopup (true);
    popDiv.innerHTML = '<TABLE width=100% height=100%><TR><TD>\
          <DIV>Setting Wilderness Defenses</div>\
          <DIV id=ptWildBuildDiv style="padding:10px; height:225px; max-height:225px; overflow-y:auto"></div>\
          </td></tr><TR><TD align=center>'+ strButton20('CANCEL', 'id=ptWildCancel') +'</td></tr></table>';
    document.getElementById('ptWildCancel').addEventListener('click', t.e_buildCancel, false);
    t.processQue(null);  
  },
  
  e_buildCancel : function (){
    var t = Tabs.Wilds;
    t.setCurtain(false);
    t.setPopup(false);
    t.show();
  },
  
  processQue : function (errMsg){
    var t = Tabs.Wilds;
    var what = t.buildList.list.shift();
    var div = document.getElementById('ptWildBuildDiv');
    if (what==null || errMsg){
      if (errMsg)
        div.innerHTML += '<BR><SPAN style="white-space:normal;" class=boldRed>ERROR: '+ errMsg +'</span>';
      else
        div.innerHTML += 'Done.<BR>';
      document.getElementById('ptWildCancel').firstChild.innerHTML = 'CLOSE'; 
      return;
    }
    if (div.innerHTML != '')
      div.innerHTML += 'Done.<BR>';
    var wild = Seed.wilderness['city'+ t.buildList.cityId]['t'+what[1]];
    if (what[0] == 'T'){
      div.innerHTML += 'Building '+ what[2] +' traps for '+ Cities.byID[t.buildList.cityId].name +'\'s wilderness at '+ wild.xCoord +','+ wild.yCoord +' ... ';
      t.postBuyTraps (t.buildList.cityId, what[1], what[2], t.processQue);
    } else {
      div.innerHTML += 'Setting Mercenaries to '+ mercNames[what[2]] +' for '+ Cities.byID[t.buildList.cityId].name +'\'s wilderness at '+ wild.xCoord +','+ wild.yCoord +' ... ';
      t.postHireMercs (t.buildList.cityId, what[1], what[2], what[3], t.processQue);
    }
  },
  
  setPopup : function (onoff){
    var t = Tabs.Wilds;
    if (onoff){
      var div = document.createElement('div');
      div.id = 'ptWildPop';
      div.style.backgroundColor = '#fff';
      div.style.zindex = mainPop.div.zIndex+2;
      div.style.opacity = '1';
      div.style.border = '3px outset red';
      div.style.width = '550px';
      div.style.height = '300px';
      div.style.display = 'block';
      div.style.position = 'absolute';
      div.style.top = '100px';
      div.style.left = '100px';
      t.myDiv.appendChild (div);
      return div;
    } else {
      t.myDiv.removeChild (document.getElementById('ptWildPop'));
    }
  },

  setCurtain : function (onoff){
    var t = Tabs.Wilds;
    if (onoff){
      var off = getAbsoluteOffsets (t.myDiv);
      var curtain = document.createElement('div');
      curtain.id = 'ptWildCurtain';
      curtain.style.zindex = mainPop.div.zIndex+1;
      curtain.style.backgroundColor = "#000000";
      curtain.style.opacity = '0.5';
      curtain.style.width = t.myDiv.clientWidth +'px';
      curtain.style.height = t.myDiv.clientHeight +'px';
      curtain.style.display = 'block';
      curtain.style.position = 'absolute';
      curtain.style.top = off.top + 'px';
      curtain.style.left = off.left + 'px';
      t.myDiv.appendChild (curtain);
    } else {
      t.myDiv.removeChild (document.getElementById('ptWildCurtain'));
    }
  },
  
  e_butMaxTraps : function (e){
    var t = Tabs.Wilds;
    var c = e.id.substr(5,1);
    var w = e.id.substr(7);
    var inp = document.getElementById('ptwt_'+ c +'_'+ w);
    inp.value = t.wildList[c][w][1];
    t.e_inpTraps (inp);
  },
  
  e_inpTraps : function (e){
    var t = Tabs.Wilds;
    var c = e.id.substr(5,1);
    var w = e.id.substr (7);
    var tot = 0;
    for (var i=0; i<t.wildList[c].length; i++) {
      var val = parseInt(document.getElementById('ptwt_'+ c +'_'+ i).value, 10);
      if (isNaN(val))
        val = 0;
      tot += val;
    }  
    document.getElementById('ptwgc_'+ c).innerHTML = addCommasInt(tot * 200);
    if (isNaN(e.value) || e.value<0 || e.value>t.wildList[c][w][1]){
      e.value = '';
      e.style.backgroundColor = '#ffaaaa'; 
    } else
      e.style.backgroundColor = null; 
  },

  updateGold : function (){
    var t = Tabs.Wilds;
    for (var c=0; c<Cities.numCities; c++){
      var e = document.getElementById('ptwgt_'+ c +'');
      if (e)
        e.innerHTML = addCommasInt(Seed.citystats['city'+Cities.cities[c].id].gold[0]);
    }
    t.upGoldTimer = setTimeout (t.updateGold, 2000);
  },
  
  postBuyTraps : function (cid, tid, quant, notify){
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.cid = cid;
    params.tid = tid;
    params.quant = quant;
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/buyWildTraps.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        if (rslt.ok){
          if (!Seed.wildDef["t"+ tid])
            Seed.wildDef["t"+ tid] = {tileId:tid, fort60Count:0, mercLevel:0};
          Seed.wildDef["t"+ tid].fort60Count = parseInt(Seed.wildDef["t"+ tid].fort60Count) + parseInt(quant);
        }  
        if (notify)
          notify (rslt.errorMsg);
      },
      onFailure: function () {
        if (notify)
          notify ('AJAX ERROR');
      },
    });
  },

  postHireMercs : function (cid, tid, newLevel, oldLevel, notify){
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.cid = cid;
    params.tid = tid;
    params.lv = newLevel;
    params.olv = oldLevel;
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/hireWildMerc.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        if (rslt.ok){
          if (!Seed.wildDef["t"+ tid]) Seed.wildDef["t"+ tid] = {tileId:tid, fort60Count:0, mercLevel:0};
          Seed.wildDef["t"+ tid].mercLevel = newLevel;
        }
        if (notify) notify (rslt.errorMsg);
      },
      onFailure: function () {
        if (notify) notify ('AJAX ERROR');
      },
    });
  },
          
}    
 

/********************** Tournament Tab *******************************************/
Tabs.Tournament = {
  tabOrder : 6,
  type: 'Tools',
  myDiv:null,
  displayTimer : null,
 
  init : function (div){Tabs.Tournament.myDiv = div;},
  hide : function (){clearTimeout (Tabs.Tournament.displayTimer);},
  getContent : function (){return Tabs.Tournament.myDiv;},
  show : function () {
    var t = Tabs.Tournament;
    t.myDiv.style.overflowY = 'auto';
    t.myDiv.style.maxHeight = '650px';
    clearTimeout (t.displayTimer);
    t.myDiv.innerHTML = "<div class='tourny_modal_upsell'></div>";
    var mhtl = "<DIV class=pbStat>POPULATION AND PRODUCTION INFORMATION</div><table width=100% class=pdxTab><tr><td colspan=8>&nbsp;</td></tr><tr><td></td>";
    for(var i=0; i<Cities.numCities; i++) {
     mhtl += "<TD align=center valign=bottom width=60px><B>" + Cities.cities[i].name + "</B></TD>";
    }
    mhtl += "</tr><tr><td><img height=18 src=http://koc-power-pdx.googlecode.com/svn/trunk/img/troops/unit_2_50_s34.jpg?6545 title=Militiaman> Militiaman/h</td>";
    var temps=[];
    for(var i=0; i<Cities.numCities; i++) {
     temps[i]=((Cities.cities[i]['Troop2Time'] > 0)?(3600 / Cities.cities[i]['Troop2Time']):0);
     mhtl += "<td>" + addCommas(parseInt(temps[i])) +"</td>";
    }
      mhtl += "</tr><tr><td><img height=18 src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/population_40.png title=Population> Population/h</td>";
    var pop=[];
    for(var i=0; i<Cities.numCities; i++) {
     cityID = 'city'+ Cities.cities[i].id;
     pop[i] =  parseInt(Seed.citystats[cityID]["pop"][1]) / 2;
     mhtl += "<td>" + addCommas(parseInt(pop[i])) +"</td>";
    }
    mhtl += "</tr><tr><td><b>Difference</b></td>";
    var diff=0;
    for(var i=0; i<Cities.numCities; i++) {
     diff = parseInt(pop[i] - temps[i]);
     var couleur=" style='font-color:green' ";
     if (diff<0) couleur=" style='background-color:red' ";
     mhtl += "<td "+couleur+"><b>" + addCommas(parseInt(diff)) +"</b></td>";
    }
    
     mhtl += "</tr><tr><td><img height=18 src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/happiness.png title=happiness> happiness</td>";
     for(var i=0; i<Cities.numCities; i++) {
     cityID = 'city'+ Cities.cities[i].id;
     var bon = parseInt(Seed.citystats[cityID]["pop"][2]); 
     var bonc = "red";
     if (bon>99) bonc="green";
     mhtl += "<td style='background-color:"+bonc+"'><center><b>"+bon+"</td>";
    }
    var now = unixTime();
    mhtl += "</tr><tr><td><b>Queue</b></td>";
      for(var i=0; i<Cities.numCities; i++) {
       cityID = 'city'+ Cities.cities[i].id;
       var totTime = 0;
       var q = Seed.queue_unt[cityID]; 
       if (q!=null && q.length>0)
           totTime = q[q.length-1][3] - now;
       if (totTime < 0) totTime = 0;
       if (totTime < 3600)
        var bonc="style='background-color:red'";
       else
        var bonc="";
       mhtl += "<td "+bonc+"><center><b>"+timestr(totTime)+"</td>";
      }
      
    mhtl += "</tr></table><br>";
    t.myDiv.innerHTML += mhtl;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.format=2;
    params.tournyPos=0;
    new AjaxRequest(unsafeWindow.g_ajaxpath+"ajax/getLeaderboard.php"+unsafeWindow.g_ajaxsuffix, {  method:"post",  parameters:params,
    
    onSuccess:function(transport){
     var rslt=eval("("+transport.responseText+")");
     if(rslt.ok){
     
      if(!rslt.data){
       
    t.myDiv.innerHTML +="<div class=pbStat>TOURNAMENT CHECK</div><div class='tourny_modal_upsell'><br><center><b>"+unsafeWindow.g_js_strings.modal_tourny_changetab.notourny+"</b></center></div>";
      
      
      }else{ //  rslt.data
       var tournyhtml=new Array();
       
       if(rslt.name){
        tournyhtml.push("<div class=pbStat><center>"+rslt.name.replace('The Tournament of Might','THE TOURNAMENT OF MIGHT')+"</center></div>")
       }  else{
        tournyhtml.push("<div class='tournymodaltitle'><center>"+unsafeWindow.g_js_strings.commonstr.tournament+"</div>")
       }
       tournyhtml.push("<div>");
       
       
       
       if(rslt.startdate&&rslt.enddate){
                var startTime=rslt.startdate;
                var endTime=rslt.enddate;
                var now=parseInt(new Date().getTime()/1000);
                tournyhtml.push("<table width=100% align=center class=pbTab><tr bgcolor=#FE8888><td width=40%><b>Starts</td><td width=40%><b>Ends</td><td width=20%><b>Ends</td></tr>");
                dt = new Date ();
                    dt.setTime (startTime * 1000);
                    dtf = new Date ();
                    dtf.setTime (endTime * 1000);
                   
                    var restant = endTime - now; 
                    
               
               tournyhtml.push("<tr><td>");
                 tournyhtml.push("" + dt.toLocaleDateString() + " - "+ dt.toLocaleTimeString());
                tournyhtml.push("</td><td>");
                tournyhtml.push("" + dtf.toLocaleDateString()+ " - "+ dtf.toLocaleTimeString());
                tournyhtml.push("</td><td>"+timestr(restant,1)+"</td></tr></table>");
             tournyhtml.push("<br>");
     
     }
     
  
     tournyhtml.push("<center><table class='tourny_list_table' cellpadding='0' cellspacing='0' border='0' width=90% style='margin:5px'>");
     tournyhtml.push("<thead>");
     tournyhtml.push("<tr>");
     if(rslt.type==24){
      tournyhtml.push("<td class='rankcol' style='background-color:red'>");
      tournyhtml.push("<div><input type=button id='BOTournoiPM' value='-'>&nbsp;"+unsafeWindow.g_js_strings.commonstr.ranking+"</div>");
      tournyhtml.push("</td>");
      tournyhtml.push("<td  style='background-color:red'>");
      tournyhtml.push("<div>Chancellor</div>");
      tournyhtml.push("</td>");
      tournyhtml.push("<td  style='background-color:red'>");
      tournyhtml.push("<div>"+unsafeWindow.g_js_strings.commonstr.alliance+"</div>");
      tournyhtml.push("</td>");
      tournyhtml.push("<td  style='background-color:red'>");
      tournyhtml.push("<div>"+unsafeWindow.g_js_strings.modal_tourny_changetab.mightgained+"</div>");
      tournyhtml.push("</td  style='background-color:red'>");
      tournyhtml.push("<td  style='background-color:red'> ");
      tournyhtml.push("<div>"+unsafeWindow.g_js_strings.modal_tourny_changetab.rewardperplayer+"</div>");
      tournyhtml.push("</td>")
      }else{
            tournyhtml.push("<td  class='rankcol' style='background-color:red'>");
      tournyhtml.push("<div><input type=button id='BOTournoiPM' value='-'>&nbsp;"+unsafeWindow.g_js_strings.commonstr.ranking+"</div>");
      tournyhtml.push("</td>");
      tournyhtml.push("<td  style='background-color:red'>");
      tournyhtml.push("<div>Player</div>");
      tournyhtml.push("</td>");
      tournyhtml.push("<td  style='background-color:red'>");
      tournyhtml.push("<div>"+unsafeWindow.g_js_strings.commonstr.alliance+"</div>");
      tournyhtml.push("</td>");
      tournyhtml.push("<td  style='background-color:red'>");
      tournyhtml.push("<div>"+rslt.contestcategory+"</div>");
      tournyhtml.push("</td>");
      tournyhtml.push("<td  style='background-color:red'>");
      tournyhtml.push("<div>"+unsafeWindow.g_js_strings.commonstr.reward+"</div>");
      tournyhtml.push("</td>")
     }
     tournyhtml.push("</tr>");
     tournyhtml.push("</thead>");
     tournyhtml.push("</tbody>");
     var nb=rslt.data.length;
     var votrepuissance = 0;
     for(var i=0;i<rslt.data.length;i++){
      var row=rslt.data[i];
      if(rslt.type==24){ // Tournament
       if (getMyAlliance()[1] == row.alliance) {
        votrepuissance=row.contestValue;
        break;
       }
      } else {
       if (Seed.player.prefix + ' '+ Seed.player.name == row.name ) {
        votrepuissance=row.contestValue;
        break;
       }  
      }
     }
     for(var i=0;i< Options.TournoiLigne;i++){
      var row=rslt.data[i];
      var rewardString=row.itemCount+" ";
      if(row.itemType==0){
       rewardString+=unsafeWindow.g_js_strings.commonstr.gems;
      }else{
       rewardString+=unsafeWindow.itemlist["i"+row.itemType].name;
      }
      var couleur="";
      if(rslt.type==24){ //Alliance Tournament
       if (getMyAlliance()[1] == row.alliance) {
        couleur=" style='background-color:#FF0000' ";
       }
      }else{
       if (Seed.player.prefix + ' '+ Seed.player.name == row.name ) {
        couleur=" style='background-color:#FF0000' ";
       }
      }
      if(i%2==1){
       tournyhtml.push("<tr>")
      }else{
       tournyhtml.push("<tr class='stripe'>")
      }
      tournyhtml.push("<td class='rankcol' "+couleur+">");
      tournyhtml.push("<div><b>"+row.ranking+"</b></div>");
      tournyhtml.push("</td>");
      tournyhtml.push("<td "+couleur+">");
      tournyhtml.push("<div>"+row.name+"</div>");
      tournyhtml.push("</td>");
      tournyhtml.push("<td "+couleur+">");
      tournyhtml.push("<div>"+(row.alliance||"----")+"</div>");
      tournyhtml.push("</td>");
      tournyhtml.push("<td "+couleur+">");
      tournyhtml.push("<div>"+addCommas(row.contestValue));
      if (votrepuissance>0) {
        var ecartavecvous = parseInt(row.contestValue - votrepuissance);
        if (ecartavecvous>0) {
         tournyhtml.push("&nbsp;(+ " + addCommas(ecartavecvous) +")");
        } 
        if (ecartavecvous<0) {
         tournyhtml.push("&nbsp;(" + addCommas(ecartavecvous) +")");
        }
      }
      tournyhtml.push("</div>");
      tournyhtml.push("</td>");
      tournyhtml.push("<td "+couleur+">");
      tournyhtml.push("<div>"+rewardString+"</div>");
      tournyhtml.push("</td>");
      tournyhtml.push("</tr>")
     } // fin du for
  
        if(rslt.type!=24){

      for(var i= Options.TournoiLigne;i<rslt.data.length;i++){
          var row=rslt.data[i];
       
          if (Seed.player.prefix + ' '+ Seed.player.name == row.name ) {
            var rewardString=row.itemCount+" ";
                if(row.itemType==0){
                 rewardString+=unsafeWindow.g_js_strings.commonstr.gems;
                }else{
                 rewardString+=unsafeWindow.itemlist["i"+row.itemType].name;
                }
                tournyhtml.push("<tr class='stripe' >")
                tournyhtml.push("<td class='rankcol' style='background-color:#FF0000'>");
                tournyhtml.push("<div><b>"+row.ranking+"</b></div>");
                tournyhtml.push("</td>");
                tournyhtml.push("<td style='background-color:#FF0000'>");
                tournyhtml.push("<div>"+row.name+"</div>");
                tournyhtml.push("</td>");
                tournyhtml.push("<td style='background-color:#FF0000'>");
                tournyhtml.push("<div>"+(row.alliance||"----")+"</div>");
                tournyhtml.push("</td>");
                tournyhtml.push("<td style='background-color:#FF0000'>");
                tournyhtml.push("<div>"+addCommas(row.contestValue)+"</div>");
                tournyhtml.push("</td>");
                tournyhtml.push("<td style='background-color:#FF0000'>");
                tournyhtml  .push("<div>"+rewardString+"</div>");
                tournyhtml.push("</td>");
                  tournyhtml.push("</tr>")
         }    
     }
     }
     tournyhtml.push("</tbody>");
     tournyhtml.push("</table>");
      tournyhtml.push("</div>");
      t.myDiv.innerHTML += tournyhtml.join("");      
           document.getElementById('BOTournoiPM').addEventListener ('click', function() { 
            var lg=rslt.data.length;
            if (rslt.type!=24) lg=25;
            t.plusmoins(lg);
           }, false);      
           
        if ((Options.TournoiLigne==5 && rslt.type!=24) || (Options.TournoiLigne==5 && rslt.type==24)) {
          document.getElementById('BOTournoiPM').value="Maximize";
      } else {
          document.getElementById('BOTournoiPM').value="Minimize";           
        }
          } // fin rslt.data 
         } else {
            t.myDiv.innerHTML = "<div class='tourny_modal_upsell'><center>No Info</div>";
         }
       }, onFailure:function()  {
         t.myDiv.innerHTML = "<div class='tourny_modal_upsell'><center>No Info</div>";
       }
   });
   t.displayTimer = setTimeout (t.show, 240000);       
  },
  plusmoins: function(lg) {
   var t = Tabs.Tournament;
   if (document.getElementById('BOTournoiPM').value=="Maximize") {
     document.getElementById('BOTournoiPM').value="Minimize";
     Options.TournoiLigne = lg;
   } else {
     document.getElementById('BOTournoiPM').value="Maximize";
     Options.TournoiLigne = 5;
   }
   saveOptions();
   clearTimeout (t.displayTimer);
   t.show();
  },  

}


/*********************************** Alliance TAB ***********************************/
Tabs.Alliance = {
  tabOrder : 7,
  type : 'Tools',
  tabLabel : unsafeWindow.g_js_strings.commonstr.alliance,
  myDiv : null,
  alliancemembers:[],
  number:0,
  totalmembers:0,
  error:false,
  sortType: 1,
  sortBy: 'Name',
  CardQuality:{0:"Simple",1:"Common",2:"Uncommon",3:"Rare",4:"Epic",5:"Wondrous"},
  
  init : function (div){    
    var t = Tabs.Alliance;      
    t.myDiv = div;
    t.totalmembers=0;
    t.alliancemembers=[];   
    unsafeWindow.getdetails = t.getMemberDetails;
    unsafeWindow.GetTRinfo = t.GetTRinfo;  
    var m =  '<DIV class=pbStat>ALLIANCE FUNCTIONS</div>';    
    m +='<TABLE class=pbTab><TD width=200px>List Alliance Members</td><TD>Sort by: '+ htmlSelector({Name:'Name',Might:'Might',glory:'Glory',Cities:'Cities',Position:'Position',dip:'Days in Position',uid:'User Id',fbuid:'Facebook id'},null,'id=searchAlli') +'</td>';
    m += '<TD><INPUT id=alList type=submit class=pbButton value="List"></td>';
    m += '<TD id=progress></td>';
    m += '<TR><TD width=200px>Show alliance diplomaties</td><TD><INPUT id=aldiplo type=submit class=pbButton value="List diplomaties"></td></tr>';
    m += '<TR><TD><SPAN id=DIVsend></span></td></tr></table>'; 
    m+='<DIV class=pbStat>OVERVIEW</div><DIV style="max-height:500px;overflow:auto" id=alOverviewTab></div><BR>';
      
    t.myDiv.innerHTML = m;    
    document.getElementById('alList').addEventListener('click', function(){
      if (!t.searching){
        t.totalmembers=0;
        t.alliancemembers=[]; 
        document.getElementById('alOverviewTab').innerHTML ="";
        document.getElementById('progress').innerHTML ="";
        document.getElementById('progress').innerHTML = unsafeWindow.g_js_strings.commonstr.loadingddd;
        document.getElementById('alList').disabled = true;
        t.error=false;
        t.fetchAllianceMemberFirstPage();
    } 
    }, false);
    
    document.getElementById('searchAlli').addEventListener('click', function(){
        if (t.alliancemembers!="") {
          document.getElementById('alOverviewTab').innerHTML ="";
          t.paintMembers(); 
        }
    }, false);
    document.getElementById('aldiplo').addEventListener('click', function(){t.paintDiplomacy();}, false);      
  },
  
  paintMembers: function(){
  var t = Tabs.Alliance;
  if(document.getElementById('searchAlli').value == t.sortBy)t.sortType *= -1;
   else t.sortType = 1; 
  t.sortBy = document.getElementById('searchAlli').value;
  var sortmembers = t.alliancemembers.sort(function(a, b){
  var sortA = a[t.sortBy],sortB = b[t.sortBy];
     if(t.sortType > 0){
       if(typeof(sortA) == 'number' && typeof(sortB) == 'number') return sortA - sortB;
        else return sortA.localeCompare(sortB);  
     } else {
       if(typeof(sortA) == 'number' && typeof(sortB) == 'number') return sortB - sortA;
        else return sortB.localeCompare(sortA);  
     }
  });
  document.getElementById('alOverviewTab').innerHTML = '<TABLE id=alMembers width=90%><TR align="center"></tr></table>';;
  for (var y = (sortmembers.length-1); y >=0; y--) t._addTab(sortmembers[y].Name,sortmembers[y].Might,sortmembers[y].LastLogin,sortmembers[y].Position,sortmembers[y].dip,sortmembers[y].uid,sortmembers[y].fbuid,sortmembers[y].Cities,sortmembers[y].glory,sortmembers[y].dateJoined);
   t._addTabHeader();
 },

  MsgPopUp: function(){
    var t = Tabs.Alliance;
    var To = [];
    var element_class = document.getElementsByClassName('AllianceMSG'); 
    for (k=0;k<element_class.length;k++) if (element_class[k].checked) To.push(element_class[k].id.substr(4));
    if (To.length ==0) {alert('Select members...');return;}
    document.getElementById('alOverviewTab').innerHTML ="";
    document.getElementById('DIVsend').innerHTML = "";
    var m = '<TABLE class=pbTab><BR><INPUT id=SendMail type=submit class=pbButton value="Send Message"><BR><DIV id=MSGlist></div>';
    m+= '<BR><BR>Subject:&nbsp<input type=text id=MailSubject><BR><BR>';
    m += '<textarea type="text" id="MailContent" rows=20 cols=80></textarea></table>';
    document.getElementById('alOverviewTab').innerHTML = m;
    var mm = 'Receipents: <BR><TABLE border="1" width=100%><TR>';
    for (var i=0;i<To.length;i++) {
      if (i%10==0) mm+='</tr><TR>';
      mm += '<TD>' + To[i] +'</td>';
    }
    mm += '</tr></table>';  
    document.getElementById('MSGlist').innerHTML = mm;
    document.getElementById("SendMail").addEventListener ('click', function (){t.MSGLoop(To,document.getElementById('MailSubject').value,document.getElementById('MailContent').value)}, false);
  },

  MSGLoop: function (To,Subject,Content){
    var t = Tabs.Alliance;
    document.getElementById('alOverviewTab').innerHTML = "<U>Sending messages:</u><BR><BR>";
    for (var i=0;i<To.length;i++){
      document.getElementById('alOverviewTab').innerHTML += "<BR>" + To[i] + ': ' + '<SPAN id="Send_'+To[i]+'"></span>';
      setTimeout(t.SendMSG,(i*1000),To[i],Subject,Content);
    }

  },

  SendMSG: function(To,Subject,Content){
      var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
      params.emailTo = To;
      params.subject = Subject;
      params.message = Content;
      params.requestType = "COMPOSED_MAIL";
      new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getEmail.php" + unsafeWindow.g_ajaxsuffix, {
          method: "post",
          parameters: params,
          onSuccess: function (message) {
              var rslt = eval("(" + message.responseText + ")");
              if (rslt.ok) document.getElementById('Send_'+To).innerHTML = '<FONT color=green>Send</font>';
               else t.SendMSG(To,Subject,Content);
          },
          onFailure: function () {},
      });
  },

    _addTab: function(Name,Might,LastLogin,Position,dip,uid,fbuid,Cities,glory,dateJoined){
    var t = Tabs.Alliance;
    var avatar = "https://graph.facebook.com/"+fbuid+"/picture";
    var row = document.getElementById('alMembers').insertRow(0);
    row.vAlign = 'top';
    row.insertCell(0).innerHTML = '<INPUT class="AllianceMSG" id="MSG_'+Name+'" type=checkbox unchecked=true>';
    row.insertCell(1).innerHTML ='<A target="_tab" href="http://www.facebook.com/profile.php?id='+ fbuid +'"><img width=25 src="'+ avatar +'"></a>';
    row.insertCell(2).innerHTML = Name;
    var cell2 = row.insertCell(3); 
    cell2.width = "60" ;
    cell2.align = "right" ;
    cell2.vAlign = "top";
    cell2.innerHTML = addCommas(Might);
    var cell2 = row.insertCell(4);
    cell2.width = "60" ;
    cell2.align = "right" ;
    cell2.vAlign = "top";
    cell2.innerHTML = addCommas(glory);
    var cell2 = row.insertCell(5);
    cell2.width = "60" ;
    cell2.align = "center" ;
    cell2.vAlign = "top";
    cell2.innerHTML = Cities;
    row.insertCell(6).innerHTML = officerId2String (Position);
    row.insertCell(7).innerHTML = dip;
    row.insertCell(8).innerHTML = LastLogin;
    row.insertCell(9).innerHTML = dateJoined;
    row.insertCell(10).innerHTML ='<A onclick="GetTRinfo('+ uid +')">View</a>'; 
    },
          
    _addTabHeader: function() {
    var t = Tabs.Alliance;
    var row = document.getElementById('alMembers').insertRow(0);
    row.vAlign = 'top';
    row.insertCell(0).innerHTML = "&nbsp";
    row.insertCell(1).innerHTML = "<u><b>FB</b></u>";
    row.insertCell(2).innerHTML = "<u><b>Name</b></u>";
    row.insertCell(3).innerHTML = "<u><b>Might</b></u>";

    row.insertCell(4).innerHTML = "<u><b>Glory</b></u>";
    row.insertCell(5).innerHTML = "<u><b>Cities</b></u>";
    row.insertCell(6).innerHTML = "<u><b>Position</b></u>";
    row.insertCell(7).innerHTML = "<u><b>DIP</b></u>";
    row.insertCell(8).innerHTML = "<u><b>Last Login</b></u>";
    row.insertCell(9).innerHTML = "<u><b>Joined</b></u>";
    row.insertCell(10).innerHTML = "<u><b>TR</b></u>";
    },


    GetTRinfo: function(uid){
      var t = Tabs.Alliance;
      var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
      params.ctrl = 'throneRoom\\ThroneRoomServiceAjax';
      params.action = 'getEquipped';
      params.playerId = uid;    
      new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch53.php" + unsafeWindow.g_ajaxsuffix, {
          method: "post",
          parameters: params,
          loading: true,
          onSuccess: function (transport) {
              var rslt = eval("(" + transport.responseText + ")");
                  if(rslt.ok) {
                    msg ='<TABLE width=100% height=0% class=pbTab><TR>';
              for (i=1;i<=7;i++){
                if (i%2==0) msg+='</tr><TR>';
                msg+='<TD><DIV id=DIV_TR_'+ i +'></div></td>';  
              }
            msg+="</tr></table>"
                    var pop = new pbPopup ('showTR', 0, 0, 700, 500, true);
              pop.centerMe (mainPop.getMainDiv());  
              pop.getMainDiv().innerHTML = msg;
              pop.getTopDiv().innerHTML = '<CENTER><B>Throne Room</b></center>';
              pop.show (true);
              for (var i=1;i<=rslt.items.length;i++) {
                      document.getElementById('DIV_TR_'+i).innerHTML = t.paintEquipInfo(rslt.items[i-1]);
                    }
                  }
          },
          onFailure: function () {return;},
      });
    },

    paintEquipInfo : function (y){
    var t = Tabs.Alliance;
    var m="";
    var color = "black";
    var id =0;
    var tier=0;
    var Current=0;
    if (parseInt(y.unique) > 0) {
      var Name = unsafeWindow.g_js_strings.throneRoom["unique_" + y.type + y.unique];
      var icon = 'https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/throne/icons/30/' + y.faction + '/' + y.faction + '_'+ y.type +'_unique_normal_'+ y.unique+'.png';
    } else {
      var Name = t.CardQuality[y.quality] + ' ' + y.type + " " + unsafeWindow.g_js_strings.commonstr.of + " " + unsafeWindow.cm.ThroneController.getEffectSuffix(y["effects"]["slot5"]["id"]) + " +" + y.level;
      var icon = 'https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/throne/icons/30/' + y.faction + '/' + y.faction + '_'+ y.type +'_normal_1_'+ y.quality+'.png';
    }
    m='<TABLE width=80% height=0% align="center" class=ThroneEQ style="background: transparent url('+ icon +') bottom right no-repeat; background-color:#FFFFE3;">';
    switch(parseInt(y["quality"])){
      case 1:color="grey";break;
      case 2:color="white";break;
      case 3:color="green";break;
      case 4:color="blue";break;
      case 5:color="purple";break;
      default:break;
    }
      m+='<TR><TD style="background-color:#D5C795"><FONT color='+ color +'><B>' + Name + '</b></font></td></tr>';
    for (i=1;i<=5;i++) {
        id = y["effects"]["slot"+i]["id"];
        tier = parseInt(y["effects"]["slot"+i]["tier"]);
        level = y.level;
        p = unsafeWindow.cm.thronestats.tiers[id][tier];
        Current = p.base + ((level * level + level) * p.growth * 0.5);
        var quality = parseInt(y["quality"]);
      if (i<=quality) m+='<TR><TD><FONT color=black>' + Math.round(Current*100)/100 + "% " + unsafeWindow.cm.thronestats["effects"][id]["1"] + '</font></td></tr>';
      else m+='<TR><TD><FONT color=grey>' + Math.round(Current*100)/100 + "% " + unsafeWindow.cm.thronestats["effects"][id]["1"] + '</font></td></tr>';
    }
    m+="</table>"
    return m;
  },
    
    
    paintDiplomacy : function () {
      document.getElementById('alOverviewTab').innerHTML ="";
      document.getElementById('progress').innerHTML ="";
      var m= '<TABLE class=pbTab width=300px><TR><TD colspan=4 style="background: #33CC66;" align=center><B>Friendly: </b></td></tr>';
      if (Seed.allianceDiplomacies['friendly'] == null) m+='<TR><TD>No Friendlies found...</td>';
      else m += '<TABLE class=pbTab width=300px><TR><TD width=200px>Alliance Name</td><TD align=center>Members</td></tr>';
      for (k in Seed.allianceDiplomacies['friendly']){
        m+='<TR><TD>'+Seed.allianceDiplomacies['friendly'][k]['allianceName']+'</td>';
        m+='<TD align=center>'+Seed.allianceDiplomacies['friendly'][k]['membersCount']+'</td>';
      }
      m+='<TR></tr></table><TABLE class=pbTab width=300px>';
      m+= '<TR><TD colspan=4 style="background: #CC0033;" align=center><B>Hostile: </b></td></tr>';
      if (Seed.allianceDiplomacies['hostile'] == null) m+='<TR><TD>No Hostiles found...</td>';
      else m += '<TABLE class=pbTab width=300px><TR><TD width=200px>Alliance Name</td><TD align=center>Members</td></tr>';
      for (k in Seed.allianceDiplomacies["hostile"]){
        m+='<TR><TD>'+Seed.allianceDiplomacies["hostile"][k]['allianceName']+'</td>';
        m+='<TD align=center>'+Seed.allianceDiplomacies["hostile"][k]['membersCount']+'</td>';
      }
      m+='<TR></tr></table><TABLE class=pbTab width=300px>';
      m+= '<TR><TD colspan=4 style="background: #FF6633;" align=center><B>Friendly towards us: </b></td></tr>';
      if (Seed.allianceDiplomacies['friendlyToYou'] == null) m+='<TR><TD>No Friendlies towards us found...</td>';
      else m += '<TABLE class=pbTab width=300px><TR><TD width=200px>Alliance Name</td><TD align=center>Members</td></tr>';
      for (k in Seed.allianceDiplomacies["friendlyToYou"]){
        m+='<TR><TD>'+Seed.allianceDiplomacies["friendlyToYou"][k]['allianceName']+'</td>';
        m+='<TD align=center>'+Seed.allianceDiplomacies["friendlyToYou"][k]['membersCount']+'</td>';
      }
      m+='<TR></tr></table>';
      document.getElementById('alOverviewTab').innerHTML = m;
    },
    
  
    fetchAllianceMemberFirstPage : function () {
      var t = Tabs.Alliance;
      document.getElementById('alList').disabled = true;
      var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
      var Members = 0;

      params.pageNo = 1;
      params.pf = 0;
    new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/allianceGetMembersInfo.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (transport) {
        var info = eval("(" + transport.responseText + ")");
        if (info.ok) {
          document.getElementById('progress').innerHTML='Searching: <PROGRESS id=searchProgress value="1" max="'+ info.noOfPages +'"></progress>';
          Members = info.memberCount;
            for (var k in info["memberInfo"]){
              if ( info["memberInfo"][k]["might"] != undefined && !t.error){  
                  t.alliancemembers.push ({
                    Name: info["memberInfo"][k]["name"],
                    Might: parseInt(info["memberInfo"][k]["might"]),
                    Cities: parseInt(info["memberInfo"][k]["cities"]),
                    Position : parseInt(info["memberInfo"][k]["positionType"]),
                    dip : parseInt(info["memberInfo"][k]["daysInPosition"]),
                    LastLogin : info["memberInfo"][k]["lastLogin"],
                    uid : parseInt(info["memberInfo"][k]["userId"]),
                    fbuid : parseInt(info["memberInfo"][k]["fbuid"]),
                 	avatarurl : info["memberInfo"][k]["avatarurl"],
                 	glory : parseInt(info["memberInfo"][k]["glory"]),
                 	dateJoined : info["memberInfo"][k]["dateJoined"],                 
                  });
                }
               document.getElementById('alOverviewTab').innerHTML ="";
               t.paintMembers();
          }
          for (var i=2;i<=info.noOfPages;i++) setTimeout(t.fetchAllianceMemberPages,((i-1)*1000),i,info.noOfPages,Members);
        } else  if (info.error) {
          document.getElementById('alList').disabled = false;
          document.getElementById('progress').innerHTML = "ERROR!";
          t.error=true;
        }
      },
    });
  },  

  fetchAllianceMemberPages : function (page,noOfPages,Members) {
      var t = Tabs.Alliance;
      var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
      params.pageNo = page;
      params.pf = 0;
    new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/allianceGetMembersInfo.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (transport) {
        var info = eval("(" + transport.responseText + ")");
        if (info.ok) {
            document.getElementById('searchProgress').value = page;
            for (var k in info["memberInfo"]){
              if ( info["memberInfo"][k]["might"] != undefined && !t.error){  
                  t.alliancemembers.push ({
                     Name: info["memberInfo"][k]["name"],
                     Might: parseInt(info["memberInfo"][k]["might"]),
                     Cities: parseInt(info["memberInfo"][k]["cities"]),
                     Position : parseInt(info["memberInfo"][k]["positionType"]),
                     dip : parseInt(info["memberInfo"][k]["daysInPosition"]),
                     LastLogin : info["memberInfo"][k]["lastLogin"],
                     uid : parseInt(info["memberInfo"][k]["userId"]),
                     fbuid : parseInt(info["memberInfo"][k]["fbuid"]),
                 avatarurl : info["memberInfo"][k]["avatarurl"],
                 glory : parseInt(info["memberInfo"][k]["glory"]),
                 dateJoined : info["memberInfo"][k]["dateJoined"],                 
                  });
                }
               document.getElementById('alOverviewTab').innerHTML ="";
               t.paintMembers();
          }
            if (params.pageNo == noOfPages) {
              document.getElementById('progress').innerHTML = '(' + (t.alliancemembers.length+1) +'/'+ Members +')';
              document.getElementById('alList').disabled = false;   
              document.getElementById('DIVsend').innerHTML = '<INPUT id=SendMSG type=submit class=pbButton value="Msg selected members...">';
              document.getElementById('SendMSG').addEventListener('click', function(){t.MsgPopUp();}, false);
            }
        } else  if (info.error) {
          document.getElementById('alList').disabled = false;
          document.getElementById('progress').innerHTML = "ERROR!";
          t.error=true;
        }
      },
    });
  },  
  hide : function (){},
  show : function (){},
};


/********************************* Messages Tab *************************************/
Tabs.Rpt = {
  tabOrder:    9,
  type: 'Tools',
  tabLabel:    'Reports',
  cont:        null,
  state:       null,
  minPages:    parseInt(Options.arPageFrom),
  maxPages:    parseInt(Options.arPageTo),
  data:        [],
  report:      [],
  totalPages:  parseInt(Options.arPageTo),
  what:        '',
  whatNot:     '',
  content:     '',

  init: function (div){
    var t = Tabs.Rpt;
    t.cont=div;
    unsafeWindow.getmsg = t.getMailBody;
    unsafeWindow.getReport = t.getReportBody;

    var tc = '<DIV class=pbStat>Alliance Report Scanner:</DIV>';
    tc += '<TABLE class=ptTab width=100%><TR><TD><INPUT id=togWatchdog type=checkbox '+(Options.watchdog?'CHECKED':'')+'> Post Alliance Reports to Chat</td>';
    tc += '<TD>Scan interval: <INPUT id=WatchdogInterval type=text size=3 value='+Options.WatchdogInterval+'> seconds</td>';
    tc += '<TD><TD><INPUT id=WatchDogFilter type=checkbox '+(Options.WatchDogFilter?'CHECKED':'')+'> Show friendly reports</td><TD><B>Check that only 1 member is running the scanner!!!</b></td></tr></table>'
    tc += '<BR><DIV class=pbStat>SEARCH INBOX, OUTBOX, PLAYER AND ALLIANCE REPORTS</DIV><DIV class=ptentry><TABLE><TR align=center valign=center>';
    tc += '<TD class=xtab align=right>Type:&nbsp;<SELECT id="idRptType">';
    tc += '<OPTION value="alliance" ' + (Options.rptType=='alliance'?'SELECTED':'') + '>Alliance Reports</OPTION>';
    tc += '<OPTION value="player" ' + (Options.rptType=='player'?'SELECTED':'') + '>Player Reports</OPTION>';
    tc += '<OPTION value="inbox" ' + (Options.rptType=='inbox'?'SELECTED':'') + '>Inbox</OPTION>';
    tc += '<OPTION value="outbox" ' + (Options.rptType=='outbox'?'SELECTED':'') + '>Outbox</OPTION></SELECT>';
    tc += '<BR />Pages:&nbsp;<INPUT id="idRptPageFrom" size=1 value="' + Options.arPageFrom + '">&#8211;<INPUT id="idRptPageTo" size=1 value="' + Options.arPageTo + '"></TD>';
    tc += '<TD class=xtab align=right>Attacker:&nbsp;<SELECT id="idRptAttacker">'; // Options.arPageFrom - Options.arPageTo
    tc += '<OPTION value="Them" ' + (Options.arAttacker=='Them'?'SELECTED':'') + '>Them</OPTION>';
    tc += '<OPTION value="Us" ' + (Options.arAttacker=='Us'?'SELECTED':'') + '>Us</OPTION>';
    tc += '<OPTION value="Both" ' + (Options.arAttacker=='Both'?'SELECTED':'') + '>Both</OPTION></SELECT>';
    tc += '<BR />Target:&nbsp;<SELECT id="idRptTarget">';
    tc += '<OPTION value="Them" ' + (Options.arTarget=='Them'?'SELECTED':'') + '>Them</OPTION>';
    tc += '<OPTION value="Us" ' + (Options.arTarget=='Us'?'SELECTED':'') + '>Us</OPTION>';
    tc += '<OPTION value="Both" ' + (Options.arTarget=='Both'?'SELECTED':'') + '>Both</OPTION></SELECT></TD>';
    tc += '<TD class=xtab align=right>Contains:&nbsp;<INPUT id=idRptWhat type=text size=11 maxlength=50 value=""><BR />';
    tc += 'But not:&nbsp;<INPUT id=idRptWhatNot type=text size=11 maxlength=50 value=""></TD>';
    tc += '<TD class=xtab align=left><INPUT id=idRptAttack type=checkbox '+(Options.arAttack?'CHECKED':'')+' />&nbsp;Attack<BR />';
    tc += '<INPUT id=idRptScout type=checkbox '+(Options.arScout?'CHECKED':'')+' />&nbsp;Scout</TD>';
    tc += '<TD class=xtab align=left><INPUT id=idRptReinforce type=checkbox '+(Options.arReinforce?'CHECKED':'')+' />&nbsp;Reinforce<BR />';
    tc += '<INPUT id=idRptTransport type=checkbox '+(Options.arTransport?'CHECKED':'')+' />&nbsp;Transport</TD>';
    tc += '<TD class=xtab align=left><INPUT id=idRptSearch type=submit class=pbButton value="Start Search" /></TD></TR></TABLE></DIV>';
    tc += '<DIV class=pbStat><TABLE width=100% cellspacing=0><TR><TD class=xtab align=left width=125><DIV id=idRptSearched></DIV></TD></TD>';
    tc += '<TD class=xtab><TD class=xtab align=center><SPAN style="white-space:normal" id=idRptStatus>&nbsp;</span></TD></TD>';
    tc += '<TD class=xtab><TD class=xtab align=right width=125><DIV id=idRptFound></DIV></TD></TR></TABLE></DIV>';
    tc += '<DIV id="idRptResultsDiv" style="height:556px; max-height:556px; overflow-x:auto; overflow-y:auto; white-space:nowrap;"></DIV>';
    t.cont.innerHTML = tc;
    document.getElementById('idRptType').addEventListener ('change', t.handleRptType, false);
    document.getElementById('idRptPageFrom').addEventListener ('change', t.handleRptPages, false);
    document.getElementById('idRptPageTo').addEventListener ('change', t.handleRptPages, false);
    document.getElementById('idRptAttacker').addEventListener ('change', t.handleRptAttacker, false);
    document.getElementById('idRptTarget').addEventListener ('change', t.handleRptTarget, false);
    document.getElementById('idRptWhat').addEventListener ('keyup', t.handleRptWhat, false);
    document.getElementById('idRptWhatNot').addEventListener ('keyup', t.handleRptWhatNot, false);
    document.getElementById('idRptSearch').addEventListener ('click', t.handleRptSearch, false);
    document.getElementById('togWatchdog').addEventListener ('click', t.SaveOptions, false);
    document.getElementById('WatchdogInterval').addEventListener ('change', t.SaveOptions, false);
    document.getElementById('WatchDogFilter').addEventListener ('click', t.SaveOptions, false);

    t.togOpt ('idRptAttack', 'arAttack');
    t.togOpt ('idRptScout', 'arScout');
    t.togOpt ('idRptReinforce', 'arReinforce');
    t.togOpt ('idRptTransport', 'arTransport');

    return this.cont;
  },
  
  SaveOptions:function(){
  		Options.watchdog = document.getElementById('togWatchdog').checked;
    	Options.WatchDogInterval = document.getElementById('WatchdogInterval').value;
    	Options.WatchDogFilter = document.getElementById('WatchDogFilter').checked;
    	saveOptions();
  },

  togOpt: function (checkboxId, optionName){
    var t = Tabs.Rpt;
    var checkbox = document.getElementById(checkboxId);
    checkbox.addEventListener ('change', eventHandler, false);
    function eventHandler (){
      Options[optionName] = this.checked;
      saveOptions();
      if (t.data.length > 0)
        if (Options.rptType == 'alliance' || Options.rptType == 'player')
          t.DisplayRpt();
        else
          t.DisplayMail();
    }
  },

  handleRptType: function(){
    var t = Tabs.Rpt;
    Options.rptType = document.getElementById("idRptType").value;
    saveOptions();
    document.getElementById("idRptSearched").innerHTML = '';
    document.getElementById("idRptStatus").innerHTML = '&nbsp;';
    document.getElementById("idRptFound").innerHTML = '';
    document.getElementById("idRptResultsDiv").innerHTML = '';
  },

  handleRptPages: function(){
    var t = Tabs.Rpt;
    t.minPages=parseInt(document.getElementById("idRptPageFrom").value);
    t.maxPages=parseInt(document.getElementById("idRptPageTo").value);
    if (t.maxPages < t.minPages) {
      t.maxPages = t.minPages;
      document.getElementById("idRptPageTo").value = t.maxPages;
    }
    Options.arPageFrom = t.minPages;
    Options.arPageTo = t.maxPages;
    saveOptions();
    t.totalPages=t.maxPages;
  },

  handleRptAttacker: function(){
    var t = Tabs.Rpt;
    Options.arAttacker = document.getElementById("idRptAttacker").value;
    saveOptions();
    if ((Options.rptType == 'alliance' || Options.rptType == 'player') && t.data.length > 0)
      t.DisplayRpt();
  },

  handleRptTarget: function(){
    var t = Tabs.Rpt;
    Options.arTarget = document.getElementById("idRptTarget").value;
    saveOptions();
    if ((Options.rptType == 'alliance' || Options.rptType == 'player') && t.data.length > 0)
      t.DisplayRpt();
  },

  handleRptWhat: function(){
    var t = Tabs.Rpt;
    t.what = document.getElementById("idRptWhat").value;
    if (t.data.length > 0)
      if (Options.rptType == 'alliance' || Options.rptType == 'player')
        t.DisplayRpt();
      else
        t.DisplayMail();
  },

  handleRptWhatNot: function(){
    var t = Tabs.Rpt;
    t.whatNot = document.getElementById("idRptWhatNot").value;
    if (t.data.length > 0)
      if (Options.rptType == 'alliance' || Options.rptType == 'player')
        t.DisplayRpt();
      else
        t.DisplayMail();
  },

  handleRptSearch: function(){
    var t = Tabs.Rpt;
    if (t.searchRunning){
      t.searchRunning = false;
      t.stopSearch ('SEARCH CANCELLED!');
      return;
    }
    t.handleRptPages();
    document.getElementById ('idRptSearch').value = 'Stop Search';
    document.getElementById('idRptStatus').innerHTML = 'Searching page ' + t.minPages + ' of ' + t.maxPages;
    t.searchRunning = true;
    t.data=[];
    t.report = [];
    if (Options.rptType == 'alliance' || Options.rptType == 'player')
      t.getRpt(t.minPages);
    else
      t.getMail(t.minPages);
  },

  stopSearch: function (msg){
    var t = Tabs.Rpt;
    if (t.searchRunning || msg == 'SEARCH CANCELLED!')
      document.getElementById ('idRptStatus').innerHTML = '<FONT color=#ffaaaa>' + msg + '</FONT>';
    document.getElementById ('idRptSearch').value = 'Start Search';
    t.searchRunning = false;
    if (Options.rptType == 'alliance' || Options.rptType == 'player')
      t.DisplayRpt();
    else
      t.DisplayMail();
  },

  getMail: function (pageNum){
    var t = Tabs.Rpt;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.pf=0;
    params.requestType="GET_MESSAGE_HEADERS_FOR_USER_INBOX";
    params.boxType = document.getElementById('idRptType').value;
    params.pageNo = pageNum;
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getEmail.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        t.getMailCallback(rslt, pageNum);
      },
      onFailure: function () {
      },
    }, false);
  },

  getMailCallback: function(rslt, page) {
    var t = Tabs.Rpt;
    if (rslt) {
      if (!rslt.ok) {
        document.getElementById("idRptStatus").innerHTML = '<FONT color=#ffaaaa>' + rslt.errorMsg + '</FONT>';
        return;
      }
      t.totalPages=parseInt(rslt.noOfPages);
      if (t.totalPages < t.maxPages)
        t.maxPages = t.totalPages;
      if (rslt.message && page) {
        var ml = rslt.message;
        if (rslt.messageCount > 0) {
          var rptkeys = unsafeWindow.Object.keys(ml);
          for (var i = 0; i < rptkeys.length; i++) {
            var rpt = ml[rptkeys[i]];
            rpt.page = page;
            t.data.push(rpt);
          }
        }
      }
      if (parseInt(page)+1 <= t.maxPages && t.searchRunning) {
        document.getElementById("idRptStatus").innerHTML = 'Searching page ' + (parseInt(page)+1) + ' of ' + t.maxPages;
        t.getMail(parseInt(page)+1);
        if (t.data.length > 0)
          t.DisplayMail();
      } else if (page)
        t.stopSearch ('Done!');
    }
  },

  getRpt: function (pageNum){
    var t = Tabs.Rpt;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.pageNo = pageNum;
    if (Options.rptType == 'alliance')
      params.group = "a";
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/listReports.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt){
        t.getRptCallback (rslt, pageNum);
      },
      onFailure: function (rslt){
        t.getRptCallback (rslt, pageNum);
      },
    }, false);
  },

  getRptCallback: function(rslt, page){
    var t = Tabs.Rpt;
    if (rslt) {
      if (!rslt.ok) {
        document.getElementById("idRptStatus").innerHTML = '<FONT color=#ffaaaa>' + rslt.errorMsg + '</FONT>';
        return;
      }
      t.totalPages=parseInt(rslt.totalPages);
      if (t.totalPages < t.maxPages)
        t.maxPages = t.totalPages;
      if (rslt.arReports && page) {
        var ar = rslt.arReports;
        if (ar.length == 0)
          t.stopSearch('Empty pages found from page ' + page + ' onwards - Kabam glitch');
        var rptkeys = unsafeWindow.Object.keys(ar);
        for (var i = 0; i < rptkeys.length; i++) {
          var rpt = ar[rptkeys[i]];
          var reportId = parseInt(rpt.reportId);
          t.report[reportId] = [];

          // Attacker
          t.report[reportId].side1Name = rslt.arPlayerNames['p'+rpt.side1PlayerId];
          t.report[reportId].side1AllianceId = parseInt(rpt.side1AllianceId);
          if (rpt.side1AllianceId > 0)
            t.report[reportId].side1AllianceName = rslt.arAllianceNames['a'+rpt.side1AllianceId];
          else
            t.report[reportId].side1AllianceName = 'unaligned';
          if (rpt.side1CityId > 0)
            t.report[reportId].side1CityName = rslt.arCityNames['c'+rpt.side1CityId];
          else
            t.report[reportId].side1CityName = 'none';
          t.report[reportId].side1XCoord = rpt.side1XCoord;
          t.report[reportId].side1YCoord = rpt.side1YCoord;
          // Target
          if (parseInt(rpt.side0PlayerId) == 0) { // Kabam
            t.report[reportId].side0Name = 'Enemy';
            t.report[reportId].side0AllianceName = '';
            t.report[reportId].side0CityName = '';
          } else { // Player
            t.report[reportId].side0Name = rslt.arPlayerNames['p'+rpt.side0PlayerId];
            if (rpt.side0AllianceId > 0)
              t.report[reportId].side0AllianceName = rslt.arAllianceNames['a'+rpt.side0AllianceId];
            else
              t.report[reportId].side0AllianceName = 'unaligned';
            if (rpt.side0CityId > 0)
              t.report[reportId].side0CityName = rslt.arCityNames['c'+rpt.side0CityId];
            else
              t.report[reportId].side0CityName = 'none';
          }
          t.report[reportId].side0AllianceId = parseInt(rpt.side0AllianceId);
          t.report[reportId].side0XCoord = rpt.side0XCoord;
          t.report[reportId].side0YCoord = rpt.side0YCoord;
          if (parseInt(rpt.side0TileType) == 10)
            t.report[reportId].side0TileTypeText='Grass';
          else if (parseInt(rpt.side0TileType) == 11)
            t.report[reportId].side0TileTypeText='Lake';
          else if (parseInt(rpt.side0TileType) == 20)
            t.report[reportId].side0TileTypeText='Woods';
          else if (parseInt(rpt.side0TileType) == 30)
            t.report[reportId].side0TileTypeText='Hills';
          else if (parseInt(rpt.side0TileType) == 40)
            t.report[reportId].side0TileTypeText='Mount';
          else if (parseInt(rpt.side0TileType) == 50)
            t.report[reportId].side0TileTypeText='Plain';
          else if (parseInt(rpt.side0CityId) ==0)
            t.report[reportId].side0TileTypeText='Barb';
          else
            t.report[reportId].side0TileTypeText='City';
          t.report[reportId].side0TileTypeLevel = t.report[reportId].side0TileTypeText + ' ' + rpt.side0TileLevel;
          t.report[reportId].side0TileType = rpt.side0TileType;
          t.report[reportId].side0TileLevel = rpt.side0TileLevel;
          // Miscellaneous
          t.report[reportId].page = page;
          t.report[reportId].reportUnixTime = rpt.reportUnixTime;
          if (rpt.side0AllianceId == parseInt(getMyAlliance()[0]))
            t.report[reportId].sideId = 0;
          else if (rpt.side1AllianceId == parseInt(getMyAlliance()[0])) {
            t.report[reportId].sideId = 1;
          } else { // if we're here then this is a player report from when they were in another alliance
            if (rpt.side0PlayerId == getMyUserId())
              t.report[reportId].sideId = 0;
            else if (rpt.side1PlayerId == getMyUserId())
              t.report[reportId].sideId = 1;
            else // shouldn't get here but we'll catch it if the report body is requested
              t.report[reportId].sideId = -1;
          }
          if (rpt.marchType == 0)
            t.report[reportId].marchName = 'Desertion';
          else if (rpt.marchType == 1)
            t.report[reportId].marchName = 'Transport';
          else if (rpt.marchType == 2)
            t.report[reportId].marchName = 'Reinforce';
          else if (rpt.marchType == 3) {
            if (t.report[reportId].sideId == 0)
              t.report[reportId].marchName = 'Anti-Scout';
            else
              t.report[reportId].marchName = 'Scout';
          } else if (rpt.marchType == 4) {
            if (t.report[reportId].sideId == 0)
              t.report[reportId].marchName = 'Defend';
            else
              t.report[reportId].marchName = 'Attack';
          } else
            t.report[reportId].marchName = '?';
          t.data.push ({
            reportId: reportId,
          });
        }
      }
      if (parseInt(page)+1 <= t.maxPages && t.searchRunning) {
        document.getElementById("idRptStatus").innerHTML = 'Searching page ' + (parseInt(page)+1) + ' of ' + t.maxPages;
        t.getRpt(parseInt(page)+1);
        if (t.data.length > 0)
          t.DisplayRpt();
      } else if (page)
        t.stopSearch ('Done!');
    }
  },

  DisplayMail: function (){
    var t = Tabs.Rpt;
    var results = document.getElementById("idRptResultsDiv");
    if(!t.data.length) {
      results.innerHTML = '<center>None found</center>';
      return;
    }
    reportsSearched = t.data.length;
    reportsFound = 0;
    t.content = '';
    for (var i=0; i<reportsSearched;i++) {
      var rpt = t.data[i];
      if ((t.what == '' || (rpt.subject.search(t.what, "i") != -1) || (rpt.displayName.search(t.what, "i") != -1))
        && (t.whatNot == '' || ((rpt.subject.search(t.whatNot, "i") == -1) && (rpt.displayName.search(t.whatNot, "i") == -1)))) {
        reportsFound++;
        if (reportsFound == 1)
          t.content += '<center><table><thead><th>P</th><th>Date</th><th>From</th><th>Subject</th></thead><tbody>';
        t.content += '<tr><td align=right>'+rpt.page+'</td><td>'+rpt.dateSent+'</td><td>'+rpt.displayName+'</td>';
        t.content += '<td><A><SPAN onclick="getmsg('+ rpt.messageId +')">' + rpt.subject + '</SPAN></a></td></tr>';
      }
    }
    if (reportsFound > 1)
      t.content += '</tbody></table></center>';
    if (reportsFound == 0 && reportsSearched > 0)
      t.content = '<center>None found</center>';
    results.innerHTML = t.content;
    document.getElementById("idRptSearched").innerHTML = '&nbsp;Searched: ' + reportsSearched;
    document.getElementById("idRptFound").innerHTML = 'Found: ' + reportsFound;
  },

  getMailBody: function(ID,dataI){
    var t = Tabs.Rpt;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.messageId=ID;
    params.requestType="GET_MESSAGE_FOR_ID";

    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getEmail.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        if (rslt.ok)
          t.displayMailBody(rslt.messageBody);
      },
      onFailure: function () {},
    }, false);
  },

  displayMailBody: function (messageBody) {
    var t = Tabs.Rpt;
    var popMsg = null;
    t.popMsg = new pbPopup('pbMailBody', 0, 0, 670, 600, true, function() {clearTimeout (1000);});
    t.popMsg.centerMe (mainPop.getMainDiv());
    var m = '<DIV style="max-height:565px; height:565px; overflow-y:scroll">';
    m+= messageBody + '</div>';
    t.popMsg.getMainDiv().innerHTML = m;
    t.popMsg.getTopDiv().innerHTML = '<DIV align=center><B>Message</B></DIV>';
    t.popMsg.show(true);
  },

  DisplayRpt: function (){
    var t = Tabs.Rpt;
    var results = document.getElementById("idRptResultsDiv");
    if(!t.data.length) {
      results.innerHTML = '<center>None found</center>';
      return;
    }
    var myAllianceId = parseInt(getMyAlliance()[0]);
    reportsSearched = t.data.length;
    reportsFound = 0;
    t.content = '';
    for (var i=0; i<reportsSearched;i++) {
      var reportId = t.data[i].reportId;
      var rpt = t.report[reportId];
      if ((rpt.side0Name=='undefined') && (rpt.marchName != 'Desertion'))
        continue;
      if ((((myAllianceId == parseInt(rpt.side1AllianceId) && Options.arAttacker != 'Them')
        || (myAllianceId != parseInt(rpt.side1AllianceId) && Options.arAttacker != 'Us')
        || Options.arAttacker == 'Both')
        && ((myAllianceId == parseInt(rpt.side0AllianceId) && Options.arTarget != 'Them')
        || (myAllianceId != parseInt(rpt.side0AllianceId) && Options.arTarget != 'Us')
        || Options.arTarget == 'Both')
        && ((Options.arAttack && (rpt.marchName == 'Attack' || rpt.marchName == 'Defend'))
        || (Options.arScout && (rpt.marchName == 'Scout' || rpt.marchName == 'Anti-Scout'))
        || (Options.arReinforce && rpt.marchName == 'Reinforce')
        || (Options.arTransport && rpt.marchName == 'Transport')))
        || (rpt.marchName == 'Desertion')) {
        if (((t.what == ''
          || (rpt.side1Name.search(t.what, "i") != -1)
          || (rpt.side1AllianceName.search(t.what, "i") != -1)
          || (rpt.side0Name.search(t.what, "i") != -1)
          || (rpt.side0AllianceName.search(t.what, "i") != -1)
          || (rpt.side0TileTypeText.search(t.what, "i") != -1))
          && (t.whatNot == ''
          || ((rpt.side1Name.search(t.whatNot, "i") == -1)
          && (rpt.side1AllianceName.search(t.whatNot, "i") == -1)
          && (rpt.side0Name.search(t.whatNot, "i") == -1)
          && (rpt.side0AllianceName.search(t.whatNot, "i") == -1)
          && (rpt.side0TileTypeText.search(t.whatNot, "i") == -1))))
          || (rpt.marchName == 'Desertion')) {
          reportsFound++;
          if (reportsFound == 1) {
            if (Options.enableReportNumber)
              t.content += '<center><table><thead><th>P</th><th>Date</th><th>Report</th><th>Attacker</th><th>From</th>';
            else
              t.content += '<center><table><thead><th>P</th><th>Date</th><th>Attacker</th><th>From</th>';
            if (Options.arAttacker != 'Us')
              t.content += '<th>Alliance</th>';
            t.content += '<th>Action</th><th>Target</th><th>Type</th><th>At</th>';
            if (Options.arTarget != 'Us')
              t.content += '<th>Alliance</th>';
            t.content += '<th>Dist</th><th>Nearest</th></thead><tbody>';
          }
          var closestDist=999999;
          var closestLoc=null;
          var closestNum=1;
          for (var c=0; c<Cities.numCities; c++){
            var city = Cities.cities[c];
            city.x +','+ city.y
            var dist=distance(city.x,city.y,rpt.side0XCoord,rpt.side0YCoord);
            if(dist<closestDist) {
              closestDist=dist;
              closestLoc=city.x +','+ city.y;
              closestNum=c+1;
            }
          }
          if (rpt.marchName == 'Anti-Scout' || rpt.marchName == 'Defend')
           style=' style="background-color:#EF9999;"';
          else if (rpt.marchName == 'Reinforce')
           style=' style="background-color:#99EF99;"';
          else
           style="";
          t.content += '<tr><td align=right '+style+'>'+rpt.page+'</td><td '+style+'>'+formatUnixTime(rpt.reportUnixTime,'24hour')+'</td>';
          if (Options.enableReportNumber)
            t.content += '<td '+style+'>' + reportId + '</td>';
          if (rpt.marchName == 'Desertion') {
            t.content += '<td '+style+'></td><td '+style+'></td>';
            if (Options.arAttacker != 'Us')
              t.content += '<td '+style+'></td>';
            t.content += '<td '+style+'>'+rpt.marchName+'</td><td '+style+'></td><td '+style+'></td><td '+style+'></td>';
            if (Options.arAttacker != 'Us')
              t.content += '<td '+style+'></td>';
            t.content += '<td '+style+'></td><td '+style+'></td>';
            } else {
            t.content += '<td '+style+'>'+rpt.side1Name+'</td><td align=center '+style+'><A onclick="pbGotoMap('+ rpt.side1XCoord +','+ rpt.side1YCoord +')">'+ rpt.side1XCoord +','+ rpt.side1YCoord +'</a></td>';
            if (Options.arAttacker != 'Us')
              t.content += '<td '+style+'>'+rpt.side1AllianceName+'</td>';
            t.content += '<td '+style+'><A><SPAN onclick="ptChatReportClicked('+ reportId+',0,999)">'+rpt.marchName+'</span></a></td>';
            t.content += '<td '+style+'>'+rpt.side0Name+'</td><td>'+rpt.side0TileTypeLevel+'</td>';
            t.content += '<td align=center '+style+'><A onclick="pbGotoMap('+ rpt.side0XCoord +','+ rpt.side0YCoord +')">'+ rpt.side0XCoord +','+ rpt.side0YCoord +'</a></td>';
            if (Options.arTarget != 'Us')
              t.content += '<td '+style+'>'+rpt.side0AllianceName+'</td>';
            t.content += '<td align=right '+style+'>'+Math.floor(closestDist)+'</td><td align=center '+style+'><A onclick=\"ptGotoCity(' + closestNum + ')\">' + closestLoc + '</a></td></tr>';
          }
        }
      }
    }
    if (reportsFound > 1)
      t.content += '</tbody></table></center>';
    if (reportsFound == 0 && reportsSearched > 0)
      t.content = '<center>None found</center>';
    results.innerHTML = t.content;
    document.getElementById("idRptSearched").innerHTML = '&nbsp;Searched: ' + reportsSearched;
    document.getElementById("idRptFound").innerHTML = 'Found: ' + reportsFound;
  },

  getReportBody: function(reportId){
    var t = Tabs.Rpt;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    //params.pf=0;
    params.rid=reportId;
    params.side=t.report[reportId].sideId;
    if (params.side > -1) {
      new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/fetchReport.php" + unsafeWindow.g_ajaxsuffix, {
        method: "post",
        parameters: params,
        onSuccess: function (rslt) {
          t.displayReportBody(rslt,reportId);
        },
        onFailure: function (rslt) {},
      }, false);
    } else {
      unsafeWindow.alert ('Could not determine which side of the report to view - please send details to the developer');
    }
  },

  displayReportBody: function (rslt, reportId) {
    var t = Tabs.Rpt;
    var popReport = null;
    var rpt = t.report[reportId];
    var m = '';
    var unitImg = [];
    for (var i=1;i<13;i++)
      unitImg[i] = '<img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+i+'_30.png></TD><TD>' + unsafeWindow.unitcost['unt'+i][0];
    unitImg[53] = '<img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_53_30.png></TD><TD>Crossbows';
    unitImg[55] = '<img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_55_30.png></TD><TD>Trebuchet';
    unitImg[60] = '<img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_60_30.png></TD><TD>Trap';
    unitImg[61] = '<img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_61_30.png></TD><TD>Caltrops';
    unitImg[62] = '<img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_62_30.png></TD><TD>Spiked Barrier';
    goldImg = '<img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/gold_30.png></TD><TD>Gold';
    foodImg = '<img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/food_30.png></TD><TD>Food';
    woodImg = '<img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/wood_30.png></TD><TD>Wood';
    stoneImg = '<img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/stone_30.png></TD><TD>Stone';
    oreImg = '<img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/iron_30.png></TD><TD>Ore';

    function buildHeader () {
      var h='<TABLE class=ptTab width=100%>';
      h+='<TR valign=top><TD align=left width=10%><B>';
      if (rpt.marchName == 'Anti-Scout' || rpt.marchName == 'Scout')
        h+=rpt.marchName+'ing at';
      else if (rpt.marchName == 'Attack' || rpt.marchName == 'Defend')
        h+='Battle at ';
      else if (rpt.marchName == 'Reinforce' || rpt.marchName == 'Transport')
        h+=rpt.marchName+' from<BR />'+rpt.marchName+' to</B>';

      if (rpt.side0TileTypeText == 'Barb')
        h+=' Barbarian Camp Level ' + rpt.side0TileLevel;
      else if (rpt.side0TileTypeText != 'City')
        h+=' '+rpt.side0TileTypeText+' Level '+ rpt.side0TileLevel+' ';
      h+='</B></TD>';

      if (rpt.marchName == 'Reinforce' || rpt.marchName == 'Transport') {
        h+='<TD align=left width=1%>';
        if (Seed.player.name != rpt.side1Name)
          h+=rpt.side1Name;
        if (Seed.player.name != rpt.side0Name)
          h+='<BR />'+rpt.side0Name;
        h+='</TD>';
      }
      h+='<TD align=left width=5%>';

      if (rpt.marchName == 'Reinforce' || rpt.marchName == 'Transport')
        h+='(<A onclick="pbGotoMap('+ rpt.side1XCoord +','+ rpt.side1YCoord +')">'+ rpt.side1XCoord +','+ rpt.side1YCoord +'</a>)<BR />';
      h+='(<A onclick="pbGotoMap('+ rpt.side0XCoord +','+ rpt.side0YCoord +')">'+ rpt.side0XCoord +','+ rpt.side0YCoord +'</a>)</TD>';

      if (rpt.side0TileTypeText != 'City' && rpt.side0TileTypeText != 'Barb' && rpt.marchName == 'Attack') {
        if (rslt['conquered']==1)
          h+='<TD><FONT color="#CC0000"><B>Conquered</B></font></td>';
        else if (rslt['conquered']==0)
          h+='<TD><FONT color="#66CC33"><B>Secured</B></font></td>';
      } else if (rpt.marchName == 'Reinforce' || rpt.marchName == 'Transport') {
        h+='<TD align=left width=5%>'+rpt.side1CityName+'<BR />';
        if (rpt.side0CityName != '')
          h+=rpt.side0CityName+'</TD>';
        else
          h+=rpt.side0TileTypeText+' Level '+ rpt.side0TileLevel+'</TD>';
      }

      h+='<TD align=right>' + formatUnixTime(rpt.reportUnixTime,'24hour') + '<BR />Report No: ' + reportId + '</TD></TR></TABLE>';
      return h;
    }

    function handleunts () { // Troops sent to Reinforce or troops found on a Scout
      var hunts = '', th = '', tc = '', tf = '';
      if (rslt['unts']) {
        if (rpt.marchName == 'Reinforce')
          th='<TABLE class=ptTab><TR><TH colspan=3 align=left>Troops Reinforced</TH></TR>';
        else if (rslt['unts'])
          th='<TABLE class=ptTab><TR><TH colspan=3 align=left>Troops Found</TH></TR>';
        for (var i=1;i<13;i++)
          if (rslt['unts']['u'+i])
            tc+='<TR><TD>' + unitImg[i] + '</TD><TD align=right>'+addCommas(rslt['unts']['u'+i])+'</TD></TR>';
        tf='</TABLE>';
      }
      if (tc != '')
        hunts = th + tc + tf;
      return hunts;
    }

    function handlersc () { // Resources brought with reinforcements or found on a Scout
      var hrsc = '', th = '', tc = '', tf = '';
      if (rslt['rsc']) {
        if (rslt['rsc']['r1'] > 0 || rslt['rsc']['r2'] > 0 || rslt['rsc']['r3'] > 0 || rslt['rsc']['r4'] > 0) {
          if (rpt.marchName == 'Reinforce')
            th='<TABLE class=ptTab><TR><TH colspan=3 align=left>Goodies Brought</TH></TR>';
          else {
            th='<TABLE class=ptTab><TR><TH colspan=3 align=left>Goodies Found</TH></TR>';
            if (rslt['gld'] > 0)
              tc+='<TR><TD>'+goldImg+'</TD><TD align=right>'+addCommasInt(rslt['gld'])+'</TD></TR>';
          }
          if (rslt['rsc']['r1'] > 0)
            tc+='<TR><TD>'+foodImg+'</TD><TD align=right>'+addCommasInt(rslt['rsc']['r1'])+'</TD></TR>';
          if (rslt['rsc']['r2'] > 0)
            tc+='<TR><TD>'+woodImg+'</TD><TD align=right>'+addCommasInt(rslt['rsc']['r2'])+'</TD></TR>';
          if (rslt['rsc']['r3'] > 0)
            tc+='<TR><TD>'+stoneImg+'</TD><TD align=right>'+addCommasInt(rslt['rsc']['r3'])+'</TD></TR>';
          if (rslt['rsc']['r4'] > 0)
            tc+='<TR><TD>'+oreImg+'</TD><TD align=right>'+addCommasInt(rslt['rsc']['r4'])+'</TD></TR>';
          tf='</TABLE>';
        }
      }
      if (tc != '')
        hrsc = th + tc + tf;
      return hrsc;
    }

    function handlefrt () { // Fortifications found on a Scout
      var hfrt = '', th = '', tc = '', tf = '';
      if (rslt['frt']) {
        if (rslt['frt']) {
          th='<TABLE class=ptTab><TR><TH colspan=3 align=left>Defenses Found</TH></TR>';
          if (rslt['frt']['f53'])
            tc+='<TR><TD>' + unitImg[53] + '</TD><TD align=right>'+addCommas(rslt['frt']['f53'])+'</TD></TR>';
          if (rslt['frt']['f55'])
            tc+='<TR><TD>' + unitImg[55] + '</TD><TD align=right>'+addCommas(rslt['frt']['f55'])+'</TD></TR>';
          if (rslt['frt']['f60'])
            tc+='<TR><TD>' + unitImg[60] + '</TD><TD align=right>'+addCommas(rslt['frt']['f60'])+'</TD></TR>';
          if (rslt['frt']['f61'])
            tc+='<TR><TD>' + unitImg[61] + '</TD><TD align=right>'+addCommas(rslt['frt']['f61'])+'</TD></TR>';
          if (rslt['frt']['f62'])
            tc+='<TR><TD>' + unitImg[62] + '</TD><TD align=right>'+addCommas(rslt['frt']['f62'])+'</TD></TR>';
          tf='</TABLE>';
        }
      }
      if (tc != '')
        hfrt = th + tc + tf;
      return hfrt;
    }

    function handleblds (bType) {
      if(rslt['blds']){
      var blds = rslt['blds']['b'+bType]; b = '<TR><TD>'; arField = [], firstbld = true;
      if (bType == 1)
        b+='Farm';
      else if (bType == 2)
        b+='Sawmill';
      else if (bType == 3)
        b+='Quarry';
      else if (bType == 4)
        b+='Mine';
      b+='</TD><TD>';
      for (var i=1; i<12; i++)
        arField[i]=0;
      for (var i=0; i < blds.length; i++)
        arField[blds[i]]++
      for (var i=11; i>0; i--) {
        if (arField[i] > 0) {
          if (firstbld)
            firstbld = false;
          else
            b+=', ';
          if (arField[i] > 1)
            b+=arField[i] + ' x ';
          b+=' ' + i;
        }
      }
      b+='</TD></TR>';
      return b;
      }
    }

    if (rpt.marchName == 'Reinforce') {
      t.popReport = new pbPopup('pbShowRein', 0, 0, 525, 340, true, function() {clearTimeout (1000);});
      m+= '<DIV style="height:285px">';
    } else if (rpt.marchName == 'Transport') {
      t.popReport = new pbPopup('pbShowTrans', 0, 0, 525, 240, true, function() {clearTimeout (1000);});
      m+= '<DIV style="height:185px">';
    } else if (rpt.marchName == 'Scout' && rslt['winner']==1 && rpt.sideId==1){
      t.popReport = new pbPopup('pbShowOther', 0, 0, 550, 740, true, function() {clearTimeout (1000);});
      m+= '<DIV style="max-height:705px; height:705px; overflow-y:scroll">';
    } else {
      t.popReport = new pbPopup('pbShowOther', 0, 0, 550, 680, true, function() {clearTimeout (1000);});
      m+= '<DIV style="max-height:645px; height:645px; overflow-y:scroll">';
    }
    t.popReport.centerMe (mainPop.getMainDiv());

    m+=buildHeader();

    if (rpt.marchName == 'Transport') { // Transport
      m+='<TABLE class=ptTab>'; // Only transports have these in rslt, so handle them here
      if (parseInt(rslt['gold']) > 0)
        m+='<TR><TD>'+goldImg+'</TD><TD align=right>'+addCommas(rslt['gold'])+'</TD></TR>';
      if (parseInt(rslt['resource1']) > 0)
        m+='<TR><TD>'+foodImg+'</TD><TD align=right>'+addCommas(rslt['resource1'])+'</TD></TR>';
      if (parseInt(rslt['resource2']) > 0)
        m+='<TR><TD>'+woodImg+'</TD><TD align=right>'+addCommas(rslt['resource2'])+'</TD></TR>';
      if (parseInt(rslt['resource3']) > 0)
        m+='<TR><TD>'+stoneImg+'</TD><TD align=right>'+addCommas(rslt['resource3'])+'</TD></TR>';
      if (parseInt(rslt['resource4']) > 0)
        m+='<TR><TD>'+oreImg+'</TD><TD align=right>'+addCommas(rslt['resource4'])+'</TD></TR>';
      m+='</TABLE>';
    }

    m+='<TABLE class=ptTab>';
    if ((rslt['winner']==1 && rpt.sideId==0) || (rslt['winner']==0 && rpt.sideId==1)) {
      if (rpt.marchName == 'Scout')
        m+='<TR><TD><FONT color="#CC0000"><B>Scouting Failed</B></font></TD></TR>';
      else
        m+='<TR><TD><FONT color="#CC0000"><B>You were defeated</B></font></TD></TR>';
    }
    if (rslt['winner']==0 && rpt.sideId==0)
      m+='<TR><TD><FONT color="#66CC33"><B>You defended successfully!</B></font></TD></TR>';
    if (rslt['winner']==1 && rpt.sideId==1) {
      if (rpt.marchName == 'Scout')
        m+='<TR><TD><FONT color="#66CC33"><B>Scouting Report</B></font></TD></TR>';
      else
        m+='<TR><TD><FONT color="#66CC33"><B>You were victorious!</B></font></TD></TR>';
    }

    if (rslt['wall']) {
      if (rslt['wall'] == 100)
        m+='<TR><TD>Attackers breached the walls.</TD></TR>';
      else
        m+='<TR><TD>Attackers did not breach the walls. The walls are '+rslt['wall']+'% damaged</TD></TR>';
    }
    m+= '</TABLE><BR />';

    if (rslt['loot']) {
      m+='<TABLE class=ptTab>';
      if (rslt['loot'][0] > 0)
        m+='<TR><TD>'+goldImg+'</TD><TD align=right>'+addCommas(rslt['loot'][0])+'</TD></TR>';
      if (rslt['loot'][1] > 0)
        m+='<TR><TD>'+foodImg+'</TD><TD align=right>'+addCommas(rslt['loot'][1])+'</TD></TR>';
      if (rslt['loot'][2] > 0)
        m+='<TR><TD>'+woodImg+'</TD><TD align=right>'+addCommas(rslt['loot'][2])+'</TD></TR>';
      if (rslt['loot'][3] > 0)
        m+='<TR><TD>'+stoneImg+'</TD><TD align=right>'+addCommas(rslt['loot'][3])+'</TD></TR>';
      if (rslt['loot'][4] > 0)
        m+='<TR><TD>'+oreImg+'</TD><TD align=right>'+addCommas(rslt['loot'][4])+'</TD></TR>';
      if (rslt['loot'][5]) {
        for (var crest=1101; crest < 1116; crest++) {
          if (rslt['loot'][5][crest] == 1)
            m+='<TR><TD><img width=30 src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/70/' + crest + '.png></TD><TD colspan=2>' + crestname[crest] + '</TD></TR>';
        }
      }
      m+='</TABLE><BR />';
    }

    if (rpt.marchName == 'Reinforce') {
      m+=handleunts();
      m+=handlersc();
    }

    if (rpt.marchName == 'Scout' && rslt['winner']==1) {
      m+='<TABLE class=ptTab width=100%><TR><TD width=50% align=left valign=top>';
      m+=handleunts();
      m+=handlefrt();
      m+=handlersc();
      m+='</TD><TD width=50% align=left valign=top>';
      m+='<TABLE class=ptTab width=100%>';
      if (rslt['lstlgn']) {
        if (!rslt['lstlgn'])
          m+='<TR><TD>Last Login: Not recorded</TD></TR>';
        else
          m+='<TR><TD>Last Login: ' + formatUnixTime(rslt['lstlgn']) + '</TD></TR>';
      }
      m+='<TR><TD>Marshall Combat: ';
      if (rslt['knt'])
        m+=rslt['knt']['cbt'];
      else
        m+='None';
      m+='</TD></TR>';
      if (rslt['pop'])
        m+='<TR><TD>Population: ' + addCommas(rslt['pop']) + '</TD></TR>';
      if (rslt['hap'])
        m+='<TR><TD>Happiness: ' + addCommas(rslt['hap']) + '</TD></TR></TABLE>';
      if (rslt['blds']['b1'] || rslt['blds']['b2'] || rslt['blds']['b3'] || rslt['blds']['b4']) {
        m+='<TABLE class=ptTab><TR><TH colspan=2 align=left>Fields</TH></TR>';
        for (var i=1; i<5; i++)
          if (rslt['blds']['b'+i])
            m+=handleblds(i);
        m+='</TABLE>';
      }
      if (rslt['tch']) {
        m+='<TABLE class=ptTab><TR><TH colspan=2 align=left>Research</TH></TR>';
        for (var tl in rslt.tch)
          tid = /[0-9]/.exec(tl);
          m+='</TD></TR><TR><TD>'+unsafeWindow.techcost['tch'+tid[0]][0]+'</TD><TD align=right>' + rslt.tch[tl] + '</TD></TR>';
        m+='</TABLE>';
      }
      m+='</TD></TR></TABLE>';
    }

    if (rslt['fght']){ // not Reinforce or Transport, so we have a table with 2 columns: 1 for Attackers, 1 for Defenders
      m+='<TABLE class=ptTab width=100%><TR><TD width=50% align=left valign=top>';
      m+='<TABLE class=ptTab width=100%>';
      m+='<TR><TD colspan=4><B>Attackers</B> ('+rpt.side1Name+')';
      if (rslt['winner']==1)
        m+='<FONT color="#CC0000"><B> Winner</B></FONT>';
      m+='</TD></TR>';
      if (rpt.marchName == 'Attack' || rpt.marchName == 'Defend')
        m+='<TR><TD colspan=4>Knight Combat Skill: ' + rslt['s1KCombatLv'] + '</TD></TR>';
      m+='<TR><TD colspan=4>Attack Boosted: ' + 100*rslt['s1atkBoost'] + '%</TD></TR>';
      m+='<TR><TD colspan=4>Defense Boosted: ' + 100*rslt['s1defBoost'] + '%</TD></TR>';
      m+='<TR><TD colspan=4>(<A onclick="pbGotoMap('+ rpt.side1XCoord +','+ rpt.side1YCoord +')">'+ rpt.side1XCoord +','+ rpt.side1YCoord +'</a>) ' + rpt.side1CityName + '</TD></TR>';
      if (rslt['fght']["s1"] != undefined) {
        m+='<TR><TH></TH><TH align=left>Troops</TH><TH align=right>Fought</TH><TH align=right>Survived</TH></TR>';
        for (var i=1;i<15;i++) {
          if (rslt['fght']["s1"]['u'+i] != undefined) {
            if (rslt['fght']["s1"]['u'+i][0] > rslt['fght']["s1"]['u'+i][1]) {
              m+='<TR><TD>' + unitImg[i] + '</td>';
              m+='<TD align=right>'+addCommas(rslt['fght']["s1"]['u'+i][0])+'</td>';
              m+='<TD align=right><FONT color="#CC0000">'+addCommas(rslt['fght']["s1"]['u'+i][1])+'</FONT></td></tr>';
            } else {
              m+='<TR><TD>' + unitImg[i] + '</td>';
              m+='<TD align=right>'+addCommas(rslt['fght']["s1"]['u'+i][0])+'</td>';
              m+='<TD align=right>'+addCommas(rslt['fght']["s1"]['u'+i][1])+'</td></tr>';
            }
          }
        }
      }
      m+='</TABLE></TD><TD width=50% align=right valign=top>';
      m+='<TABLE class=ptTab width=100%>';
      m+='<TR><TD colspan=4><B>Defenders</B> ('+rpt.side0Name+')';
      if (rslt['winner']==0)
        m+='<FONT color="#CC0000"><B> Winner</B></FONT>';
      m+='</TD></TR>';
      if (rpt.marchName == 'Attack' || rpt.marchName == 'Defend')
        m+='<TR><TD colspan=4>Knight Combat Skill: ' + rslt['s0KCombatLv'] + '</TD></TR>';
      if (rslt['s0atkBoost'] !== undefined)
        m+='<TR><TD colspan=4>Attack Boosted: ' + 100*rslt['s0atkBoost'] + '%</TD></TR>';
      else
        m+='<TR><TD colspan=4>&nbsp;</TD></TR>';
      if (rslt['s0defBoost'] !== undefined)
        m+='<TR><TD colspan=4>Defense Boosted: ' + rslt['s0defBoost'] + '%</TD></TR>';
      else
        m+='<TR><TD colspan=4>&nbsp;</TD></TR>';
      m+='<TR><TD colspan=4>Rounds: ' + rslt['rnds'] + '</TD></TR>';
      if (rslt['fght']["s0"] != undefined) {
        m+='<TR><TH></TH><TH align=left>Troops</TH><TH align=right>Fought</TH><TH align=right>Survived</TH></TR>';
        for (var i=1;i<15;i++) {
          if (rslt['fght']["s0"]['u'+i] != undefined) {
            if (rslt['fght']["s0"]['u'+i][0] > rslt['fght']["s0"]['u'+i][1]) {
              m+='<TR><TD>' + unitImg[i] + '</td>';
              m+='<TD align=right>'+addCommas(rslt['fght']["s0"]['u'+i][0])+'</td>';
              m+='<TD align=right><FONT color="#CC0000">'+addCommas(rslt['fght']["s0"]['u'+i][1])+'</FONT></td></tr>';
            } else {
              m+='<TR><TD>' + unitImg[i] + '</td>';
              m+='<TD align=right>'+addCommas(rslt['fght']["s0"]['u'+i][0])+'</td>';
              m+='<TD align=right>'+addCommas(rslt['fght']["s0"]['u'+i][1])+'</td></tr>';
            }
          }
        }
        for (var i=53;i<=55;i++) {
          if (rslt['fght']["s0"]['f'+i] != undefined) {
            if (rslt['fght']["s0"]['f'+i][0] > rslt['fght']["s0"]['f'+i][1]) {
              m+='<TR><TD>' + unitImg[i] + '</td>';
              m+='<TD align=right>'+addCommas(rslt['fght']["s0"]['f'+i][0])+'</td>';
              m+='<TD align=right><FONT color="#CC0000">'+addCommas(rslt['fght']["s0"]['f'+i][1])+'</font></td></tr>';
            } else {
              m+='<TR><TD>' + unitImg[i] + '</td>';
              m+='<TD align=right>'+addCommas(rslt['fght']["s0"]['f'+i][0])+'</td>';
              m+='<TD align=right>'+addCommas(rslt['fght']["s0"]['f'+i][1])+'</td></tr>';
            }
          }
        }
        for (var i=60;i<=63;i++) {
          if (rslt['fght']["s0"]['f'+i] != undefined) {
            if (rslt['fght']["s0"]['f'+i][0] > rslt['fght']["s0"]['f'+i][1]) {
              m+='<TR><TD>' + unitImg[i] + '</td>';
              m+='<TD align=right>'+addCommas(rslt['fght']["s0"]['f'+i][0])+'</td>';
              m+='<TD align=right><FONT color="#CC0000">'+addCommas(rslt['fght']["s0"]['f'+i][1])+'</font></td></tr>';
            } else {
              m+='<TR><TD>' + unitImg[i] + '</td>';
              m+='<TD align=right>'+addCommas(rslt['fght']["s0"]['f'+i][0])+'</td>';
              m+='<TD align=right>'+addCommas(rslt['fght']["s0"]['f'+i][1])+'</td></tr>';
            }
          }
        }
      } else
        m+='<TR><TD>No Troops Defended</TD></TR>';
      m+='</TABLE></TD></TR></TABLE>';
    }

    m+='</DIV>';
    t.popReport.getMainDiv().innerHTML = m;
    t.popReport.getTopDiv().innerHTML = '<DIV align=center><B>'+rpt.marchName+' Report</B></DIV>';
    t.popReport.show(true);
  },

  show: function (){
  },

  hide: function (){
  },
};



/*********************************** Info tab ***********************************/
Tabs.Info = {
	tabOrder : 10,
	tabLabel : 'Info',
	type: 'Tools',
	myDiv : null,
	types: ["Life","Attack","Defense","Speed","Range","Load"],
	sacrifice: {1:false,2:false,3:false,4:false,5:false,6:false,7:false,8:false,9:false,10:false,11:false,12:false,13:false,14:false,15:false},
	base: {0:0,1:0,2:0,3:0,4:0,5:0},

  	init : function (div){
	    var t = Tabs.Info;
	    t.cont=div;
	    var m = '<DIV style="max-height:700px;overflow-y:auto"><DIV class=pbStat>TROOP STATS</div>'; 
	    m+= '<SPAN>This tab shows stats boosted <b>with</b> Research,Boosts,Knight,Guarian and TR <b>exept</b>: Bonus to PvP on Defense/Offense.</span>';   
	    m+='<TABLE class=pbTab><TR style="vertical-align:top"><TD style="width:350px"><DIV id=InfoLeft></div><TD width=50px>&nbsp</td></td><TD style="width:350px;text-align:center"><DIV id=InfoRight></div></td><TD width=50px>&nbsp</td></td><TD style="width:350px;text-align:center"><DIV id=InfoOptions></div></td></tr></table>';
	    m+='<DIV class=pbStat>THRONE ROOM EFFECTS INFO  -- <INPUT id=I_equipped type=checkbox unchecked=true>&nbspShow All Stats</div><BR><DIV id=InfoTRfx></div>';
	    t.cont.innerHTML = m;
	    document.getElementById('I_equipped').addEventListener("change", function () {
	    	if (document.getElementById('I_equipped').checked) t.PaintAllTRfx();
	    	 else t.PaintEquippedTRfx();
	    }, false);
	    var now = unixTime();
	   	t.PaintBoosts();
	    t.InitInfo();
	    t.PaintEquippedTRfx();
  	},
  	InitInfo:function(){
  		var t = Tabs.Info;
  		t.PaintKnights();
  		document.getElementById('O_City').innerHTML = '<B>' + t.Info.city.name + '</b>';
  		t.PaintGuardian();
  	},
  	PaintBoosts:function(){
  		var t = Tabs.Info;
  		var now = unixTime();
  		var boost_atk = ((Seed.playerEffects.atkExpire>now)?0.20:0) + ((Seed.playerEffects.atk2Expire>now)?0.5:0);
  		var boost_def = ((Seed.playerEffects.defExpire>now)?0.20:0) + ((Seed.playerEffects.def2Expire >now)?0.5:0);
  		var boost_ld = ((Seed.playerEffects.loadExpire>now)?0.25:0);
  		var items_atk=[261,262,280];
	   	var items_def=[271,272,281];
	   	var items_ld=[276,277,278];
	   	var tech={8:"Attack",9:"Defense",12:"Speed",13:"Range",10:"Load",15:"Life"};
  		var tech2={5:"Attack",6:"Range"};
		boosts = '<TABLE class=pbTab width=80%>'
		boosts += '<TR><TD colspan=5 style="text-align:center"><DIV class=pbStat id=O_City></div></td></tr>';
		boosts += '<TR><TD colspan=5 style="text-align:center"><SPAN id="InfoCity"></span></td></tr>';	
		boosts += '<TR><TD colspan=5 style="text-align:center"><SELECT id=I_Knight type=list></select></td></tr>';
  		boosts +='<TR><TD><B>Item</b></td><TD><B>Lvl</b></td><TD colspan=2><B>Boost</b></td>'
  		boosts += '<TR><TD>';
  		var boost_atk_time = "";
  		var boost_def_time = "";
  		var boost_ld_time = "";
  		if (Seed.playerEffects.atkExpire>now) boost_atk_time = "&nbsp&nbsp Untill: "+FullDateTime(Seed.playerEffects.atkExpire);
  		if (Seed.playerEffects.atk2Expire>now) boost_atk_time = "&nbsp&nbsp Untill: "+FullDateTime(Seed.playerEffects.atk2Expire);
  		if (Seed.playerEffects.defExpire>now) boost_def_time = "&nbsp&nbsp Untill: "+FullDateTime(Seed.playerEffects.defExpire);
  		if (Seed.playerEffects.def2Expire>now) boost_def_time = "&nbsp&nbsp Untill: "+FullDateTime(Seed.playerEffects.def2Expire);
  		if (Seed.playerEffects.loadExpire>now) boost_ld_time = "&nbsp&nbsp Untill: "+FullDateTime(Seed.playerEffects.loadExpire);
  		if (Seed.playerEffects.load2Expire>now) boost_ld_time = "&nbsp&nbsp Untill: "+FullDateTime(Seed.playerEffects.load2Expire);
  		for (var i=0;i<items_atk.length;i++) boosts += '<a class=hasTooltip><img width=25 src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/70/'+items_atk[i]+'.jpg><SPAN>'+unsafeWindow.itemlist['i'+items_atk[i]].name+': '+unsafeWindow.itemlist['i'+items_atk[i]].description+'</span></a> ';
  		boosts += '</td><TD>--</td><TD style="text-align:right">'+(boost_atk*100)+'%</td><TD>&nbsp</td><TD style="text-align:left">Attack</td>&nbsp<TD>'+boost_atk_time+'</td></tr><TR><TD>';
		for (var i=0;i<items_def.length;i++) boosts += '<a class=hasTooltip><img width=25 src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/70/'+items_def[i]+'.jpg><SPAN>'+unsafeWindow.itemlist['i'+items_def[i]].name+': '+unsafeWindow.itemlist['i'+items_def[i]].description+'</span></a> ';
		boosts += '</td><TD>--</td><TD style="text-align:right">'+(boost_def*100)+'%</td><TD>&nbsp</td><TD style="text-align:left">Defense</td>&nbsp<TD>'+boost_def_time+'</td></tr><TR><TD>';
		for (var i=0;i<items_ld.length;i++) boosts += '<a class=hasTooltip><img width=25 src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/70/'+items_ld[i]+'.jpg><SPAN>'+unsafeWindow.itemlist['i'+items_ld[i]].name+': '+unsafeWindow.itemlist['i'+items_ld[i]].description+'</span></a> ';
		boosts += '</td><TD>--</td><TD style="text-align:right">'+(boost_ld*100)+'%</td><TD>&nbsp</td><TD style="text-align:left">Load</td>&nbsp<TD>'+boost_ld_time+'</td></tr>';
	   	for (var i in tech) {
	   		boosts += '<TR><TD ><a class=hasTooltip><img width=25 src=http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/tech/'+i+'_s33.png><SPAN>'+unsafeWindow.techcost['tch'+i][0]+'<br />'+unsafeWindow.techcost['tch'+i][10]+ '</span></a></td><TD>'+Seed.tech['tch'+i]+'</td>'
	   		if (i==10) boosts += '<TD style="text-align:right">'+(10 * parseInt(Seed.tech['tch'+i]))+'% </td><TD>&nbsp</td><TD style="text-align:left">'+tech[i]+'</td>';
	   		 else boosts += '<TD style="text-align:right">'+(5 * parseInt(Seed.tech['tch'+i]))+'% </td><TD>&nbsp</td><TD style="text-align:left">'+tech[i]+'</td>';
	   	}
	   	for (var i in tech2) {
	   		boosts += '<TR><TD ><a class=hasTooltip><img width=25 src=http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/tech2/'+i+'_s33.png><SPAN>'+unsafeWindow.techcost2['tch'+i][0]+'<br />'+unsafeWindow.techcost2['tch'+i][10]+ '</span></a></td><TD>'+Seed.tech2['tch'+i]+'</td>'
	   		boosts += '<TD style="text-align:right">'+(2 * parseInt(Seed.tech2['tch'+i]))+'% </td><TD>&nbsp</td><TD style="text-align:left">'+tech2[i]+'</td>';
	   	}
	   	boosts += '<TR><TD id=Guardian_Name></td><TD id=Guardian_Level></td><TD id=Guardian_Boost style="text-align:right"></td><TD>&nbsp</td><TD id=Guardian_Boost_Name style="text-align:left"></td></tr>';
	   	document.getElementById("InfoRight").innerHTML = boosts;
	   	document.getElementById('I_Knight').addEventListener("change", function () {t.PaintInfo();}, false);
	   	t.Info = new CdispCityPicker ('InfoCitySelect', document.getElementById('InfoCity'), false, t.InitInfo, 0); 	
  	},
  	PaintInfo : function(){
  		var t = Tabs.Info; 	
  		var now = unixTime();
  		var sacrificeLogo = 'data:image/png;base64,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';
  		document.getElementById('InfoLeft').innerHTML = "";
 		var knight = (document.getElementById('I_Knight').value)/200;
 		var boost_atk = ((Seed.playerEffects.atkExpire>now)?0.20:0) + ((Seed.playerEffects.atk2Expire>now)?0.5:0);
  		var boost_def = ((Seed.playerEffects.defExpire>now)?0.20:0) + ((Seed.playerEffects.def2Expire >now)?0.5:0);
  		var boost_ld = ((Seed.playerEffects.loadExpire>now)?0.25:0);
  		var tech_hp = 			(5 * (parseInt(Seed.tech['tch15'])/100)); 
	    var tech_atk = 			(5 * (parseInt(Seed.tech['tch8'])/100)); 
	    var tech_def = 			(5 * (parseInt(Seed.tech['tch9'])/100)); 
	    var tech_spd_hb = 		(5 * (parseInt(Seed.tech['tch12'])/100)); 
	    var tech_rng = 			(5 * (parseInt(Seed.tech['tch13'])/100)) + (2 * (parseInt(Seed.tech2['tch6'])/100));
	    var tech_ld = 			(10 * (parseInt(Seed.tech['tch10'])/100)); 
	    var tech_bal_ram = 		(2 * (parseInt(Seed.tech2['tch5'])/100));
		//var tech_wall_field = 	(5 * (parseInt(Seed.tech2['tch4'])/100));
		var guardian_hp=1;
		var guardian_atk=1;
		if (t.guardian_type=="wood") guardian_hp=1+(t.guardian_boost/100);
		if (t.guardian_type=="ore") guardian_atk=1+(t.guardian_boost/100);
		var Fey_boost = ((Seed.cityData.city[t.Info.city.id].isPrestigeCity&&Seed.cityData.city[t.Info.city.id].prestigeInfo.blessings.indexOf(209)>0)?1.15:1);
  		var info ='<TABLE class=pbTab><TR><TD><img src='+sacrificeLogo+'></td><TD>&nbsp</td>';
  		for (var i=0;i<t.types.length;i++) info += '<TD style="text-align:right"><B>'+ t.types[i] + '</b></td>';
  		info+='</tr>';
  		var units = 15;
    	if (unsafeWindow.unitstats.unt16) units=16;
  		for (var i=1;i<=units;i++){
  			var tr_hp = tr_atk = tr_def = tr_spd = tr_rng = tr_ld = 0;
		    for (var y in unsafeWindow.cm.thronestats.effects){
		    	if (unsafeWindow.cm.thronestats.effects[y][7] == "0" && unsafeWindow.cm.thronestats.effects[y][3] == "Combat" && unsafeWindow.cm.thronestats.effects[y][5] == "") {
		    		var troop = false;
		    		if (unsafeWindow.cm.thronestats.effects[y][6]!="") for (var z=0;z<unsafeWindow.cm.thronestats.effects[y][6].length;z++) if (parseInt(unsafeWindow.cm.thronestats.effects[y][6][z])==i) troop=true;
		    		if (unsafeWindow.cm.thronestats.effects[y][6]=="") troop= true;
		    		if (troop) switch(unsafeWindow.cm.thronestats.effects[y][2][0]){
		    			case ("Life"): 		tr_hp += 	unsafeWindow.cm.ThroneController.effectBonus(parseInt(y))/100;break;
		    			case ("Attack"): 	tr_atk += 	unsafeWindow.cm.ThroneController.effectBonus(parseInt(y))/100;break;
		    			case ("Defense"): 	tr_def += 	unsafeWindow.cm.ThroneController.effectBonus(parseInt(y))/100;break;
		    			case ("Speed"): 	tr_spd += 	unsafeWindow.cm.ThroneController.effectBonus(parseInt(y))/100;break;
		    			case ("Range"): 	tr_rng += 	unsafeWindow.cm.ThroneController.effectBonus(parseInt(y))/100;break;
		    			case ("Load"): 		tr_ld += 	unsafeWindow.cm.ThroneController.effectBonus(parseInt(y))/100;break;
		    		}
		    	}
		    }
	   		for (var b=0;b<=5;b++) t.base[b] = unsafeWindow.unitstats['unt'+i][b] + ((t.sacrifice[i])?(unsafeWindow.unitstats['unt'+i][b]*0.03):0);
	   		info+='<TR><TD><INPUT type=checkbox id="Sacr_'+i+'" '+((t.sacrifice[i])?"checked":"unchecked")+'></td>';
	   		//https://kabam1-a.akamaihd.net/silooneofcamelot/fb/e2/src/img/units/unit_16_50.jpg
	   		//if (i==16) info+='<TD><a class=hasTooltip><img  width=25px src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+i+'_50_s34.jpg?6545><SPAN>'+ t.PaintHover(i)+'</span></td>';
	   		info+='<TD><a class=hasTooltip><img  width=25px src=https://kabam1-a.akamaihd.net/silooneofcamelot/fb/e2/src/img/units/unit_'+i+'_50.jpg?6545><SPAN>'+ t.PaintHover(i)+'</span></td>';
	   		info+='<TD style="width:50px;text-align:right">'+	addCommas(Math.round((t.base[0] 	+(t.base[0]*(tech_hp+Math.min(tr_hp,2)))  )*guardian_hp ))+'</td>';
	   		info+='<TD style="width:50px;text-align:right">'+ 	addCommas(Math.round((t.base[1] 	+(t.base[1]*(tech_atk+((i>=10&&i<=11)?tech_bal_ram:0)+Math.min(tr_atk,8)+knight+2*boost_atk)))*guardian_atk*Fey_boost))   +'</td>';
	   		info+='<TD style="width:50px;text-align:right">'+	addCommas(Math.round(t.base[2] 		+(t.base[2]*(tech_def+Math.min(tr_def,40)+knight+2*boost_def) )))+'</td>';
	   		info+='<TD style="width:50px;text-align:right">'+	addCommas(Math.round(t.base[3] 		+(t.base[3]*(((i>=7&&i<=12)?tech_spd_hb:0)+Math.min(tr_spd,3)) )))+'</td>';
	   		info+='<TD style="width:50px;text-align:right">'+	addCommas(Math.round(t.base[4] 		+(t.base[4]*(((i==6||i==10||i==12)?tech_rng:0)+Math.min(tr_rng,1.5)))))+'</td>';
	   		info+='<TD style="width:50px;text-align:right">'+	addCommas(Math.round(t.base[5]		+(t.base[5]*(tech_ld+Math.min(tr_ld,5)+boost_ld))))+'</td>';
	   		info+= '</tr>';
	   	}
	   	info+='</table>';
	   	document.getElementById("InfoLeft").innerHTML = info;
	   	for (var i=1;i<=15;i++) document.getElementById('Sacr_'+i).addEventListener("click", function () {
			t.sacrifice[this.id.substr(5)]=this.checked;
			t.PaintInfo();
		}, false);
  	},
  	PaintHover: function(i){
  		var m= '<B>'+unsafeWindow.unitnamedesctranslated['unt'+i][0]+'</b><BR>';
  		m+="<TABLE class=pbTab width=100px>";
  		m+='<TR><TD style="width:50px"><img width=20px src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/food_30.png></td><TD>'+addCommas(unsafeWindow.unitcost['unt'+i][1])+' ('+unsafeWindow.unitupkeeps[i]+')</td></tr>';
  		m+='<TD><img width=20px src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/wood_30.png></td><TD>'+addCommas(unsafeWindow.unitcost['unt'+i][2])+'</td></tr>';
  		m+='<TR><TD><img width=20px src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/stone_30.png></td><TD>'+addCommas(unsafeWindow.unitcost['unt'+i][3])+'</td></tr>';
  		m+='<TD><img width=20px src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/iron_30.png></td><TD>'+addCommas(unsafeWindow.unitcost['unt'+i][4])+'</td></tr>';
  		m+='<TR><TD><img width=20px src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/population_40.png></td><TD>'+addCommas(unsafeWindow.unitcost['unt'+i][6])+'</td></tr></table>';
  		return m;
  	},
  	PaintKnights: function(){
  		var t = Tabs.Info;
       	var knt = new Array();
       	var now = unixTime();
       	for (k in Seed.knights['city' + t.Info.city.id]){
       		if (Seed.leaders['city' + t.Info.city.id]["resourcefulnessKnightId"] != Seed.knights['city' + t.Info.city.id][k]["knightId"] && Seed.leaders['city' + t.Info.city.id]["politicsKnightId"] != Seed.knights['city' + t.Info.city.id][k]["knightId"] && Seed.leaders['city' + t.Info.city.id]["combatKnightId"] != Seed.knights['city' + t.Info.city.id][k]["knightId"] && Seed.leaders['city' + t.Info.city.id]["intelligenceKnightId"] != Seed.knights['city' + t.Info.city.id][k]["knightId"]){
       			knt.push ({
       				Name:   Seed.knights['city' + t.Info.city.id][k]["knightName"],
       				Combat:	(parseInt(Seed.knights['city' + t.Info.city.id][k]["combat"])+((Seed.knights['city' + t.Info.city.id][k]["combatBoostExpireUnixtime"]>0)?(Math.floor(parseInt(Seed.knights['city' + t.Info.city.id][k]["combat"])*0.25)):0)),
       				ID:		Seed.knights['city' + t.Info.city.id][k]["knightId"],
       			});
       		}
       	}
       	knt = knt.sort(function sort(a,b) {a = a['Combat'];b = b['Combat'];return a == b ? 0 : (a > b ? -1 : 1);});
      	document.getElementById('I_Knight').options.length=0;	
       	for (k in knt){
    			if (knt[k]["Name"] !=undefined){
	    			var o = document.createElement("option");
	    			o.text = (knt[k]["Name"] + ' (' + knt[k]["Combat"] +')')
	    			o.value = knt[k]["Combat"];
	    			document.getElementById("I_Knight").options.add(o);
    			}
    	}
  	},
  	PaintAllTRfx:function(){
  		var t = Tabs.Info;
  		var info = '<TABLE class=pbTab width=90%><TD><B>Name</b></td><TD><B>FX</b></td><TD><B>Applies to</b></td><TD><B>Troops</b></td><TD><B>Side</b></td></tr>';
  		for (var i in unsafeWindow.cm.thronestats.effects){
  			var FX = unsafeWindow.cm.thronestats.effects[i];
  			info += '<TR><TD>' + FX[1] + '</td><TD>';
  			for (var y=0;y<FX[2].length;y++) info += FX[2][y] + ' ';
  			info += '</td><TD>'+ FX[5] +'</td><TD>';
  			for (var y=0;y<FX[6].length;y++) {
  				if (unsafeWindow.unitnamedesctranslated['unt'+FX[6][y]]) info += '<a class=hasTooltip><img  width=25px src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+FX[6][y]+'_50_s34.jpg?6545><SPAN>'+unsafeWindow.unitnamedesctranslated['unt'+FX[6][y]][0]+'</span></a> ';
  				else if (unsafeWindow.fortcost['frt'+FX[6][y]]) info += '<a class=hasTooltip><img  width=25px src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+FX[6][y]+'_50.jpg?6545><SPAN>'+unsafeWindow.fortcost['frt'+FX[6][y]][0]+'</span></a> ';
  				else if (FX[6][y]==19) info += '<a class=hasTooltip><img  width=25px src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/building_icons/build_walls_26.png><SPAN>Wall</span></a> ';
  				else info+= FX[6][y];
  			}		
  			info += '</td><TD>' + ((FX[7]=="0")?"You":"Them") + '</td></tr>';
  		}
  		document.getElementById('InfoTRfx').innerHTML = info + '</table><BR>';
  	},
  	PaintEquippedTRfx:function(){
  		var t = Tabs.Info;
  		var StatEffects = [];
  		var info = '<TABLE class=pbTab width=90%><TD colspan=2><B>Name</b></td><TD><B>FX</b></td><TD><B>Applies to</b></td><TD><B>Troops</b></td><TD><B>Side</b></td></tr>';
    	for (k in unsafeWindow.cm.thronestats.effects) StatEffects[k] = 0;
    	for (k in unsafeWindow.kocThroneItems){
    		 y = unsafeWindow.kocThroneItems[k];
	    	 for (i=1;i<=5;i++) {
				   id = y["effects"]["slot"+i]["id"];
				   tier = parseInt(y["effects"]["slot"+i]["tier"]);
				   level = y["level"];
				   p = unsafeWindow.cm.thronestats.tiers[id][tier];
				   Current = p.base + ((level * level + level) * p.growth * 0.5);
				   if (y.isEquipped && i<=y["quality"]) StatEffects[id] += Current
			}
		}
		for (k=1;k<StatEffects.length;k++){
			if (StatEffects[k]!=0){
				var FX = unsafeWindow.cm.thronestats.effects[k];
	  			info += '<TR><TD>'+StatEffects[k]+'%</td><TD>'+ FX[1] + '</td><TD>';
	  			for (var y=0;y<FX[2].length;y++) info += FX[2][y] + ' ';
	  			info += '</td><TD>'+ FX[5] +'</td><TD>';
	  			for (var y=0;y<FX[6].length;y++) {
	  				if (unsafeWindow.unitnamedesctranslated['unt'+FX[6][y]]) info += '<a class=hasTooltip><img  width=25px src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+FX[6][y]+'_50_s34.jpg?6545><SPAN>'+unsafeWindow.unitnamedesctranslated['unt'+FX[6][y]][0]+'</span></a> ';
	  				else if (unsafeWindow.fortcost['frt'+FX[6][y]]) info += '<a class=hasTooltip><img  width=25px src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+FX[6][y]+'_50.jpg?6545><SPAN>'+unsafeWindow.fortcost['frt'+FX[6][y]][0]+'</span></a> ';
	  				else if (FX[6][y]==19) info += '<a class=hasTooltip><img  width=25px src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/building_icons/build_walls_26.png><SPAN>Wall</span></a> ';
	  				else info+= FX[6][y];
	  			}		
	  			info += '</td><TD>' + ((FX[7]=="0")?"You":"Them") + '</td></tr>';
	  		}
		} 
		document.getElementById('InfoTRfx').innerHTML = info + '</table><BR>';
  	},
  	PaintGuardian:function(){
  		var t = Tabs.Info;
		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		
		params.ctrl = 'Guardian';
		params.action = 'buildModal';
		params.cityId = t.Info.city.id;
		params.new_level = Seed.guardian[t.Info.city.idx]["level"];
		params.type = false;

  		new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
		method: "post",
		parameters: params,
		loading: true,
		onSuccess: function (transport) {
			var rslt = eval("(" + transport.responseText + ")");
				if(rslt.ok){
					var type = rslt.guardian.type;
					var boost = parseInt(rslt.guardian.cl3.charAt(1) + rslt.guardian.cl3.charAt(2));
					var index = rslt.guardian.cl3.indexOf("%");
					var boost_type = rslt.guardian.cl3.slice(index+2,rslt.guardian.cl3.length);
					t.guardian_boost = boost;
					t.guardian_type = type;
					document.getElementById('Guardian_Name').innerHTML =  unsafeWindow.g_js_strings.commonstr[type] + ' Guardian';
					document.getElementById('Guardian_Level').innerHTML = parseInt(rslt.guardian.cl0);
					document.getElementById('Guardian_Boost').innerHTML = boost + '%';
					document.getElementById('Guardian_Boost_Name').innerHTML = boost_type;
					t.PaintInfo();
				} 
		},
		onFailure: function () {
		   return;
		},
	});

  	},
	hide : function (){},
  	show : function (){},

}





/************************* Game/GUI Enhancements ***************************/

var ChatStuff = {
  chatDivContentFunc : null,
  getChatFunc : null,
  leaders : {},
  
  init : function (){
    var t = ChatStuff;
	if(getMyAlliance()[0] > 0) t.getAllianceLeaders();
	t.chatDivContentFunc = new CalterUwFuncTools ('Chat.chatDivContent', [['return f.join("")', 'var msg = f.join("");\n msg=chatDivContent_hook(msg,d);\n return msg;']]);
    unsafeWindow.chatDivContent_hook = t.chatDivContentHook;
    unsafeWindow.chatDivContent_hook2 = t.chatDivContentHook2;
    unsafeWindow.ptChatIconClicked = t.e_iconClicked;
    unsafeWindow.ptChatReportClicked = ReportFetch;
    unsafeWindow.ptTRcompClicked = t.TRcomp;
    t.setEnable (Options.chatEnhance);
    if (Options.chatglobal) document.getElementById('mod_comm_list1').className +=' ptChatGlobal ';
    //if (Options.chatalliance) document.getElementById('mod_comm_list2').className +=' ptChatAlliance ';
  },
  
  isAvailable : function (){
    var t = ChatStuff; 
    t.chatDivContentFunc.isAvailable ();
  },
  
  setEnable : function (tf){
    var t = ChatStuff; 
    t.chatDivContentFunc.setEnable (tf);
  },

  e_iconClicked : function (name){
    var e = document.getElementById('mod_comm_input');
    name = name.replace(/Ã‚Â°Ã‚Â°/g,"'");
    e.value = '@'+ name +' ';
  },
  
  chatDivContentHook2 : function (msg){
		var div = document.createElement('div');
		div.innerHTML = msg;
		div.innerText = div.innerHTML;
		msg = div.innerHTML.toString();
		return msg.htmlSpecialCharsDecode();
  },

 chatDivContentHook : function (msg,type){

 	   unsafeWindow.pbReinforce = CoordClick;
       var t = ChatStuff; 
       var element_class = '';
       var alliance = false;
       var whisper = false;
       var fbuid = 0;
       var m = /div class=\'info\'>.*<\/div>/im.exec(msg);
       if (m == null) return msg;
       if(type != null){
		   if(type.indexOf('says to the alliance') > 0)alliance = true;
		   if(type.indexOf('whispers to you') > 0) whisper = true;
	   }
       var whisp = m[0];
    
       	do {
			msg = msg.replace('cm.formatModel.jumpTo','pbReinforce');
		} while (msg.indexOf('cm.formatModel.jumpTo')>0)

    if (whisper) {
		if (Options.chatwhisper) element_class += ' ptChatWhisper ';	
    } else { //Global & Alliance
		if (Options.chatbold) element_class += ' ptChatBold ';
	}
	var scripters = ["7552815","10681588","1747877","2865067","10153485","15182839","1550996","1617431819","9688786","8184813","9863346","11107993","9751486","5614388","424090","14845619"];
	var suid = /viewProfile\(this,([0-9]+),false/i.exec(m[0]);
	if(!suid) {
		suid = unsafeWindow.tvuid;
		fbuid = unsafeWindow.user_id;
	} else suid = suid[1];	
	if (Options.chatLeaders) if (t.leaders[suid]) element_class += ' ptChat'+t.leaders[suid];  
	if (scripters.indexOf(suid) >= 0) element_class += ' ptChatScripter'; 
	if(alliance){
	if (m[0].indexOf('My embassy has') >= 0 && Options.chatAttack) element_class = ' ptChatAttack';
	if (m[0].indexOf('My wilderness at') >= 0 && Options.chatAttack) element_class = ' ptChatAttack';
	if (m[0].indexOf('..:.')>0) element_class = ' ptChatAttack';
	if (element_class == ' ptChatAttack') {
		if (m[0].indexOf('SCOUT')>0 || m[0].indexOf('Scouting')>0 || m[0].indexOf('Scouted')>0) var url = 'https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/scouting.jpg';
		else var url = 'https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/attacking.jpg';
	 	msg += '<div style="position:absolute;background-image:url('+url+'); background-repeat:no-repeat;border-radius: 3px 3px 3px 3px;height:18px;width:18px;border:2px inset rgb(96, 0, 0);box-shadow:0px 0px 2px rgb(255, 255, 255);left:4px;top:40px;"></div>';
	}
	if (m[0].indexOf('..:.') >= 0 && Options.chatAttack) {
			var f = msg.indexOf('<div class=\'tx\'>');
			if(f >= 0) {
				msg = msg.replace(/<div class=\'tx\'>/,'<div class=\'tx\'><center><table cellpadding=1 cellspacing=0 border="1" style="border: 1px solid; border-style: none none none none;"><tr><td style="background-color:'+Colors.ChatAtt+'">')
				msg = msg.replace(/\|\|/g,'</td></tr><tr><td style="background-color:'+Colors.ChatAtt+'">');
				var a = msg.indexOf('</div>',f);
				msg = msg.slice(0,a)+'</td></tr></table></center>'+msg.slice(a);
				
			}
			msg = msg.replace(/\|/g,'<br>');
			msg = msg.replace('..:.','');
			if (Options.enableTowerAlert) {
				AudioManager.setSource(SOUND_FILES.alert);
				AudioManager.play();
				setTimeout(function(){AudioManager.stop();}, 5000);
			}
		}
		if (m[0].indexOf('.::.') >= 0 && Options.chatAttack) {
			element_class = ' ptChatRecall';
			var f = msg.indexOf('<div class=\'tx\'>');
			if(f >= 0) {
				msg = msg.replace(/<div class=\'tx\'>/,'<div class=\'tx\'><center><table cellpadding=1 cellspacing=0 border="1" style="border: 1px solid; border-style: none none none none;"><tr><td>')
				msg = msg.replace(/\|\|/g,'</td></tr><tr><td>');
				var a = msg.indexOf('</div>',f);
				msg = msg.slice(0,a)+'</td></tr></table></center>'+msg.slice(a);
				
			}
			msg = msg.replace(/\|/g,'<br>');
			msg = msg.replace('.::.','');
		}
	 }

	 if(m[0].indexOf(':::.') >= 0) {
			var f = msg.indexOf('<div class=\'tx\'>');
			if(f >= 0) {
				msg = msg.replace(/<div class=\'tx\'>/,'<div class=\'tx\'><center><table cellpadding=1 cellspacing=0 border="1" style="border: 1px solid; border-style: none none none none;"><tr><td>')
				msg = msg.replace(/\|\|/g,'</td></tr><tr><td>');
				var a = msg.indexOf('</div>',f);
				msg = msg.slice(0,a)+'</td></tr></table></center>'+msg.slice(a);
			}
			msg = msg.replace(/\|/g,'<br>');
			msg = msg.replace(':::.','');
	}
	
     msg = msg.replace ("class=\'content\'", "class='content "+ element_class +"'");
	 msg = msg.replace (/(\bReport\sNo\:\s([0-9]+))/g, '<a onclick=\'ptChatReportClicked($2,0,999)\'>$1</a>');

	 if (m[0].indexOf('TRC:')){
	 	unsafeWindow.suid = suid;
	 	msg = msg.replace (/(\bTRC:\s([0-9]+))/g, '<a onclick=\'ptTRcompClicked($2,suid)\'>"Compare Throne Room"</a>');
	 }

     var m = /(Lord|Lady) (.*?)</im.exec(msg);
     if (m != null) m[2] = m[2].replace(/\'/g,"Ã‚Â°Ã‚Â°");
     msg = msg.replace (/<img (.*?>)/img, '<A onclick=\"ptChatIconClicked(\''+ m[2] +'\')\"><img class=\"ptChatIcon\" $1</a>');

     if (whisper && Options.enableWhisperAlert) {
		AudioManager.setSource(SOUND_FILES.whisper);
		AudioManager.play();
		setTimeout(function(){AudioManager.stop();}, 2500);
     } 
     if(alliance){
		 if (whisp.indexOf('My embassy has') >= 0 && Options.enableTowerAlert) {
			AudioManager.setSource(SOUND_FILES.alert);
			AudioManager.play();
			setTimeout(function(){AudioManager.stop();}, 5000);
		 } 
		 if (whisp.indexOf('My wilderness at') >= 0 && Options.enableTowerAlert) {
			AudioManager.setSource(SOUND_FILES.alert);
			AudioManager.play();
			setTimeout(function(){AudioManager.stop();}, 5000);
		 }
	 }

     return t.getFid(msg,suid);
   },

  getFid : function (msg,suid) {
  		var t = ChatStuff;
  		if (ChatIcons.fidCache.indexOf(suid) == -1) {
  			var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
			params.pid = suid;

	   		new AsyncAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/viewCourt.php" + unsafeWindow.g_ajaxsuffix, {
				method: "post",
				parameters: params,
				loading: true,
				onSuccess: function (transport) {
					var rslt = eval("(" + transport.responseText + ")");
						if(rslt.ok){
							ChatIcons.fidCache.push(suid);
							ChatIcons.fidCache.push(rslt.playerInfo.fbuid);
							ChatIcons.ReqSend++;
							saveChatIcons();
							var url = "https://graph.facebook.com/"+ ChatIcons.fidCache[ChatIcons.fidCache.indexOf(suid) +1] +"/picture";
	 						msg = msg.replace (/\bhttps\:\/\/[-a-z].*\'\/\>/i, url +'\'\/\>');
					   } 
				},
				onFailure: function () {
				   return;
				},
			}); 
  		}
	 	else {
	 		var url = "https://graph.facebook.com/"+ ChatIcons.fidCache[ChatIcons.fidCache.indexOf(suid) +1] +"/picture";
	 		msg = msg.replace (/\bhttps\:\/\/[-a-z].*\'\/\>/i, url +'\'\/\>');
	 		
	 	}

	 	return msg;
   },

   DataGoodSide: false,
   DataBadSide:false,
   BadSideStatEffects: [],
   GoodSideStatEffects: [],

   TRcomp : function (pid,uid){
	   	var t = ChatStuff;
	   	t.DataGoodSide = false;
	    t.DataBadSide =false;
		t.TRStatsGoodSide(uid,pid);
	},

	TRStatsGoodSide : function (Goodside,BadSide){
  	var t = ChatStuff;
  	var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
	params.ctrl = 'throneRoom\\ThroneRoomServiceAjax';
	params.action = 'getEquipped';
	params.playerId = Goodside;
	
  	new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch53.php" + unsafeWindow.g_ajaxsuffix, {
		method: "post",
		parameters: params,
		loading: true,
		onSuccess: function (transport) {
			var rslt = eval("(" + transport.responseText + ")");
				if(rslt.ok){
					for (k in unsafeWindow.cm.thronestats.effects) t.GoodSideStatEffects[k] = 0;
					for (kk=0;kk<7;kk++){
    		 			y = rslt.items[kk];
	    	 			if (y != undefined) {
		    	 			for (i=1;i<=5;i++) {
					   			   id = y["effects"]["slot"+i]["id"];
								   tier = parseInt(y["effects"]["slot"+i]["tier"]);
								   level = y["level"];
								   p = unsafeWindow.cm.thronestats.tiers[id][tier];
								   Current = p.base + ((level * level + level) * p.growth * 0.5);
								   if (i<=parseInt(y["quality"])) t.GoodSideStatEffects[id] += Current;
							}
						}
					}
					t.DataGoodSide= true;
					setTimeout(t.TRStatsBadSide,500,BadSide);
			   } else t.GoodSideStatEffects();
		},
		onFailure: function () {
		   return;
		},
	}); 	  	  	
  },

  TRStatsBadSide : function (BadSide){
  	var t = ChatStuff;
  	var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
	params.ctrl = 'throneRoom\\ThroneRoomServiceAjax';
	params.action = 'getEquipped';
	params.playerId = BadSide;
	
  	new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch53.php" + unsafeWindow.g_ajaxsuffix, {
		method: "post",
		parameters: params,
		loading: true,
		onSuccess: function (transport) {
			var rslt = eval("(" + transport.responseText + ")");
				if(rslt.ok){
					for (k in unsafeWindow.cm.thronestats.effects) t.BadSideStatEffects[k] = 0;
					for (kk=0;kk<7;kk++){
    		 			y = rslt.items[kk];
	    	 			if (y != undefined) {
		    	 			for (i=1;i<=5;i++) {
					   			   id = y["effects"]["slot"+i]["id"];
								   tier = parseInt(y["effects"]["slot"+i]["tier"]);
								   level = y["level"];
								   p = unsafeWindow.cm.thronestats.tiers[id][tier];
								   Current = p.base + ((level * level + level) * p.growth * 0.5);
								   if (i<=parseInt(y["quality"])) t.BadSideStatEffects[id] += Current;
							}
						}
					}
					t.DataBadSide= true;
					if (t.DataGoodSide && t.DataBadSide) t.PaintTRCompare();
			   } else t.TRStatsBadSide();
		},
		onFailure: function () {
		   return;
		},
	}); 	  	  	
  },

  PaintTRCompare : function (){
  	var t = ChatStuff;
  	m = 'This info needs testing, ePlZnZX give me feedback ;)<BR><BR><TABLE><TD class=xtab></td><TD class=xtab><B>BadSide</b><TD></td><TD class=xtab><B>Goodside</b></td></tr><TR><TD>&nbsp</td></tr>';
	for (k=1;k<t.GoodSideStatEffects.length;k++) {
		var BadSideContent = "";
		var GoodSideContent = "";
		if (t.BadSideStatEffects[k] != 0) BadSideContent = t.BadSideStatEffects[k] + '% ' + unsafeWindow.cm.thronestats["effects"][k]["1"];
		if (t.GoodSideStatEffects[k] != 0) GoodSideContent = t.GoodSideStatEffects[k] + '% ' + unsafeWindow.cm.thronestats["effects"][k]["1"];

		if (t.BadSideStatEffects[k] != 0 || t.GoodSideStatEffects[k] != 0) m+='<TR><TD  width="25px" class=xtab></td><TD class=xtab>' + BadSideContent + '</td><TD  width="50px" class=xtab></td><TD class=xtab>' + GoodSideContent + '</td></tr>';
	}
	m +='</table>';
	var popMsg = null;
	t.popMsg = new pbPopup('pbMailBody', 0, 0, 550, 750, true, function() {clearTimeout (1000);});
	t.popMsg.centerMe (mainPop.getMainDiv());
	t.popMsg.getMainDiv().innerHTML = m;
	t.popMsg.getTopDiv().innerHTML = '<DIV align=center><B>Throne Room Compare</B></DIV>';
	t.popMsg.show(true); 	
  },
   
   getAllianceLeaders : function (){
   var t = ChatStuff;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/allianceGetLeaders.php" + unsafeWindow.g_ajaxsuffix, {
		 method: "post",
		 parameters: params,
		 loading: true,
		 onSuccess: function (rslt) {
			 if (rslt.officers) {
				for (uid in rslt.officers) {
					var user = rslt.officers[uid];
					t.leaders[user.userId] = user.type.substr(0,4);
				}
			 } 
		},
		onFailure: function () {}
  		});
	},
   
 }

 var AudioManager = {
  player: null,
  volume: 100,
  type: 'html5',
  alertdiv: null,
  init: function (){
	var t = AudioManager;
	if ( !! document.createElement("audio").canPlayType) {
		t.player = new Audio();
		t.type = 'html5';
		t.player.addEventListener("ended", function () {
			t.player.currentTime = 0
		}, false);
		t.setVolume(t.volume);
	} else {
		t.creatediv();
		t.type = 'swf';
	}
  },
  setVolume: function(vol){
	var t = AudioManager;
	t.volume = vol;
	t.player.volume = t.volume * 0.01;
  },
  play: function(){
	var t = AudioManager;
	if(t.type == 'html5'){
		if (!t.player.paused) {
			t.stop();
		}
		t.player.play();
	} else {
		t.alertdiv.innerHTML = t.source;
	}
  },
  stop: function(){
	var t = AudioManager;
	if(t.type == 'html5'){
		t.player.pause();
		if (t.player.readyState === 4) {
			t.player.currentTime = 0
		}
	} else {
		t.alertdiv.innerHTML = '<b style=\'color: rgb(165, 102, 49); font-size: 9px;\'>Audio Alert Played</b>';
	}
  },
  pause: function(){
	var t = AudioManager;
	t.player.pause();
  },
  setSource: function(src){
	var t = AudioManager;
	if(t.type == 'html5'){
		t.player.src = src.OGG;
		t.source = src.OGG;
	} else
		t.source = src.DEFAULT;
  },
  toggleMute: function () {
	var t = AudioManager;
    t.player.muted = !t.player.muted;
  },
  creatediv : function(){
    var t = AudioManager;
    var div = document.getElementsByTagName('div');
	for (var i = 0; i < div.length - 1; i++)
		if (div[i].className == 'mod_comm_forum')
			e = div[i];
	t.alertdiv = document.createElement("span");
	e.appendChild(t.alertdiv);
  },
}

function GetNames (rptid, side, rslt){
	var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
	params.uid=rslt.index.side0PlayerId;
	var side0AllianceId = null;
	var side0Name = null;
	var side0AllianceName = null;
	new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getUserGeneralInfo.php" + unsafeWindow.g_ajaxsuffix, {
		method: "post",
		parameters: params,
		onSuccess: function (transport) {
			var rslt0 = eval("(" + transport.responseText + ")");
			if (rslt0['userInfo']) {
				side0Name = rslt0['userInfo']['0']['name'];
				side0AllianceName = rslt0['userInfo']['0']['allianceName'];
				side0AllianceId = rslt0['userInfo']['0']['allianceId'];
			}
			var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
				params.uid=rslt.index.side1PlayerId;
				new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getUserGeneralInfo.php" + unsafeWindow.g_ajaxsuffix, {
					method: "post",
					parameters: params,
					onSuccess: function (transport) {
						var rslt1 = eval("(" + transport.responseText + ")");
						side1Name = rslt1['userInfo']['0']['name'];
						side1AllianceName = rslt1['userInfo']['0']['allianceName'];
						if (parseInt(side0AllianceId) == parseInt(Seed.allianceDiplomacies.allianceId)) side = 0;
						 else side = 1;
						rslt = rslt.index;
						ReportFetch(rslt.marchReportId,side,rslt.side0TileType,rslt.side0TileLevel,rslt.side0PlayerId,side0Name,0,side1Name,0,rslt.marchType,rslt.side0XCoord,rslt.side0YCoord,rslt.reportUnixTime,false,rslt.side1XCoord,rslt.side1YCoord,side0AllianceName,side1AllianceName,true);					
					},
					onFailure: function () {
						alert('kabam is having issues');
					},
				}, false);
		},					
		onFailure: function () {
			alert('kabam is having issues');
		},
	}, false);
}

function ReportFetch (rptid, side, tiletype, tilelv, defid, defnm, defgen, atknm, atkgen, marchtype, xcoord, ycoord, timestamp, unread, atkxcoord, atkycoord,side0AllianceName,side1AllianceName,link){
	var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
	params.rid=rptid;
	if (tiletype != 999) params.side = side;
	new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/fetchReport.php" + unsafeWindow.g_ajaxsuffix, {
				method: "post",
				parameters: params,
				onSuccess: function (transport) {
					var rslt = eval("(" + transport.responseText + ")");
					if (rslt.ok == false) {alert(rslt.msg);return;}
					if (!rslt.error){		
						if (tiletype !=999 )PaintPvpReport(rslt, rptid, side, tiletype, tilelv, defid, defnm, defgen, atknm, atkgen, marchtype, xcoord, ycoord, timestamp, unread, atkxcoord, atkycoord,side0AllianceName,side1AllianceName,link);
						else GetNames(params.rid, side, rslt);
					} else alert('kabam is having issues with reports...');	

				},
				onFailure: function () {
					alert('kabam is having issues with reports...');
				},
	}, false);
}

function PaintPvpReport (rslt, rptid, side, tiletype, tilelv, defid, defnm, defgen, atknm, atkgen, marchtype, xcoord, ycoord, timestamp, unread, atkxcoord, atkycoord,side0AllianceName,side1AllianceName,link){
	var popReport = null;
	var action='';
	popReport = new pbPopup('pbShowPvp', 0, 0, 740, 600, true, function() {if (unread){unsafeWindow.seed.newReportCount = parseInt(Seed.newReportCount) - 1;unsafeWindow.messages_notify_bug()}unsafeWindow.pageNavigatorModel.gotoPage(1);unsafeWindow.Messages.listReports();clearTimeout (1000);});
	popReport.centerMe (mainPop.getMainDiv());
	var color ='none';
	if (defid == unsafeWindow.tvuid && rslt.winner == 1) color = "#FF2934";
	if (defid != unsafeWindow.tvuid && rslt.winner == 0) color = "#FF2934";
	if (defid == unsafeWindow.tvuid && rslt.winner == 0) color = "#3EC249";
	if (defid != unsafeWindow.tvuid && rslt.winner == 1) color = "#3EC249";
	if (rslt.winner == 2) color = "#EDD118";
	if (side0AllianceName == Seed.allianceDiplomacies.allianceName && rslt.winner == 1) color = "#FF2934";
	if (side0AllianceName != Seed.allianceDiplomacies.allianceName && rslt.winner == 0) color = "#FF2934";
	if (side0AllianceName == Seed.allianceDiplomacies.allianceName && rslt.winner == 0) color = "#3EC249";
	if (side0AllianceName != Seed.allianceDiplomacies.allianceName && rslt.winner == 1) color = "#3EC249";
	if (rslt.winner == 2) color = "#EDD118";	

	switch (parseInt(marchtype)) {
		case (3):
				var login = '';
 				if (defid != unsafeWindow.tvuid) login = 'Last Login: ' + FullDateTime(rslt.lstlgn);
				var m = '<DIV style="height:575px;max-height:575px;overflow-y:auto;"><DIV style="background-color:'+color+';"><TABLE width="100%" class=pbTab><TR><TD>Time: ' + FullDateTime(timestamp) + '</td><TD align=center>Report No: ' + rptid + '</td><TD align=right><INPUT id=PostToChat type=submit class=pbButton value="Post to chat"></td></tr>';
				m+= '<TR><TD></td>'
				if (tiletype == 51 && defnm != null && side0AllianceName != Seed.allianceDiplomacies.allianceName) m+= '<TD align=center><FONT size=3><B>' + login + '</b></font></td>';
				else m+='<TD></td>';
				if (!link) m+='<TD align=right><INPUT id=Delete type=submit class=pbButton value="Delete"></td>';
				m+='</tr></table></div>';
				m+= '<BR><TABLE class=pbTab width=100%><TR><TD valign=top width=370px max-width=370px><DIV id=InfoSide1></div></td><TD valign=top width=370px max-width=370px><DIV id=InfoSide0></div></td></tr></table>';
				m+= '<BR><TABLE class=pbTab width=100%><TR><TD valign=top width=370px max-width=370px><DIV id=TroopsSide1></div></td><TD valign=top width=370px max-width=370px><DIV id=TroopsSide0></div></td></tr></table>';
				m+= '<BR><TABLE class=pbTab width=100%><TR><TD valign=top width=370px max-width=370px><DIV id=StatsSide1></div></td><TD valign=top width=370px max-width=370px><DIV id=StatsSide0></div></td></tr></table>';	
				if (defid != unsafeWindow.tvuid && side0AllianceName != Seed.allianceDiplomacies.allianceName) m+= '<BR><DIV class=pbStat>RESOURCES FOUND</div><DIV id=ScoutResources></div>';
				if (defid != unsafeWindow.tvuid && side0AllianceName != Seed.allianceDiplomacies.allianceName) m+= '<BR><DIV class=pbStat>TROOPS & FORTIFICATIONS</div><DIV id=ScoutTroops></div>';
				if (defid != unsafeWindow.tvuid && side0AllianceName != Seed.allianceDiplomacies.allianceName) m+= '<BR><DIV class=pbStat>BUILDINGS & RESEARCH</div><TABLE class=pbTab width=100%><TR><TD valign=top width=370px max-width=370px><DIV id=Buildings></div></td><TD valign=top width=370px max-width=370px><DIV id=Research></div></td></tr></table>';
				m+= '<BR><DIV class=pbStat>BOOSTS</div><TABLE class=pbTab width=100%><TR><TD valign=top width=370px max-width=370px><DIV id=ItemsSide1></div></td><TD valign=top width=370px max-width=370px><DIV id=ItemsSide0></div></td></tr></table>';
				m+= '<BR><TABLE class=pbTab width=100%><TR><TD valign=top width=370px max-width=370px><DIV id=TechSide1></div></td><TD valign=top width=370px max-width=370px><DIV id=TechSide0></div></td></tr></table>';
				m+= '<BR><DIV class=pbStat>THRONE ITEMS</div><TABLE class=pbTab width=100%><TR><TD valign=top width=370px max-width=370px><DIV id=TRSide1></div></td><TD valign=top width=370px max-width=370px><DIV id=TRSide0></div></td></tr></table>';
				m+='</table></div>';
				if (defid != unsafeWindow.tvuid && side0AllianceName != Seed.allianceDiplomacies.allianceName) action = "SCOUT";
				else action = "ANTI-SCOUT";
				break;
		case (4):
				var m = '<DIV style="height:575px;max-height:575px;overflow-y:auto;"><DIV style="background-color:'+color+';"><TABLE width="100%" class=pbTab><TR><TD>Time: ' + FullDateTime(timestamp) + '</td><TD align=center>Report No: ' + rptid + '</td><TD align=right><INPUT id=PostToChat type=submit class=pbButton value="Post to chat"></td></tr>';
				m+= '<TR><TD></td>';
				if (tiletype == 51 && defnm != null) m+='<TD align=center><FONT size=3><B>Glory: ' + addCommas(rslt.glory) + '</b></font></td>';
				else m+='<TD></td>';
				if (!link) m+='<TD align=right><INPUT id=Delete type=submit class=pbButton value="Delete"></td>';
				m+='</tr></table></div>';
				m+= '<BR><DIV id=rptResources></div>';
				m+= '<BR><TABLE class=pbTab width=100%><TR><TD valign=top width=370px max-width=370px><DIV id=InfoSide1></div></td><TD valign=top width=370px max-width=370px><DIV id=InfoSide0></div></td></tr></table>';
				m+= '<BR><TABLE class=pbTab width=100%><TR><TD valign=top width=370px max-width=370px><DIV id=TroopsSide1></div></td><TD valign=top width=370px max-width=370px><DIV id=TroopsSide0></div></td></tr></table>';
				m+= '<BR><TABLE class=pbTab width=100%><TR><TD valign=top width=370px max-width=370px><DIV id=StatsSide1></div></td><TD valign=top width=370px max-width=370px><DIV id=StatsSide0></div></td></tr></table>';
				m+= '<BR><DIV class=pbStat>BOOSTS</div><TABLE class=pbTab width=100%><TR><TD valign=top width=370px max-width=370px><DIV id=ItemsSide1></div></td><TD valign=top width=370px max-width=370px><DIV id=ItemsSide0></div></td></tr></table>';
				m+= '<BR><TABLE class=pbTab width=100%><TR><TD valign=top width=370px max-width=370px><DIV id=TechSide1></div></td><TD valign=top width=370px max-width=370px><DIV id=TechSide0></div></td></tr></table>';
				m+= '<BR><DIV class=pbStat>THRONE ITEMS</div><TABLE class=pbTab width=100%><TR><TD valign=top width=370px max-width=370px><DIV id=TRSide1></div></td><TD valign=top width=370px max-width=370px><DIV id=TRSide0></div></td></tr></table>';
				m+='</table></div>';
				if (tiletype == 51 && defnm != null) action = "PvP ATTACK";
				else if (tiletype == 51) action = "BARB CAMP ATTACK"
				else action = "WILD ATTACK";
				break;
		default: alert("Only attack and scout reports are supported for the moment...");return;
	}	
	popReport.getMainDiv().innerHTML = m;
	popReport.getTopDiv().innerHTML = '<DIV align=center><B>'+ action +' Report</b></DIV>';
	popReport.show(true);
	document.getElementById('PostToChat').addEventListener('click', function(){DispReport.PostChatReport(rptid);} , false);
	if (!link) document.getElementById('Delete').addEventListener('click', function(){DeletMyReport(rptid,unread,popReport);} , false);
	paintInfo(rslt, atknm, defnm, atkxcoord, atkycoord, xcoord, ycoord,side0AllianceName,side1AllianceName);
	paintTroops(rslt.fght);
	if (rslt.bonus) paintStats(rslt.bonus.mod);
	if (rslt.bonus) paintBonuses(rslt);
	if (rslt.loot) paintResources(rslt.loot,rslt.throneRoomDrop);
	if (rslt.tch) paintResearch(rslt);
	if (rslt.rsc) paintScoutResources(rslt.rsc);
	if (rslt.unts || rslt.frt) paintScoutTroops(rslt.unts,rslt.frt);
	if (rslt.blds) paintBuildings(rslt);
}


var Mightloss = 0;
var WoundedMight = 0;

function paintInfo (rslt, atknm, defnm, atkxcoord, atkycoord, defxcoord, defycoord,side0AllianceName,side1AllianceName){
	if (defnm == null) defnm = "Enemy";
	m = "<DIV><B>Attackers: </b> " + atknm + '&nbsp' + coordLink(atkxcoord,atkycoord);
	if (rslt.winner == 1) m+='<FONT color=red><B> Winner</b></font>';
	if (side1AllianceName && isNaN(side1AllianceName)) m+='<BR>Alliance: ' + side1AllianceName;
	m +='<BR>Knight Combat Skill: ' + rslt.s1KCombatLv;
	calcMightloss(rslt.fght,1)
	m +='<BR>Might lost: ' + addCommas(Mightloss);
	m +='<BR>Wounded might: ' + addCommas(WoundedMight);
	if (rslt.overwhelmed) m +='<BR>Troops got overwhelmed!!';
	document.getElementById('InfoSide1').innerHTML = m;
	m = "<DIV><B>Defenders: </b> " + defnm + '&nbsp' + coordLink(defxcoord,defycoord);
	if (rslt.winner == 0) m+='<FONT color=red><B> Winner</b></font>';
	if (side0AllianceName && isNaN(side0AllianceName)) m+='<BR>Alliance: ' + side0AllianceName;
	m +='<BR>Knight Combat Skill: ' + rslt.s0KCombatLv;
	calcMightloss(rslt.fght,0)
	m +='<BR>Might lost: ' + addCommas(Mightloss);
	m +='<BR>Wounded might: ' + addCommas(WoundedMight);
	m +='<BR>Rounds: ' + rslt.rnds;
	document.getElementById('InfoSide0').innerHTML = m;
}

function calcMightloss (fght,s){
	var killed = 0;
	Mightloss = 0;
	WoundedMight = 0;
	if (fght['s'+s] != undefined) {	
		for(y in unsafeWindow.unitcost) if (fght['s'+s]['u'+y.substr(3)] != undefined) {
			killed = fght['s'+s]['u'+y.substr(3)][0] - fght['s'+s]['u'+y.substr(3)][1];
			Mightloss += unsafeWindow.unitmight[y] * killed;
			if (fght['s'+s]['u'+y.substr(3)][2] == '?') WoundedMight = "?";
			else WoundedMight += unsafeWindow.unitmight[y] * fght['s'+s]['u'+y.substr(3)][2];
		}
		for(y in fortmight) if (fght['s'+s]['f'+y.substr(1)] != undefined) {
			killed = fght['s'+s]['f'+y.substr(1)][0] - fght['s'+s]['f'+y.substr(1)][1];
			Mightloss += fortmight[y] * killed;
			if (fght['s'+s]['f'+y.substr(1)][2] == '?') WoundedMight = "?";
			else WoundedMight += fortmight[y] * fght['s'+s]['f'+y.substr(1)][2];
		}
	}
}

function paintResources (loot,TR){
	var m = '<TABLE class=pbTab  style="width:100%;"><TR>';
	var what = ["gold","food","wood","stone","iron"]
	for (i=0;i<=4;i++) m+='<TD width=30px><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/'+ what[i] +'_30.png></td><TD>' + addCommas(loot[i])+'</td>';
	if (loot[6] > 0) m+='</tr><TR><TD width=30px><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/aetherstone_30.png>' + addCommas(loot[6])+'</td>';
	for (var crest=1101; crest < 1116; crest++) if (loot[5][crest] == 1) m+='<TD><img width=30 src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/70/' + crest + '.png>' + crestname[crest] + '</td>';
	if (TR != undefined) m+='<TD width=30px><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/throne/icons/30/' + TR.faction + '/' + TR.faction + '_'+ TR.type +'_normal_1_'+ TR.quality+'.png></td>';
	m+='</tr></table>';;
	document.getElementById('rptResources').innerHTML = m;
}

function paintScoutResources (rsc){
	var m = '<TABLE class=pbTab  style="width:100%;"><TR>';
	var what = ["gold","food","wood","stone","iron"]
	for (i=1;i<=4;i++) m+='<TD width=30px><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/'+ what[i] +'_30.png></td><TD>' + addCommas(Math.round(rsc['r' + i]))+'</td>';
	m+='</tr></table>';;
	document.getElementById('ScoutResources').innerHTML = m;
}

function paintTroops (fght){
	var m = "";
	var killed = 0;
	var Paintkilled = "";
	var PctWounded = 0;
	var PaintPctWounded ="";
	for(s=1;s>=0;s--){
		m = "No Troops Defended";
		if (fght['s'+s] != undefined) {	
			m = '<TABLE class=pbTab><TR><TD width=50px>&nbsp</td><TD width=75px>Fought</td><TD width=125>Survived</td><TD width=100px>Wounded</td>';
			for(y in unsafeWindow.unitcost) if (fght['s'+s]['u'+y.substr(3)] != undefined) {
				Paintkilled = "";
				PctWounded = 0;
				PaintPctWounded ="";
				killed = fght['s'+s]['u'+y.substr(3)][0] - fght['s'+s]['u'+y.substr(3)][1];
				if (killed > 0) Paintkilled = '<FONT color=red> ('+ addCommas(killed) +')</font>';
				if (fght['s'+s]['u'+y.substr(3)][2] != "?") PctWounded = (fght['s'+s]['u'+y.substr(3)][2] / fght['s'+s]['u'+y.substr(3)][0]) * 100;
				if (PctWounded > 0) PaintPctWounded = ' (' + Math.round(PctWounded) + '%)';
				m += '<TR><TD><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+ y.substr(3) +'_30_s34.jpg?6545></td><TD>' + addCommas(fght['s'+s]['u'+y.substr(3)][0]) + '</td><TD>' + addCommas(fght['s'+s]['u'+y.substr(3)][1]) + Paintkilled +'</td><TD>' + addCommas(fght['s'+s]['u'+y.substr(3)][2]) + PaintPctWounded + '</td></tr>';
			}
			for(y in unsafeWindow.fortcost) if (fght['s'+s]['f'+y.substr(3)] != undefined) {
				Paintkilled = "";
				PctWounded = 0;
				PaintPctWounded ="";
				killed = fght['s'+s]['f'+y.substr(3)][0] - fght['s'+s]['f'+y.substr(3)][1];
				if (killed > 0) Paintkilled = '<FONT color=red> ('+ addCommas(killed) +')</font>';
				if (fght['s'+s]['f'+y.substr(3)][2] != "?") PctWounded = (fght['s'+s]['f'+y.substr(3)][2] / fght['s'+s]['f'+y.substr(3)][0]) * 100;
				if (PctWounded > 0) PaintPctWounded = ' (' + Math.round(PctWounded) + '%)';
				m += '<TR><TD><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+ y.substr(3) +'_30.jpg></td><TD>' + addCommas(fght['s'+s]['f'+y.substr(3)][0]) + '</td><TD>' + addCommas(fght['s'+s]['f'+y.substr(3)][1]) + Paintkilled +'</td><TD>' + addCommas(fght['s'+s]['f'+y.substr(3)][2]) + PaintPctWounded + '</td></tr>';
			}
			m +='</table>';
		}
		document.getElementById('TroopsSide'+s).innerHTML = m;
	}
}

function paintScoutTroops (unts,frt){
	var	m = "None. You may need to increase your Eagle Eyes research level to see more info.";
	var counter = 0;
	if (unts.length !=0 && frt.lengt !=0) {
		m = '<TABLE class=pbTab width=100%><TR>';
		for(y in unts) {
			counter++;
			if (counter == 7 || counter == 14) m+='</tr><TR>'
			if (unts.length !=0) m += '<TD width=30px><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+ y.substr(1) +'_30_s34.jpg?6545></td><TD>' + addCommas(unts[y]) + '</td>';
		}
		m+='</tr><TR>'
		for(y in frt){
			if (frt.length !=0) m += '<TD><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+ y.substr(1) +'_30.jpg></td><TD>' + addCommas(frt[y]) +'</td>';
		}
		m +='</tr></table>';
	}
	document.getElementById('ScoutTroops').innerHTML = m;
}

function paintStats (mod){
	var m = '';
	var color = "black";	
	var diff = 0;
	var diffCont = "";
	for(s=1;s>=0;s--){
		m = '<TABLE class=pbTab width=80%>';
		for (y in unsafeWindow.unitcost) {
			var i = y.substr(3);		
			if (mod["s"+s] != undefined && mod["s"+s]['u'+i] != undefined) {
				m+='<TR><TD rowspan=2 width=30px><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+ i +'_30_s34.jpg?6545></td><TD>';
				for(k in mod["s"+s]['u'+i]){
					diff = 0;
					diffCont = "";
					if (mod['s'+s]['u'+i][k][0] < mod['s'+s]['u'+i][k][1]) {
						color = "green";
						diff = ((Math.round(mod['s'+s]['u'+i][k][1]) - Math.round(mod['s'+s]['u'+i][k][0])) / Math.round(mod['s'+s]['u'+i][k][0])) * 100;
						diffCont = ' (' + Math.round(diff) + '%)';
					}
					else if (mod['s'+s]['u'+i][k][0] > mod['s'+s]['u'+i][k][1]) {
						color="red";
						diff = ((Math.round(mod['s'+s]['u'+i][k][1]) - Math.round(mod['s'+s]['u'+i][k][0])) / Math.round(mod['s'+s]['u'+i][k][1])) * 100;
						diffCont = ' (' + Math.round(diff) + '%)';
					}
					else color="black";
					if (k == 'spd') m+='</td></tr><TR><TD>';
					if (mod['s'+s]['u'+i][k]) m+='<TD width=20px><FONT size=1><B>' + k + ':</b></td></font><TD><FONT size="1" color='+ color +'>' + addCommas(Math.round(mod['s'+s]['u'+i][k][1])) + diffCont + '</font></td>';
				}
			}
		}
		m += '</tr>';
		for (y in unsafeWindow.fortcost) {
			var i = y.substr(3);
			if (mod["s"+s] != undefined && mod["s"+s]['f'+i] != undefined) {
					m+='<TR><TD rowspan=2 width=30px><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+ i +'_30.jpg></td><TD>';
					for(k in mod["s"+s]['f'+i]){
						diff = 0;
						diffCont = "";
						if (mod['s'+s]['f'+i][k][0] < mod['s'+s]['f'+i][k][1]) {
							color = "green";
							diff = ((Math.round(mod['s'+s]['f'+i][k][1]) - Math.round(mod['s'+s]['f'+i][k][0])) / Math.round(mod['s'+s]['f'+i][k][0])) * 100;
							diffCont = ' (' + Math.round(diff) + '%)';
						}
						else if (mod['s'+s]['f'+i][k][0] > mod['s'+s]['f'+i][k][1]) {
							color="red";
							diff = ((Math.round(mod['s'+s]['f'+i][k][1]) - Math.round(mod['s'+s]['f'+i][k][0])) / Math.round(mod['s'+s]['f'+i][k][1])) * 100;
							if (diff != "-Infinity") diffCont = ' (' + Math.round(diff) + '%)';
						}
						else color="black";
						if (k == 'spd') m+='</td></tr><TR><TD>';
						if (mod['s'+s]['f'+i][k]) m+='<TD width=20px><FONT size="1"><B>' + k + ':</b></td></font><TD><FONT size="1" color='+ color +'>' + addCommas(Math.round(mod['s'+s]['f'+i][k][1])) + diffCont + '</font></td>';
					}
			}
		}
		m +='</tr></table>';
		if (mod["s"+s] && mod["s"+s]['b19']) m+='<BR>Castle Life: ' + addCommas(mod["s"+s]['b19']['hp'][0]) +' / ' + addCommas(mod["s"+s]['b19']['hp'][1]);
		document.getElementById('StatsSide'+s).innerHTML = m;
	}
}

function paintBonuses (rslt){
	var Items = "";
	var Tech = "";
	var TR = "";
	var translate = {"hp":"Life","atk":"Attack","def":"Defense","spd":"Speed","rng":"Range","ld":"Load","ic":"Improved Cartography","id":"Improved Defenses","sr":"Strengthen Ranks","if":"Improved Fletching"};
	for (s=1;s>=0;s--){
		Items = '<TABLE class=pbTab>';
		if (rslt['s' + s + 'atkBoost'] != 0 && rslt['s' + s + 'atkBoost']) Items+='<TR><TD>Attack boost: </td><TD>' + Math.round(rslt['s' + s + 'atkBoost']*100) + '%</td></tr>';
		if (rslt['s' + s + 'defBoost'] != 0 && rslt['s' + s + 'defBoost']) Items+='<TR><TD>Defense boost: </td><TD>' + Math.round(rslt['s' + s + 'defBoost']*100) + '%</td></tr>';
		if (rslt['s' + s + 'lifeBoost'] != 0 && rslt['s' + s + 'lifeBoost']) Items+='<TR><TD>Life boost: </td><TD>' + Math.round(rslt['s' + s + 'lifeBoost']*100) + '%</td></tr>';
		if (rslt['s' + s + 'guardianAtkBoost'] != undefined) Items+='<TR><TD>Guardian Attack boost: </td><TD>' + Math.round(rslt['s' + s + 'guardianAtkBoost']*100) + '%</td></tr>';
		if (rslt['s' + s + 'guardianDefBoost'] != undefined) Items+='<TR><TD>Guardian Defense boost: </td><TD>' + Math.round(rslt['s' + s + 'guardianDefBoost']*100) + '%</td></tr>';
		Items += '</table>';		
		Tech = '<TABLE class=pbTab>';
		for(y in rslt.bonus.tch['s' + s]) Tech+='<TR><TD width=75px>' + translate[y] + '</td><TD>' + Math.round(rslt.bonus.tch['s' + s][y]*100) + '%</td>	</tr>';
		if (rslt.bonus.tch2) for(y in rslt.bonus.tch2['s' + s]) Tech+='<TR><TD width=150px>' + translate[y] + '</td><TD>' + Math.round(rslt.bonus.tch2['s' + s][y]*100) + '%</td></tr>';
		Tech += '</table>';		
		TR = '<TABLE class=pbTab>';
		for(y in rslt['s' + s + 'ThroneRoomBoosts']) TR+='<TR><TD width=50px>' + rslt['s' + s + 'ThroneRoomBoosts'][y] + '%</td><TD>' + unsafeWindow.cm.thronestats["effects"][y]["1"] + '</td></tr>';
		TR += '</table>';		
		document.getElementById('ItemsSide'+s).innerHTML = Items;
		document.getElementById('TechSide'+s).innerHTML = Tech;
		document.getElementById('TRSide'+s).innerHTML = TR;
		
	}	
	
}

function paintResearch (rslt){
		Research = '<TABLE class=pbTab>';
		for (i=1;i<=17;i++) {
			if (i!=7) if(rslt.tch) Research +='<TR><TD width=175px>' + unsafeWindow.techcost['tch'+i][0] + '</td><TD>' + rslt.tch['t'+i] +'</td>';
		}
		for (i=1;i<=6;i++) {
			if(rslt.tch2) Research +='<TR><TD width=175px><B>' + unsafeWindow.techcost2['tch'+i][0] + '</td><TD>' + rslt.tch2['t'+i] +'</b></td>';
		}
		Research += '</table>';		
		document.getElementById('Research').innerHTML = Research;
}

function paintBuildings (rslt){
		Buildings = '<TABLE class=pbTab>';
		for (y in unsafeWindow.buildingcost) if (rslt.blds['b'+ y.substr(3)]) {
			i = y.substr(3);
			Buildings +='<TR><TD width=175px>' + unsafeWindow.buildingcost['bdg'+i][0] + '</td><TD>' + rslt.blds['b'+i] +'</td>';
		}
		Buildings += '</table>';		
		document.getElementById('Buildings').innerHTML = Buildings;
}

function DeletMyReport (rptid, isUnread, popReport){
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.s0rids = rptid;
    params.s1rids = '';
    params.cityrids = '';
    new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/deleteCheckedReports.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (transport) {
      	var rslt = eval("(" + transport.responseText + ")");
      	if (rslt.ok) {
      		if (isUnread){
      			unsafeWindow.seed.newReportCount = parseInt(Seed.newReportCount) - 1;
          		unsafeWindow.messages_notify_bug()
      		}
      		unsafeWindow.pageNavigatorModel.gotoPage(1);
            unsafeWindow.Messages.listReports();
		    popReport.show(false);
      	}   
      },
      onFailure: function () {
      },
    });
 }

var battleReports = {
  init : function (){
    var t = battleReports; 
    t.getReportDisplayFunc = new CalterUwFunc ('getReportDisplay', [['return K.join("")', 'var themsg=K.join(""); themsg=getReportDisplay_hook(themsg, arguments[1]); themsg=getReportDisplay_hookz(themsg, arguments[1]); return themsg']]); //Alliance report battle rounds function
    unsafeWindow.getReportDisplay_hook = t.hook;
    unsafeWindow.getReportDisplay_hookz = t.hookz;
    t.getReportDisplayFunc.setEnable (true);
    t.renderBattleReportFunc = new CalterUwFunc ('Messages.viewMarchReport', [[/\$\("modal_msg_list"\)\.innerHTML\s*=\s*cm\.MarchReportController\.getMarchReport\(c,\s*w\)/, 'var msg = cm.MarchReportController.getMarchReport(c, s); $("modal_msg_list").innerHTML = renderBattleReport_hook(msg,c,s);']]); //March reports battle rounds function
    unsafeWindow.renderBattleReport_hook = t.hook2;
    t.renderBattleReportFunc.setEnable (true);
    unsafeWindow.deleteAreport = t.e_deleteReport;
    unsafeWindow.MoreReport = t.e_MoreReport;
    unsafeWindow.PostReport = t.e_PostReport;
	},


  isRoundsAvailable : function (){
    var t = battleReports; 
    return t.getReportDisplayFunc.isAvailable() || t.renderBattleReportFunc.isAvailable();
  },
  
  e_deleteReport : function (rptid){
    var t = battleReports; 
    t.ajaxDeleteMyReport (rptid);
  },
  
  e_MoreReport : function (rptid,side){
    var t = battleReports; 
    alert('WIP ;)');
  },
  
  e_PostReport : function (rptid){
      var msg = 'Report No: ' + rptid; 
      sendChat ("/a "+  msg);
  },
  
  SendChat:function(name,mess) {
    	var inp=document.getElementById('mod_comm_input');
    	inp.value="@"+name+' '+mess;
    	unsafeWindow.Chat.sendChat();
  },
      
  ajaxDeleteMyReport : function (rptid, isUnread, side, isCityReport, notify){
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.s0rids = rptid;
    params.s1rids = '';
    params.cityrids = '';
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/deleteCheckedReports.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        if (rslt.ok && isUnread){
          unsafeWindow.seed.newReportCount = parseInt(seed.newReportCount) - 1;
          unsafeWindow.messages_notify_bug()
        }    
        if (notify)
          notify (rslt.errorMsg);
      },
      onFailure: function () {
        if (notify)
          notify ('AJAX ERROR');
      },
    });
  },
  
  hookz : function (msg, rslt) {
    msg = msg.replace (/(\bReport\sNo\:\s([0-9]+))/g, '<a onclick=\'ptChatReportClicked($2,0,999)\'>$1</a>');
  return msg;
  },

  hook2 : function (msg, args, rslt){
    if (rslt.rnds && Options.dispBattleRounds){
      msg = msg.replace (/<\/ul>.*\s*<\/div>.*\s*<div class="unitsContainer">/im, '<li><span class=\'label\'>Rounds: </span><span class=\'value\'>'+ rslt.rnds +'</span></li></ul></div><div class="unitsContainer">');
    }
	if (Options.reportDeleteButton){
		msg = msg.replace(/Reports<\/span><\/a>/im, 'Reports</span></a><a class=\'button20\' onclick=\'PostReport('+args[0]+',false)\'><span>Post To Chat</span></a>'); //Post to Chat button
		msg = msg.replace(/Reports<\/span><\/a>/im, 'Reports</span></a><a class=\'button20\' onclick=\'MoreReport('+args[0]+','+args[1]+',false)\'><span>More</span></a>'); //More button
		msg = msg.replace(/Reports<\/span><\/a>/im, 'Reports</span></a><a class=\'button20\' onclick=\'deleteAreport('+args[0]+',false)\'><span>'+unsafeWindow.g_js_strings.commonstr.deletetx+'</span></a>'); //Delete button
	}
    return msg;
  },
  hook : function (msg, rslt){
    if (rslt.rnds && Options.dispBattleRounds) msg = msg.replace (/(Attackers <span.*?)<\/div>/im, '$1<BR>Rounds: '+ rslt.rnds +'</div>');
    return msg;
  },
}

var AttackDialog = {
  init : function (){
    var t = AttackDialog;
    t.modal_attackFunc = new CalterUwFuncTools ('modal_attack', [[/}\s*$/, '; attackDialog_hook(); }']]);
    unsafeWindow.attackDialog_hook = t.modalAttackHook;
    t.modal_attackFunc.setEnable (true);
    AttackDialog.isKnightSelectAvailable();
  },  
  setEnable : function (){},
  isKnightSelectAvailable : function (){
    var t = AttackDialog;
    return t.modal_attackFunc.isAvailable();
  },
  isAttackCityPickerAvailable : function (){
    var t = AttackDialog;
    return t.modal_attackFunc.isAvailable();
  },
  modalAttackHook : function (){
    var t = AttackDialog;
    for (var i=1; i<6; i++) document.getElementById('modal_attack_tab_'+ i).addEventListener('click', t.e_changeMarchType, false); 
    setTimeout (t.initCityPicker, 0);        
  },
  
  initCityPicker : function (){
    var t = AttackDialog;
    var div = document.getElementById('modal_attack_target_numflag'); // as of KofC version 96;
    var mySpan;
    if (div) {
      div.parentNode.innerHTML += ' &nbsp; <SPAN id=modal_attack_citybuts></span>';
    } else {
      var span = document.getElementById('modal_attack_target_coords');   // KofC version 116+;
      span.parentNode.parentNode.firstChild.innerHTML += ' &nbsp; <SPAN id=modal_attack_citybuts></span>';
    }
    new CdispCityPicker ('ptatp', document.getElementById('modal_attack_citybuts'), false, t.e_CityButton);
    var cityIdx = Cities.byID[unsafeWindow.currentcityid].idx;
    thisCityBut = document.getElementById('ptatp_'+ cityIdx);
    thisCityBut.style.opacity = '0.5';
    thisCityBut.disabled = true;
    if (document.getElementById('modal_attack_tab_4').className=='selected' || document.getElementById('modal_attack_tab_3').className=='selected')   // don't do for attack or scout
      document.getElementById('modal_attack_citybuts').style.display = 'none';
  },
  
  e_CityButton : function (city){
    document.getElementById('modal_attack_target_coords_x').value = city.x;
    document.getElementById('modal_attack_target_coords_y').value = city.y;
    unsafeWindow.modal_attack_update_time();
  },
      
  e_changeMarchType : function (evt){
    var t = AttackDialog;
    var marchType = parseInt(evt.target.id.substr(17));  
      if (marchType==3 || marchType==4) document.getElementById('modal_attack_citybuts').style.display = 'none';
      else document.getElementById('modal_attack_citybuts').style.display = 'inline';
      var knightVal = 0;
      var selector = document.getElementById('modal_attack_knight'); 
      if (selector.length>1 && (marchType==4 || marchType==2)) knightVal = 1;
      selector.selectedIndex = knightVal; 
  },  
}


var CoordBox = {
  init : function (){
    var t = CoordBox;
    t.boxDiv = searchDOM (document.getElementById('maparea_map'), 'node.className=="mod_coord"', 3, false);
    t.setEnable (Options.mapCoordsTop);
  },
  setEnable : function (tf){
    var t = CoordBox;
    if (t.boxDiv == null)
      return;
    if (tf)
      t.boxDiv.style.zIndex = '100000';
    else
      t.boxDiv.style.zIndex = '10011';
  }, 
  isAvailable : function (){
    var t = CoordBox;
    return !(t.boxDiv==null);
  }, 
};

var AllianceReports = {
  checkPeriod : 300,
  allianceNames : [],
  saveArfunc : unsafeWindow.allianceReports,

  init : function (){
    t = AllianceReports;
    t.enable (true);
    t.marvFunc = new CalterUwFuncTools ('modal_alliance_report_view', [['getReportDisplay', 'getReportDisplay_hook2']]);
    t.memListFunc = new CalterUwFuncTools ('membersInfo', [['commonstr.might','commonstr.might + "</td><td class=colcities>" + g_js_strings.commonstr.cities + "</td><td class=collast>" + g_js_strings.membersInfo.lastonline'],['memberInfo[key].prestige)', 'memberInfo[key].prestige)+ "</td>");memhtml.push("<td class=colcities>" + memberInfo[key].cities + "</td>");memhtml.push("<td class=collast>" + memberInfo[key].lastLogin']]);
    unsafeWindow.getReportDisplay_hook2 = t.getReportDisplayHook;
    unsafeWindow.getmembersInfo_hook = t.getMembersInfoHook;
    t.marvFunc.setEnable (true);
    t.enable_viewmembers(true);
  },
   
  getReportDisplayHook : function (a, b){
    var x = '';
    try {
      x = unsafeWindow.getReportDisplay(a,b);  
    } catch (e){
      x = 'Error formatting report: '+ e;
    }
    return x;
  },
  
  enable_viewmembers : function (tf){
    t = AllianceReports;
    t.memListFunc.setEnable (tf);
  },
  
  enable : function (tf){
    t = AllianceReports;
    if (tf) unsafeWindow.allianceReports = t.myAllianceReports;
    else unsafeWindow.allianceReports = t.saveArfunc;
  },
  
  myAllianceReports : function (pageNum){
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    if (pageNum) params.pageNo = pageNum;
    params.group = "a";
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/listReports.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {displayReports (rslt.arReports, rslt.arPlayerNames, rslt.arAllianceNames, rslt.arCityNames, rslt.totalPages);},
      onFailure: function (rslt) {},
    }, false);

    function displayReports (ar, playerNames, allianceNames, cityNames, totalPages){
      var msg = new Array();
      var myAllianceId = getMyAlliance()[0];
      msg.push ("<STYLE>.msgviewtable tbody .myCol div {margin-left:5px; overflow:hidden; white-space:nowrap; color:#000}\
            .msgviewtable tbody .myHostile div {font-weight:600; color:#600}\
            .msgviewtable tbody .myGray div {color:#666}\
            .msgviewtable tbody .myRein div {color:#050}\
            .msgviewtable tbody .myWarn div {font-weight:600; color:#442200}\
            </style>");
      msg.push("<div class='modal_msg_reports'>");
      var rptkeys = unsafeWindow.Object.keys(ar);
      if (matTypeof(ar) != 'array') {
        if (Options.allowAlterAR) msg.push("<div id='modal_alliance_reports_tablediv' class='modal_msg_list'><table width=675 cellpadding='0' cellspacing='0' class='msgviewtable reportviewtable alliancetable'>");
        else msg.push("<div id='modal_alliance_reports_tabledivNKA' class='modal_msg_list'><table width=675 cellpadding='0' cellspacing='0' class='msgviewtable reportviewtable alliancetable'>");
        msg.push("<thead><tr><td width=105>Date</td><td width=40>Type</td><td width=150>Attacker</td><td>Target</td><td>View</td></tr></thead><tbody>");
        for (var i = 0; i < rptkeys.length; i++) {
          var rpt = ar[rptkeys[i]];
          var colClass = '"myCol"';
          rpt.marchType = parseInt(rpt.marchType);
          rpt.side0AllianceId = parseInt(rpt.side0AllianceId);
          var targetDiplomacy = getDiplomacy (rpt.side0AllianceId);
          if (rpt.marchType == 2){
            colClass = '"myCol myRein"';
          } else if (rpt.side1AllianceId != myAllianceId){
            colClass = '"myCol myHostile"';
          } else {
            if (parseInt(rpt.side0TileType) < 50){          // if wild
              if (parseInt(rpt.side0PlayerId) == 0) colClass = '"myCol myGray"';
              else colClass = '"myCol myWarn"';
            } else if (parseInt(rpt.side0PlayerId) == 0) {   // barb
              colClass = '"myCol myGray"';
            } else {
              if (targetDiplomacy == 'friendly') colClass = '"myCol myWarn"';
            }
          }
          msg.push ('<tr valign=top');
          if (i%2 == 0) msg.push(" class=stripe");
          msg.push("><TD class="+ colClass +"><div>");
          msg.push(unsafeWindow.formatDateByUnixTime(rpt.reportUnixTime));
          msg.push ('<BR>Rpt #');
          msg.push (rpt.reportId);          
          msg.push("</div></td><TD class="+ colClass  +"><div>");
          if (rpt.marchType == 1) msg.push (unsafeWindow.g_js_strings.commonstr.transport);
          else if (rpt.marchType == 3) msg.push (unsafeWindow.g_js_strings.commonstr.scout);
          else if (rpt.marchType == 2) msg.push ('Reinf');
          else msg.push (unsafeWindow.g_js_strings.commonstr.attack);

          // attacker ...
          msg.push ("</div></td><TD class="+ colClass +"><div>");
          if (parseInt(rpt.side1PlayerId) != 0) msg.push(escape(playerNames["p" + rpt.side1PlayerId]))
          else msg.push ('?Unknown?');
            msg.push (' ');
            msg.push (coordLink(rpt.side1XCoord, rpt.side1YCoord));
            msg.push ('<BR>');
          
          if (rpt.side1AllianceId != myAllianceId){
            msg.push (allianceNames['a'+rpt.side1AllianceId]);
            msg.push (' (');
            msg.push (getDiplomacy(rpt.side1AllianceId));
            msg.push (')');
          } else {
            msg.push ('<BR>');
          }
          msg.push ('</div></td>');

          // target ...
          msg.push ("<TD class="+ colClass  +"><DIV>");
          var type = parseInt(rpt.side0TileType);

          if (type < 50){                              // wild
            msg.push(unsafeWindow.g_mapObject.types[type].toString().capitalize());
            msg.push(" Lvl " + rpt.side0TileLevel)
            if (parseInt(rpt.side0PlayerId) != 0) {   // IF OWNED, show owner ...
              msg.push (' [');
              msg.push (escape(playerNames["p" + rpt.side0PlayerId]));
              msg.push ('] ');
            }
          } else {
            if (parseInt(rpt.side0PlayerId) == 0) {   //  barb
              msg.push(unsafeWindow.g_js_strings.commonstr.barbariancamp);
              msg.push(" Lvl " + rpt.side0TileLevel)
            } else {        // city
              msg.push (escape(playerNames["p" + rpt.side0PlayerId]));
              msg.push (' - ');
              msg.push (cityNames['c'+ rpt.side0CityId]);
            }
          }
          msg.push (' ');
          msg.push (coordLink(rpt.side0XCoord, rpt.side0YCoord));
          if (rpt.side0AllianceId!=0 && rpt.side0AllianceId!=myAllianceId){
            msg.push ('<BR>');
            msg.push (allianceNames['a'+rpt.side0AllianceId]);
            msg.push (' (');
            msg.push (targetDiplomacy);
            msg.push (')');
          }

          // 'view report' link ...
          //if (Options.allowAlterAR) 
          
          //msg.push("</div></td><TD class="+ colClass  +"><div><a onclick=' modal_alliance_report_view(\"");   // ONCLICK ???
          //else
          msg.push("</div></td><TD class="+ colClass  +"><div><a onclick=' $(\"modal_alliance_reports_tabledivNKA\").id=\"modal_alliance_reports_tablediv\"; modal_alliance_report_view(\"");   // ONCLICK ???
          msg.push(rpt.reportId);
          msg.push('",');
          if (parseInt(rpt.side1AllianceId) == parseInt(Seed.allianceDiplomacies.allianceId)) msg.push(1);
          else msg.push(0);
          msg.push(",");
          msg.push(rpt.side0TileType);
          msg.push(",");
          msg.push(rpt.side0TileLevel);
          msg.push(",");
          msg.push(rpt.side0PlayerId);
          msg.push(',"');
          if (parseInt(rpt.side0PlayerId) != 0) msg.push(escape(playerNames["p" + rpt.side0PlayerId]));
          else msg.push(unsafeWindow.g_js_strings.commonstr.enemy);
          msg.push('","');
          if (parseInt(rpt.side0PlayerId) != 0) msg.push(escape(playerNames["g" + rpt.side0PlayerId]));
          else msg.push(0)
          msg.push('","');
          if (parseInt(rpt.side1PlayerId) > 0) msg.push(escape(playerNames["p" + rpt.side1PlayerId]));
          msg.push('","');
          if (parseInt(rpt.side1PlayerId) != 0) msg.push(escape(playerNames["g" + rpt.side1PlayerId]));
          msg.push('",');
          msg.push(rpt.marchType);
          msg.push(",");
          msg.push(rpt.side0XCoord);
          msg.push(",");
          msg.push(rpt.side0YCoord);
          msg.push(",");
          msg.push(rpt.reportUnixTime);
          msg.push(",");
          if (parseInt(rpt.reportStatus) == 2) msg.push(1);
          else msg.push(0);
          if (rpt.side1XCoord) {
            msg.push(",");
            msg.push(rpt.side1XCoord);
            msg.push(",");
            msg.push(rpt.side1YCoord)
          } else {
            msg.push(",,");
          }
          msg.push(");return false;'>View</a></div></td></tr>");
        }
        msg.push("</tbody></table></div>");
      }
      msg.push("</div><div id='modal_report_list_pagination'></div>");
      document.getElementById('allianceContent').innerHTML = msg.join("");
      if (pageNum) unsafeWindow.ctrlPagination("modal_report_list_pagination", totalPages, "allianceReports", pageNum)
       else unsafeWindow.ctrlPagination("modal_report_list_pagination", totalPages, "allianceReports")
    }
  },

};


var DispReport = {
  init : function (){
    var t = DispReport;
    t.modal_InboxFunc = new CalterUwFuncTools ('modal_messages_listshow', [['msghtml.join("");', 'msghtml.join("");dispInbox_hook(rslt,boxType,msghtml);']]);
    unsafeWindow.dispInbox_hook = t.ModalInboxHook;
    t.modal_InboxFunc.setEnable (true);
    t.modal_RptFunc = new CalterUwFuncTools ('Messages.handleListReports', [['n.join("");', 'n.join("");dispRpt_hook(l,n);']]);
    unsafeWindow.dispRpt_hook = t.ModalReportListHook;
    t.modal_RptFunc.setEnable (true);
  },
  setEnable : function (tf){
    var t = DispReport;
    t.modal_InboxFunc.setEnable (tf);
  },
  isDispReportAvailable : function (){
    var t = DispReport;
    return t.modal_InboxFunc.isAvailable();
  }, 
  ModalInboxHook : function (rslt,boxType,msghtml){
    var t = DispReport;
    /*if(boxType == 'inbox'){
    msgBody = document.getElementByClass('modal_msg_list');
    var a = document.createElement('a');
      a.className='buttonDown20';
      a.innerHTML='<span>Delete Gift Report</span>';
      //a.innerHTML = '';
      //<SPAN onclick="PTpd(this, '+ u.userId +')"><A>'+unsafeWindow.g_js_strings.modaltitles.memberdetails+'</a>
      //a.innerHTML='<onclick="checkinbox();return false;""><A>Delete Gift messages</a>';
      //a.innerHTML = '<a class="buttonDown20" onclick="checkinbox(this);return;false;"><span>Delete gift messages</span>';
      a.style.cssText = 'position:absolute;left:22px';
      a.addEventListener('click', t.checkinbox, false);
    var div = document.createElement('span');
    div.appendChild(a);
    msgBody.appendChild(div);
    var mml = document.getElementById('modal_msg_list');
    if (mml != null)
      mml.style.minHeight = '100px';
  }*/
  },
  checkinbox : function(){
    var t = DispReport;
    var body = document.getElementById('tbl_messages');
    var trs=body.getElementsByTagName('tr');
    var reports = [];
    for(var i=0; i<trs.length; i++){
      var tds = trs[i].getElementsByTagName('td');
      for(var j=0; j<tds.length; j++){
      if(tds[j].className == 'chkcol') var checkbox = tds[j];
      if(tds[j].className == 'nmcol') var sender = tds[j];   
      if(tds[j].className == 'subjcol') var subject = tds[j];    
    }
    reports.push({checkbox:checkbox,sender:sender,subject:subject});
  }
  t.parseGiftReport(reports);
  },
  parseGiftReport : function(rpts){
    var t = DispReport;
    for(var i=0; i<rpts.length; i++) if(rpts[i].subject.innerHTML.indexOf('New Gift Received!') >= 0 && rpts[i].sender.innerHTML.indexOf('Kingdoms Of Camelot') >= 0) rpts[i].checkbox.firstChild.checked = true;  
    unsafeWindow.messages_action("delete","tbl_messages"); 
  },
  ModalReportListHook : function (rslt, msghtml){
    var t = DispReport;
    unsafeWindow.PopupReport = ReportFetch;
    unsafeWindow.PostChatReport = t.PostChatReport;
    if(rslt.ok){
    var body = document.getElementById('modal_msg_reports_tablediv');
      var trs=body.getElementsByTagName('tr');
      for(var i=0; i<trs.length; i++){
      var tds = trs[i].getElementsByTagName('td');
      for(var j=0; j<tds.length; j++){
        if(tds[j].className == 'chkcol') var checkbox = tds[j]; 
        if(tds[j].className == 'nmcol'){
          var type = tds[j].innerHTML;
          type = type.replace("<div>","");
          type = type.replace("</div>","");
        }
        if(tds[j].className == 'subjcol'){
          var original = tds[j].innerHTML;
          var target = "";
          original = original.replace("<div>","");
          original = original.replace("</div>","");
          var popup = original.replace("View Report","Pop-up");
          popup = popup.replace("Messages.viewMarchReport","PopupReport");
          var chat = original.replace("View Report","Post");
          chat = chat.replace("Messages.viewMarchReport","PostChatReport");       
          var newContent = original + " | " + popup + " | " + chat;
          var test = popup.replace("<a onclick=\"PopupReport(","");
          test = test.replace(");return false;\">Popup</a>","");
          test = test.replace(/&quot;/g,"");
          var info = test.split(",")
          var notBarb = true;
          if (info[1] == 1 && info[5] == "Enemy") notBarb = false;
          var attack = false;
          if (info[9] == 3 || info[9] == 4) attack = true;
          if (notBarb && attack) tds[j].innerHTML = "<DIV>" + newContent + "</div>";
          if (info[5] != undefined && info[5] != "Enemy") target = ' / (' + info[5] + ')';
        }
      }
      for(var j=0; j<tds.length; j++) if(tds[j].className == 'nmcol') tds[j].innerHTML = "<DIV>" + type + target + '</div>';
    }
  }
  },
  PostChatReport : function(rpts){
    var t = DispReport;
    var msg = 'Report No: ' + rpts; 
    sendChat ("/a "+  msg);
  },
  checkreportlist : function(){
    var t = DispReport;
    var body = document.getElementById('modal_msg_reports_tablediv');
    var trs=body.getElementsByTagName('tr');
    var reports = [];
    for(var i=0; i<trs.length; i++){
      var tds = trs[i].getElementsByTagName('td');
      for(var j=0; j<tds.length; j++){
        if(tds[j].className == 'chkcol') var checkbox = tds[j];  
        if(tds[j].className == 'nmcol') var type = tds[j];  
        if(tds[j].className == 'subjcol') var view = tds[j];
      }
      reports.push({checkbox:checkbox,type:type,view:view});
    }
    t.parseBarbReport(reports);
  },
  
  parseBarbReport : function(rpts){
    var t = DispReport;
    var regex = /Messages.viewMarchReport\((["0-9]+),(["0-9]+),(["0-9]+),(["0-9]+),(["0-9]+),("[^"]+"),("[^"]+"),("[^"]+"),("[^"]+"),(["0-9]+),(["0-9]+),(["0-9]+),(["0-9]+),(["0-9]+),(["0-9]+),(["0-9]+),(["0-9]+),(["0-9]+)\)/;
    for(var i=0; i<rpts.length; i++){
    var m = regex.exec(rpts[i].view.innerHTML);
    if(m){
      if(m[6]==m[8] && m[7]==m[9]){ //Source and target id the same.
        // continue; //Infer transport to self
      } else if(m[5] != 0) {
        continue;
      }
      rpts[i].checkbox.firstChild.checked = true;
    }
  }
  unsafeWindow.Messages.deleteCheckedReports();
  }

};

var OutgoingMarches = {
	active:false,	
	init: function(){
		var t = OutgoingMarches;
		unsafeWindow.cancelMarch = t.butcancelmarch;
		unsafeWindow.pr56Recall = t.butRecall;
    	unsafeWindow.r8x6Home = t.butSendHome;
    	unsafeWindow.button_sacrifice = t.doSacrificeQ;
		paint = new pbPopup ('pbmarches', 50, 50, 1100, 550, true, OutgoingMarches.close);
		paint.centerMe (mainPop.getMainDiv);
		paint.getMainDiv().innerHTML = '<DIV><INPUT id=MarchingRaids type=checkbox checked=true>&nbspHide Raids.</div><DIV id=marchesBody style="height:500px; max-height:500px	; max-width:1100px; overflow:auto"></div>';
		paint.getTopDiv().innerHTML = "<CENTER><b>Outgoing Marches</b></center>";
		if (OutgoingMarches.active){
			paint.show(false);
			OutgoingMarches.active=false;
		} else {
			paint.show(true);
			OutgoingMarches.active=true;
		}	
	},
	show: function(){
		var t = OutgoingMarches;
		var updatemarch = Seed.queue_atkp;
		var m='<TABLE id=pdmarches cellSpacing=10 class=pbTab>';
     	for (var c=0; c< Seed.cities.length;c++) {
	        cityname = Seed.cities[c][1];
	        cityID = 'city' + Seed.cities[c][0];    
	        number=0;         
	        var Counter=0;
	        var check = true;
	        for (k in Seed.queue_atkp[cityID]) if (Seed.queue_atkp[cityID].length !=0) if (parseInt(Seed.queue_atkp[cityID][k]["marchType"])!=9) Counter++;
	        if (document.getElementById('MarchingRaids').checked && Counter==0) check=false;
	        if (Seed.queue_atkp[cityID].length !=0 && check) m+= '<TR><TD colspan=5 style=\'background: #335577;\' align=center><B><FONT color=white>' + cityname +': </font></b></td></tr>';
	          for (k in Seed.queue_atkp[cityID]){
	          if (Seed.queue_atkp[cityID].length !=0) {
	              var marchID = new String(k);
	              marchID = marchID.substr(1);
	              var marchType = parseInt(Seed.queue_atkp[cityID][k]["marchType"]);
	              if (document.getElementById('MarchingRaids').checked && marchType ==9) continue;
	              var marchStatus = parseInt(Seed.queue_atkp[cityID][k]["marchStatus"]);
	              var now = unixTime();
	              cityTo = null;
	              number++;
	              var icon, status, type, cityTo, knight, marchtime;          
	              for (var i=0; i<Seed.cities.length;i++) if (Seed.cities[i][2] == Seed.queue_atkp[cityID][k]["toXCoord"] && Seed.cities[i][3] == Seed.queue_atkp[cityID][k]["toYCoord"]) cityTo = Seed.cities[i][1];
	              var destinationUnixTime = Seed.queue_atkp[cityID][k]["destinationUnixTime"] - now;
	              var returnUnixTime = Seed.queue_atkp[cityID][k]["returnUnixTime"] - now;
	              var encampedUnixTime = now - Seed.queue_atkp[cityID][k]["destinationUnixTime"];
	              var restingUnixTime = now - Seed.queue_atkp[cityID][k]["returnUnixTime"];
	              if (Seed.queue_atkp[cityID][k]["destinationUnixTime"] > now) marchtime = timestr(destinationUnixTime, true);
	               else marchtime = timestr(returnUnixTime, true);
	              if (Seed.queue_atkp[cityID][k]["destinationUnixTime"] < now && marchType == 2) marchtime = timestr(encampedUnixTime, true);
	              if (Seed.queue_atkp[cityID][k]["returnUnixTime"] < now && marchType == 9) marchtime = timestr(restingUnixTime, true);
	              if (Seed.queue_atkp[cityID][k]["destinationUnixTime"] < now || marchStatus == 8) type = "returning";
	               else type = "going";
	            if(Seed.queue_atkp[cityID][k]["destinationUnixTime"] < now){
	              if (marchStatus == 8) marchtime = timestr(returnUnixTime, true);
	              if (type =="returning" && marchType == 2 && marchStatus != 2) marchtime = timestr(returnUnixTime, true);
	              if (type =="returning" && marchType == 4 && marchStatus == 2) marchtime = timestr(returnUnixTime, true);
	              if (marchStatus == 2 && marchType !=2) marchtime = timestr(returnUnixTime, true);
	            }
	            if (parseInt(Seed.queue_atkp[cityID][k]["marchType"]) == 4 && marchStatus == 2) marchtime = timestr(destinationUnixTime, true);;
	            if (type =="returning" && marchType != 2) marchType = 8;
	            if (type =="returning" && marchType == 2 && marchStatus == 2) marchType = 102;
	            if (type =="returning" && marchType == 2 && marchStatus != 2) marchType = 8;
	            if (marchStatus == 3) marchType = 103;
	            if (marchStatus == 4) marchType = 104;
	          
	          
	              if (parseInt(Seed.queue_atkp[cityID][k]["marchType"]) == 4 && marchStatus == 2) {
		              marchType = 102;
		              marchtime = timestr(encampedUnixTime, true)
	              }
	  
	              switch (marchType) {
	                case 1: icon="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/transporting.jpg";status=unsafeWindow.g_js_strings.commonstr.transport;break;
	                case 2: icon="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/reinforce.jpg";status=unsafeWindow.g_js_strings.commonstr.reinforce;break;
	                case 3: icon="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/scouting.jpg";status=unsafeWindow.g_js_strings.commonstr.scout;break;
	                case 4: icon="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/attacking.jpg";status=unsafeWindow.g_js_strings.commonstr.attack;break;
	                case 5: icon="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/transporting.jpg";status=unsafeWindow.g_js_strings.commonstr.reassign;break;
	                case 8: icon="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/returning.jpg";status=unsafeWindow.g_js_strings.commonstr.returning;break;
	                case 9: icon="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/attacking.jpg";status=unsafeWindow.g_js_strings.commonstr.raid;break;
	                case 10: icon="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/attacking.jpg";status=unsafeWindow.g_js_strings.commonstr.attack;break;
	                case 102: icon="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/reinforce.jpg";status=unsafeWindow.g_js_strings.commonstr.encamped;break;
	                case 103: icon="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/autoAttack/raid_stopped_desat.png";status=unsafeWindowg_js_strings.attack_generatequeue.raidstopped;break;
	                case 104: icon="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/autoAttack/raid_resting.png";status=unsafeWindow.g_js_strings.attack_generatequeue.raidresting;break;
	              } 

	              if (Seed.queue_atkp[cityID][k]["knightId"] !=0){
	                for (i in Seed.knights[cityID]) if (i == ("knt" + Seed.queue_atkp[cityID][k]["knightId"]) ) knight = Seed.knights[cityID][i]["combat"];
	              } else knight = null;
	              
	              m += '<TR><TD>'+ number +'</td>';
	             if (status=="Encamped" && !t.isMyself(Seed.queue_atkp[cityID][k].fromPlayerId)) m += '<TD><A onclick="r8x6Home('+ marchID +')"><img src='+ icon +'></a></td><TD width=25px><div id="skull'+marchID+'"></div></td>';
	              else if (status=='Encamped' && t.isMyself(Seed.queue_atkp[cityID][k].fromPlayerId)) m += '<TD><A onclick="pr56Recall('+ marchID +')"><img src='+ icon +'></a></td><TD width=25px><div id="skull'+marchID+'"></div></td>';
	              else if(status=='Returning' || status=="Stopped" || status=="Resting") m += '<TD><img src='+ icon +'></td><TD width=25px><div id="skull'+marchID+'"></div></td>';
	             else m += '<TD><A onclick="cancelMarch('+ marchID +')"><img src='+ icon +'></a></td><TD width=25px><div id="skull'+marchID+'"></div></td>';
	              m += '<TD width="40px">'+ status +'</td>';
	              m += '<TD>'+ marchtime +'</td>';
	              if (cityTo == null) m += '<TD style="padding-right:10px;">'+ coordLink(Seed.queue_atkp[cityID][k]["toXCoord"],Seed.queue_atkp[cityID][k]["toYCoord"]) + '</td>';
	              else m += '<TD style="padding-right:10px;">'+ cityTo +'</td>';      
	              if (knight != null)  m += '<TD width=20px><img width=20px src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/70/221.jpg></td><TD>'+ knight +'</td>';       
	              else m += '<TD width=20px><img  width=20px src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/70/221.jpg></td><TD>---</td>';   
	              var types = {10:"grasslands",11:"lake",20:"forest",30:"hills",40:"mountain",50:"plains",54:"boss"};
	              if (Seed.queue_atkp[cityID][k]["toTileType"]!=51) {
						if (Seed.queue_atkp[cityID][k]["toTileLevel"]>=1 && Seed.queue_atkp[cityID][k]["toTileLevel"]<=3) var Tlevel = 1;
						if (Seed.queue_atkp[cityID][k]["toTileLevel"]>=4 && Seed.queue_atkp[cityID][k]["toTileLevel"]<=6) var Tlevel = 4;
						if (Seed.queue_atkp[cityID][k]["toTileLevel"]>=7) var Tlevel = 7;
	              		m+='<TD><img height=25px src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/buildings/'+types[Seed.queue_atkp[cityID][k]["toTileType"]]+'_lvl'+Tlevel+'.png></td><TD>' + Seed.queue_atkp[cityID][k]["toTileLevel"] + '</td>';
	              } else {
	              	if (Seed.queue_atkp[cityID][k]["botSettingsId"]!=null){
	              		if (Seed.queue_atkp[cityID][k]["toTileLevel"]>=1 && Seed.queue_atkp[cityID][k]["toTileLevel"]<=3) var Tlevel = 1;
						if (Seed.queue_atkp[cityID][k]["toTileLevel"]>=4 && Seed.queue_atkp[cityID][k]["toTileLevel"]<=6) var Tlevel = 4;
						if (Seed.queue_atkp[cityID][k]["toTileLevel"]>=7) var Tlevel = 7;
	              		m+='<TD><img height=25px src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/buildings/barbarian_lvl'+Tlevel+'.png></td><TD>' + Seed.queue_atkp[cityID][k]["toTileLevel"] + '</td>';         	 
	              	 }else {
	              	 	if (Seed.queue_atkp[cityID][k]["toTileLevel"]>=1 && Seed.queue_atkp[cityID][k]["toTileLevel"]<=2) var Tlevel = 1;
	              		if (Seed.queue_atkp[cityID][k]["toTileLevel"]>=3 && Seed.queue_atkp[cityID][k]["toTileLevel"]<=4) var Tlevel = 3;
	              		if (Seed.queue_atkp[cityID][k]["toTileLevel"]>=5 && Seed.queue_atkp[cityID][k]["toTileLevel"]<=6) var Tlevel = 5;
	              		if (Seed.queue_atkp[cityID][k]["toTileLevel"]>=7 && Seed.queue_atkp[cityID][k]["toTileLevel"]<=9) var Tlevel = 7;
	              		if (Seed.queue_atkp[cityID][k]["toTileLevel"]=10) var Tlevel = 10;
	              		if (Seed.queue_atkp[cityID][k]["toTileLevel"]>=11) var Tlevel = 11;
	              	 	m+='<TD><img height=25px src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/buildings/castle_lvl'+Tlevel+'_26.png></td><TD>' + Seed.queue_atkp[cityID][k]["toTileLevel"] + '</td>';
	              	}
	              }
	              if (Seed.queue_atkp[cityID][k]["gold"] > 0) m += '<TD width=25px><img width=25px src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/gold_30.png></td><TD>'+ addCommas(Seed.queue_atkp[cityID][k]["gold"]) +'</td>';
	              if (Seed.queue_atkp[cityID][k]["resource1"] > 0) m += '<TD width=25px><img width=25px src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/food_30.png></td><TD>'+ addCommas(Seed.queue_atkp[cityID][k]["resource1"]) +'</td>';
	              if (Seed.queue_atkp[cityID][k]["resource2"] > 0) m += '<TD width=25px><img width=25px src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/wood_30.png></td><TD>'+ addCommas(Seed.queue_atkp[cityID][k]["resource2"]) +'</td>';
	              if (Seed.queue_atkp[cityID][k]["resource3"] > 0) m += '<TD width=25px><img width=25px src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/stone_30.png></td><TD>'+ addCommas(Seed.queue_atkp[cityID][k]["resource3"]) +'</td>';
	              if (Seed.queue_atkp[cityID][k]["resource4"] > 0) m += '<TD width=25px><img width=25px src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/iron_30.png></td><TD>'+ addCommas(Seed.queue_atkp[cityID][k]["resource4"]) +'</td>';
	              
	              for(i=1; i<15; i++){
	            if(Seed.queue_atkp[cityID][k]["unit"+i+"Count"] > 0 && type == "going") m += '<TD width=25px><a class=hasTooltip><img width=25px src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+i+'_30_s34.jpg?6545><SPAN>'+unsafeWindow.unitcost['unt'+i][0]+'</span></td><TD>'+ addCommas(Seed.queue_atkp[cityID][k]["unit"+i+"Count"]) +'</td>';
	            if(Seed.queue_atkp[cityID][k]["unit"+i+"Return"] > 0 && type == "returning") m += '<TD width=25px><a class=hasTooltip><img width=25px src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+i+'_30_s34.jpg?6545><SPAN>'+unsafeWindow.unitcost['unt'+i][0]+'</span></td><TD>'+ addCommas(Seed.queue_atkp[cityID][k]["unit"+i+"Return"]) +'</td>';
	          }
	          m += '</tr>';
	        }
	          }
    	}
    	m += '</table></div>';
    	document.getElementById('marchesBody').innerHTML = m;
    	for (var c=0; c< Seed.cities.length;c++) if (Seed.queue_atkp['city' + Seed.cities[c][0]].length !=0) for (k in Seed.queue_atkp['city' + Seed.cities[c][0]]) t.PaintSacrifice(k,c);
	},
	PaintSacrifice: function(k,c){
		var marchID = new String(k);
	    var now = unixTime();
	    marchID = marchID.substr(1);
	    skull_black="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAXCAYAAADgKtSgAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3QMPChAJQz7g9AAABU9JREFUSMetlX9s1OUdx1/fn6V31/YoeBx3spIaQO+aO7JCCcxqrS6K2FoVDdP9Q9mUCP4j1GjDjIhmW3SGzdGhBMGKNVAkaBVpmUxo4draWpe2p85IBsX2Cty1G3ftfe/H99kflW80aDeTff57kuf9yvvzPJ8f8AMhhPjO+ZmtT8unQ53aM1uflqe79+2Q+C8xHBm91263l6uK4kWSchFiMpPJfp1IxNs9c92HptNeBZ+YNFi2rExqbm5+yOl07gwPDtpaWlqkcHiQ8fFxCgqc+Hw3cFdVtfD5fBPjY2Pr16xe/WZHV5fIz3NMD+/s6nZ7PJ6Xe3o+Xr1r1y4GBwbQc3QkJOsJTNPEMAxK/CX8+uGH+Wlp6cHh4eHHbvzZisj3wmNj4wwODroCgUDb8889Fzxy5H1M0ySVSuGZ66GsrAxngZNoLEooFGL0wiiqqqIoCivvXEV9ff3f+/v7b190/fWj3rnuq53/8+y5fa/s3PnQwYPNaJrGjBkzWLd2HTU1NWCCQCBJUxk0vdVE475GkskkqVSK1fffzyOPrH9z0cIFv7ScD4TDlPh8hDpDd0ejY4frn3qSbDaLw+7g2a3PEgwESSaTV31Wbm4unV2d1G+pJ5lMIssyv/3d7ymcWVhTWVnxTndPD3KJzweA1zvv1X1vNJJOpxFC8OAvHmTRwkXfCwaYnJwkGAiy5oE1mKZJOp3mjcbX8V7rfRWgbMkSZIBQZ1dlNBp1hU6fBsBms1G2tAwAWZZRFOU7YE3TUFUVgOXLl5Obm4skSZw6dYpoNOr620cfVQJTcJfLtaKttU0oqooQAl3T8Xg8KIpC/0A/oc4Quq4DoOs6u1/bTct7LaiqimeuB13XMU0TVVVpa20Ts2e7VgCo3wiKvvjiM0mWZYQQCASqqjI0NETtr2oRQtDwcgPl5eUcaD7Ajr/sIJ1O4/f7meOaY5WoLMt8/vlnkq5rRZZzAbZEIjEFFgLDMIiMRshkMqiqikCABMIUzJs3D03TcF3jwmF3MDIygmEYljaeiCMENsu5MZm87HTOxDRNZFkmHo/T3d3NyjtWsr9pP5lMhvnz55POpFkcXMzR948iyzI2m43WtlauGDNNk5lOJ4ZhXLacR8diXwWDQXGlUrLZLHsb9zJ6YZSinxRRXFxMMplk2/PbuHTpEnl5edjtdiKRCHte34NpmgCk02kCwcVibCz2lQVvP3ni5E03V0iKoljpnT9/noadDeg5OkIIYrEYTqeTkZERZFlG0zSOfXiMaDRqjQRVVamoqJA62jtOWvC6zZu74vHL4TtXrSKbzQKgKAoXL15ElmRM08Tr9fLo+kcJBAJWLzjyHJYZ0zSpqq4mHk+Et2yp77LgAE1NTRuqq2uw2+2WIJlMkjWzHDp0CEmS+KD1A1KpFB2nOhgeHsY2w2ZVisPhoKqqmuYD+zdcYVrwP/1x+4lEIr590+Y6EonE1DCLxYjH4/T29ZKTk8PQ0BCSJJGYSPBJ3yccOXoETdOYmEiwue4JJiYmtzc07DjxQyPX2d5x+u0vv/xH5R9efIFYLAZAfn4B99xTQ19fH263m0/7PuXsubNomkZhYSGbNtWxYOHC47dU3HQfMD7dJnLu3dv4m9nXzH78r8eO8c67h4lFYwgx1VjZbBYhBLNmzaKqqppbb/s50UsXX6qtXbvt2+Dp1pxcWXlr+YaNG18oLr5u6UB/vwiHw9K//j1Ofn4Bfr9f+P0l0pkzZz5u2PHnuuPHP2wHzB+9Q0tLl5SurV13o9vtLsrJyXEYhhGPRCJn97y2u6O3t6eX/1NI3xSA9L8K/gPuSXqQgNsvBgAAAABJRU5ErkJggg==";
		skull_green="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAXCAYAAADgKtSgAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3QMPChAq4VmRhgAABUtJREFUSMetlX1s1PUdx1/f7+93d+V65a4qfbijbZhQ2wIFLbROwczrFOJmfGqim2Yw+08XWJbN4B+oiBr/WBaRQcY2gjKpgARhki1gJNZS1OvRAoXWOm0oQh9oD7iHXq93v3v4/vzj8IZBuy3ZJ/n+8U0+71c++TzC95hpmt/6b3xpg/zU12nZ+NIGOZ3f9Sb4DzY6Eng0P8+xXJe6ByFmYJrxtMqMxBLR425P0cHptDfAp+IGDQ1Lxf797z7pcrr+0j/UY/9nT6voD5wgHIrgcjmpct/OT+evNmvKFk+Fw+GWJ5oe3f2x/4Q5s8AxPbyz60SJu8iztftCe9MO3yv0Bf+FTQchrnmb2WekYf7NVTTf+Ry3e+55dzQw/OtlP7x77DvhwVCYzz7vK6qdV/fBq0daFh0ZaEWhSGbAneeh3tOI0zqLoDGG/+JRApkAVglSSFbe+hTrGrec6Tt3esVtldXjntKSGyP/anD47b/6Njx5sP9NdA3ytBk8veBFHr5jFQiFaZoIITEV7O3ayt7PX8dQCdIKHqpcRfPSF3bfVj33qVzkff39LKipwdfpeyioRt9b//7jZEjj0Ap5uXEXteUNJFJTNxRrhjUf/0A7G9t/QZI4Ep2N3lZcqvRhr/dHh050dyMX1NQA4HGXbW/t2kTKTAPws8W/obJ04XeCAeLJGLUVS2la2IJpQtpMs+/UFjwez3aA+iVLkAA+n997NXK5qHPoE6SAfMtM6t0/BkBKDU1q3wLrmgVd6gA0lN2H3ZKPFOAf93F14nJRW9sxL5CFzyosueuDL/aZFltWbNXycDsr0KRG3/lu/APtWHUbYGKVNnZ1buJw7zvomk6JvQKLzMvqdGgbPGDe4iq+C0AHsFltFQOX+oR23expUmf48nlajjwCGmwy32Z5zQoOntrBjjOvkVJQVXQHxY7Zua6QEgZGPxPW+ZaKHNxU2Kf0EMLM9k8qkyQQHSEtDCwS0mmQFlBK4XHNwaLAZbHjsDkZn7pIUhm51jNsYcyMsOfgRjIRdWXcfLMlYqkIXSNtrKh+nLea2smk0lQUzyWtUtTOvpMDq84ihcRuddDWc4Cp1CRCgEqDI1qKkYpHczm/GrpyrraswUyrLFxhsrvndQITI5TfcitzSioxUgl+f/i3XJkYpyDPSb6tgPHQKO+c3QImqLgkGYQFnnozFAmey8E7Pj3WsWzeA0JT/x7bscQlth9/FZtmwwSC0SsU3lTIWGQYKSQW3cpHPYcJxSZRUZ1MREMmJHdX3y8+8R3vyMGfXfeMf3Jisn9FZRPqWm40ICRGEUiUSuO+qYzm+vUsLF9CKpPCVAqHvQAVATUpUWnF/YubmJyI9T///Hp/Dg6wZ++eNT+Z9zT5ekEu/KRhkEmb/KO3FSEER3sOkUwZdH7ZxqXwMDMs+WQSWfd8i5OVNT9n//59a75h5uBb/rj5WHQssXntoteYSoAUEIwHmIxNcGbUh1XLYyQ8iNQksXiM01/6Odr3d6y6ZMpI8qvGl4ldNTZv2/anY9+3cl0dHb4D54O93j/3riOSjGBmwIGTB8pXc3bIT7FzNr1DfoYjQ+gSCu2zaLn3RebevKjtXu/yx4DwdJfItXPnrheK5rh+1/HVIY707SEciaOS2ToolV3prjwHK2uf4J6qB7l8MbSpuXn1K9eDpztz0uttXL5m7do//GDO3KX9F06bXwROiWgsgsM+k6riOrO6fLEYPD/YtW3b1nVtH354HFD/8w2tq1tS98vVzcuKi0orbDabwzCMyfHApQs7//bGxydPdp/k/2TiWgOI/1bwNTuZNLcj/9KGAAAAAElFTkSuQmCC";
		skull_red="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAXCAYAAADgKtSgAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3QMPCg4rQh+ezwAABRRJREFUSMetlWlsVFUcxX9vmaXDtNOp0G1aK5uhBcRCaw1I1DaI+gVUVIwNKOoHRCSIihpKIO4asIDygQCRlNUUBUJQa4pdlLbYCsVSF/bpTHeYLrP3zbt+aDuWqKiJJ3nJu8m9J+fe//+cP/wNhBDXrdetXyufqKk1rFu/Vr7RvpGQ+Ae0dHQ+bLJaZ0uq6pCRYiKIgNA0d8jrrb45KfFz/gv8gRBTb5sm/fLrb4VtHZ3eH78u00sXLRY7J08WGx0OsX/SJHH0yUJx6suvdHdbu7e5+efCaZlZUl+/95+Vn6w7mZzocGxpq65ecP7tt/A3NWECDMAoYPhNQoBpUiaJRUUkzJpV2u1yLZ9516z2vyS/5unh56amxPHTp5fVrnhxmqekBCIRJE0jxpGGrSAfefRotI4u+r8pw9TZgQzoioypcBGZxcWNV06dmjshM7PDkZL85ye54GzZXbp0qfgUxC5VFQesVlH23gfiiqtNOJ1u4bziEk5nq7jU0iqOrVkrDpvN4giIIyCOLlkizp47v/s65U3NzUzJyqKmtmae0d126Ezhk5jDYYw2G+N27mJMXh6a3/8nIaplFK6qCtxPL8bg96OrKiklJfiSUubn599z+GR9PfKUrCwAUh3p285vKsYWCBCj69y0YiX2qVP/khhA8/tIzsklfukyBCBrGh2bNpOa5tgGcEdOzmB9TtTW5fd3dSVKVVWogBIbh/2eewevpihIinIdsWwwIKkqAPaCAqRRVgCCtTX0d3cnlldU5jNcfFty8sy20lJhHj5sNhGTkYGsKLQ11NNaUYFiNIEQYDJxsXgjLQf2I6sqys0ZSGYTAGag69AhEZeYOBNABTCYTBm+xkZppPVkVeXa5Uu4HnkIFdBK9jB2zn1c3rGd3o0b0AFr9nTUtLTrfdLYKKlGY0ZUeQQssT0eho2sh8P43W6UUCja0zFCIHQdy9ixBIGIxYJis4HTCUP7BBDX20NEYIkq1wLB/t6U1MEFEOnro7eygvQFj3JreQVaRCNh/AT0gQES8u5kxqkzIMuoVivuzw+ie71IQ0o9ScnEBoP9UeWeq90X7Hl50QiSdZ2u4o/wu93Yxo/npom3ogWDnF61En9nBwabDUNsLP2trXRu2Rx1ogDic3NFn8dzIUpeU1lZlfTAg1JwZB+3ujn7wXsopsFi+bu7SbDb8blcIMsoRiO/fXkMxfdHpgSB0XPvl05WVVdFyVe/vKqu1+dttixc+EeUAgmuFnRZRtc04tLTSXvtDcbMyEEfGEDXdeJirYwMXMPjj9Pr8zUXrXm9jhE5xL69e5eNKVyEbo1FGgqdYCjEgC5w7ykBSeL8kcNEwiE6j5fjd7VgtIyKEuvWWBIeW0jpZweWRTtu+GfzpuJKZzhYbN6wgdAQua/7Kr0+L301NchmM5FLF1AkGd3r5VJ9A30HS5GAMKC8/z4t4XDx1q2fVP5d5MZ/+33NwVDTT/nB1a8i9/QwAGg2G5ZFiwnU1WJLTSVQW4vcPpiuui0e9Z13MU2ZcnzO3bMfAXpuNInit+8qKZpot78UOvQFV/ftJSYQiF5RDH0BSwz2x57APH8e5zyejc89/dSbI4lvNObkgvyC2c8vf+HDW8ZNyO35sUH4TzdKiucqEXsCltuzhS07W7p88eIPWz/e8srx4+XVgP6fZ2jOjJwZhc88e9fo5OQMo9lsDQeD3u729iu7d2z/rr6hvoH/CcMmlP7tgd8B7KkscvxgvnAAAAAASUVORK5CYII=";	
	    var marchType = parseInt(Seed.queue_atkp['city' + Seed.cities[c][0]][k]["marchType"]);
	    var marchStatus = parseInt(Seed.queue_atkp['city' + Seed.cities[c][0]][k]["marchStatus"]);
	    
	    if (Seed.cityData.city[Seed.cities[c][0]].isPrestigeCity && Seed.cityData.city[Seed.cities[c][0]].prestigeInfo.prestigeType ==2 && Seed.queue_atkp['city' + Seed.cities[c][0]][k]["destinationUnixTime"] > now && marchType==4) document.getElementById("skull" + marchID).innerHTML = '<A onclick="button_sacrifice('+ marchID+','+ Seed.cities[c][0] +')"><img src="'+skull_black+'"></a>';
	},
	doSacrificeQ:function(marchID,city){
		paintS = new pbPopup ('pbSacrifice', 50, 50, 350, 200, true);
		paintS.centerMe (document.getElementById('marchesBody'));
		paintS.getMainDiv().innerHTML = '<DIV id=SacrificeBody style="height:180px; max-height:180px; width:350px; max-width:350px; overflow:auto">';
		paintS.getTopDiv().innerHTML = "<CENTER><b>Sacrifice</b></center>";
		paintS.show(true);

		var m ='<TABLE><TR>';

		for (var i=1;i<=15;i++){
			if (i%5==0) m+= '</tr><TR>';
			if (parseInt(Seed.queue_atkp['city' + city]['m'+marchID]['unit'+i+'Count'])>0) m+='<TD><INPUT type=checkbox id="SacrificeTroop_'+i+'"></td><TD style="width: 50px;"><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+ i +'_30_s34.jpg?6545></td>';
		}
		m+='</tr></table><BR><DIV vertical-align=center><INPUT id=DoSacrifice type=submit class=pbButton value="Sacrifice"></div>';
		document.getElementById('SacrificeBody').innerHTML = m;
	},
	butcancelmarch: function(marchID){
         var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
         params.mid = marchID;
         for (var c=0; c<Cities.numCities; c++){
           var que = Seed.queue_atkp['city'+ Cities.cities[c].id];
           if (matTypeof(que)=='array') continue;
           for (k in que){
             if (k == 'm'+marchID){
               params.cid = Cities.cities[c].id;
               break;
             }
           }    
         }    
         new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/cancelMarch.php" + unsafeWindow.g_ajaxsuffix, {
             method: "post",
             parameters: params,
             onSuccess: function (rslt) {
             var march = unsafeWindow.seed.queue_atkp["city" + params.cid]["m" + params.mid];
             march.marchStatus = 8;
              var marchtime = parseInt(march.returnUnixTime) - parseInt(march.destinationUnixTime);
              var ut = unixTime();
              if (unsafeWindow.seed.playerEffects.returnExpire > unixTime()) marchtime *= 0.5
               march.returnUnixTime = ut + marchtime;
               march.destinationUnixTime = ut;
               march.marchUnixTime = ut - marchtime;
               if (notify != null) notify(rslt.errorMsg);
             },
             onFailure: function () {
               if (notify != null) notify(rslt.errorMsg);
             },
         });
         
     },
     isMyself: function(userID){
		if(!Seed.players["u"+userID]) return false;
		if(Seed.players["u"+userID].n == Seed.player.name) return true;
		else return false;
		return false;
	},   
	butRecall : function (marchId){
    	var t = OutgoingMarches;
    	logit ("CANCELLING: "+ marchId); 
    	t.ajaxRecall(marchId); 
  	},
  	ajaxRecall : function (marchId, notify){
	    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
	    for (var c=0; c<Cities.numCities; c++){
	      var que = Seed.queue_atkp['city'+ Cities.cities[c].id];
	      if (matTypeof(que)=='array') continue;
	      for (k in que){
	        if (k == 'm'+marchId){
	          params.cid = Cities.cities[c].id;
	          break;
	        }
	      }    
	    }    
	    params.mid = marchId;
	    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/undefend.php" + unsafeWindow.g_ajaxsuffix, {
	        method: "post",
	        parameters: params,
	        onSuccess: function (rslt) {
	          var march = unsafeWindow.seed.queue_atkp["city" + params.cid]["m" + params.mid];
	          march.marchStatus = 8;
	          var marchtime = parseInt(march.returnUnixTime) - parseInt(march.destinationUnixTime);
	          var ut = unixTime();
	          if (unsafeWindow.seed.playerEffects.returnExpire > unixTime()) marchtime *= 0.5
	          march.returnUnixTime = ut + marchtime;
	          march.destinationUnixTime = ut;
	          march.marchUnixTime = ut - marchtime;
	          if (notify != null) notify(rslt.errorMsg);
	        },
	        onFailure: function () {
	          if (notify != null) notify(rslt.errorMsg);
	        },
	    });
  	},
	close: function(){OutgoingMarches.active=false}
}


var IncomingMarches = {
	active:false,	
	init: function(){
		var t = IncomingMarches;
    	unsafeWindow.button_sacrifice = t.doSacrificeQ;
		paintI = new pbPopup ('pbImarches', 50, 50, 750, 450, true, IncomingMarches.close);
		paintI.centerMe (mainPop.getMainDiv);
		paintI.getMainDiv().innerHTML = '<DIV><DIV id=IncomingmarchesBody style="height:425px; max-height:425px	; max-width:750px; overflow:auto"></div>';
		paintI.getTopDiv().innerHTML = "<CENTER><b>Incoming Marches</b></center>";
		if (IncomingMarches.active){
			paintI.show(false);
			IncomingMarches.active=false;
		} else {
			paintI.show(true);
			IncomingMarches.active=true;
		}	
	},
	show: function(){
		var t = IncomingMarches;
		var updatemarch = Seed.queue_atkp;
		var m='<TABLE cellSpacing=10 class=pbTab>';
     	var now=unixTime();
     	for (var c=0; c< Seed.cities.length;c++) {
	        number=0; 
	        var Counter=0;
	        var check = true;
	        for (k in Seed.queue_atkinc) if (parseInt(Seed.queue_atkinc[k].toCityId) == Seed.cities[c][0] && (Seed.queue_atkinc[k].marchType==3 ||Seed.queue_atkinc[k].marchType==4)) Counter++;
	        if (Counter==0) check=false;
			if (check) m+= '<TR><TD colspan=5 style="background: #335577;" align=center><B><FONT color=white>' +Seed.cities[c][1]+': </font></b></td></tr>';
	        for (k in Seed.queue_atkinc) if (parseInt(Seed.queue_atkinc[k].toCityId) == Seed.cities[c][0]  && (Seed.queue_atkinc[k].marchType==3 ||Seed.queue_atkinc[k].marchType==4)) {
	        	number++;
	        	var attack = Seed.queue_atkinc[k];
	        	m += '<TR><TD>'+ number +'</td>';
				if (attack.marchType == 3) m+= '<TD width=25;><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/scouting.jpg></td>';
				if (attack.marchType == 4) m+= '<TD width=25;><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/attacking.jpg></td>';
				m+='<TD width=25px><div id="I_skull'+attack.mid+'"></div></td>';
				m+='<TD><FONT color='+(((attack.arrivalTime-now)<30)?"red":"black")+'>'+timestr(attack.arrivalTime-now)+'</font></td>';
				m+='<TD><a class=hasTooltip>'+Seed.players['u'+attack.pid].n+'<SPAN><TABLE><TR><TD>Alliance: </td><TD>'+Seed.allianceNames['a'+Seed.players['u'+attack.pid].a];
				m+='</td><tr><TR><TD>Might: </td><TD>'+addCommas(Math.round(Seed.players['u'+attack.pid].m))+'</td></tr>';
				m+='<TR><TD>March Time:</td><TD>'+timestr(attack.arrivalTime-attack.departureTime)+'</td></tr></table></span></a></td>';
				if (attack.fromXCoord) m+='<TD>'+coordLink(attack.fromXCoord,attack.fromYCoord)+'</td>';
				else m+='<TD>???</td>';
				var Marshal = "---";
				if (Seed.leaders['city'+Seed.cities[c][0]].combatKnightId!=0) Marshal = Seed.knights['city'+Seed.cities[c][0]]['knt'+Seed.leaders['city'+Seed.cities[c][0]].combatKnightId].combat;
				if (attack.knt) m+='<TD><img width=20px src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/70/221.jpg></td><TD>'+attack.knt.cbt+'/'+Marshal+'</td>';
				 else m+='<TD><img width=20px src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/70/221.jpg></td><TD>???</td>';
				if (Seed.queue_atkinc[k]["unts"] == undefined) {
						msg +='<TR><TD>???</td></tr>'; 
				} else for (i=1;i<=15;i++) if (parseInt(attack["unts"]["u"+i]) > 0) m+='<TD width=25px><img src=http://www352.kingdomsofcamelot.com/fb/e2/src/img/units/unit_'+i+'_30_s34.jpg?6545></td><TD width=80px>' + addCommas(parseInt(attack["unts"]["u"+i])) + '</td>';			
				m += '</tr>';

	        }

    	}
    	m += '</table></div>';
    	document.getElementById('IncomingmarchesBody').innerHTML = m;
		for (var m in Seed.queue_atkinc) t.PaintSacrifice(Seed.queue_atkinc[m].mid,Seed.queue_atkinc[m].toCityId);
	},
	PaintSacrifice: function(marchID,cityID){
	    var now = unixTime();
	    skull_black="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAXCAYAAADgKtSgAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3QMPChAJQz7g9AAABU9JREFUSMetlX9s1OUdx1/fn6V31/YoeBx3spIaQO+aO7JCCcxqrS6K2FoVDdP9Q9mUCP4j1GjDjIhmW3SGzdGhBMGKNVAkaBVpmUxo4draWpe2p85IBsX2Cty1G3ftfe/H99kflW80aDeTff57kuf9yvvzPJ8f8AMhhPjO+ZmtT8unQ53aM1uflqe79+2Q+C8xHBm91263l6uK4kWSchFiMpPJfp1IxNs9c92HptNeBZ+YNFi2rExqbm5+yOl07gwPDtpaWlqkcHiQ8fFxCgqc+Hw3cFdVtfD5fBPjY2Pr16xe/WZHV5fIz3NMD+/s6nZ7PJ6Xe3o+Xr1r1y4GBwbQc3QkJOsJTNPEMAxK/CX8+uGH+Wlp6cHh4eHHbvzZisj3wmNj4wwODroCgUDb8889Fzxy5H1M0ySVSuGZ66GsrAxngZNoLEooFGL0wiiqqqIoCivvXEV9ff3f+/v7b190/fWj3rnuq53/8+y5fa/s3PnQwYPNaJrGjBkzWLd2HTU1NWCCQCBJUxk0vdVE475GkskkqVSK1fffzyOPrH9z0cIFv7ScD4TDlPh8hDpDd0ejY4frn3qSbDaLw+7g2a3PEgwESSaTV31Wbm4unV2d1G+pJ5lMIssyv/3d7ymcWVhTWVnxTndPD3KJzweA1zvv1X1vNJJOpxFC8OAvHmTRwkXfCwaYnJwkGAiy5oE1mKZJOp3mjcbX8V7rfRWgbMkSZIBQZ1dlNBp1hU6fBsBms1G2tAwAWZZRFOU7YE3TUFUVgOXLl5Obm4skSZw6dYpoNOr620cfVQJTcJfLtaKttU0oqooQAl3T8Xg8KIpC/0A/oc4Quq4DoOs6u1/bTct7LaiqimeuB13XMU0TVVVpa20Ts2e7VgCo3wiKvvjiM0mWZYQQCASqqjI0NETtr2oRQtDwcgPl5eUcaD7Ajr/sIJ1O4/f7meOaY5WoLMt8/vlnkq5rRZZzAbZEIjEFFgLDMIiMRshkMqiqikCABMIUzJs3D03TcF3jwmF3MDIygmEYljaeiCMENsu5MZm87HTOxDRNZFkmHo/T3d3NyjtWsr9pP5lMhvnz55POpFkcXMzR948iyzI2m43WtlauGDNNk5lOJ4ZhXLacR8diXwWDQXGlUrLZLHsb9zJ6YZSinxRRXFxMMplk2/PbuHTpEnl5edjtdiKRCHte34NpmgCk02kCwcVibCz2lQVvP3ni5E03V0iKoljpnT9/noadDeg5OkIIYrEYTqeTkZERZFlG0zSOfXiMaDRqjQRVVamoqJA62jtOWvC6zZu74vHL4TtXrSKbzQKgKAoXL15ElmRM08Tr9fLo+kcJBAJWLzjyHJYZ0zSpqq4mHk+Et2yp77LgAE1NTRuqq2uw2+2WIJlMkjWzHDp0CEmS+KD1A1KpFB2nOhgeHsY2w2ZVisPhoKqqmuYD+zdcYVrwP/1x+4lEIr590+Y6EonE1DCLxYjH4/T29ZKTk8PQ0BCSJJGYSPBJ3yccOXoETdOYmEiwue4JJiYmtzc07DjxQyPX2d5x+u0vv/xH5R9efIFYLAZAfn4B99xTQ19fH263m0/7PuXsubNomkZhYSGbNtWxYOHC47dU3HQfMD7dJnLu3dv4m9nXzH78r8eO8c67h4lFYwgx1VjZbBYhBLNmzaKqqppbb/s50UsXX6qtXbvt2+Dp1pxcWXlr+YaNG18oLr5u6UB/vwiHw9K//j1Ofn4Bfr9f+P0l0pkzZz5u2PHnuuPHP2wHzB+9Q0tLl5SurV13o9vtLsrJyXEYhhGPRCJn97y2u6O3t6eX/1NI3xSA9L8K/gPuSXqQgNsvBgAAAABJRU5ErkJggg==";
		skull_green="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAXCAYAAADgKtSgAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3QMPChAq4VmRhgAABUtJREFUSMetlX1s1PUdx1/f7+93d+V65a4qfbijbZhQ2wIFLbROwczrFOJmfGqim2Yw+08XWJbN4B+oiBr/WBaRQcY2gjKpgARhki1gJNZS1OvRAoXWOm0oQh9oD7iHXq93v3v4/vzj8IZBuy3ZJ/n+8U0+71c++TzC95hpmt/6b3xpg/zU12nZ+NIGOZ3f9Sb4DzY6Eng0P8+xXJe6ByFmYJrxtMqMxBLR425P0cHptDfAp+IGDQ1Lxf797z7pcrr+0j/UY/9nT6voD5wgHIrgcjmpct/OT+evNmvKFk+Fw+GWJ5oe3f2x/4Q5s8AxPbyz60SJu8iztftCe9MO3yv0Bf+FTQchrnmb2WekYf7NVTTf+Ry3e+55dzQw/OtlP7x77DvhwVCYzz7vK6qdV/fBq0daFh0ZaEWhSGbAneeh3tOI0zqLoDGG/+JRApkAVglSSFbe+hTrGrec6Tt3esVtldXjntKSGyP/anD47b/6Njx5sP9NdA3ytBk8veBFHr5jFQiFaZoIITEV7O3ayt7PX8dQCdIKHqpcRfPSF3bfVj33qVzkff39LKipwdfpeyioRt9b//7jZEjj0Ap5uXEXteUNJFJTNxRrhjUf/0A7G9t/QZI4Ep2N3lZcqvRhr/dHh050dyMX1NQA4HGXbW/t2kTKTAPws8W/obJ04XeCAeLJGLUVS2la2IJpQtpMs+/UFjwez3aA+iVLkAA+n997NXK5qHPoE6SAfMtM6t0/BkBKDU1q3wLrmgVd6gA0lN2H3ZKPFOAf93F14nJRW9sxL5CFzyosueuDL/aZFltWbNXycDsr0KRG3/lu/APtWHUbYGKVNnZ1buJw7zvomk6JvQKLzMvqdGgbPGDe4iq+C0AHsFltFQOX+oR23expUmf48nlajjwCGmwy32Z5zQoOntrBjjOvkVJQVXQHxY7Zua6QEgZGPxPW+ZaKHNxU2Kf0EMLM9k8qkyQQHSEtDCwS0mmQFlBK4XHNwaLAZbHjsDkZn7pIUhm51jNsYcyMsOfgRjIRdWXcfLMlYqkIXSNtrKh+nLea2smk0lQUzyWtUtTOvpMDq84ihcRuddDWc4Cp1CRCgEqDI1qKkYpHczm/GrpyrraswUyrLFxhsrvndQITI5TfcitzSioxUgl+f/i3XJkYpyDPSb6tgPHQKO+c3QImqLgkGYQFnnozFAmey8E7Pj3WsWzeA0JT/x7bscQlth9/FZtmwwSC0SsU3lTIWGQYKSQW3cpHPYcJxSZRUZ1MREMmJHdX3y8+8R3vyMGfXfeMf3Jisn9FZRPqWm40ICRGEUiUSuO+qYzm+vUsLF9CKpPCVAqHvQAVATUpUWnF/YubmJyI9T///Hp/Dg6wZ++eNT+Z9zT5ekEu/KRhkEmb/KO3FSEER3sOkUwZdH7ZxqXwMDMs+WQSWfd8i5OVNT9n//59a75h5uBb/rj5WHQssXntoteYSoAUEIwHmIxNcGbUh1XLYyQ8iNQksXiM01/6Odr3d6y6ZMpI8qvGl4ldNTZv2/anY9+3cl0dHb4D54O93j/3riOSjGBmwIGTB8pXc3bIT7FzNr1DfoYjQ+gSCu2zaLn3RebevKjtXu/yx4DwdJfItXPnrheK5rh+1/HVIY707SEciaOS2ToolV3prjwHK2uf4J6qB7l8MbSpuXn1K9eDpztz0uttXL5m7do//GDO3KX9F06bXwROiWgsgsM+k6riOrO6fLEYPD/YtW3b1nVtH354HFD/8w2tq1tS98vVzcuKi0orbDabwzCMyfHApQs7//bGxydPdp/k/2TiWgOI/1bwNTuZNLcj/9KGAAAAAElFTkSuQmCC";
		skull_red="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAXCAYAAADgKtSgAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3QMPCg4rQh+ezwAABRRJREFUSMetlWlsVFUcxX9vmaXDtNOp0G1aK5uhBcRCaw1I1DaI+gVUVIwNKOoHRCSIihpKIO4asIDygQCRlNUUBUJQa4pdlLbYCsVSF/bpTHeYLrP3zbt+aDuWqKiJJ3nJu8m9J+fe//+cP/wNhBDXrdetXyufqKk1rFu/Vr7RvpGQ+Ae0dHQ+bLJaZ0uq6pCRYiKIgNA0d8jrrb45KfFz/gv8gRBTb5sm/fLrb4VtHZ3eH78u00sXLRY7J08WGx0OsX/SJHH0yUJx6suvdHdbu7e5+efCaZlZUl+/95+Vn6w7mZzocGxpq65ecP7tt/A3NWECDMAoYPhNQoBpUiaJRUUkzJpV2u1yLZ9516z2vyS/5unh56amxPHTp5fVrnhxmqekBCIRJE0jxpGGrSAfefRotI4u+r8pw9TZgQzoioypcBGZxcWNV06dmjshM7PDkZL85ye54GzZXbp0qfgUxC5VFQesVlH23gfiiqtNOJ1u4bziEk5nq7jU0iqOrVkrDpvN4giIIyCOLlkizp47v/s65U3NzUzJyqKmtmae0d126Ezhk5jDYYw2G+N27mJMXh6a3/8nIaplFK6qCtxPL8bg96OrKiklJfiSUubn599z+GR9PfKUrCwAUh3p285vKsYWCBCj69y0YiX2qVP/khhA8/tIzsklfukyBCBrGh2bNpOa5tgGcEdOzmB9TtTW5fd3dSVKVVWogBIbh/2eewevpihIinIdsWwwIKkqAPaCAqRRVgCCtTX0d3cnlldU5jNcfFty8sy20lJhHj5sNhGTkYGsKLQ11NNaUYFiNIEQYDJxsXgjLQf2I6sqys0ZSGYTAGag69AhEZeYOBNABTCYTBm+xkZppPVkVeXa5Uu4HnkIFdBK9jB2zn1c3rGd3o0b0AFr9nTUtLTrfdLYKKlGY0ZUeQQssT0eho2sh8P43W6UUCja0zFCIHQdy9ixBIGIxYJis4HTCUP7BBDX20NEYIkq1wLB/t6U1MEFEOnro7eygvQFj3JreQVaRCNh/AT0gQES8u5kxqkzIMuoVivuzw+ie71IQ0o9ScnEBoP9UeWeq90X7Hl50QiSdZ2u4o/wu93Yxo/npom3ogWDnF61En9nBwabDUNsLP2trXRu2Rx1ogDic3NFn8dzIUpeU1lZlfTAg1JwZB+3ujn7wXsopsFi+bu7SbDb8blcIMsoRiO/fXkMxfdHpgSB0XPvl05WVVdFyVe/vKqu1+dttixc+EeUAgmuFnRZRtc04tLTSXvtDcbMyEEfGEDXdeJirYwMXMPjj9Pr8zUXrXm9jhE5xL69e5eNKVyEbo1FGgqdYCjEgC5w7ykBSeL8kcNEwiE6j5fjd7VgtIyKEuvWWBIeW0jpZweWRTtu+GfzpuJKZzhYbN6wgdAQua/7Kr0+L301NchmM5FLF1AkGd3r5VJ9A30HS5GAMKC8/z4t4XDx1q2fVP5d5MZ/+33NwVDTT/nB1a8i9/QwAGg2G5ZFiwnU1WJLTSVQW4vcPpiuui0e9Z13MU2ZcnzO3bMfAXpuNInit+8qKZpot78UOvQFV/ftJSYQiF5RDH0BSwz2x57APH8e5zyejc89/dSbI4lvNObkgvyC2c8vf+HDW8ZNyO35sUH4TzdKiucqEXsCltuzhS07W7p88eIPWz/e8srx4+XVgP6fZ2jOjJwZhc88e9fo5OQMo9lsDQeD3u729iu7d2z/rr6hvoH/CcMmlP7tgd8B7KkscvxgvnAAAAAASUVORK5CYII=";	
	    if (Seed.cityData.city[cityID].isPrestigeCity && Seed.cityData.city[cityID].prestigeInfo.prestigeType ==2 && Seed.queue_atkinc[marchID].destinationUnixTime > now) document.getElementById("skull" + marchID).innerHTML = '<A onclick="button_sacrifice('+ marchID+','+ cityID +')"><img src="'+skull_black+'"></a>';
	},
	doSacrificeQ:function(marchID,city){
		alert('Auto Sacrifice coming soon...');
		return;
		paintS = new pbPopup ('pbSacrifice', 50, 50, 200, 200, true);
		paintS.centerMe (document.getElementById('marchesBody'));
		paintS.getMainDiv().innerHTML = '<DIV id=SacrificeBody style="max-height:200px; max-width:200px; overflow:auto">';
		paintS.getTopDiv().innerHTML = "<CENTER><b>Sacrifice</b></center>";
		paintS.show(true);


		//alert(Seed.queue_atkp['city' + city]['m'+marchID].toSource());
		var m ='<TABLE><TR>';

		for (var i=1;i<=15;i++){
			if (i%5==0) m+= '</tr><TR>';
			if (parseInt(Seed.queue_atkp['city' + city]['m'+marchID]['unit'+i+'Count'])>0) m+='<TD style="width: 30px;"><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+ i +'_30_s34.jpg?6545></td><TD>' + Seed.queue_atkp['city' + city]['m'+marchID]['unit'+i+'Count'] + '</td>';
		}
		m+='</tr></table>';
		document.getElementById('SacrificeBody').innerHTML = m;
	},    
	close: function(){OutgoingMarches.active=false}
}


var QueueMarches = {
	active:false,	
	init: function(){
		var t = QueueMarches;
		paintQ = new pbPopup ('pbVmarches', 50, 50, 750, 450, true, QueueMarches.close);
		paintQ.centerMe (mainPop.getMainDiv);
		paintQ.getMainDiv().innerHTML = '<DIV><DIV id=QueuemarchesBody style="height:425px; max-height:425px	; max-width:750px; overflow:auto"></div>';
		paintQ.getTopDiv().innerHTML = "<CENTER><b>Queued Marches</b></center>";
		if (QueueMarches.active){
			paintQ.show(false);
			QueueMarches.active=false;
		} else {
			paintQ.show(true);
			QueueMarches.active=true;
		}	
	},
	show: function(){
		var t = QueueMarches;
		var updatemarch = Seed.queue_atkp;
		var m='Transport/DF/Attack/Farm/Crest use a central march system. This central march system makes a virtual queue.<BR>So every second a city looks if it can add an action to that virtual queue. Checks will be done in the above sequence.<BR>Every 5sec a city will send out a march from that virtual queue (making req. send out more even), so fighting captcha.';
		m+='<BR><TABLE cellSpacing=10 class=pbTab>';
     	var now=unixTime();
     	for (var c=1;c<=Seed.cities.length;c++) {
	        number=0; 
	        if (MarchQueue[c].length==0) var check=false;
	        else var check=true;
			if (check) m+= '<TR><TD colspan=5 style="background: #335577;" align=center><B><FONT color=white>' +Seed.cities[c-1][1]+': </font></b></td></tr>';
	        for (var i=0;i<MarchQueue[c].length;i++) {
	        	number++;
	        	m += '<TR><TD>'+ number +'</td>';
	        	switch(MarchQueue[c][i].action){
	        		case (1): m+='<TD><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/transporting.jpg"></td>';break;
	        		case (2): m+='<TD><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/reinforce.jpg"></td>';break;
	        		case (3): m+='<TD><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/scouting.jpg"></td>';break;
	        		case (4): m+='<TD><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/attacking.jpg"></td>';break;
	        		case (5): m+='<TD><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/transporting.jpg"></td>';break;
	        		default: m+='<TD><img src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/attacking.jpg"></td>';break;
	        	}
	        	m+='<TD>'+((MarchQueue[c][i].what==undefined||MarchQueue[c][i].what=="Attack")?"Attack":MarchQueue[c][i].what)+' Tab</td>';
	        	m+='<TD>'+coordLink(parseInt(MarchQueue[c][i].targetX),parseInt(MarchQueue[c][i].targetY))+'</td>';
	        	for (var u=1;u<=15;u++){
	        		if (parseInt(MarchQueue[c][i][u])>0) m+='<TD style="width: 30px;"><img src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_'+ u +'_30_s34.jpg?6545></td><TD>' + addCommas(parseInt(MarchQueue[c][i][u])) +'</td>';
	        	}
				m += '</tr>';

	        }

    	}
    	m += '</table></div>';
    	document.getElementById('QueuemarchesBody').innerHTML = m;
	},
	close: function(){QueueMarches.active=false}
}


//******************** Auto Update ***************************//

var AutoUpdater_162501 = {
    id: 162501,
    version: Version,
    call: function(secure) {
        GM_xmlhttpRequest({
            method: 'GET',
        url: 'http'+(secure ? 's' : '')+'://userscripts.org/scripts/source/'+this.id+'.meta.js',
        onload: function(xpr) {AutoUpdater_162501.compare(xpr);},
            onerror: function(xpr) {if (secure) AutoUpdater_162501.call(false);}
        });
    },
    compareVersion: function(r_version, l_version) {
    	r_version = r_version.substr(5);
    	l_version = l_version.substr(5);
        return (r_version !== l_version) ? r_version > l_version : false;
    },
    compare: function(xpr) {
        this.xversion=/\/\/\s*@version\s+(.+)\s*\n/i.exec(xpr.responseText);   
        if (this.xversion) this.xversion = this.xversion[1];
         else return; 
        var updated = this.compareVersion(this.xversion, this.version);   
        if (updated) {                  
 			var body = '<BR><DIV align=center><FONT size=3><B>New version ' + this.xversion + ' is available!</b></font></div><BR>';
 			body+='<BR><iframe style=";border:0;width:475px;max-width:475px;height:150px;max-height:150px;overflow:auto" src="http://nicodebelder.eu/koc/AIO_changelog.html"></iframe><BR>';
 			body+='<BR><DIV align=center><a class="gemButtonv2 green" id="doBotUpdate">Update</a></div>';
 			ShowUpdate(body);
        } 
    },
    check: function() {
    	var now = unixTime();
    	var lastCheck = 0;
    	if (localStorage.updated_162501) lastCheck = parseInt(localStorage.updated_162501);
		if (now > (lastCheck + 60*60*2)) this.call(true);
    }
};
setTimeout(function(){AutoUpdater_162501.check();},15000); 


function doBOTUpdate(){
	unsafeWindow.cm.ModalManager.closeAll();
	unsafeWindow.cm.ModalManager.close();
	var now = unixTime();
	localStorage.setItem ("updated_162501", now);
	location.href = 'http://userscripts.org/scripts/source/162501.user.js';
}

function ShowUpdate(body){
	var now = unixTime();	 
	unsafeWindow.cm.ModalManager.addMedium({
	    title: "Koc AIO Script",
	   	body: body,
	   	closeNow: false,
	    close: function () {
	    	localStorage.setItem ("updated_162501", now);
	    	unsafeWindow.cm.ModalManager.closeAll();
	    },
	    "class": "Warning",
		curtain: false,
        width: 500,
		height: 600,
		left: 140,
		top: 140
	});
	document.getElementById('doBotUpdate').addEventListener ('click', doBOTUpdate, false);   
}



/************ DEBUG WIN *************/
var debugWin = {
	popDebug:			null,
	dbDefaultNot:	'tech,tutorial,items,quests,wilderness,wildDef,buildings,knights,allianceDiplomacies,appFriends,players',
	dbSelect:			{},
	sortSeed:			[],
	sortNonSeed:	[],

	doit: function (){
		var t = debugWin;

		function syncBoxes (){
			for (var i=0; i<t.sortSeed.length; i++){
				var name = t.sortSeed[i];
				var box = document.getElementById('dbpop_'+name);
				box.checked = t.dbSelect[name];
			}
		}
		function clickedAll (){
			for (var k in t.dbSelect)
				t.dbSelect[k] = true;
			syncBoxes();
		}
		function clickedNone (){
			for (var k in t.dbSelect)
				t.dbSelect[k] = false;
			syncBoxes();
		}
		function clickedDefaults (){
			for (k in t.dbSelect)
				t.dbSelect[k] = true;
			var not = t.dbDefaultNot.split(',');
			for (var i=0; i<not.length; i++)
				t.dbSelect[not[i]] = false;
			syncBoxes();
		}
		function clickedShow (){
			var resultsDiv = document.getElementById('idDebugResultsDiv')
			var s = '<PRE>';
			for (var i=0; i<t.sortSeed.length; i++){
				var name = t.sortSeed[i];
				var box = document.getElementById('dbpop_'+name);
				if (box.checked)
					s += name + " =\n" + inspect (Seed[name], 10, 1);
			}
			resultsDiv.innerHTML = s + '</PRE>';
		}

		function clickedShowNonSeed (){
			var resultsDiv = document.getElementById('idDebugResultsDiv');
			nsvalue = document.getElementById('dbnonseed').value;
			if (nsvalue != '') {
				val = unsafeWindow[nsvalue];
				valtype = typeof(val);
				resultsDiv.innerHTML = '<PRE>(' + valtype + ') ' + nsvalue + ((valtype == 'string')?(" = " + val):(" =\n" + inspect (val, 10, 1))) + '</PRE>';
			}
		}

		function clickedShowScripts (){
			var resultsDiv = document.getElementById('idDebugResultsDiv')
			var scripts = document.getElementsByTagName('script');
			var s = '';
			for (var i=0; i<scripts.length; i++)
				if (scripts[i].src!=null && scripts[i].src!='')
					s+='<A TARGET=_tab HREF="'+ scripts[i].src +'">'+ scripts[i].src +'</A><BR />';
			resultsDiv.innerHTML = s;
		}

		if (t.popDebug == null){
			t.popDebug = new pbPopup ('db', 0, 45, 749, 900, true);
			t.popDebug.getTopDiv().innerHTML = '<DIV align=center><B>DEBUG</B></DIV>';
			var sl = 0;
			for (var k in Seed) {
				t.dbSelect[k] = true;
				t.sortSeed[sl] = k;
				sl++;
			}
			t.sortSeed.sort();
			sl = 0;
			for (var k in unsafeWindow) {
				kType = typeof(unsafeWindow[k]);
				if ((k.indexOf('actionlink_data') != 0) && (k != 'content') && (k != 'document') && (k.indexOf('feed') != 0) && (k.indexOf('frame') != 0) && (k != 'globalStorage') &&
					(k != 'g_mapObject') && (k != 'history') && (k != 'Modal') && (k != 'navigator') && (k != 'parent') && (k.indexOf('pb') != 0) && (k.indexOf('pt') != 0) && (k != 'seed') &&
					(k != 'self') && (k.indexOf('template_data') != 0) && (k != 'that') && (k != 'window') && (k != '_htmlElement') && (kType != 'function') && (kType != 'undefined')) {
					t.sortNonSeed[sl] = k;
					sl++;
				}
			}
			t.sortNonSeed.sort(function(x,y) {var a = String(x).toUpperCase(); var b = String(y).toUpperCase(); if (a > b) return 1; else if (a < b) return -1; else return 0;});
			var nsSelect = '<SELECT id="dbnonseed"><OPTION value="" ></option>';
			for (var i=0; i<t.sortNonSeed.length; i++)
				nsSelect += '<OPTION value="' + t.sortNonSeed[i] + '" >' + t.sortNonSeed[i] + '</option>';
			nsSelect += '</SELECT>';
			var not = t.dbDefaultNot.split(',');
			for (var i=0; i<not.length; i++)
				t.dbSelect[not[i]] = false;
			var m = '<DIV class=ptentry><B>Seed: </B><INPUT type=submit class=pbButton id=dbsuball value=ALL>&nbsp;<INPUT type=submit class=pbButton id=dbsubnone value=NONE>&nbsp;' +
				'<INPUT type=submit class=pbButton id=dbdefaults value=DEFAULTS>&nbsp;<INPUT type=submit class=pbButton id=dbsubdo value=SHOW>&nbsp;<INPUT type=submit class=pbButton id=dbsubscripts value=SCRIPTS><BR /><TABLE width=100%>';
			var cols = 5;
			var entries = t.sortSeed.length;
			var rows = parseInt (0.99 + entries / cols);
			for (var rowno=1; rowno<=rows; rowno++) {
				m += '<TR>';
				for (colno=1; colno<=cols; colno++) {
					var slvalue = rows*(colno-1)+rowno-1;
					m += ((slvalue < entries)?('<TD class=xtab><INPUT type=checkbox id="dbpop_'+t.sortSeed[slvalue]+'">&nbsp;'+t.sortSeed[slvalue]+'</TD>'):'<TD class=xtab></TD>');
				}
				m += '</TR>';
			}
			m += '</TABLE><B>Non-Seed: </B>' + nsSelect + '</DIV><DIV id="idDebugResultsDiv" style="width:738px; height:600px; max-height:600px; overflow-y:auto; white-space:pre-wrap;"></DIV>';
			t.popDebug.getMainDiv().innerHTML = m;
			document.getElementById('dbsuball').addEventListener('click', clickedAll, false);
			document.getElementById('dbsubnone').addEventListener('click', clickedNone, false);
			document.getElementById('dbdefaults').addEventListener('click', clickedDefaults, false);
			document.getElementById('dbsubdo').addEventListener('click', clickedShow, false);
			document.getElementById('dbsubscripts').addEventListener('click', clickedShowScripts, false);
			document.getElementById('dbnonseed').addEventListener('change', clickedShowNonSeed, false);
			syncBoxes();
		}
		t.popDebug.show (true);
	},
}
//********************* GLOBAL FUNCTIONS **********************//

function CheckFilter (uid){
	for (var i=0;i<Options.PlayerFilter.length;i++) if (Options.PlayerFilter[i]['uid'] == uid) return true;
	return false;
}
function translate (str) {return str;}

function IncomingCheck(){
	var Counter=0;
	for (k in Seed.queue_atkinc) if (Seed.queue_atkinc[k].marchType==3 || Seed.queue_atkinc[k].marchType==4) Counter++;
	if (Counter==0 || Seed.queue_atkinc=="") document.getElementById('pbIncomingButton').style.display = "none";
	 else document.getElementById('pbIncomingButton').style.display = "inline";
}

function ClearMarchQueue(action){
	for (var c=1;c<=Seed.cities.length;c++){
		do {
			var check = false;
			for (var i=0;i<MarchQueue[c].length;i++) if (((MarchQueue[c][i].what==undefined||MarchQueue[c][i].what=="Attack")?"Attack":MarchQueue[c][i].what)==action) {MarchQueue[c].splice(i,1);check=true;}
		} while (check);
	}
}

var SpamEvery  = {
  timer : null,
  spamtimer : 0,
  init : function (){
    if (!Options.spamconfig.aspam) return;
    if (Options.spamconfig.spammins < 1)
    Options.spamconfig.spammins = 1;
    SpamEvery.setEnable (Options.spamconfig.aspam);
  },
  setEnable : function (tf){
    var t = SpamEvery;
    clearTimeout (t.timer);
    if (tf)
      t.timer = setTimeout (t.count, 60*1000);
  },
  count : function (){
   var t = SpamEvery;
   t.spamtimer = Options.spamconfig.spammins;
   if(parseInt(t.spamtimer) < 60) t.spamtimer = 60;
   if (Options.spamconfig.atime > t.spamtimer) {
    Options.spamconfig.atime = 2;
    t.doit ();
   } else {
    Options.spamconfig.atime = (Options.spamconfig.atime + 1);
    SpamEvery.init ();
   }
   saveOptions ();
  },
  doit : function (){
    actionLog ('Spamming ('+ Options.spamconfig.spammins +' minutes expired)');
    sendChat ("/" + Options.spamconfig.spamstate + " " +  Options.spamconfig.spamvert);
    SpamEvery.init ();
  }
}

var GMTclock = {
  span : null,
  init : function (){
    this.span = document.createElement ('span');
    this.span.style.fontWeight = 'bold';
    document.getElementById('kochead_time').parentNode.appendChild (this.span);
  },
  everySecond : function (){
    var now = new Date();  
    now.setTime(now.getTime() + (now.getTimezoneOffset()*60000));
  	GMTclock.span.innerHTML = ' &nbsp; ('+ now.toLocaleFormat('%H:%M') +')';
  },
}

function actionLog (msg){
    Tabs.Options.log (msg);  
}

function doTrain (cityId, tut, gamble, unitId, num, notify){
  var time = unsafeWindow.modal_barracks_traintime(unitId, num);
  var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
  params.cid = cityId;
  params.type = unitId;
  params.quant = num;
  params.items = tut;
  params.gambleId = gamble;

  new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/train.php" + unsafeWindow.g_ajaxsuffix, {
    method: "post",
    parameters: params,
    onSuccess: function(rslt) {
      if (rslt.ok) {
        for (var i = 1; i < 5; i++) {
      var resourceLost = parseInt(unsafeWindow.unitcost["unt" + unitId][i]) * 3600 * parseInt(num);
      if(rslt.gamble) resourceLost = resourceLost*rslt.gamble[i];
          unsafeWindow.seed.resources["city" + cityId]["rec" + i][0] = parseInt(unsafeWindow.seed.resources["city" + cityId]["rec" + i][0]) - resourceLost;
        }
        unsafeWindow.seed.citystats["city" + cityId].gold[0] = parseInt(unsafeWindow.seed.citystats["city" + cityId].gold[0]) - parseInt(unsafeWindow.unitcost["unt" + unitId][5]) * parseInt(num);
        unsafeWindow.seed.citystats["city" + cityId].pop[0] = parseInt(unsafeWindow.seed.citystats["city" + cityId].pop[0]) - parseInt(unsafeWindow.unitcost["unt" + unitId][6]) * parseInt(num);
        unsafeWindow.seed.queue_unt["city" + cityId].push([unitId, num, rslt.initTS, parseInt(rslt.initTS) + time, 0, time, null]);
        if (notify != null)
          setTimeout (function (){notify(null);}, 500);
      } else {
        if (notify != null){
          setTimeout (function (){notify(rslt.errorMsg);}, 500);
        }
      }
    },
    onFailure: function(o) {
      if (notify != null)
        notify(rslt.errorMsg);
    }
  });
}

function doDefTrain (cityId, siege, unitId, num, notify){
  var time = unsafeWindow.modal_walls_traintime(unitId, num);
  var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
  params.cid = cityId;
  params.type = unitId;
  params.quant = num;
  params.items = siege;
  new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/fortify.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        if (rslt.ok) {
          unsafeWindow.seed.queue_fort["city" + cityId].push([unitId, num, rslt.initTS, parseInt(rslt.initTS) + time, 0, time, rslt.fortifyId]);
          if (notify != null)
            setTimeout (function (){notify(null);}, 500);
        } else {
          if (notify != null)
            setTimeout (function (){notify(rslt.errorMsg);}, 500);
        }
      },
      onFailure: function () {
        if (notify != null)
          notify(rslt.errorMsg);
      },
  });
}

function renderKabamPresetStats(slot){
	var StatEffects = [];
	var m="";
	for (var k in unsafeWindow.cm.thronestats.effects) StatEffects[k] = 0;
	for (var k in unsafeWindow.kocThroneItems){
		y = unsafeWindow.kocThroneItems[k];
    	for (var ii=0;ii<Seed.throne.slotEquip[slot].length;ii++) if(Seed.throne.slotEquip[slot][ii] == y.id) for (var i=1;i<=5;i++) {
		   id = y["effects"]["slot"+i]["id"];
		   tier = parseInt(y["effects"]["slot"+i]["tier"]);
		   level = y["level"];
		   p = unsafeWindow.cm.thronestats.tiers[id][tier];
		   Current = p.base + ((level * level + level) * p.growth * 0.5);
		   if (i<=parseInt(y.quality)) StatEffects[id] += Current
		}
	}
	for (k=1;k<StatEffects.length;k++) if (StatEffects[k] != 0) m+= StatEffects[k] + '% '+unsafeWindow.cm.thronestats["effects"][k]["1"]+ '<br>';
	if (document.getElementById('KabamPresetHover'+slot)) document.getElementById('KabamPresetHover'+slot).innerHTML = m;
	if (document.getElementById('KabamPresetHover_Chat'+slot)) document.getElementById('KabamPresetHover_Chat'+slot).innerHTML = m;
}

function renderLocalPresetStats(preset){
	var StatEffects = [];
	var m="";
	for (var k in unsafeWindow.cm.thronestats.effects) StatEffects[k] = 0;
	for (var k in ThroneOptions.Presets[preset]){
		if (ThroneOptions.Presets[preset][k]!=0) {
			y = unsafeWindow.kocThroneItems[ThroneOptions.Presets[preset][k]];
	    	for (var i=1;i<=5;i++) {
			   id = y["effects"]["slot"+i]["id"];
			   tier = parseInt(y["effects"]["slot"+i]["tier"]);
			   level = y["level"];
			   p = unsafeWindow.cm.thronestats.tiers[id][tier];
			   Current = p.base + ((level * level + level) * p.growth * 0.5);
			   if (i<=parseInt(y.quality)) StatEffects[id] += Current
			}
		}
	}
	for (k=1;k<StatEffects.length;k++) if (StatEffects[k] != 0) m+= StatEffects[k] + '% '+unsafeWindow.cm.thronestats["effects"][k]["1"]+ '<br>';
	return m;
}

function formatUnixTime (unixTimeString,format){
	var rtn = unsafeWindow.formatDateByUnixTime (unixTimeString);
	return rtn;
}

function getCityPrestige (cityId){
	return Seed.cityData.city[cityId].isPrestigeCity;
}

String.prototype.capitalize = function(){ 
  return this.charAt(0).toUpperCase() + this.substring(1).toLowerCase();
}

String.prototype.stripTags = function(){ 
  return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi, '');
}

function getAbsoluteOffsets (e){
  ret = {left:0, top:0};
  while (e.offsetParent){
    if (e.style.position == 'absolute')
      break;
    ret.left += e.offsetLeft;
    ret.top += e.offsetTop;
    e = e.offsetParent;
  }      
  return ret;  
}

function htmlTitleLine (msg){
  return '<TABLE width=100% cellspacing=0><TR><TD style="padding:0px" width=32%><HR></td><TD style="padding:0px"width=33%>[ '+ msg +' ]</td><TD style="padding:0px" width=32%><HR></td></tr></table>';  
}

function getDiplomacy (aid) {
  if(aid < 1 || aid == null) return 'unallianced';
  if (Seed.allianceDiplomacies == null) return 'neutral';
  if (Seed.allianceDiplomacies.friendly && Seed.allianceDiplomacies.friendly['a'+aid] != null) return 'friendly';
  if (Seed.allianceDiplomacies.hostile && Seed.allianceDiplomacies.hostile['a'+aid] != null) return 'hostile';
  if(getMyAlliance()[0] == aid) return 'ally';
  return 'neutral';
}

function getCityBuilding (cityId, buildingId){
  var b = Seed.buildings['city'+cityId];
  var ret = {count:0, maxLevel:0};
  for (var i=1; i<33; i++){
    if (b['pos'+i] && b['pos'+i][0] == buildingId){
      ++ret.count;
      if (parseInt(b['pos'+i][1]) > ret.maxLevel) ret.maxLevel = parseInt(b['pos'+i][1]);
    }
  }
  return ret;
}

function logit (msg){
  var now = new Date();
  GM_log (getServerId() +' @ '+ now.toTimeString().substring (0,8) +'.' + now.getMilliseconds() +': '+  msg);
}

function getWallInfo (cityId, objOut){
  objOut.wallSpaceUsed = 0;
  objOut.fieldSpaceUsed = 0;
  objOut.wallLevel = 0;  
  objOut.wallSpace = 0;     
  objOut.fieldSpace = 0;  
  var b = Seed.buildings["city" + cityId];
  if (b.pos1==null) return;  
  objOut.wallLevel = parseInt(b.pos1[1]);
  var spots = 0;
  for (var i=1; i<(objOut.wallLevel+1); i++) spots += (i * 500);
  objOut.wallSpace = spots;     
  objOut.fieldSpace = spots;     
  var fort = Seed.fortifications["city" + cityId];
  for (k in fort){
    var id = parseInt(k.substr(4));
    if (id<60) objOut.wallSpaceUsed += parseInt(unsafeWindow.fortstats["unt"+ id][5]) * parseInt(fort[k]);
    else objOut.fieldSpaceUsed += parseInt(unsafeWindow.fortstats["unt"+ id][5]) * parseInt(fort[k]);
  }
}

var kboxtime = 1;
function killbox () {
   kboxtime += 1;
   if(!Options.KMagicBox) return;
   if (kboxtime > 50) return;
   if (Number(unsafeWindow.seed.items.i599) == 0) return;
   if(!document.getElementById('modal_mmb')) setTimeout(killbox,100);
    else unsafeWindow.Modal.hideModal();  
};

function MakeBlocks(getX,getY,radius){
	var blocks = [];
	var xx=0;
	var yy=0;
	for (x=(getX-radius);x<=(getX+radius);x+=5) {
	   for (y=(getY-radius);y<=(getY+radius);y+=5) {
			xx=x;
			yy=y;
			if (x>750) xx-=750;
			if (y>750) yy-=750;
			if (x<0) xx+=750;
			if (y<0) yy+=750;
			blocks.push ("bl_" + xx + "_bt_" + yy);
		}
	}
	return blocks;
}

function MakeProvinceBlocks(getX,getY){
	var blocks = [];
	var xx=0;
	var yy=0;
	for (x=getX;x<=(getX+30);x+=5) {
	   for (y=getY;y<=(getY+30);y+=5) {
			xx=x;
			yy=y;
			blocks.push ("bl_" + xx + "_bt_" + yy);
		}
	}
	return blocks;
}


function marchTimeCalculator(troops, is_round_trip, items_applied, cityID, action,dist) {
    if(dist=="NaN" || dist==0) return "N/A";
    var speed = 99999;
    var total_troops = 0;
    items_applied = items_applied || {};
    for(var troop_type in troops) {
        if(!troops[troop_type].toString().match(/^\d+$/)) continue;
        var troop_number = parseInt(troops[troop_type]);
        if(troop_number <= 0) continue;
        total_troops += troop_number;
        var troop_speed = parseInt(unsafeWindow.unitstats["unt" + troop_type][3]);
        troop_speed *= (1 + 0.1 * parseInt(Seed.tech.tch11));
        if(unsafeWindow.cm.unitHorsedBenefit[troop_type]) troop_speed = troop_speed * (1 + 0.05 * parseInt(Seed.tech.tch12))
         else {
            troop_speed *= (1 + 0.05 * (parseInt(Seed.tech2.tch1) || 0));
            troop_speed *= unsafeWindow.cm.BlessingSystemModel.applyBlessing(unsafeWindow.cm.BlessingSystemModel.getBlessing().BLOOD_LUST, cityID, {speed: true});
        }
        if(troop_speed < speed) speed = troop_speed;
    }
    speed *= unsafeWindow.cm.BlessingSystemModel.applyBlessing(unsafeWindow.cm.BlessingSystemModel.getBlessing().FILL_THE_RANKS, cityID, {marchspeed: true});
    speed *= unsafeWindow.cm.BlessingSystemModel.applyBlessing(unsafeWindow.cm.BlessingSystemModel.getBlessing().REDUCE_FATIGUE, cityID, {}); 
    var throne67 = unsafeWindow.cm.ThroneController.effectBonus(67);  //March Speed
    var throne68, throne69, throne70, throne71, throne72;
    throne68 = throne69 = throne70 = throne71 = throne72 = 0;
    switch (action){
    	case 1: throne70 = unsafeWindow.cm.ThroneController.effectBonus(70);break; //Transport March Speed
    	case 2: throne69 = unsafeWindow.cm.ThroneController.effectBonus(69);break; //Reinforcement March Speed 
    	case 3: throne72 = unsafeWindow.cm.ThroneController.effectBonus(72);break; //Scout March Speed
    	case 4: throne68 = unsafeWindow.cm.ThroneController.effectBonus(68);break; //Attack March Speed
    	case 5: throne71 = unsafeWindow.cm.ThroneController.effectBonus(71);break; //Reassign March Speed
    }
    var throneBoost = throne67 + throne68 + throne69 + throne70 + throne71 + throne72;
    speed = speed * (1 + (throneBoost * 0.01));
    var gi = unsafeWindow.cm.guardianModalModel.getMarchBonus();
    var multiplier = 1 + (gi * 0.01);
    if(unsafeWindow.cm.WorldSettings.isOn("GUARDIAN_MARCH_EFFECT")) speed = speed * multiplier;
    var time = 0;
    if(0 == speed || 0 == total_troops) return "N/A"; 
    time = Math.ceil(dist * 6000 / speed);
    if(items_applied["57"] && Seed.items.i57 > 0) time = parseInt(time * 0.5);
     else if(items_applied["55"] && Seed.items.i55 > 0) time = parseInt(time * 0.75);  
    if(unsafeWindow.g_env !== "dev") time += 30;
    now = unixTime();        
    if(Seed.playerEffects.returnExpire >now) time = parseInt(time * 0.75);
    if(is_round_trip) time *= 2;    
    return timestr(time);
}

var messageNav = {
	init : function (){
		t = messageNav;
		t.MapFunc = new CalterUwFunc ('modal_maptile', [[/}\s*$/, ';setTimeout(function() { MapAddon_hook(l, o, p, k, m, n, f, s, v, i, c, a, e, r, b, h, q, j, d, g); },0); }']]);
		unsafeWindow.MapAddon_hook = t.AddExtra;
		t.MapFunc.setEnable (true);
		t.MsgButtons = new CalterUwFunc ('modal_messages', [[/}\s*$/, ';setTimeout(function() { AddMsgButtons(); },0); }']]);
		unsafeWindow.AddMsgButtons = t.AddMsgButtons;
		t.MsgButtons.setEnable (true);
		t.CityButton = new CalterUwFunc ('citysel_click', [[/}\s*$/, ';setTimeout(function() { CityAddons(); },0); }']]);
		unsafeWindow.CityAddons = t.CityAddons;
		t.CityButton.setEnable (true);

	},
	setEnable : function (tf){},
	isAvailable : function (){
		t = messageNav;
		return t.mmFunc.isAvailable();
	},
	CityAddons: function  (){	
		for (i=0;i<Seed.cities.length;i++){
			if (Seed.cities[i][0] == unsafeWindow.currentcityid) Options.ReturnToCity = (i+1);
			saveOptions();
			color = "black";
			cityID = Seed.cities[i][0];
			if (Seed.cityData.city[cityID].isPrestigeCity) {
				if (Seed.cityData.city[cityID].prestigeInfo.prestigeType) {
					switch (parseInt(Seed.cityData.city[cityID].prestigeInfo.prestigeType)){
		    			case 1: color = "#689C00";break;
		    			case 2: color = "#E36600";break;
		    			case 3: color = "#A944DB";break;
		    		}
		    	}
			}
			document.getElementById('mod_citylist').children[i].innerHTML = "<SPAN><FONT fontFamily='georgia,​arial,​sans-serif' font-weight=700 font-size=11px color="+color+">"+ unsafeWindow.roman[i] +"</font></span>";
		}
		PaintStartUpQueue(unsafeWindow.currentcityid);
		if (Tabs.build.buildPop && Tabs.build.popupCity!=unsafeWindow.currentcityid) Tabs.build.buildPop.show (false);
	},
	AddMsgButtons :function() {
		t = messageNav;
		msgBody = document.getElementsByClassName('messageDeletes')[0];
		var a = document.createElement('a');
			a.className='buttonDown20 GiftReport';
			a.innerHTML='<span>Delete Gift Report</span>';
			a.addEventListener('click', function(){t.checkinbox(1);}, false);
		var div = document.createElement('span');
		msgBody = document.getElementsByClassName('messageDeletes')[0];
		var b = document.createElement('a');
			b.className='buttonDown20';
			b.innerHTML='<span>Send to Mail</span>';
			b.addEventListener('click', function(){t.checkinbox(2);}, false);
		var div = document.createElement('span');
		div.appendChild(a);
		div.appendChild(b);
		msgBody.appendChild(div);
	},
	checkinbox : function(what){
		var t = messageNav;
    	var body = document.getElementById('tbl_messages');
    	var trs=body.getElementsByTagName('tr');
    	var reports = [];
		for(var i=0; i<trs.length; i++){
			var tds = trs[i].getElementsByTagName('td');
			for(var j=0; j<tds.length; j++){
				if(tds[j].className == 'chkcol') var checkbox = tds[j];
				if(tds[j].className == 'dtcol') var date = tds[j];	
				if(tds[j].className == 'nmcol') var sender = tds[j];	
				if(tds[j].className == 'subjcol') var subject = tds[j];	
			}
			reports.push({checkbox:checkbox,date:date,sender:sender,subject:subject});
		}
		if (what==1) t.parseGiftReport(reports);
		if (what==2) t.parseMailReport(reports);
	},
	parseGiftReport : function(rpts){
    	var t = messageNav;
    	for(var i=0; i<rpts.length; i++) if(rpts[i].subject.innerHTML.indexOf('New Gift Received!') >= 0 && rpts[i].sender.innerHTML.indexOf('Kingdoms Of Camelot') >= 0) rpts[i].checkbox.firstChild.checked = true;	
		unsafeWindow.messages_action("delete","tbl_messages"); 
  	},
  	parseMailReport : function(rpts){
    	var t = messageNav;
    	var send = [];
		var help = unsafeWindow.getSelectedMessages("tbl_messages");
		var array = help.split(',');
		for (var a=0;a<array.length;a++) 
	    	for(var i=0;i<rpts.length; i++) {
	    		var sender = rpts[i].sender.textContent || rpts[i].sender.innerText;
				var subject = rpts[i].subject.textContent || rpts[i].subject.innerText;
				var date = rpts[i].date.textContent || rpts[i].date.innerText;
	    		if (rpts[i].checkbox.innerHTML.indexOf(array[a]) >=0) send.push({id:array[a],date:date,sender:sender,subject:subject}); 
	    	}
	    for (var i=0;i<send.length;i++) setTimeout(t.messageBody,(i*5000),send[i]);
  	},
  	messageBody: function(send){
  		var t= messageNav;
  		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		params.pf=0;
		params.requestType="GET_MESSAGE_FOR_ID";
		params.messageId = send.id;
		new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getEmail.php" + unsafeWindow.g_ajaxsuffix, {
			method: "post",
			parameters: params,
			onSuccess: function (rslt) {
				if (rslt) t.sendToMail(send,rslt.messageBody);
			},
			onFailure: function () {
			},
		}, false);
  	},
  	sendToMail: function(send,messageBody){
  		var t = messageNav;
  		messageBody = messageBody.replace(/custom-line-break/g,"<BR>");
  		var msg = '<BR>Date: ' + send.date;
  		msg += '<BR>From: ' + send.sender,
  		msg += '<BR>Subject: ' + send.subject;
  		msg += '<BR><BR>' + messageBody; 
  		var content = '<BODY><HTML>' + msg + '</html></body>';
  		var data = {};
    	data.Subject ='Forwarded Message ('+getServerId()+')';
    	data.Message = content; 
    	GM_xmlhttpRequest({
        	method: 'POST',
        	url: 'http://nicodebelder.eu/koc/mail.php',
        	headers: {'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',},
        	data: implodeUrlArgs(data),
        	onload: function (response) {alert(response.responseText);},
    	});
    	document.getElementById('inbox_chk_'+send.id).checked = false;
  	},
	AddExtra :function(l, o, p, k, m, n, f, s, v, i, c, a, e, r, b, h, q, j, d, g) {
		t = messageNav;
		//modal_maptile(i, h.tileid, h.tilename, h.xcoord, h.ycoord, h.pic, h.username, h.might, h.title, h.alliance, h.cities, h.province, h.type, h.status, h.level, h.allianceId, h.cityid, h.tileuserid, h.typename, h.mistedflag)
		//alert(l +'/'+ o+'/'+ p+'/'+ k+'/'+ m+'/'+ n+'/'+ f+'/'+ s+'/'+ v+'/'+ i+'/'+ c+'/'+ a+'/'+ e+'/'+ r+'/'+ b+'/'+ h+'/'+ q+'/'+ j+'/'+ d+'/'+ g)
		if (j!=null && j > 0) {
			var div = document.getElementById('contextMenu');
			var scr = document.createElement('div');
			scr.innerHTML= "<a class='buttonv2 red h20' id=addToMarchTab>Add To March Tab</a><a class='buttonv2 green h20' id=AutoScout>Auto Scout</a>";
			div.appendChild(scr);
			document.getElementById('addToMarchTab').addEventListener('click', function(){t.GoToMarchTab(k,m,unsafeWindow.currentcityid);}, false);
			document.getElementById('AutoScout').addEventListener('click', function(){t.AutoScout(k,m);}, false);
		}
		if (e=="city_mist"){
			var div = document.getElementById('contextMenu');
			var scr = document.createElement('div');
			scr.innerHTML= "<a class='buttonv2 red h20' id=viewMisted>View Misted Info</a>";
			div.appendChild(scr);
			document.getElementById('viewMisted').addEventListener('click', function(){t.SetBookmark(k,m,o);}, false);
		}
	},
	AutoScout :function(x,y) {
		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		params.kid = 0;
		params.u3=1;
		params.cid=unsafeWindow.currentcityid;
    	params.type=3;
	    params.xcoord=x;
	    params.ycoord=y;
	    params.gold=0;
	    params.items = "";
	    for (var i=1;i<=5;i++) params['r'+i]=0;
    	new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/march.php" + unsafeWindow.g_ajaxsuffix, {
              method: "post",
              parameters: params,
              loading: true,
              onSuccess: function (transport) {
                  var rslt = eval("(" + transport.responseText + ")");
                  if (rslt.ok) {
	                  var now = unixTime();
	                  var timediff = parseInt(rslt.eta) - parseInt(rslt.initTS);
	                  var ut = unixTime();
	                  var unitsarr=[0,0,0,0,0,0,0,0,0,0,0,0,0];
	                  for(i = 0; i <= unitsarr.length; i++)if(params["u"+i])unitsarr[i] = params["u"+i];
	                  var resources=new Array();
	                  resources[0] = params.gold;
	                  for(i=1; i<=4; i++) resources[i] = params["r"+i];
	                  var currentcityid = params.cid;
	                  unsafeWindow.attach_addoutgoingmarch(rslt.marchId, rslt.marchUnixTime, ut + timediff, params.xcoord, params.ycoord, unitsarr, params.type, params.kid, resources, rslt.tileId, rslt.tileType, rslt.tileLevel, currentcityid, true);
	                  if(rslt.updateSeed){unsafeWindow.update_seed(rslt.updateSeed)};
                  } else if (rslt.error_code ==8 || rslt.error_code ==3) t.AutoScout(x,y); 
              },
              onFailure: function () {}
      });     
	},
	GoToMarchTab :function(x,y,cityID) {
		mainPop.show (true);
		tabManager.e_clickedTab(null,"March");
		document.getElementById('MtargetX').value = x;
		document.getElementById('MtargetY').value = y;
		for (var t=0;t<Seed.cities.length;t++) if (parseInt(Seed.cities[t][0]) == cityID) var cityNum = t;
		document.getElementById('pbMfrom_'+cityNum).click(); 
	},
	SetBookmark:function(x,y,tileId){
		var t = messageNav;
		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		params.requestType="BOOKMARK_LOCATION";
		params.tileId=tileId;
    	params.bookmarkName = "Misted_City";	 
	    new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/tileBookmark.php" + unsafeWindow.g_ajaxsuffix, {
      		method: "post",
      		parameters: params,
      		onSuccess: function (transport) {
      			var rslt = eval("(" + transport.responseText + ")");
        		if (rslt.ok) t.GetBookmarkInfo(x,y);	
      		},
    	});
	},
	GetBookmarkInfo:function(x,y){
		var t = messageNav;
		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		params.requestType="GET_BOOKMARK_INFO";	 
	    new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/tileBookmark.php" + unsafeWindow.g_ajaxsuffix, {
      		method: "post",
      		parameters: params,
      		onSuccess: function (transport) {
      			var rslt = eval("(" + transport.responseText + ")");
        		if (rslt.ok) {
        			for (var i in rslt.bookmarkInfo) if (parseInt(rslt.bookmarkInfo[i].xCoord)==x && parseInt(rslt.bookmarkInfo[i].yCoord)==y) alert('Player: ' + rslt.bookmarkInfo[i].userName + ' - City Name: ' +  rslt.bookmarkInfo[i].cityName);	
        			t.RemoveBookMark(rslt.bookmarkInfo[i].bookmarkId);
        		}
      		},
    	});
	},
	RemoveBookMark:function(bookmarkId){
		var t = messageNav;
		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		params.requestType="REMOVE_BOOKMARK";
		params.bookmarkId=bookmarkId;
	    new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/tileBookmark.php" + unsafeWindow.g_ajaxsuffix, {
      		method: "post",
      		parameters: params,
      		onSuccess: function (transport) {},
    	});
	},
}

var WatchDog ={
	Reports:{},
	init : function (){
	    var t = WatchDog;
		var saved = GM_getValue ('allianceRpt_'+getServerId());
	    if(saved!=null) t.Reports = JSON2.parse (saved);  
		else t.Reports = {};
	    //t.enable (Options.EnhanceAR);
  	},
  	FetchAllianceReports : function (){
		var t = WatchDog;
		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		params.group = "a";
		new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/listReports.php" + unsafeWindow.g_ajaxsuffix, {
			method: "post",
			parameters: params,
			onSuccess: function (transport) {
				var rslt = eval("(" + transport.responseText + ")");
				t.parseAReports (rslt.arReports, rslt.arPlayerNames, rslt.arAllianceNames, rslt.arCityNames, rslt.totalPages);
			},
			onFailure: function (rslt) {},
		}, false);
  	},
	parseAReports : function (arReports, playerNames, allianceNames, cityNames, totalPages){
		var t = WatchDog;
		var myAllianceId = getMyAlliance()[0];
		var now = unixTime();
		var keys = unsafeWindow.Object.keys(arReports);
		if (matTypeof(arReports) != 'array'){
			for (var i = 0; i < keys.length; i++) {
				var report = arReports[keys[i]];
				report.side0AllianceId = parseInt(report.side0AllianceId);
				var targetDiplomacy = getDiplomacy (report.side0AllianceId);
				var diplomacy = getDiplomacy(report.side1AllianceId);
				//friendly
				if (report.side1AllianceId != myAllianceId){
					var ID = report.reportId;
					if(t.Reports["a"+ID] != null) return;
					  if (report.marchType == 3) atkType = 'Scout';
					  else if (report.marchType == 4) atkType = 'Attack';
					  if (report.side0TileType > 50) target = "city";
					  else if (report.side0TileType <= 50) target = "wild";
					  if(report.side1AllianceId == 0) var allianceName = 'Undefined';
					  else var allianceName = allianceNames["a"+report.side1AllianceId];
					var date=FullDateTime(report.reportUnixTime);
					var msg = ':::. Report No: '+report.reportId+' ('+timestr(now-report.reportUnixTime)+' ago) || || ';
					msg += atkType + ' on ' + playerNames['p'+report.side0PlayerId]+' ('+target+' at '+report.side0XCoord+','+report.side0YCoord+') | '+playerNames["p"+report.side1PlayerId]+' ('+report.side1XCoord+','+report.side1YCoord+') of '+allianceName+' ('+diplomacy+')';
					var send = true;
					if (!Options.WatchDogFilter && diplomacy=='friendly') send = false;
					if (send) sendChat('/a '+msg);
					t.SaveAllianceReport(report);
				}
			}
		}	  
	},
	SaveAllianceReport : function (rpt){
		t = WatchDog;
		var ID = rpt.reportId;
		t.Reports["a"+ID] = rpt.reportUnixTime;
		var now = unixTime() - (5*24*60*60);
		for(k in t.Reports) if(t.Reports[k] < now) delete t.Reports[k];	
		var string = JSON2.stringify(t.Reports);
		setTimeout(function() {GM_setValue("allianceRpt_"+getServerId(), string);}, 0);
	},
}

function getMaxLoad(unitType,unitCount) {
    var load = 0;
    var techLoadBoost = parseInt(Seed.tech.tch10) * 0.1;
    var unit_number = unitCount;
    var loadEffectBoost = 0;
    if (Seed.playerEffects.loadExpire > unixTime()) loadEffectBoost = 0.25
    var TRload = unsafeWindow.cm.ThroneController.effectBonus(6);
    if (unitType == 10 || unitType == 11 || unitType == 12) TRload += unsafeWindow.cm.ThroneController.effectBonus(59) ;
     else if (unitType == 7 || unitType == 8) TRload += unsafeWindow.cm.ThroneController.effectBonus(48);
	if (TRload > 500) TRload = 500;
    var loadBoost = (TRload * 0.01) + loadEffectBoost + techLoadBoost;
    load += unit_number * parseInt(unsafeWindow.unitstats['unt'+unitType][5]) * (1 + loadBoost);
    return (parseInt(load));
};

function distance (d, f, c, e) {
  	var a = 750;
  	var g = a / 2;
  	var b = Math.abs(c - d);
  	if (b > g) b = a - b;
  	var h = Math.abs(e - f);
  	if (h > g) h = a - h;
  	return Math.round(100 * Math.sqrt(b * b + h * h)) / 100;
};

var myServerId = null;
function getServerId() {
  if (myServerId == null) myServerId = parseInt(unsafeWindow.g_server);
  return myServerId;
}



function getMyAlliance (){
  if (Seed.allianceDiplomacies==null || Seed.allianceDiplomacies.allianceName==null) return [0, 'None'];
  else return [Seed.allianceDiplomacies.allianceId, Seed.allianceDiplomacies.allianceName];
}

function RefreshSeed(){
	var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
	
	new AjaxRequest(unsafeWindow.g_ajaxpath + "/fb/e2/src/main_src.php?g=&y=0&n=nan001&l=nl_NL&messagebox=&standalone=0&res=1&iframe=1&lang=en&ts=1304248288.7067&s=250&appBar=" + unsafeWindow.g_ajaxsuffix, {
	    method: "POST",
	    parameters: params,
	    onSuccess: function (rslt) {
	        var mainSrcHTMLCode = rslt.responseText;
	    	var myregexp = /var seed=\{.*?\};/;
	    	var match = myregexp.exec(mainSrcHTMLCode);
	    	if (match != null) {
	    		result = match[0];
	    		result = result.substr(4);
	    		var seed = eval(result);
	    		unsafeWindow.document.seed = seed;
	    		Seed = seed;
	    		unsafeWindow.seed = seed;
	    		updatebotbutton("Update OK :)", "pbSeedRefresh");
	    		setTimeout(function(){updatebotbutton('Refresh Seed', 'pbSeedRefresh')}, 5000);
	    	}
	    },
	    onFailure: function () {
	      if (notify != null)
	        notify(rslt.errorMsg);
	    },
	});
}

function RecallWatchdog(){
	var now = unixTime();
	if (Recall.length == 0) return;
	for (var i=0;i<Recall.length;i++) {
		var marchId = Recall[i].marchId;
		var arrivalTime = Recall[i].arrivalTime;
		if (Seed.queue_atkinc[marchId] == undefined && arrivalTime > now) {
			Recall.splice(i,1);
			if (SEND_ALERT_AS_WHISPER) sendChat ("/"+ Seed.player.name +' '+ "..:.| RECALLED ||  March with ID: " + marchId.substr(1)); // Whisper to myself
			else sendChat ("/a ..:.| RECALLED ||  March with ID: " + marchId.substr(1));   
		} else if (arrivalTime < now) Recall.splice(i,1);
	}
}

function FullDateTime(str){
 	var time = new Date(str*1000);
	D = addZero(time.getDate());
	M = addZero(time.getMonth()+1);
	Y = addZero(time.getFullYear());
	h = addZero(time.getHours());
	m = addZero(time.getMinutes());
	s = addZero(time.getUTCSeconds());
	var fullDate =  D +"/"+ M +"/"+ Y +"  "+ h + ":" + m + ":" + s;
	return fullDate;
}

function addZero(i){
	if (i<10) i="0" + i;	 
	return i;
}

function distance (d, f, c, e) {
  var a = 750;
  var g = a / 2;
  var b = Math.abs(c - d);
  if (b > g) b = a - b;
  var h = Math.abs(e - f);
  if (h > g) h = a - h;
  return Math.round(100 * Math.sqrt(b * b + h * h)) / 100;
}

function getKnights(cityId){
    var knt = new Array();
    for (k in Seed.knights['city' + cityId]){
           if (Seed.knights['city' + cityId][k]["knightStatus"] == 1 && Seed.leaders['city' + cityId]["resourcefulnessKnightId"] != Seed.knights['city' + cityId][k]["knightId"] && Seed.leaders['city' + cityId]["politicsKnightId"] != Seed.knights['city' + cityId][k]["knightId"] && Seed.leaders['city' + cityId]["combatKnightId"] != Seed.knights['city' + cityId][k]["knightId"] && Seed.leaders['city' +cityId]["intelligenceKnightId"] != Seed.knights['city' + cityId][k]["knightId"]){
               knt.push ({
                   Name:  	  Seed.knights['city' + cityId][k]["knightName"],
                   Combat:    parseInt(Seed.knights['city' + cityId][k]["combat"]),
                   ID:        Seed.knights['city' + cityId][k]["knightId"],
               });
           }
    }
    knt = knt.sort(function sort(a,b) {a = a['Combat'];b = b['Combat'];return a == b ? 0 : (a < b ? -1 : 1);});
    return knt; 
}

function getRallypoint(cityId){
	var rallypointlevel=0;
	for (var o in Seed.buildings["city" + cityId]){
	    var buildingType = parseInt(Seed.buildings["city" + cityId][o][0]);
	    var buildingLevel = parseInt(Seed.buildings["city" + cityId][o][1]);
	    if (buildingType == 12) rallypointlevel=parseInt(buildingLevel);
	}
	if (rallypointlevel == 12) rallypointlevel=11;
	if (Seed.cityData.city[cityId].isPrestigeCity && rallypointlevel>0) rallypointlevel += 3;
	return rallypointlevel;
}

function doMarch(action,WhatCity){
    var knight = getKnights(action.city);
	if (knight.toSource() == "[]") return;
	var kid = knight[0].ID;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    var TroopsOK = true;
    params.cid=action.city;
    params.type=action.action;
    if (action.action == 4 || action.action == 5) params.kid=kid;
    else params.kid=0;
    params.xcoord = action.targetX;
    params.ycoord = action.targetY;
    for (var i=1;i<=15;i++){
    	TroopsInCity = Seed.units['city'+action.city]['unt'+i];
    	if (action[i]) {
    		if (parseInt(TroopsInCity) < parseInt(action[i])) TroopsOK = false;
    		else if (parseInt(action[i]) > 0) params['u'+i]=action[i];
    	}

    }
    if (!TroopsOK) {
    	MarchOffset = MarchDelay;
    	return;
    }
    if (action.gold) params.gold = action.gold;
  	if (action.r1) params.r1= action.r1;
  	if (action.r2) params.r2= action.r2;
  	if (action.r3) params.r3= action.r3;
  	if (action.r4) params.r4= action.r4;
  	if (action.r5) params.r5= action.r5;
    
    var total=0;
	var maxsend = 0;
    var rallypointlevel = 0;	
    for (var o in Seed.buildings["city" + action.city]){
	    var buildingType = parseInt(Seed.buildings["city" + action.city][o][0]);
	    var buildingLevel = parseInt(Seed.buildings["city" + action.city][o][1]);
	    if (buildingType == 12) rallypointlevel=parseInt(buildingLevel);
	}
  	if(rallypointlevel == 11) rallypointlevel = 15;
	if(rallypointlevel == 12) rallypointlevel = 20;
  	maxsend = (rallypointlevel * 10000);
  	if (Seed.cityData.city[action.city].isPrestigeCity) {
  		switch(parseInt(Seed.cityData.city[action.city].prestigeInfo.prestigeLevel)){
  			case 1: maxsend = Math.round(maxsend * 1.50);break;
  			case 2: maxsend = Math.round(maxsend * 1.60);break;
  			case 3: maxsend = Math.round(maxsend * 1.65);break;
  		}
  	}
  	var TR = unsafeWindow.cm.ThroneController.effectBonus(66);
    if (TR > 150) TR=150;
  	maxsend += Math.round(maxsend * (TR / 100));
  	for (var i=1;i<=15;i++) total += parseInt(action[i]); 
  	if (total == 'Nan')	actionlog('City: ' + WhatCity + ' - Troops: ' + total);	
  	if (total == 0){
  		MarchQueue[WhatCity].splice(0,1);
  		MarchOffset = MarchDelay;
  		return;
  	}
  	
  	if (total > maxsend) MarchQueue[WhatCity].splice(0,1);	

      new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/march.php" + unsafeWindow.g_ajaxsuffix, {
              method: "post",
              parameters: params,
              loading: true,
              onSuccess: function (transport) {
                  var rslt = eval("(" + transport.responseText + ")");
                  if (rslt.ok) {
	                  MarchesSend++;
	                  var now = unixTime();
					  MarchQueue[WhatCity].splice(0,1);
					  MarchOffset = MarchDelay;
	                  var timediff = parseInt(rslt.eta) - parseInt(rslt.initTS);
	                  var ut = unixTime();
	                  var unitsarr=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
	                  for(i=0;i<=unitsarr.length;i++)if(params["u"+i]) unitsarr[i] = params["u"+i];	                      
	                  var resources=new Array();
	                  resources[0] = params.gold;
	                  for(i=1; i<=4; i++) resources[i] = params["r"+i];
	                  var currentcityid = params.cid;
	                  unsafeWindow.attach_addoutgoingmarch(rslt.marchId, rslt.marchUnixTime, ut + timediff, params.xcoord, params.ycoord, unitsarr, params.type, params.kid, resources, rslt.tileId, rslt.tileType, rslt.tileLevel, currentcityid, true);
	                  if(rslt.updateSeed) unsafeWindow.update_seed(rslt.updateSeed);
	                  if (params.type == 1) MakeTransportLog(params);
                  }
                  else {
                  	if (rslt.error_code !=8 && rslt.error_code !=3 && rslt.error_code != 104) actionLog("City: " + WhatCity + ' - ' + rslt.toSource());
                  	MarchesError++;        	
                  	switch (rslt.error_code){
                  		case 206: 
                  				//Cannot perform this action on target. Please try again later
                  				for (var k in Seed.wilderness['city'+action.city]) if (Seed.wilderness['city'+action.city][k]['xCoord']==CrestOptions.X && Seed.wilderness['city'+action.city][k]['yCoord']==CrestOptions.Y) Tabs.Crest.abandonWilderness(Seed.wilderness['city'+action.city][k]['tileId'],Seed.wilderness['city'+action.city][k]['xCoord'],Seed.wilderness['city'+action.city][k]['yCoord'],CrestOptions.CrestCity);
						      	MarchOffset = MarchDelay;
                  				break;
                  		case 213:
                  				//Unable to use target Knight. Knight must be in the City to be used. If you receive this message in error, please refresh the game
                  				MarchOffset = MarchDelay;
                  				break;
                  		case 104: 
                  				//Cannot perform this action on target location
                  				MarchQueue[WhatCity].splice(0,1);
                  				MarchOffset = MarchDelay;
                  				break;
             			case 0:
             					//Need to send at least one soldier", feedback:"Need to send at least one soldier
                  				MarchQueue[WhatCity].splice(0,1);
                  				MarchOffset = MarchDelay;
                  				break;
                  	}
                  	if (rslt.user_action == "marchCaptcha") {
                  		MarchOffset = 5*60; // 5 Minutes
                  		actionLog("CAPTCHA");
                  		document.getElementById('MarchesSendInfo').innerHTML += '&nbsp<FONT color=red><B>CAPTCHA</b></font>';
                  		//Captcha(params);
                  	}
                  	else MarchOffset = MarchDelay*2;
                  }
                  if (rslt.user_action != "marchCaptcha") {
                  	var m = '<TABLE class=pbTab><TR align=center><TD>Marches: <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAmJJREFUeNqkk0toE0Ech3+T3aRJX7RpPNgSgzQljYXiC1FbUcFrL9WTqAe96NGce+hF8KA5eVHsSaQni1CR4kHEFwoVxNrW0iJtA9lqk1TJbnZ2d3bGnbWPDT124Fvm9f32v+wMEUJgL02VD/IkASjEQw5IJwiGvd6AR3JzX8HjAwQmIEQRrjdyBcTV0v+AQBuKqpFcpiuTTiWS8eaG5qisz7D0I8vrK4MLxcWLlmPlvanJugq25NaGltFzfWezKpQYsxl0W99aa0x3dDcm25Mdb+fejVZNf94PCW1u6GwIRXJnegeyds2K6boOSmkdz3oeg5lO7GT6RDZCwjnp7AQwMdyzvztNdRozDAOmadZxt3vE3zZ1eNwLYbFUPJmWTjDgdKIpEa9Wq7Asy0dWsfZ7DTejV9BWbkKhUMC1l7cwOzcLTnlcOsGAAwqUqOu6+Hx+ClpZw8qvFaRIF061H4eqqhhbfooXpVdwQg6oTaPSCQaAuQw3Dl7GzMwMpg6N42iiHw/77/ny69J7PCiOATH4MJX5zk6AI1ZLxjod+XYHiqIgHA7jUe99hNUwFms/cXt5BLyZe/8CPjaxqHSCFXxcW9cqSlzB4I8h/61bXFq8DrRhW5bQaq0inWDAxJ/V8lIIxCRdBMe+X/DlvulBYF+9zLlrWpq5JJ2dAC6KrsHy5U/avGDcJCmCvq+enML2d0u4w0x9ujLPa25eOvUnkYtJpln4+1zLRbJN6UimMa6oalQuuRuM2gu1ij1vLHFH5NGqeKeQ7DrKfggvsS/0zcawx+7LpJAJtCjFoEL2ep3/CTAAj+gy+4Yc2yMAAAAASUVORK5CYII="/>';
                  	m += "&nbsp" + MarchesSend + "&nbsp";
                  	m += '&nbsp - &nbsp<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAxtJREFUeNpUVF1Ik2EUfr59myudluZP09Sauk38I5o/hSZqVgbqhVgSrqvoJu+iLpXszm5FELoRQVH8G0ZqEphFJGoxDdTpNi01RUXdcm5jm53zZWQvPHzf9p7neZ9z3nM+obKyEoIgQCaTSU9CFCEVwHlCKP4sJ2Hj6OhojrBFQCAQAD/l+LeUhNzExMRr1dXV9zUaTYbP55M25HI5lpaWZnt6ejpWVlY+0V8TBA/viXq9nk9lcml5eXmt0Wh84jObYza7u7HR0oLtvj44rVaoVKqY4nt3b5BT0WKxuCl+heAXdTodW8mvqKgwFhUVPbA3NCDo40ck0KmJajViIyOhcjiwPz6OjalpZBhrs0RR9JPIFovIKJfohISEgpKSYqO1oR7q/X1kDQ3h4OAA29vbElwuFy6PjCBqZwfLjY0oLCw0xsXFFTBXRnmmV1VV1ayOjiJsbR0pvb1S3pe6urC7uyuB33mlmkxQ2uzYej+GsrKyGubK/H5/bHz8hTTHxARCQkLQk5wsBbvdbsS1tyO8tZULCCvV4VVEBBzk0Dk5idhYdRpzWeCs0/kLhzOz8FPVQ0mkjfKem5vD5uamJMTX+yE7W7omD9WDYw8P3WCunGywCHwE194eXOvrUNEdU6GgUCgQFBQk4W9DiF4v3BQrcYjLNXCKohyKtDR4SCCYNlLGxv4jcx9cX1iAinuCxDlWEEQWcPLp64uLS/MqQy52ya76BPkb2f6SlSUJMHKoDi5yFnwlBzabfZ65LDDT2dnRH5lfCE96JsylpRLZQuSLdCJjinqF12utFgFDDsLz8mEy9fczl1P4abNZxwcG+nr1L15CICfDBgPOsN1j8HuHRgMh5yq0z5swOGjqtdtt48wVo6OjeTDWzOavQiBwJLv9tF5/KlmH71SX6bVVWOQK+ItvQfPwMbSP6tDZ2TZAI9FHLT1Muj4hMzNTmiyHw3Ha4/HcTErSltTVPbtjMOQlnRg0TE19tjY3N72xWi3vlErl27CwsENpgk8ISO3r9Xrj6Xfucfrnjvk7hGUiTFB9fnDDkYD0CfgtwAC3SIkI+86QvQAAAABJRU5ErkJggg=="/>';
                  	m += "&nbsp" + MarchesError + '</td></tr></table>';
                  	document.getElementById('MarchesSendInfo').innerHTML =  m;
       			  }
              },
              onFailure: function () {}
      });             
}

function MakeTransportLog(what){
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
	params.blocks = "bl_" + what.xcoord + "_bt_" + what.ycoord;
    new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/fetchMapTiles.php" + unsafeWindow.g_ajaxsuffix, {
  		method: "post",
  		parameters: params,
  		onSuccess: function (transport) {
  			var rslt = eval("(" + transport.responseText + ")");
    		if (rslt.ok) {
    			var userId = rslt.data["l_"+what.xcoord+"_t_"+what.ycoord].tileUserId;
				var targetCityName = rslt.data["l_"+what.xcoord+"_t_"+what.ycoord].cityName;
				var targetName = rslt.userInfo["u" + userId]["n"];
	    		for (var t=0;t<Seed.cities.length;t++) if (parseInt(Seed.cities[t][0]) == what.cid) var cityname = Seed.cities[t][1];
				var resources = 0;
			    if (what.gold) resources += parseInt(what.gold);
			   	if (what.r1) resources += parseInt(what.r1);
				if (what.r2) resources += parseInt(what.r2);
				if (what.r3) resources += parseInt(what.r3);
				if (what.r4) resources += parseInt(what.r4);
				if (what.r5) resources += parseInt(what.r5);
				var msg = "Transport: " + addCommas(resources) + " resources from " + cityname + " to: " + targetName + " (" + targetCityName + ')';
				actionLog(msg);
			}
  		},
	});	
}

function FillMarchQueue(){
	for (var ii=0;ii<Seed.cities.length;ii++){
		cityID = Seed.cities[ii][0];	
		var rallypointlevel = getRallypoint(cityID);
		var now = unixTime();
		if (Tabs.transport.traderState.running && (Options.lastCityTransport[ii+1]+(Options.transportinterval * 60)) < now) Tabs.transport.doMarch(cityID,ii);
		if (MarchQueue[ii+1].length < rallypointlevel) {
			if (DFOptions.Running) var send = Tabs.DF.doMarch(cityID,ii); 
			if (send) continue;
			if (AtkOptions.Running) Tabs.Attack.doMarch(cityID,ii);
			if (FarmOptions.Running) Tabs.farm.barbing(cityID,ii);
			if (CrestOptions.Running) {				
				for (var k in Seed.wilderness['city'+cityID]) if (Seed.wilderness['city'+cityID][k]['xCoord']==CrestOptions.X && Seed.wilderness['city'+cityID][k]['yCoord']==CrestOptions.Y) Tabs.Crest.abandonWilderness(Seed.wilderness['city'+cityID][k]['tileId'],Seed.wilderness['city'+cityID][k]['xCoord'],Seed.wilderness['city'+cityID][k]['yCoord'],CrestOptions.CrestCity);
				Tabs.Crest.FirstRound();
			}
		}
	}
}

function CheckMarchQueue(){
	var RP = getRallypoint(Seed.cities[WhatCity-1][0]);
	var MarchesRunning = CheckCityMarches(WhatCity-1);
	var total = 0;
	for (var i=1;i<=Seed.cities.length;i++) total += MarchQueue[i].length;
	if (total == 0) return;
	if (MarchQueue[WhatCity].length > 0) {
		if (MarchesRunning < (RP-Options.RPClip)) doMarch(MarchQueue[WhatCity][0],WhatCity);
		WhatCity++;
		if (WhatCity >= (Seed.cities.length+1)) WhatCity = 1;
	}
	else {
		WhatCity++;
		if (WhatCity >= (Seed.cities.length+1)) WhatCity = 1;
		CheckMarchQueue();
	}
}

function CheckCityMarches(City){
	var Counter=0;
	var cityID = Seed.cities[City][0];
	var now=unixTime();
	if (Seed.queue_atkp['city'+ cityID] != undefined) for (atkp in Seed.queue_atkp['city'+ cityID]) if (Seed.queue_atkp['city'+ cityID][atkp]["marchId"] || Seed.queue_atkp['city'+ cityID][atkp]["returnUnixTime"]>now) Counter++;
	return Counter;
}

function Captcha (params){
    captchawin = new pbPopup ('pbmarch_captcha', 0, 0, 400, 300, true);
    captchawin.centerMe (mainPop.getMainDiv);
    var m = "<CENTER><SPAN class=boldRed>CAPTCHA ALERT! You have been sending too many attacks!</span></center><br \>";
    m += "<CENTER><div class=\"captcha_container\"><form id=pbmarch_captchaform ></form></div></center>";
    captchawin.getMainDiv().innerHTML = m;
    captchawin.getTopDiv().innerHTML = "<CENTER><b>KOC AIO Script - March Captcha</b></center>";
    captchawin.show(true);
  
    unsafeWindow.Recaptcha.create("6LcT7cQSAAAAAG4whvbBz60hGjJg0ON1wRIRv_iD", "pbmarch_captchaform", {
        callback: function(){
            unsafeWindow.Recaptcha.focus_response_field();
            $("pbmarch_captchaform").addEventListener("submit", function(e){
                e.preventDefault();
                e.stopPropagation();
                params.marchWarning = 1;
                params.marchCaptcha_challenge = unsafeWindow.Recaptcha.get_challenge();
                params.marchCaptcha_response = unsafeWindow.Recaptcha.get_response();
				MarchOffset = MarchDelay;
                captchawin.destroy();
            }, false);
        },
        theme: "white"
    });
    return;
}

function GetFbToken (){
	document.getElementById('EmailFrame').innerHTML = '<IFRAME style="border:0;width:750px;max-width:750px;height:150px;max-height:150px;overflow:auto" src="http://nicodebelder.eu/koc/fb.html"></iframe>';
}

function PaintKabamPresets (){
	var msg = '<TABLE class=pbTab><TR>';
    for (i=1;i<=Seed.throne.slotNum;i++) msg+='<TD style="width:10px"><a class=hasTooltip><INPUT type=submit class=pbButton id="KabamPreset_Chat_' + i + '" value="'+i+'"><SPAN id="KabamPresetHover_Chat'+i+'"></span></a></td>';
    msg += '</tr></table>';
	document.getElementById('t_throneStatList').style.border = '0px';
	document.getElementById('t_throneStatList').style.overflow = 'visible';
	document.getElementById('t_throneStatList').innerHTML = msg;
	for (i=1;i<=Seed.throne.slotNum;i++) {
		document.getElementById('KabamPreset_Chat_' + i).addEventListener ('click', function(){Tabs.Throne.EquipKabamPreset(this.id.substr(17));},false);
		if (i==Seed.throne.activeSlot) {
			if (document.getElementById('KabamPreset_'+i)) document.getElementById('KabamPreset_'+i).setAttribute("class", "pbButton_selected");
			document.getElementById('KabamPreset_Chat_'+i).setAttribute("class", "pbButton_selected");
		}
		renderKabamPresetStats(i);
	}
}

var AntiCheat = function () {
 	var x = document.getElementsByClassName('cmModalContainer guardian_generic undefined');
 	if(x.length > 0) for(y = 0; y < x.length;y++) if(String(x[y].innerHTML).indexOf('You have Kingdoms of Camelot open in a newer window') > -1) {actionLog('Refesh for Anti-Cheat :\'(');reloadKOC();}
}; 

function CoordClick(x,y){
	unsafeWindow.CloseChatMenu = CloseChatMenu;
	var menu = new pbPopup('pbMenu', cursorX, cursorY, 150, 192, true);
	var m = '<DIV style="max-height:170px; height:170px; overflow-y:auto" onmouseout="CloseChatMenu(event)">';
	m+= '<INPUT id=Chat_March type=submit class=buttonDash_OFF style="width: 145px;" value="Attack"><br>';
	m+= '<INPUT id=Chat_Scout type=submit class=buttonDash_OFF style="width: 145px;" value="Scout"><br>';
	m+= '<INPUT id=Chat_AutoScout type=submit class=buttonDash_OFF style="width: 145px;" value="AutoScout"><br>';
	m+= '<INPUT id=Chat_Transport type=submit class=buttonDash_ON style="width: 145px;" value="Transport"><br>';
	m+= '<INPUT id=Chat_Reinforce type=submit class=buttonDash_ON style="width: 145px;" value="Reinforce"><br>';
	m+= '<INPUT id=Chat_Reassign type=submit class=buttonDash_ON style="width: 145px;" value="Reassign"><br></div>';
	menu.getMainDiv().innerHTML = m;	
	document.getElementById('Chat_March').addEventListener('click', function(){menu.show(false);GoToMarchTab(x,y,4)}, false);
	document.getElementById('Chat_Scout').addEventListener('click', function(){menu.show(false);GoToMarchTab(x,y,3)}, false);
	document.getElementById('Chat_AutoScout').addEventListener('click', function(){menu.show(false);messageNav.AutoScout(x,y)}, false);
	document.getElementById('Chat_Transport').addEventListener('click', function(){menu.show(false);GoToTransportTab(x,y)}, false);
	document.getElementById('Chat_Reinforce').addEventListener('click', function(){menu.show(false);GoToMarchTab(x,y,2)}, false);
	document.getElementById('Chat_Reassign').addEventListener('click', function(){menu.show(false);GoToMarchTab(x,y,5)}, false);
	menu.getTopDiv().innerHTML = '<DIV align=center ><B>'+x+','+y+'</b></div>';
	menu.show(true);
	menu.div.style.top = (cursorY-20) +'px';
  	menu.div.style.left = (cursorX-35) + 'px';
  	unsafeWindow.cm.formatModel.jumpTo(x,y);
  	unsafeWindow.ChatMenu = menu;
}

function CloseChatMenu(e){
	var menu = document.getElementById('pbMenu_outer');
	var left = parseInt(menu.style.left.slice(0,-2));
	var width = parseInt(menu.style.width.slice(0,-2));
	var top = parseInt(menu.style.top.slice(0,-2));
	var height = parseInt(menu.style.height.slice(0,-2));
	var X = ((e.clientX > left && e.clientX < (left+width))?false:true);
	var Y = ((e.clientY > top && e.clientY < (top+height))?false:true);
	if (X || Y) unsafeWindow.ChatMenu.show(false);
}

function GoToMarchTab 	(x,y,action) {
	mainPop.show (true);
	tabManager.e_clickedTab(null,"March");
	document.getElementById('MtargetX').value = x;
	document.getElementById('MtargetY').value = y;
	document.getElementById('pbMarchType').value = action;
}

function GoToTransportTab 	(x,y) {
	mainPop.show (true);
	tabManager.e_clickedTab(null,"transport");
	document.getElementById('ptcityX').value = x;
	document.getElementById('ptcityY').value = y;
}

var cursorX;
var cursorY;
document.onmousemove = function(e){cursorX = e.pageX;cursorY = e.pageY;Options.MouseMove=unixTime();}

function CheckForOtherScripts(){
	var list = document.getElementsByClassName("tab");
	var tools = false;
	var bot=false;
	for (var i = 0; i < list.length; i++) {
    		if (list[i].innerHTML.indexOf('TOOLS')>0) tools=true;
    		if (list[i].innerHTML.indexOf('BOT')>0) bot=true;
	}
	if (tools) alert('You seem to be running KOC Power Tools\nPlease disable it for best results!!');
	if (bot) alert('You seem to be running KOC Power BOT\nPlease disable it for best results!!');
}

function RemoveSummoningCircle(){
	var elem = document.getElementById('summoningCircleBanner');
	if (elem!=undefined && Options.pbSummonToggle) elem.style.display = "none";
}

function multiBrowserOverride(){
	if (!Options.pbAntiCheat) return;
	var old_updateSeed = unsafeWindow.update_seed_ajax;
	var my_updateSeed = function (marchForceUpdateFlag, updateSeedDoneCallback, isCancelTraining) {
		delete unsafeWindow.seed.ss;
		old_updateSeed(marchForceUpdateFlag, updateSeedDoneCallback, isCancelTraining);
	}
	unsafeWindow.update_seed_ajax = my_updateSeed;
}

function eachSecond (){
	Seconds++;
	//Anti-Cheat check
	if (Seconds==2) multiBrowserOverride();
	if (Seconds%5==0) AntiCheat();
	//GMTclock
	//GMTclock.everySecond();
	//Alliance Report Watchdog
	if (Seconds%Options.WatchdogInterval==0 && Options.watchdog) WatchDog.FetchAllianceReports();
	//Overview Tab
	if (OverviewTabActive) Tabs.Overview.paintStats();
	//Outgoing Marches 
	if (OutgoingMarches.active) OutgoingMarches.show();  
	//Incoming Marches 
	if (IncomingMarches.active) IncomingMarches.show();
	IncomingCheck();  
	//March Queue
	if (QueueMarches.active) QueueMarches.show();
	//Show Player & Might in map.
	DrawLevelIcons();
	//Auto Build
	if (Seconds==2 && Tabs.build.buildStates.running == 'ON') Tabs.build.e_autoBuild();
	if (Seconds%20==0 && Tabs.build.buildStates.running == 'ON') Tabs.build.e_autoBuild();
	if (Seconds%20==0 && Tabs.build.buildStates.running == 'AUTO') Tabs.build.FullAuto();
	//Central March System
	FillMarchQueue();
	if (Seconds%MarchOffset==0) CheckMarchQueue();	
	// Dashboard Tab
	if (Seconds%2==0) Dashboard.RPM();
	if (Seconds%2==0 && DashboardOptions.showWarnings) Dashboard.CheckForAlerts();
	if (GlobalOptions.pbWideScreenStyle=="wide" || GlobalOptions.pbWideScreenStyle=="ultra") {
		if (DashboardOptions.showRP) Dashboard.ShowRP();
		if (DashboardOptions.showStatus) Dashboard.CityStatus();
		if (DashboardOptions.showTower) Dashboard.ShowTowerAlerts();
		if (Seconds%2==0 && DashboardOptions.showLog) Dashboard.ShowLog();
		if (DashboardOptions.showSacrifice) Dashboard.showSacrifice();
	}	
	// Tower Alert
	if (Seconds%2==0) Tabs.tower.eachSecond();
	if (Seconds%2==0) RecallWatchdog();
	//Paint Raids
	Tabs.Raid.paint();	
	// Chat Stuff
	if (Seconds%2==0) ChatPane.HandleChatPane();
	// Throne Room Timers
	if (Seconds%5==0)  Tabs.Throne.salvageCheck();
	if (Tabs.Throne.SalvageArray.length > 0 && Seconds%5==0) Tabs.Throne.doSalvage();
	if (ThroneOptions.Active && Seconds%10==0) Tabs.Throne.doAction();
	// Auto-delete Reports
	if (Seconds%120==0) DeleteReports.startdeletereports();
	if (Seconds == 10) DeleteReports.startdeletereports();
	//Auto Refresh Seed
	if (Seconds%300==0) RefreshSeed();
	//Check Gift
	if (Seconds==10) Tabs.Gift.Check();	
	//Food Alert
	if (Seconds%60==0) FoodAlerts.e_eachMinute();
	//Apothecary Tab
	if (Seconds%30==0) Tabs.Apothecary.loop();
	//Crafting Tab
	if (CraftTabActive) Tabs.AutoCraft.PaintStats();
	if (Seconds%15==0 && CraftOptions.Running) Tabs.AutoCraft.CraftCylce();	
	//Get FB token for "Send to mail" app
	if (Seconds==2) GetFbToken();
	if (Seconds%3600==0) GetFbToken(); 
	//Replace Madmaxx TR switcher
	if (Seconds==2) if (document.getElementById('t_throneStatList')) PaintKabamPresets();
	if (Seconds==5) CheckForOtherScripts();
	document.getElementById('MouseMove').innerHTML = timestr(unixTime() - Options.MouseMove);
	//Remove Summoning Circle 
	if (Seconds==3) RemoveSummoningCircle();
}

pbStartup();
